<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › initio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>initio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**************************************************************************</span>
<span class="cm"> * Initio 9100 device driver for Linux.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 1994-1998 Initio Corporation</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Cleanups (c) Copyright 2007 Red Hat &lt;alan@lxorguk.ukuu.org.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; see the file COPYING.  If not, write to</span>
<span class="cm"> * the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND</span>
<span class="cm"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="cm"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="cm"> * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR</span>
<span class="cm"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="cm"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span>
<span class="cm"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<span class="cm"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="cm"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<span class="cm"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm"> * SUCH DAMAGE.</span>
<span class="cm"> *</span>
<span class="cm"> **************************************************************************/</span>


<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define TOTAL_SG_ENTRY		32</span>
<span class="cp">#define MAX_SUPPORTED_ADAPTERS  8</span>
<span class="cp">#define MAX_OFFSET		15</span>
<span class="cp">#define MAX_TARGETS		16</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vec</span><span class="p">;</span>
<span class="p">}</span> <span class="n">i91u_config</span><span class="p">;</span>

<span class="cm">/***************************************/</span>
<span class="cm">/*  Tulip Configuration Register Set */</span>
<span class="cm">/***************************************/</span>
<span class="cp">#define TUL_PVID        0x00	</span><span class="cm">/* Vendor ID                    */</span><span class="cp"></span>
<span class="cp">#define TUL_PDID        0x02	</span><span class="cm">/* Device ID                    */</span><span class="cp"></span>
<span class="cp">#define TUL_PCMD        0x04	</span><span class="cm">/* Command                      */</span><span class="cp"></span>
<span class="cp">#define TUL_PSTUS       0x06	</span><span class="cm">/* Status                       */</span><span class="cp"></span>
<span class="cp">#define TUL_PRID        0x08	</span><span class="cm">/* Revision number              */</span><span class="cp"></span>
<span class="cp">#define TUL_PPI         0x09	</span><span class="cm">/* Programming interface        */</span><span class="cp"></span>
<span class="cp">#define TUL_PSC         0x0A	</span><span class="cm">/* Sub Class                    */</span><span class="cp"></span>
<span class="cp">#define TUL_PBC         0x0B	</span><span class="cm">/* Base Class                   */</span><span class="cp"></span>
<span class="cp">#define TUL_PCLS        0x0C	</span><span class="cm">/* Cache line size              */</span><span class="cp"></span>
<span class="cp">#define TUL_PLTR        0x0D	</span><span class="cm">/* Latency timer                */</span><span class="cp"></span>
<span class="cp">#define TUL_PHDT        0x0E	</span><span class="cm">/* Header type                  */</span><span class="cp"></span>
<span class="cp">#define TUL_PBIST       0x0F	</span><span class="cm">/* BIST                         */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD        0x10	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD1       0x14	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD2       0x18	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD3       0x1C	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD4       0x20	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PBAD5       0x24	</span><span class="cm">/* Base address                 */</span><span class="cp"></span>
<span class="cp">#define TUL_PRSVD       0x28	</span><span class="cm">/* Reserved                     */</span><span class="cp"></span>
<span class="cp">#define TUL_PRSVD1      0x2C	</span><span class="cm">/* Reserved                     */</span><span class="cp"></span>
<span class="cp">#define TUL_PRAD        0x30	</span><span class="cm">/* Expansion ROM base address   */</span><span class="cp"></span>
<span class="cp">#define TUL_PRSVD2      0x34	</span><span class="cm">/* Reserved                     */</span><span class="cp"></span>
<span class="cp">#define TUL_PRSVD3      0x38	</span><span class="cm">/* Reserved                     */</span><span class="cp"></span>
<span class="cp">#define TUL_PINTL       0x3C	</span><span class="cm">/* Interrupt line               */</span><span class="cp"></span>
<span class="cp">#define TUL_PINTP       0x3D	</span><span class="cm">/* Interrupt pin                */</span><span class="cp"></span>
<span class="cp">#define TUL_PIGNT       0x3E	</span><span class="cm">/* MIN_GNT                      */</span><span class="cp"></span>
<span class="cp">#define TUL_PMGNT       0x3F	</span><span class="cm">/* MAX_GNT                      */</span><span class="cp"></span>

<span class="cm">/************************/</span>
<span class="cm">/*  Jasmin Register Set */</span>
<span class="cm">/************************/</span>
<span class="cp">#define TUL_HACFG0      0x40	</span><span class="cm">/* H/A Configuration Register 0         */</span><span class="cp"></span>
<span class="cp">#define TUL_HACFG1      0x41	</span><span class="cm">/* H/A Configuration Register 1         */</span><span class="cp"></span>
<span class="cp">#define TUL_HACFG2      0x42	</span><span class="cm">/* H/A Configuration Register 2         */</span><span class="cp"></span>

<span class="cp">#define TUL_SDCFG0      0x44	</span><span class="cm">/* SCSI Device Configuration 0          */</span><span class="cp"></span>
<span class="cp">#define TUL_SDCFG1      0x45	</span><span class="cm">/* SCSI Device Configuration 1          */</span><span class="cp"></span>
<span class="cp">#define TUL_SDCFG2      0x46	</span><span class="cm">/* SCSI Device Configuration 2          */</span><span class="cp"></span>
<span class="cp">#define TUL_SDCFG3      0x47	</span><span class="cm">/* SCSI Device Configuration 3          */</span><span class="cp"></span>

<span class="cp">#define TUL_GINTS       0x50	</span><span class="cm">/* Global Interrupt Status Register     */</span><span class="cp"></span>
<span class="cp">#define TUL_GIMSK       0x52	</span><span class="cm">/* Global Interrupt MASK Register       */</span><span class="cp"></span>
<span class="cp">#define TUL_GCTRL       0x54	</span><span class="cm">/* Global Control Register              */</span><span class="cp"></span>
<span class="cp">#define TUL_GCTRL_EEPROM_BIT    0x04</span>
<span class="cp">#define TUL_GCTRL1      0x55	</span><span class="cm">/* Global Control Register              */</span><span class="cp"></span>
<span class="cp">#define TUL_DMACFG      0x5B	</span><span class="cm">/* DMA configuration                    */</span><span class="cp"></span>
<span class="cp">#define TUL_NVRAM       0x5D	</span><span class="cm">/* Non-volatile RAM port                */</span><span class="cp"></span>

<span class="cp">#define TUL_SCnt0       0x80	</span><span class="cm">/* 00 R/W Transfer Counter Low          */</span><span class="cp"></span>
<span class="cp">#define TUL_SCnt1       0x81	</span><span class="cm">/* 01 R/W Transfer Counter Mid          */</span><span class="cp"></span>
<span class="cp">#define TUL_SCnt2       0x82	</span><span class="cm">/* 02 R/W Transfer Count High           */</span><span class="cp"></span>
<span class="cp">#define TUL_SFifoCnt    0x83	</span><span class="cm">/* 03 R   FIFO counter                  */</span><span class="cp"></span>
<span class="cp">#define TUL_SIntEnable  0x84	</span><span class="cm">/* 03 W   Interrupt enble               */</span><span class="cp"></span>
<span class="cp">#define TUL_SInt        0x84	</span><span class="cm">/* 04 R   Interrupt Register            */</span><span class="cp"></span>
<span class="cp">#define TUL_SCtrl0      0x85	</span><span class="cm">/* 05 W   Control 0                     */</span><span class="cp"></span>
<span class="cp">#define TUL_SStatus0    0x85	</span><span class="cm">/* 05 R   Status 0                      */</span><span class="cp"></span>
<span class="cp">#define TUL_SCtrl1      0x86	</span><span class="cm">/* 06 W   Control 1                     */</span><span class="cp"></span>
<span class="cp">#define TUL_SStatus1    0x86	</span><span class="cm">/* 06 R   Status 1                      */</span><span class="cp"></span>
<span class="cp">#define TUL_SConfig     0x87	</span><span class="cm">/* 07 W   Configuration                 */</span><span class="cp"></span>
<span class="cp">#define TUL_SStatus2    0x87	</span><span class="cm">/* 07 R   Status 2                      */</span><span class="cp"></span>
<span class="cp">#define TUL_SPeriod     0x88	</span><span class="cm">/* 08 W   Sync. Transfer Period &amp; Offset */</span><span class="cp"></span>
<span class="cp">#define TUL_SOffset     0x88	</span><span class="cm">/* 08 R   Offset                        */</span><span class="cp"></span>
<span class="cp">#define TUL_SScsiId     0x89	</span><span class="cm">/* 09 W   SCSI ID                       */</span><span class="cp"></span>
<span class="cp">#define TUL_SBusId      0x89	</span><span class="cm">/* 09 R   SCSI BUS ID                   */</span><span class="cp"></span>
<span class="cp">#define TUL_STimeOut    0x8A	</span><span class="cm">/* 0A W   Sel/Resel Time Out Register   */</span><span class="cp"></span>
<span class="cp">#define TUL_SIdent      0x8A	</span><span class="cm">/* 0A R   Identify Message Register     */</span><span class="cp"></span>
<span class="cp">#define TUL_SAvail      0x8A	</span><span class="cm">/* 0A R   Available Counter Register   */</span><span class="cp"></span>
<span class="cp">#define TUL_SData       0x8B	</span><span class="cm">/* 0B R/W SCSI data in/out              */</span><span class="cp"></span>
<span class="cp">#define TUL_SFifo       0x8C	</span><span class="cm">/* 0C R/W FIFO                          */</span><span class="cp"></span>
<span class="cp">#define TUL_SSignal     0x90	</span><span class="cm">/* 10 R/W SCSI signal in/out            */</span><span class="cp"></span>
<span class="cp">#define TUL_SCmd        0x91	</span><span class="cm">/* 11 R/W Command                       */</span><span class="cp"></span>
<span class="cp">#define TUL_STest0      0x92	</span><span class="cm">/* 12 R/W Test0                         */</span><span class="cp"></span>
<span class="cp">#define TUL_STest1      0x93	</span><span class="cm">/* 13 R/W Test1                         */</span><span class="cp"></span>
<span class="cp">#define TUL_SCFG1	0x94	</span><span class="cm">/* 14 R/W Configuration                 */</span><span class="cp"></span>

<span class="cp">#define TUL_XAddH       0xC0	</span><span class="cm">/*DMA Transfer Physical Address         */</span><span class="cp"></span>
<span class="cp">#define TUL_XAddW       0xC8	</span><span class="cm">/*DMA Current Transfer Physical Address */</span><span class="cp"></span>
<span class="cp">#define TUL_XCntH       0xD0	</span><span class="cm">/*DMA Transfer Counter                  */</span><span class="cp"></span>
<span class="cp">#define TUL_XCntW       0xD4	</span><span class="cm">/*DMA Current Transfer Counter          */</span><span class="cp"></span>
<span class="cp">#define TUL_XCmd        0xD8	</span><span class="cm">/*DMA Command Register                  */</span><span class="cp"></span>
<span class="cp">#define TUL_Int         0xDC	</span><span class="cm">/*Interrupt Register                    */</span><span class="cp"></span>
<span class="cp">#define TUL_XStatus     0xDD	</span><span class="cm">/*DMA status Register                   */</span><span class="cp"></span>
<span class="cp">#define TUL_Mask        0xE0	</span><span class="cm">/*Interrupt Mask Register               */</span><span class="cp"></span>
<span class="cp">#define TUL_XCtrl       0xE4	</span><span class="cm">/*DMA Control Register                  */</span><span class="cp"></span>
<span class="cp">#define TUL_XCtrl1      0xE5	</span><span class="cm">/*DMA Control Register 1                */</span><span class="cp"></span>
<span class="cp">#define TUL_XFifo       0xE8	</span><span class="cm">/*DMA FIFO                              */</span><span class="cp"></span>

<span class="cp">#define TUL_WCtrl       0xF7	</span><span class="cm">/*Bus master wait state control         */</span><span class="cp"></span>
<span class="cp">#define TUL_DCtrl       0xFB	</span><span class="cm">/*DMA delay control                     */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/*   bit definition for Command register of Configuration Space Header  */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define BUSMS           0x04	</span><span class="cm">/* BUS MASTER Enable                    */</span><span class="cp"></span>
<span class="cp">#define IOSPA           0x01	</span><span class="cm">/* IO Space Enable                      */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* Command Codes of Tulip SCSI Command register                         */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSC_EN_RESEL    0x80	</span><span class="cm">/* Enable Reselection                   */</span><span class="cp"></span>
<span class="cp">#define TSC_CMD_COMP    0x84	</span><span class="cm">/* Command Complete Sequence            */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL         0x01	</span><span class="cm">/* Select Without ATN Sequence          */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN     0x11	</span><span class="cm">/* Select With ATN Sequence             */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN_DMA 0x51	</span><span class="cm">/* Select With ATN Sequence with DMA    */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN3    0x31	</span><span class="cm">/* Select With ATN3 Sequence            */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATNSTOP 0x12	</span><span class="cm">/* Select With ATN and Stop Sequence    */</span><span class="cp"></span>
<span class="cp">#define TSC_SELATNSTOP  0x1E	</span><span class="cm">/* Select With ATN and Stop Sequence    */</span><span class="cp"></span>

<span class="cp">#define TSC_SEL_ATN_DIRECT_IN   0x95	</span><span class="cm">/* Select With ATN Sequence     */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN_DIRECT_OUT  0x15	</span><span class="cm">/* Select With ATN Sequence     */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN3_DIRECT_IN  0xB5	</span><span class="cm">/* Select With ATN3 Sequence    */</span><span class="cp"></span>
<span class="cp">#define TSC_SEL_ATN3_DIRECT_OUT 0x35	</span><span class="cm">/* Select With ATN3 Sequence    */</span><span class="cp"></span>
<span class="cp">#define TSC_XF_DMA_OUT_DIRECT   0x06	</span><span class="cm">/* DMA Xfer Information out      */</span><span class="cp"></span>
<span class="cp">#define TSC_XF_DMA_IN_DIRECT    0x86	</span><span class="cm">/* DMA Xfer Information in       */</span><span class="cp"></span>

<span class="cp">#define TSC_XF_DMA_OUT  0x43	</span><span class="cm">/* DMA Xfer Information out              */</span><span class="cp"></span>
<span class="cp">#define TSC_XF_DMA_IN   0xC3	</span><span class="cm">/* DMA Xfer Information in               */</span><span class="cp"></span>
<span class="cp">#define TSC_XF_FIFO_OUT 0x03	</span><span class="cm">/* FIFO Xfer Information out             */</span><span class="cp"></span>
<span class="cp">#define TSC_XF_FIFO_IN  0x83	</span><span class="cm">/* FIFO Xfer Information in              */</span><span class="cp"></span>

<span class="cp">#define TSC_MSG_ACCEPT  0x0F	</span><span class="cm">/* Message Accept                       */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Control 0 Register                     */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSC_RST_SEQ     0x20	</span><span class="cm">/* Reset sequence counter               */</span><span class="cp"></span>
<span class="cp">#define TSC_FLUSH_FIFO  0x10	</span><span class="cm">/* Flush FIFO                           */</span><span class="cp"></span>
<span class="cp">#define TSC_ABT_CMD     0x04	</span><span class="cm">/* Abort command (sequence)             */</span><span class="cp"></span>
<span class="cp">#define TSC_RST_CHIP    0x02	</span><span class="cm">/* Reset SCSI Chip                      */</span><span class="cp"></span>
<span class="cp">#define TSC_RST_BUS     0x01	</span><span class="cm">/* Reset SCSI Bus                       */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Control 1 Register                     */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSC_EN_SCAM     0x80	</span><span class="cm">/* Enable SCAM                          */</span><span class="cp"></span>
<span class="cp">#define TSC_TIMER       0x40	</span><span class="cm">/* Select timeout unit                  */</span><span class="cp"></span>
<span class="cp">#define TSC_EN_SCSI2    0x20	</span><span class="cm">/* SCSI-2 mode                          */</span><span class="cp"></span>
<span class="cp">#define TSC_PWDN        0x10	</span><span class="cm">/* Power down mode                      */</span><span class="cp"></span>
<span class="cp">#define TSC_WIDE_CPU    0x08	</span><span class="cm">/* Wide CPU                             */</span><span class="cp"></span>
<span class="cp">#define TSC_HW_RESELECT 0x04	</span><span class="cm">/* Enable HW reselect                   */</span><span class="cp"></span>
<span class="cp">#define TSC_EN_BUS_OUT  0x02	</span><span class="cm">/* Enable SCSI data bus out latch       */</span><span class="cp"></span>
<span class="cp">#define TSC_EN_BUS_IN   0x01	</span><span class="cm">/* Enable SCSI data bus in latch        */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Configuration Register                 */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSC_EN_LATCH    0x80	</span><span class="cm">/* Enable phase latch                   */</span><span class="cp"></span>
<span class="cp">#define TSC_INITIATOR   0x40	</span><span class="cm">/* Initiator mode                       */</span><span class="cp"></span>
<span class="cp">#define TSC_EN_SCSI_PAR 0x20	</span><span class="cm">/* Enable SCSI parity                   */</span><span class="cp"></span>
<span class="cp">#define TSC_DMA_8BIT    0x10	</span><span class="cm">/* Alternate dma 8-bits mode            */</span><span class="cp"></span>
<span class="cp">#define TSC_DMA_16BIT   0x08	</span><span class="cm">/* Alternate dma 16-bits mode           */</span><span class="cp"></span>
<span class="cp">#define TSC_EN_WDACK    0x04	</span><span class="cm">/* Enable DACK while wide SCSI xfer     */</span><span class="cp"></span>
<span class="cp">#define TSC_ALT_PERIOD  0x02	</span><span class="cm">/* Alternate sync period mode           */</span><span class="cp"></span>
<span class="cp">#define TSC_DIS_SCSIRST 0x01	</span><span class="cm">/* Disable SCSI bus reset us            */</span><span class="cp"></span>

<span class="cp">#define TSC_INITDEFAULT (TSC_INITIATOR | TSC_EN_LATCH | TSC_ALT_PERIOD | TSC_DIS_SCSIRST)</span>

<span class="cp">#define TSC_WIDE_SCSI   0x80	</span><span class="cm">/* Enable Wide SCSI                     */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI signal Register                        */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSC_RST_ACK     0x00	</span><span class="cm">/* Release ACK signal                   */</span><span class="cp"></span>
<span class="cp">#define TSC_RST_ATN     0x00	</span><span class="cm">/* Release ATN signal                   */</span><span class="cp"></span>
<span class="cp">#define TSC_RST_BSY     0x00	</span><span class="cm">/* Release BSY signal                   */</span><span class="cp"></span>

<span class="cp">#define TSC_SET_ACK     0x40	</span><span class="cm">/* ACK signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_SET_ATN     0x08	</span><span class="cm">/* ATN signal                           */</span><span class="cp"></span>

<span class="cp">#define TSC_REQI        0x80	</span><span class="cm">/* REQ signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_ACKI        0x40	</span><span class="cm">/* ACK signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_BSYI        0x20	</span><span class="cm">/* BSY signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_SELI        0x10	</span><span class="cm">/* SEL signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_ATNI        0x08	</span><span class="cm">/* ATN signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_MSGI        0x04	</span><span class="cm">/* MSG signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_CDI         0x02	</span><span class="cm">/* C/D signal                           */</span><span class="cp"></span>
<span class="cp">#define TSC_IOI         0x01	</span><span class="cm">/* I/O signal                           */</span><span class="cp"></span>


<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Status 0 Register                      */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSS_INT_PENDING 0x80	</span><span class="cm">/* Interrupt pending            */</span><span class="cp"></span>
<span class="cp">#define TSS_SEQ_ACTIVE  0x40	</span><span class="cm">/* Sequencer active             */</span><span class="cp"></span>
<span class="cp">#define TSS_XFER_CNT    0x20	</span><span class="cm">/* Transfer counter zero        */</span><span class="cp"></span>
<span class="cp">#define TSS_FIFO_EMPTY  0x10	</span><span class="cm">/* FIFO empty                   */</span><span class="cp"></span>
<span class="cp">#define TSS_PAR_ERROR   0x08	</span><span class="cm">/* SCSI parity error            */</span><span class="cp"></span>
<span class="cp">#define TSS_PH_MASK     0x07	</span><span class="cm">/* SCSI phase mask              */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Status 1 Register                      */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSS_STATUS_RCV  0x08	</span><span class="cm">/* Status received              */</span><span class="cp"></span>
<span class="cp">#define TSS_MSG_SEND    0x40	</span><span class="cm">/* Message sent                 */</span><span class="cp"></span>
<span class="cp">#define TSS_CMD_PH_CMP  0x20	</span><span class="cm">/* command phase done              */</span><span class="cp"></span>
<span class="cp">#define TSS_DATA_PH_CMP 0x10	</span><span class="cm">/* Data phase done              */</span><span class="cp"></span>
<span class="cp">#define TSS_STATUS_SEND 0x08	</span><span class="cm">/* Status sent                  */</span><span class="cp"></span>
<span class="cp">#define TSS_XFER_CMP    0x04	</span><span class="cm">/* Transfer completed           */</span><span class="cp"></span>
<span class="cp">#define TSS_SEL_CMP     0x02	</span><span class="cm">/* Selection completed          */</span><span class="cp"></span>
<span class="cp">#define TSS_ARB_CMP     0x01	</span><span class="cm">/* Arbitration completed        */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Status 2 Register                      */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSS_CMD_ABTED   0x80	</span><span class="cm">/* Command aborted              */</span><span class="cp"></span>
<span class="cp">#define TSS_OFFSET_0    0x40	</span><span class="cm">/* Offset counter zero          */</span><span class="cp"></span>
<span class="cp">#define TSS_FIFO_FULL   0x20	</span><span class="cm">/* FIFO full                    */</span><span class="cp"></span>
<span class="cp">#define TSS_TIMEOUT_0   0x10	</span><span class="cm">/* Timeout counter zero         */</span><span class="cp"></span>
<span class="cp">#define TSS_BUSY_RLS    0x08	</span><span class="cm">/* Busy release                 */</span><span class="cp"></span>
<span class="cp">#define TSS_PH_MISMATCH 0x04	</span><span class="cm">/* Phase mismatch               */</span><span class="cp"></span>
<span class="cp">#define TSS_SCSI_BUS_EN 0x02	</span><span class="cm">/* SCSI data bus enable         */</span><span class="cp"></span>
<span class="cp">#define TSS_SCSIRST     0x01	</span><span class="cm">/* SCSI bus reset in progress   */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for Tulip SCSI Interrupt Register                     */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TSS_RESEL_INT   0x80	</span><span class="cm">/* Reselected interrupt         */</span><span class="cp"></span>
<span class="cp">#define TSS_SEL_TIMEOUT 0x40	</span><span class="cm">/* Selected/reselected timeout  */</span><span class="cp"></span>
<span class="cp">#define TSS_BUS_SERV    0x20</span>
<span class="cp">#define TSS_SCSIRST_INT 0x10	</span><span class="cm">/* SCSI bus reset detected      */</span><span class="cp"></span>
<span class="cp">#define TSS_DISC_INT    0x08	</span><span class="cm">/* Disconnected interrupt       */</span><span class="cp"></span>
<span class="cp">#define TSS_SEL_INT     0x04	</span><span class="cm">/* Select interrupt             */</span><span class="cp"></span>
<span class="cp">#define TSS_SCAM_SEL    0x02	</span><span class="cm">/* SCAM selected                */</span><span class="cp"></span>
<span class="cp">#define TSS_FUNC_COMP   0x01</span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* SCSI Phase Codes.                                                    */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define DATA_OUT        0</span>
<span class="cp">#define DATA_IN         1	</span><span class="cm">/* 4                            */</span><span class="cp"></span>
<span class="cp">#define CMD_OUT         2</span>
<span class="cp">#define STATUS_IN       3	</span><span class="cm">/* 6                            */</span><span class="cp"></span>
<span class="cp">#define MSG_OUT         6	</span><span class="cm">/* 3                            */</span><span class="cp"></span>
<span class="cp">#define MSG_IN          7</span>



<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* Command Codes of Tulip xfer Command register                         */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define TAX_X_FORC      0x02</span>
<span class="cp">#define TAX_X_ABT       0x04</span>
<span class="cp">#define TAX_X_CLR_FIFO  0x08</span>

<span class="cp">#define TAX_X_IN        0x21</span>
<span class="cp">#define TAX_X_OUT       0x01</span>
<span class="cp">#define TAX_SG_IN       0xA1</span>
<span class="cp">#define TAX_SG_OUT      0x81</span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* Tulip Interrupt Register                                             */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define XCMP            0x01</span>
<span class="cp">#define FCMP            0x02</span>
<span class="cp">#define XABT            0x04</span>
<span class="cp">#define XERR            0x08</span>
<span class="cp">#define SCMP            0x10</span>
<span class="cp">#define IPEND           0x80</span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* Tulip DMA Status Register                                            */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define XPEND           0x01	</span><span class="cm">/* Transfer pending             */</span><span class="cp"></span>
<span class="cp">#define FEMPTY          0x02	</span><span class="cm">/* FIFO empty                   */</span><span class="cp"></span>



<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for TUL_GCTRL                                         */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define EXTSG           0x80</span>
<span class="cp">#define EXTAD           0x60</span>
<span class="cp">#define SEG4K           0x08</span>
<span class="cp">#define EEPRG           0x04</span>
<span class="cp">#define MRMUL           0x02</span>

<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cm">/* bit definition for TUL_NVRAM                                         */</span>
<span class="cm">/*----------------------------------------------------------------------*/</span>
<span class="cp">#define SE2CS           0x08</span>
<span class="cp">#define SE2CLK          0x04</span>
<span class="cp">#define SE2DO           0x02</span>
<span class="cp">#define SE2DI           0x01</span>


<span class="cm">/************************************************************************/</span>
<span class="cm">/*              Scatter-Gather Element Structure                        */</span>
<span class="cm">/************************************************************************/</span>
<span class="k">struct</span> <span class="n">sg_entry</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>		<span class="cm">/* Data Pointer */</span>
	<span class="n">u32</span> <span class="n">len</span><span class="p">;</span>		<span class="cm">/* Data Length */</span>
<span class="p">};</span>

<span class="cm">/***********************************************************************</span>
<span class="cm">		SCSI Control Block</span>
<span class="cm">************************************************************************/</span>
<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">;</span>	<span class="cm">/*4 */</span>
	<span class="n">u8</span> <span class="n">next_state</span><span class="p">;</span>	<span class="cm">/*5 */</span>
	<span class="n">u8</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/*6 */</span>
	<span class="n">u8</span> <span class="n">msgin</span><span class="p">;</span>	<span class="cm">/*7 SCB_Res0 */</span>
	<span class="n">u16</span> <span class="n">sgidx</span><span class="p">;</span>	<span class="cm">/*8 */</span>
	<span class="n">u16</span> <span class="n">sgmax</span><span class="p">;</span>	<span class="cm">/*A */</span>
<span class="cp">#ifdef ALPHA</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/*C */</span>
<span class="cp">#else</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/*C */</span>
<span class="cp">#endif</span>

	<span class="n">u32</span> <span class="n">xferlen</span><span class="p">;</span>	<span class="cm">/*18 Current xfer len           */</span>
	<span class="n">u32</span> <span class="n">totxlen</span><span class="p">;</span>	<span class="cm">/*1C Total xfer len             */</span>
	<span class="n">u32</span> <span class="n">paddr</span><span class="p">;</span>		<span class="cm">/*20 SCB phy. Addr. */</span>

	<span class="n">u8</span> <span class="n">opcode</span><span class="p">;</span>	<span class="cm">/*24 SCB command code */</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>	<span class="cm">/*25 SCB Flags */</span>
	<span class="n">u8</span> <span class="n">target</span><span class="p">;</span>	<span class="cm">/*26 Target Id */</span>
	<span class="n">u8</span> <span class="n">lun</span><span class="p">;</span>		<span class="cm">/*27 Lun */</span>
	<span class="n">u32</span> <span class="n">bufptr</span><span class="p">;</span>		<span class="cm">/*28 Data Buffer Pointer */</span>
	<span class="n">u32</span> <span class="n">buflen</span><span class="p">;</span>		<span class="cm">/*2C Data Allocation Length */</span>
	<span class="n">u8</span> <span class="n">sglen</span><span class="p">;</span>	<span class="cm">/*30 SG list # */</span>
	<span class="n">u8</span> <span class="n">senselen</span><span class="p">;</span>	<span class="cm">/*31 Sense Allocation Length */</span>
	<span class="n">u8</span> <span class="n">hastat</span><span class="p">;</span>	<span class="cm">/*32 */</span>
	<span class="n">u8</span> <span class="n">tastat</span><span class="p">;</span>	<span class="cm">/*33 */</span>
	<span class="n">u8</span> <span class="n">cdblen</span><span class="p">;</span>	<span class="cm">/*34 CDB Length */</span>
	<span class="n">u8</span> <span class="n">ident</span><span class="p">;</span>	<span class="cm">/*35 Identify */</span>
	<span class="n">u8</span> <span class="n">tagmsg</span><span class="p">;</span>	<span class="cm">/*36 Tag Message */</span>
	<span class="n">u8</span> <span class="n">tagid</span><span class="p">;</span>	<span class="cm">/*37 Queue Tag */</span>
	<span class="n">u8</span> <span class="n">cdb</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	<span class="cm">/*38 */</span>
	<span class="n">u32</span> <span class="n">sgpaddr</span><span class="p">;</span>	<span class="cm">/*44 SG List/Sense Buf phy. Addr. */</span>
	<span class="n">u32</span> <span class="n">senseptr</span><span class="p">;</span>	<span class="cm">/*48 Sense data pointer */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">post</span><span class="p">)</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>	<span class="cm">/*4C POST routine */</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">srb</span><span class="p">;</span>	<span class="cm">/*50 SRB Pointer */</span>
	<span class="k">struct</span> <span class="n">sg_entry</span> <span class="n">sglist</span><span class="p">[</span><span class="n">TOTAL_SG_ENTRY</span><span class="p">];</span>	<span class="cm">/*54 Start of SG list */</span>
<span class="p">};</span>

<span class="cm">/* Bit Definition for status */</span>
<span class="cp">#define SCB_RENT        0x01</span>
<span class="cp">#define SCB_PEND        0x02</span>
<span class="cp">#define SCB_CONTIG      0x04	</span><span class="cm">/* Contingent Allegiance */</span><span class="cp"></span>
<span class="cp">#define SCB_SELECT      0x08</span>
<span class="cp">#define SCB_BUSY        0x10</span>
<span class="cp">#define SCB_DONE        0x20</span>


<span class="cm">/* Opcodes for opcode */</span>
<span class="cp">#define ExecSCSI        0x1</span>
<span class="cp">#define BusDevRst       0x2</span>
<span class="cp">#define AbortCmd        0x3</span>


<span class="cm">/* Bit Definition for mode */</span>
<span class="cp">#define SCM_RSENS       0x01	</span><span class="cm">/* request sense mode */</span><span class="cp"></span>


<span class="cm">/* Bit Definition for flags */</span>
<span class="cp">#define SCF_DONE        0x01</span>
<span class="cp">#define SCF_POST        0x02</span>
<span class="cp">#define SCF_SENSE       0x04</span>
<span class="cp">#define SCF_DIR         0x18</span>
<span class="cp">#define SCF_NO_DCHK     0x00</span>
<span class="cp">#define SCF_DIN         0x08</span>
<span class="cp">#define SCF_DOUT        0x10</span>
<span class="cp">#define SCF_NO_XF       0x18</span>
<span class="cp">#define SCF_WR_VF       0x20	</span><span class="cm">/* Write verify turn on         */</span><span class="cp"></span>
<span class="cp">#define SCF_POLL        0x40</span>
<span class="cp">#define SCF_SG          0x80</span>

<span class="cm">/* Error Codes for SCB_HaStat */</span>
<span class="cp">#define HOST_SEL_TOUT   0x11</span>
<span class="cp">#define HOST_DO_DU      0x12</span>
<span class="cp">#define HOST_BUS_FREE   0x13</span>
<span class="cp">#define HOST_BAD_PHAS   0x14</span>
<span class="cp">#define HOST_INV_CMD    0x16</span>
<span class="cp">#define HOST_ABORTED    0x1A	</span><span class="cm">/* 07/21/98 */</span><span class="cp"></span>
<span class="cp">#define HOST_SCSI_RST   0x1B</span>
<span class="cp">#define HOST_DEV_RST    0x1C</span>

<span class="cm">/* Error Codes for SCB_TaStat */</span>
<span class="cp">#define TARGET_CHKCOND  0x02</span>
<span class="cp">#define TARGET_BUSY     0x08</span>
<span class="cp">#define INI_QUEUE_FULL	0x28</span>

<span class="cm">/* SCSI MESSAGE */</span>
<span class="cp">#define MSG_COMP        0x00</span>
<span class="cp">#define MSG_EXTEND      0x01</span>
<span class="cp">#define MSG_SDP         0x02</span>
<span class="cp">#define MSG_RESTORE     0x03</span>
<span class="cp">#define MSG_DISC        0x04</span>
<span class="cp">#define MSG_IDE         0x05</span>
<span class="cp">#define MSG_ABORT       0x06</span>
<span class="cp">#define MSG_REJ         0x07</span>
<span class="cp">#define MSG_NOP         0x08</span>
<span class="cp">#define MSG_PARITY      0x09</span>
<span class="cp">#define MSG_LINK_COMP   0x0A</span>
<span class="cp">#define MSG_LINK_FLAG   0x0B</span>
<span class="cp">#define MSG_DEVRST      0x0C</span>
<span class="cp">#define MSG_ABORT_TAG   0x0D</span>

<span class="cm">/* Queue tag msg: Simple_quque_tag, Head_of_queue_tag, Ordered_queue_tag */</span>
<span class="cp">#define MSG_STAG        0x20</span>
<span class="cp">#define MSG_HTAG        0x21</span>
<span class="cp">#define MSG_OTAG        0x22</span>

<span class="cp">#define MSG_IGNOREWIDE  0x23</span>

<span class="cp">#define MSG_IDENT   0x80</span>

<span class="cm">/***********************************************************************</span>
<span class="cm">		Target Device Control Structure</span>
<span class="cm">**********************************************************************/</span>

<span class="k">struct</span> <span class="n">target_control</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">js_period</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sconfig0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">drv_flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">heads</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sectors</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/***********************************************************************</span>
<span class="cm">		Target Device Control Structure</span>
<span class="cm">**********************************************************************/</span>

<span class="cm">/* Bit Definition for TCF_Flags */</span>
<span class="cp">#define TCF_SCSI_RATE           0x0007</span>
<span class="cp">#define TCF_EN_DISC             0x0008</span>
<span class="cp">#define TCF_NO_SYNC_NEGO        0x0010</span>
<span class="cp">#define TCF_NO_WDTR             0x0020</span>
<span class="cp">#define TCF_EN_255              0x0040</span>
<span class="cp">#define TCF_EN_START            0x0080</span>
<span class="cp">#define TCF_WDTR_DONE           0x0100</span>
<span class="cp">#define TCF_SYNC_DONE           0x0200</span>
<span class="cp">#define TCF_BUSY                0x0400</span>


<span class="cm">/* Bit Definition for TCF_DrvFlags */</span>
<span class="cp">#define TCF_DRV_BUSY            0x01	</span><span class="cm">/* Indicate target busy(driver) */</span><span class="cp"></span>
<span class="cp">#define TCF_DRV_EN_TAG          0x0800</span>
<span class="cp">#define TCF_DRV_255_63          0x0400</span>

<span class="cm">/***********************************************************************</span>
<span class="cm">	      Host Adapter Control Structure</span>
<span class="cm">************************************************************************/</span>
<span class="k">struct</span> <span class="n">initio_host</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">addr</span><span class="p">;</span>		<span class="cm">/* 00 */</span>
	<span class="n">u16</span> <span class="n">bios_addr</span><span class="p">;</span>		<span class="cm">/* 02 */</span>
	<span class="n">u8</span> <span class="n">irq</span><span class="p">;</span>			<span class="cm">/* 04 */</span>
	<span class="n">u8</span> <span class="n">scsi_id</span><span class="p">;</span>		<span class="cm">/* 05 */</span>
	<span class="n">u8</span> <span class="n">max_tar</span><span class="p">;</span>		<span class="cm">/* 06 */</span>
	<span class="n">u8</span> <span class="n">num_scbs</span><span class="p">;</span>		<span class="cm">/* 07 */</span>

	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/* 08 */</span>
	<span class="n">u8</span> <span class="n">index</span><span class="p">;</span>		<span class="cm">/* 09 */</span>
	<span class="n">u8</span> <span class="n">ha_id</span><span class="p">;</span>		<span class="cm">/* 0A */</span>
	<span class="n">u8</span> <span class="n">config</span><span class="p">;</span>		<span class="cm">/* 0B */</span>
	<span class="n">u16</span> <span class="n">idmask</span><span class="p">;</span>		<span class="cm">/* 0C */</span>
	<span class="n">u8</span> <span class="n">semaph</span><span class="p">;</span>		<span class="cm">/* 0E */</span>
	<span class="n">u8</span> <span class="n">phase</span><span class="p">;</span>		<span class="cm">/* 0F */</span>
	<span class="n">u8</span> <span class="n">jsstatus0</span><span class="p">;</span>		<span class="cm">/* 10 */</span>
	<span class="n">u8</span> <span class="n">jsint</span><span class="p">;</span>		<span class="cm">/* 11 */</span>
	<span class="n">u8</span> <span class="n">jsstatus1</span><span class="p">;</span>		<span class="cm">/* 12 */</span>
	<span class="n">u8</span> <span class="n">sconf1</span><span class="p">;</span>		<span class="cm">/* 13 */</span>

	<span class="n">u8</span> <span class="n">msg</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>		<span class="cm">/* 14 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">next_avail</span><span class="p">;</span>	<span class="cm">/* 1C */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">scb</span><span class="p">;</span>		<span class="cm">/* 20 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">scb_end</span><span class="p">;</span>		<span class="cm">/* 24 */</span> <span class="cm">/*UNUSED*/</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">next_pending</span><span class="p">;</span>	<span class="cm">/* 28 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">next_contig</span><span class="p">;</span>	<span class="cm">/* 2C */</span> <span class="cm">/*UNUSED*/</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">active</span><span class="p">;</span>		<span class="cm">/* 30 */</span>
	<span class="k">struct</span> <span class="n">target_control</span> <span class="o">*</span><span class="n">active_tc</span><span class="p">;</span>	<span class="cm">/* 34 */</span>

	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">first_avail</span><span class="p">;</span>	<span class="cm">/* 38 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">last_avail</span><span class="p">;</span>	<span class="cm">/* 3C */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">first_pending</span><span class="p">;</span>	<span class="cm">/* 40 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">last_pending</span><span class="p">;</span>	<span class="cm">/* 44 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">first_busy</span><span class="p">;</span>	<span class="cm">/* 48 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">last_busy</span><span class="p">;</span>	<span class="cm">/* 4C */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">first_done</span><span class="p">;</span>	<span class="cm">/* 50 */</span>
	<span class="k">struct</span> <span class="n">scsi_ctrl_blk</span> <span class="o">*</span><span class="n">last_done</span><span class="p">;</span>	<span class="cm">/* 54 */</span>
	<span class="n">u8</span> <span class="n">max_tags</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* 58 */</span>
	<span class="n">u8</span> <span class="n">act_tags</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* 68 */</span>
	<span class="k">struct</span> <span class="n">target_control</span> <span class="n">targets</span><span class="p">[</span><span class="n">MAX_TARGETS</span><span class="p">];</span>	<span class="cm">/* 78 */</span>
	<span class="n">spinlock_t</span> <span class="n">avail_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">semaph_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Bit Definition for HCB_Config */</span>
<span class="cp">#define HCC_SCSI_RESET          0x01</span>
<span class="cp">#define HCC_EN_PAR              0x02</span>
<span class="cp">#define HCC_ACT_TERM1           0x04</span>
<span class="cp">#define HCC_ACT_TERM2           0x08</span>
<span class="cp">#define HCC_AUTO_TERM           0x10</span>
<span class="cp">#define HCC_EN_PWR              0x80</span>

<span class="cm">/* Bit Definition for HCB_Flags */</span>
<span class="cp">#define HCF_EXPECT_DISC         0x01</span>
<span class="cp">#define HCF_EXPECT_SELECT       0x02</span>
<span class="cp">#define HCF_EXPECT_RESET        0x10</span>
<span class="cp">#define HCF_EXPECT_DONE_DISC    0x20</span>

<span class="cm">/******************************************************************</span>
<span class="cm">	Serial EEProm</span>
<span class="cm">*******************************************************************/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_NVRAM_SCSI</span> <span class="p">{</span>	<span class="cm">/* SCSI channel configuration   */</span>
	<span class="n">u8</span> <span class="n">NVM_ChSCSIID</span><span class="p">;</span>	<span class="cm">/* 0Ch -&gt; Channel SCSI ID       */</span>
	<span class="n">u8</span> <span class="n">NVM_ChConfig1</span><span class="p">;</span>	<span class="cm">/* 0Dh -&gt; Channel config 1      */</span>
	<span class="n">u8</span> <span class="n">NVM_ChConfig2</span><span class="p">;</span>	<span class="cm">/* 0Eh -&gt; Channel config 2      */</span>
	<span class="n">u8</span> <span class="n">NVM_NumOfTarg</span><span class="p">;</span>	<span class="cm">/* 0Fh -&gt; Number of SCSI target */</span>
	<span class="cm">/* SCSI target configuration    */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ0Config</span><span class="p">;</span>	<span class="cm">/* 10h -&gt; Target 0 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ1Config</span><span class="p">;</span>	<span class="cm">/* 11h -&gt; Target 1 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ2Config</span><span class="p">;</span>	<span class="cm">/* 12h -&gt; Target 2 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ3Config</span><span class="p">;</span>	<span class="cm">/* 13h -&gt; Target 3 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ4Config</span><span class="p">;</span>	<span class="cm">/* 14h -&gt; Target 4 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ5Config</span><span class="p">;</span>	<span class="cm">/* 15h -&gt; Target 5 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ6Config</span><span class="p">;</span>	<span class="cm">/* 16h -&gt; Target 6 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ7Config</span><span class="p">;</span>	<span class="cm">/* 17h -&gt; Target 7 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ8Config</span><span class="p">;</span>	<span class="cm">/* 18h -&gt; Target 8 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_Targ9Config</span><span class="p">;</span>	<span class="cm">/* 19h -&gt; Target 9 configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargAConfig</span><span class="p">;</span>	<span class="cm">/* 1Ah -&gt; Target A configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargBConfig</span><span class="p">;</span>	<span class="cm">/* 1Bh -&gt; Target B configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargCConfig</span><span class="p">;</span>	<span class="cm">/* 1Ch -&gt; Target C configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargDConfig</span><span class="p">;</span>	<span class="cm">/* 1Dh -&gt; Target D configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargEConfig</span><span class="p">;</span>	<span class="cm">/* 1Eh -&gt; Target E configuration */</span>
	<span class="n">u8</span> <span class="n">NVM_TargFConfig</span><span class="p">;</span>	<span class="cm">/* 1Fh -&gt; Target F configuration */</span>
<span class="p">}</span> <span class="n">NVRAM_SCSI</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_NVRAM</span> <span class="p">{</span>
<span class="cm">/*----------header ---------------*/</span>
	<span class="n">u16</span> <span class="n">NVM_Signature</span><span class="p">;</span>	<span class="cm">/* 0,1: Signature */</span>
	<span class="n">u8</span> <span class="n">NVM_Size</span><span class="p">;</span>		<span class="cm">/* 2:   Size of data structure */</span>
	<span class="n">u8</span> <span class="n">NVM_Revision</span><span class="p">;</span>	<span class="cm">/* 3:   Revision of data structure */</span>
	<span class="cm">/* ----Host Adapter Structure ---- */</span>
	<span class="n">u8</span> <span class="n">NVM_ModelByte0</span><span class="p">;</span>	<span class="cm">/* 4:   Model number (byte 0) */</span>
	<span class="n">u8</span> <span class="n">NVM_ModelByte1</span><span class="p">;</span>	<span class="cm">/* 5:   Model number (byte 1) */</span>
	<span class="n">u8</span> <span class="n">NVM_ModelInfo</span><span class="p">;</span>	<span class="cm">/* 6:   Model information         */</span>
	<span class="n">u8</span> <span class="n">NVM_NumOfCh</span><span class="p">;</span>	<span class="cm">/* 7:   Number of SCSI channel */</span>
	<span class="n">u8</span> <span class="n">NVM_BIOSConfig1</span><span class="p">;</span>	<span class="cm">/* 8:   BIOS configuration 1  */</span>
	<span class="n">u8</span> <span class="n">NVM_BIOSConfig2</span><span class="p">;</span>	<span class="cm">/* 9:   BIOS configuration 2  */</span>
	<span class="n">u8</span> <span class="n">NVM_HAConfig1</span><span class="p">;</span>	<span class="cm">/* A:   Hoat adapter configuration 1 */</span>
	<span class="n">u8</span> <span class="n">NVM_HAConfig2</span><span class="p">;</span>	<span class="cm">/* B:   Hoat adapter configuration 2 */</span>
	<span class="n">NVRAM_SCSI</span> <span class="n">NVM_SCSIInfo</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">NVM_reserved</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="cm">/* ---------- CheckSum ----------       */</span>
	<span class="n">u16</span> <span class="n">NVM_CheckSum</span><span class="p">;</span>	<span class="cm">/* 0x3E, 0x3F: Checksum of NVRam        */</span>
<span class="p">}</span> <span class="n">NVRAM</span><span class="p">,</span> <span class="o">*</span><span class="n">PNVRAM</span><span class="p">;</span>

<span class="cm">/* Bios Configuration for nvram-&gt;BIOSConfig1                            */</span>
<span class="cp">#define NBC1_ENABLE             0x01	</span><span class="cm">/* BIOS enable                  */</span><span class="cp"></span>
<span class="cp">#define NBC1_8DRIVE             0x02	</span><span class="cm">/* Support more than 2 drives   */</span><span class="cp"></span>
<span class="cp">#define NBC1_REMOVABLE          0x04	</span><span class="cm">/* Support removable drive      */</span><span class="cp"></span>
<span class="cp">#define NBC1_INT19              0x08	</span><span class="cm">/* Intercept int 19h            */</span><span class="cp"></span>
<span class="cp">#define NBC1_BIOSSCAN           0x10	</span><span class="cm">/* Dynamic BIOS scan            */</span><span class="cp"></span>
<span class="cp">#define NBC1_LUNSUPPORT         0x40	</span><span class="cm">/* Support LUN                  */</span><span class="cp"></span>

<span class="cm">/* HA Configuration Byte 1                                              */</span>
<span class="cp">#define NHC1_BOOTIDMASK 0x0F	</span><span class="cm">/* Boot ID number               */</span><span class="cp"></span>
<span class="cp">#define NHC1_LUNMASK    0x70	</span><span class="cm">/* Boot LUN number              */</span><span class="cp"></span>
<span class="cp">#define NHC1_CHANMASK   0x80	</span><span class="cm">/* Boot Channel number          */</span><span class="cp"></span>

<span class="cm">/* Bit definition for nvram-&gt;SCSIconfig1                                */</span>
<span class="cp">#define NCC1_BUSRESET           0x01	</span><span class="cm">/* Reset SCSI bus at power up   */</span><span class="cp"></span>
<span class="cp">#define NCC1_PARITYCHK          0x02	</span><span class="cm">/* SCSI parity enable           */</span><span class="cp"></span>
<span class="cp">#define NCC1_ACTTERM1           0x04	</span><span class="cm">/* Enable active terminator 1   */</span><span class="cp"></span>
<span class="cp">#define NCC1_ACTTERM2           0x08	</span><span class="cm">/* Enable active terminator 2   */</span><span class="cp"></span>
<span class="cp">#define NCC1_AUTOTERM           0x10	</span><span class="cm">/* Enable auto terminator       */</span><span class="cp"></span>
<span class="cp">#define NCC1_PWRMGR             0x80	</span><span class="cm">/* Enable power management      */</span><span class="cp"></span>

<span class="cm">/* Bit definition for SCSI Target configuration byte                    */</span>
<span class="cp">#define NTC_DISCONNECT          0x08	</span><span class="cm">/* Enable SCSI disconnect       */</span><span class="cp"></span>
<span class="cp">#define NTC_SYNC                0x10	</span><span class="cm">/* SYNC_NEGO                    */</span><span class="cp"></span>
<span class="cp">#define NTC_NO_WDTR             0x20	</span><span class="cm">/* SYNC_NEGO                    */</span><span class="cp"></span>
<span class="cp">#define NTC_1GIGA               0x40	</span><span class="cm">/* 255 head / 63 sectors (64/32) */</span><span class="cp"></span>
<span class="cp">#define NTC_SPINUP              0x80	</span><span class="cm">/* Start disk drive             */</span><span class="cp"></span>

<span class="cm">/*      Default NVRam values                                            */</span>
<span class="cp">#define INI_SIGNATURE           0xC925</span>
<span class="cp">#define NBC1_DEFAULT            (NBC1_ENABLE)</span>
<span class="cp">#define NCC1_DEFAULT            (NCC1_BUSRESET | NCC1_AUTOTERM | NCC1_PARITYCHK)</span>
<span class="cp">#define NTC_DEFAULT             (NTC_NO_WDTR | NTC_1GIGA | NTC_DISCONNECT)</span>

<span class="cm">/* SCSI related definition                                              */</span>
<span class="cp">#define DISC_NOT_ALLOW          0x80	</span><span class="cm">/* Disconnect is not allowed    */</span><span class="cp"></span>
<span class="cp">#define DISC_ALLOW              0xC0	</span><span class="cm">/* Disconnect is allowed        */</span><span class="cp"></span>
<span class="cp">#define SCSICMD_RequestSense    0x03</span>

<span class="cp">#define SCSI_ABORT_SNOOZE 0</span>
<span class="cp">#define SCSI_ABORT_SUCCESS 1</span>
<span class="cp">#define SCSI_ABORT_PENDING 2</span>
<span class="cp">#define SCSI_ABORT_BUSY 3</span>
<span class="cp">#define SCSI_ABORT_NOT_RUNNING 4</span>
<span class="cp">#define SCSI_ABORT_ERROR 5</span>

<span class="cp">#define SCSI_RESET_SNOOZE 0</span>
<span class="cp">#define SCSI_RESET_PUNT 1</span>
<span class="cp">#define SCSI_RESET_SUCCESS 2</span>
<span class="cp">#define SCSI_RESET_PENDING 3</span>
<span class="cp">#define SCSI_RESET_WAKEUP 4</span>
<span class="cp">#define SCSI_RESET_NOT_RUNNING 5</span>
<span class="cp">#define SCSI_RESET_ERROR 6</span>

<span class="cp">#define SCSI_RESET_SYNCHRONOUS		0x01</span>
<span class="cp">#define SCSI_RESET_ASYNCHRONOUS		0x02</span>
<span class="cp">#define SCSI_RESET_SUGGEST_BUS_RESET	0x04</span>
<span class="cp">#define SCSI_RESET_SUGGEST_HOST_RESET	0x08</span>

<span class="cp">#define SCSI_RESET_BUS_RESET 0x100</span>
<span class="cp">#define SCSI_RESET_HOST_RESET 0x200</span>
<span class="cp">#define SCSI_RESET_ACTION   0xff</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
