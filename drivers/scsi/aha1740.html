<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › aha1740.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>aha1740.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _AHA1740_H</span>

<span class="cm">/* $Id$</span>
<span class="cm"> *</span>
<span class="cm"> * Header file for the adaptec 1740 driver for Linux</span>
<span class="cm"> *</span>
<span class="cm"> * With minor revisions 3/31/93</span>
<span class="cm"> * Written and (C) 1992,1993 Brad McLean.  See aha1740.c</span>
<span class="cm"> * for more info</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define SLOTSIZE	0x5c</span>

<span class="cm">/* EISA configuration registers &amp; values */</span>
<span class="cp">#define	HID0(base)	(base + 0x0)</span>
<span class="cp">#define	HID1(base)	(base + 0x1)</span>
<span class="cp">#define HID2(base)	(base + 0x2)</span>
<span class="cp">#define	HID3(base)	(base + 0x3)</span>
<span class="cp">#define	EBCNTRL(base)	(base + 0x4)</span>
<span class="cp">#define	PORTADR(base)	(base + 0x40)</span>
<span class="cp">#define BIOSADR(base)	(base + 0x41)</span>
<span class="cp">#define INTDEF(base)	(base + 0x42)</span>
<span class="cp">#define SCSIDEF(base)	(base + 0x43)</span>
<span class="cp">#define BUSDEF(base)	(base + 0x44)</span>
<span class="cp">#define	RESV0(base)	(base + 0x45)</span>
<span class="cp">#define RESV1(base)	(base + 0x46)</span>
<span class="cp">#define	RESV2(base)	(base + 0x47)</span>

<span class="cp">#define	HID_MFG	&quot;ADP&quot;</span>
<span class="cp">#define	HID_PRD 0</span>
<span class="cp">#define HID_REV 2</span>
<span class="cp">#define EBCNTRL_VALUE 1</span>
<span class="cp">#define PORTADDR_ENH 0x80</span>
<span class="cm">/* READ */</span>
<span class="cp">#define	G2INTST(base)	(base + 0x56)</span>
<span class="cp">#define G2STAT(base)	(base + 0x57)</span>
<span class="cp">#define	MBOXIN0(base)	(base + 0x58)</span>
<span class="cp">#define	MBOXIN1(base)	(base + 0x59)</span>
<span class="cp">#define	MBOXIN2(base)	(base + 0x5a)</span>
<span class="cp">#define	MBOXIN3(base)	(base + 0x5b)</span>
<span class="cp">#define G2STAT2(base)	(base + 0x5c)</span>

<span class="cp">#define G2INTST_MASK		0xf0	</span><span class="cm">/* isolate the status */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_CCBGOOD		0x10	</span><span class="cm">/* CCB Completed */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_CCBRETRY	0x50	</span><span class="cm">/* CCB Completed with a retry */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_HARDFAIL	0x70	</span><span class="cm">/* Adapter Hardware Failure */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_CMDGOOD		0xa0	</span><span class="cm">/* Immediate command success */</span><span class="cp"></span>
<span class="cp">#define G2INTST_CCBERROR	0xc0	</span><span class="cm">/* CCB Completed with error */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_ASNEVENT	0xd0	</span><span class="cm">/* Asynchronous Event Notification */</span><span class="cp"></span>
<span class="cp">#define	G2INTST_CMDERROR	0xe0	</span><span class="cm">/* Immediate command error */</span><span class="cp"></span>

<span class="cp">#define G2STAT_MBXOUT	4	</span><span class="cm">/* Mailbox Out Empty Bit */</span><span class="cp"></span>
<span class="cp">#define	G2STAT_INTPEND	2	</span><span class="cm">/* Interrupt Pending Bit */</span><span class="cp"></span>
<span class="cp">#define	G2STAT_BUSY	1	</span><span class="cm">/* Busy Bit (attention pending) */</span><span class="cp"></span>

<span class="cp">#define G2STAT2_READY	0	</span><span class="cm">/* Host Ready Bit */</span><span class="cp"></span>

<span class="cm">/* WRITE (and ReadBack) */</span>
<span class="cp">#define	MBOXOUT0(base)	(base + 0x50)</span>
<span class="cp">#define	MBOXOUT1(base)	(base + 0x51)</span>
<span class="cp">#define	MBOXOUT2(base)	(base + 0x52)</span>
<span class="cp">#define	MBOXOUT3(base)	(base + 0x53)</span>
<span class="cp">#define	ATTN(base)	(base + 0x54)</span>
<span class="cp">#define G2CNTRL(base)	(base + 0x55)</span>

<span class="cp">#define	ATTN_IMMED	0x10	</span><span class="cm">/* Immediate Command */</span><span class="cp"></span>
<span class="cp">#define	ATTN_START	0x40	</span><span class="cm">/* Start CCB */</span><span class="cp"></span>
<span class="cp">#define	ATTN_ABORT	0x50	</span><span class="cm">/* Abort CCB */</span><span class="cp"></span>

<span class="cp">#define G2CNTRL_HRST	0x80	</span><span class="cm">/* Hard Reset */</span><span class="cp"></span>
<span class="cp">#define G2CNTRL_IRST	0x40	</span><span class="cm">/* Clear EISA Interrupt */</span><span class="cp"></span>
<span class="cp">#define G2CNTRL_HRDY	0x20	</span><span class="cm">/* Sets HOST ready */</span><span class="cp"></span>

<span class="cm">/* This is used with scatter-gather */</span>
<span class="k">struct</span> <span class="n">aha1740_chain</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">dataptr</span><span class="p">;</span>		<span class="cm">/* Location of data */</span>
	<span class="n">u32</span> <span class="n">datalen</span><span class="p">;</span>		<span class="cm">/* Size of this part of chain */</span>
<span class="p">};</span>

<span class="cm">/* These belong in scsi.h */</span>
<span class="cp">#define any2scsi(up, p)				\</span>
<span class="cp">(up)[0] = (((unsigned long)(p)) &gt;&gt; 16)  ;	\</span>
<span class="cp">(up)[1] = (((unsigned long)(p)) &gt;&gt; 8);		\</span>
<span class="cp">(up)[2] = ((unsigned long)(p));</span>

<span class="cp">#define scsi2int(up) ( (((long)*(up)) &lt;&lt; 16) + (((long)(up)[1]) &lt;&lt; 8) + ((long)(up)[2]) )</span>

<span class="cp">#define xany2scsi(up, p)	\</span>
<span class="cp">(up)[0] = ((long)(p)) &gt;&gt; 24;	\</span>
<span class="cp">(up)[1] = ((long)(p)) &gt;&gt; 16;	\</span>
<span class="cp">(up)[2] = ((long)(p)) &gt;&gt; 8;	\</span>
<span class="cp">(up)[3] = ((long)(p));</span>

<span class="cp">#define xscsi2int(up) ( (((long)(up)[0]) &lt;&lt; 24) + (((long)(up)[1]) &lt;&lt; 16) \</span>
<span class="cp">		      + (((long)(up)[2]) &lt;&lt;  8) +  ((long)(up)[3]) )</span>

<span class="cp">#define MAX_CDB 12</span>
<span class="cp">#define MAX_SENSE 14</span>
<span class="cp">#define MAX_STATUS 32</span>

<span class="k">struct</span> <span class="n">ecb</span> <span class="p">{</span>			<span class="cm">/* Enhanced Control Block 6.1 */</span>
	<span class="n">u16</span> <span class="n">cmdw</span><span class="p">;</span>		<span class="cm">/* Command Word */</span>
	<span class="cm">/* Flag Word 1 */</span>
	<span class="n">u16</span> <span class="n">cne</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Control Block Chaining */</span>
	<span class="o">:</span><span class="mi">6</span><span class="p">,</span> <span class="n">di</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Disable Interrupt */</span>
	<span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">ses</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Suppress Underrun error */</span>
	<span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">sg</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Scatter/Gather */</span>
	<span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">dsb</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Disable Status Block */</span>
	 <span class="nl">ars:</span><span class="mi">1</span><span class="p">;</span>			<span class="cm">/* Automatic Request Sense */</span>
	<span class="cm">/* Flag Word 2 */</span>
	<span class="n">u16</span> <span class="n">lun</span><span class="o">:</span><span class="mi">3</span><span class="p">,</span>		<span class="cm">/* Logical Unit */</span>
	 <span class="nl">tag:</span><span class="mi">1</span><span class="p">,</span>			<span class="cm">/* Tagged Queuing */</span>
	 <span class="nl">tt:</span><span class="mi">2</span><span class="p">,</span>			<span class="cm">/* Tag Type */</span>
	 <span class="nl">nd:</span><span class="mi">1</span><span class="p">,</span>			<span class="cm">/* No Disconnect */</span>
	<span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="n">dat</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Data transfer - check direction */</span>
	 <span class="nl">dir:</span><span class="mi">1</span><span class="p">,</span>			<span class="cm">/* Direction of transfer 1 = datain */</span>
	 <span class="nl">st:</span><span class="mi">1</span><span class="p">,</span>			<span class="cm">/* Suppress Transfer */</span>
	 <span class="nl">chk:</span><span class="mi">1</span><span class="p">,</span>			<span class="cm">/* Calculate Checksum */</span>
	<span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="n">rec</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Error Recovery */</span>
	<span class="n">u16</span> <span class="n">nil0</span><span class="p">;</span>		<span class="cm">/* nothing */</span>
	<span class="n">u32</span> <span class="n">dataptr</span><span class="p">;</span>		<span class="cm">/* Data or Scatter List ptr */</span>
	<span class="n">u32</span> <span class="n">datalen</span><span class="p">;</span>		<span class="cm">/* Data or Scatter List len */</span>
	<span class="n">u32</span> <span class="n">statusptr</span><span class="p">;</span>		<span class="cm">/* Status Block ptr */</span>
	<span class="n">u32</span> <span class="n">linkptr</span><span class="p">;</span>		<span class="cm">/* Chain Address */</span>
	<span class="n">u32</span> <span class="n">nil1</span><span class="p">;</span>		<span class="cm">/* nothing */</span>
	<span class="n">u32</span> <span class="n">senseptr</span><span class="p">;</span>		<span class="cm">/* Sense Info Pointer */</span>
	<span class="n">u8</span> <span class="n">senselen</span><span class="p">;</span>		<span class="cm">/* Sense Length */</span>
	<span class="n">u8</span> <span class="n">cdblen</span><span class="p">;</span>		<span class="cm">/* CDB Length */</span>
	<span class="n">u16</span> <span class="n">datacheck</span><span class="p">;</span>		<span class="cm">/* Data checksum */</span>
	<span class="n">u8</span> <span class="n">cdb</span><span class="p">[</span><span class="n">MAX_CDB</span><span class="p">];</span>	<span class="cm">/* CDB area */</span>
<span class="cm">/* Hardware defined portion ends here, rest is driver defined */</span>
	<span class="n">u8</span> <span class="n">sense</span><span class="p">[</span><span class="n">MAX_SENSE</span><span class="p">];</span>	<span class="cm">/* Sense area */</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">[</span><span class="n">MAX_STATUS</span><span class="p">];</span>	<span class="cm">/* Status area */</span>
	<span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="n">SCpnt</span><span class="p">;</span>	<span class="cm">/* Link to the SCSI Command Block */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">done</span><span class="p">)</span> <span class="p">(</span><span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="p">);</span>	<span class="cm">/* Completion Function */</span>
<span class="p">};</span>

<span class="cp">#define	AHA1740CMD_NOP	 0x00	</span><span class="cm">/* No OP */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_INIT	 0x01	</span><span class="cm">/* Initiator SCSI Command */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_DIAG	 0x05	</span><span class="cm">/* Run Diagnostic Command */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_SCSI	 0x06	</span><span class="cm">/* Initialize SCSI */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_SENSE 0x08	</span><span class="cm">/* Read Sense Information */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_DOWN  0x09	</span><span class="cm">/* Download Firmware (yeah, I bet!) */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_RINQ  0x0a	</span><span class="cm">/* Read Host Adapter Inquiry Data */</span><span class="cp"></span>
<span class="cp">#define AHA1740CMD_TARG  0x10	</span><span class="cm">/* Target SCSI Command */</span><span class="cp"></span>

<span class="cp">#define AHA1740_ECBS 32</span>
<span class="cp">#define AHA1740_SCATTER 16</span>
<span class="cp">#define AHA1740_CMDLUN 1</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
