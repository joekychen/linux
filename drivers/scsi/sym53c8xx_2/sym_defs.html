<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › sym53c8xx_2 › sym_defs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sym_defs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Device driver for the SYMBIOS/LSILOGIC 53C8XX and 53C1010 family </span>
<span class="cm"> * of PCI-SCSI IO processors.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1999-2001  Gerard Roudier &lt;groudier@free.fr&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This driver is derived from the Linux sym53c8xx driver.</span>
<span class="cm"> * Copyright (C) 1998-2000  Gerard Roudier</span>
<span class="cm"> *</span>
<span class="cm"> * The sym53c8xx driver is derived from the ncr53c8xx driver that had been </span>
<span class="cm"> * a port of the FreeBSD ncr driver to Linux-1.2.13.</span>
<span class="cm"> *</span>
<span class="cm"> * The original ncr driver has been written for 386bsd and FreeBSD by</span>
<span class="cm"> *         Wolfgang Stanglmeier        &lt;wolf@cologne.de&gt;</span>
<span class="cm"> *         Stefan Esser                &lt;se@mi.Uni-Koeln.de&gt;</span>
<span class="cm"> * Copyright (C) 1994  Wolfgang Stanglmeier</span>
<span class="cm"> *</span>
<span class="cm"> * Other major contributions:</span>
<span class="cm"> *</span>
<span class="cm"> * NVRAM detection and reading.</span>
<span class="cm"> * Copyright (C) 1997 Richard Waltham &lt;dormouse@farsrobt.demon.co.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> */</span>

<span class="cp">#ifndef SYM_DEFS_H</span>
<span class="cp">#define SYM_DEFS_H</span>

<span class="cp">#define SYM_VERSION &quot;2.2.3&quot;</span>
<span class="cp">#define SYM_DRIVER_NAME	&quot;sym-&quot; SYM_VERSION</span>

<span class="cm">/*</span>
<span class="cm"> *	SYM53C8XX device features descriptor.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sym_chip</span> <span class="p">{</span>
	<span class="n">u_short</span>	<span class="n">device_id</span><span class="p">;</span>
	<span class="n">u_short</span>	<span class="n">revision_id</span><span class="p">;</span>
	<span class="kt">char</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u_char</span>	<span class="n">burst_max</span><span class="p">;</span>	<span class="cm">/* log-base-2 of max burst */</span>
	<span class="n">u_char</span>	<span class="n">offset_max</span><span class="p">;</span>
	<span class="n">u_char</span>	<span class="n">nr_divisor</span><span class="p">;</span>
	<span class="n">u_char</span>	<span class="n">lp_probe_bit</span><span class="p">;</span>
	<span class="n">u_int</span>	<span class="n">features</span><span class="p">;</span>
<span class="cp">#define FE_LED0		(1&lt;&lt;0)</span>
<span class="cp">#define FE_WIDE		(1&lt;&lt;1)    </span><span class="cm">/* Wide data transfers */</span><span class="cp"></span>
<span class="cp">#define FE_ULTRA	(1&lt;&lt;2)	  </span><span class="cm">/* Ultra speed 20Mtrans/sec */</span><span class="cp"></span>
<span class="cp">#define FE_ULTRA2	(1&lt;&lt;3)	  </span><span class="cm">/* Ultra 2 - 40 Mtrans/sec */</span><span class="cp"></span>
<span class="cp">#define FE_DBLR		(1&lt;&lt;4)	  </span><span class="cm">/* Clock doubler present */</span><span class="cp"></span>
<span class="cp">#define FE_QUAD		(1&lt;&lt;5)	  </span><span class="cm">/* Clock quadrupler present */</span><span class="cp"></span>
<span class="cp">#define FE_ERL		(1&lt;&lt;6)    </span><span class="cm">/* Enable read line */</span><span class="cp"></span>
<span class="cp">#define FE_CLSE		(1&lt;&lt;7)    </span><span class="cm">/* Cache line size enable */</span><span class="cp"></span>
<span class="cp">#define FE_WRIE		(1&lt;&lt;8)    </span><span class="cm">/* Write &amp; Invalidate enable */</span><span class="cp"></span>
<span class="cp">#define FE_ERMP		(1&lt;&lt;9)    </span><span class="cm">/* Enable read multiple */</span><span class="cp"></span>
<span class="cp">#define FE_BOF		(1&lt;&lt;10)   </span><span class="cm">/* Burst opcode fetch */</span><span class="cp"></span>
<span class="cp">#define FE_DFS		(1&lt;&lt;11)   </span><span class="cm">/* DMA fifo size */</span><span class="cp"></span>
<span class="cp">#define FE_PFEN		(1&lt;&lt;12)   </span><span class="cm">/* Prefetch enable */</span><span class="cp"></span>
<span class="cp">#define FE_LDSTR	(1&lt;&lt;13)   </span><span class="cm">/* Load/Store supported */</span><span class="cp"></span>
<span class="cp">#define FE_RAM		(1&lt;&lt;14)   </span><span class="cm">/* On chip RAM present */</span><span class="cp"></span>
<span class="cp">#define FE_VARCLK	(1&lt;&lt;15)   </span><span class="cm">/* Clock frequency may vary */</span><span class="cp"></span>
<span class="cp">#define FE_RAM8K	(1&lt;&lt;16)   </span><span class="cm">/* On chip RAM sized 8Kb */</span><span class="cp"></span>
<span class="cp">#define FE_64BIT	(1&lt;&lt;17)   </span><span class="cm">/* 64-bit PCI BUS interface */</span><span class="cp"></span>
<span class="cp">#define FE_IO256	(1&lt;&lt;18)   </span><span class="cm">/* Requires full 256 bytes in PCI space */</span><span class="cp"></span>
<span class="cp">#define FE_NOPM		(1&lt;&lt;19)   </span><span class="cm">/* Scripts handles phase mismatch */</span><span class="cp"></span>
<span class="cp">#define FE_LEDC		(1&lt;&lt;20)   </span><span class="cm">/* Hardware control of LED */</span><span class="cp"></span>
<span class="cp">#define FE_ULTRA3	(1&lt;&lt;21)	  </span><span class="cm">/* Ultra 3 - 80 Mtrans/sec DT */</span><span class="cp"></span>
<span class="cp">#define FE_66MHZ	(1&lt;&lt;22)	  </span><span class="cm">/* 66MHz PCI support */</span><span class="cp"></span>
<span class="cp">#define FE_CRC		(1&lt;&lt;23)	  </span><span class="cm">/* CRC support */</span><span class="cp"></span>
<span class="cp">#define FE_DIFF		(1&lt;&lt;24)	  </span><span class="cm">/* SCSI HVD support */</span><span class="cp"></span>
<span class="cp">#define FE_DFBC		(1&lt;&lt;25)	  </span><span class="cm">/* Have DFBC register */</span><span class="cp"></span>
<span class="cp">#define FE_LCKFRQ	(1&lt;&lt;26)	  </span><span class="cm">/* Have LCKFRQ */</span><span class="cp"></span>
<span class="cp">#define FE_C10		(1&lt;&lt;27)	  </span><span class="cm">/* Various C10 core (mis)features */</span><span class="cp"></span>
<span class="cp">#define FE_U3EN		(1&lt;&lt;28)	  </span><span class="cm">/* U3EN bit usable */</span><span class="cp"></span>
<span class="cp">#define FE_DAC		(1&lt;&lt;29)	  </span><span class="cm">/* Support PCI DAC (64 bit addressing) */</span><span class="cp"></span>
<span class="cp">#define FE_ISTAT1 	(1&lt;&lt;30)   </span><span class="cm">/* Have ISTAT1, MBOX0, MBOX1 registers */</span><span class="cp"></span>

<span class="cp">#define FE_CACHE_SET	(FE_ERL|FE_CLSE|FE_WRIE|FE_ERMP)</span>
<span class="cp">#define FE_CACHE0_SET	(FE_CACHE_SET &amp; ~FE_ERL)</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	SYM53C8XX IO register data structure.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sym_reg</span> <span class="p">{</span>
<span class="cm">/*00*/</span>  <span class="n">u8</span>	<span class="n">nc_scntl0</span><span class="p">;</span>	<span class="cm">/* full arb., ena parity, par-&gt;ATN  */</span>

<span class="cm">/*01*/</span>  <span class="n">u8</span>	<span class="n">nc_scntl1</span><span class="p">;</span>	<span class="cm">/* no reset                         */</span>
        <span class="cp">#define   ISCON   0x10  </span><span class="cm">/* connected to scsi		    */</span><span class="cp"></span>
        <span class="cp">#define   CRST    0x08  </span><span class="cm">/* force reset                      */</span><span class="cp"></span>
        <span class="cp">#define   IARB    0x02  </span><span class="cm">/* immediate arbitration            */</span><span class="cp"></span>

<span class="cm">/*02*/</span>  <span class="n">u8</span>	<span class="n">nc_scntl2</span><span class="p">;</span>	<span class="cm">/* no disconnect expected           */</span>
	<span class="cp">#define   SDU     0x80  </span><span class="cm">/* cmd: disconnect will raise error */</span><span class="cp"></span>
	<span class="cp">#define   CHM     0x40  </span><span class="cm">/* sta: chained mode                */</span><span class="cp"></span>
	<span class="cp">#define   WSS     0x08  </span><span class="cm">/* sta: wide scsi send           [W]*/</span><span class="cp"></span>
	<span class="cp">#define   WSR     0x01  </span><span class="cm">/* sta: wide scsi received       [W]*/</span><span class="cp"></span>

<span class="cm">/*03*/</span>  <span class="n">u8</span>	<span class="n">nc_scntl3</span><span class="p">;</span>	<span class="cm">/* cnf system clock dependent       */</span>
	<span class="cp">#define   EWS     0x08  </span><span class="cm">/* cmd: enable wide scsi         [W]*/</span><span class="cp"></span>
	<span class="cp">#define   ULTRA   0x80  </span><span class="cm">/* cmd: ULTRA enable                */</span><span class="cp"></span>
				<span class="cm">/* bits 0-2, 7 rsvd for C1010       */</span>

<span class="cm">/*04*/</span>  <span class="n">u8</span>	<span class="n">nc_scid</span><span class="p">;</span>	<span class="cm">/* cnf host adapter scsi address    */</span>
	<span class="cp">#define   RRE     0x40  </span><span class="cm">/* r/w:e enable response to resel.  */</span><span class="cp"></span>
	<span class="cp">#define   SRE     0x20  </span><span class="cm">/* r/w:e enable response to select  */</span><span class="cp"></span>

<span class="cm">/*05*/</span>  <span class="n">u8</span>	<span class="n">nc_sxfer</span><span class="p">;</span>	<span class="cm">/* ### Sync speed and count         */</span>
				<span class="cm">/* bits 6-7 rsvd for C1010          */</span>

<span class="cm">/*06*/</span>  <span class="n">u8</span>	<span class="n">nc_sdid</span><span class="p">;</span>	<span class="cm">/* ### Destination-ID               */</span>

<span class="cm">/*07*/</span>  <span class="n">u8</span>	<span class="n">nc_gpreg</span><span class="p">;</span>	<span class="cm">/* ??? IO-Pins                      */</span>

<span class="cm">/*08*/</span>  <span class="n">u8</span>	<span class="n">nc_sfbr</span><span class="p">;</span>	<span class="cm">/* ### First byte received          */</span>

<span class="cm">/*09*/</span>  <span class="n">u8</span>	<span class="n">nc_socl</span><span class="p">;</span>
	<span class="cp">#define   CREQ	  0x80	</span><span class="cm">/* r/w: SCSI-REQ                    */</span><span class="cp"></span>
	<span class="cp">#define   CACK	  0x40	</span><span class="cm">/* r/w: SCSI-ACK                    */</span><span class="cp"></span>
	<span class="cp">#define   CBSY	  0x20	</span><span class="cm">/* r/w: SCSI-BSY                    */</span><span class="cp"></span>
	<span class="cp">#define   CSEL	  0x10	</span><span class="cm">/* r/w: SCSI-SEL                    */</span><span class="cp"></span>
	<span class="cp">#define   CATN	  0x08	</span><span class="cm">/* r/w: SCSI-ATN                    */</span><span class="cp"></span>
	<span class="cp">#define   CMSG	  0x04	</span><span class="cm">/* r/w: SCSI-MSG                    */</span><span class="cp"></span>
	<span class="cp">#define   CC_D	  0x02	</span><span class="cm">/* r/w: SCSI-C_D                    */</span><span class="cp"></span>
	<span class="cp">#define   CI_O	  0x01	</span><span class="cm">/* r/w: SCSI-I_O                    */</span><span class="cp"></span>

<span class="cm">/*0a*/</span>  <span class="n">u8</span>	<span class="n">nc_ssid</span><span class="p">;</span>

<span class="cm">/*0b*/</span>  <span class="n">u8</span>	<span class="n">nc_sbcl</span><span class="p">;</span>

<span class="cm">/*0c*/</span>  <span class="n">u8</span>	<span class="n">nc_dstat</span><span class="p">;</span>
        <span class="cp">#define   DFE     0x80  </span><span class="cm">/* sta: dma fifo empty              */</span><span class="cp"></span>
        <span class="cp">#define   MDPE    0x40  </span><span class="cm">/* int: master data parity error    */</span><span class="cp"></span>
        <span class="cp">#define   BF      0x20  </span><span class="cm">/* int: script: bus fault           */</span><span class="cp"></span>
        <span class="cp">#define   ABRT    0x10  </span><span class="cm">/* int: script: command aborted     */</span><span class="cp"></span>
        <span class="cp">#define   SSI     0x08  </span><span class="cm">/* int: script: single step         */</span><span class="cp"></span>
        <span class="cp">#define   SIR     0x04  </span><span class="cm">/* int: script: interrupt instruct. */</span><span class="cp"></span>
        <span class="cp">#define   IID     0x01  </span><span class="cm">/* int: script: illegal instruct.   */</span><span class="cp"></span>

<span class="cm">/*0d*/</span>  <span class="n">u8</span>	<span class="n">nc_sstat0</span><span class="p">;</span>
        <span class="cp">#define   ILF     0x80  </span><span class="cm">/* sta: data in SIDL register lsb   */</span><span class="cp"></span>
        <span class="cp">#define   ORF     0x40  </span><span class="cm">/* sta: data in SODR register lsb   */</span><span class="cp"></span>
        <span class="cp">#define   OLF     0x20  </span><span class="cm">/* sta: data in SODL register lsb   */</span><span class="cp"></span>
        <span class="cp">#define   AIP     0x10  </span><span class="cm">/* sta: arbitration in progress     */</span><span class="cp"></span>
        <span class="cp">#define   LOA     0x08  </span><span class="cm">/* sta: arbitration lost            */</span><span class="cp"></span>
        <span class="cp">#define   WOA     0x04  </span><span class="cm">/* sta: arbitration won             */</span><span class="cp"></span>
        <span class="cp">#define   IRST    0x02  </span><span class="cm">/* sta: scsi reset signal           */</span><span class="cp"></span>
        <span class="cp">#define   SDP     0x01  </span><span class="cm">/* sta: scsi parity signal          */</span><span class="cp"></span>

<span class="cm">/*0e*/</span>  <span class="n">u8</span>	<span class="n">nc_sstat1</span><span class="p">;</span>
	<span class="cp">#define   FF3210  0xf0	</span><span class="cm">/* sta: bytes in the scsi fifo      */</span><span class="cp"></span>

<span class="cm">/*0f*/</span>  <span class="n">u8</span>	<span class="n">nc_sstat2</span><span class="p">;</span>
        <span class="cp">#define   ILF1    0x80  </span><span class="cm">/* sta: data in SIDL register msb[W]*/</span><span class="cp"></span>
        <span class="cp">#define   ORF1    0x40  </span><span class="cm">/* sta: data in SODR register msb[W]*/</span><span class="cp"></span>
        <span class="cp">#define   OLF1    0x20  </span><span class="cm">/* sta: data in SODL register msb[W]*/</span><span class="cp"></span>
        <span class="cp">#define   DM      0x04  </span><span class="cm">/* sta: DIFFSENS mismatch (895/6 only) */</span><span class="cp"></span>
        <span class="cp">#define   LDSC    0x02  </span><span class="cm">/* sta: disconnect &amp; reconnect      */</span><span class="cp"></span>

<span class="cm">/*10*/</span>  <span class="n">u8</span>	<span class="n">nc_dsa</span><span class="p">;</span>		<span class="cm">/* --&gt; Base page                    */</span>
<span class="cm">/*11*/</span>  <span class="n">u8</span>	<span class="n">nc_dsa1</span><span class="p">;</span>
<span class="cm">/*12*/</span>  <span class="n">u8</span>	<span class="n">nc_dsa2</span><span class="p">;</span>
<span class="cm">/*13*/</span>  <span class="n">u8</span>	<span class="n">nc_dsa3</span><span class="p">;</span>

<span class="cm">/*14*/</span>  <span class="n">u8</span>	<span class="n">nc_istat</span><span class="p">;</span>	<span class="cm">/* --&gt; Main Command and status      */</span>
        <span class="cp">#define   CABRT   0x80  </span><span class="cm">/* cmd: abort current operation     */</span><span class="cp"></span>
        <span class="cp">#define   SRST    0x40  </span><span class="cm">/* mod: reset chip                  */</span><span class="cp"></span>
        <span class="cp">#define   SIGP    0x20  </span><span class="cm">/* r/w: message from host to script */</span><span class="cp"></span>
        <span class="cp">#define   SEM     0x10  </span><span class="cm">/* r/w: message between host + script  */</span><span class="cp"></span>
        <span class="cp">#define   CON     0x08  </span><span class="cm">/* sta: connected to scsi           */</span><span class="cp"></span>
        <span class="cp">#define   INTF    0x04  </span><span class="cm">/* sta: int on the fly (reset by wr)*/</span><span class="cp"></span>
        <span class="cp">#define   SIP     0x02  </span><span class="cm">/* sta: scsi-interrupt              */</span><span class="cp"></span>
        <span class="cp">#define   DIP     0x01  </span><span class="cm">/* sta: host/script interrupt       */</span><span class="cp"></span>

<span class="cm">/*15*/</span>  <span class="n">u8</span>	<span class="n">nc_istat1</span><span class="p">;</span>	<span class="cm">/* 896 only */</span>
        <span class="cp">#define   FLSH    0x04  </span><span class="cm">/* sta: chip is flushing            */</span><span class="cp"></span>
        <span class="cp">#define   SCRUN   0x02  </span><span class="cm">/* sta: scripts are running         */</span><span class="cp"></span>
        <span class="cp">#define   SIRQD   0x01  </span><span class="cm">/* r/w: disable INT pin             */</span><span class="cp"></span>

<span class="cm">/*16*/</span>  <span class="n">u8</span>	<span class="n">nc_mbox0</span><span class="p">;</span>	<span class="cm">/* 896 only */</span>
<span class="cm">/*17*/</span>  <span class="n">u8</span>	<span class="n">nc_mbox1</span><span class="p">;</span>	<span class="cm">/* 896 only */</span>

<span class="cm">/*18*/</span>	<span class="n">u8</span>	<span class="n">nc_ctest0</span><span class="p">;</span>
<span class="cm">/*19*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest1</span><span class="p">;</span>

<span class="cm">/*1a*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest2</span><span class="p">;</span>
	<span class="cp">#define   CSIGP   0x40</span>
				<span class="cm">/* bits 0-2,7 rsvd for C1010        */</span>

<span class="cm">/*1b*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest3</span><span class="p">;</span>
	<span class="cp">#define   FLF     0x08  </span><span class="cm">/* cmd: flush dma fifo              */</span><span class="cp"></span>
	<span class="cp">#define   CLF	  0x04	</span><span class="cm">/* cmd: clear dma fifo		    */</span><span class="cp"></span>
	<span class="cp">#define   FM      0x02  </span><span class="cm">/* mod: fetch pin mode              */</span><span class="cp"></span>
	<span class="cp">#define   WRIE    0x01  </span><span class="cm">/* mod: write and invalidate enable */</span><span class="cp"></span>
				<span class="cm">/* bits 4-7 rsvd for C1010          */</span>

<span class="cm">/*1c*/</span>  <span class="n">u32</span>	<span class="n">nc_temp</span><span class="p">;</span>	<span class="cm">/* ### Temporary stack              */</span>

<span class="cm">/*20*/</span>	<span class="n">u8</span>	<span class="n">nc_dfifo</span><span class="p">;</span>
<span class="cm">/*21*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest4</span><span class="p">;</span>
	<span class="cp">#define   BDIS    0x80  </span><span class="cm">/* mod: burst disable               */</span><span class="cp"></span>
	<span class="cp">#define   MPEE    0x08  </span><span class="cm">/* mod: master parity error enable  */</span><span class="cp"></span>

<span class="cm">/*22*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest5</span><span class="p">;</span>
	<span class="cp">#define   DFS     0x20  </span><span class="cm">/* mod: dma fifo size               */</span><span class="cp"></span>
				<span class="cm">/* bits 0-1, 3-7 rsvd for C1010     */</span>

<span class="cm">/*23*/</span>  <span class="n">u8</span>	<span class="n">nc_ctest6</span><span class="p">;</span>

<span class="cm">/*24*/</span>  <span class="n">u32</span>	<span class="n">nc_dbc</span><span class="p">;</span>		<span class="cm">/* ### Byte count and command       */</span>
<span class="cm">/*28*/</span>  <span class="n">u32</span>	<span class="n">nc_dnad</span><span class="p">;</span>	<span class="cm">/* ### Next command register        */</span>
<span class="cm">/*2c*/</span>  <span class="n">u32</span>	<span class="n">nc_dsp</span><span class="p">;</span>		<span class="cm">/* --&gt; Script Pointer               */</span>
<span class="cm">/*30*/</span>  <span class="n">u32</span>	<span class="n">nc_dsps</span><span class="p">;</span>	<span class="cm">/* --&gt; Script pointer save/opcode#2 */</span>

<span class="cm">/*34*/</span>  <span class="n">u8</span>	<span class="n">nc_scratcha</span><span class="p">;</span>	<span class="cm">/* Temporary register a            */</span>
<span class="cm">/*35*/</span>  <span class="n">u8</span>	<span class="n">nc_scratcha1</span><span class="p">;</span>
<span class="cm">/*36*/</span>  <span class="n">u8</span>	<span class="n">nc_scratcha2</span><span class="p">;</span>
<span class="cm">/*37*/</span>  <span class="n">u8</span>	<span class="n">nc_scratcha3</span><span class="p">;</span>

<span class="cm">/*38*/</span>  <span class="n">u8</span>	<span class="n">nc_dmode</span><span class="p">;</span>
	<span class="cp">#define   BL_2    0x80  </span><span class="cm">/* mod: burst length shift value +2 */</span><span class="cp"></span>
	<span class="cp">#define   BL_1    0x40  </span><span class="cm">/* mod: burst length shift value +1 */</span><span class="cp"></span>
	<span class="cp">#define   ERL     0x08  </span><span class="cm">/* mod: enable read line            */</span><span class="cp"></span>
	<span class="cp">#define   ERMP    0x04  </span><span class="cm">/* mod: enable read multiple        */</span><span class="cp"></span>
	<span class="cp">#define   BOF     0x02  </span><span class="cm">/* mod: burst op code fetch         */</span><span class="cp"></span>

<span class="cm">/*39*/</span>  <span class="n">u8</span>	<span class="n">nc_dien</span><span class="p">;</span>
<span class="cm">/*3a*/</span>  <span class="n">u8</span>	<span class="n">nc_sbr</span><span class="p">;</span>

<span class="cm">/*3b*/</span>  <span class="n">u8</span>	<span class="n">nc_dcntl</span><span class="p">;</span>	<span class="cm">/* --&gt; Script execution control     */</span>
	<span class="cp">#define   CLSE    0x80  </span><span class="cm">/* mod: cache line size enable      */</span><span class="cp"></span>
	<span class="cp">#define   PFF     0x40  </span><span class="cm">/* cmd: pre-fetch flush             */</span><span class="cp"></span>
	<span class="cp">#define   PFEN    0x20  </span><span class="cm">/* mod: pre-fetch enable            */</span><span class="cp"></span>
	<span class="cp">#define   SSM     0x10  </span><span class="cm">/* mod: single step mode            */</span><span class="cp"></span>
	<span class="cp">#define   IRQM    0x08  </span><span class="cm">/* mod: irq mode (1 = totem pole !) */</span><span class="cp"></span>
	<span class="cp">#define   STD     0x04  </span><span class="cm">/* cmd: start dma mode              */</span><span class="cp"></span>
	<span class="cp">#define   IRQD    0x02  </span><span class="cm">/* mod: irq disable                 */</span><span class="cp"></span>
 	<span class="cp">#define	  NOCOM   0x01	</span><span class="cm">/* cmd: protect sfbr while reselect */</span><span class="cp"></span>
				<span class="cm">/* bits 0-1 rsvd for C1010          */</span>

<span class="cm">/*3c*/</span>  <span class="n">u32</span>	<span class="n">nc_adder</span><span class="p">;</span>

<span class="cm">/*40*/</span>  <span class="n">u16</span>	<span class="n">nc_sien</span><span class="p">;</span>	<span class="cm">/* --&gt;: interrupt enable            */</span>
<span class="cm">/*42*/</span>  <span class="n">u16</span>	<span class="n">nc_sist</span><span class="p">;</span>	<span class="cm">/* &lt;--: interrupt status            */</span>
        <span class="cp">#define   SBMC    0x1000</span><span class="cm">/* sta: SCSI Bus Mode Change (895/6 only) */</span><span class="cp"></span>
        <span class="cp">#define   STO     0x0400</span><span class="cm">/* sta: timeout (select)            */</span><span class="cp"></span>
        <span class="cp">#define   GEN     0x0200</span><span class="cm">/* sta: timeout (general)           */</span><span class="cp"></span>
        <span class="cp">#define   HTH     0x0100</span><span class="cm">/* sta: timeout (handshake)         */</span><span class="cp"></span>
        <span class="cp">#define   MA      0x80  </span><span class="cm">/* sta: phase mismatch              */</span><span class="cp"></span>
        <span class="cp">#define   CMP     0x40  </span><span class="cm">/* sta: arbitration complete        */</span><span class="cp"></span>
        <span class="cp">#define   SEL     0x20  </span><span class="cm">/* sta: selected by another device  */</span><span class="cp"></span>
        <span class="cp">#define   RSL     0x10  </span><span class="cm">/* sta: reselected by another device*/</span><span class="cp"></span>
        <span class="cp">#define   SGE     0x08  </span><span class="cm">/* sta: gross error (over/underflow)*/</span><span class="cp"></span>
        <span class="cp">#define   UDC     0x04  </span><span class="cm">/* sta: unexpected disconnect       */</span><span class="cp"></span>
        <span class="cp">#define   RST     0x02  </span><span class="cm">/* sta: scsi bus reset detected     */</span><span class="cp"></span>
        <span class="cp">#define   PAR     0x01  </span><span class="cm">/* sta: scsi parity error           */</span><span class="cp"></span>

<span class="cm">/*44*/</span>  <span class="n">u8</span>	<span class="n">nc_slpar</span><span class="p">;</span>
<span class="cm">/*45*/</span>  <span class="n">u8</span>	<span class="n">nc_swide</span><span class="p">;</span>
<span class="cm">/*46*/</span>  <span class="n">u8</span>	<span class="n">nc_macntl</span><span class="p">;</span>
<span class="cm">/*47*/</span>  <span class="n">u8</span>	<span class="n">nc_gpcntl</span><span class="p">;</span>
<span class="cm">/*48*/</span>  <span class="n">u8</span>	<span class="n">nc_stime0</span><span class="p">;</span>	<span class="cm">/* cmd: timeout for select&amp;handshake*/</span>
<span class="cm">/*49*/</span>  <span class="n">u8</span>	<span class="n">nc_stime1</span><span class="p">;</span>	<span class="cm">/* cmd: timeout user defined        */</span>
<span class="cm">/*4a*/</span>  <span class="n">u16</span>	<span class="n">nc_respid</span><span class="p">;</span>	<span class="cm">/* sta: Reselect-IDs                */</span>

<span class="cm">/*4c*/</span>  <span class="n">u8</span>	<span class="n">nc_stest0</span><span class="p">;</span>

<span class="cm">/*4d*/</span>  <span class="n">u8</span>	<span class="n">nc_stest1</span><span class="p">;</span>
	<span class="cp">#define   SCLK    0x80	</span><span class="cm">/* Use the PCI clock as SCSI clock	*/</span><span class="cp"></span>
	<span class="cp">#define   DBLEN   0x08	</span><span class="cm">/* clock doubler running		*/</span><span class="cp"></span>
	<span class="cp">#define   DBLSEL  0x04	</span><span class="cm">/* clock doubler selected		*/</span><span class="cp"></span>
  

<span class="cm">/*4e*/</span>  <span class="n">u8</span>	<span class="n">nc_stest2</span><span class="p">;</span>
	<span class="cp">#define   ROF     0x40	</span><span class="cm">/* reset scsi offset (after gross error!) */</span><span class="cp"></span>
	<span class="cp">#define   EXT     0x02  </span><span class="cm">/* extended filtering                     */</span><span class="cp"></span>

<span class="cm">/*4f*/</span>  <span class="n">u8</span>	<span class="n">nc_stest3</span><span class="p">;</span>
	<span class="cp">#define   TE     0x80	</span><span class="cm">/* c: tolerAnt enable */</span><span class="cp"></span>
	<span class="cp">#define   HSC    0x20	</span><span class="cm">/* c: Halt SCSI Clock */</span><span class="cp"></span>
	<span class="cp">#define   CSF    0x02	</span><span class="cm">/* c: clear scsi fifo */</span><span class="cp"></span>

<span class="cm">/*50*/</span>  <span class="n">u16</span>	<span class="n">nc_sidl</span><span class="p">;</span>	<span class="cm">/* Lowlevel: latched from scsi data */</span>
<span class="cm">/*52*/</span>  <span class="n">u8</span>	<span class="n">nc_stest4</span><span class="p">;</span>
	<span class="cp">#define   SMODE  0xc0	</span><span class="cm">/* SCSI bus mode      (895/6 only) */</span><span class="cp"></span>
	<span class="cp">#define    SMODE_HVD 0x40	</span><span class="cm">/* High Voltage Differential       */</span><span class="cp"></span>
	<span class="cp">#define    SMODE_SE  0x80	</span><span class="cm">/* Single Ended                    */</span><span class="cp"></span>
	<span class="cp">#define    SMODE_LVD 0xc0	</span><span class="cm">/* Low Voltage Differential        */</span><span class="cp"></span>
	<span class="cp">#define   LCKFRQ 0x20	</span><span class="cm">/* Frequency Lock (895/6 only)     */</span><span class="cp"></span>
				<span class="cm">/* bits 0-5 rsvd for C1010         */</span>

<span class="cm">/*53*/</span>  <span class="n">u8</span>	<span class="n">nc_53_</span><span class="p">;</span>
<span class="cm">/*54*/</span>  <span class="n">u16</span>	<span class="n">nc_sodl</span><span class="p">;</span>	<span class="cm">/* Lowlevel: data out to scsi data  */</span>
<span class="cm">/*56*/</span>	<span class="n">u8</span>	<span class="n">nc_ccntl0</span><span class="p">;</span>	<span class="cm">/* Chip Control 0 (896)             */</span>
	<span class="cp">#define   ENPMJ  0x80	</span><span class="cm">/* Enable Phase Mismatch Jump       */</span><span class="cp"></span>
	<span class="cp">#define   PMJCTL 0x40	</span><span class="cm">/* Phase Mismatch Jump Control      */</span><span class="cp"></span>
	<span class="cp">#define   ENNDJ  0x20	</span><span class="cm">/* Enable Non Data PM Jump          */</span><span class="cp"></span>
	<span class="cp">#define   DISFC  0x10	</span><span class="cm">/* Disable Auto FIFO Clear          */</span><span class="cp"></span>
	<span class="cp">#define   DILS   0x02	</span><span class="cm">/* Disable Internal Load/Store      */</span><span class="cp"></span>
	<span class="cp">#define   DPR    0x01	</span><span class="cm">/* Disable Pipe Req                 */</span><span class="cp"></span>

<span class="cm">/*57*/</span>	<span class="n">u8</span>	<span class="n">nc_ccntl1</span><span class="p">;</span>	<span class="cm">/* Chip Control 1 (896)             */</span>
	<span class="cp">#define   ZMOD   0x80	</span><span class="cm">/* High Impedance Mode              */</span><span class="cp"></span>
	<span class="cp">#define   DDAC   0x08	</span><span class="cm">/* Disable Dual Address Cycle       */</span><span class="cp"></span>
	<span class="cp">#define   XTIMOD 0x04	</span><span class="cm">/* 64-bit Table Ind. Indexing Mode  */</span><span class="cp"></span>
	<span class="cp">#define   EXTIBMV 0x02	</span><span class="cm">/* Enable 64-bit Table Ind. BMOV    */</span><span class="cp"></span>
	<span class="cp">#define   EXDBMV 0x01	</span><span class="cm">/* Enable 64-bit Direct BMOV        */</span><span class="cp"></span>

<span class="cm">/*58*/</span>  <span class="n">u16</span>	<span class="n">nc_sbdl</span><span class="p">;</span>	<span class="cm">/* Lowlevel: data from scsi data    */</span>
<span class="cm">/*5a*/</span>  <span class="n">u16</span>	<span class="n">nc_5a_</span><span class="p">;</span>

<span class="cm">/*5c*/</span>  <span class="n">u8</span>	<span class="n">nc_scr0</span><span class="p">;</span>	<span class="cm">/* Working register B               */</span>
<span class="cm">/*5d*/</span>  <span class="n">u8</span>	<span class="n">nc_scr1</span><span class="p">;</span>
<span class="cm">/*5e*/</span>  <span class="n">u8</span>	<span class="n">nc_scr2</span><span class="p">;</span>
<span class="cm">/*5f*/</span>  <span class="n">u8</span>	<span class="n">nc_scr3</span><span class="p">;</span>

<span class="cm">/*60*/</span>  <span class="n">u8</span>	<span class="n">nc_scrx</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>	<span class="cm">/* Working register C-R             */</span>
<span class="cm">/*a0*/</span>	<span class="n">u32</span>	<span class="n">nc_mmrs</span><span class="p">;</span>	<span class="cm">/* Memory Move Read Selector        */</span>
<span class="cm">/*a4*/</span>	<span class="n">u32</span>	<span class="n">nc_mmws</span><span class="p">;</span>	<span class="cm">/* Memory Move Write Selector       */</span>
<span class="cm">/*a8*/</span>	<span class="n">u32</span>	<span class="n">nc_sfs</span><span class="p">;</span>		<span class="cm">/* Script Fetch Selector            */</span>
<span class="cm">/*ac*/</span>	<span class="n">u32</span>	<span class="n">nc_drs</span><span class="p">;</span>		<span class="cm">/* DSA Relative Selector            */</span>
<span class="cm">/*b0*/</span>	<span class="n">u32</span>	<span class="n">nc_sbms</span><span class="p">;</span>	<span class="cm">/* Static Block Move Selector       */</span>
<span class="cm">/*b4*/</span>	<span class="n">u32</span>	<span class="n">nc_dbms</span><span class="p">;</span>	<span class="cm">/* Dynamic Block Move Selector      */</span>
<span class="cm">/*b8*/</span>	<span class="n">u32</span>	<span class="n">nc_dnad64</span><span class="p">;</span>	<span class="cm">/* DMA Next Address 64              */</span>
<span class="cm">/*bc*/</span>	<span class="n">u16</span>	<span class="n">nc_scntl4</span><span class="p">;</span>	<span class="cm">/* C1010 only                       */</span>
	<span class="cp">#define   U3EN    0x80	</span><span class="cm">/* Enable Ultra 3                   */</span><span class="cp"></span>
	<span class="cp">#define   AIPCKEN 0x40  </span><span class="cm">/* AIP checking enable              */</span><span class="cp"></span>
				<span class="cm">/* Also enable AIP generation on C10-33*/</span>
	<span class="cp">#define   XCLKH_DT 0x08 </span><span class="cm">/* Extra clock of data hold on DT edge */</span><span class="cp"></span>
	<span class="cp">#define   XCLKH_ST 0x04 </span><span class="cm">/* Extra clock of data hold on ST edge */</span><span class="cp"></span>
	<span class="cp">#define   XCLKS_DT 0x02 </span><span class="cm">/* Extra clock of data set  on DT edge */</span><span class="cp"></span>
	<span class="cp">#define   XCLKS_ST 0x01 </span><span class="cm">/* Extra clock of data set  on ST edge */</span><span class="cp"></span>
<span class="cm">/*be*/</span>	<span class="n">u8</span>	<span class="n">nc_aipcntl0</span><span class="p">;</span>	<span class="cm">/* AIP Control 0 C1010 only         */</span>
<span class="cm">/*bf*/</span>	<span class="n">u8</span>	<span class="n">nc_aipcntl1</span><span class="p">;</span>	<span class="cm">/* AIP Control 1 C1010 only         */</span>
	<span class="cp">#define DISAIP  0x08	</span><span class="cm">/* Disable AIP generation C10-66 only  */</span><span class="cp"></span>
<span class="cm">/*c0*/</span>	<span class="n">u32</span>	<span class="n">nc_pmjad1</span><span class="p">;</span>	<span class="cm">/* Phase Mismatch Jump Address 1    */</span>
<span class="cm">/*c4*/</span>	<span class="n">u32</span>	<span class="n">nc_pmjad2</span><span class="p">;</span>	<span class="cm">/* Phase Mismatch Jump Address 2    */</span>
<span class="cm">/*c8*/</span>	<span class="n">u8</span>	<span class="n">nc_rbc</span><span class="p">;</span>		<span class="cm">/* Remaining Byte Count             */</span>
<span class="cm">/*c9*/</span>	<span class="n">u8</span>	<span class="n">nc_rbc1</span><span class="p">;</span>
<span class="cm">/*ca*/</span>	<span class="n">u8</span>	<span class="n">nc_rbc2</span><span class="p">;</span>
<span class="cm">/*cb*/</span>	<span class="n">u8</span>	<span class="n">nc_rbc3</span><span class="p">;</span>

<span class="cm">/*cc*/</span>	<span class="n">u8</span>	<span class="n">nc_ua</span><span class="p">;</span>		<span class="cm">/* Updated Address                  */</span>
<span class="cm">/*cd*/</span>	<span class="n">u8</span>	<span class="n">nc_ua1</span><span class="p">;</span>
<span class="cm">/*ce*/</span>	<span class="n">u8</span>	<span class="n">nc_ua2</span><span class="p">;</span>
<span class="cm">/*cf*/</span>	<span class="n">u8</span>	<span class="n">nc_ua3</span><span class="p">;</span>
<span class="cm">/*d0*/</span>	<span class="n">u32</span>	<span class="n">nc_esa</span><span class="p">;</span>		<span class="cm">/* Entry Storage Address            */</span>
<span class="cm">/*d4*/</span>	<span class="n">u8</span>	<span class="n">nc_ia</span><span class="p">;</span>		<span class="cm">/* Instruction Address              */</span>
<span class="cm">/*d5*/</span>	<span class="n">u8</span>	<span class="n">nc_ia1</span><span class="p">;</span>
<span class="cm">/*d6*/</span>	<span class="n">u8</span>	<span class="n">nc_ia2</span><span class="p">;</span>
<span class="cm">/*d7*/</span>	<span class="n">u8</span>	<span class="n">nc_ia3</span><span class="p">;</span>
<span class="cm">/*d8*/</span>	<span class="n">u32</span>	<span class="n">nc_sbc</span><span class="p">;</span>		<span class="cm">/* SCSI Byte Count (3 bytes only)   */</span>
<span class="cm">/*dc*/</span>	<span class="n">u32</span>	<span class="n">nc_csbc</span><span class="p">;</span>	<span class="cm">/* Cumulative SCSI Byte Count       */</span>
                                <span class="cm">/* Following for C1010 only         */</span>
<span class="cm">/*e0*/</span>	<span class="n">u16</span>    <span class="n">nc_crcpad</span><span class="p">;</span>	<span class="cm">/* CRC Value                        */</span>
<span class="cm">/*e2*/</span>	<span class="n">u8</span>     <span class="n">nc_crccntl0</span><span class="p">;</span>	<span class="cm">/* CRC control register             */</span>
	<span class="cp">#define   SNDCRC  0x10	</span><span class="cm">/* Send CRC Request                 */</span><span class="cp"></span>
<span class="cm">/*e3*/</span>	<span class="n">u8</span>     <span class="n">nc_crccntl1</span><span class="p">;</span>	<span class="cm">/* CRC control register             */</span>
<span class="cm">/*e4*/</span>	<span class="n">u32</span>    <span class="n">nc_crcdata</span><span class="p">;</span>	<span class="cm">/* CRC data register                */</span>
<span class="cm">/*e8*/</span>	<span class="n">u32</span>    <span class="n">nc_e8_</span><span class="p">;</span>
<span class="cm">/*ec*/</span>	<span class="n">u32</span>    <span class="n">nc_ec_</span><span class="p">;</span>
<span class="cm">/*f0*/</span>	<span class="n">u16</span>    <span class="n">nc_dfbc</span><span class="p">;</span>		<span class="cm">/* DMA FIFO byte count              */</span> 
<span class="p">};</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Utility macros for the script.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define REGJ(p,r) (offsetof(struct sym_reg, p ## r))</span>
<span class="cp">#define REG(r) REGJ (nc_, r)</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	SCSI phases</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define	SCR_DATA_OUT	0x00000000</span>
<span class="cp">#define	SCR_DATA_IN	0x01000000</span>
<span class="cp">#define	SCR_COMMAND	0x02000000</span>
<span class="cp">#define	SCR_STATUS	0x03000000</span>
<span class="cp">#define	SCR_DT_DATA_OUT	0x04000000</span>
<span class="cp">#define	SCR_DT_DATA_IN	0x05000000</span>
<span class="cp">#define SCR_MSG_OUT	0x06000000</span>
<span class="cp">#define SCR_MSG_IN      0x07000000</span>
<span class="cm">/* DT phases are illegal for non Ultra3 mode */</span>
<span class="cp">#define SCR_ILG_OUT	0x04000000</span>
<span class="cp">#define SCR_ILG_IN	0x05000000</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Data transfer via SCSI.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	MOVE_ABS (LEN)</span>
<span class="cm"> *	&lt;&lt;start address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	MOVE_IND (LEN)</span>
<span class="cm"> *	&lt;&lt;dnad_offset&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	MOVE_TBL</span>
<span class="cm"> *	&lt;&lt;dnad_offset&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define OPC_MOVE          0x08000000</span>

<span class="cp">#define SCR_MOVE_ABS(l) ((0x00000000 | OPC_MOVE) | (l))</span>
<span class="cm">/* #define SCR_MOVE_IND(l) ((0x20000000 | OPC_MOVE) | (l)) */</span>
<span class="cp">#define SCR_MOVE_TBL     (0x10000000 | OPC_MOVE)</span>

<span class="cp">#define SCR_CHMOV_ABS(l) ((0x00000000) | (l))</span>
<span class="cm">/* #define SCR_CHMOV_IND(l) ((0x20000000) | (l)) */</span>
<span class="cp">#define SCR_CHMOV_TBL     (0x10000000)</span>

<span class="cp">#ifdef SYM_CONF_TARGET_ROLE_SUPPORT</span>
<span class="cm">/* We steal the `indirect addressing&#39; flag for target mode MOVE in scripts */</span>

<span class="cp">#define OPC_TCHMOVE        0x08000000</span>

<span class="cp">#define SCR_TCHMOVE_ABS(l) ((0x20000000 | OPC_TCHMOVE) | (l))</span>
<span class="cp">#define SCR_TCHMOVE_TBL     (0x30000000 | OPC_TCHMOVE)</span>

<span class="cp">#define SCR_TMOV_ABS(l)    ((0x20000000) | (l))</span>
<span class="cp">#define SCR_TMOV_TBL        (0x30000000)</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">sym_tblmove</span> <span class="p">{</span>
        <span class="n">u32</span>  <span class="n">size</span><span class="p">;</span>
        <span class="n">u32</span>  <span class="n">addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Selection</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	SEL_ABS | SCR_ID (0..15)    [ | REL_JMP]</span>
<span class="cm"> *	&lt;&lt;alternate_address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	SEL_TBL | &lt;&lt; dnad_offset&gt;&gt;  [ | REL_JMP]</span>
<span class="cm"> *	&lt;&lt;alternate_address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define	SCR_SEL_ABS	0x40000000</span>
<span class="cp">#define	SCR_SEL_ABS_ATN	0x41000000</span>
<span class="cp">#define	SCR_SEL_TBL	0x42000000</span>
<span class="cp">#define	SCR_SEL_TBL_ATN	0x43000000</span>

<span class="cp">#ifdef SYM_CONF_TARGET_ROLE_SUPPORT</span>
<span class="cp">#define	SCR_RESEL_ABS     0x40000000</span>
<span class="cp">#define	SCR_RESEL_ABS_ATN 0x41000000</span>
<span class="cp">#define	SCR_RESEL_TBL     0x42000000</span>
<span class="cp">#define	SCR_RESEL_TBL_ATN 0x43000000</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">sym_tblsel</span> <span class="p">{</span>
        <span class="n">u_char</span>  <span class="n">sel_scntl4</span><span class="p">;</span>	<span class="cm">/* C1010 only */</span>
        <span class="n">u_char</span>  <span class="n">sel_sxfer</span><span class="p">;</span>
        <span class="n">u_char</span>  <span class="n">sel_id</span><span class="p">;</span>
        <span class="n">u_char</span>  <span class="n">sel_scntl3</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SCR_JMP_REL     0x04000000</span>
<span class="cp">#define SCR_ID(id)	(((u32)(id)) &lt;&lt; 16)</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Waiting for Disconnect or Reselect</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	WAIT_DISC</span>
<span class="cm"> *	dummy: &lt;&lt;alternate_address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	WAIT_RESEL</span>
<span class="cm"> *	&lt;&lt;alternate_address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define	SCR_WAIT_DISC	0x48000000</span>
<span class="cp">#define SCR_WAIT_RESEL  0x50000000</span>

<span class="cp">#ifdef SYM_CONF_TARGET_ROLE_SUPPORT</span>
<span class="cp">#define	SCR_DISCONNECT	0x48000000</span>
<span class="cp">#endif</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Bit Set / Reset</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	SET (flags {|.. })</span>
<span class="cm"> *</span>
<span class="cm"> *	CLR (flags {|.. })</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define SCR_SET(f)     (0x58000000 | (f))</span>
<span class="cp">#define SCR_CLR(f)     (0x60000000 | (f))</span>

<span class="cp">#define	SCR_CARRY	0x00000400</span>
<span class="cp">#define	SCR_TRG		0x00000200</span>
<span class="cp">#define	SCR_ACK		0x00000040</span>
<span class="cp">#define	SCR_ATN		0x00000008</span>


<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Memory to memory move</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	COPY (bytecount)</span>
<span class="cm"> *	&lt;&lt; source_address &gt;&gt;</span>
<span class="cm"> *	&lt;&lt; destination_address &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	SCR_COPY   sets the NO FLUSH option by default.</span>
<span class="cm"> *	SCR_COPY_F does not set this option.</span>
<span class="cm"> *</span>
<span class="cm"> *	For chips which do not support this option,</span>
<span class="cm"> *	sym_fw_bind_script() will remove this bit.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define SCR_NO_FLUSH 0x01000000</span>

<span class="cp">#define SCR_COPY(n) (0xc0000000 | SCR_NO_FLUSH | (n))</span>
<span class="cp">#define SCR_COPY_F(n) (0xc0000000 | (n))</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Register move and binary operations</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	SFBR_REG (reg, op, data)        reg  = SFBR op data</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	REG_SFBR (reg, op, data)        SFBR = reg op data</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	REG_REG  (reg, op, data)        reg  = reg op data</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	On 825A, 875, 895 and 896 chips the content </span>
<span class="cm"> *	of SFBR register can be used as data (SCR_SFBR_DATA).</span>
<span class="cm"> *	The 896 has additionnal IO registers starting at </span>
<span class="cm"> *	offset 0x80. Bit 7 of register offset is stored in </span>
<span class="cm"> *	bit 7 of the SCRIPTS instruction first DWORD.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define SCR_REG_OFS(ofs) ((((ofs) &amp; 0x7f) &lt;&lt; 16ul) + ((ofs) &amp; 0x80)) </span>

<span class="cp">#define SCR_SFBR_REG(reg,op,data) \</span>
<span class="cp">        (0x68000000 | (SCR_REG_OFS(REG(reg))) | (op) | (((data)&amp;0xff)&lt;&lt;8ul))</span>

<span class="cp">#define SCR_REG_SFBR(reg,op,data) \</span>
<span class="cp">        (0x70000000 | (SCR_REG_OFS(REG(reg))) | (op) | (((data)&amp;0xff)&lt;&lt;8ul))</span>

<span class="cp">#define SCR_REG_REG(reg,op,data) \</span>
<span class="cp">        (0x78000000 | (SCR_REG_OFS(REG(reg))) | (op) | (((data)&amp;0xff)&lt;&lt;8ul))</span>


<span class="cp">#define      SCR_LOAD   0x00000000</span>
<span class="cp">#define      SCR_SHL    0x01000000</span>
<span class="cp">#define      SCR_OR     0x02000000</span>
<span class="cp">#define      SCR_XOR    0x03000000</span>
<span class="cp">#define      SCR_AND    0x04000000</span>
<span class="cp">#define      SCR_SHR    0x05000000</span>
<span class="cp">#define      SCR_ADD    0x06000000</span>
<span class="cp">#define      SCR_ADDC   0x07000000</span>

<span class="cp">#define      SCR_SFBR_DATA   (0x00800000&gt;&gt;8ul)	</span><span class="cm">/* Use SFBR as data */</span><span class="cp"></span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	FROM_REG (reg)		  SFBR = reg</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	TO_REG	 (reg)		  reg  = SFBR</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	LOAD_REG (reg, data)	  reg  = &lt;data&gt;</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	LOAD_SFBR(data) 	  SFBR = &lt;data&gt;</span>
<span class="cm"> *	&lt;&lt; 0 &gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define	SCR_FROM_REG(reg) \</span>
<span class="cp">	SCR_REG_SFBR(reg,SCR_OR,0)</span>

<span class="cp">#define	SCR_TO_REG(reg) \</span>
<span class="cp">	SCR_SFBR_REG(reg,SCR_OR,0)</span>

<span class="cp">#define	SCR_LOAD_REG(reg,data) \</span>
<span class="cp">	SCR_REG_REG(reg,SCR_LOAD,data)</span>

<span class="cp">#define SCR_LOAD_SFBR(data) \</span>
<span class="cp">        (SCR_REG_SFBR (gpreg, SCR_LOAD, data))</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	LOAD  from memory   to register.</span>
<span class="cm"> *	STORE from register to memory.</span>
<span class="cm"> *</span>
<span class="cm"> *	Only supported by 810A, 860, 825A, 875, 895 and 896.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	LOAD_ABS (LEN)</span>
<span class="cm"> *	&lt;&lt;start address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	LOAD_REL (LEN)        (DSA relative)</span>
<span class="cm"> *	&lt;&lt;dsa_offset&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define SCR_REG_OFS2(ofs) (((ofs) &amp; 0xff) &lt;&lt; 16ul)</span>
<span class="cp">#define SCR_NO_FLUSH2	0x02000000</span>
<span class="cp">#define SCR_DSA_REL2	0x10000000</span>

<span class="cp">#define SCR_LOAD_R(reg, how, n) \</span>
<span class="cp">        (0xe1000000 | how | (SCR_REG_OFS2(REG(reg))) | (n))</span>

<span class="cp">#define SCR_STORE_R(reg, how, n) \</span>
<span class="cp">        (0xe0000000 | how | (SCR_REG_OFS2(REG(reg))) | (n))</span>

<span class="cp">#define SCR_LOAD_ABS(reg, n)	SCR_LOAD_R(reg, SCR_NO_FLUSH2, n)</span>
<span class="cp">#define SCR_LOAD_REL(reg, n)	SCR_LOAD_R(reg, SCR_NO_FLUSH2|SCR_DSA_REL2, n)</span>
<span class="cp">#define SCR_LOAD_ABS_F(reg, n)	SCR_LOAD_R(reg, 0, n)</span>
<span class="cp">#define SCR_LOAD_REL_F(reg, n)	SCR_LOAD_R(reg, SCR_DSA_REL2, n)</span>

<span class="cp">#define SCR_STORE_ABS(reg, n)	SCR_STORE_R(reg, SCR_NO_FLUSH2, n)</span>
<span class="cp">#define SCR_STORE_REL(reg, n)	SCR_STORE_R(reg, SCR_NO_FLUSH2|SCR_DSA_REL2,n)</span>
<span class="cp">#define SCR_STORE_ABS_F(reg, n)	SCR_STORE_R(reg, 0, n)</span>
<span class="cp">#define SCR_STORE_REL_F(reg, n)	SCR_STORE_R(reg, SCR_DSA_REL2, n)</span>


<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	Waiting for Disconnect or Reselect</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	JUMP            [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	JUMPR           [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;distance&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	CALL            [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;address&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	CALLR           [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;distance&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	RETURN          [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;dummy&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	INT             [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;ident&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	INT_FLY         [ | IFTRUE/IFFALSE ( ... ) ]</span>
<span class="cm"> *	&lt;&lt;ident&gt;&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	Conditions:</span>
<span class="cm"> *	     WHEN (phase)</span>
<span class="cm"> *	     IF   (phase)</span>
<span class="cm"> *	     CARRYSET</span>
<span class="cm"> *	     DATA (data, mask)</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cp">#define SCR_NO_OP       0x80000000</span>
<span class="cp">#define SCR_JUMP        0x80080000</span>
<span class="cp">#define SCR_JUMP64      0x80480000</span>
<span class="cp">#define SCR_JUMPR       0x80880000</span>
<span class="cp">#define SCR_CALL        0x88080000</span>
<span class="cp">#define SCR_CALLR       0x88880000</span>
<span class="cp">#define SCR_RETURN      0x90080000</span>
<span class="cp">#define SCR_INT         0x98080000</span>
<span class="cp">#define SCR_INT_FLY     0x98180000</span>

<span class="cp">#define IFFALSE(arg)   (0x00080000 | (arg))</span>
<span class="cp">#define IFTRUE(arg)    (0x00000000 | (arg))</span>

<span class="cp">#define WHEN(phase)    (0x00030000 | (phase))</span>
<span class="cp">#define IF(phase)      (0x00020000 | (phase))</span>

<span class="cp">#define DATA(D)        (0x00040000 | ((D) &amp; 0xff))</span>
<span class="cp">#define MASK(D,M)      (0x00040000 | (((M ^ 0xff) &amp; 0xff) &lt;&lt; 8ul)|((D) &amp; 0xff))</span>

<span class="cp">#define CARRYSET       (0x00200000)</span>

<span class="cm">/*-----------------------------------------------------------</span>
<span class="cm"> *</span>
<span class="cm"> *	SCSI  constants.</span>
<span class="cm"> *</span>
<span class="cm"> *-----------------------------------------------------------</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	Messages</span>
<span class="cm"> */</span>

<span class="cp">#define	M_COMPLETE	COMMAND_COMPLETE</span>
<span class="cp">#define	M_EXTENDED	EXTENDED_MESSAGE</span>
<span class="cp">#define	M_SAVE_DP	SAVE_POINTERS</span>
<span class="cp">#define	M_RESTORE_DP	RESTORE_POINTERS</span>
<span class="cp">#define	M_DISCONNECT	DISCONNECT</span>
<span class="cp">#define	M_ID_ERROR	INITIATOR_ERROR</span>
<span class="cp">#define	M_ABORT		ABORT_TASK_SET</span>
<span class="cp">#define	M_REJECT	MESSAGE_REJECT</span>
<span class="cp">#define	M_NOOP		NOP</span>
<span class="cp">#define	M_PARITY	MSG_PARITY_ERROR</span>
<span class="cp">#define	M_LCOMPLETE	LINKED_CMD_COMPLETE</span>
<span class="cp">#define	M_FCOMPLETE	LINKED_FLG_CMD_COMPLETE</span>
<span class="cp">#define	M_RESET		TARGET_RESET</span>
<span class="cp">#define	M_ABORT_TAG	ABORT_TASK</span>
<span class="cp">#define	M_CLEAR_QUEUE	CLEAR_TASK_SET</span>
<span class="cp">#define	M_INIT_REC	INITIATE_RECOVERY</span>
<span class="cp">#define	M_REL_REC	RELEASE_RECOVERY</span>
<span class="cp">#define	M_TERMINATE	(0x11)</span>
<span class="cp">#define	M_SIMPLE_TAG	SIMPLE_QUEUE_TAG</span>
<span class="cp">#define	M_HEAD_TAG	HEAD_OF_QUEUE_TAG</span>
<span class="cp">#define	M_ORDERED_TAG	ORDERED_QUEUE_TAG</span>
<span class="cp">#define	M_IGN_RESIDUE	IGNORE_WIDE_RESIDUE</span>

<span class="cp">#define	M_X_MODIFY_DP	EXTENDED_MODIFY_DATA_POINTER</span>
<span class="cp">#define	M_X_SYNC_REQ	EXTENDED_SDTR</span>
<span class="cp">#define	M_X_WIDE_REQ	EXTENDED_WDTR</span>
<span class="cp">#define	M_X_PPR_REQ	EXTENDED_PPR</span>

<span class="cm">/*</span>
<span class="cm"> *	PPR protocol options</span>
<span class="cm"> */</span>
<span class="cp">#define	PPR_OPT_IU	(0x01)</span>
<span class="cp">#define	PPR_OPT_DT	(0x02)</span>
<span class="cp">#define	PPR_OPT_QAS	(0x04)</span>
<span class="cp">#define PPR_OPT_MASK	(0x07)</span>

<span class="cm">/*</span>
<span class="cm"> *	Status</span>
<span class="cm"> */</span>

<span class="cp">#define	S_GOOD		SAM_STAT_GOOD</span>
<span class="cp">#define	S_CHECK_COND	SAM_STAT_CHECK_CONDITION</span>
<span class="cp">#define	S_COND_MET	SAM_STAT_CONDITION_MET</span>
<span class="cp">#define	S_BUSY		SAM_STAT_BUSY</span>
<span class="cp">#define	S_INT		SAM_STAT_INTERMEDIATE</span>
<span class="cp">#define	S_INT_COND_MET	SAM_STAT_INTERMEDIATE_CONDITION_MET</span>
<span class="cp">#define	S_CONFLICT	SAM_STAT_RESERVATION_CONFLICT</span>
<span class="cp">#define	S_TERMINATED	SAM_STAT_COMMAND_TERMINATED</span>
<span class="cp">#define	S_QUEUE_FULL	SAM_STAT_TASK_SET_FULL</span>
<span class="cp">#define	S_ILLEGAL	(0xff)</span>

<span class="cp">#endif </span><span class="cm">/* defined SYM_DEFS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
