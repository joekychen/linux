<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › arcmsr › arcmsr.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>arcmsr.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**        O.S   : Linux</span>
<span class="cm">**   FILE NAME  : arcmsr.h</span>
<span class="cm">**        BY    : Nick Cheng</span>
<span class="cm">**   Description: SCSI RAID Device Driver for</span>
<span class="cm">**                ARECA RAID Host adapter</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">** Copyright (C) 2002 - 2005, Areca Technology Corporation All rights reserved.</span>
<span class="cm">**</span>
<span class="cm">**     Web site: www.areca.com.tw</span>
<span class="cm">**       E-mail: support@areca.com.tw</span>
<span class="cm">**</span>
<span class="cm">** This program is free software; you can redistribute it and/or modify</span>
<span class="cm">** it under the terms of the GNU General Public License version 2 as</span>
<span class="cm">** published by the Free Software Foundation.</span>
<span class="cm">** This program is distributed in the hope that it will be useful,</span>
<span class="cm">** but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">** GNU General Public License for more details.</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">** Redistribution and use in source and binary forms, with or without</span>
<span class="cm">** modification, are permitted provided that the following conditions</span>
<span class="cm">** are met:</span>
<span class="cm">** 1. Redistributions of source code must retain the above copyright</span>
<span class="cm">**    notice, this list of conditions and the following disclaimer.</span>
<span class="cm">** 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="cm">**    notice, this list of conditions and the following disclaimer in the</span>
<span class="cm">**    documentation and/or other materials provided with the distribution.</span>
<span class="cm">** 3. The name of the author may not be used to endorse or promote products</span>
<span class="cm">**    derived from this software without specific prior written permission.</span>
<span class="cm">**</span>
<span class="cm">** THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS&#39;&#39; AND ANY EXPRESS OR</span>
<span class="cm">** IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES</span>
<span class="cm">** OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.</span>
<span class="cm">** IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,</span>
<span class="cm">** INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES(INCLUDING, BUT</span>
<span class="cm">** NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="cm">** DATA, OR PROFITS; OR BUSINESS INTERRUPTION)HOWEVER CAUSED AND ON ANY</span>
<span class="cm">** THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="cm">**(INCLUDING NEGLIGENCE OR OTHERWISE)ARISING IN ANY WAY OUT OF THE USE OF</span>
<span class="cm">** THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="k">struct</span> <span class="n">device_attribute</span><span class="p">;</span>
<span class="cm">/*The limit of outstanding scsi command that firmware can handle*/</span>
<span class="cp">#define ARCMSR_MAX_OUTSTANDING_CMD						256</span>
<span class="cp">#ifdef CONFIG_XEN</span>
	<span class="cp">#define ARCMSR_MAX_FREECCB_NUM	160</span>
<span class="cp">#else</span>
	<span class="cp">#define ARCMSR_MAX_FREECCB_NUM	320</span>
<span class="cp">#endif</span>
<span class="cp">#define ARCMSR_DRIVER_VERSION		     &quot;Driver Version 1.20.00.15 2010/08/05&quot;</span>
<span class="cp">#define ARCMSR_SCSI_INITIATOR_ID						255</span>
<span class="cp">#define ARCMSR_MAX_XFER_SECTORS							512</span>
<span class="cp">#define ARCMSR_MAX_XFER_SECTORS_B						4096</span>
<span class="cp">#define ARCMSR_MAX_XFER_SECTORS_C						304</span>
<span class="cp">#define ARCMSR_MAX_TARGETID							17</span>
<span class="cp">#define ARCMSR_MAX_TARGETLUN							8</span>
<span class="cp">#define ARCMSR_MAX_CMD_PERLUN		                 ARCMSR_MAX_OUTSTANDING_CMD</span>
<span class="cp">#define ARCMSR_MAX_QBUFFER							4096</span>
<span class="cp">#define ARCMSR_DEFAULT_SG_ENTRIES						38</span>
<span class="cp">#define ARCMSR_MAX_HBB_POSTQUEUE						264</span>
<span class="cp">#define ARCMSR_MAX_XFER_LEN							0x26000 </span><span class="cm">/* 152K */</span><span class="cp"></span>
<span class="cp">#define ARCMSR_CDB_SG_PAGE_LENGTH						256 </span>
<span class="cp">#ifndef PCI_DEVICE_ID_ARECA_1880</span>
<span class="cp">#define PCI_DEVICE_ID_ARECA_1880 0x1880</span>
 <span class="cp">#endif</span>
<span class="cm">/*</span>
<span class="cm">**********************************************************************************</span>
<span class="cm">**</span>
<span class="cm">**********************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define ARC_SUCCESS                                                       0</span>
<span class="cp">#define ARC_FAILURE                                                       1</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**        split 64bits dma addressing</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define dma_addr_hi32(addr)               (uint32_t) ((addr&gt;&gt;16)&gt;&gt;16)</span>
<span class="cp">#define dma_addr_lo32(addr)               (uint32_t) (addr &amp; 0xffffffff)</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**        MESSAGE CONTROL CODE</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">CMD_MESSAGE</span>
<span class="p">{</span>
      <span class="kt">uint32_t</span> <span class="n">HeaderLength</span><span class="p">;</span>
      <span class="kt">uint8_t</span>  <span class="n">Signature</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
      <span class="kt">uint32_t</span> <span class="n">Timeout</span><span class="p">;</span>
      <span class="kt">uint32_t</span> <span class="n">ControlCode</span><span class="p">;</span>
      <span class="kt">uint32_t</span> <span class="n">ReturnCode</span><span class="p">;</span>
      <span class="kt">uint32_t</span> <span class="n">Length</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**        IOP Message Transfer Data for user space</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">CMD_MESSAGE_FIELD</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">CMD_MESSAGE</span>			<span class="n">cmdmessage</span><span class="p">;</span>
    <span class="kt">uint8_t</span>				<span class="n">messagedatabuffer</span><span class="p">[</span><span class="mi">1032</span><span class="p">];</span>
<span class="p">};</span>
<span class="cm">/* IOP message transfer */</span>
<span class="cp">#define ARCMSR_MESSAGE_FAIL			0x0001</span>
<span class="cm">/* DeviceType */</span>
<span class="cp">#define ARECA_SATA_RAID				0x90000000</span>
<span class="cm">/* FunctionCode */</span>
<span class="cp">#define FUNCTION_READ_RQBUFFER			0x0801</span>
<span class="cp">#define FUNCTION_WRITE_WQBUFFER			0x0802</span>
<span class="cp">#define FUNCTION_CLEAR_RQBUFFER			0x0803</span>
<span class="cp">#define FUNCTION_CLEAR_WQBUFFER			0x0804</span>
<span class="cp">#define FUNCTION_CLEAR_ALLQBUFFER		0x0805</span>
<span class="cp">#define FUNCTION_RETURN_CODE_3F			0x0806</span>
<span class="cp">#define FUNCTION_SAY_HELLO			0x0807</span>
<span class="cp">#define FUNCTION_SAY_GOODBYE			0x0808</span>
<span class="cp">#define FUNCTION_FLUSH_ADAPTER_CACHE		0x0809</span>
<span class="cp">#define FUNCTION_GET_FIRMWARE_STATUS			0x080A</span>
<span class="cp">#define FUNCTION_HARDWARE_RESET			0x080B</span>
<span class="cm">/* ARECA IO CONTROL CODE*/</span>
<span class="cp">#define ARCMSR_MESSAGE_READ_RQBUFFER       \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_READ_RQBUFFER</span>
<span class="cp">#define ARCMSR_MESSAGE_WRITE_WQBUFFER      \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_WRITE_WQBUFFER</span>
<span class="cp">#define ARCMSR_MESSAGE_CLEAR_RQBUFFER      \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_CLEAR_RQBUFFER</span>
<span class="cp">#define ARCMSR_MESSAGE_CLEAR_WQBUFFER      \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_CLEAR_WQBUFFER</span>
<span class="cp">#define ARCMSR_MESSAGE_CLEAR_ALLQBUFFER    \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_CLEAR_ALLQBUFFER</span>
<span class="cp">#define ARCMSR_MESSAGE_RETURN_CODE_3F      \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_RETURN_CODE_3F</span>
<span class="cp">#define ARCMSR_MESSAGE_SAY_HELLO           \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_SAY_HELLO</span>
<span class="cp">#define ARCMSR_MESSAGE_SAY_GOODBYE         \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_SAY_GOODBYE</span>
<span class="cp">#define ARCMSR_MESSAGE_FLUSH_ADAPTER_CACHE \</span>
<span class="cp">	ARECA_SATA_RAID | FUNCTION_FLUSH_ADAPTER_CACHE</span>
<span class="cm">/* ARECA IOCTL ReturnCode */</span>
<span class="cp">#define ARCMSR_MESSAGE_RETURNCODE_OK		0x00000001</span>
<span class="cp">#define ARCMSR_MESSAGE_RETURNCODE_ERROR		0x00000006</span>
<span class="cp">#define ARCMSR_MESSAGE_RETURNCODE_3F		0x0000003F</span>
<span class="cp">#define ARCMSR_MESSAGE_RETURNCODE_BUS_HANG_ON	0x00000088</span>
<span class="cm">/*</span>
<span class="cm">*************************************************************</span>
<span class="cm">**   structure for holding DMA address data</span>
<span class="cm">*************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define IS_DMA64			(sizeof(dma_addr_t) == 8)</span>
<span class="cp">#define IS_SG64_ADDR                0x01000000 </span><span class="cm">/* bit24 */</span><span class="cp"></span>
<span class="k">struct</span>  <span class="n">SG32ENTRY</span>
<span class="p">{</span>
	<span class="n">__le32</span>					<span class="n">length</span><span class="p">;</span>
	<span class="n">__le32</span>					<span class="n">address</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>
<span class="k">struct</span>  <span class="n">SG64ENTRY</span>
<span class="p">{</span>
	<span class="n">__le32</span>					<span class="n">length</span><span class="p">;</span>
	<span class="n">__le32</span>					<span class="n">address</span><span class="p">;</span>
	<span class="n">__le32</span>					<span class="n">addresshigh</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>
<span class="cm">/*</span>
<span class="cm">********************************************************************</span>
<span class="cm">**      Q Buffer of IOP Message Transfer</span>
<span class="cm">********************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">QBUFFER</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span>      <span class="n">data_len</span><span class="p">;</span>
	<span class="kt">uint8_t</span>       <span class="n">data</span><span class="p">[</span><span class="mi">124</span><span class="p">];</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**      FIRMWARE INFO for Intel IOP R 80331 processor (Type A)</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">FIRMWARE_INFO</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span>      <span class="n">signature</span><span class="p">;</span>		<span class="cm">/*0, 00-03*/</span>
	<span class="kt">uint32_t</span>      <span class="n">request_len</span><span class="p">;</span>		<span class="cm">/*1, 04-07*/</span>
	<span class="kt">uint32_t</span>      <span class="n">numbers_queue</span><span class="p">;</span>		<span class="cm">/*2, 08-11*/</span>
	<span class="kt">uint32_t</span>      <span class="n">sdram_size</span><span class="p">;</span>               <span class="cm">/*3, 12-15*/</span>
	<span class="kt">uint32_t</span>      <span class="n">ide_channels</span><span class="p">;</span>		<span class="cm">/*4, 16-19*/</span>
	<span class="kt">char</span>          <span class="n">vendor</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>		<span class="cm">/*5, 20-59*/</span>
	<span class="kt">char</span>          <span class="n">model</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>			<span class="cm">/*15, 60-67*/</span>
	<span class="kt">char</span>          <span class="n">firmware_ver</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>     	<span class="cm">/*17, 68-83*/</span>
	<span class="kt">char</span>          <span class="n">device_map</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/*21, 84-99*/</span>
	<span class="kt">uint32_t</span>		<span class="n">cfgVersion</span><span class="p">;</span>               	<span class="cm">/*25,100-103 Added for checking of new firmware capability*/</span>
	<span class="kt">uint8_t</span>		<span class="n">cfgSerial</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>           	<span class="cm">/*26,104-119*/</span>
	<span class="kt">uint32_t</span>		<span class="n">cfgPicStatus</span><span class="p">;</span>            	<span class="cm">/*30,120-123*/</span>	
<span class="p">};</span>
<span class="cm">/* signature of set and get firmware config */</span>
<span class="cp">#define ARCMSR_SIGNATURE_GET_CONFIG		      0x87974060</span>
<span class="cp">#define ARCMSR_SIGNATURE_SET_CONFIG		      0x87974063</span>
<span class="cm">/* message code of inbound message register */</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_NOP		      0x00000000</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_GET_CONFIG		      0x00000001</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_SET_CONFIG               0x00000002</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_ABORT_CMD                0x00000003</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_STOP_BGRB                0x00000004</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_FLUSH_CACHE              0x00000005</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_START_BGRB               0x00000006</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_CHK331PENDING            0x00000007</span>
<span class="cp">#define ARCMSR_INBOUND_MESG0_SYNC_TIMER               0x00000008</span>
<span class="cm">/* doorbell interrupt generator */</span>
<span class="cp">#define ARCMSR_INBOUND_DRIVER_DATA_WRITE_OK           0x00000001</span>
<span class="cp">#define ARCMSR_INBOUND_DRIVER_DATA_READ_OK            0x00000002</span>
<span class="cp">#define ARCMSR_OUTBOUND_IOP331_DATA_WRITE_OK          0x00000001</span>
<span class="cp">#define ARCMSR_OUTBOUND_IOP331_DATA_READ_OK           0x00000002</span>
<span class="cm">/* ccb areca cdb flag */</span>
<span class="cp">#define ARCMSR_CCBPOST_FLAG_SGL_BSIZE                 0x80000000</span>
<span class="cp">#define ARCMSR_CCBPOST_FLAG_IAM_BIOS                  0x40000000</span>
<span class="cp">#define ARCMSR_CCBREPLY_FLAG_IAM_BIOS                 0x40000000</span>
<span class="cp">#define ARCMSR_CCBREPLY_FLAG_ERROR_MODE0              0x10000000</span>
<span class="cp">#define ARCMSR_CCBREPLY_FLAG_ERROR_MODE1              0x00000001</span>
<span class="cm">/* outbound firmware ok */</span>
<span class="cp">#define ARCMSR_OUTBOUND_MESG1_FIRMWARE_OK             0x80000000</span>
<span class="cm">/* ARC-1680 Bus Reset*/</span>
<span class="cp">#define ARCMSR_ARC1680_BUS_RESET				0x00000003</span>
<span class="cm">/* ARC-1880 Bus Reset*/</span>
<span class="cp">#define ARCMSR_ARC1880_RESET_ADAPTER				0x00000024</span>
<span class="cp">#define ARCMSR_ARC1880_DiagWrite_ENABLE			0x00000080</span>

<span class="cm">/*</span>
<span class="cm">************************************************************************</span>
<span class="cm">**                SPEC. for Areca Type B adapter</span>
<span class="cm">************************************************************************</span>
<span class="cm">*/</span>
<span class="cm">/* ARECA HBB COMMAND for its FIRMWARE */</span>
<span class="cm">/* window of &quot;instruction flags&quot; from driver to iop */</span>
<span class="cp">#define ARCMSR_DRV2IOP_DOORBELL                       0x00020400</span>
<span class="cp">#define ARCMSR_DRV2IOP_DOORBELL_MASK                  0x00020404</span>
<span class="cm">/* window of &quot;instruction flags&quot; from iop to driver */</span>
<span class="cp">#define ARCMSR_IOP2DRV_DOORBELL                       0x00020408</span>
<span class="cp">#define ARCMSR_IOP2DRV_DOORBELL_MASK                  0x0002040C</span>
<span class="cm">/* ARECA FLAG LANGUAGE */</span>
<span class="cm">/* ioctl transfer */</span>
<span class="cp">#define ARCMSR_IOP2DRV_DATA_WRITE_OK                  0x00000001</span>
<span class="cm">/* ioctl transfer */</span>
<span class="cp">#define ARCMSR_IOP2DRV_DATA_READ_OK                   0x00000002</span>
<span class="cp">#define ARCMSR_IOP2DRV_CDB_DONE                       0x00000004</span>
<span class="cp">#define ARCMSR_IOP2DRV_MESSAGE_CMD_DONE               0x00000008</span>

<span class="cp">#define ARCMSR_DOORBELL_HANDLE_INT		      0x0000000F</span>
<span class="cp">#define ARCMSR_DOORBELL_INT_CLEAR_PATTERN   	      0xFF00FFF0</span>
<span class="cp">#define ARCMSR_MESSAGE_INT_CLEAR_PATTERN	      0xFF00FFF7</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_GET_CONFIG&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_GET_CONFIG		      0x00010008</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_SET_CONFIG&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_SET_CONFIG		      0x00020008</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_ABORT_CMD&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_ABORT_CMD		      0x00030008</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_STOP_BGRB&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_STOP_BGRB		      0x00040008</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_FLUSH_CACHE&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_FLUSH_CACHE                    0x00050008</span>
<span class="cm">/* (ARCMSR_INBOUND_MESG0_START_BGRB&lt;&lt;16)|ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED) */</span>
<span class="cp">#define ARCMSR_MESSAGE_START_BGRB		      0x00060008</span>
<span class="cp">#define ARCMSR_MESSAGE_START_DRIVER_MODE	      0x000E0008</span>
<span class="cp">#define ARCMSR_MESSAGE_SET_POST_WINDOW		      0x000F0008</span>
<span class="cp">#define ARCMSR_MESSAGE_ACTIVE_EOI_MODE		    0x00100008</span>
<span class="cm">/* ARCMSR_OUTBOUND_MESG1_FIRMWARE_OK */</span>
<span class="cp">#define ARCMSR_MESSAGE_FIRMWARE_OK		      0x80000000</span>
<span class="cm">/* ioctl transfer */</span>
<span class="cp">#define ARCMSR_DRV2IOP_DATA_WRITE_OK                  0x00000001</span>
<span class="cm">/* ioctl transfer */</span>
<span class="cp">#define ARCMSR_DRV2IOP_DATA_READ_OK                   0x00000002</span>
<span class="cp">#define ARCMSR_DRV2IOP_CDB_POSTED                     0x00000004</span>
<span class="cp">#define ARCMSR_DRV2IOP_MESSAGE_CMD_POSTED             0x00000008</span>
<span class="cp">#define ARCMSR_DRV2IOP_END_OF_INTERRUPT		0x00000010</span>

<span class="cm">/* data tunnel buffer between user space program and its firmware */</span>
<span class="cm">/* user space data to iop 128bytes */</span>
<span class="cp">#define ARCMSR_MESSAGE_WBUFFER			      0x0000fe00</span>
<span class="cm">/* iop data to user space 128bytes */</span>
<span class="cp">#define ARCMSR_MESSAGE_RBUFFER			      0x0000ff00</span>
<span class="cm">/* iop message_rwbuffer for message command */</span>
<span class="cp">#define ARCMSR_MESSAGE_RWBUFFER			      0x0000fa00</span>
<span class="cm">/* </span>
<span class="cm">************************************************************************</span>
<span class="cm">**                SPEC. for Areca HBC adapter</span>
<span class="cm">************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define ARCMSR_HBC_ISR_THROTTLING_LEVEL		12</span>
<span class="cp">#define ARCMSR_HBC_ISR_MAX_DONE_QUEUE		20</span>
<span class="cm">/* Host Interrupt Mask */</span>
<span class="cp">#define ARCMSR_HBCMU_UTILITY_A_ISR_MASK		0x00000001 </span><span class="cm">/* When clear, the Utility_A interrupt routes to the host.*/</span><span class="cp"></span>
<span class="cp">#define ARCMSR_HBCMU_OUTBOUND_DOORBELL_ISR_MASK	0x00000004 </span><span class="cm">/* When clear, the General Outbound Doorbell interrupt routes to the host.*/</span><span class="cp"></span>
<span class="cp">#define ARCMSR_HBCMU_OUTBOUND_POSTQUEUE_ISR_MASK	0x00000008 </span><span class="cm">/* When clear, the Outbound Post List FIFO Not Empty interrupt routes to the host.*/</span><span class="cp"></span>
<span class="cp">#define ARCMSR_HBCMU_ALL_INTMASKENABLE		0x0000000D </span><span class="cm">/* disable all ISR */</span><span class="cp"></span>
<span class="cm">/* Host Interrupt Status */</span>
<span class="cp">#define ARCMSR_HBCMU_UTILITY_A_ISR			0x00000001</span>
	<span class="cm">/*</span>
<span class="cm">	** Set when the Utility_A Interrupt bit is set in the Outbound Doorbell Register.</span>
<span class="cm">	** It clears by writing a 1 to the Utility_A bit in the Outbound Doorbell Clear Register or through automatic clearing (if enabled).</span>
<span class="cm">	*/</span>
<span class="cp">#define ARCMSR_HBCMU_OUTBOUND_DOORBELL_ISR		0x00000004</span>
	<span class="cm">/*</span>
<span class="cm">	** Set if Outbound Doorbell register bits 30:1 have a non-zero</span>
<span class="cm">	** value. This bit clears only when Outbound Doorbell bits</span>
<span class="cm">	** 30:1 are ALL clear. Only a write to the Outbound Doorbell</span>
<span class="cm">	** Clear register clears bits in the Outbound Doorbell register.</span>
<span class="cm">	*/</span>
<span class="cp">#define ARCMSR_HBCMU_OUTBOUND_POSTQUEUE_ISR	0x00000008</span>
	<span class="cm">/*</span>
<span class="cm">	** Set whenever the Outbound Post List Producer/Consumer</span>
<span class="cm">	** Register (FIFO) is not empty. It clears when the Outbound</span>
<span class="cm">	** Post List FIFO is empty.</span>
<span class="cm">	*/</span>
<span class="cp">#define ARCMSR_HBCMU_SAS_ALL_INT			0x00000010</span>
	<span class="cm">/*</span>
<span class="cm">	** This bit indicates a SAS interrupt from a source external to</span>
<span class="cm">	** the PCIe core. This bit is not maskable.</span>
<span class="cm">	*/</span>
	<span class="cm">/* DoorBell*/</span>
<span class="cp">#define ARCMSR_HBCMU_DRV2IOP_DATA_WRITE_OK			0x00000002</span>
<span class="cp">#define ARCMSR_HBCMU_DRV2IOP_DATA_READ_OK			0x00000004</span>
	<span class="cm">/*inbound message 0 ready*/</span>
<span class="cp">#define ARCMSR_HBCMU_DRV2IOP_MESSAGE_CMD_DONE		0x00000008</span>
	<span class="cm">/*more than 12 request completed in a time*/</span>
<span class="cp">#define ARCMSR_HBCMU_DRV2IOP_POSTQUEUE_THROTTLING		0x00000010</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_DATA_WRITE_OK			0x00000002</span>
	<span class="cm">/*outbound DATA WRITE isr door bell clear*/</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_DATA_WRITE_DOORBELL_CLEAR	0x00000002</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_DATA_READ_OK			0x00000004</span>
	<span class="cm">/*outbound DATA READ isr door bell clear*/</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_DATA_READ_DOORBELL_CLEAR	0x00000004</span>
	<span class="cm">/*outbound message 0 ready*/</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_MESSAGE_CMD_DONE		0x00000008</span>
	<span class="cm">/*outbound message cmd isr door bell clear*/</span>
<span class="cp">#define ARCMSR_HBCMU_IOP2DRV_MESSAGE_CMD_DONE_DOORBELL_CLEAR	0x00000008</span>
	<span class="cm">/*ARCMSR_HBAMU_MESSAGE_FIRMWARE_OK*/</span>
<span class="cp">#define ARCMSR_HBCMU_MESSAGE_FIRMWARE_OK			0x80000000</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**    ARECA SCSI COMMAND DESCRIPTOR BLOCK size 0x1F8 (504)</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">ARCMSR_CDB</span>
<span class="p">{</span>
	<span class="kt">uint8_t</span>							<span class="n">Bus</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">TargetID</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">LUN</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">Function</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">CdbLength</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">sgcount</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">Flags</span><span class="p">;</span>
<span class="cp">#define ARCMSR_CDB_FLAG_SGL_BSIZE          0x01</span>
<span class="cp">#define ARCMSR_CDB_FLAG_BIOS               0x02</span>
<span class="cp">#define ARCMSR_CDB_FLAG_WRITE              0x04</span>
<span class="cp">#define ARCMSR_CDB_FLAG_SIMPLEQ            0x00</span>
<span class="cp">#define ARCMSR_CDB_FLAG_HEADQ              0x08</span>
<span class="cp">#define ARCMSR_CDB_FLAG_ORDEREDQ           0x10</span>

	<span class="kt">uint8_t</span>							<span class="n">msgPages</span><span class="p">;</span>
	<span class="kt">uint32_t</span>						<span class="n">Context</span><span class="p">;</span>
	<span class="kt">uint32_t</span>						<span class="n">DataLength</span><span class="p">;</span>
	<span class="kt">uint8_t</span>							<span class="n">Cdb</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="kt">uint8_t</span>							<span class="n">DeviceStatus</span><span class="p">;</span>
<span class="cp">#define ARCMSR_DEV_CHECK_CONDITION	    0x02</span>
<span class="cp">#define ARCMSR_DEV_SELECT_TIMEOUT	    0xF0</span>
<span class="cp">#define ARCMSR_DEV_ABORTED		    0xF1</span>
<span class="cp">#define ARCMSR_DEV_INIT_FAIL		    0xF2</span>

	<span class="kt">uint8_t</span>							<span class="n">SenseData</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
	<span class="k">union</span>
	<span class="p">{</span>
		<span class="k">struct</span> <span class="n">SG32ENTRY</span>                <span class="n">sg32entry</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">SG64ENTRY</span>                <span class="n">sg64entry</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**     Messaging Unit (MU) of the Intel R 80331 I/O processor(Type A) and Type B processor</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">MessageUnit_A</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">resrved0</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>			<span class="cm">/*0000 000F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_msgaddr0</span><span class="p">;</span>		<span class="cm">/*0010 0013*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_msgaddr1</span><span class="p">;</span>		<span class="cm">/*0014 0017*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_msgaddr0</span><span class="p">;</span>		<span class="cm">/*0018 001B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_msgaddr1</span><span class="p">;</span>		<span class="cm">/*001C 001F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_doorbell</span><span class="p">;</span>		<span class="cm">/*0020 0023*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_intstatus</span><span class="p">;</span>		<span class="cm">/*0024 0027*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_intmask</span><span class="p">;</span>		<span class="cm">/*0028 002B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_doorbell</span><span class="p">;</span>		<span class="cm">/*002C 002F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_intstatus</span><span class="p">;</span>		<span class="cm">/*0030 0033*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_intmask</span><span class="p">;</span>		<span class="cm">/*0034 0037*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>			<span class="cm">/*0038 003F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_queueport</span><span class="p">;</span>		<span class="cm">/*0040 0043*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_queueport</span><span class="p">;</span>     	<span class="cm">/*0044 0047*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>			<span class="cm">/*0048 004F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved3</span><span class="p">[</span><span class="mi">492</span><span class="p">];</span>			<span class="cm">/*0050 07FF 492*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved4</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>			<span class="cm">/*0800 09FF 128*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_rwbuffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>		<span class="cm">/*0a00 0DFF 256*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_wbuffer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>		<span class="cm">/*0E00 0E7F  32*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved5</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>			<span class="cm">/*0E80 0EFF  32*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_rbuffer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>		<span class="cm">/*0F00 0F7F  32*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved6</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>			<span class="cm">/*0F80 0FFF  32*/</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">MessageUnit_B</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">post_qbuffer</span><span class="p">[</span><span class="n">ARCMSR_MAX_HBB_POSTQUEUE</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">done_qbuffer</span><span class="p">[</span><span class="n">ARCMSR_MAX_HBB_POSTQUEUE</span><span class="p">];</span>
	<span class="kt">uint32_t</span>	<span class="n">postq_index</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">doneq_index</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">drv2iop_doorbell</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">drv2iop_doorbell_mask</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">iop2drv_doorbell</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">iop2drv_doorbell_mask</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">message_rwbuffer</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">message_wbuffer</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">message_rbuffer</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*********************************************************************</span>
<span class="cm">** LSI</span>
<span class="cm">*********************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">MessageUnit_C</span><span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">message_unit_status</span><span class="p">;</span>			<span class="cm">/*0000 0003*/</span>
	<span class="kt">uint32_t</span>	<span class="n">slave_error_attribute</span><span class="p">;</span>			<span class="cm">/*0004 0007*/</span>
	<span class="kt">uint32_t</span>	<span class="n">slave_error_address</span><span class="p">;</span>			<span class="cm">/*0008 000B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">posted_outbound_doorbell</span><span class="p">;</span>		<span class="cm">/*000C 000F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">master_error_attribute</span><span class="p">;</span>			<span class="cm">/*0010 0013*/</span>
	<span class="kt">uint32_t</span>	<span class="n">master_error_address_low</span><span class="p">;</span>		<span class="cm">/*0014 0017*/</span>
	<span class="kt">uint32_t</span>	<span class="n">master_error_address_high</span><span class="p">;</span>		<span class="cm">/*0018 001B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">hcb_size</span><span class="p">;</span>				<span class="cm">/*001C 001F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_doorbell</span><span class="p">;</span>			<span class="cm">/*0020 0023*/</span>
	<span class="kt">uint32_t</span>	<span class="n">diagnostic_rw_data</span><span class="p">;</span>			<span class="cm">/*0024 0027*/</span>
	<span class="kt">uint32_t</span>	<span class="n">diagnostic_rw_address_low</span><span class="p">;</span>		<span class="cm">/*0028 002B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">diagnostic_rw_address_high</span><span class="p">;</span>		<span class="cm">/*002C 002F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">host_int_status</span><span class="p">;</span>				<span class="cm">/*0030 0033*/</span>
	<span class="kt">uint32_t</span>	<span class="n">host_int_mask</span><span class="p">;</span>				<span class="cm">/*0034 0037*/</span>
	<span class="kt">uint32_t</span>	<span class="n">dcr_data</span><span class="p">;</span>				<span class="cm">/*0038 003B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">dcr_address</span><span class="p">;</span>				<span class="cm">/*003C 003F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_queueport</span><span class="p">;</span>			<span class="cm">/*0040 0043*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_queueport</span><span class="p">;</span>			<span class="cm">/*0044 0047*/</span>
	<span class="kt">uint32_t</span>	<span class="n">hcb_pci_address_low</span><span class="p">;</span>			<span class="cm">/*0048 004B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">hcb_pci_address_high</span><span class="p">;</span>			<span class="cm">/*004C 004F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_int_status</span><span class="p">;</span>				<span class="cm">/*0050 0053*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_int_mask</span><span class="p">;</span>				<span class="cm">/*0054 0057*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_inbound_queue_port</span><span class="p">;</span>			<span class="cm">/*0058 005B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_outbound_queue_port</span><span class="p">;</span>		<span class="cm">/*005C 005F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_free_list_index</span><span class="p">;</span>			<span class="cm">/*0060 0063*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_post_list_index</span><span class="p">;</span>			<span class="cm">/*0064 0067*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_free_list_index</span><span class="p">;</span>			<span class="cm">/*0068 006B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_post_list_index</span><span class="p">;</span>			<span class="cm">/*006C 006F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_doorbell_clear</span><span class="p">;</span>			<span class="cm">/*0070 0073*/</span>
	<span class="kt">uint32_t</span>	<span class="n">i2o_message_unit_control</span><span class="p">;</span>			<span class="cm">/*0074 0077*/</span>
	<span class="kt">uint32_t</span>	<span class="n">last_used_message_source_address_low</span><span class="p">;</span>	<span class="cm">/*0078 007B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">last_used_message_source_address_high</span><span class="p">;</span>	<span class="cm">/*007C 007F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">pull_mode_data_byte_count</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/*0080 008F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_dest_address_index</span><span class="p">;</span>		<span class="cm">/*0090 0093*/</span>
	<span class="kt">uint32_t</span>	<span class="n">done_queue_not_empty_int_counter_timer</span><span class="p">;</span>	<span class="cm">/*0094 0097*/</span>
	<span class="kt">uint32_t</span>	<span class="n">utility_A_int_counter_timer</span><span class="p">;</span>		<span class="cm">/*0098 009B*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_doorbell</span><span class="p">;</span>			<span class="cm">/*009C 009F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_doorbell_clear</span><span class="p">;</span>			<span class="cm">/*00A0 00A3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_source_address_index</span><span class="p">;</span>		<span class="cm">/*00A4 00A7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_done_queue_index</span><span class="p">;</span>		<span class="cm">/*00A8 00AB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved0</span><span class="p">;</span>				<span class="cm">/*00AC 00AF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_msgaddr0</span><span class="p">;</span>			<span class="cm">/*00B0 00B3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_msgaddr1</span><span class="p">;</span>			<span class="cm">/*00B4 00B7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_msgaddr0</span><span class="p">;</span>			<span class="cm">/*00B8 00BB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_msgaddr1</span><span class="p">;</span>			<span class="cm">/*00BC 00BF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_queueport_low</span><span class="p">;</span>			<span class="cm">/*00C0 00C3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">inbound_queueport_high</span><span class="p">;</span>			<span class="cm">/*00C4 00C7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_queueport_low</span><span class="p">;</span>			<span class="cm">/*00C8 00CB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">outbound_queueport_high</span><span class="p">;</span>		<span class="cm">/*00CC 00CF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_inbound_queue_port_low</span><span class="p">;</span>		<span class="cm">/*00D0 00D3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_inbound_queue_port_high</span><span class="p">;</span>		<span class="cm">/*00D4 00D7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_outbound_queue_port_low</span><span class="p">;</span>		<span class="cm">/*00D8 00DB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">iop_outbound_queue_port_high</span><span class="p">;</span>		<span class="cm">/*00DC 00DF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_dest_queue_port_low</span><span class="p">;</span>		<span class="cm">/*00E0 00E3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_dest_queue_port_high</span><span class="p">;</span>		<span class="cm">/*00E4 00E7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">last_used_message_dest_address_low</span><span class="p">;</span>	<span class="cm">/*00E8 00EB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">last_used_message_dest_address_high</span><span class="p">;</span>	<span class="cm">/*00EC 00EF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_done_queue_base_address_low</span><span class="p">;</span>	<span class="cm">/*00F0 00F3*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_done_queue_base_address_high</span><span class="p">;</span>	<span class="cm">/*00F4 00F7*/</span>
	<span class="kt">uint32_t</span>	<span class="n">host_diagnostic</span><span class="p">;</span>				<span class="cm">/*00F8 00FB*/</span>
	<span class="kt">uint32_t</span>	<span class="n">write_sequence</span><span class="p">;</span>				<span class="cm">/*00FC 00FF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">34</span><span class="p">];</span>				<span class="cm">/*0100 0187*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">1950</span><span class="p">];</span>				<span class="cm">/*0188 1FFF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_wbuffer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>			<span class="cm">/*2000 207F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved3</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>				<span class="cm">/*2080 20FF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">message_rbuffer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>			<span class="cm">/*2100 217F*/</span>
	<span class="kt">uint32_t</span>	<span class="n">reserved4</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>				<span class="cm">/*2180 21FF*/</span>
	<span class="kt">uint32_t</span>	<span class="n">msgcode_rwbuffer</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>			<span class="cm">/*2200 23FF*/</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**                 Adapter Control Block</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">AdapterControlBlock</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span>  <span class="n">adapter_type</span><span class="p">;</span>                <span class="cm">/* adapter A,B..... */</span>
	<span class="cp">#define ACB_ADAPTER_TYPE_A            0x00000001	</span><span class="cm">/* hba I IOP */</span><span class="cp"></span>
	<span class="cp">#define ACB_ADAPTER_TYPE_B            0x00000002	</span><span class="cm">/* hbb M IOP */</span><span class="cp"></span>
	<span class="cp">#define ACB_ADAPTER_TYPE_C            0x00000004	</span><span class="cm">/* hbc P IOP */</span><span class="cp"></span>
	<span class="cp">#define ACB_ADAPTER_TYPE_D            0x00000008	</span><span class="cm">/* hbd A IOP */</span><span class="cp"></span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span>		<span class="n">pdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span>		<span class="n">host</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>			<span class="n">vir2phy_offset</span><span class="p">;</span>
	<span class="cm">/* Offset is used in making arc cdb physical to virtual calculations */</span>
	<span class="kt">uint32_t</span>			<span class="n">outbound_int_enable</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">cdb_phyaddr_hi32</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">reg_mu_acc_handle0</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                      			<span class="n">eh_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                      			<span class="n">ccblist_lock</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">MessageUnit_A</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">pmuA</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">MessageUnit_B</span> 	<span class="o">*</span><span class="n">pmuB</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">MessageUnit_C</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">pmuC</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="cm">/* message unit ATU inbound base address0 */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mem_base0</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mem_base1</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">acb_flags</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">dev_id</span><span class="p">;</span>
	<span class="kt">uint8_t</span>                   		<span class="n">adapter_index</span><span class="p">;</span>
	<span class="cp">#define ACB_F_SCSISTOPADAPTER         	0x0001</span>
	<span class="cp">#define ACB_F_MSG_STOP_BGRB     	0x0002</span>
	<span class="cm">/* stop RAID background rebuild */</span>
	<span class="cp">#define ACB_F_MSG_START_BGRB          	0x0004</span>
	<span class="cm">/* stop RAID background rebuild */</span>
	<span class="cp">#define ACB_F_IOPDATA_OVERFLOW        	0x0008</span>
	<span class="cm">/* iop message data rqbuffer overflow */</span>
	<span class="cp">#define ACB_F_MESSAGE_WQBUFFER_CLEARED	0x0010</span>
	<span class="cm">/* message clear wqbuffer */</span>
	<span class="cp">#define ACB_F_MESSAGE_RQBUFFER_CLEARED  0x0020</span>
	<span class="cm">/* message clear rqbuffer */</span>
	<span class="cp">#define ACB_F_MESSAGE_WQBUFFER_READED   0x0040</span>
	<span class="cp">#define ACB_F_BUS_RESET               	0x0080</span>
	<span class="cp">#define ACB_F_BUS_HANG_ON		0x0800</span><span class="cm">/* need hardware reset bus */</span><span class="cp"></span>

	<span class="cp">#define ACB_F_IOP_INITED              	0x0100</span>
	<span class="cm">/* iop init */</span>
	<span class="cp">#define ACB_F_ABORT				0x0200</span>
	<span class="cp">#define ACB_F_FIRMWARE_TRAP           		0x0400</span>
	<span class="k">struct</span> <span class="n">CommandControlBlock</span> <span class="o">*</span>			<span class="n">pccb_pool</span><span class="p">[</span><span class="n">ARCMSR_MAX_FREECCB_NUM</span><span class="p">];</span>
	<span class="cm">/* used for memory free */</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">ccb_free_list</span><span class="p">;</span>
	<span class="cm">/* head of free ccb list */</span>

	<span class="n">atomic_t</span>			<span class="n">ccboutstandingcount</span><span class="p">;</span>
	<span class="cm">/*The present outstanding command number that in the IOP that</span>
<span class="cm">					waiting for being handled by FW*/</span>

	<span class="kt">void</span> <span class="o">*</span>				<span class="n">dma_coherent</span><span class="p">;</span>
	<span class="cm">/* dma_coherent used for memory free */</span>
	<span class="n">dma_addr_t</span>			<span class="n">dma_coherent_handle</span><span class="p">;</span>
	<span class="cm">/* dma_coherent_handle used for memory free */</span>
	<span class="n">dma_addr_t</span>				<span class="n">dma_coherent_handle_hbb_mu</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>				<span class="n">uncache_size</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">rqbuffer</span><span class="p">[</span><span class="n">ARCMSR_MAX_QBUFFER</span><span class="p">];</span>
	<span class="cm">/* data collection buffer for read from 80331 */</span>
	<span class="kt">int32_t</span>				<span class="n">rqbuf_firstindex</span><span class="p">;</span>
	<span class="cm">/* first of read buffer  */</span>
	<span class="kt">int32_t</span>				<span class="n">rqbuf_lastindex</span><span class="p">;</span>
	<span class="cm">/* last of read buffer   */</span>
	<span class="kt">uint8_t</span>				<span class="n">wqbuffer</span><span class="p">[</span><span class="n">ARCMSR_MAX_QBUFFER</span><span class="p">];</span>
	<span class="cm">/* data collection buffer for write to 80331  */</span>
	<span class="kt">int32_t</span>				<span class="n">wqbuf_firstindex</span><span class="p">;</span>
	<span class="cm">/* first of write buffer */</span>
	<span class="kt">int32_t</span>				<span class="n">wqbuf_lastindex</span><span class="p">;</span>
	<span class="cm">/* last of write buffer  */</span>
	<span class="kt">uint8_t</span>				<span class="n">devstate</span><span class="p">[</span><span class="n">ARCMSR_MAX_TARGETID</span><span class="p">][</span><span class="n">ARCMSR_MAX_TARGETLUN</span><span class="p">];</span>
	<span class="cm">/* id0 ..... id15, lun0...lun7 */</span>
<span class="cp">#define ARECA_RAID_GONE               0x55</span>
<span class="cp">#define ARECA_RAID_GOOD               0xaa</span>
	<span class="kt">uint32_t</span>			<span class="n">num_resets</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">num_aborts</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">signature</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">firm_request_len</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">firm_numbers_queue</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">firm_sdram_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span>			<span class="n">firm_hd_channels</span><span class="p">;</span>
	<span class="kt">uint32_t</span>                           	<span class="n">firm_cfg_version</span><span class="p">;</span>	
	<span class="kt">char</span>			<span class="n">firm_model</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="kt">char</span>			<span class="n">firm_version</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="kt">char</span>			<span class="n">device_map</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>			<span class="cm">/*21,84-99*/</span>
	<span class="k">struct</span> <span class="n">work_struct</span> 		<span class="n">arcmsr_do_message_isr_bh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>		<span class="n">eternal_timer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">fw_flag</span><span class="p">;</span>
				<span class="cp">#define	FW_NORMAL	0x0000</span>
				<span class="cp">#define	FW_BOG		0x0001</span>
				<span class="cp">#define	FW_DEADLOCK	0x0010</span>
	<span class="n">atomic_t</span> 			<span class="n">rq_map_token</span><span class="p">;</span>
	<span class="n">atomic_t</span>			<span class="n">ante_token_value</span><span class="p">;</span>
<span class="p">};</span><span class="cm">/* HW_DEVICE_EXTENSION */</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**                   Command Control Block</span>
<span class="cm">**             this CCB length must be 32 bytes boundary</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">CommandControlBlock</span><span class="p">{</span>
	<span class="cm">/*x32:sizeof struct_CCB=(32+60)byte, x64:sizeof struct_CCB=(64+60)byte*/</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">list</span><span class="p">;</span>				<span class="cm">/*x32: 8byte, x64: 16byte*/</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span>		<span class="o">*</span><span class="n">pcmd</span><span class="p">;</span>				<span class="cm">/*8 bytes pointer of linux scsi command */</span>
	<span class="k">struct</span> <span class="n">AdapterControlBlock</span>	<span class="o">*</span><span class="n">acb</span><span class="p">;</span>				<span class="cm">/*x32: 4byte, x64: 8byte*/</span>
	<span class="kt">uint32_t</span>			<span class="n">cdb_phyaddr_pattern</span><span class="p">;</span>		<span class="cm">/*x32: 4byte, x64: 4byte*/</span>
	<span class="kt">uint32_t</span>			<span class="n">arc_cdb_size</span><span class="p">;</span>			<span class="cm">/*x32:4byte,x64:4byte*/</span>
	<span class="kt">uint16_t</span>			<span class="n">ccb_flags</span><span class="p">;</span>			<span class="cm">/*x32: 2byte, x64: 2byte*/</span>
	<span class="cp">#define			CCB_FLAG_READ			0x0000</span>
	<span class="cp">#define			CCB_FLAG_WRITE		0x0001</span>
	<span class="cp">#define			CCB_FLAG_ERROR		0x0002</span>
	<span class="cp">#define			CCB_FLAG_FLUSHCACHE		0x0004</span>
	<span class="cp">#define			CCB_FLAG_MASTER_ABORTED	0x0008	</span>
	<span class="kt">uint16_t</span>                        	<span class="n">startdone</span><span class="p">;</span>			<span class="cm">/*x32:2byte,x32:2byte*/</span>
	<span class="cp">#define			ARCMSR_CCB_DONE   	        	0x0000</span>
	<span class="cp">#define			ARCMSR_CCB_START		0x55AA</span>
	<span class="cp">#define			ARCMSR_CCB_ABORTED		0xAA55</span>
	<span class="cp">#define			ARCMSR_CCB_ILLEGAL		0xFFFF</span>
	<span class="cp">#if BITS_PER_LONG == 64</span>
	<span class="cm">/*  ======================512+64 bytes========================  */</span>
		<span class="kt">uint32_t</span>                        	<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>		<span class="cm">/*24 byte*/</span>
	<span class="cp">#else</span>
	<span class="cm">/*  ======================512+32 bytes========================  */</span>
		<span class="kt">uint32_t</span>                        	<span class="n">reserved</span><span class="p">;</span>		<span class="cm">/*8  byte*/</span>
	<span class="cp">#endif</span>
	<span class="cm">/*  =======================================================   */</span>
	<span class="k">struct</span> <span class="n">ARCMSR_CDB</span>		<span class="n">arcmsr_cdb</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**    ARECA SCSI sense data</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">SENSE_DATA</span>
<span class="p">{</span>
	<span class="kt">uint8_t</span>				<span class="n">ErrorCode</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>
<span class="cp">#define SCSI_SENSE_CURRENT_ERRORS	0x70</span>
<span class="cp">#define SCSI_SENSE_DEFERRED_ERRORS	0x71</span>
	<span class="kt">uint8_t</span>				<span class="n">Valid</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">SegmentNumber</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">SenseKey</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">Reserved</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">IncorrectLength</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">EndOfMedia</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">FileMark</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">Information</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">uint8_t</span>				<span class="n">AdditionalSenseLength</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">CommandSpecificInformation</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">uint8_t</span>				<span class="n">AdditionalSenseCode</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">AdditionalSenseCodeQualifier</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">FieldReplaceableUnitCode</span><span class="p">;</span>
	<span class="kt">uint8_t</span>				<span class="n">SenseKeySpecific</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**  Outbound Interrupt Status Register - OISR</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_INTERRUPT_STATUS_REG                 0x30</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_PCI_INT                              0x10</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_POSTQUEUE_INT                        0x08</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_DOORBELL_INT                         0x04</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_MESSAGE1_INT                         0x02</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_MESSAGE0_INT                         0x01</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_HANDLE_INT                 \</span>
<span class="cp">                    (ARCMSR_MU_OUTBOUND_MESSAGE0_INT      \</span>
<span class="cp">                     |ARCMSR_MU_OUTBOUND_MESSAGE1_INT     \</span>
<span class="cp">                     |ARCMSR_MU_OUTBOUND_DOORBELL_INT     \</span>
<span class="cp">                     |ARCMSR_MU_OUTBOUND_POSTQUEUE_INT    \</span>
<span class="cp">                     |ARCMSR_MU_OUTBOUND_PCI_INT)</span>
<span class="cm">/*</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">**  Outbound Interrupt Mask Register - OIMR</span>
<span class="cm">*******************************************************************************</span>
<span class="cm">*/</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_INTERRUPT_MASK_REG                   0x34</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_PCI_INTMASKENABLE                    0x10</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_POSTQUEUE_INTMASKENABLE              0x08</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_DOORBELL_INTMASKENABLE               0x04</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_MESSAGE1_INTMASKENABLE               0x02</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_MESSAGE0_INTMASKENABLE               0x01</span>
<span class="cp">#define     ARCMSR_MU_OUTBOUND_ALL_INTMASKENABLE                    0x1F</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">arcmsr_post_ioctldata2iop</span><span class="p">(</span><span class="k">struct</span> <span class="n">AdapterControlBlock</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">arcmsr_iop_message_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">AdapterControlBlock</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">QBUFFER</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">arcmsr_get_iop_rqbuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">AdapterControlBlock</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">arcmsr_host_attrs</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">arcmsr_alloc_sysfs_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">AdapterControlBlock</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">arcmsr_free_sysfs_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">AdapterControlBlock</span> <span class="o">*</span><span class="n">acb</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
