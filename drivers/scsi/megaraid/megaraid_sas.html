<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › megaraid › megaraid_sas.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>megaraid_sas.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Linux MegaRAID driver for SAS based RAID controllers</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2009-2011  LSI Corporation.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or</span>
<span class="cm"> *  modify it under the terms of the GNU General Public License</span>
<span class="cm"> *  as published by the Free Software Foundation; either version 2</span>
<span class="cm"> *  of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> *  FILE: megaraid_sas.h</span>
<span class="cm"> *</span>
<span class="cm"> *  Authors: LSI Corporation</span>
<span class="cm"> *</span>
<span class="cm"> *  Send feedback to: &lt;megaraidlinux@lsi.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Mail to: LSI Corporation, 1621 Barber Lane, Milpitas, CA 95035</span>
<span class="cm"> *     ATTN: Linuxraid</span>
<span class="cm"> */</span>

<span class="cp">#ifndef LSI_MEGARAID_SAS_H</span>
<span class="cp">#define LSI_MEGARAID_SAS_H</span>

<span class="cm">/*</span>
<span class="cm"> * MegaRAID SAS Driver meta data</span>
<span class="cm"> */</span>
<span class="cp">#define MEGASAS_VERSION				&quot;00.00.06.15-rc1&quot;</span>
<span class="cp">#define MEGASAS_RELDATE				&quot;Mar. 19, 2012&quot;</span>
<span class="cp">#define MEGASAS_EXT_VERSION			&quot;Mon. Mar. 19 17:00:00 PDT 2012&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Device IDs</span>
<span class="cm"> */</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS1078R		0x0060</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS1078DE		0x007C</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_VERDE_ZCR		0x0413</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS1078GEN2		0x0078</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS0079GEN2		0x0079</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS0073SKINNY		0x0073</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_SAS0071SKINNY		0x0071</span>
<span class="cp">#define	PCI_DEVICE_ID_LSI_FUSION		0x005b</span>
<span class="cp">#define PCI_DEVICE_ID_LSI_INVADER		0x005d</span>

<span class="cm">/*</span>
<span class="cm"> * =====================================</span>
<span class="cm"> * MegaRAID SAS MFI firmware definitions</span>
<span class="cm"> * =====================================</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * MFI stands for  MegaRAID SAS FW Interface. This is just a moniker for </span>
<span class="cm"> * protocol between the software and firmware. Commands are issued using</span>
<span class="cm"> * &quot;message frames&quot;</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * FW posts its state in upper 4 bits of outbound_msg_0 register</span>
<span class="cm"> */</span>
<span class="cp">#define MFI_STATE_MASK				0xF0000000</span>
<span class="cp">#define MFI_STATE_UNDEFINED			0x00000000</span>
<span class="cp">#define MFI_STATE_BB_INIT			0x10000000</span>
<span class="cp">#define MFI_STATE_FW_INIT			0x40000000</span>
<span class="cp">#define MFI_STATE_WAIT_HANDSHAKE		0x60000000</span>
<span class="cp">#define MFI_STATE_FW_INIT_2			0x70000000</span>
<span class="cp">#define MFI_STATE_DEVICE_SCAN			0x80000000</span>
<span class="cp">#define MFI_STATE_BOOT_MESSAGE_PENDING		0x90000000</span>
<span class="cp">#define MFI_STATE_FLUSH_CACHE			0xA0000000</span>
<span class="cp">#define MFI_STATE_READY				0xB0000000</span>
<span class="cp">#define MFI_STATE_OPERATIONAL			0xC0000000</span>
<span class="cp">#define MFI_STATE_FAULT				0xF0000000</span>
<span class="cp">#define MFI_RESET_REQUIRED			0x00000001</span>
<span class="cp">#define MFI_RESET_ADAPTER			0x00000002</span>
<span class="cp">#define MEGAMFI_FRAME_SIZE			64</span>

<span class="cm">/*</span>
<span class="cm"> * During FW init, clear pending cmds &amp; reset state using inbound_msg_0</span>
<span class="cm"> *</span>
<span class="cm"> * ABORT	: Abort all pending cmds</span>
<span class="cm"> * READY	: Move from OPERATIONAL to READY state; discard queue info</span>
<span class="cm"> * MFIMODE	: Discard (possible) low MFA posted in 64-bit mode (??)</span>
<span class="cm"> * CLR_HANDSHAKE: FW is waiting for HANDSHAKE from BIOS or Driver</span>
<span class="cm"> * HOTPLUG	: Resume from Hotplug</span>
<span class="cm"> * MFI_STOP_ADP	: Send signal to FW to stop processing</span>
<span class="cm"> */</span>
<span class="cp">#define WRITE_SEQUENCE_OFFSET		(0x0000000FC) </span><span class="cm">/* I20 */</span><span class="cp"></span>
<span class="cp">#define HOST_DIAGNOSTIC_OFFSET		(0x000000F8)  </span><span class="cm">/* I20 */</span><span class="cp"></span>
<span class="cp">#define DIAG_WRITE_ENABLE			(0x00000080)</span>
<span class="cp">#define DIAG_RESET_ADAPTER			(0x00000004)</span>

<span class="cp">#define MFI_ADP_RESET				0x00000040</span>
<span class="cp">#define MFI_INIT_ABORT				0x00000001</span>
<span class="cp">#define MFI_INIT_READY				0x00000002</span>
<span class="cp">#define MFI_INIT_MFIMODE			0x00000004</span>
<span class="cp">#define MFI_INIT_CLEAR_HANDSHAKE		0x00000008</span>
<span class="cp">#define MFI_INIT_HOTPLUG			0x00000010</span>
<span class="cp">#define MFI_STOP_ADP				0x00000020</span>
<span class="cp">#define MFI_RESET_FLAGS				MFI_INIT_READY| \</span>
<span class="cp">						MFI_INIT_MFIMODE| \</span>
<span class="cp">						MFI_INIT_ABORT</span>

<span class="cm">/*</span>
<span class="cm"> * MFI frame flags</span>
<span class="cm"> */</span>
<span class="cp">#define MFI_FRAME_POST_IN_REPLY_QUEUE		0x0000</span>
<span class="cp">#define MFI_FRAME_DONT_POST_IN_REPLY_QUEUE	0x0001</span>
<span class="cp">#define MFI_FRAME_SGL32				0x0000</span>
<span class="cp">#define MFI_FRAME_SGL64				0x0002</span>
<span class="cp">#define MFI_FRAME_SENSE32			0x0000</span>
<span class="cp">#define MFI_FRAME_SENSE64			0x0004</span>
<span class="cp">#define MFI_FRAME_DIR_NONE			0x0000</span>
<span class="cp">#define MFI_FRAME_DIR_WRITE			0x0008</span>
<span class="cp">#define MFI_FRAME_DIR_READ			0x0010</span>
<span class="cp">#define MFI_FRAME_DIR_BOTH			0x0018</span>
<span class="cp">#define MFI_FRAME_IEEE                          0x0020</span>

<span class="cm">/*</span>
<span class="cm"> * Definition for cmd_status</span>
<span class="cm"> */</span>
<span class="cp">#define MFI_CMD_STATUS_POLL_MODE		0xFF</span>

<span class="cm">/*</span>
<span class="cm"> * MFI command opcodes</span>
<span class="cm"> */</span>
<span class="cp">#define MFI_CMD_INIT				0x00</span>
<span class="cp">#define MFI_CMD_LD_READ				0x01</span>
<span class="cp">#define MFI_CMD_LD_WRITE			0x02</span>
<span class="cp">#define MFI_CMD_LD_SCSI_IO			0x03</span>
<span class="cp">#define MFI_CMD_PD_SCSI_IO			0x04</span>
<span class="cp">#define MFI_CMD_DCMD				0x05</span>
<span class="cp">#define MFI_CMD_ABORT				0x06</span>
<span class="cp">#define MFI_CMD_SMP				0x07</span>
<span class="cp">#define MFI_CMD_STP				0x08</span>
<span class="cp">#define MFI_CMD_INVALID				0xff</span>

<span class="cp">#define MR_DCMD_CTRL_GET_INFO			0x01010000</span>
<span class="cp">#define MR_DCMD_LD_GET_LIST			0x03010000</span>

<span class="cp">#define MR_DCMD_CTRL_CACHE_FLUSH		0x01101000</span>
<span class="cp">#define MR_FLUSH_CTRL_CACHE			0x01</span>
<span class="cp">#define MR_FLUSH_DISK_CACHE			0x02</span>

<span class="cp">#define MR_DCMD_CTRL_SHUTDOWN			0x01050000</span>
<span class="cp">#define MR_DCMD_HIBERNATE_SHUTDOWN		0x01060000</span>
<span class="cp">#define MR_ENABLE_DRIVE_SPINDOWN		0x01</span>

<span class="cp">#define MR_DCMD_CTRL_EVENT_GET_INFO		0x01040100</span>
<span class="cp">#define MR_DCMD_CTRL_EVENT_GET			0x01040300</span>
<span class="cp">#define MR_DCMD_CTRL_EVENT_WAIT			0x01040500</span>
<span class="cp">#define MR_DCMD_LD_GET_PROPERTIES		0x03030000</span>

<span class="cp">#define MR_DCMD_CLUSTER				0x08000000</span>
<span class="cp">#define MR_DCMD_CLUSTER_RESET_ALL		0x08010100</span>
<span class="cp">#define MR_DCMD_CLUSTER_RESET_LD		0x08010200</span>
<span class="cp">#define MR_DCMD_PD_LIST_QUERY                   0x02010100</span>

<span class="cm">/*</span>
<span class="cm"> * MFI command completion codes</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">MFI_STAT</span> <span class="p">{</span>
	<span class="n">MFI_STAT_OK</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">MFI_STAT_INVALID_CMD</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">MFI_STAT_INVALID_DCMD</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">MFI_STAT_INVALID_PARAMETER</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">MFI_STAT_INVALID_SEQUENCE_NUMBER</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">MFI_STAT_ABORT_NOT_POSSIBLE</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">MFI_STAT_APP_HOST_CODE_NOT_FOUND</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="n">MFI_STAT_APP_IN_USE</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">MFI_STAT_APP_NOT_INITIALIZED</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">MFI_STAT_ARRAY_INDEX_INVALID</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">MFI_STAT_ARRAY_ROW_NOT_EMPTY</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">,</span>
	<span class="n">MFI_STAT_CONFIG_RESOURCE_CONFLICT</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">,</span>
	<span class="n">MFI_STAT_DEVICE_NOT_FOUND</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">,</span>
	<span class="n">MFI_STAT_DRIVE_TOO_SMALL</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_ALLOC_FAIL</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_BUSY</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_ERROR</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_IMAGE_BAD</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_IMAGE_INCOMPLETE</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_NOT_OPEN</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLASH_NOT_STARTED</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">MFI_STAT_FLUSH_FAILED</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="n">MFI_STAT_HOST_CODE_NOT_FOUNT</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_CC_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_INIT_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_LBA_OUT_OF_RANGE</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_MAX_CONFIGURED</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_NOT_OPTIMAL</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_RBLD_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_RECON_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_WRONG_RAID_LEVEL</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">,</span>
	<span class="n">MFI_STAT_MAX_SPARES_EXCEEDED</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">,</span>
	<span class="n">MFI_STAT_MEMORY_NOT_AVAILABLE</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">MFI_STAT_MFC_HW_ERROR</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">,</span>
	<span class="n">MFI_STAT_NO_HW_PRESENT</span> <span class="o">=</span> <span class="mh">0x22</span><span class="p">,</span>
	<span class="n">MFI_STAT_NOT_FOUND</span> <span class="o">=</span> <span class="mh">0x23</span><span class="p">,</span>
	<span class="n">MFI_STAT_NOT_IN_ENCL</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">,</span>
	<span class="n">MFI_STAT_PD_CLEAR_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">,</span>
	<span class="n">MFI_STAT_PD_TYPE_WRONG</span> <span class="o">=</span> <span class="mh">0x26</span><span class="p">,</span>
	<span class="n">MFI_STAT_PR_DISABLED</span> <span class="o">=</span> <span class="mh">0x27</span><span class="p">,</span>
	<span class="n">MFI_STAT_ROW_INDEX_INVALID</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>
	<span class="n">MFI_STAT_SAS_CONFIG_INVALID_ACTION</span> <span class="o">=</span> <span class="mh">0x29</span><span class="p">,</span>
	<span class="n">MFI_STAT_SAS_CONFIG_INVALID_DATA</span> <span class="o">=</span> <span class="mh">0x2a</span><span class="p">,</span>
	<span class="n">MFI_STAT_SAS_CONFIG_INVALID_PAGE</span> <span class="o">=</span> <span class="mh">0x2b</span><span class="p">,</span>
	<span class="n">MFI_STAT_SAS_CONFIG_INVALID_TYPE</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">,</span>
	<span class="n">MFI_STAT_SCSI_DONE_WITH_ERROR</span> <span class="o">=</span> <span class="mh">0x2d</span><span class="p">,</span>
	<span class="n">MFI_STAT_SCSI_IO_FAILED</span> <span class="o">=</span> <span class="mh">0x2e</span><span class="p">,</span>
	<span class="n">MFI_STAT_SCSI_RESERVATION_CONFLICT</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	<span class="n">MFI_STAT_SHUTDOWN_FAILED</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="n">MFI_STAT_TIME_NOT_SET</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="n">MFI_STAT_WRONG_STATE</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">,</span>
	<span class="n">MFI_STAT_LD_OFFLINE</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>
	<span class="n">MFI_STAT_PEER_NOTIFICATION_REJECTED</span> <span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
	<span class="n">MFI_STAT_PEER_NOTIFICATION_FAILED</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">,</span>
	<span class="n">MFI_STAT_RESERVATION_IN_PROGRESS</span> <span class="o">=</span> <span class="mh">0x36</span><span class="p">,</span>
	<span class="n">MFI_STAT_I2C_ERRORS_DETECTED</span> <span class="o">=</span> <span class="mh">0x37</span><span class="p">,</span>
	<span class="n">MFI_STAT_PCI_ERRORS_DETECTED</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>
	<span class="n">MFI_STAT_CONFIG_SEQ_MISMATCH</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">,</span>

	<span class="n">MFI_STAT_INVALID_STATUS</span> <span class="o">=</span> <span class="mh">0xFF</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Number of mailbox bytes in DCMD message frame</span>
<span class="cm"> */</span>
<span class="cp">#define MFI_MBOX_SIZE				12</span>

<span class="k">enum</span> <span class="n">MR_EVT_CLASS</span> <span class="p">{</span>

	<span class="n">MR_EVT_CLASS_DEBUG</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_PROGRESS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_INFO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_WARNING</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_CRITICAL</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_FATAL</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MR_EVT_CLASS_DEAD</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

<span class="p">};</span>

<span class="k">enum</span> <span class="n">MR_EVT_LOCALE</span> <span class="p">{</span>

	<span class="n">MR_EVT_LOCALE_LD</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_PD</span> <span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_ENCL</span> <span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_BBU</span> <span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_SAS</span> <span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_CTRL</span> <span class="o">=</span> <span class="mh">0x0020</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_CONFIG</span> <span class="o">=</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_CLUSTER</span> <span class="o">=</span> <span class="mh">0x0080</span><span class="p">,</span>
	<span class="n">MR_EVT_LOCALE_ALL</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">,</span>

<span class="p">};</span>

<span class="k">enum</span> <span class="n">MR_EVT_ARGS</span> <span class="p">{</span>

	<span class="n">MR_EVT_ARGS_NONE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_CDB_SENSE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_COUNT</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_LBA</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_OWNER</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_LBA_PD_LBA</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_PROG</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_STATE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_STRIP</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_ERR</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_LBA</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_LBA_LD</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_PROG</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_STATE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PCI</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_RATE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_STR</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_TIME</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_ECC</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_LD_PROP</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_SPARE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_INDEX</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_DIAG_PASS</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_DIAG_FAIL</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_LBA_LBA</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PORT_PHY</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_MISSING</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_ADDRESS</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_BITMAP</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_CONNECTOR</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_PD</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_FRU</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_PATHINFO</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_PD_POWER_STATE</span><span class="p">,</span>
	<span class="n">MR_EVT_ARGS_GENERIC</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * define constants for device list query options</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">MR_PD_QUERY_TYPE</span> <span class="p">{</span>
	<span class="n">MR_PD_QUERY_TYPE_ALL</span>                <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MR_PD_QUERY_TYPE_STATE</span>              <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MR_PD_QUERY_TYPE_POWER_STATE</span>        <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MR_PD_QUERY_TYPE_MEDIA_TYPE</span>         <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MR_PD_QUERY_TYPE_SPEED</span>              <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MR_PD_QUERY_TYPE_EXPOSED_TO_HOST</span>    <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define MR_EVT_CFG_CLEARED                              0x0004</span>
<span class="cp">#define MR_EVT_LD_STATE_CHANGE                          0x0051</span>
<span class="cp">#define MR_EVT_PD_INSERTED                              0x005b</span>
<span class="cp">#define MR_EVT_PD_REMOVED                               0x0070</span>
<span class="cp">#define MR_EVT_LD_CREATED                               0x008a</span>
<span class="cp">#define MR_EVT_LD_DELETED                               0x008b</span>
<span class="cp">#define MR_EVT_FOREIGN_CFG_IMPORTED                     0x00db</span>
<span class="cp">#define MR_EVT_LD_OFFLINE                               0x00fc</span>
<span class="cp">#define MR_EVT_CTRL_HOST_BUS_SCAN_REQUESTED             0x0152</span>
<span class="cp">#define MAX_LOGICAL_DRIVES				64</span>

<span class="k">enum</span> <span class="n">MR_PD_STATE</span> <span class="p">{</span>
	<span class="n">MR_PD_STATE_UNCONFIGURED_GOOD</span>   <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_UNCONFIGURED_BAD</span>    <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_HOT_SPARE</span>           <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_OFFLINE</span>             <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_FAILED</span>              <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_REBUILD</span>             <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_ONLINE</span>              <span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_COPYBACK</span>            <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">MR_PD_STATE_SYSTEM</span>              <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
 <span class="p">};</span>


 <span class="cm">/*</span>
<span class="cm"> * defines the physical drive address structure</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">MR_PD_ADDRESS</span> <span class="p">{</span>
	<span class="n">u16</span>     <span class="n">deviceId</span><span class="p">;</span>
	<span class="n">u16</span>     <span class="n">enclDeviceId</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span>  <span class="n">enclIndex</span><span class="p">;</span>
			<span class="n">u8</span>  <span class="n">slotNumber</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">mrPdAddress</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span>  <span class="n">enclPosition</span><span class="p">;</span>
			<span class="n">u8</span>  <span class="n">enclConnectorIndex</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">mrEnclAddress</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">u8</span>      <span class="n">scsiDevType</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u8</span>      <span class="n">connectedPortBitmap</span><span class="p">;</span>
		<span class="n">u8</span>      <span class="n">connectedPortNumbers</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">u64</span>     <span class="n">sasAddr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * defines the physical drive list structure</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">MR_PD_LIST</span> <span class="p">{</span>
	<span class="n">u32</span>             <span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">MR_PD_ADDRESS</span>   <span class="n">addr</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">megasas_pd_list</span> <span class="p">{</span>
	<span class="n">u16</span>             <span class="n">tid</span><span class="p">;</span>
	<span class="n">u8</span>             <span class="n">driveType</span><span class="p">;</span>
	<span class="n">u8</span>             <span class="n">driveState</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

 <span class="cm">/*</span>
<span class="cm"> * defines the logical drive reference structure</span>
<span class="cm"> */</span>
<span class="k">union</span>  <span class="n">MR_LD_REF</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span>      <span class="n">targetId</span><span class="p">;</span>
		<span class="n">u8</span>      <span class="n">reserved</span><span class="p">;</span>
		<span class="n">u16</span>     <span class="n">seqNum</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">u32</span>     <span class="n">ref</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * defines the logical drive list structure</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">MR_LD_LIST</span> <span class="p">{</span>
	<span class="n">u32</span>     <span class="n">ldCount</span><span class="p">;</span>
	<span class="n">u32</span>     <span class="n">reserved</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="k">union</span> <span class="n">MR_LD_REF</span>   <span class="n">ref</span><span class="p">;</span>
		<span class="n">u8</span>          <span class="n">state</span><span class="p">;</span>
		<span class="n">u8</span>          <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">u64</span>         <span class="n">size</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">ldList</span><span class="p">[</span><span class="n">MAX_LOGICAL_DRIVES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * SAS controller properties</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">megasas_ctrl_prop</span> <span class="p">{</span>

	<span class="n">u16</span> <span class="n">seq_num</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pred_fail_poll_interval</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">intr_throttle_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">intr_throttle_timeouts</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rebuild_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">patrol_read_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bgi_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cc_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">recon_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cache_flush_interval</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">spinup_drv_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">spinup_delay</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cluster_enable</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">coercion_mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">alarm_enable</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">disable_auto_rebuild</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">disable_battery_warn</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ecc_bucket_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ecc_bucket_leak_rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">restore_hotspare_on_insertion</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">expose_encl_devices</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">maintainPdFailHistory</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">disallowHostRequestReordering</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">abortCCOnError</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loadBalanceMode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">disableAutoDetectBackplane</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">snapVDSpace</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	* Add properties that can be controlled by</span>
<span class="cm">	* a bit in the following structure.</span>
<span class="cm">	*/</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span>     <span class="n">copyBackDisabled</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">SMARTerEnabled</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">prCorrectUnconfiguredAreas</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">useFdeOnly</span>                  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">disableNCQ</span>                  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">SSDSMARTerEnabled</span>           <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">SSDPatrolReadEnabled</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">enableSpinDownUnconfigured</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">autoEnhancedImport</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">enableSecretKeyControl</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">disableOnlineCtrlReset</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">allowBootWithPinnedCache</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">disableSpinDownHS</span>           <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">enableJBOD</span>                  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span>     <span class="n">reserved</span>                    <span class="o">:</span><span class="mi">18</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">OnOffProperties</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">autoSnapVDSpace</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">viewSpace</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">spinDownTime</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * SAS controller information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">megasas_ctrl_info</span> <span class="p">{</span>

	<span class="cm">/*</span>
<span class="cm">	 * PCI device information</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u16</span> <span class="n">vendor_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">device_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">sub_vendor_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">sub_device_id</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pci</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Host interface information</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u8</span> <span class="n">PCIX</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">PCIE</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">iSCSI</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">SAS_3G</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved_0</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">port_count</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">port_addr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">host_interface</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Device (backend) interface information</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u8</span> <span class="n">SPI</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">SAS_3G</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">SATA_1_5G</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">SATA_3G</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved_0</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">port_count</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">port_addr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">device_interface</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * List of components residing in flash. All str are null terminated</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">image_check_word</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">image_component_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">version</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">build_date</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">built_time</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">image_component</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * List of flash components that have been flashed on the card, but</span>
<span class="cm">	 * are not in use, pending reset of the adapter. This list will be</span>
<span class="cm">	 * empty if a flash operation has not occurred. All stings are null</span>
<span class="cm">	 * terminated</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">pending_image_component_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">version</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">build_date</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
		<span class="kt">char</span> <span class="n">build_time</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pending_image_component</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">max_arms</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_spans</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_arrays</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_lds</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">product_name</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">serial_no</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * Other physical/controller/operation information. Indicates the</span>
<span class="cm">	 * presence of the hardware</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">bbu</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">alarm</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">nvram</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">uart</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">28</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">hw_present</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">current_fw_time</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Maximum data transfer sizes</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">max_concurrent_cmds</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_sge_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_request_size</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Logical and physical device counts</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">ld_present_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ld_degraded_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ld_offline_count</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">pd_present_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pd_disk_present_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pd_disk_pred_failure_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pd_disk_failed_count</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Memory size information</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">nvram_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">memory_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flash_size</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Error counters</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">mem_correctable_error_count</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">mem_uncorrectable_error_count</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Cluster information</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="n">cluster_permitted</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cluster_active</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Additional max data transfer sizes</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">max_strips_per_io</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Controller capabilities structures</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">raid_level_0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">raid_level_1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">raid_level_5</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">raid_level_1E</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">raid_level_6</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">27</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">raid_levels</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">rbld_rate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cc_rate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">bgi_rate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">recon_rate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">patrol_rate</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">alarm_control</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cluster_supported</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">bbu</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">spanning_allowed</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">dedicated_hotspares</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">revertible_hotspares</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">foreign_config_import</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">self_diagnostic</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">mixed_redundancy_arr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">global_hot_spares</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">17</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">adapter_operations</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">read_policy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">write_policy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">io_policy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">access_policy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">disk_cache_policy</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">27</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_operations</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u8</span> <span class="n">min</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">max</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">stripe_sz_ops</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">force_online</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">force_offline</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">force_rebuild</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">29</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_operations</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>

		<span class="n">u32</span> <span class="n">ctrl_supports_sas</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">ctrl_supports_sata</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">allow_mix_in_encl</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">allow_mix_in_ld</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">allow_sata_in_cluster</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">27</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_mix_support</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Define ECC single-bit-error bucket information</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="n">ecc_bucket_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved_2</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * Include the controller properties (changeable items)</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">megasas_ctrl_prop</span> <span class="n">properties</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Define FW pkg version (set in envt v&#39;bles on OEM basis)</span>
<span class="cm">	 */</span>
	<span class="kt">char</span> <span class="n">package_version</span><span class="p">[</span><span class="mh">0x60</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">pad</span><span class="p">[</span><span class="mh">0x800</span> <span class="o">-</span> <span class="mh">0x6a0</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ===============================</span>
<span class="cm"> * MegaRAID SAS driver definitions</span>
<span class="cm"> * ===============================</span>
<span class="cm"> */</span>
<span class="cp">#define MEGASAS_MAX_PD_CHANNELS			2</span>
<span class="cp">#define MEGASAS_MAX_LD_CHANNELS			2</span>
<span class="cp">#define MEGASAS_MAX_CHANNELS			(MEGASAS_MAX_PD_CHANNELS + \</span>
<span class="cp">						MEGASAS_MAX_LD_CHANNELS)</span>
<span class="cp">#define MEGASAS_MAX_DEV_PER_CHANNEL		128</span>
<span class="cp">#define MEGASAS_DEFAULT_INIT_ID			-1</span>
<span class="cp">#define MEGASAS_MAX_LUN				8</span>
<span class="cp">#define MEGASAS_MAX_LD				64</span>
<span class="cp">#define MEGASAS_DEFAULT_CMD_PER_LUN		256</span>
<span class="cp">#define MEGASAS_MAX_PD                          (MEGASAS_MAX_PD_CHANNELS * \</span>
<span class="cp">						MEGASAS_MAX_DEV_PER_CHANNEL)</span>
<span class="cp">#define MEGASAS_MAX_LD_IDS			(MEGASAS_MAX_LD_CHANNELS * \</span>
<span class="cp">						MEGASAS_MAX_DEV_PER_CHANNEL)</span>

<span class="cp">#define MEGASAS_MAX_SECTORS                    (2*1024)</span>
<span class="cp">#define MEGASAS_MAX_SECTORS_IEEE		(2*128)</span>
<span class="cp">#define MEGASAS_DBG_LVL				1</span>

<span class="cp">#define MEGASAS_FW_BUSY				1</span>

<span class="cm">/* Frame Type */</span>
<span class="cp">#define IO_FRAME				0</span>
<span class="cp">#define PTHRU_FRAME				1</span>

<span class="cm">/*</span>
<span class="cm"> * When SCSI mid-layer calls driver&#39;s reset routine, driver waits for</span>
<span class="cm"> * MEGASAS_RESET_WAIT_TIME seconds for all outstanding IO to complete. Note</span>
<span class="cm"> * that the driver cannot _actually_ abort or reset pending commands. While</span>
<span class="cm"> * it is waiting for the commands to complete, it prints a diagnostic message</span>
<span class="cm"> * every MEGASAS_RESET_NOTICE_INTERVAL seconds</span>
<span class="cm"> */</span>
<span class="cp">#define MEGASAS_RESET_WAIT_TIME			180</span>
<span class="cp">#define MEGASAS_INTERNAL_CMD_WAIT_TIME		180</span>
<span class="cp">#define	MEGASAS_RESET_NOTICE_INTERVAL		5</span>
<span class="cp">#define MEGASAS_IOCTL_CMD			0</span>
<span class="cp">#define MEGASAS_DEFAULT_CMD_TIMEOUT		90</span>

<span class="cm">/*</span>
<span class="cm"> * FW reports the maximum of number of commands that it can accept (maximum</span>
<span class="cm"> * commands that can be outstanding) at any time. The driver must report a</span>
<span class="cm"> * lower number to the mid layer because it can issue a few internal commands</span>
<span class="cm"> * itself (E.g, AEN, abort cmd, IOCTLs etc). The number of commands it needs</span>
<span class="cm"> * is shown below</span>
<span class="cm"> */</span>
<span class="cp">#define MEGASAS_INT_CMDS			32</span>
<span class="cp">#define MEGASAS_SKINNY_INT_CMDS			5</span>

<span class="cp">#define MEGASAS_MAX_MSIX_QUEUES			16</span>
<span class="cm">/*</span>
<span class="cm"> * FW can accept both 32 and 64 bit SGLs. We want to allocate 32/64 bit</span>
<span class="cm"> * SGLs based on the size of dma_addr_t</span>
<span class="cm"> */</span>
<span class="cp">#define IS_DMA64				(sizeof(dma_addr_t) == 8)</span>

<span class="cp">#define MFI_XSCALE_OMR0_CHANGE_INTERRUPT		0x00000001</span>

<span class="cp">#define MFI_INTR_FLAG_REPLY_MESSAGE			0x00000001</span>
<span class="cp">#define MFI_INTR_FLAG_FIRMWARE_STATE_CHANGE		0x00000002</span>
<span class="cp">#define MFI_G2_OUTBOUND_DOORBELL_CHANGE_INTERRUPT	0x00000004</span>

<span class="cp">#define MFI_OB_INTR_STATUS_MASK			0x00000002</span>
<span class="cp">#define MFI_POLL_TIMEOUT_SECS			60</span>

<span class="cp">#define MFI_REPLY_1078_MESSAGE_INTERRUPT	0x80000000</span>
<span class="cp">#define MFI_REPLY_GEN2_MESSAGE_INTERRUPT	0x00000001</span>
<span class="cp">#define MFI_GEN2_ENABLE_INTERRUPT_MASK		(0x00000001 | 0x00000004)</span>
<span class="cp">#define MFI_REPLY_SKINNY_MESSAGE_INTERRUPT	0x40000000</span>
<span class="cp">#define MFI_SKINNY_ENABLE_INTERRUPT_MASK	(0x00000001)</span>

<span class="cp">#define MFI_1068_PCSR_OFFSET			0x84</span>
<span class="cp">#define MFI_1068_FW_HANDSHAKE_OFFSET		0x64</span>
<span class="cp">#define MFI_1068_FW_READY			0xDDDD0000</span>
<span class="cm">/*</span>
<span class="cm">* register set for both 1068 and 1078 controllers</span>
<span class="cm">* structure extended for 1078 registers</span>
<span class="cm">*/</span>
 
<span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">doorbell</span><span class="p">;</span>                       <span class="cm">/*0000h*/</span>
	<span class="n">u32</span>	<span class="n">fusion_seq_offset</span><span class="p">;</span>		<span class="cm">/*0004h*/</span>
	<span class="n">u32</span>	<span class="n">fusion_host_diag</span><span class="p">;</span>		<span class="cm">/*0008h*/</span>
	<span class="n">u32</span>	<span class="n">reserved_01</span><span class="p">;</span>			<span class="cm">/*000Ch*/</span>

	<span class="n">u32</span> 	<span class="n">inbound_msg_0</span><span class="p">;</span>			<span class="cm">/*0010h*/</span>
	<span class="n">u32</span> 	<span class="n">inbound_msg_1</span><span class="p">;</span>			<span class="cm">/*0014h*/</span>
	<span class="n">u32</span> 	<span class="n">outbound_msg_0</span><span class="p">;</span>			<span class="cm">/*0018h*/</span>
	<span class="n">u32</span> 	<span class="n">outbound_msg_1</span><span class="p">;</span>			<span class="cm">/*001Ch*/</span>

	<span class="n">u32</span> 	<span class="n">inbound_doorbell</span><span class="p">;</span>		<span class="cm">/*0020h*/</span>
	<span class="n">u32</span> 	<span class="n">inbound_intr_status</span><span class="p">;</span>		<span class="cm">/*0024h*/</span>
	<span class="n">u32</span> 	<span class="n">inbound_intr_mask</span><span class="p">;</span>		<span class="cm">/*0028h*/</span>

	<span class="n">u32</span> 	<span class="n">outbound_doorbell</span><span class="p">;</span>		<span class="cm">/*002Ch*/</span>
	<span class="n">u32</span> 	<span class="n">outbound_intr_status</span><span class="p">;</span>		<span class="cm">/*0030h*/</span>
	<span class="n">u32</span> 	<span class="n">outbound_intr_mask</span><span class="p">;</span>		<span class="cm">/*0034h*/</span>

	<span class="n">u32</span> 	<span class="n">reserved_1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>			<span class="cm">/*0038h*/</span>

	<span class="n">u32</span> 	<span class="n">inbound_queue_port</span><span class="p">;</span>		<span class="cm">/*0040h*/</span>
	<span class="n">u32</span> 	<span class="n">outbound_queue_port</span><span class="p">;</span>		<span class="cm">/*0044h*/</span>

	<span class="n">u32</span>	<span class="n">reserved_2</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>			<span class="cm">/*0048h*/</span>
	<span class="n">u32</span>	<span class="n">reply_post_host_index</span><span class="p">;</span>		<span class="cm">/*006Ch*/</span>
	<span class="n">u32</span>	<span class="n">reserved_2_2</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>		<span class="cm">/*0070h*/</span>

	<span class="n">u32</span> 	<span class="n">outbound_doorbell_clear</span><span class="p">;</span>	<span class="cm">/*00A0h*/</span>

	<span class="n">u32</span> 	<span class="n">reserved_3</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>			<span class="cm">/*00A4h*/</span>

	<span class="n">u32</span> 	<span class="n">outbound_scratch_pad</span> <span class="p">;</span>		<span class="cm">/*00B0h*/</span>
	<span class="n">u32</span>	<span class="n">outbound_scratch_pad_2</span><span class="p">;</span>         <span class="cm">/*00B4h*/</span>

	<span class="n">u32</span>	<span class="n">reserved_4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>			<span class="cm">/*00B8h*/</span>

	<span class="n">u32</span> 	<span class="n">inbound_low_queue_port</span> <span class="p">;</span>	<span class="cm">/*00C0h*/</span>

	<span class="n">u32</span> 	<span class="n">inbound_high_queue_port</span> <span class="p">;</span>	<span class="cm">/*00C4h*/</span>

	<span class="n">u32</span> 	<span class="n">reserved_5</span><span class="p">;</span>			<span class="cm">/*00C8h*/</span>
	<span class="n">u32</span>	<span class="n">res_6</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>			<span class="cm">/*CCh*/</span>
	<span class="n">u32</span>	<span class="n">host_diag</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">seq_offset</span><span class="p">;</span>
	<span class="n">u32</span> 	<span class="n">index_registers</span><span class="p">[</span><span class="mi">807</span><span class="p">];</span>		<span class="cm">/*00CCh*/</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_sge32</span> <span class="p">{</span>

	<span class="n">u32</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_sge64</span> <span class="p">{</span>

	<span class="n">u64</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_sge_skinny</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flag</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">union</span> <span class="n">megasas_sgl</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">megasas_sge32</span> <span class="n">sge32</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">megasas_sge64</span> <span class="n">sge64</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">megasas_sge_skinny</span> <span class="n">sge_skinny</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_header</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">sense_len</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">scsi_status</span><span class="p">;</span>		<span class="cm">/*03h */</span>

	<span class="n">u8</span> <span class="n">target_id</span><span class="p">;</span>		<span class="cm">/*04h */</span>
	<span class="n">u8</span> <span class="n">lun</span><span class="p">;</span>			<span class="cm">/*05h */</span>
	<span class="n">u8</span> <span class="n">cdb_len</span><span class="p">;</span>		<span class="cm">/*06h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>
	<span class="n">u32</span> <span class="n">data_xferlen</span><span class="p">;</span>	<span class="cm">/*14h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">union</span> <span class="n">megasas_sgl_frame</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">megasas_sge32</span> <span class="n">sge32</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">megasas_sge64</span> <span class="n">sge64</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_init_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">reserved_0</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>

	<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">;</span>		<span class="cm">/*03h */</span>
	<span class="n">u32</span> <span class="n">reserved_2</span><span class="p">;</span>		<span class="cm">/*04h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">reserved_3</span><span class="p">;</span>		<span class="cm">/*12h */</span>
	<span class="n">u32</span> <span class="n">data_xfer_len</span><span class="p">;</span>	<span class="cm">/*14h */</span>

	<span class="n">u32</span> <span class="n">queue_info_new_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">queue_info_new_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*1Ch */</span>
	<span class="n">u32</span> <span class="n">queue_info_old_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*20h */</span>
	<span class="n">u32</span> <span class="n">queue_info_old_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*24h */</span>

	<span class="n">u32</span> <span class="n">reserved_4</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/*28h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_init_queue_info</span> <span class="p">{</span>

	<span class="n">u32</span> <span class="n">init_flags</span><span class="p">;</span>		<span class="cm">/*00h */</span>
	<span class="n">u32</span> <span class="n">reply_queue_entries</span><span class="p">;</span>	<span class="cm">/*04h */</span>

	<span class="n">u32</span> <span class="n">reply_queue_start_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">reply_queue_start_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*0Ch */</span>
	<span class="n">u32</span> <span class="n">producer_index_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*10h */</span>
	<span class="n">u32</span> <span class="n">producer_index_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*14h */</span>
	<span class="n">u32</span> <span class="n">consumer_index_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">consumer_index_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*1Ch */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_io_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">sense_len</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">scsi_status</span><span class="p">;</span>		<span class="cm">/*03h */</span>

	<span class="n">u8</span> <span class="n">target_id</span><span class="p">;</span>		<span class="cm">/*04h */</span>
	<span class="n">u8</span> <span class="n">access_byte</span><span class="p">;</span>		<span class="cm">/*05h */</span>
	<span class="n">u8</span> <span class="n">reserved_0</span><span class="p">;</span>		<span class="cm">/*06h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>
	<span class="n">u32</span> <span class="n">lba_count</span><span class="p">;</span>		<span class="cm">/*14h */</span>

	<span class="n">u32</span> <span class="n">sense_buf_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">sense_buf_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*1Ch */</span>

	<span class="n">u32</span> <span class="n">start_lba_lo</span><span class="p">;</span>	<span class="cm">/*20h */</span>
	<span class="n">u32</span> <span class="n">start_lba_hi</span><span class="p">;</span>	<span class="cm">/*24h */</span>

	<span class="k">union</span> <span class="n">megasas_sgl</span> <span class="n">sgl</span><span class="p">;</span>	<span class="cm">/*28h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_pthru_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">sense_len</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">scsi_status</span><span class="p">;</span>		<span class="cm">/*03h */</span>

	<span class="n">u8</span> <span class="n">target_id</span><span class="p">;</span>		<span class="cm">/*04h */</span>
	<span class="n">u8</span> <span class="n">lun</span><span class="p">;</span>			<span class="cm">/*05h */</span>
	<span class="n">u8</span> <span class="n">cdb_len</span><span class="p">;</span>		<span class="cm">/*06h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>
	<span class="n">u32</span> <span class="n">data_xfer_len</span><span class="p">;</span>	<span class="cm">/*14h */</span>

	<span class="n">u32</span> <span class="n">sense_buf_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">sense_buf_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*1Ch */</span>

	<span class="n">u8</span> <span class="n">cdb</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/*20h */</span>
	<span class="k">union</span> <span class="n">megasas_sgl</span> <span class="n">sgl</span><span class="p">;</span>	<span class="cm">/*30h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_dcmd_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">reserved_0</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/*03h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>

	<span class="n">u32</span> <span class="n">data_xfer_len</span><span class="p">;</span>	<span class="cm">/*14h */</span>
	<span class="n">u32</span> <span class="n">opcode</span><span class="p">;</span>		<span class="cm">/*18h */</span>

	<span class="k">union</span> <span class="p">{</span>			<span class="cm">/*1Ch */</span>
		<span class="n">u8</span> <span class="n">b</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
		<span class="n">u16</span> <span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
		<span class="n">u32</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">mbox</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">megasas_sgl</span> <span class="n">sgl</span><span class="p">;</span>	<span class="cm">/*28h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_abort_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">reserved_0</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>

	<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">;</span>		<span class="cm">/*03h */</span>
	<span class="n">u32</span> <span class="n">reserved_2</span><span class="p">;</span>		<span class="cm">/*04h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">reserved_3</span><span class="p">;</span>		<span class="cm">/*12h */</span>
	<span class="n">u32</span> <span class="n">reserved_4</span><span class="p">;</span>		<span class="cm">/*14h */</span>

	<span class="n">u32</span> <span class="n">abort_context</span><span class="p">;</span>	<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">pad_1</span><span class="p">;</span>		<span class="cm">/*1Ch */</span>

	<span class="n">u32</span> <span class="n">abort_mfi_phys_addr_lo</span><span class="p">;</span>	<span class="cm">/*20h */</span>
	<span class="n">u32</span> <span class="n">abort_mfi_phys_addr_hi</span><span class="p">;</span>	<span class="cm">/*24h */</span>

	<span class="n">u32</span> <span class="n">reserved_5</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/*28h */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_smp_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">connection_status</span><span class="p">;</span>	<span class="cm">/*03h */</span>

	<span class="n">u8</span> <span class="n">reserved_2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/*04h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>

	<span class="n">u32</span> <span class="n">data_xfer_len</span><span class="p">;</span>	<span class="cm">/*14h */</span>
	<span class="n">u64</span> <span class="n">sas_addr</span><span class="p">;</span>		<span class="cm">/*18h */</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">megasas_sge32</span> <span class="n">sge32</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* [0]: resp [1]: req */</span>
		<span class="k">struct</span> <span class="n">megasas_sge64</span> <span class="n">sge64</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* [0]: resp [1]: req */</span>
	<span class="p">}</span> <span class="n">sgl</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_stp_frame</span> <span class="p">{</span>

	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/*00h */</span>
	<span class="n">u8</span> <span class="n">reserved_1</span><span class="p">;</span>		<span class="cm">/*01h */</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>		<span class="cm">/*02h */</span>
	<span class="n">u8</span> <span class="n">reserved_2</span><span class="p">;</span>		<span class="cm">/*03h */</span>

	<span class="n">u8</span> <span class="n">target_id</span><span class="p">;</span>		<span class="cm">/*04h */</span>
	<span class="n">u8</span> <span class="n">reserved_3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/*05h */</span>
	<span class="n">u8</span> <span class="n">sge_count</span><span class="p">;</span>		<span class="cm">/*07h */</span>

	<span class="n">u32</span> <span class="n">context</span><span class="p">;</span>		<span class="cm">/*08h */</span>
	<span class="n">u32</span> <span class="n">pad_0</span><span class="p">;</span>		<span class="cm">/*0Ch */</span>

	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/*10h */</span>
	<span class="n">u16</span> <span class="n">timeout</span><span class="p">;</span>		<span class="cm">/*12h */</span>

	<span class="n">u32</span> <span class="n">data_xfer_len</span><span class="p">;</span>	<span class="cm">/*14h */</span>

	<span class="n">u16</span> <span class="n">fis</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>		<span class="cm">/*18h */</span>
	<span class="n">u32</span> <span class="n">stp_flags</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">megasas_sge32</span> <span class="n">sge32</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* [0]: resp [1]: data */</span>
		<span class="k">struct</span> <span class="n">megasas_sge64</span> <span class="n">sge64</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* [0]: resp [1]: data */</span>
	<span class="p">}</span> <span class="n">sgl</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">union</span> <span class="n">megasas_frame</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">megasas_header</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_init_frame</span> <span class="n">init</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_io_frame</span> <span class="n">io</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_pthru_frame</span> <span class="n">pthru</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_dcmd_frame</span> <span class="n">dcmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_abort_frame</span> <span class="n">abort</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_smp_frame</span> <span class="n">smp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_stp_frame</span> <span class="n">stp</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">raw_bytes</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">megasas_cmd</span><span class="p">;</span>

<span class="k">union</span> <span class="n">megasas_evt_class_locale</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">locale</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
		<span class="n">s8</span> <span class="n">class</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">members</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">word</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_evt_log_info</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">newest_seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">oldest_seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">clear_seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">shutdown_seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">boot_seq_num</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_progress</span> <span class="p">{</span>

	<span class="n">u16</span> <span class="n">progress</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">elapsed_seconds</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="p">{</span>

	<span class="n">u16</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ld_index</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">device_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">encl_index</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">slot_number</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_evt_detail</span> <span class="p">{</span>

	<span class="n">u32</span> <span class="n">seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">time_stamp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">code</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">megasas_evt_class_locale</span> <span class="n">cl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">arg_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">cdb_length</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">sense_length</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">u8</span> <span class="n">cdb</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
			<span class="n">u8</span> <span class="n">sense</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">cdbSense</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">count</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_count</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">lba</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_lba</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">prevOwner</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">newOwner</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_owner</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">ld_lba</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">pd_lba</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_lba_pd_lba</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_progress</span> <span class="n">prog</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_prog</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">prev_state</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">new_state</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_state</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">strip</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ld_strip</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_err</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">lba</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_lba</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">lba</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_ld</span> <span class="n">ld</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_lba_ld</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">megasas_progress</span> <span class="n">prog</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_prog</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">megasas_evtarg_pd</span> <span class="n">pd</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">prevState</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">newState</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pd_state</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u16</span> <span class="n">vendorId</span><span class="p">;</span>
			<span class="n">u16</span> <span class="n">deviceId</span><span class="p">;</span>
			<span class="n">u16</span> <span class="n">subVendorId</span><span class="p">;</span>
			<span class="n">u16</span> <span class="n">subDeviceId</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">pci</span><span class="p">;</span>

		<span class="n">u32</span> <span class="n">rate</span><span class="p">;</span>
		<span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">96</span><span class="p">];</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">rtc</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">elapsedSeconds</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">time</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">ecar</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">elog</span><span class="p">;</span>
			<span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">ecc</span><span class="p">;</span>

		<span class="n">u8</span> <span class="n">b</span><span class="p">[</span><span class="mi">96</span><span class="p">];</span>
		<span class="n">u16</span> <span class="n">s</span><span class="p">[</span><span class="mi">48</span><span class="p">];</span>
		<span class="n">u32</span> <span class="n">w</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
		<span class="n">u64</span> <span class="n">d</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">args</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">description</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_aen_event</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">hotplug_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="n">instance</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">megasas_irq_context</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="n">instance</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">MSIxIndex</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">megasas_instance</span> <span class="p">{</span>

	<span class="n">u32</span> <span class="o">*</span><span class="n">producer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">producer_h</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">consumer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">consumer_h</span><span class="p">;</span>

	<span class="n">u32</span> <span class="o">*</span><span class="n">reply_queue</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">reply_queue_h</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">base_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_set</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">megasas_pd_list</span>          <span class="n">pd_list</span><span class="p">[</span><span class="n">MEGASAS_MAX_PD</span><span class="p">];</span>
	<span class="n">u8</span>     <span class="n">ld_ids</span><span class="p">[</span><span class="n">MEGASAS_MAX_LD_IDS</span><span class="p">];</span>
	<span class="n">s8</span> <span class="n">init_id</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">max_num_sge</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_fw_cmds</span><span class="p">;</span>
	<span class="cm">/* For Fusion its num IOCTL cmds, for others MFI based its</span>
<span class="cm">	   max_fw_cmds */</span>
	<span class="n">u16</span> <span class="n">max_mfi_cmds</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_sectors_per_req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_aen_event</span> <span class="o">*</span><span class="n">ev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">megasas_cmd</span> <span class="o">**</span><span class="n">cmd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">cmd_pool</span><span class="p">;</span>
	<span class="cm">/* used to sync fire the cmd to fw */</span>
	<span class="n">spinlock_t</span> <span class="n">cmd_pool_lock</span><span class="p">;</span>
	<span class="cm">/* used to sync fire the cmd to fw */</span>
	<span class="n">spinlock_t</span> <span class="n">hba_lock</span><span class="p">;</span>
	<span class="cm">/* used to synch producer, consumer ptrs in dpc */</span>
	<span class="n">spinlock_t</span> <span class="n">completion_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">frame_dma_pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_pool</span> <span class="o">*</span><span class="n">sense_dma_pool</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">megasas_evt_detail</span> <span class="o">*</span><span class="n">evt_detail</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">evt_detail_h</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_cmd</span> <span class="o">*</span><span class="n">aen_cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">aen_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span> <span class="n">ioctl_sem</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>

	<span class="n">wait_queue_head_t</span> <span class="n">int_cmd_wait_q</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">abort_cmd_wait_q</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">unique_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fw_support_ieee</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">fw_outstanding</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">fw_reset_no_pci_access</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">megasas_instance_template</span> <span class="o">*</span><span class="n">instancet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">isr_tasklet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">work_init</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">flag</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">unload</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flag_ieee</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">issuepend_done</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">disableOnlineCtrlReset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">adprecovery</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mfiStatus</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_seq_num</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">internal_reset_pending_q</span><span class="p">;</span>

	<span class="cm">/* Ptr to hba specific information */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">ctrl_context</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">msix_vectors</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">msix_entry</span> <span class="n">msixentry</span><span class="p">[</span><span class="n">MEGASAS_MAX_MSIX_QUEUES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">megasas_irq_context</span> <span class="n">irq_context</span><span class="p">[</span><span class="n">MEGASAS_MAX_MSIX_QUEUES</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">map_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_cmd</span> <span class="o">*</span><span class="n">map_update_cmd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bar</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">reset_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">reset_mutex</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MEGASAS_HBA_OPERATIONAL</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MEGASAS_ADPRESET_SM_INFAULT</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MEGASAS_ADPRESET_SM_FW_RESET_SUCCESS</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MEGASAS_ADPRESET_SM_OPERATIONAL</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MEGASAS_HW_CRITICAL_ERROR</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MEGASAS_ADPRESET_INPROG_SIGN</span>		<span class="o">=</span> <span class="mh">0xDEADDEAD</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">megasas_instance_template</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fire_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="p">,</span> <span class="n">dma_addr_t</span><span class="p">,</span> \
		<span class="n">u32</span><span class="p">,</span> <span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_intr</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)</span> <span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_intr</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_intr</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>

	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">read_fw_status_reg</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">adp_reset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="p">,</span> \
		<span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check_reset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="p">,</span> \
		<span class="k">struct</span> <span class="n">megasas_register_set</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>
	<span class="n">irqreturn_t</span> <span class="p">(</span><span class="o">*</span><span class="n">service_isr</span><span class="p">)(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">devp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tasklet</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">init_adapter</span><span class="p">)(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">build_and_issue_cmd</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">issue_dcmd</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="n">instance</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">megasas_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define MEGASAS_IS_LOGICAL(scp)						\</span>
<span class="cp">	(scp-&gt;device-&gt;channel &lt; MEGASAS_MAX_PD_CHANNELS) ? 0 : 1</span>

<span class="cp">#define MEGASAS_DEV_INDEX(inst, scp)					\</span>
<span class="cp">	((scp-&gt;device-&gt;channel % 2) * MEGASAS_MAX_DEV_PER_CHANNEL) + 	\</span>
<span class="cp">	scp-&gt;device-&gt;id</span>

<span class="k">struct</span> <span class="n">megasas_cmd</span> <span class="p">{</span>

	<span class="k">union</span> <span class="n">megasas_frame</span> <span class="o">*</span><span class="n">frame</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">frame_phys_addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">sense</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">sense_phys_addr</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sync_cmd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cmd_status</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">abort_aen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">retry_for_fw_reset</span><span class="p">;</span>


	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">scmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="n">instance</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u16</span> <span class="n">smid</span><span class="p">;</span>
			<span class="n">u16</span> <span class="n">resvd</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">context</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">frame_count</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="cp">#define MAX_MGMT_ADAPTERS		1024</span>
<span class="cp">#define MAX_IOCTL_SGE			16</span>

<span class="k">struct</span> <span class="n">megasas_iocpacket</span> <span class="p">{</span>

	<span class="n">u16</span> <span class="n">host_no</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">__pad1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sgl_off</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sge_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sense_off</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sense_len</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">raw</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">megasas_header</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">frame</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">iovec</span> <span class="n">sgl</span><span class="p">[</span><span class="n">MAX_IOCTL_SGE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">megasas_aen</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">host_no</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">__pad1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">seq_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">class_locale_word</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#ifdef CONFIG_COMPAT</span>
<span class="k">struct</span> <span class="n">compat_megasas_iocpacket</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">host_no</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">__pad1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sgl_off</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sge_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sense_off</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sense_len</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">raw</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">megasas_header</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">frame</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">compat_iovec</span> <span class="n">sgl</span><span class="p">[</span><span class="n">MAX_IOCTL_SGE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define MEGASAS_IOC_FIRMWARE32	_IOWR(&#39;M&#39;, 1, struct compat_megasas_iocpacket)</span>
<span class="cp">#endif</span>

<span class="cp">#define MEGASAS_IOC_FIRMWARE	_IOWR(&#39;M&#39;, 1, struct megasas_iocpacket)</span>
<span class="cp">#define MEGASAS_IOC_GET_AEN	_IOW(&#39;M&#39;, 3, struct megasas_aen)</span>

<span class="k">struct</span> <span class="n">megasas_mgmt_info</span> <span class="p">{</span>

	<span class="n">u16</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">megasas_instance</span> <span class="o">*</span><span class="n">instance</span><span class="p">[</span><span class="n">MAX_MGMT_ADAPTERS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">max_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define msi_control_reg(base) (base + PCI_MSI_FLAGS)</span>
<span class="cp">#define PCI_MSIX_FLAGS_ENABLE (1 &lt;&lt; 15)</span>

<span class="cp">#endif				</span><span class="cm">/*LSI_MEGARAID_SAS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
