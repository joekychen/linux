<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › hpsa_cmd.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>hpsa_cmd.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *    Disk Array driver for HP Smart Array SAS controllers</span>
<span class="cm"> *    Copyright 2000, 2009 Hewlett-Packard Development Company, L.P.</span>
<span class="cm"> *</span>
<span class="cm"> *    This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *    it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *    the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> *    This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *    MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, GOOD TITLE or</span>
<span class="cm"> *    NON INFRINGEMENT.  See the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *    You should have received a copy of the GNU General Public License</span>
<span class="cm"> *    along with this program; if not, write to the Free Software</span>
<span class="cm"> *    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> *    Questions/Comments/Bugfixes to iss_storagedev@hp.com</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef HPSA_CMD_H</span>
<span class="cp">#define HPSA_CMD_H</span>

<span class="cm">/* general boundary defintions */</span>
<span class="cp">#define SENSEINFOBYTES          32 </span><span class="cm">/* may vary between hbas */</span><span class="cp"></span>
<span class="cp">#define SG_ENTRIES_IN_CMD	32 </span><span class="cm">/* Max SG entries excluding chain blocks */</span><span class="cp"></span>
<span class="cp">#define HPSA_SG_CHAIN		0x80000000</span>
<span class="cp">#define MAXREPLYQS              256</span>

<span class="cm">/* Command Status value */</span>
<span class="cp">#define CMD_SUCCESS             0x0000</span>
<span class="cp">#define CMD_TARGET_STATUS       0x0001</span>
<span class="cp">#define CMD_DATA_UNDERRUN       0x0002</span>
<span class="cp">#define CMD_DATA_OVERRUN        0x0003</span>
<span class="cp">#define CMD_INVALID             0x0004</span>
<span class="cp">#define CMD_PROTOCOL_ERR        0x0005</span>
<span class="cp">#define CMD_HARDWARE_ERR        0x0006</span>
<span class="cp">#define CMD_CONNECTION_LOST     0x0007</span>
<span class="cp">#define CMD_ABORTED             0x0008</span>
<span class="cp">#define CMD_ABORT_FAILED        0x0009</span>
<span class="cp">#define CMD_UNSOLICITED_ABORT   0x000A</span>
<span class="cp">#define CMD_TIMEOUT             0x000B</span>
<span class="cp">#define CMD_UNABORTABLE		0x000C</span>

<span class="cm">/* Unit Attentions ASC&#39;s as defined for the MSA2012sa */</span>
<span class="cp">#define POWER_OR_RESET			0x29</span>
<span class="cp">#define STATE_CHANGED			0x2a</span>
<span class="cp">#define UNIT_ATTENTION_CLEARED		0x2f</span>
<span class="cp">#define LUN_FAILED			0x3e</span>
<span class="cp">#define REPORT_LUNS_CHANGED		0x3f</span>

<span class="cm">/* Unit Attentions ASCQ&#39;s as defined for the MSA2012sa */</span>

	<span class="cm">/* These ASCQ&#39;s defined for ASC = POWER_OR_RESET */</span>
<span class="cp">#define POWER_ON_RESET			0x00</span>
<span class="cp">#define POWER_ON_REBOOT			0x01</span>
<span class="cp">#define SCSI_BUS_RESET			0x02</span>
<span class="cp">#define MSA_TARGET_RESET		0x03</span>
<span class="cp">#define CONTROLLER_FAILOVER		0x04</span>
<span class="cp">#define TRANSCEIVER_SE			0x05</span>
<span class="cp">#define TRANSCEIVER_LVD			0x06</span>

	<span class="cm">/* These ASCQ&#39;s defined for ASC = STATE_CHANGED */</span>
<span class="cp">#define RESERVATION_PREEMPTED		0x03</span>
<span class="cp">#define ASYM_ACCESS_CHANGED		0x06</span>
<span class="cp">#define LUN_CAPACITY_CHANGED		0x09</span>

<span class="cm">/* transfer direction */</span>
<span class="cp">#define XFER_NONE               0x00</span>
<span class="cp">#define XFER_WRITE              0x01</span>
<span class="cp">#define XFER_READ               0x02</span>
<span class="cp">#define XFER_RSVD               0x03</span>

<span class="cm">/* task attribute */</span>
<span class="cp">#define ATTR_UNTAGGED           0x00</span>
<span class="cp">#define ATTR_SIMPLE             0x04</span>
<span class="cp">#define ATTR_HEADOFQUEUE        0x05</span>
<span class="cp">#define ATTR_ORDERED            0x06</span>
<span class="cp">#define ATTR_ACA                0x07</span>

<span class="cm">/* cdb type */</span>
<span class="cp">#define TYPE_CMD				0x00</span>
<span class="cp">#define TYPE_MSG				0x01</span>

<span class="cm">/* Message Types  */</span>
<span class="cp">#define HPSA_TASK_MANAGEMENT    0x00</span>
<span class="cp">#define HPSA_RESET              0x01</span>
<span class="cp">#define HPSA_SCAN               0x02</span>
<span class="cp">#define HPSA_NOOP               0x03</span>

<span class="cp">#define HPSA_CTLR_RESET_TYPE    0x00</span>
<span class="cp">#define HPSA_BUS_RESET_TYPE     0x01</span>
<span class="cp">#define HPSA_TARGET_RESET_TYPE  0x03</span>
<span class="cp">#define HPSA_LUN_RESET_TYPE     0x04</span>
<span class="cp">#define HPSA_NEXUS_RESET_TYPE   0x05</span>

<span class="cm">/* Task Management Functions */</span>
<span class="cp">#define HPSA_TMF_ABORT_TASK     0x00</span>
<span class="cp">#define HPSA_TMF_ABORT_TASK_SET 0x01</span>
<span class="cp">#define HPSA_TMF_CLEAR_ACA      0x02</span>
<span class="cp">#define HPSA_TMF_CLEAR_TASK_SET 0x03</span>
<span class="cp">#define HPSA_TMF_QUERY_TASK     0x04</span>
<span class="cp">#define HPSA_TMF_QUERY_TASK_SET 0x05</span>
<span class="cp">#define HPSA_TMF_QUERY_ASYNCEVENT 0x06</span>



<span class="cm">/* config space register offsets */</span>
<span class="cp">#define CFG_VENDORID            0x00</span>
<span class="cp">#define CFG_DEVICEID            0x02</span>
<span class="cp">#define CFG_I2OBAR              0x10</span>
<span class="cp">#define CFG_MEM1BAR             0x14</span>

<span class="cm">/* i2o space register offsets */</span>
<span class="cp">#define I2O_IBDB_SET            0x20</span>
<span class="cp">#define I2O_IBDB_CLEAR          0x70</span>
<span class="cp">#define I2O_INT_STATUS          0x30</span>
<span class="cp">#define I2O_INT_MASK            0x34</span>
<span class="cp">#define I2O_IBPOST_Q            0x40</span>
<span class="cp">#define I2O_OBPOST_Q            0x44</span>
<span class="cp">#define I2O_DMA1_CFG		0x214</span>

<span class="cm">/* Configuration Table */</span>
<span class="cp">#define CFGTBL_ChangeReq        0x00000001l</span>
<span class="cp">#define CFGTBL_AccCmds          0x00000001l</span>
<span class="cp">#define DOORBELL_CTLR_RESET	0x00000004l</span>
<span class="cp">#define DOORBELL_CTLR_RESET2	0x00000020l</span>

<span class="cp">#define CFGTBL_Trans_Simple     0x00000002l</span>
<span class="cp">#define CFGTBL_Trans_Performant 0x00000004l</span>
<span class="cp">#define CFGTBL_Trans_use_short_tags 0x20000000l</span>
<span class="cp">#define CFGTBL_Trans_enable_directed_msix (1 &lt;&lt; 30)</span>

<span class="cp">#define CFGTBL_BusType_Ultra2   0x00000001l</span>
<span class="cp">#define CFGTBL_BusType_Ultra3   0x00000002l</span>
<span class="cp">#define CFGTBL_BusType_Fibre1G  0x00000100l</span>
<span class="cp">#define CFGTBL_BusType_Fibre2G  0x00000200l</span>
<span class="k">struct</span> <span class="n">vals32</span> <span class="p">{</span>
	<span class="n">u32</span>   <span class="n">lower</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">upper</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">u64bit</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">vals32</span> <span class="n">val32</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* FIXME this is a per controller value (barf!) */</span>
<span class="cp">#define HPSA_MAX_LUN 1024</span>
<span class="cp">#define HPSA_MAX_PHYS_LUN 1024</span>
<span class="cp">#define MAX_EXT_TARGETS 32</span>
<span class="cp">#define HPSA_MAX_DEVICES (HPSA_MAX_PHYS_LUN + HPSA_MAX_LUN + \</span>
<span class="cp">	MAX_EXT_TARGETS + 1) </span><span class="cm">/* + 1 is for the controller itself */</span><span class="cp"></span>

<span class="cm">/* SCSI-3 Commands */</span>
<span class="cp">#pragma pack(1)</span>

<span class="cp">#define HPSA_INQUIRY 0x12</span>
<span class="k">struct</span> <span class="n">InquiryData</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">data_byte</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define HPSA_REPORT_LOG 0xc2    </span><span class="cm">/* Report Logical LUNs */</span><span class="cp"></span>
<span class="cp">#define HPSA_REPORT_PHYS 0xc3   </span><span class="cm">/* Report Physical LUNs */</span><span class="cp"></span>
<span class="k">struct</span> <span class="n">ReportLUNdata</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">LUNListLength</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">LUN</span><span class="p">[</span><span class="n">HPSA_MAX_LUN</span><span class="p">][</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ReportExtendedLUNdata</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">LUNListLength</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">extended_response_flag</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">LUN</span><span class="p">[</span><span class="n">HPSA_MAX_LUN</span><span class="p">][</span><span class="mi">24</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SenseSubsystem_info</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">portname</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">1108</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* BMIC commands */</span>
<span class="cp">#define BMIC_READ 0x26</span>
<span class="cp">#define BMIC_WRITE 0x27</span>
<span class="cp">#define BMIC_CACHE_FLUSH 0xc2</span>
<span class="cp">#define HPSA_CACHE_FLUSH 0x01	</span><span class="cm">/* C2 was already being used by HPSA */</span><span class="cp"></span>
<span class="cp">#define BMIC_FLASH_FIRMWARE 0xF7</span>

<span class="cm">/* Command List Structure */</span>
<span class="k">union</span> <span class="n">SCSI3Addr</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">Dev</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Bus</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>        <span class="cm">/* b00 */</span>
	<span class="p">}</span> <span class="n">PeripDev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">DevLSB</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">DevMSB</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>        <span class="cm">/* b01 */</span>
	<span class="p">}</span> <span class="n">LogDev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">Dev</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Bus</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Targ</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>        <span class="cm">/* b10 */</span>
	<span class="p">}</span> <span class="n">LogUnit</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">PhysDevAddr</span> <span class="p">{</span>
	<span class="n">u32</span>             <span class="n">TargetId</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">Bus</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">Mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="cm">/* 2 level target device addr */</span>
	<span class="k">union</span> <span class="n">SCSI3Addr</span>  <span class="n">Target</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">LogDevAddr</span> <span class="p">{</span>
	<span class="n">u32</span>            <span class="n">VolId</span><span class="o">:</span><span class="mi">30</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">Mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u8</span>             <span class="n">reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">LUNAddr</span> <span class="p">{</span>
	<span class="n">u8</span>               <span class="n">LunAddrBytes</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="k">union</span> <span class="n">SCSI3Addr</span>    <span class="n">SCSI3Lun</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">PhysDevAddr</span> <span class="n">PhysDev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">LogDevAddr</span>  <span class="n">LogDev</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">CommandListHeader</span> <span class="p">{</span>
	<span class="n">u8</span>              <span class="n">ReplyQueue</span><span class="p">;</span>
	<span class="n">u8</span>              <span class="n">SGList</span><span class="p">;</span>
	<span class="n">u16</span>             <span class="n">SGTotal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vals32</span>     <span class="n">Tag</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">LUNAddr</span>     <span class="n">LUN</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">RequestBlock</span> <span class="p">{</span>
	<span class="n">u8</span>   <span class="n">CDBLen</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">Type</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Attribute</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">Direction</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">Type</span><span class="p">;</span>
	<span class="n">u16</span>  <span class="n">Timeout</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">CDB</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ErrDescriptor</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">vals32</span> <span class="n">Addr</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">Len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SGDescriptor</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">vals32</span> <span class="n">Addr</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">Len</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">Ext</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">MoreErrInfo</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span>  <span class="n">Reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">u8</span>  <span class="n">Type</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">ErrorInfo</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">Common_Info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span>  <span class="n">Reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
		<span class="n">u8</span>  <span class="n">offense_size</span><span class="p">;</span> <span class="cm">/* size of offending entry */</span>
		<span class="n">u8</span>  <span class="n">offense_num</span><span class="p">;</span>  <span class="cm">/* byte # of offense 0-base */</span>
		<span class="n">u32</span> <span class="n">offense_value</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">Invalid_Cmd</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">ErrorInfo</span> <span class="p">{</span>
	<span class="n">u8</span>               <span class="n">ScsiStatus</span><span class="p">;</span>
	<span class="n">u8</span>               <span class="n">SenseLen</span><span class="p">;</span>
	<span class="n">u16</span>              <span class="n">CommandStatus</span><span class="p">;</span>
	<span class="n">u32</span>              <span class="n">ResidualCnt</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">MoreErrInfo</span>  <span class="n">MoreErrInfo</span><span class="p">;</span>
	<span class="n">u8</span>               <span class="n">SenseInfo</span><span class="p">[</span><span class="n">SENSEINFOBYTES</span><span class="p">];</span>
<span class="p">};</span>
<span class="cm">/* Command types */</span>
<span class="cp">#define CMD_IOCTL_PEND  0x01</span>
<span class="cp">#define CMD_SCSI	0x03</span>

<span class="cp">#define DIRECT_LOOKUP_SHIFT 5</span>
<span class="cp">#define DIRECT_LOOKUP_BIT 0x10</span>
<span class="cp">#define DIRECT_LOOKUP_MASK (~((1 &lt;&lt; DIRECT_LOOKUP_SHIFT) - 1))</span>

<span class="cp">#define HPSA_ERROR_BIT          0x02</span>
<span class="k">struct</span> <span class="n">ctlr_info</span><span class="p">;</span> <span class="cm">/* defined in hpsa.h */</span>
<span class="cm">/* The size of this structure needs to be divisible by 32</span>
<span class="cm"> * on all architectures because low 5 bits of the addresses</span>
<span class="cm"> * are used as follows:</span>
<span class="cm"> *</span>
<span class="cm"> * bit 0: to device, used to indicate &quot;performant mode&quot; command</span>
<span class="cm"> *        from device, indidcates error status.</span>
<span class="cm"> * bit 1-3: to device, indicates block fetch table entry for</span>
<span class="cm"> *          reducing DMA in fetching commands from host memory.</span>
<span class="cm"> * bit 4: used to indicate whether tag is &quot;direct lookup&quot; (index),</span>
<span class="cm"> *        or a bus address.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">CommandList</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">CommandListHeader</span> <span class="n">Header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">RequestBlock</span>      <span class="n">Request</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ErrDescriptor</span>     <span class="n">ErrDesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SGDescriptor</span>      <span class="n">SG</span><span class="p">[</span><span class="n">SG_ENTRIES_IN_CMD</span><span class="p">];</span>
	<span class="cm">/* information associated with the command */</span>
	<span class="n">u32</span>			   <span class="n">busaddr</span><span class="p">;</span> <span class="cm">/* physical addr of this record */</span>
	<span class="k">struct</span> <span class="n">ErrorInfo</span> <span class="o">*</span><span class="n">err_info</span><span class="p">;</span> <span class="cm">/* pointer to the allocated mem */</span>
	<span class="k">struct</span> <span class="n">ctlr_info</span>	   <span class="o">*</span><span class="n">h</span><span class="p">;</span>
	<span class="kt">int</span>			   <span class="n">cmd_type</span><span class="p">;</span>
	<span class="kt">long</span>			   <span class="n">cmdindex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="o">*</span><span class="n">waiting</span><span class="p">;</span>
	<span class="kt">void</span>   <span class="o">*</span><span class="n">scsi_cmd</span><span class="p">;</span>

<span class="cm">/* on 64 bit architectures, to get this to be 32-byte-aligned</span>
<span class="cm"> * it so happens we need PAD_64 bytes of padding, on 32 bit systems,</span>
<span class="cm"> * we need PAD_32 bytes of padding (see below).   This does that.</span>
<span class="cm"> * If it happens that 64 bit and 32 bit systems need different</span>
<span class="cm"> * padding, PAD_32 and PAD_64 can be set independently, and.</span>
<span class="cm"> * the code below will do the right thing.</span>
<span class="cm"> */</span>
<span class="cp">#define IS_32_BIT ((8 - sizeof(long))/4)</span>
<span class="cp">#define IS_64_BIT (!IS_32_BIT)</span>
<span class="cp">#define PAD_32 (4)</span>
<span class="cp">#define PAD_64 (4)</span>
<span class="cp">#define COMMANDLIST_PAD (IS_32_BIT * PAD_32 + IS_64_BIT * PAD_64)</span>
	<span class="n">u8</span> <span class="n">pad</span><span class="p">[</span><span class="n">COMMANDLIST_PAD</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Configuration Table Structure */</span>
<span class="k">struct</span> <span class="n">HostWrite</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">TransportRequest</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Reserved</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">CoalIntDelay</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">CoalIntCount</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SIMPLE_MODE     0x02</span>
<span class="cp">#define PERFORMANT_MODE 0x04</span>
<span class="cp">#define MEMQ_MODE       0x08</span>

<span class="k">struct</span> <span class="n">CfgTable</span> <span class="p">{</span>
	<span class="n">u8</span>            <span class="n">Signature</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">SpecValence</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">TransportSupport</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">TransportActive</span><span class="p">;</span>
	<span class="k">struct</span> 		<span class="n">HostWrite</span> <span class="n">HostWrite</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">CmdsOutMax</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">BusTypes</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">TransMethodOffset</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">ServerName</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span>           <span class="n">HeartBeat</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">SCSI_Prefetch</span><span class="p">;</span>
	<span class="n">u32</span>	 	<span class="n">MaxScatterGatherElements</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">MaxLogicalUnits</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">MaxPhysicalDevices</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">MaxPhysicalDrivesPerLogicalUnit</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">MaxPerformantModeCommands</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">MaxBlockFetch</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">PowerConservationSupport</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">PowerConservationEnable</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">TMFSupportFlags</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">TMFTagMask</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">reserved</span><span class="p">[</span><span class="mh">0x78</span> <span class="o">-</span> <span class="mh">0x70</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">misc_fw_support</span><span class="p">;</span> <span class="cm">/* offset 0x78 */</span>
<span class="cp">#define			MISC_FW_DOORBELL_RESET (0x02)</span>
<span class="cp">#define			MISC_FW_DOORBELL_RESET2 (0x010)</span>
	<span class="n">u8</span>		<span class="n">driver_version</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

<span class="p">};</span>

<span class="cp">#define NUM_BLOCKFETCH_ENTRIES 8</span>
<span class="k">struct</span> <span class="n">TransTable_struct</span> <span class="p">{</span>
	<span class="n">u32</span>            <span class="n">BlockFetch</span><span class="p">[</span><span class="n">NUM_BLOCKFETCH_ENTRIES</span><span class="p">];</span>
	<span class="n">u32</span>            <span class="n">RepQSize</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">RepQCount</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">RepQCtrAddrLow32</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">RepQCtrAddrHigh32</span><span class="p">;</span>
<span class="cp">#define MAX_REPLY_QUEUES 8</span>
	<span class="k">struct</span> <span class="n">vals32</span>  <span class="n">RepQAddr</span><span class="p">[</span><span class="n">MAX_REPLY_QUEUES</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hpsa_pci_info</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">bus</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">dev_fn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">domain</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">board_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#pragma pack()</span>
<span class="cp">#endif </span><span class="cm">/* HPSA_CMD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
