<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › dpti.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>dpti.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***************************************************************************</span>
<span class="cm">                          dpti.h  -  description</span>
<span class="cm">                             -------------------</span>
<span class="cm">    begin                : Thu Sep 7 2000</span>
<span class="cm">    copyright            : (C) 2001 by Adaptec</span>

<span class="cm">    See Documentation/scsi/dpti.txt for history, notes, license info</span>
<span class="cm">    and credits</span>
<span class="cm"> ***************************************************************************/</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> *                                                                         *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify  *</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by  *</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="cm"> *   (at your option) any later version.                                   *</span>
<span class="cm"> *                                                                         *</span>
<span class="cm"> ***************************************************************************/</span>

<span class="cp">#ifndef _DPT_H</span>
<span class="cp">#define _DPT_H</span>

<span class="cp">#define MAX_TO_IOP_MESSAGES   (255)</span>
<span class="cp">#define MAX_FROM_IOP_MESSAGES (255)</span>


<span class="cm">/*</span>
<span class="cm"> * SCSI interface function Prototypes</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_host_template</span> <span class="o">*</span> <span class="n">sht</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_abort</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_slave_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">adpt_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">pSHost</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_bios_param</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span> <span class="n">sdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		<span class="n">sector_t</span><span class="p">,</span> <span class="kt">int</span> <span class="n">geom</span><span class="p">[]);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_bus_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_device_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>


<span class="cm">/*</span>
<span class="cm"> * struct scsi_host_template (see scsi/scsi_host.h)</span>
<span class="cm"> */</span>

<span class="cp">#define DPT_DRIVER_NAME	&quot;Adaptec I2O RAID&quot;</span>

<span class="cp">#ifndef HOSTS_C</span>

<span class="cp">#include &quot;dpt/sys_info.h&quot;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &quot;dpt/dpti_i2o.h&quot;</span>
<span class="cp">#include &quot;dpt/dpti_ioctl.h&quot;</span>

<span class="cp">#define DPT_I2O_VERSION &quot;2.4 Build 5go&quot;</span>
<span class="cp">#define DPT_VERSION     2</span>
<span class="cp">#define DPT_REVISION    &#39;4&#39;</span>
<span class="cp">#define DPT_SUBREVISION &#39;5&#39;</span>
<span class="cp">#define DPT_BETA	&quot;&quot;</span>
<span class="cp">#define DPT_MONTH      8 </span>
<span class="cp">#define DPT_DAY        7</span>
<span class="cp">#define DPT_YEAR        (2001-1980)</span>

<span class="cp">#define DPT_DRIVER	&quot;dpt_i2o&quot;</span>
<span class="cp">#define DPTI_I2O_MAJOR	(151)</span>
<span class="cp">#define DPT_ORGANIZATION_ID (0x1B)        </span><span class="cm">/* For Private Messages */</span><span class="cp"></span>
<span class="cp">#define DPTI_MAX_HBA	(16)</span>
<span class="cp">#define MAX_CHANNEL     (5)	</span><span class="c1">// Maximum Channel # Supported</span>
<span class="cp">#define MAX_ID        	(128)	</span><span class="c1">// Maximum Target ID Supported</span>

<span class="cm">/* Sizes in 4 byte words */</span>
<span class="cp">#define REPLY_FRAME_SIZE  (17)</span>
<span class="cp">#define MAX_MESSAGE_SIZE  (128)</span>
<span class="cp">#define SG_LIST_ELEMENTS  (56)</span>

<span class="cp">#define EMPTY_QUEUE           0xffffffff</span>
<span class="cp">#define I2O_INTERRUPT_PENDING_B   (0x08)</span>

<span class="cp">#define PCI_DPT_VENDOR_ID         (0x1044)	</span><span class="c1">// DPT PCI Vendor ID</span>
<span class="cp">#define PCI_DPT_DEVICE_ID         (0xA501)	</span><span class="c1">// DPT PCI I2O Device ID</span>
<span class="cp">#define PCI_DPT_RAPTOR_DEVICE_ID  (0xA511)	</span>

<span class="cm">/* Debugging macro from Linux Device Drivers - Rubini */</span>
<span class="cp">#undef PDEBUG</span>
<span class="cp">#ifdef DEBUG</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>TODO add debug level switch</p></td><td class="code"><div class="highlight"><pre><span class="cp">#  define PDEBUG(fmt, args...)  printk(KERN_DEBUG &quot;dpti: &quot; fmt, ##args)</span>
<span class="cp">#  define PDEBUGV(fmt, args...) printk(KERN_DEBUG &quot;dpti: &quot; fmt, ##args)</span>
<span class="cp">#else</span>
<span class="cp"># define PDEBUG(fmt, args...) </span><span class="cm">/* not debugging: nothing */</span><span class="cp"></span>
<span class="cp"># define PDEBUGV(fmt, args...) </span><span class="cm">/* not debugging: nothing */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#define PERROR(fmt, args...) printk(KERN_ERR fmt, ##args)</span>
<span class="cp">#define PWARN(fmt, args...) printk(KERN_WARNING fmt, ##args)</span>
<span class="cp">#define PINFO(fmt, args...) printk(KERN_INFO fmt, ##args)</span>
<span class="cp">#define PCRIT(fmt, args...) printk(KERN_CRIT fmt, ##args)</span>

<span class="cp">#define SHUTDOWN_SIGS	(sigmask(SIGKILL)|sigmask(SIGINT)|sigmask(SIGTERM))</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Command timeouts</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define FOREVER			(0)</span>
<span class="cp">#define TMOUT_INQUIRY 		(20)</span>
<span class="cp">#define TMOUT_FLUSH		(360/45)</span>
<span class="cp">#define TMOUT_ABORT		(30)</span>
<span class="cp">#define TMOUT_SCSI		(300)</span>
<span class="cp">#define TMOUT_IOPRESET		(360)</span>
<span class="cp">#define TMOUT_GETSTATUS		(15)</span>
<span class="cp">#define TMOUT_INITOUTBOUND	(15)</span>
<span class="cp">#define TMOUT_LCT		(360)</span>


<span class="cp">#define I2O_SCSI_DEVICE_DSC_MASK                0x00FF</span>

<span class="cp">#define I2O_DETAIL_STATUS_UNSUPPORTED_FUNCTION  0x000A</span>

<span class="cp">#define I2O_SCSI_DSC_MASK                   0xFF00</span>
<span class="cp">#define I2O_SCSI_DSC_SUCCESS                0x0000</span>
<span class="cp">#define I2O_SCSI_DSC_REQUEST_ABORTED        0x0200</span>
<span class="cp">#define I2O_SCSI_DSC_UNABLE_TO_ABORT        0x0300</span>
<span class="cp">#define I2O_SCSI_DSC_COMPLETE_WITH_ERROR    0x0400</span>
<span class="cp">#define I2O_SCSI_DSC_ADAPTER_BUSY           0x0500</span>
<span class="cp">#define I2O_SCSI_DSC_REQUEST_INVALID        0x0600</span>
<span class="cp">#define I2O_SCSI_DSC_PATH_INVALID           0x0700</span>
<span class="cp">#define I2O_SCSI_DSC_DEVICE_NOT_PRESENT     0x0800</span>
<span class="cp">#define I2O_SCSI_DSC_UNABLE_TO_TERMINATE    0x0900</span>
<span class="cp">#define I2O_SCSI_DSC_SELECTION_TIMEOUT      0x0A00</span>
<span class="cp">#define I2O_SCSI_DSC_COMMAND_TIMEOUT        0x0B00</span>
<span class="cp">#define I2O_SCSI_DSC_MR_MESSAGE_RECEIVED    0x0D00</span>
<span class="cp">#define I2O_SCSI_DSC_SCSI_BUS_RESET         0x0E00</span>
<span class="cp">#define I2O_SCSI_DSC_PARITY_ERROR_FAILURE   0x0F00</span>
<span class="cp">#define I2O_SCSI_DSC_AUTOSENSE_FAILED       0x1000</span>
<span class="cp">#define I2O_SCSI_DSC_NO_ADAPTER             0x1100</span>
<span class="cp">#define I2O_SCSI_DSC_DATA_OVERRUN           0x1200</span>
<span class="cp">#define I2O_SCSI_DSC_UNEXPECTED_BUS_FREE    0x1300</span>
<span class="cp">#define I2O_SCSI_DSC_SEQUENCE_FAILURE       0x1400</span>
<span class="cp">#define I2O_SCSI_DSC_REQUEST_LENGTH_ERROR   0x1500</span>
<span class="cp">#define I2O_SCSI_DSC_PROVIDE_FAILURE        0x1600</span>
<span class="cp">#define I2O_SCSI_DSC_BDR_MESSAGE_SENT       0x1700</span>
<span class="cp">#define I2O_SCSI_DSC_REQUEST_TERMINATED     0x1800</span>
<span class="cp">#define I2O_SCSI_DSC_IDE_MESSAGE_SENT       0x3300</span>
<span class="cp">#define I2O_SCSI_DSC_RESOURCE_UNAVAILABLE   0x3400</span>
<span class="cp">#define I2O_SCSI_DSC_UNACKNOWLEDGED_EVENT   0x3500</span>
<span class="cp">#define I2O_SCSI_DSC_MESSAGE_RECEIVED       0x3600</span>
<span class="cp">#define I2O_SCSI_DSC_INVALID_CDB            0x3700</span>
<span class="cp">#define I2O_SCSI_DSC_LUN_INVALID            0x3800</span>
<span class="cp">#define I2O_SCSI_DSC_SCSI_TID_INVALID       0x3900</span>
<span class="cp">#define I2O_SCSI_DSC_FUNCTION_UNAVAILABLE   0x3A00</span>
<span class="cp">#define I2O_SCSI_DSC_NO_NEXUS               0x3B00</span>
<span class="cp">#define I2O_SCSI_DSC_SCSI_IID_INVALID       0x3C00</span>
<span class="cp">#define I2O_SCSI_DSC_CDB_RECEIVED           0x3D00</span>
<span class="cp">#define I2O_SCSI_DSC_LUN_ALREADY_ENABLED    0x3E00</span>
<span class="cp">#define I2O_SCSI_DSC_BUS_BUSY               0x3F00</span>
<span class="cp">#define I2O_SCSI_DSC_QUEUE_FROZEN           0x4000</span>


<span class="cp">#ifndef TRUE</span>
<span class="cp">#define TRUE                  1</span>
<span class="cp">#define FALSE                 0</span>
<span class="cp">#endif</span>

<span class="cp">#define HBA_FLAGS_INSTALLED_B       0x00000001	</span><span class="c1">// Adapter Was Installed</span>
<span class="cp">#define HBA_FLAGS_BLINKLED_B        0x00000002	</span><span class="c1">// Adapter In Blink LED State</span>
<span class="cp">#define HBA_FLAGS_IN_RESET	0x00000040	</span><span class="cm">/* in reset */</span><span class="cp"></span>
<span class="cp">#define HBA_HOSTRESET_FAILED	0x00000080	</span><span class="cm">/* adpt_resethost failed */</span><span class="cp"></span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Device state flags</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define DPTI_DEV_ONLINE    0x00</span>
<span class="cp">#define DPTI_DEV_UNSCANNED 0x01</span>
<span class="cp">#define DPTI_DEV_RESET	   0x02</span>
<span class="cp">#define DPTI_DEV_OFFLINE   0x04</span>


<span class="k">struct</span> <span class="n">adpt_device</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">adpt_device</span><span class="o">*</span> <span class="n">next_lun</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">capacity</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">block_size</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">scsi_channel</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u8</span> 	<span class="n">scsi_lun</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">state</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">tid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2o_device</span><span class="o">*</span> <span class="n">pI2o_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="n">pScsi_dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">adpt_channel</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">adpt_device</span><span class="o">*</span> <span class="n">device</span><span class="p">[</span><span class="n">MAX_ID</span><span class="p">];</span>	<span class="cm">/* used as an array of 128 scsi ids */</span>
	<span class="n">u8</span>	<span class="n">scsi_id</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">tid</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2o_device</span><span class="o">*</span> <span class="n">pI2o_dev</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>HBA state flags</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define DPTI_STATE_RESET	(0x01)</span>
<span class="cp">#define DPTI_STATE_IOCTL	(0x02)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_adpt_hba</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">_adpt_hba</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pDev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">state</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">state_lock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">unit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">host_no</span><span class="p">;</span>		<span class="cm">/* SCSI host number */</span>
	<span class="n">u8</span> <span class="n">initialized</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">in_use</span><span class="p">;</span>		<span class="cm">/* is the management node open*/</span>

	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">detail</span><span class="p">[</span><span class="mi">55</span><span class="p">];</span>

	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base_addr_virt</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">msg_addr_virt</span><span class="p">;</span>
	<span class="n">ulong</span> <span class="n">base_addr_phys</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">post_port</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reply_port</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">irq_mask</span><span class="p">;</span>
	<span class="n">u16</span>  <span class="n">post_count</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">post_fifo_size</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">reply_fifo_size</span><span class="p">;</span>
	<span class="n">u32</span><span class="o">*</span> <span class="n">reply_pool</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">reply_pool_pa</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">sg_tablesize</span><span class="p">;</span>	<span class="c1">// Scatter/Gather List Size.       </span>
	<span class="n">u8</span>  <span class="n">top_scsi_channel</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">top_scsi_id</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">top_scsi_lun</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">dma64</span><span class="p">;</span>

	<span class="n">i2o_status_block</span><span class="o">*</span> <span class="n">status_block</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">status_block_pa</span><span class="p">;</span>
	<span class="n">i2o_hrt</span><span class="o">*</span> <span class="n">hrt</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">hrt_pa</span><span class="p">;</span>
	<span class="n">i2o_lct</span><span class="o">*</span> <span class="n">lct</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">lct_pa</span><span class="p">;</span>
	<span class="n">uint</span> <span class="n">lct_size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2o_device</span><span class="o">*</span> <span class="n">devices</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">adpt_channel</span> <span class="n">channel</span><span class="p">[</span><span class="n">MAX_CHANNEL</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span><span class="o">*</span> <span class="n">proc_entry</span><span class="p">;</span>	<span class="cm">/* /proc dir */</span>

	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">FwDebugBuffer_P</span><span class="p">;</span>	<span class="c1">// Virtual Address Of FW Debug Buffer</span>
	<span class="n">u32</span>   <span class="n">FwDebugBufferSize</span><span class="p">;</span>	<span class="c1">// FW Debug Buffer Size In Bytes</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">FwDebugStrLength_P</span><span class="p">;</span><span class="c1">// Virtual Addr Of FW Debug String Len</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">FwDebugFlags_P</span><span class="p">;</span>	<span class="c1">// Virtual Address Of FW Debug Flags </span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">FwDebugBLEDflag_P</span><span class="p">;</span><span class="c1">// Virtual Addr Of FW Debug BLED</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">FwDebugBLEDvalue_P</span><span class="p">;</span><span class="c1">// Virtual Addr Of FW Debug BLED</span>
	<span class="n">u32</span> <span class="n">FwDebugFlags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">ioctl_reply_context</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">adpt_hba</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">sg_simple_element</span> <span class="p">{</span>
   <span class="n">u32</span>  <span class="n">flag_count</span><span class="p">;</span>
   <span class="n">u32</span> <span class="n">addr_bus</span><span class="p">;</span>
<span class="p">};</span> 

<span class="cm">/*</span>
<span class="cm"> * Function Prototypes</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_i2o_sys_shutdown</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_build_sys_table</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="n">adpt_isr</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_i2o_report_hba_unit</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_query_scalar</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tid</span><span class="p">,</span> 
			<span class="kt">int</span> <span class="n">group</span><span class="p">,</span> <span class="kt">int</span> <span class="n">field</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buflen</span><span class="p">);</span>
<span class="cp">#ifdef DEBUG</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">adpt_i2o_get_class_name</span><span class="p">(</span><span class="kt">int</span> <span class="n">class</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_issue_params</span><span class="p">(</span><span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tid</span><span class="p">,</span> 
		  <span class="kt">void</span> <span class="o">*</span><span class="n">opblk</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">opblk_pa</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oplen</span><span class="p">,</span>
		  <span class="kt">void</span> <span class="o">*</span><span class="n">resblk</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">resblk_pa</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reslen</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_post_wait</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="n">u32</span><span class="o">*</span> <span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">timeout</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_lct_get</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_parse_lct</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_activate_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_enable_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_install_device</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_post_this</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="n">u32</span><span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_quiesce_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_status_get</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_init_outbound_q</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_hrt_get</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_scsi_to_i2o</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="o">*</span> <span class="n">cmd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">adpt_device</span><span class="o">*</span> <span class="n">dptdevice</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_to_scsi</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reply</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="o">*</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_scsi_host_alloc</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span><span class="k">struct</span> <span class="n">scsi_host_template</span> <span class="o">*</span> <span class="n">sht</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_hba_reset</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_reset_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_rescan</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_i2o_reparse_lct</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="n">s32</span> <span class="n">adpt_send_nop</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span><span class="n">pHba</span><span class="p">,</span><span class="n">u32</span> <span class="n">m</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_i2o_delete_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_inquiry</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_fail_posted_scbs</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">adpt_device</span><span class="o">*</span> <span class="n">adpt_find_device</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">,</span> <span class="n">u32</span> <span class="n">chan</span><span class="p">,</span> <span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">lun</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">adpt_install_hba</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_host_template</span><span class="o">*</span> <span class="n">sht</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pci_dev</span><span class="o">*</span> <span class="n">pDev</span><span class="p">)</span> <span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_online_hba</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_i2o_post_wait_complete</span><span class="p">(</span><span class="n">u32</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_i2o_systab_send</span><span class="p">(</span><span class="n">adpt_hba</span><span class="o">*</span> <span class="n">pHba</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="n">uint</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">ulong</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">adpt_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>


<span class="cp">#ifdef UARTDELAY</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">adpt_delay</span><span class="p">(</span><span class="kt">int</span> <span class="n">millisec</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cp">#define PRINT_BUFFER_SIZE     512</span>

<span class="cp">#define HBA_FLAGS_DBG_FLAGS_MASK         0xffff0000	</span><span class="c1">// Mask for debug flags</span>
<span class="cp">#define HBA_FLAGS_DBG_KERNEL_PRINT_B     0x00010000	</span><span class="c1">// Kernel Debugger Print</span>
<span class="cp">#define HBA_FLAGS_DBG_FW_PRINT_B         0x00020000	</span><span class="c1">// Firmware Debugger Print</span>
<span class="cp">#define HBA_FLAGS_DBG_FUNCTION_ENTRY_B   0x00040000	</span><span class="c1">// Function Entry Point</span>
<span class="cp">#define HBA_FLAGS_DBG_FUNCTION_EXIT_B    0x00080000	</span><span class="c1">// Function Exit</span>
<span class="cp">#define HBA_FLAGS_DBG_ERROR_B            0x00100000	</span><span class="c1">// Error Conditions</span>
<span class="cp">#define HBA_FLAGS_DBG_INIT_B             0x00200000	</span><span class="c1">// Init Prints</span>
<span class="cp">#define HBA_FLAGS_DBG_OS_COMMANDS_B      0x00400000	</span><span class="c1">// OS Command Info</span>
<span class="cp">#define HBA_FLAGS_DBG_SCAN_B             0x00800000	</span><span class="c1">// Device Scan</span>

<span class="cp">#define FW_DEBUG_STR_LENGTH_OFFSET 0</span>
<span class="cp">#define FW_DEBUG_FLAGS_OFFSET      4</span>
<span class="cp">#define FW_DEBUG_BLED_OFFSET       8</span>

<span class="cp">#define FW_DEBUG_FLAGS_NO_HEADERS_B    0x01</span>
<span class="cp">#endif				</span><span class="cm">/* !HOSTS_C */</span><span class="cp"></span>
<span class="cp">#endif				</span><span class="cm">/* _DPT_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
