<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › t128.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>t128.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Trantor T128/T128F/T228 defines</span>
<span class="cm"> *	Note : architecturally, the T100 and T128 are different and won&#39;t work</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1993, Drew Eckhardt</span>
<span class="cm"> *	Visionary Computing</span>
<span class="cm"> *	(Unix and Linux consulting and custom programming)</span>
<span class="cm"> *	drew@colorado.edu</span>
<span class="cm"> *      +1 (303) 440-4894</span>
<span class="cm"> *</span>
<span class="cm"> * DISTRIBUTION RELEASE 3.</span>
<span class="cm"> *</span>
<span class="cm"> * For more information, please consult</span>
<span class="cm"> *</span>
<span class="cm"> * Trantor Systems, Ltd.</span>
<span class="cm"> * T128/T128F/T228 SCSI Host Adapter</span>
<span class="cm"> * Hardware Specifications</span>
<span class="cm"> *</span>
<span class="cm"> * Trantor Systems, Ltd.</span>
<span class="cm"> * 5415 Randall Place</span>
<span class="cm"> * Fremont, CA 94538</span>
<span class="cm"> * 1+ (415) 770-1400, FAX 1+ (415) 770-9910</span>
<span class="cm"> *</span>
<span class="cm"> * and</span>
<span class="cm"> *</span>
<span class="cm"> * NCR 5380 Family</span>
<span class="cm"> * SCSI Protocol Controller</span>
<span class="cm"> * Databook</span>
<span class="cm"> *</span>
<span class="cm"> * NCR Microelectronics</span>
<span class="cm"> * 1635 Aeroplaza Drive</span>
<span class="cm"> * Colorado Springs, CO 80916</span>
<span class="cm"> * 1+ (719) 578-3400</span>
<span class="cm"> * 1+ (800) 334-5454</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * $Log: t128.h,v $</span>
<span class="cm"> */</span>

<span class="cp">#ifndef T128_H</span>
<span class="cp">#define T128_H</span>

<span class="cp">#define T128_PUBLIC_RELEASE 3</span>

<span class="cp">#define TDEBUG		0</span>
<span class="cp">#define TDEBUG_INIT	0x1</span>
<span class="cp">#define TDEBUG_TRANSFER 0x2</span>

<span class="cm">/*</span>
<span class="cm"> * The trantor boards are memory mapped. They use an NCR5380 or</span>
<span class="cm"> * equivalent (my sample board had part second sourced from ZILOG).</span>
<span class="cm"> * NCR&#39;s recommended &quot;Pseudo-DMA&quot; architecture is used, where</span>
<span class="cm"> * a PAL drives the DMA signals on the 5380 allowing fast, blind</span>
<span class="cm"> * transfers with proper handshaking.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Note : a boot switch is provided for the purpose of informing the</span>
<span class="cm"> * firmware to boot or not boot from attached SCSI devices.  So, I imagine</span>
<span class="cm"> * there are fewer people who&#39;ve yanked the ROM like they do on the Seagate</span>
<span class="cm"> * to make bootup faster, and I&#39;ll probably use this for autodetection.</span>
<span class="cm"> */</span>
<span class="cp">#define T_ROM_OFFSET		0</span>

<span class="cm">/*</span>
<span class="cm"> * Note : my sample board *WAS NOT* populated with the SRAM, so this</span>
<span class="cm"> * can&#39;t be used for autodetection without a ROM present.</span>
<span class="cm"> */</span>
<span class="cp">#define T_RAM_OFFSET		0x1800</span>

<span class="cm">/*</span>
<span class="cm"> * All of the registers are allocated 32 bytes of address space, except</span>
<span class="cm"> * for the data register (read/write to/from the 5380 in pseudo-DMA mode)</span>
<span class="cm"> */</span> 
<span class="cp">#define T_CONTROL_REG_OFFSET	0x1c00	</span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define T_CR_INT		0x10	</span><span class="cm">/* Enable interrupts */</span><span class="cp"></span>
<span class="cp">#define T_CR_CT			0x02	</span><span class="cm">/* Reset watchdog timer */</span><span class="cp"></span>

<span class="cp">#define T_STATUS_REG_OFFSET	0x1c20	</span><span class="cm">/* ro */</span><span class="cp"></span>
<span class="cp">#define T_ST_BOOT		0x80	</span><span class="cm">/* Boot switch */</span><span class="cp"></span>
<span class="cp">#define T_ST_S3			0x40	</span><span class="cm">/* User settable switches, */</span><span class="cp"></span>
<span class="cp">#define T_ST_S2			0x20	</span><span class="cm">/* read 0 when switch is on, 1 off */</span><span class="cp"></span>
<span class="cp">#define T_ST_S1			0x10</span>
<span class="cp">#define T_ST_PS2		0x08	</span><span class="cm">/* Set for Microchannel 228 */</span><span class="cp"></span>
<span class="cp">#define T_ST_RDY		0x04	</span><span class="cm">/* 5380 DRQ */</span><span class="cp"></span>
<span class="cp">#define T_ST_TIM		0x02	</span><span class="cm">/* indicates 40us watchdog timer fired */</span><span class="cp"></span>
<span class="cp">#define T_ST_ZERO		0x01	</span><span class="cm">/* Always zero */</span><span class="cp"></span>

<span class="cp">#define T_5380_OFFSET		0x1d00	</span><span class="cm">/* 8 registers here, see NCR5380.h */</span><span class="cp"></span>

<span class="cp">#define T_DATA_REG_OFFSET	0x1e00	</span><span class="cm">/* rw 512 bytes long */</span><span class="cp"></span>

<span class="cp">#ifndef ASM</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">t128_abort</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">t128_biosparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="p">,</span>
			  <span class="n">sector_t</span><span class="p">,</span> <span class="kt">int</span><span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">t128_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_host_template</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">t128_queue_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">t128_bus_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#ifndef CMD_PER_LUN</span>
<span class="cp">#define CMD_PER_LUN 2</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef CAN_QUEUE</span>
<span class="cp">#define CAN_QUEUE 32</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef HOSTS_C</span>

<span class="cp">#define NCR5380_implementation_fields \</span>
<span class="cp">    void __iomem *base</span>

<span class="cp">#define NCR5380_local_declare() \</span>
<span class="cp">    void __iomem *base</span>

<span class="cp">#define NCR5380_setup(instance) \</span>
<span class="cp">    base = ((struct NCR5380_hostdata *)(instance-&gt;hostdata))-&gt;base</span>

<span class="cp">#define T128_address(reg) (base + T_5380_OFFSET + ((reg) * 0x20))</span>

<span class="cp">#if !(TDEBUG &amp; TDEBUG_TRANSFER)</span>
<span class="cp">#define NCR5380_read(reg) readb(T128_address(reg))</span>
<span class="cp">#define NCR5380_write(reg, value) writeb((value),(T128_address(reg)))</span>
<span class="cp">#else</span>
<span class="cp">#define NCR5380_read(reg)						\</span>
<span class="cp">    (((unsigned char) printk(&quot;scsi%d : read register %d at address %08x\n&quot;\</span>
<span class="cp">    , instance-&gt;hostno, (reg), T128_address(reg))), readb(T128_address(reg)))</span>

<span class="cp">#define NCR5380_write(reg, value) {					\</span>
<span class="cp">    printk(&quot;scsi%d : write %02x to register %d at address %08x\n&quot;,	\</span>
<span class="cp">	    instance-&gt;hostno, (value), (reg), T128_address(reg));	\</span>
<span class="cp">    writeb((value), (T128_address(reg)));				\</span>
<span class="cp">}</span>
<span class="cp">#endif</span>

<span class="cp">#define NCR5380_intr t128_intr</span>
<span class="cp">#define do_NCR5380_intr do_t128_intr</span>
<span class="cp">#define NCR5380_queue_command t128_queue_command</span>
<span class="cp">#define NCR5380_abort t128_abort</span>
<span class="cp">#define NCR5380_bus_reset t128_bus_reset</span>
<span class="cp">#define NCR5380_proc_info t128_proc_info</span>

<span class="cm">/* 15 14 12 10 7 5 3</span>
<span class="cm">   1101 0100 1010 1000 */</span>

<span class="cp">#define T128_IRQS 0xc4a8</span>

<span class="cp">#endif </span><span class="cm">/* else def HOSTS_C */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* ndef ASM */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* T128_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
