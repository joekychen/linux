<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › in2000.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>in2000.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *    in2000.h -  Linux device driver definitions for the</span>
<span class="cm"> *                Always IN2000 ISA SCSI card.</span>
<span class="cm"> *</span>
<span class="cm"> *    IMPORTANT: This file is for version 1.33 - 26/Aug/1998</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 1996 John Shifflett, GeoLog Consulting</span>
<span class="cm"> *    john@geolog.com</span>
<span class="cm"> *    jshiffle@netcom.com</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef IN2000_H</span>
<span class="cp">#define IN2000_H</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>

<span class="cp">#define PROC_INTERFACE     </span><span class="cm">/* add code for /proc/scsi/in2000/xxx interface */</span><span class="cp"></span>
<span class="cp">#ifdef  PROC_INTERFACE</span>
<span class="cp">#define PROC_STATISTICS    </span><span class="cm">/* add code for keeping various real time stats */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#define SYNC_DEBUG         </span><span class="cm">/* extra info on sync negotiation printed */</span><span class="cp"></span>
<span class="cp">#define DEBUGGING_ON       </span><span class="cm">/* enable command-line debugging bitmask */</span><span class="cp"></span>
<span class="cp">#define DEBUG_DEFAULTS 0   </span><span class="cm">/* default bitmask - change from command-line */</span><span class="cp"></span>

<span class="cp">#ifdef __i386__</span>
<span class="cp">#define FAST_READ_IO       </span><span class="cm">/* No problems with these on my machine */</span><span class="cp"></span>
<span class="cp">#define FAST_WRITE_IO</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef DEBUGGING_ON</span>
<span class="cp">#define DB(f,a) if (hostdata-&gt;args &amp; (f)) a;</span>
<span class="cp">#define CHECK_NULL(p,s) </span><span class="cm">/* if (!(p)) {printk(&quot;\n&quot;); while (1) printk(&quot;NP:%s\r&quot;,(s));} */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define DB(f,a)</span>
<span class="cp">#define CHECK_NULL(p,s)</span>
<span class="cp">#endif</span>

<span class="cp">#define uchar unsigned char</span>

<span class="cp">#define read1_io(a)     (inb(hostdata-&gt;io_base+(a)))</span>
<span class="cp">#define read2_io(a)     (inw(hostdata-&gt;io_base+(a)))</span>
<span class="cp">#define write1_io(b,a)  (outb((b),hostdata-&gt;io_base+(a)))</span>
<span class="cp">#define write2_io(w,a)  (outw((w),hostdata-&gt;io_base+(a)))</span>

<span class="cp">#ifdef __i386__</span>
<span class="cm">/* These inline assembly defines are derived from a patch</span>
<span class="cm"> * sent to me by Bill Earnest. He&#39;s done a lot of very</span>
<span class="cm"> * valuable thinking, testing, and coding during his effort</span>
<span class="cm"> * to squeeze more speed out of this driver. I really think</span>
<span class="cm"> * that we are doing IO at close to the maximum now with</span>
<span class="cm"> * the fifo. (And yes, insw uses &#39;edi&#39; while outsw uses</span>
<span class="cm"> * &#39;esi&#39;. Thanks Bill!)</span>
<span class="cm"> */</span>

<span class="cp">#define FAST_READ2_IO()    \</span>
<span class="cp">({ \</span>
<span class="cp">int __dummy_1,__dummy_2; \</span>
<span class="cp">   __asm__ __volatile__ (&quot;\n \</span>
<span class="cp">   cld                    \n \</span>
<span class="cp">   orl %%ecx, %%ecx       \n \</span>
<span class="cp">   jz 1f                  \n \</span>
<span class="cp">   rep                    \n \</span>
<span class="cp">   insw (%%dx),%%es:(%%edi) \n \</span>
<span class="cp">1: &quot;                       \</span>
<span class="cp">   : &quot;=D&quot; (sp) ,&quot;=c&quot; (__dummy_1) ,&quot;=d&quot; (__dummy_2)  </span><span class="cm">/* output */</span><span class="cp">   \</span>
<span class="cp">   : &quot;2&quot; (f), &quot;0&quot; (sp), &quot;1&quot; (i)  </span><span class="cm">/* input */</span><span class="cp">    \</span>
<span class="cp">   );       </span><span class="cm">/* trashed */</span><span class="cp"> \</span>
<span class="cp">})</span>

<span class="cp">#define FAST_WRITE2_IO()   \</span>
<span class="cp">({ \</span>
<span class="cp">int __dummy_1,__dummy_2; \</span>
<span class="cp">   __asm__ __volatile__ (&quot;\n \</span>
<span class="cp">   cld                    \n \</span>
<span class="cp">   orl %%ecx, %%ecx       \n \</span>
<span class="cp">   jz 1f                  \n \</span>
<span class="cp">   rep                    \n \</span>
<span class="cp">   outsw %%ds:(%%esi),(%%dx) \n \</span>
<span class="cp">1: &quot;                       \</span>
<span class="cp">   : &quot;=S&quot; (sp) ,&quot;=c&quot; (__dummy_1) ,&quot;=d&quot; (__dummy_2)</span><span class="cm">/* output */</span><span class="cp">   \</span>
<span class="cp">   : &quot;2&quot; (f), &quot;0&quot; (sp), &quot;1&quot; (i)  </span><span class="cm">/* input */</span><span class="cp">    \</span>
<span class="cp">   );       </span><span class="cm">/* trashed */</span><span class="cp"> \</span>
<span class="cp">})</span>
<span class="cp">#endif</span>

<span class="cm">/* IN2000 io_port offsets */</span>
<span class="cp">#define IO_WD_ASR       0x00     </span><span class="cm">/* R - 3393 auxstat reg */</span><span class="cp"></span>
<span class="cp">#define     ASR_INT        0x80</span>
<span class="cp">#define     ASR_LCI        0x40</span>
<span class="cp">#define     ASR_BSY        0x20</span>
<span class="cp">#define     ASR_CIP        0x10</span>
<span class="cp">#define     ASR_PE         0x02</span>
<span class="cp">#define     ASR_DBR        0x01</span>
<span class="cp">#define IO_WD_ADDR      0x00     </span><span class="cm">/* W - 3393 address reg */</span><span class="cp"></span>
<span class="cp">#define IO_WD_DATA      0x01     </span><span class="cm">/* R/W - rest of 3393 regs */</span><span class="cp"></span>
<span class="cp">#define IO_FIFO         0x02     </span><span class="cm">/* R/W - in2000 dual-port fifo (16 bits) */</span><span class="cp"></span>
<span class="cp">#define IN2000_FIFO_SIZE   2048  </span><span class="cm">/*    fifo capacity in bytes */</span><span class="cp"></span>
<span class="cp">#define IO_CARD_RESET   0x03     </span><span class="cm">/* W - in2000 start master reset */</span><span class="cp"></span>
<span class="cp">#define IO_FIFO_COUNT   0x04     </span><span class="cm">/* R - in2000 fifo counter */</span><span class="cp"></span>
<span class="cp">#define IO_FIFO_WRITE   0x05     </span><span class="cm">/* W - clear fifo counter, start write */</span><span class="cp"></span>
<span class="cp">#define IO_FIFO_READ    0x07     </span><span class="cm">/* W - start fifo read */</span><span class="cp"></span>
<span class="cp">#define IO_LED_OFF      0x08     </span><span class="cm">/* W - turn off in2000 activity LED */</span><span class="cp"></span>
<span class="cp">#define IO_SWITCHES     0x08     </span><span class="cm">/* R - read in2000 dip switch */</span><span class="cp"></span>
<span class="cp">#define     SW_ADDR0       0x01  </span><span class="cm">/*    bit 0 = bit 0 of index to io addr */</span><span class="cp"></span>
<span class="cp">#define     SW_ADDR1       0x02  </span><span class="cm">/*    bit 1 = bit 1 of index io addr */</span><span class="cp"></span>
<span class="cp">#define     SW_DISINT      0x04  </span><span class="cm">/*    bit 2 true if ints disabled */</span><span class="cp"></span>
<span class="cp">#define     SW_INT0        0x08  </span><span class="cm">/*    bit 3 = bit 0 of index to interrupt */</span><span class="cp"></span>
<span class="cp">#define     SW_INT1        0x10  </span><span class="cm">/*    bit 4 = bit 1 of index to interrupt */</span><span class="cp"></span>
<span class="cp">#define     SW_INT_SHIFT   3     </span><span class="cm">/*    shift right this amount to right justify int bits */</span><span class="cp"></span>
<span class="cp">#define     SW_SYNC_DOS5   0x20  </span><span class="cm">/*    bit 5 used by Always BIOS */</span><span class="cp"></span>
<span class="cp">#define     SW_FLOPPY      0x40  </span><span class="cm">/*    bit 6 true if floppy enabled */</span><span class="cp"></span>
<span class="cp">#define     SW_BIT7        0x80  </span><span class="cm">/*    bit 7 hardwired true (ground) */</span><span class="cp"></span>
<span class="cp">#define IO_LED_ON       0x09     </span><span class="cm">/* W - turn on in2000 activity LED */</span><span class="cp"></span>
<span class="cp">#define IO_HARDWARE     0x0a     </span><span class="cm">/* R - read in2000 hardware rev, stop reset */</span><span class="cp"></span>
<span class="cp">#define IO_INTR_MASK    0x0c     </span><span class="cm">/* W - in2000 interrupt mask reg */</span><span class="cp"></span>
<span class="cp">#define     IMASK_WD       0x01  </span><span class="cm">/*    WD33c93 interrupt mask */</span><span class="cp"></span>
<span class="cp">#define     IMASK_FIFO     0x02  </span><span class="cm">/*    FIFO interrupt mask */</span><span class="cp"></span>

<span class="cm">/* wd register names */</span>
<span class="cp">#define WD_OWN_ID    0x00</span>
<span class="cp">#define WD_CONTROL   0x01</span>
<span class="cp">#define WD_TIMEOUT_PERIOD  0x02</span>
<span class="cp">#define WD_CDB_1     0x03</span>
<span class="cp">#define WD_CDB_2     0x04</span>
<span class="cp">#define WD_CDB_3     0x05</span>
<span class="cp">#define WD_CDB_4     0x06</span>
<span class="cp">#define WD_CDB_5     0x07</span>
<span class="cp">#define WD_CDB_6     0x08</span>
<span class="cp">#define WD_CDB_7     0x09</span>
<span class="cp">#define WD_CDB_8     0x0a</span>
<span class="cp">#define WD_CDB_9     0x0b</span>
<span class="cp">#define WD_CDB_10    0x0c</span>
<span class="cp">#define WD_CDB_11    0x0d</span>
<span class="cp">#define WD_CDB_12    0x0e</span>
<span class="cp">#define WD_TARGET_LUN      0x0f</span>
<span class="cp">#define WD_COMMAND_PHASE   0x10</span>
<span class="cp">#define WD_SYNCHRONOUS_TRANSFER  0x11</span>
<span class="cp">#define WD_TRANSFER_COUNT_MSB 0x12</span>
<span class="cp">#define WD_TRANSFER_COUNT  0x13</span>
<span class="cp">#define WD_TRANSFER_COUNT_LSB 0x14</span>
<span class="cp">#define WD_DESTINATION_ID  0x15</span>
<span class="cp">#define WD_SOURCE_ID    0x16</span>
<span class="cp">#define WD_SCSI_STATUS     0x17</span>
<span class="cp">#define WD_COMMAND      0x18</span>
<span class="cp">#define WD_DATA      0x19</span>
<span class="cp">#define WD_QUEUE_TAG    0x1a</span>
<span class="cp">#define WD_AUXILIARY_STATUS   0x1f</span>

<span class="cm">/* WD commands */</span>
<span class="cp">#define WD_CMD_RESET    0x00</span>
<span class="cp">#define WD_CMD_ABORT    0x01</span>
<span class="cp">#define WD_CMD_ASSERT_ATN  0x02</span>
<span class="cp">#define WD_CMD_NEGATE_ACK  0x03</span>
<span class="cp">#define WD_CMD_DISCONNECT  0x04</span>
<span class="cp">#define WD_CMD_RESELECT    0x05</span>
<span class="cp">#define WD_CMD_SEL_ATN     0x06</span>
<span class="cp">#define WD_CMD_SEL      0x07</span>
<span class="cp">#define WD_CMD_SEL_ATN_XFER   0x08</span>
<span class="cp">#define WD_CMD_SEL_XFER    0x09</span>
<span class="cp">#define WD_CMD_RESEL_RECEIVE  0x0a</span>
<span class="cp">#define WD_CMD_RESEL_SEND  0x0b</span>
<span class="cp">#define WD_CMD_WAIT_SEL_RECEIVE 0x0c</span>
<span class="cp">#define WD_CMD_TRANS_ADDR  0x18</span>
<span class="cp">#define WD_CMD_TRANS_INFO  0x20</span>
<span class="cp">#define WD_CMD_TRANSFER_PAD   0x21</span>
<span class="cp">#define WD_CMD_SBT_MODE    0x80</span>

<span class="cm">/* SCSI Bus Phases */</span>
<span class="cp">#define PHS_DATA_OUT    0x00</span>
<span class="cp">#define PHS_DATA_IN     0x01</span>
<span class="cp">#define PHS_COMMAND     0x02</span>
<span class="cp">#define PHS_STATUS      0x03</span>
<span class="cp">#define PHS_MESS_OUT    0x06</span>
<span class="cp">#define PHS_MESS_IN     0x07</span>

<span class="cm">/* Command Status Register definitions */</span>

  <span class="cm">/* reset state interrupts */</span>
<span class="cp">#define CSR_RESET    0x00</span>
<span class="cp">#define CSR_RESET_AF    0x01</span>

  <span class="cm">/* successful completion interrupts */</span>
<span class="cp">#define CSR_RESELECT    0x10</span>
<span class="cp">#define CSR_SELECT      0x11</span>
<span class="cp">#define CSR_SEL_XFER_DONE  0x16</span>
<span class="cp">#define CSR_XFER_DONE      0x18</span>

  <span class="cm">/* paused or aborted interrupts */</span>
<span class="cp">#define CSR_MSGIN    0x20</span>
<span class="cp">#define CSR_SDP         0x21</span>
<span class="cp">#define CSR_SEL_ABORT      0x22</span>
<span class="cp">#define CSR_RESEL_ABORT    0x25</span>
<span class="cp">#define CSR_RESEL_ABORT_AM 0x27</span>
<span class="cp">#define CSR_ABORT    0x28</span>

  <span class="cm">/* terminated interrupts */</span>
<span class="cp">#define CSR_INVALID     0x40</span>
<span class="cp">#define CSR_UNEXP_DISC     0x41</span>
<span class="cp">#define CSR_TIMEOUT     0x42</span>
<span class="cp">#define CSR_PARITY      0x43</span>
<span class="cp">#define CSR_PARITY_ATN     0x44</span>
<span class="cp">#define CSR_BAD_STATUS     0x45</span>
<span class="cp">#define CSR_UNEXP    0x48</span>

  <span class="cm">/* service required interrupts */</span>
<span class="cp">#define CSR_RESEL    0x80</span>
<span class="cp">#define CSR_RESEL_AM    0x81</span>
<span class="cp">#define CSR_DISC     0x85</span>
<span class="cp">#define CSR_SRV_REQ     0x88</span>

   <span class="cm">/* Own ID/CDB Size register */</span>
<span class="cp">#define OWNID_EAF    0x08</span>
<span class="cp">#define OWNID_EHP    0x10</span>
<span class="cp">#define OWNID_RAF    0x20</span>
<span class="cp">#define OWNID_FS_8   0x00</span>
<span class="cp">#define OWNID_FS_12  0x40</span>
<span class="cp">#define OWNID_FS_16  0x80</span>

   <span class="cm">/* Control register */</span>
<span class="cp">#define CTRL_HSP     0x01</span>
<span class="cp">#define CTRL_HA      0x02</span>
<span class="cp">#define CTRL_IDI     0x04</span>
<span class="cp">#define CTRL_EDI     0x08</span>
<span class="cp">#define CTRL_HHP     0x10</span>
<span class="cp">#define CTRL_POLLED  0x00</span>
<span class="cp">#define CTRL_BURST   0x20</span>
<span class="cp">#define CTRL_BUS     0x40</span>
<span class="cp">#define CTRL_DMA     0x80</span>

   <span class="cm">/* Timeout Period register */</span>
<span class="cp">#define TIMEOUT_PERIOD_VALUE  20    </span><span class="cm">/* results in 200 ms. */</span><span class="cp"></span>

   <span class="cm">/* Synchronous Transfer Register */</span>
<span class="cp">#define STR_FSS      0x80</span>

   <span class="cm">/* Destination ID register */</span>
<span class="cp">#define DSTID_DPD    0x40</span>
<span class="cp">#define DATA_OUT_DIR 0</span>
<span class="cp">#define DATA_IN_DIR  1</span>
<span class="cp">#define DSTID_SCC    0x80</span>

   <span class="cm">/* Source ID register */</span>
<span class="cp">#define SRCID_MASK   0x07</span>
<span class="cp">#define SRCID_SIV    0x08</span>
<span class="cp">#define SRCID_DSP    0x20</span>
<span class="cp">#define SRCID_ES     0x40</span>
<span class="cp">#define SRCID_ER     0x80</span>



<span class="cp">#define ILLEGAL_STATUS_BYTE   0xff</span>


<span class="cp">#define DEFAULT_SX_PER     500   </span><span class="cm">/* (ns) fairly safe */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_SX_OFF     0     </span><span class="cm">/* aka async */</span><span class="cp"></span>

<span class="cp">#define OPTIMUM_SX_PER     252   </span><span class="cm">/* (ns) best we can do (mult-of-4) */</span><span class="cp"></span>
<span class="cp">#define OPTIMUM_SX_OFF     12    </span><span class="cm">/* size of in2000 fifo */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">sx_period</span> <span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">period_ns</span><span class="p">;</span>
   <span class="n">uchar</span>          <span class="n">reg_value</span><span class="p">;</span>
   <span class="p">};</span>


<span class="k">struct</span> <span class="n">IN2000_hostdata</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">uchar</span>            <span class="n">chip</span><span class="p">;</span>             <span class="cm">/* what kind of wd33c93 chip? */</span>
    <span class="n">uchar</span>            <span class="n">microcode</span><span class="p">;</span>        <span class="cm">/* microcode rev if &#39;B&#39; */</span>
    <span class="kt">unsigned</span> <span class="kt">short</span>   <span class="n">io_base</span><span class="p">;</span>          <span class="cm">/* IO port base */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">dip_switch</span><span class="p">;</span>       <span class="cm">/* dip switch settings */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">hrev</span><span class="p">;</span>             <span class="cm">/* hardware revision of card */</span>
    <span class="k">volatile</span> <span class="n">uchar</span>   <span class="n">busy</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>          <span class="cm">/* index = target, bit = lun */</span>
    <span class="k">volatile</span> <span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="n">input_Q</span><span class="p">;</span>       <span class="cm">/* commands waiting to be started */</span>
    <span class="k">volatile</span> <span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="n">selecting</span><span class="p">;</span>     <span class="cm">/* trying to select this command */</span>
    <span class="k">volatile</span> <span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="n">connected</span><span class="p">;</span>     <span class="cm">/* currently connected command */</span>
    <span class="k">volatile</span> <span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="n">disconnected_Q</span><span class="p">;</span><span class="cm">/* commands waiting for reconnect */</span>
    <span class="n">uchar</span>            <span class="n">state</span><span class="p">;</span>            <span class="cm">/* what we are currently doing */</span>
    <span class="n">uchar</span>            <span class="n">fifo</span><span class="p">;</span>             <span class="cm">/* what the FIFO is up to */</span>
    <span class="n">uchar</span>            <span class="n">level2</span><span class="p">;</span>           <span class="cm">/* extent to which Level-2 commands are used */</span>
    <span class="n">uchar</span>            <span class="n">disconnect</span><span class="p">;</span>       <span class="cm">/* disconnect/reselect policy */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">args</span><span class="p">;</span>             <span class="cm">/* set from command-line argument */</span>
    <span class="n">uchar</span>            <span class="n">incoming_msg</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>  <span class="cm">/* filled during message_in phase */</span>
    <span class="kt">int</span>              <span class="n">incoming_ptr</span><span class="p">;</span>     <span class="cm">/* mainly used with EXTENDED messages */</span>
    <span class="n">uchar</span>            <span class="n">outgoing_msg</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>  <span class="cm">/* send this during next message_out */</span>
    <span class="kt">int</span>              <span class="n">outgoing_len</span><span class="p">;</span>     <span class="cm">/* length of outgoing message */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>     <span class="n">default_sx_per</span><span class="p">;</span>   <span class="cm">/* default transfer period for SCSI bus */</span>
    <span class="n">uchar</span>            <span class="n">sync_xfer</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>     <span class="cm">/* sync_xfer reg settings per target */</span>
    <span class="n">uchar</span>            <span class="n">sync_stat</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>     <span class="cm">/* status of sync negotiation per target */</span>
    <span class="n">uchar</span>            <span class="n">sync_off</span><span class="p">;</span>         <span class="cm">/* bit mask: don&#39;t use sync with these targets */</span>
<span class="cp">#ifdef PROC_INTERFACE</span>
    <span class="n">uchar</span>            <span class="n">proc</span><span class="p">;</span>             <span class="cm">/* bit mask: what&#39;s in proc output */</span>
<span class="cp">#ifdef PROC_STATISTICS</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">cmd_cnt</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>       <span class="cm">/* # of commands issued per target */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">int_cnt</span><span class="p">;</span>          <span class="cm">/* # of interrupts serviced */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">disc_allowed_cnt</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* # of disconnects allowed per target */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">disc_done_cnt</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* # of disconnects done per target*/</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
    <span class="p">};</span>


<span class="cm">/* defines for hostdata-&gt;chip */</span>

<span class="cp">#define C_WD33C93       0</span>
<span class="cp">#define C_WD33C93A      1</span>
<span class="cp">#define C_WD33C93B      2</span>
<span class="cp">#define C_UNKNOWN_CHIP  100</span>

<span class="cm">/* defines for hostdata-&gt;state */</span>

<span class="cp">#define S_UNCONNECTED         0</span>
<span class="cp">#define S_SELECTING           1</span>
<span class="cp">#define S_RUNNING_LEVEL2      2</span>
<span class="cp">#define S_CONNECTED           3</span>
<span class="cp">#define S_PRE_TMP_DISC        4</span>
<span class="cp">#define S_PRE_CMP_DISC        5</span>

<span class="cm">/* defines for hostdata-&gt;fifo */</span>

<span class="cp">#define FI_FIFO_UNUSED        0</span>
<span class="cp">#define FI_FIFO_READING       1</span>
<span class="cp">#define FI_FIFO_WRITING       2</span>

<span class="cm">/* defines for hostdata-&gt;level2 */</span>
<span class="cm">/* NOTE: only the first 3 are trustworthy at this point -</span>
<span class="cm"> * having trouble when more than 1 device is reading/writing</span>
<span class="cm"> * at the same time...</span>
<span class="cm"> */</span>

<span class="cp">#define L2_NONE      0  </span><span class="cm">/* no combination commands - we get lots of ints */</span><span class="cp"></span>
<span class="cp">#define L2_SELECT    1  </span><span class="cm">/* start with SEL_ATN_XFER, but never resume it */</span><span class="cp"></span>
<span class="cp">#define L2_BASIC     2  </span><span class="cm">/* resume after STATUS ints &amp; RDP messages */</span><span class="cp"></span>
<span class="cp">#define L2_DATA      3  </span><span class="cm">/* resume after DATA_IN/OUT ints */</span><span class="cp"></span>
<span class="cp">#define L2_MOST      4  </span><span class="cm">/* resume after anything except a RESELECT int */</span><span class="cp"></span>
<span class="cp">#define L2_RESELECT  5  </span><span class="cm">/* resume after everything, including RESELECT ints */</span><span class="cp"></span>
<span class="cp">#define L2_ALL       6  </span><span class="cm">/* always resume */</span><span class="cp"></span>

<span class="cm">/* defines for hostdata-&gt;disconnect */</span>

<span class="cp">#define DIS_NEVER    0</span>
<span class="cp">#define DIS_ADAPTIVE 1</span>
<span class="cp">#define DIS_ALWAYS   2</span>

<span class="cm">/* defines for hostdata-&gt;args */</span>

<span class="cp">#define DB_TEST               1&lt;&lt;0</span>
<span class="cp">#define DB_FIFO               1&lt;&lt;1</span>
<span class="cp">#define DB_QUEUE_COMMAND      1&lt;&lt;2</span>
<span class="cp">#define DB_EXECUTE            1&lt;&lt;3</span>
<span class="cp">#define DB_INTR               1&lt;&lt;4</span>
<span class="cp">#define DB_TRANSFER           1&lt;&lt;5</span>
<span class="cp">#define DB_MASK               0x3f</span>

<span class="cp">#define A_NO_SCSI_RESET       1&lt;&lt;15</span>


<span class="cm">/* defines for hostdata-&gt;sync_xfer[] */</span>

<span class="cp">#define SS_UNSET     0</span>
<span class="cp">#define SS_FIRST     1</span>
<span class="cp">#define SS_WAITING   2</span>
<span class="cp">#define SS_SET       3</span>

<span class="cm">/* defines for hostdata-&gt;proc */</span>

<span class="cp">#define PR_VERSION   1&lt;&lt;0</span>
<span class="cp">#define PR_INFO      1&lt;&lt;1</span>
<span class="cp">#define PR_STATISTICS 1&lt;&lt;2</span>
<span class="cp">#define PR_CONNECTED 1&lt;&lt;3</span>
<span class="cp">#define PR_INPUTQ    1&lt;&lt;4</span>
<span class="cp">#define PR_DISCQ     1&lt;&lt;5</span>
<span class="cp">#define PR_TEST      1&lt;&lt;6</span>
<span class="cp">#define PR_STOP      1&lt;&lt;7</span>


<span class="cp"># include &lt;linux/init.h&gt;</span>
<span class="cp"># include &lt;linux/spinlock.h&gt;</span>
<span class="cp"># define in2000__INITFUNC(function) __initfunc(function)</span>
<span class="cp"># define in2000__INIT __init</span>
<span class="cp"># define in2000__INITDATA __initdata</span>
<span class="cp"># define CLISPIN_LOCK(host,flags)   spin_lock_irqsave(host-&gt;host_lock, flags)</span>
<span class="cp"># define CLISPIN_UNLOCK(host,flags) spin_unlock_irqrestore(host-&gt;host_lock, \</span>
<span class="cp">							   flags)</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">in2000_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_host_template</span> <span class="o">*</span><span class="p">)</span> <span class="n">in2000__INIT</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">in2000_queuecommand</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">in2000_abort</span><span class="p">(</span><span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">in2000_setup</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">in2000__INIT</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">in2000_biosparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="p">,</span>
		<span class="n">sector_t</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">in2000_bus_reset</span><span class="p">(</span><span class="n">Scsi_Cmnd</span> <span class="o">*</span><span class="p">);</span>


<span class="cp">#define IN2000_CAN_Q    16</span>
<span class="cp">#define IN2000_SG       SG_ALL</span>
<span class="cp">#define IN2000_CPL      2</span>
<span class="cp">#define IN2000_HOST_ID  7</span>

<span class="cp">#endif </span><span class="cm">/* IN2000_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
