<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › scsi › bnx2fc › bnx2fc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>bnx2fc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _BNX2FC_H_</span>
<span class="cp">#define _BNX2FC_H_</span>
<span class="cm">/* bnx2fc.h: Broadcom NetXtreme II Linux FCoE offload driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2008 - 2011 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * Written by: Bhanu Prakash Gollapudi (bprakash@broadcom.com)</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/moduleparam.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/etherdevice.h&gt;</span>
<span class="cp">#include &lt;linux/if_ether.h&gt;</span>
<span class="cp">#include &lt;linux/if_vlan.h&gt;</span>
<span class="cp">#include &lt;linux/kthread.h&gt;</span>
<span class="cp">#include &lt;linux/crc32.h&gt;</span>
<span class="cp">#include &lt;linux/cpu.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>
<span class="cp">#include &lt;linux/log2.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>

<span class="cp">#include &lt;scsi/scsi.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_host.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_device.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_cmnd.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_eh.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_tcq.h&gt;</span>
<span class="cp">#include &lt;scsi/libfc.h&gt;</span>
<span class="cp">#include &lt;scsi/libfcoe.h&gt;</span>
<span class="cp">#include &lt;scsi/fc_encode.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_transport.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_transport_fc.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_fip.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_fc2.h&gt;</span>
<span class="cp">#include &lt;scsi/fc_frame.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_fcoe.h&gt;</span>
<span class="cp">#include &lt;scsi/fc/fc_fcp.h&gt;</span>

<span class="cp">#include &quot;57xx_hsi_bnx2fc.h&quot;</span>
<span class="cp">#include &quot;bnx2fc_debug.h&quot;</span>
<span class="cp">#include &quot;../../net/ethernet/broadcom/cnic_if.h&quot;</span>
<span class="cp">#include &quot;bnx2fc_constants.h&quot;</span>

<span class="cp">#define BNX2FC_NAME		&quot;bnx2fc&quot;</span>
<span class="cp">#define BNX2FC_VERSION		&quot;1.0.11&quot;</span>

<span class="cp">#define PFX			&quot;bnx2fc: &quot;</span>

<span class="cp">#define BNX2X_DOORBELL_PCI_BAR		2</span>

<span class="cp">#define BNX2FC_MAX_BD_LEN		0xffff</span>
<span class="cp">#define BNX2FC_BD_SPLIT_SZ		0x8000</span>
<span class="cp">#define BNX2FC_MAX_BDS_PER_CMD		256</span>

<span class="cp">#define BNX2FC_SQ_WQES_MAX	256</span>

<span class="cp">#define BNX2FC_SCSI_MAX_SQES	((3 * BNX2FC_SQ_WQES_MAX) / 8)</span>
<span class="cp">#define BNX2FC_TM_MAX_SQES	((BNX2FC_SQ_WQES_MAX) / 2)</span>
<span class="cp">#define BNX2FC_ELS_MAX_SQES	(BNX2FC_TM_MAX_SQES - 1)</span>

<span class="cp">#define BNX2FC_RQ_WQES_MAX	16</span>
<span class="cp">#define BNX2FC_CQ_WQES_MAX	(BNX2FC_SQ_WQES_MAX + BNX2FC_RQ_WQES_MAX)</span>

<span class="cp">#define BNX2FC_NUM_MAX_SESS	1024</span>
<span class="cp">#define BNX2FC_NUM_MAX_SESS_LOG	(ilog2(BNX2FC_NUM_MAX_SESS))</span>

<span class="cp">#define BNX2FC_MAX_OUTSTANDING_CMNDS	2048</span>
<span class="cp">#define BNX2FC_CAN_QUEUE		BNX2FC_MAX_OUTSTANDING_CMNDS</span>
<span class="cp">#define BNX2FC_ELSTM_XIDS		BNX2FC_CAN_QUEUE</span>
<span class="cp">#define BNX2FC_MIN_PAYLOAD		256</span>
<span class="cp">#define BNX2FC_MAX_PAYLOAD		2048</span>
<span class="cp">#define BNX2FC_MFS			\</span>
<span class="cp">			(BNX2FC_MAX_PAYLOAD + sizeof(struct fc_frame_header))</span>
<span class="cp">#define BNX2FC_MINI_JUMBO_MTU		2500</span>


<span class="cp">#define BNX2FC_RQ_BUF_SZ		256</span>
<span class="cp">#define BNX2FC_RQ_BUF_LOG_SZ		(ilog2(BNX2FC_RQ_BUF_SZ))</span>

<span class="cp">#define BNX2FC_SQ_WQE_SIZE		(sizeof(struct fcoe_sqe))</span>
<span class="cp">#define BNX2FC_CQ_WQE_SIZE		(sizeof(struct fcoe_cqe))</span>
<span class="cp">#define BNX2FC_RQ_WQE_SIZE		(BNX2FC_RQ_BUF_SZ)</span>
<span class="cp">#define BNX2FC_XFERQ_WQE_SIZE		(sizeof(struct fcoe_xfrqe))</span>
<span class="cp">#define BNX2FC_CONFQ_WQE_SIZE		(sizeof(struct fcoe_confqe))</span>
<span class="cp">#define BNX2FC_5771X_DB_PAGE_SIZE	128</span>

<span class="cp">#define BNX2FC_MAX_TASKS		\</span>
<span class="cp">			     (BNX2FC_MAX_OUTSTANDING_CMNDS + BNX2FC_ELSTM_XIDS)</span>
<span class="cp">#define BNX2FC_TASK_SIZE		128</span>
<span class="cp">#define	BNX2FC_TASKS_PER_PAGE		(PAGE_SIZE/BNX2FC_TASK_SIZE)</span>
<span class="cp">#define BNX2FC_TASK_CTX_ARR_SZ		(BNX2FC_MAX_TASKS/BNX2FC_TASKS_PER_PAGE)</span>

<span class="cp">#define BNX2FC_MAX_ROWS_IN_HASH_TBL	8</span>
<span class="cp">#define BNX2FC_HASH_TBL_CHUNK_SIZE	(16 * 1024)</span>

<span class="cp">#define BNX2FC_MAX_SEQS			255</span>
<span class="cp">#define BNX2FC_MAX_RETRY_CNT		3</span>
<span class="cp">#define BNX2FC_MAX_RPORT_RETRY_CNT	255</span>

<span class="cp">#define BNX2FC_READ			(1 &lt;&lt; 1)</span>
<span class="cp">#define BNX2FC_WRITE			(1 &lt;&lt; 0)</span>

<span class="cp">#define BNX2FC_MIN_XID			0</span>
<span class="cp">#define BNX2FC_MAX_XID			\</span>
<span class="cp">			(BNX2FC_MAX_OUTSTANDING_CMNDS + BNX2FC_ELSTM_XIDS - 1)</span>
<span class="cp">#define FCOE_MAX_NUM_XIDS		0x2000</span>
<span class="cp">#define FCOE_MIN_XID			(BNX2FC_MAX_XID + 1)</span>
<span class="cp">#define FCOE_MAX_XID			(FCOE_MIN_XID + FCOE_MAX_NUM_XIDS - 1)</span>
<span class="cp">#define FCOE_XIDS_PER_CPU		(FCOE_MIN_XID + (512 * nr_cpu_ids) - 1)</span>
<span class="cp">#define BNX2FC_MAX_LUN			0xFFFF</span>
<span class="cp">#define BNX2FC_MAX_FCP_TGT		256</span>
<span class="cp">#define BNX2FC_MAX_CMD_LEN		16</span>

<span class="cp">#define BNX2FC_TM_TIMEOUT		60	</span><span class="cm">/* secs */</span><span class="cp"></span>
<span class="cp">#define BNX2FC_IO_TIMEOUT		20000UL	</span><span class="cm">/* msecs */</span><span class="cp"></span>

<span class="cp">#define BNX2FC_WAIT_CNT			1200</span>
<span class="cp">#define BNX2FC_FW_TIMEOUT		(3 * HZ)</span>
<span class="cp">#define PORT_MAX			2</span>

<span class="cp">#define CMD_SCSI_STATUS(Cmnd)		((Cmnd)-&gt;SCp.Status)</span>

<span class="cm">/* FC FCP Status */</span>
<span class="cp">#define	FC_GOOD				0</span>

<span class="cp">#define BNX2FC_RNID_HBA			0x7</span>

<span class="cp">#define SRR_RETRY_COUNT			5</span>
<span class="cp">#define REC_RETRY_COUNT			1</span>
<span class="cp">#define BNX2FC_NUM_ERR_BITS		63</span>

<span class="cp">#define BNX2FC_RELOGIN_WAIT_TIME	200</span>
<span class="cp">#define BNX2FC_RELOGIN_WAIT_CNT		10</span>

<span class="cm">/* bnx2fc driver uses only one instance of fcoe_percpu_s */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">fcoe_percpu_s</span> <span class="n">bnx2fc_global</span><span class="p">;</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">bnx2fc_wq</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">bnx2fc_percpu_s</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">iothread</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">work_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">fp_work_lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">cnic</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pcidev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">phys_dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reg_with_cnic</span><span class="p">;</span>
		<span class="cp">#define BNX2FC_CNIC_REGISTERED           1</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd_mgr</span> <span class="o">*</span><span class="n">cmd_mgr</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">hba_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">hba_mutex</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">adapter_state</span><span class="p">;</span>
		<span class="cp">#define ADAPTER_STATE_UP		0</span>
		<span class="cp">#define ADAPTER_STATE_GOING_DOWN	1</span>
		<span class="cp">#define ADAPTER_STATE_LINK_DOWN		2</span>
		<span class="cp">#define ADAPTER_STATE_READY		3</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
		<span class="cp">#define BNX2FC_FLAG_FW_INIT_DONE	0</span>
		<span class="cp">#define BNX2FC_FLAG_DESTROY_CMPL	1</span>
	<span class="n">u32</span> <span class="n">next_conn_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">**</span><span class="n">task_ctx</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="o">*</span><span class="n">task_ctx_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regpair</span> <span class="o">*</span><span class="n">task_ctx_bd_tbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">task_ctx_bd_dma</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">hash_tbl_segment_count</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">**</span><span class="n">hash_tbl_segments</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">hash_tbl_pbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">hash_tbl_pbl_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_t2_hash_table_entry</span> <span class="o">*</span><span class="n">t2_hash_tbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">t2_hash_tbl_dma</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">t2_hash_tbl_ptr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">t2_hash_tbl_ptr_dma</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">dummy_buffer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">dummy_buf_dma</span><span class="p">;</span>

	<span class="cm">/* Active list of offloaded sessions */</span>
	<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">**</span><span class="n">tgt_ofld_list</span><span class="p">;</span>

	<span class="cm">/* statistics */</span>
	<span class="k">struct</span> <span class="n">fcoe_statistics_params</span> <span class="o">*</span><span class="n">stats_buffer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">stats_buf_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">stat_req_done</span><span class="p">;</span>

	<span class="cm">/*destroy handling */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">destroy_timer</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">destroy_wait</span><span class="p">;</span>

	<span class="cm">/* linkdown handling */</span>
	<span class="n">wait_queue_head_t</span> <span class="n">shutdown_wait</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">wait_for_link_down</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_ofld_sess</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">vports</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_interface</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">if_flags</span><span class="p">;</span>
		<span class="cp">#define BNX2FC_CTLR_INIT_DONE		0</span>
	<span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">packet_type</span> <span class="n">fcoe_packet_type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">packet_type</span> <span class="n">fip_packet_type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">timer_work_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">kref</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">vlan_enabled</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vlan_id</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">enabled</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define bnx2fc_from_ctlr(x)			\</span>
<span class="cp">	((struct bnx2fc_interface *)((x) + 1))</span>

<span class="cp">#define bnx2fc_to_ctlr(x)					\</span>
<span class="cp">	((struct fcoe_ctlr *)(((struct fcoe_ctlr *)(x)) - 1))</span>

<span class="k">struct</span> <span class="n">bnx2fc_lport</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_lport</span> <span class="o">*</span><span class="n">lport</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_cmd_mgr</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">next_idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">free_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="o">*</span><span class="n">free_list_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">io_bdt</span> <span class="o">**</span><span class="n">io_bdt_pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">**</span><span class="n">cmds</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fcoe_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_rport</span> <span class="o">*</span><span class="n">rport</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_rport_priv</span> <span class="o">*</span><span class="n">rdata</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ctx_base</span><span class="p">;</span>
<span class="cp">#define DPM_TRIGER_TYPE		0x40</span>
	<span class="n">u32</span> <span class="n">io_timeout</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcoe_conn_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">context_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dev_type</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define BNX2FC_FLAG_SESSION_READY	0x1</span>
<span class="cp">#define BNX2FC_FLAG_OFFLOADED		0x2</span>
<span class="cp">#define BNX2FC_FLAG_DISABLED		0x3</span>
<span class="cp">#define BNX2FC_FLAG_DESTROYED		0x4</span>
<span class="cp">#define BNX2FC_FLAG_OFLD_REQ_CMPL	0x5</span>
<span class="cp">#define BNX2FC_FLAG_CTX_ALLOC_FAILURE	0x6</span>
<span class="cp">#define BNX2FC_FLAG_UPLD_REQ_COMPL	0x7</span>
<span class="cp">#define BNX2FC_FLAG_EXPL_LOGO		0x8</span>

	<span class="n">u8</span> <span class="n">src_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">max_sqes</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_rqes</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_cqes</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">free_sqes</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">b577xx_doorbell_set_prod</span> <span class="n">sq_db</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b577xx_fcoe_rx_doorbell</span> <span class="n">rx_db</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_sqe</span> <span class="o">*</span><span class="n">sq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">sq_dma</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sq_prod_idx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sq_curr_toggle_bit</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sq_mem_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_cqe</span> <span class="o">*</span><span class="n">cq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">cq_dma</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cq_cons_idx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cq_curr_toggle_bit</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cq_mem_size</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">rq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">rq_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rq_prod_idx</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rq_cons_idx</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rq_mem_size</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">rq_pbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">rq_pbl_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rq_pbl_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_xfrqe</span> <span class="o">*</span><span class="n">xferq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">xferq_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">xferq_mem_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_confqe</span> <span class="o">*</span><span class="n">confq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">confq_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">confq_mem_size</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">confq_pbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">confq_pbl_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">confq_pbl_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_conn_db</span> <span class="o">*</span><span class="n">conn_db</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">conn_db_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">conn_db_mem_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">fcoe_sqe</span> <span class="o">*</span><span class="n">lcq</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">lcq_dma</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lcq_mem_size</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">ofld_req</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">dma_addr_t</span> <span class="n">ofld_req_dma</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">enbl_req</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">enbl_req_dma</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">tgt_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">cq_lock</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">num_active_ios</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flush_in_prog</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free_task_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">pending_queue</span><span class="p">[</span><span class="n">BNX2FC_SQ_WQES_MAX</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">active_cmd_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">els_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">io_retire_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">active_tm_queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">ofld_timer</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">ofld_wait</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">upld_timer</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">upld_wait</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_mp_req</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">tm_flags</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">req_len</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">req_buf</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">req_buf_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_bd_ctx</span> <span class="o">*</span><span class="n">mp_req_bd</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">mp_req_bd_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_frame_header</span> <span class="n">req_fc_hdr</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">resp_len</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">resp_buf</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">resp_buf_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_bd_ctx</span> <span class="o">*</span><span class="n">mp_resp_bd</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">mp_resp_bd_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_frame_header</span> <span class="n">resp_fc_hdr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_els_cb_arg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">aborted_io_req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">l2_oxid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">offset</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">fc_rctl</span> <span class="n">r_ctl</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* bnx2fc command structure */</span>
<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">link</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">on_active_queue</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">on_tmf_queue</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cmd_type</span><span class="p">;</span>
<span class="cp">#define BNX2FC_SCSI_CMD		1</span>
<span class="cp">#define BNX2FC_TASK_MGMT_CMD		2</span>
<span class="cp">#define BNX2FC_ABTS			3</span>
<span class="cp">#define BNX2FC_ELS			4</span>
<span class="cp">#define BNX2FC_CLEANUP			5</span>
<span class="cp">#define BNX2FC_SEQ_CLEANUP		6</span>
	<span class="n">u8</span> <span class="n">io_req_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">refcount</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd_mgr</span> <span class="o">*</span><span class="n">cmd_mgr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_mp_req</span> <span class="n">mp_req</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cb_func</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2fc_els_cb_arg</span> <span class="o">*</span><span class="n">cb_arg</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">bnx2fc_els_cb_arg</span> <span class="o">*</span><span class="n">cb_arg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">timeout_work</span><span class="p">;</span> <span class="cm">/* timer for ULP timeouts */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">tm_done</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">wait_for_comp</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_err_report_entry</span> <span class="n">err_entry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">io_bdt</span> <span class="o">*</span><span class="n">bd_tbl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcp_rsp</span> <span class="o">*</span><span class="n">rsp</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">data_xfer_len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">req_flags</span><span class="p">;</span>
<span class="cp">#define BNX2FC_FLAG_ISSUE_RRQ		0x1</span>
<span class="cp">#define BNX2FC_FLAG_ISSUE_ABTS		0x2</span>
<span class="cp">#define BNX2FC_FLAG_ABTS_DONE		0x3</span>
<span class="cp">#define BNX2FC_FLAG_TM_COMPL		0x4</span>
<span class="cp">#define BNX2FC_FLAG_TM_TIMEOUT		0x5</span>
<span class="cp">#define BNX2FC_FLAG_IO_CLEANUP		0x6</span>
<span class="cp">#define BNX2FC_FLAG_RETIRE_OXID		0x7</span>
<span class="cp">#define	BNX2FC_FLAG_EH_ABORT		0x8</span>
<span class="cp">#define BNX2FC_FLAG_IO_COMPL		0x9</span>
<span class="cp">#define BNX2FC_FLAG_ELS_DONE		0xa</span>
<span class="cp">#define BNX2FC_FLAG_ELS_TIMEOUT		0xb</span>
<span class="cp">#define BNX2FC_FLAG_CMD_LOST		0xc</span>
<span class="cp">#define BNX2FC_FLAG_SRR_SENT		0xd</span>
	<span class="n">u8</span> <span class="n">rec_retry</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">srr_retry</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">srr_offset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">srr_rctl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_resid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_rsp_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_sns_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cdb_status</span><span class="p">;</span> <span class="cm">/* SCSI IO status */</span>
	<span class="n">u8</span> <span class="n">fcp_status</span><span class="p">;</span> <span class="cm">/* FCP IO status */</span>
	<span class="n">u8</span> <span class="n">fcp_rsp_code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">scsi_comp_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">io_bdt</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcoe_bd_ctx</span> <span class="o">*</span><span class="n">bd_tbl</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">bd_tbl_dma</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bd_valid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2fc_work</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">wqe</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">bnx2fc_unsol_els</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fc_lport</span> <span class="o">*</span><span class="n">lport</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">unsol_els_work</span><span class="p">;</span>
<span class="p">};</span>



<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">bnx2fc_cmd_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">bnx2fc_elstm_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_cmd_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">kref</span> <span class="o">*</span><span class="n">ref</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_queuecommand</span><span class="p">(</span><span class="k">struct</span> <span class="n">Scsi_Host</span> <span class="o">*</span><span class="n">host</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_fw_fcoe_init_msg</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_fw_fcoe_destroy_msg</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_session_ofld_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">fcoe_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_session_disable_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">fcoe_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_session_destroy_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_map_doorbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_indicate_kcqe</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kcqe</span> <span class="o">*</span><span class="n">kcq</span><span class="p">[],</span>
					<span class="n">u32</span> <span class="n">num_cqe</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_setup_task_ctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_free_task_ctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_setup_fw_resc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_free_fw_resc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">bnx2fc_cmd_mgr</span> <span class="o">*</span><span class="n">bnx2fc_cmd_mgr_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">,</span>
						<span class="n">u16</span> <span class="n">min_xid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">max_xid</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_cmd_mgr_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd_mgr</span> <span class="o">*</span><span class="n">cmgr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_get_link_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span><span class="n">bnx2fc_get_next_rqe</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="n">u8</span> <span class="n">num_items</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_return_rqe</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="n">u8</span> <span class="n">num_items</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_get_paged_crc_eof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tlen</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_rrq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">aborted_io_req</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_adisc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="n">fp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_logo</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="n">fp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_rls</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="n">fp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_initiate_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_initiate_abts</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_cmd_timer_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">timer_msec</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_init_mp_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_init_cleanup_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
			      <span class="n">u16</span> <span class="n">orig_xid</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_init_seq_cleanup_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">seq_clnup_req</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">orig_io_req</span><span class="p">,</span>
				  <span class="n">u32</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_init_mp_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_init_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_add_2_sq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="n">u16</span> <span class="n">xid</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_ring_doorbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_eh_abort</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_eh_host_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_eh_target_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_eh_device_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">scsi_cmnd</span> <span class="o">*</span><span class="n">sc_cmd</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_rport_event_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">fc_lport</span> <span class="o">*</span><span class="n">lport</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">fc_rport_priv</span> <span class="o">*</span><span class="n">rport</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">fc_rport_event</span> <span class="n">event</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_scsi_cmd_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
				   <span class="n">u8</span> <span class="n">num_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_cleanup_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
			       <span class="n">u8</span> <span class="n">num_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_abts_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
			       <span class="n">u8</span> <span class="n">num_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_tm_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
			     <span class="n">u8</span> <span class="n">num_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_els_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">els_req</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
			      <span class="n">u8</span> <span class="n">num_rq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_build_fcp_cmnd</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">fcp_cmnd</span> <span class="o">*</span><span class="n">fcp_cmnd</span><span class="p">);</span>



<span class="kt">void</span> <span class="n">bnx2fc_flush_active_ios</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">fc_seq</span> <span class="o">*</span><span class="n">bnx2fc_elsct_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">fc_lport</span> <span class="o">*</span><span class="n">lport</span><span class="p">,</span> <span class="n">u32</span> <span class="n">did</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="n">fp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">op</span><span class="p">,</span>
				      <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">resp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fc_seq</span> <span class="o">*</span><span class="p">,</span>
						   <span class="k">struct</span> <span class="n">fc_frame</span> <span class="o">*</span><span class="p">,</span>
						   <span class="kt">void</span> <span class="o">*</span><span class="p">),</span>
				      <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">timeout</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_arm_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_process_new_cqes</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_cq_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="n">u16</span> <span class="n">wqe</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">bnx2fc_tgt_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">fcoe_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
					     <span class="n">u32</span> <span class="n">port_id</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_l2_frame_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
				   <span class="n">u32</span> <span class="n">frame_len</span><span class="p">,</span> <span class="n">u16</span> <span class="n">l2_oxid</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_stat_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_hba</span> <span class="o">*</span><span class="n">hba</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_post_io_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_rport</span> <span class="o">*</span><span class="n">tgt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">io_req</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_rec</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">orig_io_req</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_send_srr</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">orig_io_req</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="n">r_ctl</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2fc_process_seq_cleanup_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">seq_clnup_req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">fcoe_task_ctx_entry</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span>
				      <span class="n">u8</span> <span class="n">rx_state</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bnx2fc_initiate_seq_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2fc_cmd</span> <span class="o">*</span><span class="n">orig_io_req</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">fc_rctl</span> <span class="n">r_ctl</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
