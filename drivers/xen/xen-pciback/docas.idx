f | pciback.h | s | 6.1K | 167 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1326387619 |  | xen/pciback: Support pci_reset_function, aka FLR or D3 support.  We use the __pci_reset_function_locked to perform the action. Also on attaching ("bind") and detaching ("unbind") we save and restore the configuration states. When the device is disconnected from a guest we use the "pci_reset_function" to also reset the device before being passed to another guest.  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | pci_stub.c | s | 35K | 1175 | Linus Torvalds | torvalds@linux-foundation.org | 1332472574 |  | 
f | Makefile | g | 232B |  | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1311123860 |  | xen/pciback: Have 'passthrough' option instead of XEN_PCIDEV_BACKEND_PASS and XEN_PCIDEV_BACKEND_VPCI  .. compile options. This way the user can decide during runtime whether they want the default 'vpci' (virtual pci passthrough) or where the PCI devices are passed in without any BDF renumbering. The option 'passthrough' allows the user to toggle the it from 0 (vpci) to 1 (passthrough).  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | conf_space_quirks.h | s | 841B | 23 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1311123515 |  | xen/pciback: Drop two backends, squash and cleanup some code.   - Remove the slot and controller controller backend as they    are not used.  - Document the find pciback_[read||write]_config_[byte||word||dword]    to make it easier to find.  - Collapse the code from conf_space_capability_msi into pciback_ops.c  - Collapse conf_space_capability_[pm||vpd].c in conf_space_capability.c    [and remove the conf_space_capability.h file]  - Rename all visible functions from pciback to xen_pcibk.  - Rename all the printk/pr_info, etc that use the "pciback" to say    "xen-pciback".  - Convert functions that are not referenced outside the code to be    static to save on name space.  - Do the same thing for structures that are internal to the driver.  - Run checkpatch.pl after the renames and fixup its warnings and    fix any compile errors caused by the variable rename  - Cleanup any structs that checkpath.pl commented about or just    look odd.  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus.c | s | 18K | 621 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1328303217 |  | xen/pci[front||back]: Use %d instead of %1x for displaying PCI devfn.  .. as the rest of the kernel is using that format.  Suggested-by: Марк Коренберг <socketpair@gmail.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | pciback_ops.c | s | 10K | 335 | Jan Beulich | JBeulich@suse.com | 1333728835 |  | xen/pciback: fix XEN_PCI_OP_enable_msix result  Prior to 2.6.19 and as of 2.6.31, pci_enable_msix() can return a positive value to indicate the number of vectors (less than the amount requested) that can be set up for a given device. Returning this as an operation value (secondary result) is fine, but (primary) operation results are expected to be negative (error) or zero (success) according to the protocol. With the frontend fixed to match the XenoLinux behavior, the backend can now validly return zero (success) here, passing the upper limit on the number of vectors in op->value.  Signed-off-by: Jan Beulich <jbeulich@suse.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | conf_space.c | s | 10K | 366 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | conf_space_quirks.c | s | 3.1K | 118 | Jan Beulich | JBeulich@suse.com | 1316643479 |  | xen/pciback: miscellaneous adjustments  This is a minor bugfix and a set of small cleanups; as it is not clear whether this needs splitting into pieces (and if so, at what granularity), it is a single combined patch. - add a missing return statement to an error path in   kill_domain_by_device() - use pci_is_enabled() rather than raw atomic_read() - remove a bogus attempt to zero-terminate an already zero-terminated   string - #define DRV_NAME once uniformly in the shared local header - make DRIVER_ATTR() variables static - eliminate a pointless use of list_for_each_entry_safe() - add MODULE_ALIAS() - a little bit of constification - adjust a few messages - remove stray semicolons from inline function definitions  Signed-off-by: Jan Beulich <jbeulich@suse.com> [v1: Dropped the resource_size fix, altered the description] [v2: Fixed cleanpatch.pl comments] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | passthrough.c | s | 4.6K | 153 | Jan Beulich | JBeulich@suse.com | 1316643479 |  | xen/pciback: miscellaneous adjustments  This is a minor bugfix and a set of small cleanups; as it is not clear whether this needs splitting into pieces (and if so, at what granularity), it is a single combined patch. - add a missing return statement to an error path in   kill_domain_by_device() - use pci_is_enabled() rather than raw atomic_read() - remove a bogus attempt to zero-terminate an already zero-terminated   string - #define DRV_NAME once uniformly in the shared local header - make DRIVER_ATTR() variables static - eliminate a pointless use of list_for_each_entry_safe() - add MODULE_ALIAS() - a little bit of constification - adjust a few messages - remove stray semicolons from inline function definitions  Signed-off-by: Jan Beulich <jbeulich@suse.com> [v1: Dropped the resource_size fix, altered the description] [v2: Fixed cleanpatch.pl comments] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | vpci.c | s | 5.9K | 212 | Dan Carpenter | dan.carpenter@oracle.com | 1317307826 |  | xen/pciback: double lock typo  We called mutex_lock() twice instead of unlocking.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | conf_space.h | s | 3.7K | 111 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1311123515 |  | xen/pciback: Drop two backends, squash and cleanup some code.   - Remove the slot and controller controller backend as they    are not used.  - Document the find pciback_[read||write]_config_[byte||word||dword]    to make it easier to find.  - Collapse the code from conf_space_capability_msi into pciback_ops.c  - Collapse conf_space_capability_[pm||vpd].c in conf_space_capability.c    [and remove the conf_space_capability.h file]  - Rename all visible functions from pciback to xen_pcibk.  - Rename all the printk/pr_info, etc that use the "pciback" to say    "xen-pciback".  - Convert functions that are not referenced outside the code to be    static to save on name space.  - Do the same thing for structures that are internal to the driver.  - Run checkpatch.pl after the renames and fixup its warnings and    fix any compile errors caused by the variable rename  - Cleanup any structs that checkpath.pl commented about or just    look odd.  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | conf_space_capability.c | s | 4.6K | 176 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1311123515 |  | xen/pciback: Drop two backends, squash and cleanup some code.   - Remove the slot and controller controller backend as they    are not used.  - Document the find pciback_[read||write]_config_[byte||word||dword]    to make it easier to find.  - Collapse the code from conf_space_capability_msi into pciback_ops.c  - Collapse conf_space_capability_[pm||vpd].c in conf_space_capability.c    [and remove the conf_space_capability.h file]  - Rename all visible functions from pciback to xen_pcibk.  - Rename all the printk/pr_info, etc that use the "pciback" to say    "xen-pciback".  - Convert functions that are not referenced outside the code to be    static to save on name space.  - Do the same thing for structures that are internal to the driver.  - Run checkpatch.pl after the renames and fixup its warnings and    fix any compile errors caused by the variable rename  - Cleanup any structs that checkpath.pl commented about or just    look odd.  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | conf_space_header.c | s | 8.6K | 325 | Jan Beulich | JBeulich@suse.com | 1316643479 |  | xen/pciback: miscellaneous adjustments  This is a minor bugfix and a set of small cleanups; as it is not clear whether this needs splitting into pieces (and if so, at what granularity), it is a single combined patch. - add a missing return statement to an error path in   kill_domain_by_device() - use pci_is_enabled() rather than raw atomic_read() - remove a bogus attempt to zero-terminate an already zero-terminated   string - #define DRV_NAME once uniformly in the shared local header - make DRIVER_ATTR() variables static - eliminate a pointless use of list_for_each_entry_safe() - add MODULE_ALIAS() - a little bit of constification - adjust a few messages - remove stray semicolons from inline function definitions  Signed-off-by: Jan Beulich <jbeulich@suse.com> [v1: Dropped the resource_size fix, altered the description] [v2: Fixed cleanpatch.pl comments] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
