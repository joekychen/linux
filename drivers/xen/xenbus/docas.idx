f | xenbus_comms.c | s | 6.2K | 203 | Daniel De Graaf | dgdegra@tycho.nsa.gov | 1337608398 |  | xenbus: Add support for xenbus backend in stub domain  Add an ioctl to the /dev/xen/xenbus_backend device allowing the xenbus backend to be started after the kernel has booted. This allows xenstore to run in a different domain from the dom0.  Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_dev_backend.c | s | 3.1K | 109 | Daniel De Graaf | dgdegra@tycho.nsa.gov | 1337608398 |  | xenbus: Add support for xenbus backend in stub domain  Add an ioctl to the /dev/xen/xenbus_backend device allowing the xenbus backend to be started after the kernel has booted. This allows xenstore to run in a different domain from the dom0.  Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_probe.h | s | 3.0K | 67 | Jan Beulich | JBeulich@suse.com | 1325714477 |  | Xen: consolidate and simplify struct xenbus_driver instantiation  The 'name', 'owner', and 'mod_name' members are redundant with the identically named fields in the 'driver' sub-structure. Rather than switching each instance to specify these fields explicitly, introduce a macro to simplify this.  Eliminate further redundancy by allowing the drvname argument to DEFINE_XENBUS_DRIVER() to be blank (in which case the first entry from the ID table will be used for .driver.name).  Also eliminate the questionable xenbus_register_{back,front}end() wrappers - their sole remaining purpose was the checking of the 'owner' field, proper setting of which shouldn't be an issue anymore when the macro gets used.  v2: Restore DRV_NAME for the driver name in xen-pciback.  Signed-off-by: Jan Beulich <jbeulich@suse.com> Cc: Jens Axboe <axboe@kernel.dk> Cc: Dmitry Torokhov <dmitry.torokhov@gmail.com> Cc: Florian Tobias Schandinat <FlorianSchandinat@gmx.de> Cc: Ian Campbell <ian.campbell@citrix.com> Cc: David S. Miller <davem@davemloft.net> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | Makefile | g | 393B |  | Bastian Blank | waldi@debian.org | 1324060181 |  | xen: Add xenbus_backend device  Access for xenstored to the event channel and pre-allocated ring is managed via xenfs.  This adds its own character device featuring mmap for the ring and an ioctl for the event channel.  Signed-off-by: Bastian Blank <waldi@debian.org> Acked-by: Ian Campbell <ian.campbell@citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_probe_frontend.c | s | 11K | 379 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1334853901 |  | xen/xenbus: Add quirk to deal with misconfigured backends.  A rather annoying and common case is when booting a PVonHVM guest and exposing the PV KBD and PV VFB - as broken toolstacks don't always initialize the backends correctly.  Normally The HVM guest is using the VGA driver and the emulated keyboard for this (though upstream version of QEMU implements PV KBD, but still uses a VGA driver). We provide a very basic two-stage wait mechanism - where we wait for 30 seconds for all devices, and then for 270 for all them except the two mentioned.  That allows us to wait for the essential devices, like network or disk for the full 6 minutes.  To trigger this, put this in your guest config:  vfb = [ 'vnc=1, vnclisten=0.0.0.0 ,vncunused=1']  instead of this: vnc=1 vnclisten="0.0.0.0"  CC: stable@kernel.org Acked-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com> [v3: Split delay in non-essential (30 seconds) and essential  devices per Ian and Stefano suggestion] [v4: Added comments per Stefano suggestion] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_probe.c | s | 17K | 632 | Jan Beulich | JBeulich@suse.com | 1331662529 |  | xenbus: don't free other end details too early  The individual drivers' remove functions could legitimately attempt to access this information (for logging messages if nothing else). Note that I did not in fact observe a problem anywhere, but I came across this while looking into the reasons for what turned out to need the fix at https://lkml.org/lkml/2012/3/5/336 to vsprintf().  Signed-off-by: Jan Beulich <jbeulich@suse.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_comms.h | s | 2.0K | 45 | Daniel De Graaf | dgdegra@tycho.nsa.gov | 1337608398 |  | xenbus: Add support for xenbus backend in stub domain  Add an ioctl to the /dev/xen/xenbus_backend device allowing the xenbus backend to be started after the kernel has booted. This allows xenstore to run in a different domain from the dom0.  Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_dev_frontend.c | s | 14K | 524 | Jan Beulich | JBeulich@suse.com | 1328303225 |  | xenbus_dev: add missing error check to watch handling  So far only the watch path was checked to be zero terminated, while the watch token was merely assumed to be.  Signed-off-by: Jan Beulich <jbeulich@suse.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_xs.c | s | 20K | 742 | Linus Torvalds | torvalds@linux-foundation.org | 1326218999 |  | Merge branch 'stable/for-linus-3.3' of git://git.kernel.org/pub/scm/linux/kernel/git/konrad/xen  * 'stable/for-linus-3.3' of git://git.kernel.org/pub/scm/linux/kernel/git/konrad/xen: (37 commits)   xen/pciback: Expand the warning message to include domain id.   xen/pciback: Fix "device has been assigned to X domain!" warning   xen/pciback: Move the PCI_DEV_FLAGS_ASSIGNED ops to the "[un||]bind"   xen/xenbus: don't reimplement kvasprintf via a fixed size buffer   xenbus: maximum buffer size is XENSTORE_PAYLOAD_MAX   xen/xenbus: Reject replies with payload > XENSTORE_PAYLOAD_MAX.   Xen: consolidate and simplify struct xenbus_driver instantiation   xen-gntalloc: introduce missing kfree   xen/xenbus: Fix compile error - missing header for xen_initial_domain()   xen/netback: Enable netback on HVM guests   xen/grant-table: Support mappings required by blkback   xenbus: Use grant-table wrapper functions   xenbus: Support HVM backends   xen/xenbus-frontend: Fix compile error with randconfig   xen/xenbus-frontend: Make error message more clear   xen/privcmd: Remove unused support for arch specific privcmp mmap   xen: Add xenbus_backend device   xen: Add xenbus device driver   xen: Add privcmd device driver   xen/gntalloc: fix reference counts on multi-page mappings   ...
f | xenbus_client.c | s | 19K | 628 | Jan Beulich | JBeulich@suse.com | 1330272247 |  | xenbus: address compiler warnings  - casting pointers to integer types of different size is being warned on - an uninitialized variable warning occurred on certain gcc versions  Signed-off-by: Jan Beulich <jbeulich@suse.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xenbus_probe_backend.c | s | 7.0K | 225 | Jan Beulich | JBeulich@suse.com | 1325714477 |  | Xen: consolidate and simplify struct xenbus_driver instantiation  The 'name', 'owner', and 'mod_name' members are redundant with the identically named fields in the 'driver' sub-structure. Rather than switching each instance to specify these fields explicitly, introduce a macro to simplify this.  Eliminate further redundancy by allowing the drvname argument to DEFINE_XENBUS_DRIVER() to be blank (in which case the first entry from the ID table will be used for .driver.name).  Also eliminate the questionable xenbus_register_{back,front}end() wrappers - their sole remaining purpose was the checking of the 'owner' field, proper setting of which shouldn't be an issue anymore when the macro gets used.  v2: Restore DRV_NAME for the driver name in xen-pciback.  Signed-off-by: Jan Beulich <jbeulich@suse.com> Cc: Jens Axboe <axboe@kernel.dk> Cc: Dmitry Torokhov <dmitry.torokhov@gmail.com> Cc: Florian Tobias Schandinat <FlorianSchandinat@gmx.de> Cc: Ian Campbell <ian.campbell@citrix.com> Cc: David S. Miller <davem@davemloft.net> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
