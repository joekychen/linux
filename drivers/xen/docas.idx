f | Makefile | g | 1.0K |  | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1336419198 |  | xen/acpi/sleep: Enable ACPI sleep via the __acpi_os_prepare_sleep  Provide the registration callback to call in the Xen's ACPI sleep functionality. This means that during S3/S5 we make a hypercall XENPF_enter_acpi_sleep with the proper PM1A/PM1B registers.  Based of Ke Yu's <ke.yu@intel.com> initial idea. [ From http://xenbits.xensource.com/linux-2.6.18-xen.hg change c68699484a65 ]  [v1: Added Copyright and license] [v2: Added check if PM1A/B the 16-bits MSB contain something. The spec      only uses 16-bits but might have more in future] Signed-off-by: Liang Tang <liang.tang@oracle.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | balloon.c | s | 16K | 519 | Daniel De Graaf | dgdegra@tycho.nsa.gov | 1321463623 |  | xen/balloon: Avoid OOM when requesting highmem  If highmem pages are requested from the balloon on a system without highmem, the implementation of alloc_xenballooned_pages will allocate all available memory trying to find highmem pages to return. Allow low memory to be returned when highmem pages are requested to avoid this loop.  Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | sys-hypervisor.c | s | 9.2K | 360 | Jan Beulich | JBeulich@suse.com | 1331742859 |  | xen: constify all instances of "struct attribute_group"  The functions these get passed to have been taking pointers to const since at least 2.6.16.  Signed-off-by: Jan Beulich <jbeulich@suse.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | cpu_hotplug.c | s | 2.0K | 89 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1328303130 |  | xen/bootup: During bootup suppress XENBUS: Unable to read cpu state  When the initial domain starts, it prints (depending on the amount of CPUs) a slew of XENBUS: Unable to read cpu state XENBUS: Unable to read cpu state XENBUS: Unable to read cpu state XENBUS: Unable to read cpu state  which provide no useful information - as the error is a valid issue - but not on the initial domain. The reason is that the XenStore is not accessible at that time (it is after all the first guest) so the CPU hotplug watch cannot parse "availability/cpu" attribute.  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | grant-table.c | s | 31K | 1013 | Linus Torvalds | torvalds@linux-foundation.org | 1337900528 |  | 
f | xen-selfballoon.c | s | 17K | 493 | Jana Saout | jana@saout.de | 1337611973 |  | xen: Add selfballoning memory reservation tunable.  Currently, the memory target in the Xen selfballooning driver is mainly driven by the value of "Committed_AS".  However, there are cases in which it is desirable to assign additional memory to be available for the kernel, e.g. for local caches (which are not covered by cleancache), e.g. dcache and inode caches.  This adds an additional tunable in the selfballooning driver (accessible via sysfs) which allows the user to specify an additional constant amount of memory to be reserved by the selfballoning driver for the local domain.  Signed-off-by: Jana Saout <jana@saout.de> Acked-by: Dan Magenheimer <dan.magenheimer@oracle.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xen-acpi-processor.c | s | 16K | 498 | H. Peter Anvin | hpa@linux.intel.com | 1337274182 |  | xen-acpi-processor: Add missing #include <xen/xen.h>  This file depends on <xen/xen.h>, but the dependency was hidden due to: <asm/acpi.h> -> <asm/trampoline.h> -> <asm/io.h> -> <xen/xen.h>  With the removal of <asm/trampoline.h>, this exposed the missing  Reported-by: Ingo Molnar <mingo@kernel.org> Cc: Len Brown <lenb@kernel.org> Cc: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com> Cc: Jeremy Fitzhardinge <jeremy@goop.org> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Signed-off-by: H. Peter Anvin <hpa@zytor.com>
f | pci.c | s | 4.7K | 168 | Zhang, Yang Z | yang.z.zhang@intel.com | 1338387395 |  | xen/pci: Check for PCI bridge before using it.  Some SR-IOV devices may use more than one bus number, but there is no real bridges because that have internal routing mechanism. So need to check whether the bridge is existing before using it.  Signed-off-by: Yang Zhang <yang.z.zhang@Intel.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | tmem.c | s | 9.9K | 342 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1337096048 |  | frontswap: s/put_page/store/g s/get_page/load  Sounds so much more natural.  Suggested-by: Andrea Arcangeli <aarcange@redhat.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | evtchn.c | s | 13K | 446 | Daniel De Graaf | dgdegra@tycho.nsa.gov | 1321913688 |  | xen/event: Add reference counting to event channels  Event channels exposed to userspace by the evtchn module may be used by other modules in an asynchronous manner, which requires that reference counting be used to prevent the event channel from being closed before the signals are delivered.  The reference count on new event channels defaults to -1 which indicates the event channel is not referenced outside the kernel; evtchn_get fails if called on such an event channel. The event channels made visible to userspace by evtchn have a normal reference count.  Signed-off-by: Daniel De Graaf <dgdegra@tycho.nsa.gov> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xencomm.c | s | 5.4K | 177 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | privcmd.h | s | 77B | 2 | Bastian Blank | waldi@debian.org | 1324060171 |  | xen: Add privcmd device driver  Access to arbitrary hypercalls is currently provided via xenfs. This adds a standard character device to handle this. The support in xenfs remains for backward compatibility and uses the device driver code.  Signed-off-by: Bastian Blank <waldi@debian.org> Acked-by: Ian Campbell <ian.campbell@citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
d | xen-pciback |  | 13 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1333760093 |  | 
f | gntalloc.c | s | 15K | 510 | Julia Lawall | julia@diku.dk | 1325615944 |  | xen-gntalloc: introduce missing kfree  Error handling code following a kmalloc should free the allocated data. Out_unlock is used on both success and failure, so free vm_priv before jumping to that label.  A simplified version of the semantic match that finds the problem is as follows: (http://coccinelle.lip6.fr)  // <smpl> @r exists@ local idexpression x; statement S; identifier f1; position p1,p2; expression *ptr != NULL; @@  x@p1 = \(kmalloc\||kzalloc\||kcalloc\)(...); ... if (x == NULL) S <... when != x      when != if (...) { <+...x...+> } x->f1 ...> (  return \(0\||<+...x...+>\||ptr\); ||  return@p2 ...; )  @script:python@ p1 << r.p1; p2 << r.p2; @@  print "* file: %s kmalloc %s return %s" % (p1[0].file,p1[0].line,p2[0].line) // </smpl>  Signed-off-by: Julia Lawall <julia@diku.dk> [v1: Altered the description a bit] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | manage.c | s | 6.8K | 279 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1334862769 |  | xen/resume: Fix compile warnings.  linux/drivers/xen/manage.c: In function 'do_suspend': linux/drivers/xen/manage.c:160:5: warning: 'si.cancelled' may be used uninitialized in this function  Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | acpi.c | s | 2.3K | 58 | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1336419198 |  | xen/acpi/sleep: Enable ACPI sleep via the __acpi_os_prepare_sleep  Provide the registration callback to call in the Xen's ACPI sleep functionality. This means that during S3/S5 we make a hypercall XENPF_enter_acpi_sleep with the proper PM1A/PM1B registers.  Based of Ke Yu's <ke.yu@intel.com> initial idea. [ From http://xenbits.xensource.com/linux-2.6.18-xen.hg change c68699484a65 ]  [v1: Added Copyright and license] [v2: Added check if PM1A/B the 16-bits MSB contain something. The spec      only uses 16-bits but might have more in future] Signed-off-by: Liang Tang <liang.tang@oracle.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
d | xenfs |  | 4 items |  | Bastian Blank | waldi@debian.org | 1324060179 |  | xen: Add xenbus device driver  Access to xenbus is currently handled via xenfs. This adds a device driver for xenbus and makes xenfs use this code.  Signed-off-by: Bastian Blank <waldi@debian.org> Acked-by: Ian Campbell <ian.campbell@citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | xen-balloon.c | s | 6.7K | 203 | Linus Torvalds | torvalds@linux-foundation.org | 1332472574 |  | 
f | platform-pci.c | s | 4.6K | 160 | Igor Mammedov | imammedo@redhat.com | 1332430631 |  | xen: initialize platform-pci even if xen_emul_unplug=never  When xen_emul_unplug=never is specified on kernel command line reading files from /sys/hypervisor is broken (returns -EBUSY). It is caused by xen_bus dependency on platform-pci and platform-pci isn't initialized when xen_emul_unplug=never is specified.  Fix it by allowing platform-pci to ignore xen_emul_unplug=never, and do not intialize xen_[blk||net]front instead.  Signed-off-by: Igor Mammedov <imammedo@redhat.com> Acked-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | features.c | s | 762B | 28 | Jeremy Fitzhardinge | jeremy@goop.org | 1229460631 |  | xen: clean up asm/xen/hypervisor.h  Impact: cleanup  hypervisor.h had accumulated a lot of crud, including lots of spurious #includes.  Clean it all up, and go around fixing up everything else accordingly.  Signed-off-by: Jeremy Fitzhardinge <jeremy.fitzhardinge@citrix.com> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | Kconfig | g | 6.8K |  | Linus Torvalds | torvalds@linux-foundation.org | 1337739770 |  | Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial  Pull trivial updates from Jiri Kosina:  "As usual, it's mostly typo fixes, redundant code elimination and some   documentation updates."  * 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jikos/trivial: (57 commits)   edac, mips: don't change code that has been removed in edac/mips tree   xtensa: Change mail addresses of Hannes Weiner and Oskar Schirmer   lib: Change mail address of Oskar Schirmer   net: Change mail address of Oskar Schirmer   arm/m68k: Change mail address of Sebastian Hess   i2c: Change mail address of Oskar Schirmer   net: Fix tcp_build_and_update_options comment in struct tcp_sock   atomic64_32.h: fix parameter naming mismatch   Kconfig: replace "--- help ---" with "---help---"   c2port: fix bogus Kconfig "default no"   edac: Fix spelling errors.   qla1280: Remove redundant NULL check before release_firmware() call   remoteproc: remove redundant NULL check before release_firmware()   qla2xxx: Remove redundant NULL check before release_firmware() call.   aic94xx: Get rid of redundant NULL check before release_firmware() call   tehuti: delete redundant NULL check before release_firmware()   qlogic: get rid of a redundant test for NULL before call to release_firmware()   bna: remove redundant NULL test before release_firmware()   tg3: remove redundant NULL test before release_firmware() call   typhoon: get rid of redundant conditional before all to release_firmware()   ...
f | swiotlb-xen.c | s | 15K | 488 | Andrzej Pietrasiewicz | andrzej.p@samsung.com | 1332945391 |  | X86 & IA64: adapt for dma_map_ops changes  Adapt core x86 and IA64 architecture code for dma_map_ops changes: replace alloc/free_coherent with generic alloc/free methods.  Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@samsung.com> Acked-by: Kyungmin Park <kyungmin.park@samsung.com> [removed swiotlb related changes and replaced it with wrappers,  merged with IA64 patch to avoid inter-patch dependences in intel-iommu code] Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com> Reviewed-by: Arnd Bergmann <arnd@arndb.de> Acked-by: Tony Luck <tony.luck@intel.com>
f | biomerge.c | s | 451B | 13 | Stephen Rothwell | sfr@canb.auug.org.au | 1326929869 |  | xen: using EXPORT_SYMBOL requires including export.h  Fix these warnings:    drivers/xen/biomerge.c:14:1: warning: data definition has no type or storage class [enabled by default]   drivers/xen/biomerge.c:14:1: warning: type defaults to 'int' in declaration of 'EXPORT_SYMBOL' [-Wimplicit-int]   drivers/xen/biomerge.c:14:1: warning: parameter names (without types) in function declaration [enabled by default]  And this build error:    ERROR: "xen_biovec_phys_mergeable" [drivers/block/nvme.ko] undefined!  Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | events.c | s | 41K | 1456 | Linus Torvalds | torvalds@linux-foundation.org | 1339805835 |  | 
d | xenbus |  | 11 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1337900528 |  | 
f | gntdev.c | s | 19K | 682 | Stefano Stabellini | stefano.stabellini@eu.citrix.com | 1334683637 |  | xen/gntdev: do not set VM_PFNMAP  Since we are using the m2p_override we do have struct pages corresponding to the user vma mmap'ed by gntdev.  Removing the VM_PFNMAP flag makes get_user_pages work on that vma. An example test case would be using a Xen userspace block backend (QDISK) on a file on NFS using O_DIRECT.  CC: stable@kernel.org Signed-off-by: Stefano Stabellini <stefano.stabellini@eu.citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
f | privcmd.c | s | 8.8K | 342 | Bastian Blank | waldi@debian.org | 1324060182 |  | xen/privcmd: Remove unused support for arch specific privcmp mmap  This was used for ia64. But there is no working ia64 support in sight, so remove it for now.  Signed-off-by: Bastian Blank <waldi@debian.org> Acked-by: Ian Campbell <ian.campbell@citrix.com> Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>
