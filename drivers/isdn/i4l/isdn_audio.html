<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › i4l › isdn_audio.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>isdn_audio.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: isdn_audio.c,v 1.1.2.2 2004/01/12 22:37:18 keil Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * Linux ISDN subsystem, audio conversion and compression (linklevel).</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1994-1999 by Fritz Elfert (fritz@isdn4linux.de)</span>
<span class="cm"> * DTMF code (c) 1996 by Christian Mock (cm@kukuruz.ping.at)</span>
<span class="cm"> * Silence detection (c) 1998 by Armin Schindler (mac@gismo.telekom.de)</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/isdn.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &quot;isdn_audio.h&quot;</span>
<span class="cp">#include &quot;isdn_common.h&quot;</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">isdn_audio_revision</span> <span class="o">=</span> <span class="s">&quot;$Revision: 1.1.2.2 $&quot;</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Misc. lookup-tables.</span>
<span class="cm"> */</span>

<span class="cm">/* ulaw -&gt; signed 16-bit */</span>
<span class="k">static</span> <span class="kt">short</span> <span class="n">isdn_audio_ulaw_to_s16</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mh">0x8284</span><span class="p">,</span> <span class="mh">0x8684</span><span class="p">,</span> <span class="mh">0x8a84</span><span class="p">,</span> <span class="mh">0x8e84</span><span class="p">,</span> <span class="mh">0x9284</span><span class="p">,</span> <span class="mh">0x9684</span><span class="p">,</span> <span class="mh">0x9a84</span><span class="p">,</span> <span class="mh">0x9e84</span><span class="p">,</span>
	<span class="mh">0xa284</span><span class="p">,</span> <span class="mh">0xa684</span><span class="p">,</span> <span class="mh">0xaa84</span><span class="p">,</span> <span class="mh">0xae84</span><span class="p">,</span> <span class="mh">0xb284</span><span class="p">,</span> <span class="mh">0xb684</span><span class="p">,</span> <span class="mh">0xba84</span><span class="p">,</span> <span class="mh">0xbe84</span><span class="p">,</span>
	<span class="mh">0xc184</span><span class="p">,</span> <span class="mh">0xc384</span><span class="p">,</span> <span class="mh">0xc584</span><span class="p">,</span> <span class="mh">0xc784</span><span class="p">,</span> <span class="mh">0xc984</span><span class="p">,</span> <span class="mh">0xcb84</span><span class="p">,</span> <span class="mh">0xcd84</span><span class="p">,</span> <span class="mh">0xcf84</span><span class="p">,</span>
	<span class="mh">0xd184</span><span class="p">,</span> <span class="mh">0xd384</span><span class="p">,</span> <span class="mh">0xd584</span><span class="p">,</span> <span class="mh">0xd784</span><span class="p">,</span> <span class="mh">0xd984</span><span class="p">,</span> <span class="mh">0xdb84</span><span class="p">,</span> <span class="mh">0xdd84</span><span class="p">,</span> <span class="mh">0xdf84</span><span class="p">,</span>
	<span class="mh">0xe104</span><span class="p">,</span> <span class="mh">0xe204</span><span class="p">,</span> <span class="mh">0xe304</span><span class="p">,</span> <span class="mh">0xe404</span><span class="p">,</span> <span class="mh">0xe504</span><span class="p">,</span> <span class="mh">0xe604</span><span class="p">,</span> <span class="mh">0xe704</span><span class="p">,</span> <span class="mh">0xe804</span><span class="p">,</span>
	<span class="mh">0xe904</span><span class="p">,</span> <span class="mh">0xea04</span><span class="p">,</span> <span class="mh">0xeb04</span><span class="p">,</span> <span class="mh">0xec04</span><span class="p">,</span> <span class="mh">0xed04</span><span class="p">,</span> <span class="mh">0xee04</span><span class="p">,</span> <span class="mh">0xef04</span><span class="p">,</span> <span class="mh">0xf004</span><span class="p">,</span>
	<span class="mh">0xf0c4</span><span class="p">,</span> <span class="mh">0xf144</span><span class="p">,</span> <span class="mh">0xf1c4</span><span class="p">,</span> <span class="mh">0xf244</span><span class="p">,</span> <span class="mh">0xf2c4</span><span class="p">,</span> <span class="mh">0xf344</span><span class="p">,</span> <span class="mh">0xf3c4</span><span class="p">,</span> <span class="mh">0xf444</span><span class="p">,</span>
	<span class="mh">0xf4c4</span><span class="p">,</span> <span class="mh">0xf544</span><span class="p">,</span> <span class="mh">0xf5c4</span><span class="p">,</span> <span class="mh">0xf644</span><span class="p">,</span> <span class="mh">0xf6c4</span><span class="p">,</span> <span class="mh">0xf744</span><span class="p">,</span> <span class="mh">0xf7c4</span><span class="p">,</span> <span class="mh">0xf844</span><span class="p">,</span>
	<span class="mh">0xf8a4</span><span class="p">,</span> <span class="mh">0xf8e4</span><span class="p">,</span> <span class="mh">0xf924</span><span class="p">,</span> <span class="mh">0xf964</span><span class="p">,</span> <span class="mh">0xf9a4</span><span class="p">,</span> <span class="mh">0xf9e4</span><span class="p">,</span> <span class="mh">0xfa24</span><span class="p">,</span> <span class="mh">0xfa64</span><span class="p">,</span>
	<span class="mh">0xfaa4</span><span class="p">,</span> <span class="mh">0xfae4</span><span class="p">,</span> <span class="mh">0xfb24</span><span class="p">,</span> <span class="mh">0xfb64</span><span class="p">,</span> <span class="mh">0xfba4</span><span class="p">,</span> <span class="mh">0xfbe4</span><span class="p">,</span> <span class="mh">0xfc24</span><span class="p">,</span> <span class="mh">0xfc64</span><span class="p">,</span>
	<span class="mh">0xfc94</span><span class="p">,</span> <span class="mh">0xfcb4</span><span class="p">,</span> <span class="mh">0xfcd4</span><span class="p">,</span> <span class="mh">0xfcf4</span><span class="p">,</span> <span class="mh">0xfd14</span><span class="p">,</span> <span class="mh">0xfd34</span><span class="p">,</span> <span class="mh">0xfd54</span><span class="p">,</span> <span class="mh">0xfd74</span><span class="p">,</span>
	<span class="mh">0xfd94</span><span class="p">,</span> <span class="mh">0xfdb4</span><span class="p">,</span> <span class="mh">0xfdd4</span><span class="p">,</span> <span class="mh">0xfdf4</span><span class="p">,</span> <span class="mh">0xfe14</span><span class="p">,</span> <span class="mh">0xfe34</span><span class="p">,</span> <span class="mh">0xfe54</span><span class="p">,</span> <span class="mh">0xfe74</span><span class="p">,</span>
	<span class="mh">0xfe8c</span><span class="p">,</span> <span class="mh">0xfe9c</span><span class="p">,</span> <span class="mh">0xfeac</span><span class="p">,</span> <span class="mh">0xfebc</span><span class="p">,</span> <span class="mh">0xfecc</span><span class="p">,</span> <span class="mh">0xfedc</span><span class="p">,</span> <span class="mh">0xfeec</span><span class="p">,</span> <span class="mh">0xfefc</span><span class="p">,</span>
	<span class="mh">0xff0c</span><span class="p">,</span> <span class="mh">0xff1c</span><span class="p">,</span> <span class="mh">0xff2c</span><span class="p">,</span> <span class="mh">0xff3c</span><span class="p">,</span> <span class="mh">0xff4c</span><span class="p">,</span> <span class="mh">0xff5c</span><span class="p">,</span> <span class="mh">0xff6c</span><span class="p">,</span> <span class="mh">0xff7c</span><span class="p">,</span>
	<span class="mh">0xff88</span><span class="p">,</span> <span class="mh">0xff90</span><span class="p">,</span> <span class="mh">0xff98</span><span class="p">,</span> <span class="mh">0xffa0</span><span class="p">,</span> <span class="mh">0xffa8</span><span class="p">,</span> <span class="mh">0xffb0</span><span class="p">,</span> <span class="mh">0xffb8</span><span class="p">,</span> <span class="mh">0xffc0</span><span class="p">,</span>
	<span class="mh">0xffc8</span><span class="p">,</span> <span class="mh">0xffd0</span><span class="p">,</span> <span class="mh">0xffd8</span><span class="p">,</span> <span class="mh">0xffe0</span><span class="p">,</span> <span class="mh">0xffe8</span><span class="p">,</span> <span class="mh">0xfff0</span><span class="p">,</span> <span class="mh">0xfff8</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span>
	<span class="mh">0x7d7c</span><span class="p">,</span> <span class="mh">0x797c</span><span class="p">,</span> <span class="mh">0x757c</span><span class="p">,</span> <span class="mh">0x717c</span><span class="p">,</span> <span class="mh">0x6d7c</span><span class="p">,</span> <span class="mh">0x697c</span><span class="p">,</span> <span class="mh">0x657c</span><span class="p">,</span> <span class="mh">0x617c</span><span class="p">,</span>
	<span class="mh">0x5d7c</span><span class="p">,</span> <span class="mh">0x597c</span><span class="p">,</span> <span class="mh">0x557c</span><span class="p">,</span> <span class="mh">0x517c</span><span class="p">,</span> <span class="mh">0x4d7c</span><span class="p">,</span> <span class="mh">0x497c</span><span class="p">,</span> <span class="mh">0x457c</span><span class="p">,</span> <span class="mh">0x417c</span><span class="p">,</span>
	<span class="mh">0x3e7c</span><span class="p">,</span> <span class="mh">0x3c7c</span><span class="p">,</span> <span class="mh">0x3a7c</span><span class="p">,</span> <span class="mh">0x387c</span><span class="p">,</span> <span class="mh">0x367c</span><span class="p">,</span> <span class="mh">0x347c</span><span class="p">,</span> <span class="mh">0x327c</span><span class="p">,</span> <span class="mh">0x307c</span><span class="p">,</span>
	<span class="mh">0x2e7c</span><span class="p">,</span> <span class="mh">0x2c7c</span><span class="p">,</span> <span class="mh">0x2a7c</span><span class="p">,</span> <span class="mh">0x287c</span><span class="p">,</span> <span class="mh">0x267c</span><span class="p">,</span> <span class="mh">0x247c</span><span class="p">,</span> <span class="mh">0x227c</span><span class="p">,</span> <span class="mh">0x207c</span><span class="p">,</span>
	<span class="mh">0x1efc</span><span class="p">,</span> <span class="mh">0x1dfc</span><span class="p">,</span> <span class="mh">0x1cfc</span><span class="p">,</span> <span class="mh">0x1bfc</span><span class="p">,</span> <span class="mh">0x1afc</span><span class="p">,</span> <span class="mh">0x19fc</span><span class="p">,</span> <span class="mh">0x18fc</span><span class="p">,</span> <span class="mh">0x17fc</span><span class="p">,</span>
	<span class="mh">0x16fc</span><span class="p">,</span> <span class="mh">0x15fc</span><span class="p">,</span> <span class="mh">0x14fc</span><span class="p">,</span> <span class="mh">0x13fc</span><span class="p">,</span> <span class="mh">0x12fc</span><span class="p">,</span> <span class="mh">0x11fc</span><span class="p">,</span> <span class="mh">0x10fc</span><span class="p">,</span> <span class="mh">0x0ffc</span><span class="p">,</span>
	<span class="mh">0x0f3c</span><span class="p">,</span> <span class="mh">0x0ebc</span><span class="p">,</span> <span class="mh">0x0e3c</span><span class="p">,</span> <span class="mh">0x0dbc</span><span class="p">,</span> <span class="mh">0x0d3c</span><span class="p">,</span> <span class="mh">0x0cbc</span><span class="p">,</span> <span class="mh">0x0c3c</span><span class="p">,</span> <span class="mh">0x0bbc</span><span class="p">,</span>
	<span class="mh">0x0b3c</span><span class="p">,</span> <span class="mh">0x0abc</span><span class="p">,</span> <span class="mh">0x0a3c</span><span class="p">,</span> <span class="mh">0x09bc</span><span class="p">,</span> <span class="mh">0x093c</span><span class="p">,</span> <span class="mh">0x08bc</span><span class="p">,</span> <span class="mh">0x083c</span><span class="p">,</span> <span class="mh">0x07bc</span><span class="p">,</span>
	<span class="mh">0x075c</span><span class="p">,</span> <span class="mh">0x071c</span><span class="p">,</span> <span class="mh">0x06dc</span><span class="p">,</span> <span class="mh">0x069c</span><span class="p">,</span> <span class="mh">0x065c</span><span class="p">,</span> <span class="mh">0x061c</span><span class="p">,</span> <span class="mh">0x05dc</span><span class="p">,</span> <span class="mh">0x059c</span><span class="p">,</span>
	<span class="mh">0x055c</span><span class="p">,</span> <span class="mh">0x051c</span><span class="p">,</span> <span class="mh">0x04dc</span><span class="p">,</span> <span class="mh">0x049c</span><span class="p">,</span> <span class="mh">0x045c</span><span class="p">,</span> <span class="mh">0x041c</span><span class="p">,</span> <span class="mh">0x03dc</span><span class="p">,</span> <span class="mh">0x039c</span><span class="p">,</span>
	<span class="mh">0x036c</span><span class="p">,</span> <span class="mh">0x034c</span><span class="p">,</span> <span class="mh">0x032c</span><span class="p">,</span> <span class="mh">0x030c</span><span class="p">,</span> <span class="mh">0x02ec</span><span class="p">,</span> <span class="mh">0x02cc</span><span class="p">,</span> <span class="mh">0x02ac</span><span class="p">,</span> <span class="mh">0x028c</span><span class="p">,</span>
	<span class="mh">0x026c</span><span class="p">,</span> <span class="mh">0x024c</span><span class="p">,</span> <span class="mh">0x022c</span><span class="p">,</span> <span class="mh">0x020c</span><span class="p">,</span> <span class="mh">0x01ec</span><span class="p">,</span> <span class="mh">0x01cc</span><span class="p">,</span> <span class="mh">0x01ac</span><span class="p">,</span> <span class="mh">0x018c</span><span class="p">,</span>
	<span class="mh">0x0174</span><span class="p">,</span> <span class="mh">0x0164</span><span class="p">,</span> <span class="mh">0x0154</span><span class="p">,</span> <span class="mh">0x0144</span><span class="p">,</span> <span class="mh">0x0134</span><span class="p">,</span> <span class="mh">0x0124</span><span class="p">,</span> <span class="mh">0x0114</span><span class="p">,</span> <span class="mh">0x0104</span><span class="p">,</span>
	<span class="mh">0x00f4</span><span class="p">,</span> <span class="mh">0x00e4</span><span class="p">,</span> <span class="mh">0x00d4</span><span class="p">,</span> <span class="mh">0x00c4</span><span class="p">,</span> <span class="mh">0x00b4</span><span class="p">,</span> <span class="mh">0x00a4</span><span class="p">,</span> <span class="mh">0x0094</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span>
	<span class="mh">0x0078</span><span class="p">,</span> <span class="mh">0x0070</span><span class="p">,</span> <span class="mh">0x0068</span><span class="p">,</span> <span class="mh">0x0060</span><span class="p">,</span> <span class="mh">0x0058</span><span class="p">,</span> <span class="mh">0x0050</span><span class="p">,</span> <span class="mh">0x0048</span><span class="p">,</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="mh">0x0038</span><span class="p">,</span> <span class="mh">0x0030</span><span class="p">,</span> <span class="mh">0x0028</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">,</span> <span class="mh">0x0018</span><span class="p">,</span> <span class="mh">0x0010</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="mh">0x0000</span>
<span class="p">};</span>

<span class="cm">/* alaw -&gt; signed 16-bit */</span>
<span class="k">static</span> <span class="kt">short</span> <span class="n">isdn_audio_alaw_to_s16</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mh">0x13fc</span><span class="p">,</span> <span class="mh">0xec04</span><span class="p">,</span> <span class="mh">0x0144</span><span class="p">,</span> <span class="mh">0xfebc</span><span class="p">,</span> <span class="mh">0x517c</span><span class="p">,</span> <span class="mh">0xae84</span><span class="p">,</span> <span class="mh">0x051c</span><span class="p">,</span> <span class="mh">0xfae4</span><span class="p">,</span>
	<span class="mh">0x0a3c</span><span class="p">,</span> <span class="mh">0xf5c4</span><span class="p">,</span> <span class="mh">0x0048</span><span class="p">,</span> <span class="mh">0xffb8</span><span class="p">,</span> <span class="mh">0x287c</span><span class="p">,</span> <span class="mh">0xd784</span><span class="p">,</span> <span class="mh">0x028c</span><span class="p">,</span> <span class="mh">0xfd74</span><span class="p">,</span>
	<span class="mh">0x1bfc</span><span class="p">,</span> <span class="mh">0xe404</span><span class="p">,</span> <span class="mh">0x01cc</span><span class="p">,</span> <span class="mh">0xfe34</span><span class="p">,</span> <span class="mh">0x717c</span><span class="p">,</span> <span class="mh">0x8e84</span><span class="p">,</span> <span class="mh">0x071c</span><span class="p">,</span> <span class="mh">0xf8e4</span><span class="p">,</span>
	<span class="mh">0x0e3c</span><span class="p">,</span> <span class="mh">0xf1c4</span><span class="p">,</span> <span class="mh">0x00c4</span><span class="p">,</span> <span class="mh">0xff3c</span><span class="p">,</span> <span class="mh">0x387c</span><span class="p">,</span> <span class="mh">0xc784</span><span class="p">,</span> <span class="mh">0x039c</span><span class="p">,</span> <span class="mh">0xfc64</span><span class="p">,</span>
	<span class="mh">0x0ffc</span><span class="p">,</span> <span class="mh">0xf004</span><span class="p">,</span> <span class="mh">0x0104</span><span class="p">,</span> <span class="mh">0xfefc</span><span class="p">,</span> <span class="mh">0x417c</span><span class="p">,</span> <span class="mh">0xbe84</span><span class="p">,</span> <span class="mh">0x041c</span><span class="p">,</span> <span class="mh">0xfbe4</span><span class="p">,</span>
	<span class="mh">0x083c</span><span class="p">,</span> <span class="mh">0xf7c4</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="mh">0xfff8</span><span class="p">,</span> <span class="mh">0x207c</span><span class="p">,</span> <span class="mh">0xdf84</span><span class="p">,</span> <span class="mh">0x020c</span><span class="p">,</span> <span class="mh">0xfdf4</span><span class="p">,</span>
	<span class="mh">0x17fc</span><span class="p">,</span> <span class="mh">0xe804</span><span class="p">,</span> <span class="mh">0x018c</span><span class="p">,</span> <span class="mh">0xfe74</span><span class="p">,</span> <span class="mh">0x617c</span><span class="p">,</span> <span class="mh">0x9e84</span><span class="p">,</span> <span class="mh">0x061c</span><span class="p">,</span> <span class="mh">0xf9e4</span><span class="p">,</span>
	<span class="mh">0x0c3c</span><span class="p">,</span> <span class="mh">0xf3c4</span><span class="p">,</span> <span class="mh">0x0084</span><span class="p">,</span> <span class="mh">0xff7c</span><span class="p">,</span> <span class="mh">0x307c</span><span class="p">,</span> <span class="mh">0xcf84</span><span class="p">,</span> <span class="mh">0x030c</span><span class="p">,</span> <span class="mh">0xfcf4</span><span class="p">,</span>
	<span class="mh">0x15fc</span><span class="p">,</span> <span class="mh">0xea04</span><span class="p">,</span> <span class="mh">0x0164</span><span class="p">,</span> <span class="mh">0xfe9c</span><span class="p">,</span> <span class="mh">0x597c</span><span class="p">,</span> <span class="mh">0xa684</span><span class="p">,</span> <span class="mh">0x059c</span><span class="p">,</span> <span class="mh">0xfa64</span><span class="p">,</span>
	<span class="mh">0x0b3c</span><span class="p">,</span> <span class="mh">0xf4c4</span><span class="p">,</span> <span class="mh">0x0068</span><span class="p">,</span> <span class="mh">0xff98</span><span class="p">,</span> <span class="mh">0x2c7c</span><span class="p">,</span> <span class="mh">0xd384</span><span class="p">,</span> <span class="mh">0x02cc</span><span class="p">,</span> <span class="mh">0xfd34</span><span class="p">,</span>
	<span class="mh">0x1dfc</span><span class="p">,</span> <span class="mh">0xe204</span><span class="p">,</span> <span class="mh">0x01ec</span><span class="p">,</span> <span class="mh">0xfe14</span><span class="p">,</span> <span class="mh">0x797c</span><span class="p">,</span> <span class="mh">0x8684</span><span class="p">,</span> <span class="mh">0x07bc</span><span class="p">,</span> <span class="mh">0xf844</span><span class="p">,</span>
	<span class="mh">0x0f3c</span><span class="p">,</span> <span class="mh">0xf0c4</span><span class="p">,</span> <span class="mh">0x00e4</span><span class="p">,</span> <span class="mh">0xff1c</span><span class="p">,</span> <span class="mh">0x3c7c</span><span class="p">,</span> <span class="mh">0xc384</span><span class="p">,</span> <span class="mh">0x03dc</span><span class="p">,</span> <span class="mh">0xfc24</span><span class="p">,</span>
	<span class="mh">0x11fc</span><span class="p">,</span> <span class="mh">0xee04</span><span class="p">,</span> <span class="mh">0x0124</span><span class="p">,</span> <span class="mh">0xfedc</span><span class="p">,</span> <span class="mh">0x497c</span><span class="p">,</span> <span class="mh">0xb684</span><span class="p">,</span> <span class="mh">0x049c</span><span class="p">,</span> <span class="mh">0xfb64</span><span class="p">,</span>
	<span class="mh">0x093c</span><span class="p">,</span> <span class="mh">0xf6c4</span><span class="p">,</span> <span class="mh">0x0028</span><span class="p">,</span> <span class="mh">0xffd8</span><span class="p">,</span> <span class="mh">0x247c</span><span class="p">,</span> <span class="mh">0xdb84</span><span class="p">,</span> <span class="mh">0x024c</span><span class="p">,</span> <span class="mh">0xfdb4</span><span class="p">,</span>
	<span class="mh">0x19fc</span><span class="p">,</span> <span class="mh">0xe604</span><span class="p">,</span> <span class="mh">0x01ac</span><span class="p">,</span> <span class="mh">0xfe54</span><span class="p">,</span> <span class="mh">0x697c</span><span class="p">,</span> <span class="mh">0x9684</span><span class="p">,</span> <span class="mh">0x069c</span><span class="p">,</span> <span class="mh">0xf964</span><span class="p">,</span>
	<span class="mh">0x0d3c</span><span class="p">,</span> <span class="mh">0xf2c4</span><span class="p">,</span> <span class="mh">0x00a4</span><span class="p">,</span> <span class="mh">0xff5c</span><span class="p">,</span> <span class="mh">0x347c</span><span class="p">,</span> <span class="mh">0xcb84</span><span class="p">,</span> <span class="mh">0x034c</span><span class="p">,</span> <span class="mh">0xfcb4</span><span class="p">,</span>
	<span class="mh">0x12fc</span><span class="p">,</span> <span class="mh">0xed04</span><span class="p">,</span> <span class="mh">0x0134</span><span class="p">,</span> <span class="mh">0xfecc</span><span class="p">,</span> <span class="mh">0x4d7c</span><span class="p">,</span> <span class="mh">0xb284</span><span class="p">,</span> <span class="mh">0x04dc</span><span class="p">,</span> <span class="mh">0xfb24</span><span class="p">,</span>
	<span class="mh">0x09bc</span><span class="p">,</span> <span class="mh">0xf644</span><span class="p">,</span> <span class="mh">0x0038</span><span class="p">,</span> <span class="mh">0xffc8</span><span class="p">,</span> <span class="mh">0x267c</span><span class="p">,</span> <span class="mh">0xd984</span><span class="p">,</span> <span class="mh">0x026c</span><span class="p">,</span> <span class="mh">0xfd94</span><span class="p">,</span>
	<span class="mh">0x1afc</span><span class="p">,</span> <span class="mh">0xe504</span><span class="p">,</span> <span class="mh">0x01ac</span><span class="p">,</span> <span class="mh">0xfe54</span><span class="p">,</span> <span class="mh">0x6d7c</span><span class="p">,</span> <span class="mh">0x9284</span><span class="p">,</span> <span class="mh">0x06dc</span><span class="p">,</span> <span class="mh">0xf924</span><span class="p">,</span>
	<span class="mh">0x0dbc</span><span class="p">,</span> <span class="mh">0xf244</span><span class="p">,</span> <span class="mh">0x00b4</span><span class="p">,</span> <span class="mh">0xff4c</span><span class="p">,</span> <span class="mh">0x367c</span><span class="p">,</span> <span class="mh">0xc984</span><span class="p">,</span> <span class="mh">0x036c</span><span class="p">,</span> <span class="mh">0xfc94</span><span class="p">,</span>
	<span class="mh">0x0f3c</span><span class="p">,</span> <span class="mh">0xf0c4</span><span class="p">,</span> <span class="mh">0x00f4</span><span class="p">,</span> <span class="mh">0xff0c</span><span class="p">,</span> <span class="mh">0x3e7c</span><span class="p">,</span> <span class="mh">0xc184</span><span class="p">,</span> <span class="mh">0x03dc</span><span class="p">,</span> <span class="mh">0xfc24</span><span class="p">,</span>
	<span class="mh">0x07bc</span><span class="p">,</span> <span class="mh">0xf844</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="mh">0xfff8</span><span class="p">,</span> <span class="mh">0x1efc</span><span class="p">,</span> <span class="mh">0xe104</span><span class="p">,</span> <span class="mh">0x01ec</span><span class="p">,</span> <span class="mh">0xfe14</span><span class="p">,</span>
	<span class="mh">0x16fc</span><span class="p">,</span> <span class="mh">0xe904</span><span class="p">,</span> <span class="mh">0x0174</span><span class="p">,</span> <span class="mh">0xfe8c</span><span class="p">,</span> <span class="mh">0x5d7c</span><span class="p">,</span> <span class="mh">0xa284</span><span class="p">,</span> <span class="mh">0x05dc</span><span class="p">,</span> <span class="mh">0xfa24</span><span class="p">,</span>
	<span class="mh">0x0bbc</span><span class="p">,</span> <span class="mh">0xf444</span><span class="p">,</span> <span class="mh">0x0078</span><span class="p">,</span> <span class="mh">0xff88</span><span class="p">,</span> <span class="mh">0x2e7c</span><span class="p">,</span> <span class="mh">0xd184</span><span class="p">,</span> <span class="mh">0x02ec</span><span class="p">,</span> <span class="mh">0xfd14</span><span class="p">,</span>
	<span class="mh">0x14fc</span><span class="p">,</span> <span class="mh">0xeb04</span><span class="p">,</span> <span class="mh">0x0154</span><span class="p">,</span> <span class="mh">0xfeac</span><span class="p">,</span> <span class="mh">0x557c</span><span class="p">,</span> <span class="mh">0xaa84</span><span class="p">,</span> <span class="mh">0x055c</span><span class="p">,</span> <span class="mh">0xfaa4</span><span class="p">,</span>
	<span class="mh">0x0abc</span><span class="p">,</span> <span class="mh">0xf544</span><span class="p">,</span> <span class="mh">0x0058</span><span class="p">,</span> <span class="mh">0xffa8</span><span class="p">,</span> <span class="mh">0x2a7c</span><span class="p">,</span> <span class="mh">0xd584</span><span class="p">,</span> <span class="mh">0x02ac</span><span class="p">,</span> <span class="mh">0xfd54</span><span class="p">,</span>
	<span class="mh">0x1cfc</span><span class="p">,</span> <span class="mh">0xe304</span><span class="p">,</span> <span class="mh">0x01cc</span><span class="p">,</span> <span class="mh">0xfe34</span><span class="p">,</span> <span class="mh">0x757c</span><span class="p">,</span> <span class="mh">0x8a84</span><span class="p">,</span> <span class="mh">0x075c</span><span class="p">,</span> <span class="mh">0xf8a4</span><span class="p">,</span>
	<span class="mh">0x0ebc</span><span class="p">,</span> <span class="mh">0xf144</span><span class="p">,</span> <span class="mh">0x00d4</span><span class="p">,</span> <span class="mh">0xff2c</span><span class="p">,</span> <span class="mh">0x3a7c</span><span class="p">,</span> <span class="mh">0xc584</span><span class="p">,</span> <span class="mh">0x039c</span><span class="p">,</span> <span class="mh">0xfc64</span><span class="p">,</span>
	<span class="mh">0x10fc</span><span class="p">,</span> <span class="mh">0xef04</span><span class="p">,</span> <span class="mh">0x0114</span><span class="p">,</span> <span class="mh">0xfeec</span><span class="p">,</span> <span class="mh">0x457c</span><span class="p">,</span> <span class="mh">0xba84</span><span class="p">,</span> <span class="mh">0x045c</span><span class="p">,</span> <span class="mh">0xfba4</span><span class="p">,</span>
	<span class="mh">0x08bc</span><span class="p">,</span> <span class="mh">0xf744</span><span class="p">,</span> <span class="mh">0x0018</span><span class="p">,</span> <span class="mh">0xffe8</span><span class="p">,</span> <span class="mh">0x227c</span><span class="p">,</span> <span class="mh">0xdd84</span><span class="p">,</span> <span class="mh">0x022c</span><span class="p">,</span> <span class="mh">0xfdd4</span><span class="p">,</span>
	<span class="mh">0x18fc</span><span class="p">,</span> <span class="mh">0xe704</span><span class="p">,</span> <span class="mh">0x018c</span><span class="p">,</span> <span class="mh">0xfe74</span><span class="p">,</span> <span class="mh">0x657c</span><span class="p">,</span> <span class="mh">0x9a84</span><span class="p">,</span> <span class="mh">0x065c</span><span class="p">,</span> <span class="mh">0xf9a4</span><span class="p">,</span>
	<span class="mh">0x0cbc</span><span class="p">,</span> <span class="mh">0xf344</span><span class="p">,</span> <span class="mh">0x0094</span><span class="p">,</span> <span class="mh">0xff6c</span><span class="p">,</span> <span class="mh">0x327c</span><span class="p">,</span> <span class="mh">0xcd84</span><span class="p">,</span> <span class="mh">0x032c</span><span class="p">,</span> <span class="mh">0xfcd4</span>
<span class="p">};</span>

<span class="cm">/* alaw -&gt; ulaw */</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">isdn_audio_alaw_to_ulaw</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span>
	<span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span>
	<span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span>
	<span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span>
	<span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span>
	<span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span>
	<span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span>
	<span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span>
	<span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span>
	<span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span>
	<span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span>
	<span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span>
	<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span>
	<span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span>
	<span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span>
	<span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span>
	<span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span>
	<span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span>
	<span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span>
	<span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span>
	<span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span>
	<span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span>
	<span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span>
	<span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
	<span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span>
	<span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span>
	<span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span>
	<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span>
	<span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span>
	<span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">,</span> <span class="mh">0x52</span>
<span class="p">};</span>

<span class="cm">/* ulaw -&gt; alaw */</span>
<span class="k">static</span> <span class="kt">char</span> <span class="n">isdn_audio_ulaw_to_alaw</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span>
	<span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span>
	<span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span>
	<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span>
	<span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span>
	<span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span>
	<span class="mh">0x49</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span>
	<span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span>
	<span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span>
	<span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span>
	<span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span>
	<span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span>
	<span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span>
	<span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0xbb</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span>
	<span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span>
	<span class="mh">0xab</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span>
	<span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span>
	<span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span>
	<span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span>
	<span class="mh">0xac</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="mh">0x58</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span>
	<span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span>
	<span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span>
	<span class="mh">0xc6</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span>
	<span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span>
	<span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span>
	<span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0xda</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span>
	<span class="mh">0xba</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span>
	<span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x2a</span>
<span class="p">};</span>

<span class="cp">#define NCOEFF            8     </span><span class="cm">/* number of frequencies to be analyzed       */</span><span class="cp"></span>
<span class="cp">#define DTMF_TRESH     4000     </span><span class="cm">/* above this is dtmf                         */</span><span class="cp"></span>
<span class="cp">#define SILENCE_TRESH   200     </span><span class="cm">/* below this is silence                      */</span><span class="cp"></span>
<span class="cp">#define AMP_BITS          9     </span><span class="cm">/* bits per sample, reduced to avoid overflow */</span><span class="cp"></span>
<span class="cp">#define LOGRP             0</span>
<span class="cp">#define HIGRP             1</span>

<span class="cm">/* For DTMF recognition:</span>
<span class="cm"> * 2 * cos(2 * PI * k / N) precalculated for all k</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">cos2pik</span><span class="p">[</span><span class="n">NCOEFF</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mi">55813</span><span class="p">,</span> <span class="mi">53604</span><span class="p">,</span> <span class="mi">51193</span><span class="p">,</span> <span class="mi">48591</span><span class="p">,</span> <span class="mi">38114</span><span class="p">,</span> <span class="mi">33057</span><span class="p">,</span> <span class="mi">25889</span><span class="p">,</span> <span class="mi">18332</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">dtmf_matrix</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="sc">&#39;2&#39;</span><span class="p">,</span> <span class="sc">&#39;3&#39;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span><span class="p">},</span>
	<span class="p">{</span><span class="sc">&#39;4&#39;</span><span class="p">,</span> <span class="sc">&#39;5&#39;</span><span class="p">,</span> <span class="sc">&#39;6&#39;</span><span class="p">,</span> <span class="sc">&#39;B&#39;</span><span class="p">},</span>
	<span class="p">{</span><span class="sc">&#39;7&#39;</span><span class="p">,</span> <span class="sc">&#39;8&#39;</span><span class="p">,</span> <span class="sc">&#39;9&#39;</span><span class="p">,</span> <span class="sc">&#39;C&#39;</span><span class="p">},</span>
	<span class="p">{</span><span class="sc">&#39;*&#39;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="sc">&#39;#&#39;</span><span class="p">,</span> <span class="sc">&#39;D&#39;</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">isdn_audio_tlookup</span><span class="p">(</span><span class="k">const</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">table</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">buff</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef __i386__</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">d0</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span><span class="p">;</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span><span class="p">(</span>
		<span class="s">&quot;cld</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;1:</span><span class="se">\t</span><span class="s">lodsb</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;xlatb</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;stosb</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="s">&quot;loop 1b</span><span class="se">\n\t</span><span class="s">&quot;</span>
		<span class="o">:</span>	<span class="s">&quot;=&amp;b&quot;</span><span class="p">(</span><span class="n">d0</span><span class="p">),</span> <span class="s">&quot;=&amp;c&quot;</span><span class="p">(</span><span class="n">d1</span><span class="p">),</span> <span class="s">&quot;=&amp;D&quot;</span><span class="p">(</span><span class="n">d2</span><span class="p">),</span> <span class="s">&quot;=&amp;S&quot;</span><span class="p">(</span><span class="n">d3</span><span class="p">)</span>
		<span class="o">:</span>	<span class="s">&quot;0&quot;</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">table</span><span class="p">),</span> <span class="s">&quot;1&quot;</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="s">&quot;2&quot;</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">buff</span><span class="p">),</span> <span class="s">&quot;3&quot;</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span> <span class="n">buff</span><span class="p">)</span>
		<span class="o">:</span>	<span class="s">&quot;memory&quot;</span><span class="p">,</span> <span class="s">&quot;ax&quot;</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">buff</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">buff</span><span class="p">],</span> <span class="n">buff</span><span class="o">++</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_ulaw2alaw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buff</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">isdn_audio_tlookup</span><span class="p">(</span><span class="n">isdn_audio_ulaw_to_alaw</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_alaw2ulaw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buff</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">isdn_audio_tlookup</span><span class="p">(</span><span class="n">isdn_audio_alaw_to_ulaw</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * linear &lt;-&gt; adpcm conversion stuff</span>
<span class="cm"> * Most parts from the mgetty-package.</span>
<span class="cm"> * (C) by Gert Doering and Klaus Weidner</span>
<span class="cm"> * Used by permission of Gert Doering</span>
<span class="cm"> */</span>


<span class="cp">#define ZEROTRAP                </span><span class="cm">/* turn on the trap as per the MIL-STD */</span><span class="cp"></span>
<span class="cp">#undef ZEROTRAP</span>
<span class="cp">#define BIAS 0x84               </span><span class="cm">/* define the add-in bias for 16 bit samples */</span><span class="cp"></span>
<span class="cp">#define CLIP 32635</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span>
<span class="nf">isdn_audio_linear2ulaw</span><span class="p">(</span><span class="kt">int</span> <span class="n">sample</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">int</span> <span class="n">exp_lut</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span>
		<span class="p">{</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
			<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
			<span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
			<span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
			<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
			<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span>
		<span class="p">};</span>
	<span class="kt">int</span> <span class="n">sign</span><span class="p">,</span>
		<span class="n">exponent</span><span class="p">,</span>
		<span class="n">mantissa</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ulawbyte</span><span class="p">;</span>

	<span class="cm">/* Get the sample into sign-magnitude. */</span>
	<span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>	<span class="cm">/* set aside the sign  */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sign</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">sample</span> <span class="o">=</span> <span class="o">-</span><span class="n">sample</span><span class="p">;</span>	<span class="cm">/* get magnitude       */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;</span> <span class="n">CLIP</span><span class="p">)</span>
		<span class="n">sample</span> <span class="o">=</span> <span class="n">CLIP</span><span class="p">;</span>  <span class="cm">/* clip the magnitude  */</span>

	<span class="cm">/* Convert from 16 bit linear to ulaw. */</span>
	<span class="n">sample</span> <span class="o">=</span> <span class="n">sample</span> <span class="o">+</span> <span class="n">BIAS</span><span class="p">;</span>
	<span class="n">exponent</span> <span class="o">=</span> <span class="n">exp_lut</span><span class="p">[(</span><span class="n">sample</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">];</span>
	<span class="n">mantissa</span> <span class="o">=</span> <span class="p">(</span><span class="n">sample</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">exponent</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">;</span>
	<span class="n">ulawbyte</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">sign</span> <span class="o">|</span> <span class="p">(</span><span class="n">exponent</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">mantissa</span><span class="p">);</span>
<span class="cp">#ifdef ZEROTRAP</span>
	<span class="cm">/* optional CCITT trap */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ulawbyte</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">ulawbyte</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">ulawbyte</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="n">Mx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="mh">0x3800</span><span class="p">,</span> <span class="mh">0x5600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x399a</span><span class="p">,</span> <span class="mh">0x3a9f</span><span class="p">,</span> <span class="mh">0x4d14</span><span class="p">,</span> <span class="mh">0x6607</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3556</span><span class="p">,</span> <span class="mh">0x3556</span><span class="p">,</span> <span class="mh">0x399A</span><span class="p">,</span> <span class="mh">0x3A9F</span><span class="p">,</span> <span class="mh">0x4200</span><span class="p">,</span> <span class="mh">0x4D14</span><span class="p">,</span> <span class="mh">0x6607</span><span class="p">,</span> <span class="mh">0x6607</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0xff</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">isdn_audio_get_bits</span><span class="p">(</span><span class="n">adpcm_state</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">in</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">&lt;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="o">*</span><span class="n">in</span><span class="p">)</span><span class="o">++</span><span class="p">);</span>
		<span class="p">(</span><span class="o">*</span><span class="n">len</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">d</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">-=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">bitmask</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">isdn_audio_put_bits</span><span class="p">(</span><span class="kt">int</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbits</span><span class="p">,</span> <span class="n">adpcm_state</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">out</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">&lt;&lt;</span> <span class="n">nbits</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">bitmask</span><span class="p">[</span><span class="n">nbits</span><span class="p">]);</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">+=</span> <span class="n">nbits</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">-</span> <span class="mi">8</span><span class="p">));</span>
		<span class="o">*</span><span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">)</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span>
		<span class="p">(</span><span class="o">*</span><span class="n">len</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">-=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">adpcm_state</span> <span class="o">*</span>
<span class="nf">isdn_audio_adpcm_init</span><span class="p">(</span><span class="n">adpcm_state</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">adpcm_state</span><span class="p">),</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">d</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">nleft</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span> <span class="o">=</span> <span class="n">nbits</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">dtmf_state</span> <span class="o">*</span>
<span class="nf">isdn_audio_dtmf_init</span><span class="p">(</span><span class="n">dtmf_state</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">dtmf_state</span><span class="p">),</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decompression of adpcm data to a/u-law</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="kt">int</span>
<span class="nf">isdn_audio_adpcm2xlaw</span><span class="p">(</span><span class="n">adpcm_state</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span>
		      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nbits</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">olen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="n">isdn_audio_get_bits</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">in</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">sign</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">nbits</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">e</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">d</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">e</span> <span class="o">&amp;=</span> <span class="n">bitmask</span><span class="p">[</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
		<span class="n">a</span> <span class="o">+=</span> <span class="n">sign</span> <span class="o">*</span> <span class="p">((</span><span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">a</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
			<span class="o">*</span><span class="n">out</span><span class="o">++</span> <span class="o">=</span> <span class="n">isdn_audio_ulaw_to_alaw</span><span class="p">[</span>
				<span class="n">isdn_audio_linear2ulaw</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)];</span>
		<span class="k">else</span>
			<span class="o">*</span><span class="n">out</span><span class="o">++</span> <span class="o">=</span> <span class="n">isdn_audio_linear2ulaw</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">olen</span><span class="o">++</span><span class="p">;</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">Mx</span><span class="p">[</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x2000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span>
			<span class="n">d</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">olen</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span>
<span class="nf">isdn_audio_xlaw2adpcm</span><span class="p">(</span><span class="n">adpcm_state</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span>
		      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">a</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">d</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">d</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nbits</span> <span class="o">=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">nbits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">olen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">nmax</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">sign</span><span class="p">,</span>
			<span class="n">delta</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">isdn_audio_alaw_to_s16</span><span class="p">[</span><span class="o">*</span><span class="n">in</span><span class="o">++</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">isdn_audio_ulaw_to_s16</span><span class="p">[</span><span class="o">*</span><span class="n">in</span><span class="o">++</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">e</span> <span class="o">=</span> <span class="n">nmax</span><span class="p">;</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="o">-</span><span class="n">delta</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">nmax</span> <span class="o">&amp;&amp;</span> <span class="n">delta</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">delta</span> <span class="o">-=</span> <span class="n">d</span><span class="p">;</span>
			<span class="n">e</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nbits</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">e</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
			<span class="n">e</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">isdn_audio_put_bits</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">nbits</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">olen</span><span class="p">);</span>
		<span class="n">sign</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">e</span> <span class="o">&amp;=</span> <span class="n">bitmask</span><span class="p">[</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

		<span class="n">a</span> <span class="o">+=</span> <span class="n">sign</span> <span class="o">*</span> <span class="p">((</span><span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">a</span><span class="o">++</span><span class="p">;</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">Mx</span><span class="p">[</span><span class="n">nbits</span> <span class="o">-</span> <span class="mi">2</span><span class="p">][</span><span class="n">e</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x2000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">14</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span>
			<span class="n">d</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">s</span><span class="o">-&gt;</span><span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">olen</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Goertzel algorithm.</span>
<span class="cm"> * See http://ptolemy.eecs.berkeley.edu/papers/96/dtmf_ict/</span>
<span class="cm"> * for more info.</span>
<span class="cm"> * Result is stored into an sk_buff and queued up for later</span>
<span class="cm"> * evaluation.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">isdn_audio_goertzel</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">sample</span><span class="p">,</span> <span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">sk</span><span class="p">,</span>
		<span class="n">sk1</span><span class="p">,</span>
		<span class="n">sk2</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">k</span><span class="p">,</span>
		<span class="n">n</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

	<span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">NCOEFF</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">skb</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span>
		       <span class="s">&quot;isdn_audio: Could not alloc DTMF result for ttyI%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">info</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb_put</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">NCOEFF</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">NCOEFF</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sk</span> <span class="o">=</span> <span class="n">sk1</span> <span class="o">=</span> <span class="n">sk2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">DTMF_NPOINTS</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sk</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">cos2pik</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sk1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">-</span> <span class="n">sk2</span><span class="p">;</span>
			<span class="n">sk2</span> <span class="o">=</span> <span class="n">sk1</span><span class="p">;</span>
			<span class="n">sk1</span> <span class="o">=</span> <span class="n">sk</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* Avoid overflows */</span>
		<span class="n">sk</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">sk2</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* compute |X(k)|**2 */</span>
		<span class="cm">/* report overflows. This should not happen. */</span>
		<span class="cm">/* Comment this out if desired */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sk</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">||</span> <span class="n">sk</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
			       <span class="s">&quot;isdn_audio: dtmf goertzel overflow, sk=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sk</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sk2</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">||</span> <span class="n">sk2</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
			       <span class="s">&quot;isdn_audio: dtmf goertzel overflow, sk2=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sk2</span><span class="p">);</span>
		<span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span>
			<span class="p">((</span><span class="n">sk</span> <span class="o">*</span> <span class="n">sk</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AMP_BITS</span><span class="p">)</span> <span class="o">-</span>
			<span class="p">((((</span><span class="n">cos2pik</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">sk</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">*</span> <span class="n">sk2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AMP_BITS</span><span class="p">)</span> <span class="o">+</span>
			<span class="p">((</span><span class="n">sk2</span> <span class="o">*</span> <span class="n">sk2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AMP_BITS</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">skb_queue_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">dtmf_queue</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>
	<span class="n">isdn_timer_ctrl</span><span class="p">(</span><span class="n">ISDN_TIMER_MODEMREAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_eval_dtmf</span><span class="p">(</span><span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>
	<span class="n">dtmf_state</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">silence</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">di</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">grp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">what</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">thresh</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">((</span><span class="n">skb</span> <span class="o">=</span> <span class="n">skb_dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">dtmf_queue</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">dtmf_state</span><span class="p">;</span>
		<span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]</span> <span class="o">=</span> <span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">silence</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">thresh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NCOEFF</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">DTMF_TRESH</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span>
					<span class="n">thresh</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">SILENCE_TRESH</span><span class="p">)</span>
				<span class="n">silence</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">silence</span> <span class="o">==</span> <span class="n">NCOEFF</span><span class="p">)</span>
			<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">thresh</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>	<span class="p">{</span>
				<span class="n">thresh</span> <span class="o">=</span> <span class="n">thresh</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>  <span class="cm">/* touchtones must match within 12 dB */</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NCOEFF</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">thresh</span><span class="p">)</span>
						<span class="k">continue</span><span class="p">;</span>  <span class="cm">/* ignore */</span>
					<span class="cm">/* good level found. This is allowed only one time per group */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">NCOEFF</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
						<span class="cm">/* lowgroup*/</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Bad. Another tone found. */</p></td><td class="code"><div class="highlight"><pre>							<span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">else</span>
							<span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span> <span class="cm">/* higroup */</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Bad. Another tone found. */</span>
							<span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">else</span>
							<span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">NCOEFF</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">what</span> <span class="o">=</span> <span class="n">dtmf_matrix</span><span class="p">[</span><span class="n">grp</span><span class="p">[</span><span class="n">LOGRP</span><span class="p">]][</span><span class="n">grp</span><span class="p">[</span><span class="n">HIGRP</span><span class="p">]];</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span> <span class="o">&amp;&amp;</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span> <span class="o">!=</span> <span class="sc">&#39;.&#39;</span><span class="p">)</span>
						<span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span> <span class="o">=</span> <span class="n">what</span><span class="p">;</span>	<span class="cm">/* min. 1 non-DTMF between DTMF */</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39;.&#39;</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
				<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39;.&#39;</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">what</span> <span class="o">!=</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">what</span> <span class="o">!=</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">what</span> <span class="o">!=</span> <span class="sc">&#39;.&#39;</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;dtmf: tt=&#39;%c&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">what</span><span class="p">);</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
			<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
			<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">what</span><span class="p">;</span>
			<span class="n">skb_trim</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">ISDN_AUDIO_SKB_DLECOUNT</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">ISDN_AUDIO_SKB_LOCK</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">di</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">isdn_driver</span><span class="p">;</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">isdn_channel</span><span class="p">;</span>
			<span class="n">__skb_queue_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rpqueue</span><span class="p">[</span><span class="n">ch</span><span class="p">],</span> <span class="n">skb</span><span class="p">);</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rcvcount</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="cm">/* Schedule dequeuing */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">modempoll</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">rcvsched</span><span class="p">))</span>
				<span class="n">isdn_timer_ctrl</span><span class="p">(</span><span class="n">ISDN_TIMER_MODEMREAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">wake_up_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rcv_waitq</span><span class="p">[</span><span class="n">ch</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">kfree_skb</span><span class="p">(</span><span class="n">skb</span><span class="p">);</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">last</span> <span class="o">=</span> <span class="n">what</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode DTMF tones, queue result in separate sk_buf for</span>
<span class="cm"> * later examination.</span>
<span class="cm"> * Parameters:</span>
<span class="cm"> *   s    = pointer to state-struct.</span>
<span class="cm"> *   buf  = input audio data</span>
<span class="cm"> *   len  = size of audio data.</span>
<span class="cm"> *   fmt  = audio data format (0 = ulaw, 1 = alaw)</span>
<span class="cm"> */</span>
<span class="kt">void</span>
<span class="nf">isdn_audio_calc_dtmf</span><span class="p">(</span><span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dtmf_state</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">dtmf_state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">c</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">DTMF_NPOINTS</span> <span class="o">-</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">len</span><span class="p">)</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
				<span class="n">s</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">isdn_audio_alaw_to_s16</span><span class="p">[</span><span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">15</span> <span class="o">-</span> <span class="n">AMP_BITS</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">s</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">[</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">isdn_audio_ulaw_to_s16</span><span class="p">[</span><span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">15</span> <span class="o">-</span> <span class="n">AMP_BITS</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">==</span> <span class="n">DTMF_NPOINTS</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">isdn_audio_goertzel</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">buf</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
			<span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">-=</span> <span class="n">c</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">silence_state</span> <span class="o">*</span>
<span class="nf">isdn_audio_silence_init</span><span class="p">(</span><span class="n">silence_state</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">)</span>
		<span class="n">s</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">silence_state</span><span class="p">),</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">s</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_calc_silence</span><span class="p">(</span><span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">silence_state</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">silence_state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">signed</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">emu</span><span class="p">.</span><span class="n">vpar</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">isdn_audio_alaw_to_ulaw</span><span class="p">[</span><span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">];</span>
		<span class="k">else</span>
			<span class="n">c</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">c</span> <span class="o">-=</span> <span class="mi">128</span><span class="p">;</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">emu</span><span class="p">.</span><span class="n">vpar</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">s</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">210000</span><span class="p">)</span> <span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_put_dle_code</span><span class="p">(</span><span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="n">u_char</span> <span class="n">code</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">di</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">skb</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span>
		       <span class="s">&quot;isdn_audio: Could not alloc skb for ttyI%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">info</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb_put</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">code</span><span class="p">;</span>
	<span class="n">ISDN_AUDIO_SKB_DLECOUNT</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ISDN_AUDIO_SKB_LOCK</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">di</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">isdn_driver</span><span class="p">;</span>
	<span class="n">ch</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">isdn_channel</span><span class="p">;</span>
	<span class="n">__skb_queue_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rpqueue</span><span class="p">[</span><span class="n">ch</span><span class="p">],</span> <span class="n">skb</span><span class="p">);</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rcvcount</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="cm">/* Schedule dequeuing */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">modempoll</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">rcvsched</span><span class="p">))</span>
		<span class="n">isdn_timer_ctrl</span><span class="p">(</span><span class="n">ISDN_TIMER_MODEMREAD</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">wake_up_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="p">[</span><span class="n">di</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">rcv_waitq</span><span class="p">[</span><span class="n">ch</span><span class="p">]);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">isdn_audio_eval_silence</span><span class="p">(</span><span class="n">modem_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">silence_state</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">silence_state</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">what</span><span class="p">;</span>

	<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">emu</span><span class="p">.</span><span class="n">vpar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">800</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* silence from beginning of rec */</span>
			<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39;s&#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">what</span> <span class="o">=</span> <span class="sc">&#39;q&#39;</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">what</span> <span class="o">==</span> <span class="sc">&#39;s&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">what</span> <span class="o">==</span> <span class="sc">&#39;q&#39;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;ttyI%d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">line</span><span class="p">,</span>
		       <span class="p">(</span><span class="n">what</span> <span class="o">==</span> <span class="sc">&#39;s&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;silence&quot;</span> <span class="o">:</span> <span class="s">&quot;quiet&quot;</span><span class="p">);</span>
		<span class="n">isdn_audio_put_dle_code</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">what</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
