<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › hisax › q931.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>q931.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: q931.c,v 1.12.2.3 2004/01/13 14:31:26 keil Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * code to decode ITU Q.931 call control messages</span>
<span class="cm"> *</span>
<span class="cm"> * Author       Jan den Ouden</span>
<span class="cm"> * Copyright    by Jan den Ouden</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> * Changelog:</span>
<span class="cm"> *</span>
<span class="cm"> * Pauline Middelink    general improvements</span>
<span class="cm"> * Beat Doebeli         cause texts, display information element</span>
<span class="cm"> * Karsten Keil         cause texts, display information element for 1TR6</span>
<span class="cm"> *</span>
<span class="cm"> */</span>


<span class="cp">#include &quot;hisax.h&quot;</span>
<span class="cp">#include &quot;l3_1tr6.h&quot;</span>

<span class="kt">void</span>
<span class="nf">iecpy</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">iestart</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ieoffset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">iestart</span> <span class="o">+</span> <span class="n">ieoffset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="n">iestart</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ieoffset</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dest</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dest</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * According to Table 4-2/Q.931</span>
<span class="cm"> */</span>
<span class="k">static</span>
<span class="k">struct</span> <span class="n">MessageType</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">nr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">mtlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="p">{</span>
		<span class="mh">0x1</span><span class="p">,</span> <span class="s">&quot;ALERTING&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2</span><span class="p">,</span> <span class="s">&quot;CALL PROCEEDING&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7</span><span class="p">,</span> <span class="s">&quot;CONNECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0xf</span><span class="p">,</span> <span class="s">&quot;CONNECT ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x3</span><span class="p">,</span> <span class="s">&quot;PROGRESS&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x5</span><span class="p">,</span> <span class="s">&quot;SETUP&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0xd</span><span class="p">,</span> <span class="s">&quot;SETUP ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x24</span><span class="p">,</span> <span class="s">&quot;HOLD&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x28</span><span class="p">,</span> <span class="s">&quot;HOLD ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x30</span><span class="p">,</span> <span class="s">&quot;HOLD REJECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x31</span><span class="p">,</span> <span class="s">&quot;RETRIEVE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x33</span><span class="p">,</span> <span class="s">&quot;RETRIEVE ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x37</span><span class="p">,</span> <span class="s">&quot;RETRIEVE REJECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x26</span><span class="p">,</span> <span class="s">&quot;RESUME&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2e</span><span class="p">,</span> <span class="s">&quot;RESUME ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x22</span><span class="p">,</span> <span class="s">&quot;RESUME REJECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x25</span><span class="p">,</span> <span class="s">&quot;SUSPEND&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2d</span><span class="p">,</span> <span class="s">&quot;SUSPEND ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x21</span><span class="p">,</span> <span class="s">&quot;SUSPEND REJECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x20</span><span class="p">,</span> <span class="s">&quot;USER INFORMATION&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x45</span><span class="p">,</span> <span class="s">&quot;DISCONNECT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x4d</span><span class="p">,</span> <span class="s">&quot;RELEASE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x5a</span><span class="p">,</span> <span class="s">&quot;RELEASE COMPLETE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x46</span><span class="p">,</span> <span class="s">&quot;RESTART&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x4e</span><span class="p">,</span> <span class="s">&quot;RESTART ACKNOWLEDGE&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="s">&quot;SEGMENT&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x79</span><span class="p">,</span> <span class="s">&quot;CONGESTION CONTROL&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7b</span><span class="p">,</span> <span class="s">&quot;INFORMATION&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x62</span><span class="p">,</span> <span class="s">&quot;FACILITY&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x6e</span><span class="p">,</span> <span class="s">&quot;NOTIFY&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7d</span><span class="p">,</span> <span class="s">&quot;STATUS&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x75</span><span class="p">,</span> <span class="s">&quot;STATUS ENQUIRY&quot;</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define MTSIZE ARRAY_SIZE(mtlist)</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">MessageType</span> <span class="n">mt_n0</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="n">MT_N0_REG_IND</span><span class="p">,</span> <span class="s">&quot;REGister INDication&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_CANC_IND</span><span class="p">,</span> <span class="s">&quot;CANCel INDication&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_FAC_STA</span><span class="p">,</span> <span class="s">&quot;FACility STAtus&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_STA_ACK</span><span class="p">,</span> <span class="s">&quot;STAtus ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_STA_REJ</span><span class="p">,</span> <span class="s">&quot;STAtus REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_FAC_INF</span><span class="p">,</span> <span class="s">&quot;FACility INFormation&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_INF_ACK</span><span class="p">,</span> <span class="s">&quot;INFormation ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_INF_REJ</span><span class="p">,</span> <span class="s">&quot;INFormation REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_CLOSE</span><span class="p">,</span> <span class="s">&quot;CLOSE&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N0_CLO_ACK</span><span class="p">,</span> <span class="s">&quot;CLOse ACKnowledge&quot;</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define MT_N0_LEN ARRAY_SIZE(mt_n0)</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">MessageType</span> <span class="n">mt_n1</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="n">MT_N1_ESC</span><span class="p">,</span> <span class="s">&quot;ESCape&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_ALERT</span><span class="p">,</span> <span class="s">&quot;ALERT&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CALL_SENT</span><span class="p">,</span> <span class="s">&quot;CALL SENT&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CONN</span><span class="p">,</span> <span class="s">&quot;CONNect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CONN_ACK</span><span class="p">,</span> <span class="s">&quot;CONNect ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_SETUP</span><span class="p">,</span> <span class="s">&quot;SETUP&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_SETUP_ACK</span><span class="p">,</span> <span class="s">&quot;SETUP ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_RES</span><span class="p">,</span> <span class="s">&quot;RESume&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_RES_ACK</span><span class="p">,</span> <span class="s">&quot;RESume ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_RES_REJ</span><span class="p">,</span> <span class="s">&quot;RESume REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_SUSP</span><span class="p">,</span> <span class="s">&quot;SUSPend&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_SUSP_ACK</span><span class="p">,</span> <span class="s">&quot;SUSPend ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_SUSP_REJ</span><span class="p">,</span> <span class="s">&quot;SUSPend REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_USER_INFO</span><span class="p">,</span> <span class="s">&quot;USER INFO&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_DET</span><span class="p">,</span> <span class="s">&quot;DETach&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_DISC</span><span class="p">,</span> <span class="s">&quot;DISConnect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_REL</span><span class="p">,</span> <span class="s">&quot;RELease&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_REL_ACK</span><span class="p">,</span> <span class="s">&quot;RELease ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CANC_ACK</span><span class="p">,</span> <span class="s">&quot;CANCel ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CANC_REJ</span><span class="p">,</span> <span class="s">&quot;CANCel REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_CON_CON</span><span class="p">,</span> <span class="s">&quot;CONgestion CONtrol&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_FAC</span><span class="p">,</span> <span class="s">&quot;FACility&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_FAC_ACK</span><span class="p">,</span> <span class="s">&quot;FACility ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_FAC_CAN</span><span class="p">,</span> <span class="s">&quot;FACility CANcel&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_FAC_REG</span><span class="p">,</span> <span class="s">&quot;FACility REGister&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_FAC_REJ</span><span class="p">,</span> <span class="s">&quot;FACility REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_INFO</span><span class="p">,</span> <span class="s">&quot;INFOrmation&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_REG_ACK</span><span class="p">,</span> <span class="s">&quot;REGister ACKnowledge&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_REG_REJ</span><span class="p">,</span> <span class="s">&quot;REGister REJect&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">MT_N1_STAT</span><span class="p">,</span> <span class="s">&quot;STATus&quot;</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define MT_N1_LEN ARRAY_SIZE(mt_n1)</span>


<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prbits</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

	<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">start</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
			<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;1&#39;</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
		<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="n">u_char</span> <span class="o">*</span>
<span class="nf">skipext</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">));</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Cause Values According to Q.850</span>
<span class="cm"> * edescr: English description</span>
<span class="cm"> * ddescr: German description used by Swissnet II (Swiss Telecom</span>
<span class="cm"> *         not yet written...</span>
<span class="cm"> */</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">CauseValue</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">nr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">edescr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">ddescr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cvlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="p">{</span>
		<span class="mh">0x01</span><span class="p">,</span> <span class="s">&quot;Unallocated (unassigned) number&quot;</span><span class="p">,</span> <span class="s">&quot;Nummer nicht zugeteilt&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x02</span><span class="p">,</span> <span class="s">&quot;No route to specified transit network&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x03</span><span class="p">,</span> <span class="s">&quot;No route to destination&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x04</span><span class="p">,</span> <span class="s">&quot;Send special information tone&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x05</span><span class="p">,</span> <span class="s">&quot;Misdialled trunk prefix&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x06</span><span class="p">,</span> <span class="s">&quot;Channel unacceptable&quot;</span><span class="p">,</span> <span class="s">&quot;Kanal nicht akzeptierbar&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x07</span><span class="p">,</span> <span class="s">&quot;Channel awarded and being delivered in an established channel&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x08</span><span class="p">,</span> <span class="s">&quot;Preemption&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x09</span><span class="p">,</span> <span class="s">&quot;Preemption - circuit reserved for reuse&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x10</span><span class="p">,</span> <span class="s">&quot;Normal call clearing&quot;</span><span class="p">,</span> <span class="s">&quot;Normale Ausloesung&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x11</span><span class="p">,</span> <span class="s">&quot;User busy&quot;</span><span class="p">,</span> <span class="s">&quot;TNB besetzt&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x12</span><span class="p">,</span> <span class="s">&quot;No user responding&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x13</span><span class="p">,</span> <span class="s">&quot;No answer from user (user alerted)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x14</span><span class="p">,</span> <span class="s">&quot;Subscriber absent&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x15</span><span class="p">,</span> <span class="s">&quot;Call rejected&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x16</span><span class="p">,</span> <span class="s">&quot;Number changed&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1a</span><span class="p">,</span> <span class="s">&quot;non-selected user clearing&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1b</span><span class="p">,</span> <span class="s">&quot;Destination out of order&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1c</span><span class="p">,</span> <span class="s">&quot;Invalid number format (address incomplete)&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1d</span><span class="p">,</span> <span class="s">&quot;Facility rejected&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1e</span><span class="p">,</span> <span class="s">&quot;Response to Status enquiry&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1f</span><span class="p">,</span> <span class="s">&quot;Normal, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x22</span><span class="p">,</span> <span class="s">&quot;No circuit/channel available&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x26</span><span class="p">,</span> <span class="s">&quot;Network out of order&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x27</span><span class="p">,</span> <span class="s">&quot;Permanent frame mode connection out-of-service&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x28</span><span class="p">,</span> <span class="s">&quot;Permanent frame mode connection operational&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x29</span><span class="p">,</span> <span class="s">&quot;Temporary failure&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2a</span><span class="p">,</span> <span class="s">&quot;Switching equipment congestion&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2b</span><span class="p">,</span> <span class="s">&quot;Access information discarded&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2c</span><span class="p">,</span> <span class="s">&quot;Requested circuit/channel not available&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2e</span><span class="p">,</span> <span class="s">&quot;Precedence call blocked&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2f</span><span class="p">,</span> <span class="s">&quot;Resource unavailable, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x31</span><span class="p">,</span> <span class="s">&quot;Quality of service unavailable&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x32</span><span class="p">,</span> <span class="s">&quot;Requested facility not subscribed&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x35</span><span class="p">,</span> <span class="s">&quot;Outgoing calls barred within CUG&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x37</span><span class="p">,</span> <span class="s">&quot;Incoming calls barred within CUG&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x39</span><span class="p">,</span> <span class="s">&quot;Bearer capability not authorized&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x3a</span><span class="p">,</span> <span class="s">&quot;Bearer capability not presently available&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x3e</span><span class="p">,</span> <span class="s">&quot;Inconsistency in designated outgoing access information and subscriber class &quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x3f</span><span class="p">,</span> <span class="s">&quot;Service or option not available, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x41</span><span class="p">,</span> <span class="s">&quot;Bearer capability not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x42</span><span class="p">,</span> <span class="s">&quot;Channel type not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x43</span><span class="p">,</span> <span class="s">&quot;Requested facility not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x44</span><span class="p">,</span> <span class="s">&quot;Only restricted digital information bearer capability is available&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x4f</span><span class="p">,</span> <span class="s">&quot;Service or option not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x51</span><span class="p">,</span> <span class="s">&quot;Invalid call reference value&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x52</span><span class="p">,</span> <span class="s">&quot;Identified channel does not exist&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x53</span><span class="p">,</span> <span class="s">&quot;A suspended call exists, but this call identity does not&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x54</span><span class="p">,</span> <span class="s">&quot;Call identity in use&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x55</span><span class="p">,</span> <span class="s">&quot;No call suspended&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x56</span><span class="p">,</span> <span class="s">&quot;Call having the requested call identity has been cleared&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x57</span><span class="p">,</span> <span class="s">&quot;User not member of CUG&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x58</span><span class="p">,</span> <span class="s">&quot;Incompatible destination&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x5a</span><span class="p">,</span> <span class="s">&quot;Non-existent CUG&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x5b</span><span class="p">,</span> <span class="s">&quot;Invalid transit network selection&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x5f</span><span class="p">,</span> <span class="s">&quot;Invalid message, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x60</span><span class="p">,</span> <span class="s">&quot;Mandatory information element is missing&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x61</span><span class="p">,</span> <span class="s">&quot;Message type non-existent or not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x62</span><span class="p">,</span> <span class="s">&quot;Message not compatible with call state or message type non-existent or not implemented &quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x63</span><span class="p">,</span> <span class="s">&quot;Information element/parameter non-existent or not implemented&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x64</span><span class="p">,</span> <span class="s">&quot;Invalid information element contents&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x65</span><span class="p">,</span> <span class="s">&quot;Message not compatible with call state&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x66</span><span class="p">,</span> <span class="s">&quot;Recovery on timer expiry&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x67</span><span class="p">,</span> <span class="s">&quot;Parameter non-existent or not implemented - passed on&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x6e</span><span class="p">,</span> <span class="s">&quot;Message with unrecognized parameter discarded&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x6f</span><span class="p">,</span> <span class="s">&quot;Protocol error, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7f</span><span class="p">,</span> <span class="s">&quot;Interworking, unspecified&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define CVSIZE ARRAY_SIZE(cvlist)</span>

<span class="k">static</span>
<span class="kt">int</span>
<span class="nf">prcause</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u_char</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">cause</span><span class="p">;</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    coding &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; location &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">skipext</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">cause</span> <span class="o">=</span> <span class="mh">0x7f</span> <span class="o">&amp;</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>

	<span class="cm">/* locate cause value */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CVSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cvlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">cause</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

	<span class="cm">/* display cause value if it exists */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">CVSIZE</span><span class="p">)</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Unknown cause type %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cause</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  cause value %x : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">cvlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">edescr</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="n">end</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    diag attribute %d &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; rej %d &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; av %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="o">*++</span><span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">MessageType</span> <span class="n">cause_1tr6</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="n">CAUSE_InvCRef</span><span class="p">,</span> <span class="s">&quot;Invalid Call Reference&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_BearerNotImpl</span><span class="p">,</span> <span class="s">&quot;Bearer Service Not Implemented&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_CIDunknown</span><span class="p">,</span> <span class="s">&quot;Caller Identity unknown&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_CIDinUse</span><span class="p">,</span> <span class="s">&quot;Caller Identity in Use&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NoChans</span><span class="p">,</span> <span class="s">&quot;No Channels available&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_FacNotImpl</span><span class="p">,</span> <span class="s">&quot;Facility Not Implemented&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_FacNotSubscr</span><span class="p">,</span> <span class="s">&quot;Facility Not Subscribed&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_OutgoingBarred</span><span class="p">,</span> <span class="s">&quot;Outgoing calls barred&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_UserAccessBusy</span><span class="p">,</span> <span class="s">&quot;User Access Busy&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NegativeGBG</span><span class="p">,</span> <span class="s">&quot;Negative GBG&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_UnknownGBG</span><span class="p">,</span> <span class="s">&quot;Unknown  GBG&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NoSPVknown</span><span class="p">,</span> <span class="s">&quot;No SPV known&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_DestNotObtain</span><span class="p">,</span> <span class="s">&quot;Destination not obtainable&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NumberChanged</span><span class="p">,</span> <span class="s">&quot;Number changed&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_OutOfOrder</span><span class="p">,</span> <span class="s">&quot;Out Of Order&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NoUserResponse</span><span class="p">,</span> <span class="s">&quot;No User Response&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_UserBusy</span><span class="p">,</span> <span class="s">&quot;User Busy&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_IncomingBarred</span><span class="p">,</span> <span class="s">&quot;Incoming Barred&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_CallRejected</span><span class="p">,</span> <span class="s">&quot;Call Rejected&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_NetworkCongestion</span><span class="p">,</span> <span class="s">&quot;Network Congestion&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_RemoteUser</span><span class="p">,</span> <span class="s">&quot;Remote User initiated&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_LocalProcErr</span><span class="p">,</span> <span class="s">&quot;Local Procedure Error&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_RemoteProcErr</span><span class="p">,</span> <span class="s">&quot;Remote Procedure Error&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_RemoteUserSuspend</span><span class="p">,</span> <span class="s">&quot;Remote User Suspend&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_RemoteUserResumed</span><span class="p">,</span> <span class="s">&quot;Remote User Resumed&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="n">CAUSE_UserInfoDiscarded</span><span class="p">,</span> <span class="s">&quot;User Info Discarded&quot;</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">cause_1tr6_len</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cause_1tr6</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prcause_1tr6</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">cause</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;   OK (cause length=0)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    coding &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; location &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">cause</span> <span class="o">=</span> <span class="mh">0x7f</span> <span class="o">&amp;</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="cm">/* locate cause value */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cause_1tr6_len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cause_1tr6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">cause</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

	<span class="cm">/* display cause value if it exists */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">cause_1tr6_len</span><span class="p">)</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Unknown cause type %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cause</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  cause value %x : %s </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cause</span><span class="p">,</span> <span class="n">cause_1tr6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prchident</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3 &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prcalled</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3 &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    number digits &quot;</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prcalling</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3 &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3a &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*++</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
		<span class="n">l</span><span class="o">--</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="n">p</span><span class="o">++</span><span class="p">;</span>

	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    number digits &quot;</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="kt">int</span>
<span class="nf">prbearer</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">,</span> <span class="n">ch</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3  &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 4  &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x18</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 4.1 &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* check for user information layer 1 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 5%c &quot;</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
			<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
				<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">ch</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="cm">/* check for user information layer 2 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 6  &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* check for user information layer 3 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 7  &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span>
<span class="kt">int</span>
<span class="nf">prbearer_ni1</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="n">u_char</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">len</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3  &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x80</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Speech&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x88</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Unrestricted digital information&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x90</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; 3.1 kHz audio&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Unknown information-transfer capability&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 4  &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x90</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; 64 kbps, circuit mode&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xc0</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Packet mode&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Unknown transfer mode&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 5  &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x21</span>:
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Rate adaption</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 5a &quot;</span><span class="p">);</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0xa2</span>:
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; u-law&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot; Unknown UI layer 1 protocol&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">general</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">octet</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="cm">/* Iterate over all octets in the information element */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet %d%c &quot;</span><span class="p">,</span> <span class="n">octet</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

		<span class="cm">/* last octet in group? */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">octet</span><span class="o">++</span><span class="p">;</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">ch</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">general_ni1</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">octet</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="cm">/* Iterate over all octets in the information element */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet %d%c &quot;</span><span class="p">,</span> <span class="n">octet</span><span class="p">,</span> <span class="n">ch</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>

		<span class="cm">/* last octet in group? */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">octet</span><span class="o">++</span><span class="p">;</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">ch</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prcharge</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    GEA &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Anzahl: &quot;</span><span class="p">);</span>
	<span class="cm">/* Iterate over all octets in the * information element */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prtext</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    &quot;</span><span class="p">);</span>
	<span class="cm">/* Iterate over all octets in the * information element */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prfeatureind</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* skip id, len */</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3  &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mi">80</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 4  &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    Status:  &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Idle&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Active&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Prompt&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Pending&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;(Reserved)&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">DTag</span> <span class="p">{</span> <span class="cm">/* Display tags */</span>
	<span class="n">u_char</span> <span class="n">nr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dtaglist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x82</span><span class="p">,</span> <span class="s">&quot;Continuation&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x83</span><span class="p">,</span> <span class="s">&quot;Called address&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x84</span><span class="p">,</span> <span class="s">&quot;Cause&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x85</span><span class="p">,</span> <span class="s">&quot;Progress indicator&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x86</span><span class="p">,</span> <span class="s">&quot;Notification indicator&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x87</span><span class="p">,</span> <span class="s">&quot;Prompt&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x88</span><span class="p">,</span> <span class="s">&quot;Accumlated digits&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x89</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="s">&quot;Inband&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="s">&quot;Calling address&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="s">&quot;Reason&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="s">&quot;Calling party name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="s">&quot;Called party name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="s">&quot;Orignal called name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x90</span><span class="p">,</span> <span class="s">&quot;Redirecting name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x91</span><span class="p">,</span> <span class="s">&quot;Connected name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x92</span><span class="p">,</span> <span class="s">&quot;Originating restrictions&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x93</span><span class="p">,</span> <span class="s">&quot;Date &amp; time of day&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x94</span><span class="p">,</span> <span class="s">&quot;Call Appearance ID&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x95</span><span class="p">,</span> <span class="s">&quot;Feature address&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x96</span><span class="p">,</span> <span class="s">&quot;Redirection name&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="s">&quot;Text&quot;</span> <span class="p">},</span>
<span class="p">};</span>
<span class="cp">#define DTAGSIZE ARRAY_SIZE(dtaglist)</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">disptext_ni1</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">!=</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    Unknown display type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* Iterate over all tag,length,text fields */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
		<span class="n">l</span> <span class="o">-=</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="cm">/* Don&#39;t space or skip */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">tag</span> <span class="o">==</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="mh">0x81</span><span class="p">))</span> <span class="n">p</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DTAGSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tag</span> <span class="o">==</span> <span class="n">dtaglist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>

			<span class="cm">/* When not found, give appropriate msg */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">DTAGSIZE</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    %s: &quot;</span><span class="p">,</span> <span class="n">dtaglist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
				<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span><span class="p">)</span>
					<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    (unknown display tag %2x): &quot;</span><span class="p">,</span> <span class="n">tag</span><span class="p">);</span>
				<span class="k">while</span> <span class="p">(</span><span class="n">len</span><span class="o">--</span><span class="p">)</span>
					<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">display</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">octet</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="cm">/* Iterate over all octets in the * display-information element */</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;   </span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">l</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>

		<span class="cm">/* last octet in group? */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">octet</span><span class="o">++</span><span class="p">;</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ch</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="sc">&#39;a&#39;</span><span class="p">;</span>

		<span class="k">else</span>
			<span class="n">ch</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\&quot;&#39;</span><span class="p">;</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">prfacility</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">l2</span><span class="p">;</span>

	<span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">l</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;    octet 3 &quot;</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">l</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;   octet 4 &quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">prbits</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;   octet 5 %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
		<span class="n">l</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;   contents &quot;</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">l2</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;%2x &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
			<span class="n">l</span><span class="o">--</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">dp</span> <span class="o">-</span> <span class="n">dest</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">InformationElement</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">nr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">f</span><span class="p">)</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">);</span>
<span class="p">}</span> <span class="n">ielist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="p">{</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="s">&quot;Segmented message&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x04</span><span class="p">,</span> <span class="s">&quot;Bearer capability&quot;</span><span class="p">,</span> <span class="n">prbearer</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x08</span><span class="p">,</span> <span class="s">&quot;Cause&quot;</span><span class="p">,</span> <span class="n">prcause</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x10</span><span class="p">,</span> <span class="s">&quot;Call identity&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x14</span><span class="p">,</span> <span class="s">&quot;Call state&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x18</span><span class="p">,</span> <span class="s">&quot;Channel identification&quot;</span><span class="p">,</span> <span class="n">prchident</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1c</span><span class="p">,</span> <span class="s">&quot;Facility&quot;</span><span class="p">,</span> <span class="n">prfacility</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x1e</span><span class="p">,</span> <span class="s">&quot;Progress indicator&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x20</span><span class="p">,</span> <span class="s">&quot;Network-specific facilities&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x27</span><span class="p">,</span> <span class="s">&quot;Notification indicator&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x28</span><span class="p">,</span> <span class="s">&quot;Display&quot;</span><span class="p">,</span> <span class="n">display</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x29</span><span class="p">,</span> <span class="s">&quot;Date/Time&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x2c</span><span class="p">,</span> <span class="s">&quot;Keypad facility&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x34</span><span class="p">,</span> <span class="s">&quot;Signal&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x40</span><span class="p">,</span> <span class="s">&quot;Information rate&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x42</span><span class="p">,</span> <span class="s">&quot;End-to-end delay&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x43</span><span class="p">,</span> <span class="s">&quot;Transit delay selection and indication&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x44</span><span class="p">,</span> <span class="s">&quot;Packet layer binary parameters&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x45</span><span class="p">,</span> <span class="s">&quot;Packet layer window size&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x46</span><span class="p">,</span> <span class="s">&quot;Packet size&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x47</span><span class="p">,</span> <span class="s">&quot;Closed user group&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x4a</span><span class="p">,</span> <span class="s">&quot;Reverse charge indication&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x6c</span><span class="p">,</span> <span class="s">&quot;Calling party number&quot;</span><span class="p">,</span> <span class="n">prcalling</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x6d</span><span class="p">,</span> <span class="s">&quot;Calling party subaddress&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x70</span><span class="p">,</span> <span class="s">&quot;Called party number&quot;</span><span class="p">,</span> <span class="n">prcalled</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x71</span><span class="p">,</span> <span class="s">&quot;Called party subaddress&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x74</span><span class="p">,</span> <span class="s">&quot;Redirecting number&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x78</span><span class="p">,</span> <span class="s">&quot;Transit network selection&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x79</span><span class="p">,</span> <span class="s">&quot;Restart indicator&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7c</span><span class="p">,</span> <span class="s">&quot;Low layer compatibility&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7d</span><span class="p">,</span> <span class="s">&quot;High layer compatibility&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7e</span><span class="p">,</span> <span class="s">&quot;User-user&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="mh">0x7f</span><span class="p">,</span> <span class="s">&quot;Escape for extension&quot;</span><span class="p">,</span> <span class="n">general</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="cp">#define IESIZE ARRAY_SIZE(ielist)</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">InformationElement</span> <span class="n">ielist_ni1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x04</span><span class="p">,</span> <span class="s">&quot;Bearer Capability&quot;</span><span class="p">,</span> <span class="n">prbearer_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x08</span><span class="p">,</span> <span class="s">&quot;Cause&quot;</span><span class="p">,</span> <span class="n">prcause</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="s">&quot;Call State&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="s">&quot;Channel Identification&quot;</span><span class="p">,</span> <span class="n">prchident</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="s">&quot;Progress Indicator&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="s">&quot;Notification Indicator&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="s">&quot;Keypad Facility&quot;</span><span class="p">,</span> <span class="n">prtext</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x32</span><span class="p">,</span> <span class="s">&quot;Information Request&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="s">&quot;Signal&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="s">&quot;Feature Activation&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x39</span><span class="p">,</span> <span class="s">&quot;Feature Indication&quot;</span><span class="p">,</span> <span class="n">prfeatureind</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="s">&quot;Service Profile Identification (SPID)&quot;</span><span class="p">,</span> <span class="n">prtext</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="s">&quot;Endpoint Identifier&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="s">&quot;Calling Party Number&quot;</span><span class="p">,</span> <span class="n">prcalling</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="s">&quot;Calling Party Subaddress&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x70</span><span class="p">,</span> <span class="s">&quot;Called Party Number&quot;</span><span class="p">,</span> <span class="n">prcalled</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span> <span class="s">&quot;Called Party Subaddress&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x74</span><span class="p">,</span> <span class="s">&quot;Redirecting Number&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x78</span><span class="p">,</span> <span class="s">&quot;Transit Network Selection&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="s">&quot;Low Layer Compatibility&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="s">&quot;High Layer Compatibility&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
<span class="p">};</span>


<span class="cp">#define IESIZE_NI1 ARRAY_SIZE(ielist_ni1)</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">InformationElement</span> <span class="n">ielist_ni1_cs5</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="s">&quot;Operator system access&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="s">&quot;Display text&quot;</span><span class="p">,</span> <span class="n">disptext_ni1</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define IESIZE_NI1_CS5 ARRAY_SIZE(ielist_ni1_cs5)</span>

<span class="k">static</span>
<span class="k">struct</span> <span class="n">InformationElement</span> <span class="n">ielist_ni1_cs6</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="s">&quot;Call appearance&quot;</span><span class="p">,</span> <span class="n">general_ni1</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define IESIZE_NI1_CS6 ARRAY_SIZE(ielist_ni1_cs6)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">InformationElement</span> <span class="n">we_0</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="n">WE0_cause</span><span class="p">,</span> <span class="s">&quot;Cause&quot;</span><span class="p">,</span> <span class="n">prcause_1tr6</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_connAddr</span><span class="p">,</span> <span class="s">&quot;Connecting Address&quot;</span><span class="p">,</span> <span class="n">prcalled</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_callID</span><span class="p">,</span> <span class="s">&quot;Call IDentity&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_chanID</span><span class="p">,</span> <span class="s">&quot;Channel IDentity&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_netSpecFac</span><span class="p">,</span> <span class="s">&quot;Network Specific Facility&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_display</span><span class="p">,</span> <span class="s">&quot;Display&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_keypad</span><span class="p">,</span> <span class="s">&quot;Keypad&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_origAddr</span><span class="p">,</span> <span class="s">&quot;Origination Address&quot;</span><span class="p">,</span> <span class="n">prcalled</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_destAddr</span><span class="p">,</span> <span class="s">&quot;Destination Address&quot;</span><span class="p">,</span> <span class="n">prcalled</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE0_userInfo</span><span class="p">,</span> <span class="s">&quot;User Info&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define WE_0_LEN ARRAY_SIZE(we_0)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">InformationElement</span> <span class="n">we_6</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span><span class="n">WE6_serviceInd</span><span class="p">,</span> <span class="s">&quot;Service Indicator&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_chargingInfo</span><span class="p">,</span> <span class="s">&quot;Charging Information&quot;</span><span class="p">,</span> <span class="n">prcharge</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_date</span><span class="p">,</span> <span class="s">&quot;Date&quot;</span><span class="p">,</span> <span class="n">prtext</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_facSelect</span><span class="p">,</span> <span class="s">&quot;Facility Select&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_facStatus</span><span class="p">,</span> <span class="s">&quot;Facility Status&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_statusCalled</span><span class="p">,</span> <span class="s">&quot;Status Called&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">},</span>
	<span class="p">{</span><span class="n">WE6_addTransAttr</span><span class="p">,</span> <span class="s">&quot;Additional Transmission Attributes&quot;</span><span class="p">,</span> <span class="n">general</span><span class="p">}</span>
<span class="p">};</span>
<span class="cp">#define WE_6_LEN ARRAY_SIZE(we_6)</span>

<span class="kt">int</span>
<span class="nf">QuickHex</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">txt</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">register</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">register</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t</span> <span class="o">=</span> <span class="n">txt</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="n">hex_asc_hi</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="n">hex_asc_lo</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">t</span><span class="o">++</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">txt</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">LogFrame</span><span class="p">(</span><span class="k">struct</span> <span class="n">IsdnCardState</span> <span class="o">*</span><span class="n">cs</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">=</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">dlog</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&lt;</span> <span class="n">MAX_DLOG_SPACE</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;H&#39;</span><span class="p">;</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;E&#39;</span><span class="p">;</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;X&#39;</span><span class="p">;</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;:&#39;</span><span class="p">;</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">QuickHex</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
		<span class="n">dp</span><span class="o">--</span><span class="p">;</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
		<span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">HiSax_putstatus</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">dlog</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">HiSax_putstatus</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="s">&quot;LogFrame: &quot;</span><span class="p">,</span> <span class="s">&quot;warning Frame too big (%d)&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">dlogframe</span><span class="p">(</span><span class="k">struct</span> <span class="n">IsdnCardState</span> <span class="o">*</span><span class="n">cs</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u_char</span> <span class="o">*</span><span class="n">bend</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pd</span><span class="p">,</span> <span class="n">cr_l</span><span class="p">,</span> <span class="n">cr</span><span class="p">,</span> <span class="n">mt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sapi</span><span class="p">,</span> <span class="n">tei</span><span class="p">,</span> <span class="n">ftyp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">cset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cs_old</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cs_fest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">finish</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="cm">/* display header */</span>
	<span class="n">dp</span> <span class="o">=</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">dlog</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">jiftime</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">jiffies</span><span class="p">);</span>
	<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="n">sapi</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tei</span>  <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ftyp</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
	<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;frame %s &quot;</span><span class="p">,</span> <span class="n">dir</span> <span class="o">?</span> <span class="s">&quot;network-&gt;user&quot;</span> <span class="o">:</span> <span class="s">&quot;user-&gt;network&quot;</span><span class="p">);</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tei</span> <span class="o">==</span> <span class="n">GROUP_TEI</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sapi</span> <span class="o">==</span> <span class="n">CTRL_SAPI</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* sapi 0 */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ftyp</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;broadcast</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">buf</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
				<span class="n">size</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;no UI broadcast</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sapi</span> <span class="o">==</span> <span class="n">TEI_SAPI</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;tei management</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;unknown sapi %d broadcast</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sapi</span><span class="p">);</span>
			<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sapi</span> <span class="o">==</span> <span class="n">CTRL_SAPI</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ftyp</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* IFrame */</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;with tei %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tei</span><span class="p">);</span>
				<span class="n">buf</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
				<span class="n">size</span> <span class="o">-=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;SFrame with tei %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tei</span><span class="p">);</span>
				<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;unknown sapi %d tei %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sapi</span><span class="p">,</span> <span class="n">tei</span><span class="p">);</span>
			<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">bend</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">&gt;=</span> <span class="n">bend</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;frame too short</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">finish</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">finish</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">HiSax_putstatus</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">dlog</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="mh">0xfe</span> <span class="o">&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">PROTO_DIS_N0</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* 1TR6 */</span>
		<span class="cm">/* locate message type */</span>
		<span class="n">pd</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="n">cr_l</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cr_l</span><span class="p">)</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">mt</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">==</span> <span class="n">PROTO_DIS_N0</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* N0 */</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MT_N0_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">mt_n0</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">mt</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="cm">/* display message type if it exists */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">MT_N0_LEN</span><span class="p">)</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d unknown message type N0 %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
					      <span class="n">size</span><span class="p">,</span> <span class="n">mt</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d message type %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
					      <span class="n">size</span><span class="p">,</span> <span class="n">mt_n0</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="cm">/* N1 */</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MT_N1_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">mt_n1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">mt</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="cm">/* display message type if it exists */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">MT_N1_LEN</span><span class="p">)</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d unknown message type N1 %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
					      <span class="n">size</span><span class="p">,</span> <span class="n">mt</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d message type %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
					      <span class="n">size</span><span class="p">,</span> <span class="n">mt_n1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/* display each information element */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">buf</span> <span class="o">&lt;</span> <span class="n">bend</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Is it a single octet information element? */</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">switch</span> <span class="p">((</span><span class="o">*</span><span class="n">buf</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mi">1</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Shift %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="n">cs_old</span> <span class="o">=</span> <span class="n">cset</span><span class="p">;</span>
					<span class="n">cset</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">;</span>
					<span class="n">cs_fest</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">3</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Congestion level %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">2</span>:
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="mh">0xa0</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  More data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="mh">0xa1</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Sending complete</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">break</span><span class="p">;</span>
					<span class="cm">/* fall through */</span>
				<span class="nl">default:</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Reserved %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">buf</span><span class="o">++</span><span class="p">;</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* No, locate it in the table */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">WE_0_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">we_0</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
						<span class="k">break</span><span class="p">;</span>

				<span class="cm">/* When found, give appropriate msg */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">WE_0_LEN</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">we_0</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">we_0</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Codeset %d attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cset</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cset</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">WE_6_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">we_6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
						<span class="k">break</span><span class="p">;</span>

				<span class="cm">/* When found, give appropriate msg */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">WE_6_LEN</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">we_6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">we_6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Codeset %d attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cset</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Unknown Codeset %d attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cset</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="cm">/* Skip to next element */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cs_fest</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">cset</span> <span class="o">=</span> <span class="n">cs_old</span><span class="p">;</span>
				<span class="n">cs_old</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">cs_fest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cs</span><span class="o">-&gt;</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">ISDN_PTYPE_NI1</span><span class="p">))</span> <span class="p">{</span>	<span class="cm">/* NI-1 */</span>
		<span class="cm">/* locate message type */</span>
		<span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="n">cr_l</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cr_l</span><span class="p">)</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">mt</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MTSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mtlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">mt</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* display message type if it exists */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">MTSIZE</span><span class="p">)</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d unknown message type %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
				      <span class="n">size</span><span class="p">,</span> <span class="n">mt</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d message type %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
				      <span class="n">size</span><span class="p">,</span> <span class="n">mtlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>

		<span class="cm">/* display each information element */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">buf</span> <span class="o">&lt;</span> <span class="n">bend</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Is it a single octet information element? */</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">switch</span> <span class="p">((</span><span class="o">*</span><span class="n">buf</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mi">1</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Shift %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="n">cs_old</span> <span class="o">=</span> <span class="n">cset</span><span class="p">;</span>
					<span class="n">cset</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">;</span>
					<span class="n">cs_fest</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="nl">default:</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Unknown single-octet IE %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">buf</span><span class="o">++</span><span class="p">;</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* No, locate it in the table */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IESIZE_NI1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">ielist_ni1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
						<span class="k">break</span><span class="p">;</span>

				<span class="cm">/* When not found, give appropriate msg */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">IESIZE_NI1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ielist_ni1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">ielist_ni1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cset</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IESIZE_NI1_CS5</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">ielist_ni1_cs5</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
						<span class="k">break</span><span class="p">;</span>

				<span class="cm">/* When not found, give appropriate msg */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">IESIZE_NI1_CS5</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ielist_ni1_cs5</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">ielist_ni1_cs5</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cset</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IESIZE_NI1_CS6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">ielist_ni1_cs6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
						<span class="k">break</span><span class="p">;</span>

				<span class="cm">/* When not found, give appropriate msg */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">IESIZE_NI1_CS6</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ielist_ni1_cs6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">ielist_ni1_cs6</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Unknown Codeset %d attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cset</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

			<span class="cm">/* Skip to next element */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cs_fest</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">cset</span> <span class="o">=</span> <span class="n">cs_old</span><span class="p">;</span>
				<span class="n">cs_old</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">cs_fest</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cs</span><span class="o">-&gt;</span><span class="n">protocol</span> <span class="o">==</span> <span class="n">ISDN_PTYPE_EURO</span><span class="p">))</span> <span class="p">{</span> <span class="cm">/* EURO */</span>
		<span class="cm">/* locate message type */</span>
		<span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="n">cr_l</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cr_l</span><span class="p">)</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">cr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">mt</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MTSIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mtlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span> <span class="o">==</span> <span class="n">mt</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* display message type if it exists */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">MTSIZE</span><span class="p">)</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d unknown message type %x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
				      <span class="n">size</span><span class="p">,</span> <span class="n">mt</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;callref %d %s size %d message type %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				      <span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="p">(</span><span class="n">cr</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;called&quot;</span> <span class="o">:</span> <span class="s">&quot;caller&quot;</span><span class="p">,</span>
				      <span class="n">size</span><span class="p">,</span> <span class="n">mtlist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>

		<span class="cm">/* display each information element */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">buf</span> <span class="o">&lt;</span> <span class="n">bend</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Is it a single octet information element? */</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">switch</span> <span class="p">((</span><span class="o">*</span><span class="n">buf</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mi">1</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Shift %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">3</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Congestion level %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">5</span>:
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Repeat indicator %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">2</span>:
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="mh">0xa0</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  More data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="mh">0xa1</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Sending complete</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="p">}</span>
					<span class="k">break</span><span class="p">;</span>
					<span class="cm">/* fall through */</span>
				<span class="nl">default:</span>
					<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  Reserved %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">buf</span><span class="o">++</span><span class="p">;</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* No, locate it in the table */</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IESIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="n">ielist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nr</span><span class="p">)</span>
					<span class="k">break</span><span class="p">;</span>

			<span class="cm">/* When not found, give appropriate msg */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="n">IESIZE</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ielist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">descr</span><span class="p">);</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">ielist</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">f</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;  attribute %x attribute size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

			<span class="cm">/* Skip to next element */</span>
			<span class="n">buf</span> <span class="o">+=</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dp</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="s">&quot;Unknown protocol %x!&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">HiSax_putstatus</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">dlog</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
