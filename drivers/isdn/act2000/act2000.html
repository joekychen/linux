<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › act2000 › act2000.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>act2000.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: act2000.h,v 1.8.6.3 2001/09/23 22:24:32 kai Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * ISDN lowlevel-module for the IBM ISDN-S0 Active 2000.</span>
<span class="cm"> *</span>
<span class="cm"> * Author       Fritz Elfert</span>
<span class="cm"> * Copyright    by Fritz Elfert      &lt;fritz@isdn4linux.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> * Thanks to Friedemann Baitinger and IBM Germany</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef act2000_h</span>
<span class="cp">#define act2000_h</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>

<span class="cp">#define ACT2000_IOCTL_SETPORT    1</span>
<span class="cp">#define ACT2000_IOCTL_GETPORT    2</span>
<span class="cp">#define ACT2000_IOCTL_SETIRQ     3</span>
<span class="cp">#define ACT2000_IOCTL_GETIRQ     4</span>
<span class="cp">#define ACT2000_IOCTL_SETBUS     5</span>
<span class="cp">#define ACT2000_IOCTL_GETBUS     6</span>
<span class="cp">#define ACT2000_IOCTL_SETPROTO   7</span>
<span class="cp">#define ACT2000_IOCTL_GETPROTO   8</span>
<span class="cp">#define ACT2000_IOCTL_SETMSN     9</span>
<span class="cp">#define ACT2000_IOCTL_GETMSN    10</span>
<span class="cp">#define ACT2000_IOCTL_LOADBOOT  11</span>
<span class="cp">#define ACT2000_IOCTL_ADDCARD   12</span>

<span class="cp">#define ACT2000_IOCTL_TEST      98</span>
<span class="cp">#define ACT2000_IOCTL_DEBUGVAR  99</span>

<span class="cp">#define ACT2000_BUS_ISA          1</span>
<span class="cp">#define ACT2000_BUS_MCA          2</span>
<span class="cp">#define ACT2000_BUS_PCMCIA       3</span>

<span class="cm">/* Struct for adding new cards */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">act2000_cdef</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">bus</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">id</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="p">}</span> <span class="n">act2000_cdef</span><span class="p">;</span>

<span class="cm">/* Struct for downloading firmware */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">act2000_ddef</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">length</span><span class="p">;</span>             <span class="cm">/* Length of code */</span>
	<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>    <span class="cm">/* Ptr. to code   */</span>
<span class="p">}</span> <span class="n">act2000_ddef</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">act2000_fwid</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">isdn</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">revlen</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">revision</span><span class="p">[</span><span class="mi">504</span><span class="p">];</span>
<span class="p">}</span> <span class="n">act2000_fwid</span><span class="p">;</span>

<span class="cp">#if defined(__KERNEL__) || defined(__DEBUGVAR__)</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cm">/* Kernel includes */</span>

<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/major.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/signal.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/mman.h&gt;</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/ctype.h&gt;</span>
<span class="cp">#include &lt;linux/isdnif.h&gt;</span>

<span class="cp">#endif                           </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#define ACT2000_PORTLEN        8</span>

<span class="cp">#define ACT2000_FLAGS_RUNNING  1 </span><span class="cm">/* Cards driver activated */</span><span class="cp"></span>
<span class="cp">#define ACT2000_FLAGS_PVALID   2 </span><span class="cm">/* Cards port is valid    */</span><span class="cp"></span>
<span class="cp">#define ACT2000_FLAGS_IVALID   4 </span><span class="cm">/* Cards irq is valid     */</span><span class="cp"></span>
<span class="cp">#define ACT2000_FLAGS_LOADED   8 </span><span class="cm">/* Firmware loaded        */</span><span class="cp"></span>

<span class="cp">#define ACT2000_BCH            2 </span><span class="cm">/* # of channels per card */</span><span class="cp"></span>

<span class="cm">/* D-Channel states */</span>
<span class="cp">#define ACT2000_STATE_NULL     0</span>
<span class="cp">#define ACT2000_STATE_ICALL    1</span>
<span class="cp">#define ACT2000_STATE_OCALL    2</span>
<span class="cp">#define ACT2000_STATE_IWAIT    3</span>
<span class="cp">#define ACT2000_STATE_OWAIT    4</span>
<span class="cp">#define ACT2000_STATE_IBWAIT   5</span>
<span class="cp">#define ACT2000_STATE_OBWAIT   6</span>
<span class="cp">#define ACT2000_STATE_BWAIT    7</span>
<span class="cp">#define ACT2000_STATE_BHWAIT   8</span>
<span class="cp">#define ACT2000_STATE_BHWAIT2  9</span>
<span class="cp">#define ACT2000_STATE_DHWAIT  10</span>
<span class="cp">#define ACT2000_STATE_DHWAIT2 11</span>
<span class="cp">#define ACT2000_STATE_BSETUP  12</span>
<span class="cp">#define ACT2000_STATE_ACTIVE  13</span>

<span class="cp">#define ACT2000_MAX_QUEUED  8000 </span><span class="cm">/* 2 * maxbuff */</span><span class="cp"></span>

<span class="cp">#define ACT2000_LOCK_TX 0</span>
<span class="cp">#define ACT2000_LOCK_RX 1</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">act2000_chan</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">callref</span><span class="p">;</span>          <span class="cm">/* Call Reference              */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">fsm_state</span><span class="p">;</span>        <span class="cm">/* Current D-Channel state     */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">eazmask</span><span class="p">;</span>          <span class="cm">/* EAZ-Mask for this Channel   */</span>
	<span class="kt">short</span> <span class="n">queued</span><span class="p">;</span>                    <span class="cm">/* User-Data Bytes in TX queue */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">plci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ncci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">l2prot</span><span class="p">;</span>           <span class="cm">/* Layer 2 protocol            */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">l3prot</span><span class="p">;</span>           <span class="cm">/* Layer 3 protocol            */</span>
<span class="p">}</span> <span class="n">act2000_chan</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">msn_entry</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">eaz</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">msn</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">msn_entry</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">}</span> <span class="n">msn_entry</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">irq_data_isa</span> <span class="p">{</span>
	<span class="n">__u8</span>           <span class="o">*</span><span class="n">rcvptr</span><span class="p">;</span>
	<span class="n">__u16</span>           <span class="n">rcvidx</span><span class="p">;</span>
	<span class="n">__u16</span>           <span class="n">rcvlen</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">rcvskb</span><span class="p">;</span>
	<span class="n">__u8</span>            <span class="n">rcvignore</span><span class="p">;</span>
	<span class="n">__u8</span>            <span class="n">rcvhdr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">irq_data_isa</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">act2000_irq_data</span> <span class="p">{</span>
	<span class="n">irq_data_isa</span> <span class="n">isa</span><span class="p">;</span>
<span class="p">}</span> <span class="n">act2000_irq_data</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Per card driver data</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">act2000_card</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="p">;</span>		<span class="cm">/* Base-port-address                */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">irq</span><span class="p">;</span>		<span class="cm">/* Interrupt                        */</span>
	<span class="n">u_char</span> <span class="n">ptype</span><span class="p">;</span>			<span class="cm">/* Protocol type (1TR6 or Euro)     */</span>
	<span class="n">u_char</span> <span class="n">bus</span><span class="p">;</span>			<span class="cm">/* Cardtype (ISA, MCA, PCMCIA)      */</span>
	<span class="k">struct</span> <span class="n">act2000_card</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>	<span class="cm">/* Pointer to next device struct    */</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>		<span class="cm">/* protect critical operations      */</span>
	<span class="kt">int</span> <span class="n">myid</span><span class="p">;</span>			<span class="cm">/* Driver-Nr. assigned by linklevel */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/* Statusflags                      */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ilock</span><span class="p">;</span>		<span class="cm">/* Semaphores for IRQ-Routines      */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">rcvq</span><span class="p">;</span>	<span class="cm">/* Receive-Message queue            */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">sndq</span><span class="p">;</span>	<span class="cm">/* Send-Message queue               */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">ackq</span><span class="p">;</span>	<span class="cm">/* Data-Ack-Message queue           */</span>
	<span class="n">u_char</span> <span class="o">*</span><span class="n">ack_msg</span><span class="p">;</span>		<span class="cm">/* Ptr to User Data in User skb     */</span>
	<span class="n">__u16</span> <span class="n">need_b3ack</span><span class="p">;</span>		<span class="cm">/* Flag: Need ACK for current skb   */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">sbuf</span><span class="p">;</span>		<span class="cm">/* skb which is currently sent      */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">ptimer</span><span class="p">;</span>	<span class="cm">/* Poll timer                       */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">snd_tq</span><span class="p">;</span>	<span class="cm">/* Task struct for xmit bh          */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">rcv_tq</span><span class="p">;</span>	<span class="cm">/* Task struct for rcv bh           */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">poll_tq</span><span class="p">;</span>	<span class="cm">/* Task struct for polled rcv bh    */</span>
	<span class="n">msn_entry</span> <span class="o">*</span><span class="n">msn_list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">msgnum</span><span class="p">;</span>		<span class="cm">/* Message number for sending       */</span>
	<span class="n">spinlock_t</span> <span class="n">mnlock</span><span class="p">;</span>		<span class="cm">/* lock for msgnum                  */</span>
	<span class="n">act2000_chan</span> <span class="n">bch</span><span class="p">[</span><span class="n">ACT2000_BCH</span><span class="p">];</span>	<span class="cm">/* B-Channel status/control         */</span>
	<span class="kt">char</span>   <span class="n">status_buf</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>		<span class="cm">/* Buffer for status messages       */</span>
	<span class="kt">char</span>   <span class="o">*</span><span class="n">status_buf_read</span><span class="p">;</span>
	<span class="kt">char</span>   <span class="o">*</span><span class="n">status_buf_write</span><span class="p">;</span>
	<span class="kt">char</span>   <span class="o">*</span><span class="n">status_buf_end</span><span class="p">;</span>
	<span class="n">act2000_irq_data</span> <span class="n">idat</span><span class="p">;</span>		<span class="cm">/* Data used for IRQ handler        */</span>
	<span class="n">isdn_if</span> <span class="n">interface</span><span class="p">;</span>		<span class="cm">/* Interface to upper layer         */</span>
	<span class="kt">char</span> <span class="n">regname</span><span class="p">[</span><span class="mi">35</span><span class="p">];</span>		<span class="cm">/* Name used for request_region     */</span>
<span class="p">}</span> <span class="n">act2000_card</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">act2000_schedule_tx</span><span class="p">(</span><span class="n">act2000_card</span> <span class="o">*</span><span class="n">card</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">schedule_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">snd_tq</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">act2000_schedule_rx</span><span class="p">(</span><span class="n">act2000_card</span> <span class="o">*</span><span class="n">card</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">schedule_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">rcv_tq</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">act2000_schedule_poll</span><span class="p">(</span><span class="n">act2000_card</span> <span class="o">*</span><span class="n">card</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">schedule_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">poll_tq</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">act2000_find_eaz</span><span class="p">(</span><span class="n">act2000_card</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span><span class="p">);</span>

<span class="cp">#endif                          </span><span class="cm">/* defined(__KERNEL__) || defined(__DEBUGVAR__) */</span><span class="cp"></span>
<span class="cp">#endif                          </span><span class="cm">/* act2000_h */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
