<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › hysdn › ince1pc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ince1pc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Linux driver for HYSDN cards</span>
<span class="cm"> * common definitions for both sides of the bus:</span>
<span class="cm"> * - conventions both spoolers must know</span>
<span class="cm"> * - channel numbers agreed upon</span>
<span class="cm"> *</span>
<span class="cm"> * Author    M. Steinkopf</span>
<span class="cm"> * Copyright 1999 by M. Steinkopf</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __INCE1PC_H__</span>
<span class="cp">#define __INCE1PC_H__</span>

<span class="cm">/*  basic scalar definitions have same meanning,</span>
<span class="cm"> *  but their declaration location depends on environment</span>
<span class="cm"> */</span>

<span class="cm">/*--------------------------------------channel numbers---------------------*/</span>
<span class="cp">#define CHAN_SYSTEM     0x0001      </span><span class="cm">/* system channel (spooler to spooler) */</span><span class="cp"></span>
<span class="cp">#define CHAN_ERRLOG     0x0005      </span><span class="cm">/* error logger */</span><span class="cp"></span>
<span class="cp">#define CHAN_CAPI       0x0064      </span><span class="cm">/* CAPI interface */</span><span class="cp"></span>
<span class="cp">#define CHAN_NDIS_DATA  0x1001      </span><span class="cm">/* NDIS data transfer */</span><span class="cp"></span>

<span class="cm">/*--------------------------------------POF ready msg-----------------------*/</span>
<span class="cm">/* NOTE: after booting POF sends system ready message to PC: */</span>
<span class="cp">#define RDY_MAGIC       0x52535953UL    </span><span class="cm">/* &#39;SYSR&#39; reversed */</span><span class="cp"></span>
<span class="cp">#define RDY_MAGIC_SIZE  4               </span><span class="cm">/* size in bytes */</span><span class="cp"></span>

<span class="cp">#define MAX_N_TOK_BYTES 255</span>

<span class="cp">#define MIN_RDY_MSG_SIZE    RDY_MAGIC_SIZE</span>
<span class="cp">#define MAX_RDY_MSG_SIZE    (RDY_MAGIC_SIZE + MAX_N_TOK_BYTES)</span>

<span class="cp">#define SYSR_TOK_END            0</span>
<span class="cp">#define SYSR_TOK_B_CHAN         1   </span><span class="cm">/* nr. of B-Channels;   DataLen=1; def: 2 */</span><span class="cp"></span>
<span class="cp">#define SYSR_TOK_FAX_CHAN       2   </span><span class="cm">/* nr. of FAX Channels; DataLen=1; def: 0 */</span><span class="cp"></span>
<span class="cp">#define SYSR_TOK_MAC_ADDR       3   </span><span class="cm">/* MAC-Address; DataLen=6; def: auto */</span><span class="cp"></span>
<span class="cp">#define SYSR_TOK_ESC            255 </span><span class="cm">/* undefined data size yet */</span><span class="cp"></span>
<span class="cm">/* default values, if not corrected by token: */</span>
<span class="cp">#define SYSR_TOK_B_CHAN_DEF     2   </span><span class="cm">/* assume 2 B-Channels */</span><span class="cp"></span>
<span class="cp">#define SYSR_TOK_FAX_CHAN_DEF   1   </span><span class="cm">/* assume 1 FAX Channel */</span><span class="cp"></span>

<span class="cm">/*  syntax of new SYSR token stream:</span>
<span class="cm"> *  channel: CHAN_SYSTEM</span>
<span class="cm"> *  msgsize: MIN_RDY_MSG_SIZE &lt;= x &lt;= MAX_RDY_MSG_SIZE</span>
<span class="cm"> *           RDY_MAGIC_SIZE   &lt;= x &lt;= (RDY_MAGIC_SIZE+MAX_N_TOK_BYTES)</span>
<span class="cm"> *  msg    : 0 1 2 3 {4 5 6 ..}</span>
<span class="cm"> *           S Y S R  MAX_N_TOK_BYTES bytes of TokenStream</span>
<span class="cm"> *</span>
<span class="cm"> *  TokenStream     :=   empty</span>
<span class="cm"> *                     | {NonEndTokenChunk} EndToken RotlCRC</span>
<span class="cm"> *  NonEndTokenChunk:= NonEndTokenId DataLen [Data]</span>
<span class="cm"> *  NonEndTokenId   := 0x01 .. 0xFE                 1 BYTE</span>
<span class="cm"> *  DataLen         := 0x00 .. 0xFF                 1 BYTE</span>
<span class="cm"> *  Data            := DataLen bytes</span>
<span class="cm"> *  EndToken        := 0x00</span>
<span class="cm"> *  RotlCRC         := special 1 byte CRC over all NonEndTokenChunk bytes</span>
<span class="cm"> *                     s. RotlCRC algorithm</span>
<span class="cm"> *</span>
<span class="cm"> *  RotlCRC algorithm:</span>
<span class="cm"> *      ucSum= 0                        1 unsigned char</span>
<span class="cm"> *      for all NonEndTokenChunk bytes:</span>
<span class="cm"> *          ROTL(ucSum,1)               rotate left by 1</span>
<span class="cm"> *          ucSum += Char;              add current byte with swap around</span>
<span class="cm"> *      RotlCRC= ~ucSum;                invert all bits for result</span>
<span class="cm"> *</span>
<span class="cm"> *  note:</span>
<span class="cm"> *  - for 16-bit FIFO add padding 0 byte to achieve even token data bytes!</span>
<span class="cm"> */</span>

<span class="cm">/*--------------------------------------error logger------------------------*/</span>
<span class="cm">/* note: pof needs final 0 ! */</span>
<span class="cp">#define ERRLOG_CMD_REQ          &quot;ERRLOG ON&quot;</span>
<span class="cp">#define ERRLOG_CMD_REQ_SIZE     10              </span><span class="cm">/* with final 0 byte ! */</span><span class="cp"></span>
<span class="cp">#define ERRLOG_CMD_STOP         &quot;ERRLOG OFF&quot;</span>
<span class="cp">#define ERRLOG_CMD_STOP_SIZE    11              </span><span class="cm">/* with final 0 byte ! */</span><span class="cp"></span>

<span class="cp">#define ERRLOG_ENTRY_SIZE       64      </span><span class="cm">/* sizeof(tErrLogEntry) */</span><span class="cp"></span>
					<span class="cm">/* remaining text size = 55 */</span>
<span class="cp">#define ERRLOG_TEXT_SIZE    (ERRLOG_ENTRY_SIZE - 2 * 4 - 1)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ErrLogEntry_tag</span> <span class="p">{</span>

	<span class="cm">/*00 */</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulErrType</span><span class="p">;</span>

	<span class="cm">/*04 */</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ulErrSubtype</span><span class="p">;</span>

	<span class="cm">/*08 */</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ucTextSize</span><span class="p">;</span>

	<span class="cm">/*09 */</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ucText</span><span class="p">[</span><span class="n">ERRLOG_TEXT_SIZE</span><span class="p">];</span>
	<span class="cm">/* ASCIIZ of len ucTextSize-1 */</span>

<span class="cm">/*40 */</span>
<span class="p">}</span> <span class="n">tErrLogEntry</span><span class="p">;</span>


<span class="cp">#if defined(__TURBOC__)</span>
<span class="cp">#if sizeof(tErrLogEntry) != ERRLOG_ENTRY_SIZE</span>
<span class="cp">#error size of tErrLogEntry != ERRLOG_ENTRY_SIZE</span>
<span class="cp">#endif				</span><span class="cm">/*  */</span><span class="cp"></span>
<span class="cp">#endif				</span><span class="cm">/*  */</span><span class="cp"></span>

<span class="cm">/*--------------------------------------DPRAM boot spooler------------------*/</span>
<span class="cm">/*  this is the struture used between pc and</span>
<span class="cm"> *  hyperstone to exchange boot data</span>
<span class="cm"> */</span>
<span class="cp">#define DPRAM_SPOOLER_DATA_SIZE 0x20</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">DpramBootSpooler_tag</span> <span class="p">{</span>

	<span class="cm">/*00 */</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Len</span><span class="p">;</span>

	<span class="cm">/*01 */</span> <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">RdPtr</span><span class="p">;</span>

	<span class="cm">/*02 */</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">WrPtr</span><span class="p">;</span>

	<span class="cm">/*03 */</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Data</span><span class="p">[</span><span class="n">DPRAM_SPOOLER_DATA_SIZE</span><span class="p">];</span>

<span class="cm">/*23 */</span>
<span class="p">}</span> <span class="n">tDpramBootSpooler</span><span class="p">;</span>


<span class="cp">#define DPRAM_SPOOLER_MIN_SIZE  5       </span><span class="cm">/* Len+RdPtr+Wrptr+2*data */</span><span class="cp"></span>
<span class="cp">#define DPRAM_SPOOLER_DEF_SIZE  0x23    </span><span class="cm">/* current default size   */</span><span class="cp"></span>

<span class="cm">/*--------------------------------------HYCARD/ERGO DPRAM SoftUart----------*/</span>
<span class="cm">/* at DPRAM offset 0x1C00: */</span>
<span class="cp">#define SIZE_RSV_SOFT_UART  0x1B0   </span><span class="cm">/* 432 bytes reserved for SoftUart */</span><span class="cp"></span>


<span class="cp">#endif	</span><span class="cm">/* __INCE1PC_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
