<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › pcbit › capi.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>capi.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * CAPI encoder/decoder for</span>
<span class="cm"> * Portugal Telecom CAPI 2.0</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1996 Universidade de Lisboa</span>
<span class="cm"> *</span>
<span class="cm"> * Written by Pedro Roque Marques (roque@di.fc.ul.pt)</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms of</span>
<span class="cm"> * the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> * Not compatible with the AVM Gmbh. CAPI 2.0</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *        Documentation:</span>
<span class="cm"> *        - &quot;Common ISDN API - Perfil Português - Versão 2.1&quot;,</span>
<span class="cm"> *           Telecom Portugal, Fev 1992.</span>
<span class="cm"> *        - &quot;Common ISDN API - Especificação de protocolos para</span>
<span class="cm"> *           acesso aos canais B&quot;, Inesc, Jan 1994.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *        TODO: better decoding of Information Elements</span>
<span class="cm"> *              for debug purposes mainly</span>
<span class="cm"> *              encode our number in CallerPN and ConnectedPN</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>

<span class="cp">#include &lt;linux/skbuff.h&gt;</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;asm/string.h&gt;</span>

<span class="cp">#include &lt;linux/isdnif.h&gt;</span>

<span class="cp">#include &quot;pcbit.h&quot;</span>
<span class="cp">#include &quot;edss1.h&quot;</span>
<span class="cp">#include &quot;capi.h&quot;</span>


<span class="cm">/*</span>
<span class="cm"> *  Encoding of CAPI messages</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="nf">capi_conn_req</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">calledPN</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">proto</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">len</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * length</span>
<span class="cm">	 *   AppInfoMask - 2</span>
<span class="cm">	 *   BC0         - 3</span>
<span class="cm">	 *   BC1         - 1</span>
<span class="cm">	 *   Chan        - 2</span>
<span class="cm">	 *   Keypad      - 1</span>
<span class="cm">	 *   CPN         - 1</span>
<span class="cm">	 *   CPSA        - 1</span>
<span class="cm">	 *   CalledPN    - 2 + strlen</span>
<span class="cm">	 *   CalledPSA   - 1</span>
<span class="cm">	 *   rest...     - 4</span>
<span class="cm">	 *   ----------------</span>
<span class="cm">	 *   Total        18 + strlen</span>
<span class="cm">	 */</span>

	<span class="n">len</span> <span class="o">=</span> <span class="mi">18</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">calledPN</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">proto</span> <span class="o">==</span> <span class="n">ISDN_PROTO_L2_TRANS</span><span class="p">)</span>
		<span class="n">len</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="n">len</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_conn_req: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* InfoElmMask */</span>
	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">AppInfoMask</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">proto</span> <span class="o">==</span> <span class="n">ISDN_PROTO_L2_TRANS</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="cm">/* Bearer Capability - Mandatory*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>        <span class="cm">/* BC0.Length		*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>     <span class="cm">/* Speech		*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>     <span class="cm">/* Circuit Mode		*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x23</span><span class="p">;</span>     <span class="cm">/* A-law		*/</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="cm">/* Bearer Capability - Mandatory*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>        <span class="cm">/* BC0.Length		*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x88</span><span class="p">;</span>     <span class="cm">/* Digital Information	*/</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x90</span><span class="p">;</span>     <span class="cm">/* BC0.Octect4		*/</span>
	<span class="p">}</span>

	<span class="cm">/* Bearer Capability - Optional*/</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="cm">/* BC1.Length = 0                    */</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>        <span class="cm">/* ChannelID.Length = 1              */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x83</span><span class="p">;</span>     <span class="cm">/* Basic Interface - Any Channel     */</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="cm">/* Keypad.Length = 0                 */</span>


	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="cm">/* CallingPN.Length = 0              */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>        <span class="cm">/* CallingPSA.Length = 0             */</span>

	<span class="cm">/* Called Party Number */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">calledPN</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">calledPN</span><span class="p">)),</span> <span class="n">calledPN</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">calledPN</span><span class="p">));</span>

	<span class="cm">/* &#39;#&#39; */</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/* CalledPSA.Length = 0     */</span>

	<span class="cm">/* LLC.Length  = 0; */</span>
	<span class="cm">/* HLC0.Length = 0; */</span>
	<span class="cm">/* HLC1.Length = 0; */</span>
	<span class="cm">/* UTUS.Length = 0; */</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_conn_resp</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_conn_resp: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>  <span class="cm">/* ACCEPT_CALL */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_conn_active_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * 8 bytes</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_conn_active_req: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>

<span class="cp">#ifdef DEBUG</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Call Reference: %04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  BC.Length = 0;          */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  ConnectedPN.Length = 0  */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  PSA.Length              */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  LLC.Length = 0;         */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  HLC.Length = 0;         */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="cm">/*  UTUS.Length = 0;        */</span>

	<span class="k">return</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_conn_active_resp</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * 2 bytes</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_conn_active_resp: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">capi_select_proto_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="n">outgoing</span><span class="p">)</span>
<span class="p">{</span>

	<span class="cm">/*</span>
<span class="cm">	 * 18 bytes</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">18</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_select_proto_req: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>

	<span class="cm">/* Layer2 protocol */</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">chan</span><span class="o">-&gt;</span><span class="n">proto</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ISDN_PROTO_L2_X75I</span>:
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>            <span class="cm">/* LAPB */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ISDN_PROTO_L2_HDLC</span>:
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ISDN_PROTO_L2_TRANS</span>:
		<span class="cm">/*</span>
<span class="cm">		 *	Voice (a-law)</span>
<span class="cm">		 */</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
<span class="cp">#ifdef DEBUG</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Transparent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="p">(</span><span class="n">outgoing</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x42</span><span class="p">);</span>    <span class="cm">/* Don&#39;t ask */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">MRU</span><span class="p">;</span>


	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>           <span class="cm">/* Modulo */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>           <span class="cm">/* Max Window */</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>           <span class="cm">/* No Layer3 Protocol */</span>

	<span class="cm">/*</span>
<span class="cm">	 * 2 - layer3 MTU       [10]</span>
<span class="cm">	 *   - Modulo           [12]</span>
<span class="cm">	 *   - Window</span>
<span class="cm">	 *   - layer1 proto     [14]</span>
<span class="cm">	 *   - bitrate</span>
<span class="cm">	 *   - sub-channel      [16]</span>
<span class="cm">	 *   - layer1dataformat [17]</span>
<span class="cm">	 */</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">18</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">capi_activate_transp_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_activate_transp_req: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>


	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">layer2link</span><span class="p">;</span> <span class="cm">/* Layer2 id */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>             <span class="cm">/* Transmit by default */</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">MRU</span><span class="p">;</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>             <span class="cm">/* Enables reception*/</span>

	<span class="k">return</span> <span class="mi">7</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_tdata_req</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">data_len</span><span class="p">;</span>


	<span class="cm">/*</span>
<span class="cm">	 * callref      - 2</span>
<span class="cm">	 * layer2link   - 1</span>
<span class="cm">	 * wBlockLength - 2</span>
<span class="cm">	 * data         - 4</span>
<span class="cm">	 * sernum       - 1</span>
<span class="cm">	 */</span>

	<span class="n">data_len</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">skb_headroom</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CRIT</span> <span class="s">&quot;No headspace (%u) on headroom %p for capi header</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">skb_headroom</span><span class="p">(</span><span class="n">skb</span><span class="p">),</span> <span class="n">skb</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">skb_push</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>
	<span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">layer2link</span><span class="p">;</span>
	<span class="o">*</span><span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="mi">3</span><span class="p">))</span> <span class="o">=</span> <span class="n">data_len</span><span class="p">;</span>

	<span class="n">chan</span><span class="o">-&gt;</span><span class="n">s_refnum</span> <span class="o">=</span> <span class="p">(</span><span class="n">chan</span><span class="o">-&gt;</span><span class="n">s_refnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span><span class="p">;</span>
	<span class="o">*</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">s_refnum</span><span class="p">;</span>

	<span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                           <span class="cm">/* HDLC frame number */</span>

	<span class="k">return</span> <span class="mi">10</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_tdata_resp</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>

<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_tdata_resp: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">layer2link</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">r_refnum</span><span class="p">;</span>

	<span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_disc_req</span><span class="p">(</span><span class="n">ushort</span> <span class="n">callref</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">,</span> <span class="n">u_char</span> <span class="n">cause</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_disc_req: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">callref</span><span class="p">;</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>                  <span class="cm">/* Cause.Length = 2; */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">|</span> <span class="n">cause</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Change it: we should send &#39;Sic transit gloria Mundi&#39; here ;-)</span>
<span class="cm">	 */</span>

	<span class="o">*</span><span class="p">(</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                   <span class="cm">/* UTUS.Length = 0;  */</span>

	<span class="k">return</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_disc_resp</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;capi_disc_resp: alloc_skb failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb_put</span><span class="p">(</span><span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">=</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> *  Decoding of CAPI messages</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="nf">capi_decode_conn_ind</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">callb_data</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">CIlen</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>

	<span class="cm">/* Call Reference [CAPI] */</span>
	<span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="cp">#ifdef DEBUG</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Call Reference: %04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="cm">/* Channel Identification */</span>

	<span class="cm">/* Expect</span>
<span class="cm">	   Len = 1</span>
<span class="cm">	   Octect 3 = 0100 10CC - [ 7 Basic, 4 , 2-1 chan ]</span>
<span class="cm">	*/</span>

	<span class="n">CIlen</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="cp">#ifdef DEBUG</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CIlen</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(((</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xFC</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x48</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;decode_conn_ind: chan ok</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;phyChan = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;conn_ind: CIlen = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">CIlen</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">CIlen</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Calling Party Number */</span>
	<span class="cm">/* An &quot;additional service&quot; as far as Portugal Telecom is concerned */</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="cp">#ifdef DEBUG</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;CPN: Octect 3 %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="cp">#endif</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CallingPN</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">)))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

		<span class="n">skb_copy_from_linear_data_offset</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
						 <span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CallingPN</span><span class="p">,</span>
						 <span class="n">len</span> <span class="o">-</span> <span class="n">count</span><span class="p">);</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CallingPN</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CallingPN</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;NULL CallingPN</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Calling Party Subaddress */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Called Party Number */</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CalledPN</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">len</span> <span class="o">-</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">)))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

		<span class="n">skb_copy_from_linear_data_offset</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
						 <span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CalledPN</span><span class="p">,</span>
						 <span class="n">len</span> <span class="o">-</span> <span class="n">count</span><span class="p">);</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CalledPN</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">setup</span><span class="p">.</span><span class="n">CalledPN</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;NULL CalledPN</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Called Party Subaddress */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* LLC */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* HLC */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* U2U */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  returns errcode</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="nf">capi_decode_conn_conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="o">*</span><span class="n">complete</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">errcode</span><span class="p">;</span>

	<span class="n">chan</span><span class="o">-&gt;</span><span class="n">callref</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>     <span class="cm">/* Update CallReference */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">errcode</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>   <span class="cm">/* read errcode */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="o">*</span><span class="n">complete</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* FIX ME */</span>
	<span class="cm">/* This is actually a firmware bug */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!*</span><span class="n">complete</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;complete=%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">complete</span><span class="p">);</span>
		<span class="o">*</span><span class="n">complete</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="cm">/* Optional Bearer Capability */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Channel Identification */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* High Layer Compatibility follows */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">errcode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_decode_conn_actv_ind</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">len</span><span class="p">;</span>
<span class="cp">#ifdef DEBUG</span>
	<span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="cp">#endif</span>

	<span class="cm">/* Yet Another Bearer Capability */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>


	<span class="cm">/* Connected Party Number */</span>
	<span class="n">len</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>

<span class="cp">#ifdef DEBUG</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">len</span> <span class="o">&lt;</span> <span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">skb_copy_from_linear_data_offset</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">str</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Connected Party Number: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;actv_ind CPN len = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Connected Subaddress */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Low Layer Capability */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* High Layer Capability */</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_decode_conn_actv_conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">errcode</span><span class="p">;</span>

	<span class="n">errcode</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="cm">/* Channel Identification</span>
<span class="cm">	   skb_pull(skb, skb-&gt;data[0] + 1);</span>
<span class="cm">	*/</span>
	<span class="k">return</span> <span class="n">errcode</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">capi_decode_sel_proto_conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">errcode</span><span class="p">;</span>

	<span class="n">chan</span><span class="o">-&gt;</span><span class="n">layer2link</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">errcode</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">errcode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_decode_actv_trans_conf</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">errcode</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">chan</span><span class="o">-&gt;</span><span class="n">layer2link</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;capi_decode_actv_trans_conf: layer2link doesn&#39;t match</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">errcode</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">ushort</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">errcode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">capi_decode_disc_ind</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcbit_chan</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ushort</span> <span class="n">len</span><span class="p">;</span>
<span class="cp">#ifdef DEBUG</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="cm">/* Cause */</span>

	<span class="n">len</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cp">#ifdef DEBUG</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Cause Octect %d: %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
		       <span class="o">*</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
<span class="cp">#endif</span>

	<span class="n">skb_pull</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef DEBUG</span>
<span class="kt">int</span> <span class="nf">capi_decode_debug_188</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span> <span class="n">ushort</span> <span class="n">hdrlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">str</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="mi">64</span> <span class="o">&amp;&amp;</span> <span class="n">len</span> <span class="o">==</span> <span class="n">hdrlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">hdr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hdrlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">str</span><span class="p">[</span><span class="n">hdrlen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;debug message incorrect</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
