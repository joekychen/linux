<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › hardware › eicon › debuglib.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>debuglib.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> Copyright (c) Eicon Networks, 2002.</span>
<span class="cm"> *</span>
<span class="cm"> This source file is supplied for the use with</span>
<span class="cm"> Eicon Networks range of DIVA Server Adapters.</span>
<span class="cm"> *</span>
<span class="cm"> Eicon File Revision :    2.1</span>
<span class="cm"> *</span>
<span class="cm"> This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> it under the terms of the GNU General Public License as published by</span>
<span class="cm"> the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> any later version.</span>
<span class="cm"> *</span>
<span class="cm"> This program is distributed in the hope that it will be useful,</span>
<span class="cm"> but WITHOUT ANY WARRANTY OF ANY KIND WHATSOEVER INCLUDING ANY</span>
<span class="cm"> implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="cm"> See the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> You should have received a copy of the GNU General Public License</span>
<span class="cm"> along with this program; if not, write to the Free Software</span>
<span class="cm"> Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#if !defined(__DEBUGLIB_H__)</span>
<span class="cp">#define __DEBUGLIB_H__</span>
<span class="cp">#include &lt;stdarg.h&gt;</span>
<span class="cm">/*</span>
<span class="cm"> * define global debug priorities</span>
<span class="cm"> */</span>
<span class="cp">#define DL_LOG  0x00000001 </span><span class="cm">/* always worth mentioning */</span><span class="cp"></span>
<span class="cp">#define DL_FTL  0x00000002 </span><span class="cm">/* always sampled error    */</span><span class="cp"></span>
<span class="cp">#define DL_ERR  0x00000004 </span><span class="cm">/* any kind of error       */</span><span class="cp"></span>
<span class="cp">#define DL_TRC  0x00000008 </span><span class="cm">/* verbose information     */</span><span class="cp"></span>
<span class="cp">#define DL_XLOG  0x00000010 </span><span class="cm">/* old xlog info           */</span><span class="cp"></span>
<span class="cp">#define DL_MXLOG 0x00000020 </span><span class="cm">/* maestra xlog info    */</span><span class="cp"></span>
<span class="cp">#define DL_FTL_MXLOG 0x00000021 </span><span class="cm">/* fatal maestra xlog info */</span><span class="cp"></span>
<span class="cp">#define DL_EVL  0x00000080 </span><span class="cm">/* special NT eventlog msg */</span><span class="cp"></span>
<span class="cp">#define DL_COMPAT (DL_MXLOG | DL_XLOG)</span>
<span class="cp">#define DL_PRIOR_MASK (DL_EVL | DL_COMPAT | DL_TRC | DL_ERR | DL_FTL | DL_LOG)</span>
<span class="cp">#define DLI_LOG  0x0100</span>
<span class="cp">#define DLI_FTL  0x0200</span>
<span class="cp">#define DLI_ERR  0x0300</span>
<span class="cp">#define DLI_TRC  0x0400</span>
<span class="cp">#define DLI_XLOG 0x0500</span>
<span class="cp">#define DLI_MXLOG 0x0600</span>
<span class="cp">#define DLI_FTL_MXLOG 0x0600</span>
<span class="cp">#define DLI_EVL  0x0800</span>
<span class="cm">/*</span>
<span class="cm"> * define OS (operating system interface) debuglevel</span>
<span class="cm"> */</span>
<span class="cp">#define DL_REG  0x00000100 </span><span class="cm">/* init/query registry     */</span><span class="cp"></span>
<span class="cp">#define DL_MEM  0x00000200 </span><span class="cm">/* memory management       */</span><span class="cp"></span>
<span class="cp">#define DL_SPL  0x00000400 </span><span class="cm">/* event/spinlock handling */</span><span class="cp"></span>
<span class="cp">#define DL_IRP  0x00000800 </span><span class="cm">/* I/O request handling    */</span><span class="cp"></span>
<span class="cp">#define DL_TIM  0x00001000 </span><span class="cm">/* timer/watchdog handling */</span><span class="cp"></span>
<span class="cp">#define DL_BLK  0x00002000 </span><span class="cm">/* raw data block contents */</span><span class="cp"></span>
<span class="cp">#define DL_OS_MASK (DL_BLK | DL_TIM | DL_IRP | DL_SPL | DL_MEM | DL_REG)</span>
<span class="cp">#define DLI_REG  0x0900</span>
<span class="cp">#define DLI_MEM  0x0A00</span>
<span class="cp">#define DLI_SPL  0x0B00</span>
<span class="cp">#define DLI_IRP  0x0C00</span>
<span class="cp">#define DLI_TIM  0x0D00</span>
<span class="cp">#define DLI_BLK  0x0E00</span>
<span class="cm">/*</span>
<span class="cm"> * define ISDN (connection interface) debuglevel</span>
<span class="cm"> */</span>
<span class="cp">#define DL_TAPI  0x00010000 </span><span class="cm">/* debug TAPI interface    */</span><span class="cp"></span>
<span class="cp">#define DL_NDIS  0x00020000 </span><span class="cm">/* debug NDIS interface    */</span><span class="cp"></span>
<span class="cp">#define DL_CONN  0x00040000 </span><span class="cm">/* connection handling     */</span><span class="cp"></span>
<span class="cp">#define DL_STAT  0x00080000 </span><span class="cm">/* trace state machines    */</span><span class="cp"></span>
<span class="cp">#define DL_SEND  0x00100000 </span><span class="cm">/* trace raw xmitted data  */</span><span class="cp"></span>
<span class="cp">#define DL_RECV  0x00200000 </span><span class="cm">/* trace raw received data */</span><span class="cp"></span>
<span class="cp">#define DL_DATA  (DL_SEND | DL_RECV)</span>
<span class="cp">#define DL_ISDN_MASK (DL_DATA | DL_STAT | DL_CONN | DL_NDIS | DL_TAPI)</span>
<span class="cp">#define DLI_TAPI 0x1100</span>
<span class="cp">#define DLI_NDIS 0x1200</span>
<span class="cp">#define DLI_CONN 0x1300</span>
<span class="cp">#define DLI_STAT 0x1400</span>
<span class="cp">#define DLI_SEND 0x1500</span>
<span class="cp">#define DLI_RECV 0x1600</span>
<span class="cm">/*</span>
<span class="cm"> * define some private (unspecified) debuglevel</span>
<span class="cm"> */</span>
<span class="cp">#define DL_PRV0  0x01000000</span>
<span class="cp">#define DL_PRV1  0x02000000</span>
<span class="cp">#define DL_PRV2  0x04000000</span>
<span class="cp">#define DL_PRV3  0x08000000</span>
<span class="cp">#define DL_PRIV_MASK (DL_PRV0 | DL_PRV1 | DL_PRV2 | DL_PRV3)</span>
<span class="cp">#define DLI_PRV0 0x1900</span>
<span class="cp">#define DLI_PRV1 0x1A00</span>
<span class="cp">#define DLI_PRV2 0x1B00</span>
<span class="cp">#define DLI_PRV3 0x1C00</span>
<span class="cp">#define DT_INDEX(x)  ((x) &amp; 0x000F)</span>
<span class="cp">#define DL_INDEX(x)  ((((x) &gt;&gt; 8) &amp; 0x00FF) - 1)</span>
<span class="cp">#define DLI_NAME(x)  ((x) &amp; 0xFF00)</span>
<span class="cm">/*</span>
<span class="cm"> * Debug mask for kernel mode tracing, if set the output is also sent to</span>
<span class="cm"> * the system debug function. Requires that the project is compiled</span>
<span class="cm"> * with _KERNEL_DBG_PRINT_</span>
<span class="cm"> */</span>
<span class="cp">#define DL_TO_KERNEL    0x40000000</span>

<span class="cp">#ifdef DIVA_NO_DEBUGLIB</span>
<span class="cp">#define myDbgPrint_LOG(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_FTL(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_ERR(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_TRC(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_MXLOG(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_EVL(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_REG(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_MEM(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_SPL(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_IRP(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_TIM(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_BLK(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_TAPI(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_NDIS(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_CONN(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_STAT(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_SEND(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_RECV(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_PRV0(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_PRV1(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_PRV2(x...) do { } while (0);</span>
<span class="cp">#define myDbgPrint_PRV3(x...) do { } while (0);</span>
<span class="cp">#define DBG_TEST(func, args) do { } while (0);</span>
<span class="cp">#define DBG_EVL_ID(args) do { } while (0);</span>

<span class="cp">#else </span><span class="cm">/* DIVA_NO_DEBUGLIB */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> * define low level macros for formatted &amp; raw debugging</span>
<span class="cm"> */</span>
<span class="cp">#define DBG_DECL(func) extern void  myDbgPrint_##func(char *, ...);</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">LOG</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">FTL</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">ERR</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">TRC</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">MXLOG</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">FTL_MXLOG</span><span class="p">)</span>
<span class="k">extern</span> <span class="kt">void</span>  <span class="n">myDbgPrint_EVL</span><span class="p">(</span><span class="kt">long</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">REG</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">MEM</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">SPL</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">IRP</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">TIM</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">BLK</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">TAPI</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">NDIS</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">CONN</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">STAT</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">SEND</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">RECV</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">PRV0</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">PRV1</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">PRV2</span><span class="p">)</span>
<span class="n">DBG_DECL</span><span class="p">(</span><span class="n">PRV3</span><span class="p">)</span>
<span class="cp">#ifdef _KERNEL_DBG_PRINT_</span>
<span class="cm">/*</span>
<span class="cm"> * tracing to maint and kernel if selected in the trace mask.</span>
<span class="cm"> */</span>
<span class="cp">#define DBG_TEST(func, args)						\</span>
<span class="cp">	{ if ((myDriverDebugHandle.dbgMask) &amp; (unsigned long)DL_##func) \</span>
<span class="cp">		{							\</span>
<span class="cp">			if ((myDriverDebugHandle.dbgMask) &amp; DL_TO_KERNEL) \</span>
<span class="cp">			{ DbgPrint args; DbgPrint(&quot;\r\n&quot;); }		\</span>
<span class="cp">			myDbgPrint_##func args;			\</span>
<span class="cp">		} }</span>
<span class="cp">#else</span>
<span class="cm">/*</span>
<span class="cm"> * Standard tracing to maint driver.</span>
<span class="cm"> */</span>
<span class="cp">#define DBG_TEST(func, args)						\</span>
<span class="cp">	{ if ((myDriverDebugHandle.dbgMask) &amp; (unsigned long)DL_##func) \</span>
<span class="cp">		{ myDbgPrint_##func args;				\</span>
<span class="cp">		} }</span>
<span class="cp">#endif</span>
<span class="cm">/*</span>
<span class="cm"> * For event level debug use a separate define, the parameter are</span>
<span class="cm"> * different and cause compiler errors on some systems.</span>
<span class="cm"> */</span>
<span class="cp">#define DBG_EVL_ID(args)						\</span>
<span class="cp">	{ if ((myDriverDebugHandle.dbgMask) &amp; (unsigned long)DL_EVL)	\</span>
<span class="cp">		{ myDbgPrint_EVL args;					\</span>
<span class="cp">		} }</span>

<span class="cp">#endif </span><span class="cm">/* DIVA_NO_DEBUGLIB */</span><span class="cp"></span>

<span class="cp">#define DBG_LOG(args)  DBG_TEST(LOG, args)</span>
<span class="cp">#define DBG_FTL(args)  DBG_TEST(FTL, args)</span>
<span class="cp">#define DBG_ERR(args)  DBG_TEST(ERR, args)</span>
<span class="cp">#define DBG_TRC(args)  DBG_TEST(TRC, args)</span>
<span class="cp">#define DBG_MXLOG(args)  DBG_TEST(MXLOG, args)</span>
<span class="cp">#define DBG_FTL_MXLOG(args) DBG_TEST(FTL_MXLOG, args)</span>
<span class="cp">#define DBG_EVL(args)  DBG_EVL_ID(args)</span>
<span class="cp">#define DBG_REG(args)  DBG_TEST(REG, args)</span>
<span class="cp">#define DBG_MEM(args)  DBG_TEST(MEM, args)</span>
<span class="cp">#define DBG_SPL(args)  DBG_TEST(SPL, args)</span>
<span class="cp">#define DBG_IRP(args)  DBG_TEST(IRP, args)</span>
<span class="cp">#define DBG_TIM(args)  DBG_TEST(TIM, args)</span>
<span class="cp">#define DBG_BLK(args)  DBG_TEST(BLK, args)</span>
<span class="cp">#define DBG_TAPI(args)  DBG_TEST(TAPI, args)</span>
<span class="cp">#define DBG_NDIS(args)  DBG_TEST(NDIS, args)</span>
<span class="cp">#define DBG_CONN(args)  DBG_TEST(CONN, args)</span>
<span class="cp">#define DBG_STAT(args)  DBG_TEST(STAT, args)</span>
<span class="cp">#define DBG_SEND(args)  DBG_TEST(SEND, args)</span>
<span class="cp">#define DBG_RECV(args)  DBG_TEST(RECV, args)</span>
<span class="cp">#define DBG_PRV0(args)  DBG_TEST(PRV0, args)</span>
<span class="cp">#define DBG_PRV1(args)  DBG_TEST(PRV1, args)</span>
<span class="cp">#define DBG_PRV2(args)  DBG_TEST(PRV2, args)</span>
<span class="cp">#define DBG_PRV3(args)  DBG_TEST(PRV3, args)</span>
<span class="cm">/*</span>
<span class="cm"> * prototypes for debug register/deregister functions in &quot;debuglib.c&quot;</span>
<span class="cm"> */</span>
<span class="cp">#ifdef DIVA_NO_DEBUGLIB</span>
<span class="cp">#define DbgRegister(name, tag, mask) do { } while (0)</span>
<span class="cp">#define DbgDeregister() do { } while (0)</span>
<span class="cp">#define DbgSetLevel(mask) do { } while (0)</span>
<span class="cp">#else</span>
<span class="k">extern</span> <span class="n">DIVA_DI_PRINTF</span> <span class="n">dprintf</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span>  <span class="n">DbgRegister</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">drvName</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drvTag</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dbgMask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">DbgDeregister</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">DbgSetLevel</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dbgMask</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cm">/*</span>
<span class="cm"> * driver internal structure for debug handling;</span>
<span class="cm"> * in client drivers this structure is maintained in &quot;debuglib.c&quot;,</span>
<span class="cm"> * in the debug driver &quot;debug.c&quot; maintains a chain of such structs.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_DbgHandle_</span> <span class="o">*</span><span class="n">pDbgHandle</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">DbgEnd</span><span class="p">)(</span><span class="n">pDbgHandle</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">DbgLog</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">va_list</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">DbgOld</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">va_list</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">DbgEv</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="kt">va_list</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">DbgIrq</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">va_list</span><span class="p">);</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_DbgHandle_</span>
<span class="p">{</span> <span class="kt">char</span>    <span class="n">Registered</span><span class="p">;</span> <span class="cm">/* driver successfully registered */</span>
<span class="cp">#define DBG_HANDLE_REG_NEW 0x01  </span><span class="cm">/* this (new) structure    */</span><span class="cp"></span>
<span class="cp">#define DBG_HANDLE_REG_OLD 0x7f  </span><span class="cm">/* old structure (see below)  */</span><span class="cp"></span>
	<span class="kt">char</span>    <span class="n">Version</span><span class="p">;</span>  <span class="cm">/* version of this structure  */</span>
<span class="cp">#define DBG_HANDLE_VERSION 1   </span><span class="cm">/* contains dbg_old function now */</span><span class="cp"></span>
<span class="cp">#define DBG_HANDLE_VER_EXT  2           </span><span class="cm">/* pReserved points to extended info*/</span><span class="cp"></span>
	<span class="kt">short</span>               <span class="n">id</span><span class="p">;</span>   <span class="cm">/* internal id of registered driver */</span>
	<span class="k">struct</span> <span class="n">_DbgHandle_</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>   <span class="cm">/* ptr to next registered driver    */</span>
	<span class="k">struct</span> <span class="cm">/*LARGE_INTEGER*/</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">LowPart</span><span class="p">;</span>
		<span class="kt">long</span>          <span class="n">HighPart</span><span class="p">;</span>
	<span class="p">}</span>     <span class="n">regTime</span><span class="p">;</span>  <span class="cm">/* timestamp for registration       */</span>
	<span class="kt">void</span>               <span class="o">*</span><span class="n">pIrp</span><span class="p">;</span>   <span class="cm">/* ptr to pending i/o request       */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">dbgMask</span><span class="p">;</span>  <span class="cm">/* current debug mask               */</span>
	<span class="kt">char</span>                <span class="n">drvName</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span> <span class="cm">/* ASCII name of registered driver  */</span>
	<span class="kt">char</span>                <span class="n">drvTag</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span> <span class="cm">/* revision string     */</span>
	<span class="n">DbgEnd</span>              <span class="n">dbg_end</span><span class="p">;</span>  <span class="cm">/* function for debug closing       */</span>
	<span class="n">DbgLog</span>              <span class="n">dbg_prt</span><span class="p">;</span>  <span class="cm">/* function for debug appending     */</span>
	<span class="n">DbgOld</span>              <span class="n">dbg_old</span><span class="p">;</span>  <span class="cm">/* function for old debug appending */</span>
	<span class="n">DbgEv</span>       <span class="n">dbg_ev</span><span class="p">;</span>  <span class="cm">/* function for Windows NT Eventlog */</span>
	<span class="n">DbgIrq</span>    <span class="n">dbg_irq</span><span class="p">;</span>  <span class="cm">/* function for irql checked debug  */</span>
	<span class="kt">void</span>      <span class="o">*</span><span class="n">pReserved3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">_DbgHandle_</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">_DbgHandle_</span> <span class="n">myDriverDebugHandle</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_OldDbgHandle_</span>
<span class="p">{</span> <span class="k">struct</span> <span class="n">_OldDbgHandle_</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="kt">void</span>                <span class="o">*</span><span class="n">pIrp</span><span class="p">;</span>
	<span class="kt">long</span>    <span class="n">regTime</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">dbgMask</span><span class="p">;</span>
	<span class="kt">short</span>               <span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span>                <span class="n">drvName</span><span class="p">[</span><span class="mi">78</span><span class="p">];</span>
	<span class="n">DbgEnd</span>              <span class="n">dbg_end</span><span class="p">;</span>
	<span class="n">DbgLog</span>              <span class="n">dbg_prt</span><span class="p">;</span>
<span class="p">}</span> <span class="n">_OldDbgHandle_</span><span class="p">;</span>
<span class="cm">/* the differences in DbgHandles</span>
<span class="cm">   old:    tmp:     new:</span>
<span class="cm">   0 long next  char Registered  char Registered</span>
<span class="cm">   char filler   char Version</span>
<span class="cm">   short id    short id</span>
<span class="cm">   4 long pIrp  long    regTime.lo  long next</span>
<span class="cm">   8 long    regTime.lo long    regTime.hi  long    regTime.lo</span>
<span class="cm">   12 long    regTime.hi long next   long regTime.hi</span>
<span class="cm">   16 long dbgMask  long pIrp   long pIrp</span>
<span class="cm">   20 short id   long dbgMask   long dbgMask</span>
<span class="cm">   22 char    drvName[78] ..</span>
<span class="cm">   24 ..     char drvName[16]  char drvName[16]</span>
<span class="cm">   40 ..     char drvTag[64]  char drvTag[64]</span>
<span class="cm">   100 void *dbg_end ..      ..</span>
<span class="cm">   104 void *dbg_prt void *dbg_end  void *dbg_end</span>
<span class="cm">   108 ..     void *dbg_prt  void *dbg_prt</span>
<span class="cm">   112 ..     ..      void *dbg_old</span>
<span class="cm">   116 ..     ..      void *dbg_ev</span>
<span class="cm">   120 ..     ..      void *dbg_irq</span>
<span class="cm">   124 ..     ..      void *pReserved3</span>
<span class="cm">   ( new-&gt;id == 0 &amp;&amp; *((short *)&amp;new-&gt;dbgMask) == -1 ) identifies &quot;old&quot;,</span>
<span class="cm">   new-&gt;Registered and new-&gt;Version overlay old-&gt;next,</span>
<span class="cm">   new-&gt;next overlays old-&gt;pIrp, new-&gt;regTime matches old-&gt;regTime and</span>
<span class="cm">   thus these fields can be maintained in new struct whithout trouble;</span>
<span class="cm">   id, dbgMask, drvName, dbg_end and dbg_prt need special handling !</span>
<span class="cm">*/</span>
<span class="cp">#define DBG_EXT_TYPE_CARD_TRACE     0x00000001</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ExtendedType</span><span class="p">;</span>
	<span class="k">union</span>
	<span class="p">{</span>
		<span class="cm">/* DBG_EXT_TYPE_CARD_TRACE */</span>
		<span class="k">struct</span>
		<span class="p">{</span>
			<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">MaskChangedNotify</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pContext</span><span class="p">);</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ModuleTxtMask</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">DebugLevel</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">B_ChannelMask</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">LogBufferSize</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">CardTrace</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">Data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">_DbgExtendedInfo_</span><span class="p">;</span>
<span class="cp">#ifndef DIVA_NO_DEBUGLIB</span>
<span class="cm">/* -------------------------------------------------------------</span>
<span class="cm">   Function used for xlog-style debug</span>
<span class="cm">   ------------------------------------------------------------- */</span>
<span class="cp">#define XDI_USE_XLOG 1</span>
<span class="kt">void</span> <span class="n">xdi_dbg_xlog</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="p">...);</span>
<span class="cp">#endif </span><span class="cm">/* DIVA_NO_DEBUGLIB */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __DEBUGLIB_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
