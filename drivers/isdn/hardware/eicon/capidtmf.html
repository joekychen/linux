<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › hardware › eicon › capidtmf.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>capidtmf.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> Copyright (c) Eicon Networks, 2002.</span>
<span class="cm"> *</span>
<span class="cm"> This source file is supplied for the use with</span>
<span class="cm"> Eicon Networks range of DIVA Server Adapters.</span>
<span class="cm"> *</span>
<span class="cm"> Eicon File Revision :    2.1</span>
<span class="cm"> *</span>
<span class="cm"> This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> it under the terms of the GNU General Public License as published by</span>
<span class="cm"> the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> any later version.</span>
<span class="cm"> *</span>
<span class="cm"> This program is distributed in the hope that it will be useful,</span>
<span class="cm"> but WITHOUT ANY WARRANTY OF ANY KIND WHATSOEVER INCLUDING ANY</span>
<span class="cm"> implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="cm"> See the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> You should have received a copy of the GNU General Public License</span>
<span class="cm"> along with this program; if not, write to the Free Software</span>
<span class="cm"> Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;platform.h&quot;</span>









<span class="cp">#include &quot;capidtmf.h&quot;</span>

<span class="cm">/* #define TRACE_ */</span>

<span class="cp">#define FILE_ &quot;CAPIDTMF.C&quot;</span>

<span class="cm">/*---------------------------------------------------------------------------*/</span>


<span class="cp">#define trace(a)</span>



<span class="cm">/*---------------------------------------------------------------------------*/</span>

<span class="k">static</span> <span class="kt">short</span> <span class="n">capidtmf_expand_table_alaw</span><span class="p">[</span><span class="mh">0x0100</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="o">-</span><span class="mi">5504</span><span class="p">,</span>   <span class="mi">5504</span><span class="p">,</span>   <span class="o">-</span><span class="mi">344</span><span class="p">,</span>    <span class="mi">344</span><span class="p">,</span> <span class="o">-</span><span class="mi">22016</span><span class="p">,</span>  <span class="mi">22016</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1376</span><span class="p">,</span>   <span class="mi">1376</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2752</span><span class="p">,</span>   <span class="mi">2752</span><span class="p">,</span>    <span class="o">-</span><span class="mi">88</span><span class="p">,</span>     <span class="mi">88</span><span class="p">,</span> <span class="o">-</span><span class="mi">11008</span><span class="p">,</span>  <span class="mi">11008</span><span class="p">,</span>   <span class="o">-</span><span class="mi">688</span><span class="p">,</span>    <span class="mi">688</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">7552</span><span class="p">,</span>   <span class="mi">7552</span><span class="p">,</span>   <span class="o">-</span><span class="mi">472</span><span class="p">,</span>    <span class="mi">472</span><span class="p">,</span> <span class="o">-</span><span class="mi">30208</span><span class="p">,</span>  <span class="mi">30208</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1888</span><span class="p">,</span>   <span class="mi">1888</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3776</span><span class="p">,</span>   <span class="mi">3776</span><span class="p">,</span>   <span class="o">-</span><span class="mi">216</span><span class="p">,</span>    <span class="mi">216</span><span class="p">,</span> <span class="o">-</span><span class="mi">15104</span><span class="p">,</span>  <span class="mi">15104</span><span class="p">,</span>   <span class="o">-</span><span class="mi">944</span><span class="p">,</span>    <span class="mi">944</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4480</span><span class="p">,</span>   <span class="mi">4480</span><span class="p">,</span>   <span class="o">-</span><span class="mi">280</span><span class="p">,</span>    <span class="mi">280</span><span class="p">,</span> <span class="o">-</span><span class="mi">17920</span><span class="p">,</span>  <span class="mi">17920</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1120</span><span class="p">,</span>   <span class="mi">1120</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2240</span><span class="p">,</span>   <span class="mi">2240</span><span class="p">,</span>    <span class="o">-</span><span class="mi">24</span><span class="p">,</span>     <span class="mi">24</span><span class="p">,</span>  <span class="o">-</span><span class="mi">8960</span><span class="p">,</span>   <span class="mi">8960</span><span class="p">,</span>   <span class="o">-</span><span class="mi">560</span><span class="p">,</span>    <span class="mi">560</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">6528</span><span class="p">,</span>   <span class="mi">6528</span><span class="p">,</span>   <span class="o">-</span><span class="mi">408</span><span class="p">,</span>    <span class="mi">408</span><span class="p">,</span> <span class="o">-</span><span class="mi">26112</span><span class="p">,</span>  <span class="mi">26112</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1632</span><span class="p">,</span>   <span class="mi">1632</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3264</span><span class="p">,</span>   <span class="mi">3264</span><span class="p">,</span>   <span class="o">-</span><span class="mi">152</span><span class="p">,</span>    <span class="mi">152</span><span class="p">,</span> <span class="o">-</span><span class="mi">13056</span><span class="p">,</span>  <span class="mi">13056</span><span class="p">,</span>   <span class="o">-</span><span class="mi">816</span><span class="p">,</span>    <span class="mi">816</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">6016</span><span class="p">,</span>   <span class="mi">6016</span><span class="p">,</span>   <span class="o">-</span><span class="mi">376</span><span class="p">,</span>    <span class="mi">376</span><span class="p">,</span> <span class="o">-</span><span class="mi">24064</span><span class="p">,</span>  <span class="mi">24064</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1504</span><span class="p">,</span>   <span class="mi">1504</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3008</span><span class="p">,</span>   <span class="mi">3008</span><span class="p">,</span>   <span class="o">-</span><span class="mi">120</span><span class="p">,</span>    <span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">12032</span><span class="p">,</span>  <span class="mi">12032</span><span class="p">,</span>   <span class="o">-</span><span class="mi">752</span><span class="p">,</span>    <span class="mi">752</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">8064</span><span class="p">,</span>   <span class="mi">8064</span><span class="p">,</span>   <span class="o">-</span><span class="mi">504</span><span class="p">,</span>    <span class="mi">504</span><span class="p">,</span> <span class="o">-</span><span class="mi">32256</span><span class="p">,</span>  <span class="mi">32256</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2016</span><span class="p">,</span>   <span class="mi">2016</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4032</span><span class="p">,</span>   <span class="mi">4032</span><span class="p">,</span>   <span class="o">-</span><span class="mi">248</span><span class="p">,</span>    <span class="mi">248</span><span class="p">,</span> <span class="o">-</span><span class="mi">16128</span><span class="p">,</span>  <span class="mi">16128</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1008</span><span class="p">,</span>   <span class="mi">1008</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4992</span><span class="p">,</span>   <span class="mi">4992</span><span class="p">,</span>   <span class="o">-</span><span class="mi">312</span><span class="p">,</span>    <span class="mi">312</span><span class="p">,</span> <span class="o">-</span><span class="mi">19968</span><span class="p">,</span>  <span class="mi">19968</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1248</span><span class="p">,</span>   <span class="mi">1248</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2496</span><span class="p">,</span>   <span class="mi">2496</span><span class="p">,</span>    <span class="o">-</span><span class="mi">56</span><span class="p">,</span>     <span class="mi">56</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9984</span><span class="p">,</span>   <span class="mi">9984</span><span class="p">,</span>   <span class="o">-</span><span class="mi">624</span><span class="p">,</span>    <span class="mi">624</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">7040</span><span class="p">,</span>   <span class="mi">7040</span><span class="p">,</span>   <span class="o">-</span><span class="mi">440</span><span class="p">,</span>    <span class="mi">440</span><span class="p">,</span> <span class="o">-</span><span class="mi">28160</span><span class="p">,</span>  <span class="mi">28160</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1760</span><span class="p">,</span>   <span class="mi">1760</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3520</span><span class="p">,</span>   <span class="mi">3520</span><span class="p">,</span>   <span class="o">-</span><span class="mi">184</span><span class="p">,</span>    <span class="mi">184</span><span class="p">,</span> <span class="o">-</span><span class="mi">14080</span><span class="p">,</span>  <span class="mi">14080</span><span class="p">,</span>   <span class="o">-</span><span class="mi">880</span><span class="p">,</span>    <span class="mi">880</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">5248</span><span class="p">,</span>   <span class="mi">5248</span><span class="p">,</span>   <span class="o">-</span><span class="mi">328</span><span class="p">,</span>    <span class="mi">328</span><span class="p">,</span> <span class="o">-</span><span class="mi">20992</span><span class="p">,</span>  <span class="mi">20992</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1312</span><span class="p">,</span>   <span class="mi">1312</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2624</span><span class="p">,</span>   <span class="mi">2624</span><span class="p">,</span>    <span class="o">-</span><span class="mi">72</span><span class="p">,</span>     <span class="mi">72</span><span class="p">,</span> <span class="o">-</span><span class="mi">10496</span><span class="p">,</span>  <span class="mi">10496</span><span class="p">,</span>   <span class="o">-</span><span class="mi">656</span><span class="p">,</span>    <span class="mi">656</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">7296</span><span class="p">,</span>   <span class="mi">7296</span><span class="p">,</span>   <span class="o">-</span><span class="mi">456</span><span class="p">,</span>    <span class="mi">456</span><span class="p">,</span> <span class="o">-</span><span class="mi">29184</span><span class="p">,</span>  <span class="mi">29184</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1824</span><span class="p">,</span>   <span class="mi">1824</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3648</span><span class="p">,</span>   <span class="mi">3648</span><span class="p">,</span>   <span class="o">-</span><span class="mi">200</span><span class="p">,</span>    <span class="mi">200</span><span class="p">,</span> <span class="o">-</span><span class="mi">14592</span><span class="p">,</span>  <span class="mi">14592</span><span class="p">,</span>   <span class="o">-</span><span class="mi">912</span><span class="p">,</span>    <span class="mi">912</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4224</span><span class="p">,</span>   <span class="mi">4224</span><span class="p">,</span>   <span class="o">-</span><span class="mi">264</span><span class="p">,</span>    <span class="mi">264</span><span class="p">,</span> <span class="o">-</span><span class="mi">16896</span><span class="p">,</span>  <span class="mi">16896</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1056</span><span class="p">,</span>   <span class="mi">1056</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2112</span><span class="p">,</span>   <span class="mi">2112</span><span class="p">,</span>     <span class="o">-</span><span class="mi">8</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>  <span class="o">-</span><span class="mi">8448</span><span class="p">,</span>   <span class="mi">8448</span><span class="p">,</span>   <span class="o">-</span><span class="mi">528</span><span class="p">,</span>    <span class="mi">528</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">6272</span><span class="p">,</span>   <span class="mi">6272</span><span class="p">,</span>   <span class="o">-</span><span class="mi">392</span><span class="p">,</span>    <span class="mi">392</span><span class="p">,</span> <span class="o">-</span><span class="mi">25088</span><span class="p">,</span>  <span class="mi">25088</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1568</span><span class="p">,</span>   <span class="mi">1568</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3136</span><span class="p">,</span>   <span class="mi">3136</span><span class="p">,</span>   <span class="o">-</span><span class="mi">136</span><span class="p">,</span>    <span class="mi">136</span><span class="p">,</span> <span class="o">-</span><span class="mi">12544</span><span class="p">,</span>  <span class="mi">12544</span><span class="p">,</span>   <span class="o">-</span><span class="mi">784</span><span class="p">,</span>    <span class="mi">784</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">5760</span><span class="p">,</span>   <span class="mi">5760</span><span class="p">,</span>   <span class="o">-</span><span class="mi">360</span><span class="p">,</span>    <span class="mi">360</span><span class="p">,</span> <span class="o">-</span><span class="mi">23040</span><span class="p">,</span>  <span class="mi">23040</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1440</span><span class="p">,</span>   <span class="mi">1440</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2880</span><span class="p">,</span>   <span class="mi">2880</span><span class="p">,</span>   <span class="o">-</span><span class="mi">104</span><span class="p">,</span>    <span class="mi">104</span><span class="p">,</span> <span class="o">-</span><span class="mi">11520</span><span class="p">,</span>  <span class="mi">11520</span><span class="p">,</span>   <span class="o">-</span><span class="mi">720</span><span class="p">,</span>    <span class="mi">720</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">7808</span><span class="p">,</span>   <span class="mi">7808</span><span class="p">,</span>   <span class="o">-</span><span class="mi">488</span><span class="p">,</span>    <span class="mi">488</span><span class="p">,</span> <span class="o">-</span><span class="mi">31232</span><span class="p">,</span>  <span class="mi">31232</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1952</span><span class="p">,</span>   <span class="mi">1952</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3904</span><span class="p">,</span>   <span class="mi">3904</span><span class="p">,</span>   <span class="o">-</span><span class="mi">232</span><span class="p">,</span>    <span class="mi">232</span><span class="p">,</span> <span class="o">-</span><span class="mi">15616</span><span class="p">,</span>  <span class="mi">15616</span><span class="p">,</span>   <span class="o">-</span><span class="mi">976</span><span class="p">,</span>    <span class="mi">976</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4736</span><span class="p">,</span>   <span class="mi">4736</span><span class="p">,</span>   <span class="o">-</span><span class="mi">296</span><span class="p">,</span>    <span class="mi">296</span><span class="p">,</span> <span class="o">-</span><span class="mi">18944</span><span class="p">,</span>  <span class="mi">18944</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1184</span><span class="p">,</span>   <span class="mi">1184</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2368</span><span class="p">,</span>   <span class="mi">2368</span><span class="p">,</span>    <span class="o">-</span><span class="mi">40</span><span class="p">,</span>     <span class="mi">40</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9472</span><span class="p">,</span>   <span class="mi">9472</span><span class="p">,</span>   <span class="o">-</span><span class="mi">592</span><span class="p">,</span>    <span class="mi">592</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">6784</span><span class="p">,</span>   <span class="mi">6784</span><span class="p">,</span>   <span class="o">-</span><span class="mi">424</span><span class="p">,</span>    <span class="mi">424</span><span class="p">,</span> <span class="o">-</span><span class="mi">27136</span><span class="p">,</span>  <span class="mi">27136</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1696</span><span class="p">,</span>   <span class="mi">1696</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">3392</span><span class="p">,</span>   <span class="mi">3392</span><span class="p">,</span>   <span class="o">-</span><span class="mi">168</span><span class="p">,</span>    <span class="mi">168</span><span class="p">,</span> <span class="o">-</span><span class="mi">13568</span><span class="p">,</span>  <span class="mi">13568</span><span class="p">,</span>   <span class="o">-</span><span class="mi">848</span><span class="p">,</span>    <span class="mi">848</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">short</span> <span class="n">capidtmf_expand_table_ulaw</span><span class="p">[</span><span class="mh">0x0100</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="o">-</span><span class="mi">32124</span><span class="p">,</span>  <span class="mi">32124</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1884</span><span class="p">,</span>   <span class="mi">1884</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7932</span><span class="p">,</span>   <span class="mi">7932</span><span class="p">,</span>   <span class="o">-</span><span class="mi">372</span><span class="p">,</span>    <span class="mi">372</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">15996</span><span class="p">,</span>  <span class="mi">15996</span><span class="p">,</span>   <span class="o">-</span><span class="mi">876</span><span class="p">,</span>    <span class="mi">876</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3900</span><span class="p">,</span>   <span class="mi">3900</span><span class="p">,</span>   <span class="o">-</span><span class="mi">120</span><span class="p">,</span>    <span class="mi">120</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">23932</span><span class="p">,</span>  <span class="mi">23932</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1372</span><span class="p">,</span>   <span class="mi">1372</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5884</span><span class="p">,</span>   <span class="mi">5884</span><span class="p">,</span>   <span class="o">-</span><span class="mi">244</span><span class="p">,</span>    <span class="mi">244</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">11900</span><span class="p">,</span>  <span class="mi">11900</span><span class="p">,</span>   <span class="o">-</span><span class="mi">620</span><span class="p">,</span>    <span class="mi">620</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2876</span><span class="p">,</span>   <span class="mi">2876</span><span class="p">,</span>    <span class="o">-</span><span class="mi">56</span><span class="p">,</span>     <span class="mi">56</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">28028</span><span class="p">,</span>  <span class="mi">28028</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1628</span><span class="p">,</span>   <span class="mi">1628</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6908</span><span class="p">,</span>   <span class="mi">6908</span><span class="p">,</span>   <span class="o">-</span><span class="mi">308</span><span class="p">,</span>    <span class="mi">308</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">13948</span><span class="p">,</span>  <span class="mi">13948</span><span class="p">,</span>   <span class="o">-</span><span class="mi">748</span><span class="p">,</span>    <span class="mi">748</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3388</span><span class="p">,</span>   <span class="mi">3388</span><span class="p">,</span>    <span class="o">-</span><span class="mi">88</span><span class="p">,</span>     <span class="mi">88</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">19836</span><span class="p">,</span>  <span class="mi">19836</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1116</span><span class="p">,</span>   <span class="mi">1116</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4860</span><span class="p">,</span>   <span class="mi">4860</span><span class="p">,</span>   <span class="o">-</span><span class="mi">180</span><span class="p">,</span>    <span class="mi">180</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">9852</span><span class="p">,</span>   <span class="mi">9852</span><span class="p">,</span>   <span class="o">-</span><span class="mi">492</span><span class="p">,</span>    <span class="mi">492</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2364</span><span class="p">,</span>   <span class="mi">2364</span><span class="p">,</span>    <span class="o">-</span><span class="mi">24</span><span class="p">,</span>     <span class="mi">24</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">30076</span><span class="p">,</span>  <span class="mi">30076</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1756</span><span class="p">,</span>   <span class="mi">1756</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7420</span><span class="p">,</span>   <span class="mi">7420</span><span class="p">,</span>   <span class="o">-</span><span class="mi">340</span><span class="p">,</span>    <span class="mi">340</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">14972</span><span class="p">,</span>  <span class="mi">14972</span><span class="p">,</span>   <span class="o">-</span><span class="mi">812</span><span class="p">,</span>    <span class="mi">812</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3644</span><span class="p">,</span>   <span class="mi">3644</span><span class="p">,</span>   <span class="o">-</span><span class="mi">104</span><span class="p">,</span>    <span class="mi">104</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">21884</span><span class="p">,</span>  <span class="mi">21884</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1244</span><span class="p">,</span>   <span class="mi">1244</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5372</span><span class="p">,</span>   <span class="mi">5372</span><span class="p">,</span>   <span class="o">-</span><span class="mi">212</span><span class="p">,</span>    <span class="mi">212</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">10876</span><span class="p">,</span>  <span class="mi">10876</span><span class="p">,</span>   <span class="o">-</span><span class="mi">556</span><span class="p">,</span>    <span class="mi">556</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2620</span><span class="p">,</span>   <span class="mi">2620</span><span class="p">,</span>    <span class="o">-</span><span class="mi">40</span><span class="p">,</span>     <span class="mi">40</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">25980</span><span class="p">,</span>  <span class="mi">25980</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1500</span><span class="p">,</span>   <span class="mi">1500</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6396</span><span class="p">,</span>   <span class="mi">6396</span><span class="p">,</span>   <span class="o">-</span><span class="mi">276</span><span class="p">,</span>    <span class="mi">276</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">12924</span><span class="p">,</span>  <span class="mi">12924</span><span class="p">,</span>   <span class="o">-</span><span class="mi">684</span><span class="p">,</span>    <span class="mi">684</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3132</span><span class="p">,</span>   <span class="mi">3132</span><span class="p">,</span>    <span class="o">-</span><span class="mi">72</span><span class="p">,</span>     <span class="mi">72</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">17788</span><span class="p">,</span>  <span class="mi">17788</span><span class="p">,</span>   <span class="o">-</span><span class="mi">988</span><span class="p">,</span>    <span class="mi">988</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4348</span><span class="p">,</span>   <span class="mi">4348</span><span class="p">,</span>   <span class="o">-</span><span class="mi">148</span><span class="p">,</span>    <span class="mi">148</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">8828</span><span class="p">,</span>   <span class="mi">8828</span><span class="p">,</span>   <span class="o">-</span><span class="mi">428</span><span class="p">,</span>    <span class="mi">428</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2108</span><span class="p">,</span>   <span class="mi">2108</span><span class="p">,</span>     <span class="o">-</span><span class="mi">8</span><span class="p">,</span>      <span class="mi">8</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">31100</span><span class="p">,</span>  <span class="mi">31100</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1820</span><span class="p">,</span>   <span class="mi">1820</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7676</span><span class="p">,</span>   <span class="mi">7676</span><span class="p">,</span>   <span class="o">-</span><span class="mi">356</span><span class="p">,</span>    <span class="mi">356</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">15484</span><span class="p">,</span>  <span class="mi">15484</span><span class="p">,</span>   <span class="o">-</span><span class="mi">844</span><span class="p">,</span>    <span class="mi">844</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3772</span><span class="p">,</span>   <span class="mi">3772</span><span class="p">,</span>   <span class="o">-</span><span class="mi">112</span><span class="p">,</span>    <span class="mi">112</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">22908</span><span class="p">,</span>  <span class="mi">22908</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1308</span><span class="p">,</span>   <span class="mi">1308</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5628</span><span class="p">,</span>   <span class="mi">5628</span><span class="p">,</span>   <span class="o">-</span><span class="mi">228</span><span class="p">,</span>    <span class="mi">228</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">11388</span><span class="p">,</span>  <span class="mi">11388</span><span class="p">,</span>   <span class="o">-</span><span class="mi">588</span><span class="p">,</span>    <span class="mi">588</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2748</span><span class="p">,</span>   <span class="mi">2748</span><span class="p">,</span>    <span class="o">-</span><span class="mi">48</span><span class="p">,</span>     <span class="mi">48</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">27004</span><span class="p">,</span>  <span class="mi">27004</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1564</span><span class="p">,</span>   <span class="mi">1564</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6652</span><span class="p">,</span>   <span class="mi">6652</span><span class="p">,</span>   <span class="o">-</span><span class="mi">292</span><span class="p">,</span>    <span class="mi">292</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">13436</span><span class="p">,</span>  <span class="mi">13436</span><span class="p">,</span>   <span class="o">-</span><span class="mi">716</span><span class="p">,</span>    <span class="mi">716</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3260</span><span class="p">,</span>   <span class="mi">3260</span><span class="p">,</span>    <span class="o">-</span><span class="mi">80</span><span class="p">,</span>     <span class="mi">80</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">18812</span><span class="p">,</span>  <span class="mi">18812</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1052</span><span class="p">,</span>   <span class="mi">1052</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4604</span><span class="p">,</span>   <span class="mi">4604</span><span class="p">,</span>   <span class="o">-</span><span class="mi">164</span><span class="p">,</span>    <span class="mi">164</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">9340</span><span class="p">,</span>   <span class="mi">9340</span><span class="p">,</span>   <span class="o">-</span><span class="mi">460</span><span class="p">,</span>    <span class="mi">460</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2236</span><span class="p">,</span>   <span class="mi">2236</span><span class="p">,</span>    <span class="o">-</span><span class="mi">16</span><span class="p">,</span>     <span class="mi">16</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">29052</span><span class="p">,</span>  <span class="mi">29052</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1692</span><span class="p">,</span>   <span class="mi">1692</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7164</span><span class="p">,</span>   <span class="mi">7164</span><span class="p">,</span>   <span class="o">-</span><span class="mi">324</span><span class="p">,</span>    <span class="mi">324</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">14460</span><span class="p">,</span>  <span class="mi">14460</span><span class="p">,</span>   <span class="o">-</span><span class="mi">780</span><span class="p">,</span>    <span class="mi">780</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3516</span><span class="p">,</span>   <span class="mi">3516</span><span class="p">,</span>    <span class="o">-</span><span class="mi">96</span><span class="p">,</span>     <span class="mi">96</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">20860</span><span class="p">,</span>  <span class="mi">20860</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1180</span><span class="p">,</span>   <span class="mi">1180</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5116</span><span class="p">,</span>   <span class="mi">5116</span><span class="p">,</span>   <span class="o">-</span><span class="mi">196</span><span class="p">,</span>    <span class="mi">196</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">10364</span><span class="p">,</span>  <span class="mi">10364</span><span class="p">,</span>   <span class="o">-</span><span class="mi">524</span><span class="p">,</span>    <span class="mi">524</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2492</span><span class="p">,</span>   <span class="mi">2492</span><span class="p">,</span>    <span class="o">-</span><span class="mi">32</span><span class="p">,</span>     <span class="mi">32</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">24956</span><span class="p">,</span>  <span class="mi">24956</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1436</span><span class="p">,</span>   <span class="mi">1436</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6140</span><span class="p">,</span>   <span class="mi">6140</span><span class="p">,</span>   <span class="o">-</span><span class="mi">260</span><span class="p">,</span>    <span class="mi">260</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">12412</span><span class="p">,</span>  <span class="mi">12412</span><span class="p">,</span>   <span class="o">-</span><span class="mi">652</span><span class="p">,</span>    <span class="mi">652</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3004</span><span class="p">,</span>   <span class="mi">3004</span><span class="p">,</span>    <span class="o">-</span><span class="mi">64</span><span class="p">,</span>     <span class="mi">64</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">16764</span><span class="p">,</span>  <span class="mi">16764</span><span class="p">,</span>   <span class="o">-</span><span class="mi">924</span><span class="p">,</span>    <span class="mi">924</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4092</span><span class="p">,</span>   <span class="mi">4092</span><span class="p">,</span>   <span class="o">-</span><span class="mi">132</span><span class="p">,</span>    <span class="mi">132</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">8316</span><span class="p">,</span>   <span class="mi">8316</span><span class="p">,</span>   <span class="o">-</span><span class="mi">396</span><span class="p">,</span>    <span class="mi">396</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1980</span><span class="p">,</span>   <span class="mi">1980</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span>
<span class="p">};</span>


<span class="cm">/*---------------------------------------------------------------------------*/</span>

<span class="k">static</span> <span class="kt">short</span> <span class="n">capidtmf_recv_window_function</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_ACCUMULATE_CYCLES</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="o">-</span><span class="mi">500L</span><span class="p">,</span>   <span class="o">-</span><span class="mi">999L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1499L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1998L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2496L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2994L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3491L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3988L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">4483L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4978L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5471L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5963L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6454L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6943L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7431L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7917L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">8401L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">8883L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9363L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9840L</span><span class="p">,</span> <span class="o">-</span><span class="mi">10316L</span><span class="p">,</span> <span class="o">-</span><span class="mi">10789L</span><span class="p">,</span> <span class="o">-</span><span class="mi">11259L</span><span class="p">,</span> <span class="o">-</span><span class="mi">11727L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">12193L</span><span class="p">,</span> <span class="o">-</span><span class="mi">12655L</span><span class="p">,</span> <span class="o">-</span><span class="mi">13115L</span><span class="p">,</span> <span class="o">-</span><span class="mi">13571L</span><span class="p">,</span> <span class="o">-</span><span class="mi">14024L</span><span class="p">,</span> <span class="o">-</span><span class="mi">14474L</span><span class="p">,</span> <span class="o">-</span><span class="mi">14921L</span><span class="p">,</span> <span class="o">-</span><span class="mi">15364L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">15804L</span><span class="p">,</span> <span class="o">-</span><span class="mi">16240L</span><span class="p">,</span> <span class="o">-</span><span class="mi">16672L</span><span class="p">,</span> <span class="o">-</span><span class="mi">17100L</span><span class="p">,</span> <span class="o">-</span><span class="mi">17524L</span><span class="p">,</span> <span class="o">-</span><span class="mi">17944L</span><span class="p">,</span> <span class="o">-</span><span class="mi">18360L</span><span class="p">,</span> <span class="o">-</span><span class="mi">18772L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">19180L</span><span class="p">,</span> <span class="o">-</span><span class="mi">19583L</span><span class="p">,</span> <span class="o">-</span><span class="mi">19981L</span><span class="p">,</span> <span class="o">-</span><span class="mi">20375L</span><span class="p">,</span> <span class="o">-</span><span class="mi">20764L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21148L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21527L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21901L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">22270L</span><span class="p">,</span> <span class="o">-</span><span class="mi">22634L</span><span class="p">,</span> <span class="o">-</span><span class="mi">22993L</span><span class="p">,</span> <span class="o">-</span><span class="mi">23346L</span><span class="p">,</span> <span class="o">-</span><span class="mi">23694L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24037L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24374L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24705L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">25030L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25350L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25664L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25971L</span><span class="p">,</span> <span class="o">-</span><span class="mi">26273L</span><span class="p">,</span> <span class="o">-</span><span class="mi">26568L</span><span class="p">,</span> <span class="o">-</span><span class="mi">26858L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27141L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">27418L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27688L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27952L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28210L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28461L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28705L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28943L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29174L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">29398L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29615L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29826L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30029L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30226L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30415L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30598L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30773L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">30941L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31102L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31256L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31402L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31541L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31673L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31797L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31914L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">32024L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32126L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32221L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32308L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32388L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32460L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32524L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32581L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">32631L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32673L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32707L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32734L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32753L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32764L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32764L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">32753L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32734L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32707L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32673L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32631L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32581L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32524L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32460L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">32388L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32308L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32221L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32126L</span><span class="p">,</span> <span class="o">-</span><span class="mi">32024L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31914L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31797L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31673L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">31541L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31402L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31256L</span><span class="p">,</span> <span class="o">-</span><span class="mi">31102L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30941L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30773L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30598L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30415L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">30226L</span><span class="p">,</span> <span class="o">-</span><span class="mi">30029L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29826L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29615L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29398L</span><span class="p">,</span> <span class="o">-</span><span class="mi">29174L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28943L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28705L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">28461L</span><span class="p">,</span> <span class="o">-</span><span class="mi">28210L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27952L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27688L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27418L</span><span class="p">,</span> <span class="o">-</span><span class="mi">27141L</span><span class="p">,</span> <span class="o">-</span><span class="mi">26858L</span><span class="p">,</span> <span class="o">-</span><span class="mi">26568L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">26273L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25971L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25664L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25350L</span><span class="p">,</span> <span class="o">-</span><span class="mi">25030L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24705L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24374L</span><span class="p">,</span> <span class="o">-</span><span class="mi">24037L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">23694L</span><span class="p">,</span> <span class="o">-</span><span class="mi">23346L</span><span class="p">,</span> <span class="o">-</span><span class="mi">22993L</span><span class="p">,</span> <span class="o">-</span><span class="mi">22634L</span><span class="p">,</span> <span class="o">-</span><span class="mi">22270L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21901L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21527L</span><span class="p">,</span> <span class="o">-</span><span class="mi">21148L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">20764L</span><span class="p">,</span> <span class="o">-</span><span class="mi">20375L</span><span class="p">,</span> <span class="o">-</span><span class="mi">19981L</span><span class="p">,</span> <span class="o">-</span><span class="mi">19583L</span><span class="p">,</span> <span class="o">-</span><span class="mi">19180L</span><span class="p">,</span> <span class="o">-</span><span class="mi">18772L</span><span class="p">,</span> <span class="o">-</span><span class="mi">18360L</span><span class="p">,</span> <span class="o">-</span><span class="mi">17944L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">17524L</span><span class="p">,</span> <span class="o">-</span><span class="mi">17100L</span><span class="p">,</span> <span class="o">-</span><span class="mi">16672L</span><span class="p">,</span> <span class="o">-</span><span class="mi">16240L</span><span class="p">,</span> <span class="o">-</span><span class="mi">15804L</span><span class="p">,</span> <span class="o">-</span><span class="mi">15364L</span><span class="p">,</span> <span class="o">-</span><span class="mi">14921L</span><span class="p">,</span> <span class="o">-</span><span class="mi">14474L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">14024L</span><span class="p">,</span> <span class="o">-</span><span class="mi">13571L</span><span class="p">,</span> <span class="o">-</span><span class="mi">13115L</span><span class="p">,</span> <span class="o">-</span><span class="mi">12655L</span><span class="p">,</span> <span class="o">-</span><span class="mi">12193L</span><span class="p">,</span> <span class="o">-</span><span class="mi">11727L</span><span class="p">,</span> <span class="o">-</span><span class="mi">11259L</span><span class="p">,</span> <span class="o">-</span><span class="mi">10789L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">10316L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9840L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">9363L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">8883L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">8401L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7917L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">7431L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">6943L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">6454L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5963L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">5471L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4978L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">4483L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3988L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">3491L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">2994L</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2496L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1998L</span><span class="p">,</span>  <span class="o">-</span><span class="mi">1499L</span><span class="p">,</span>   <span class="o">-</span><span class="mi">999L</span><span class="p">,</span>   <span class="o">-</span><span class="mi">500L</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">byte</span> <span class="n">capidtmf_leading_zeroes_table</span><span class="p">[</span><span class="mh">0x100</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="cp">#define capidtmf_byte_leading_zeroes(b)  (capidtmf_leading_zeroes_table[(BYTE)(b)])</span>
<span class="cp">#define capidtmf_word_leading_zeroes(w)  (((w) &amp; 0xff00) ? capidtmf_leading_zeroes_table[(w) &gt;&gt; 8] : 8 + capidtmf_leading_zeroes_table[(w)])</span>
<span class="cp">#define capidtmf_dword_leading_zeroes(d)  (((d) &amp; 0xffff0000L) ?    (((d) &amp; 0xff000000L) ? capidtmf_leading_zeroes_table[(d) &gt;&gt; 24] : 8 + capidtmf_leading_zeroes_table[(d) &gt;&gt; 16]) :    (((d) &amp; 0xff00) ? 16 + capidtmf_leading_zeroes_table[(d) &gt;&gt; 8] : 24 + capidtmf_leading_zeroes_table[(d)]))</span>


<span class="cm">/*---------------------------------------------------------------------------*/</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">capidtmf_goertzel_loop</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">long</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">,</span> <span class="kt">short</span> <span class="o">*</span><span class="n">sample</span><span class="p">,</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q0</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">q1</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">q2</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">];</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">q0</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
				<span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
				<span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">;</span>
			<span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">q0</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">-</span> <span class="p">((</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">));</span>
				<span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
				<span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
		<span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span> <span class="n">q2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">q1</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="n">q2</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">];</span>
	<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">q0</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)(</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
			<span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
			<span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span><span class="p">;</span>
			<span class="n">c</span> <span class="o">-=</span> <span class="n">CAPIDTMF_RECV_FUNDAMENTAL_DECREMENT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">q0</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">q2</span> <span class="o">-</span> <span class="p">((</span><span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)(</span><span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">));</span>
			<span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
			<span class="n">q1</span> <span class="o">=</span> <span class="n">q0</span><span class="p">;</span>
			<span class="n">c</span> <span class="o">+=</span> <span class="n">CAPIDTMF_RECV_FUNDAMENTAL_DECREMENT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
	<span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">q1</span><span class="p">;</span>
	<span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span> <span class="n">q2</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">capidtmf_goertzel_result</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">long</span> <span class="o">*</span><span class="n">coeffs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">mid</span><span class="p">,</span> <span class="n">hi</span><span class="p">;</span>
	<span class="n">dword</span> <span class="n">k</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">q1</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">q2</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">];</span>
		<span class="n">d</span> <span class="o">=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="o">-</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">d</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">d</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">q1</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">+</span> <span class="p">(((</span><span class="n">dword</span><span class="p">)(((</span><span class="n">dword</span><span class="p">)</span> <span class="o">-</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="o">-</span><span class="n">q1</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
		<span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">q2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">q2</span> <span class="o">:</span> <span class="o">-</span><span class="n">q2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
			<span class="n">lo</span> <span class="o">=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">mid</span> <span class="o">=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
			<span class="n">mid</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">mid</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">+=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span><span class="p">;</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
			<span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
			<span class="n">mid</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
			<span class="n">mid</span> <span class="o">-=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">mid</span> <span class="o">-=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">-=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">-=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">q2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="n">lo</span><span class="p">;</span>
			<span class="n">mid</span> <span class="o">=</span> <span class="o">-</span><span class="n">mid</span><span class="p">;</span>
			<span class="n">hi</span> <span class="o">=</span> <span class="o">-</span><span class="n">hi</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">q1</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">q1</span> <span class="o">:</span> <span class="o">-</span><span class="n">q1</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
		<span class="n">lo</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
		<span class="n">mid</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
		<span class="n">mid</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">hi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">hi</span> <span class="o">+=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">q2</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">q2</span> <span class="o">:</span> <span class="o">-</span><span class="n">q2</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
		<span class="n">lo</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
		<span class="n">mid</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">));</span>
		<span class="n">mid</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">hi</span> <span class="o">+=</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">hi</span> <span class="o">+=</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">))</span> <span class="o">*</span> <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">d</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
		<span class="n">mid</span> <span class="o">+=</span> <span class="n">lo</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">hi</span> <span class="o">+=</span> <span class="n">mid</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lo</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">mid</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
		<span class="n">buffer</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span> <span class="n">hi</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*---------------------------------------------------------------------------*/</span>

<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_697     0</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_770     1</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_852     2</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_941     3</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1209    4</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1336    5</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1477    6</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1633    7</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_635     8</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1010    9</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1140    10</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1272    11</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1405    12</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1555    13</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1715    14</span>
<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_INDEX_1875    15</span>

<span class="cp">#define CAPIDTMF_RECV_GUARD_SNR_DONTCARE      0xc000</span>
<span class="cp">#define CAPIDTMF_RECV_NO_DIGIT                0xff</span>
<span class="cp">#define CAPIDTMF_RECV_TIME_GRANULARITY        (CAPIDTMF_RECV_ACCUMULATE_CYCLES + 1)</span>

<span class="cp">#define CAPIDTMF_RECV_INDICATION_DIGIT        0x0001</span>

<span class="k">static</span> <span class="kt">long</span> <span class="n">capidtmf_recv_goertzel_coef_table</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mh">0xda97L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 697 Hz (Low group 697 Hz) */</span>
	<span class="mh">0xd299L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 770 Hz (Low group 770 Hz) */</span>
	<span class="mh">0xc8cbL</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 852 Hz (Low group 852 Hz) */</span>
	<span class="mh">0xbd36L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 941 Hz (Low group 941 Hz) */</span>
	<span class="mh">0x9501L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1209 Hz (High group 1209 Hz) */</span>
	<span class="mh">0x7f89L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1336 Hz (High group 1336 Hz) */</span>
	<span class="mh">0x6639L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1477 Hz (High group 1477 Hz) */</span>
	<span class="mh">0x48c6L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1633 Hz (High group 1633 Hz) */</span>
	<span class="mh">0xe14cL</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 630 Hz (Lower guard of low group 631 Hz) */</span>
	<span class="mh">0xb2e0L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1015 Hz (Upper guard of low group 1039 Hz) */</span>
	<span class="mh">0xa1a0L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1130 Hz (Lower guard of high group 1140 Hz) */</span>
	<span class="mh">0x8a87L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1272 Hz (Guard between 1209 Hz and 1336 Hz: 1271 Hz) */</span>
	<span class="mh">0x7353L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1405 Hz (2nd harmonics of 697 Hz and guard between 1336 Hz and 1477 Hz: 1405 Hz) */</span>
	<span class="mh">0x583bL</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1552 Hz (2nd harmonics of 770 Hz and guard between 1477 Hz and 1633 Hz: 1553 Hz) */</span>
	<span class="mh">0x37d8L</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* 1720 Hz (2nd harmonics of 852 Hz and upper guard of high group: 1715 Hz) */</span>
	<span class="mh">0x0000L</span> <span class="o">*</span> <span class="mi">2</span>   <span class="cm">/* 100-630 Hz (fundamentals) */</span>
<span class="p">};</span>


<span class="k">static</span> <span class="n">word</span> <span class="n">capidtmf_recv_guard_snr_low_table</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="mi">14</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 697 Hz */</span>
	<span class="mi">14</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 770 Hz */</span>
	<span class="mi">16</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 852 Hz */</span>
	<span class="mi">16</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 941 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1209 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1336 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1477 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1633 Hz */</span>
	<span class="mi">14</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 635 Hz */</span>
	<span class="mi">16</span><span class="p">,</span>                                    <span class="cm">/* Low group peak versus 1010 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1140 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* Low group peak versus 1272 Hz */</span>
	<span class="n">DSPDTMF_RX_HARMONICS_SEL_DEFAULT</span> <span class="o">-</span> <span class="mi">8</span><span class="p">,</span>  <span class="cm">/* Low group peak versus 1405 Hz */</span>
	<span class="n">DSPDTMF_RX_HARMONICS_SEL_DEFAULT</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>  <span class="cm">/* Low group peak versus 1555 Hz */</span>
	<span class="n">DSPDTMF_RX_HARMONICS_SEL_DEFAULT</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span>  <span class="cm">/* Low group peak versus 1715 Hz */</span>
	<span class="mi">12</span>                                     <span class="cm">/* Low group peak versus 100-630 Hz */</span>
<span class="p">};</span>


<span class="k">static</span> <span class="n">word</span> <span class="n">capidtmf_recv_guard_snr_high_table</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 697 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 770 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 852 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 941 Hz */</span>
	<span class="mi">20</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1209 Hz */</span>
	<span class="mi">20</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1336 Hz */</span>
	<span class="mi">20</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1477 Hz */</span>
	<span class="mi">20</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1633 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 635 Hz */</span>
	<span class="n">CAPIDTMF_RECV_GUARD_SNR_DONTCARE</span><span class="p">,</span>      <span class="cm">/* High group peak versus 1010 Hz */</span>
	<span class="mi">16</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1140 Hz */</span>
	<span class="mi">4</span><span class="p">,</span>                                     <span class="cm">/* High group peak versus 1272 Hz */</span>
	<span class="mi">6</span><span class="p">,</span>                                     <span class="cm">/* High group peak versus 1405 Hz */</span>
	<span class="mi">8</span><span class="p">,</span>                                     <span class="cm">/* High group peak versus 1555 Hz */</span>
	<span class="mi">16</span><span class="p">,</span>                                    <span class="cm">/* High group peak versus 1715 Hz */</span>
	<span class="mi">12</span>                                     <span class="cm">/* High group peak versus 100-630 Hz */</span>
<span class="p">};</span>


<span class="cm">/*---------------------------------------------------------------------------*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">capidtmf_recv_init</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">cycle_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_value</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>

	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_read_pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_STATE_IDLE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">capidtmf_recv_enable</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">,</span> <span class="n">word</span> <span class="n">min_digit_duration</span><span class="p">,</span> <span class="n">word</span> <span class="n">min_gap_duration</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span> <span class="o">&amp;=</span> <span class="n">CAPIDTMF_RECV_INDICATION_DIGIT</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">word</span><span class="p">)(((((</span><span class="n">dword</span><span class="p">)</span> <span class="n">min_digit_duration</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
						   <span class="p">((</span><span class="n">dword</span><span class="p">)(</span><span class="n">CAPIDTMF_RECV_TIME_GRANULARITY</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span> <span class="o">/</span> <span class="p">((</span><span class="n">dword</span><span class="p">)</span> <span class="n">CAPIDTMF_RECV_TIME_GRANULARITY</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">word</span><span class="p">)((((</span><span class="n">dword</span><span class="p">)</span> <span class="n">min_gap_duration</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">dword</span><span class="p">)</span> <span class="n">CAPIDTMF_RECV_TIME_GRANULARITY</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">state</span> <span class="o">|=</span> <span class="n">CAPIDTMF_RECV_STATE_DTMF_ACTIVE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">capidtmf_recv_disable</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">state</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CAPIDTMF_RECV_STATE_DTMF_ACTIVE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">CAPIDTMF_RECV_STATE_IDLE</span><span class="p">)</span>
		<span class="n">capidtmf_recv_init</span><span class="p">(</span><span class="n">p_state</span><span class="p">);</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">cycle_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_value</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="n">word</span> <span class="nf">capidtmf_recv_indication</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">,</span> <span class="n">byte</span> <span class="o">*</span><span class="n">buffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">word</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">flags</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state</span> <span class="o">^</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span><span class="p">;</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span> <span class="o">^=</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CAPIDTMF_RECV_INDICATION_DIGIT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span> <span class="o">!=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_read_pos</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span><span class="p">;</span>
		<span class="n">j</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_read_pos</span><span class="p">;</span>
		<span class="k">do</span>
		<span class="p">{</span>
			<span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_buffer</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">==</span> <span class="n">CAPIDTMF_RECV_DIGIT_BUFFER_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">k</span><span class="p">);</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_read_pos</span> <span class="o">=</span> <span class="n">k</span><span class="p">;</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span> <span class="o">^=</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>


<span class="cp">#define CAPIDTMF_RECV_WINDOWED_SAMPLES  32</span>

<span class="kt">void</span> <span class="nf">capidtmf_recv_block</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">,</span> <span class="n">byte</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">word</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">byte</span> <span class="n">result_digit</span><span class="p">;</span>
	<span class="n">word</span> <span class="n">sample_number</span><span class="p">,</span> <span class="n">cycle_counter</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">word</span> <span class="n">low_peak</span><span class="p">,</span> <span class="n">high_peak</span><span class="p">;</span>
	<span class="n">dword</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">;</span>
	<span class="n">byte</span>   <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">short</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
	<span class="n">byte</span> <span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">];</span>
	<span class="kt">short</span> <span class="n">windowed_sample_buffer</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_WINDOWED_SAMPLES</span><span class="p">];</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">state</span> <span class="o">&amp;</span> <span class="n">CAPIDTMF_RECV_STATE_DTMF_ACTIVE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">cycle_counter</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">cycle_counter</span><span class="p">;</span>
		<span class="n">sample_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">sample_number</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cycle_counter</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_ACCUMULATE_CYCLES</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">cycle_counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="n">n</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_ACCUMULATE_CYCLES</span> <span class="o">-</span> <span class="n">cycle_counter</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">length</span> <span class="o">-</span> <span class="n">sample_number</span><span class="p">)</span>
					<span class="n">n</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="n">sample_number</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">CAPIDTMF_RECV_WINDOWED_SAMPLES</span><span class="p">)</span>
					<span class="n">n</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_WINDOWED_SAMPLES</span><span class="p">;</span>
				<span class="n">p</span> <span class="o">=</span> <span class="n">buffer</span> <span class="o">+</span> <span class="n">sample_number</span><span class="p">;</span>
				<span class="n">q</span> <span class="o">=</span> <span class="n">capidtmf_recv_window_function</span> <span class="o">+</span> <span class="n">cycle_counter</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">ulaw</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">windowed_sample_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">(</span><span class="kt">short</span><span class="p">)((</span><span class="n">capidtmf_expand_table_ulaw</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">windowed_sample_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">(</span><span class="kt">short</span><span class="p">)((</span><span class="n">capidtmf_expand_table_alaw</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span> <span class="o">&gt;&gt;</span> <span class="mi">15</span><span class="p">);</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="n">capidtmf_recv_goertzel_coef_table</span><span class="p">[</span><span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_FUNDAMENTAL_OFFSET</span><span class="p">;</span>
				<span class="n">capidtmf_goertzel_loop</span><span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
						       <span class="n">capidtmf_recv_goertzel_coef_table</span><span class="p">,</span> <span class="n">windowed_sample_buffer</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
				<span class="n">cycle_counter</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
				<span class="n">sample_number</span> <span class="o">+=</span> <span class="n">n</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="n">capidtmf_goertzel_result</span><span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
							 <span class="n">capidtmf_recv_goertzel_coef_table</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">lo</span> <span class="o">=</span> <span class="p">(</span><span class="n">dword</span><span class="p">)(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
					<span class="n">hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">dword</span><span class="p">)(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">goertzel_buffer</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]);</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">n</span> <span class="o">=</span> <span class="n">capidtmf_dword_leading_zeroes</span><span class="p">(</span><span class="n">hi</span><span class="p">);</span>
						<span class="n">hi</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lo</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span> <span class="n">n</span><span class="p">));</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span>
						<span class="n">n</span> <span class="o">=</span> <span class="n">capidtmf_dword_leading_zeroes</span><span class="p">(</span><span class="n">lo</span><span class="p">);</span>
						<span class="n">hi</span> <span class="o">=</span> <span class="n">lo</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span>
						<span class="n">n</span> <span class="o">+=</span> <span class="mi">32</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="n">n</span> <span class="o">=</span> <span class="mi">195</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">n</span><span class="p">;</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">&gt;=</span> <span class="mh">0xcb300000L</span><span class="p">)</span>
						<span class="n">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
					<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hi</span> <span class="o">&gt;=</span> <span class="mh">0xa1450000L</span><span class="p">)</span>
						<span class="n">n</span><span class="o">++</span><span class="p">;</span>
					<span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="n">n</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">low_peak</span> <span class="o">=</span> <span class="n">DSPDTMF_RX_SENSITIVITY_LOW_DEFAULT</span><span class="p">;</span>
				<span class="n">result_digit</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_LOW_GROUP_FREQUENCIES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">low_peak</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">low_peak</span> <span class="o">=</span> <span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
						<span class="n">result_digit</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="n">high_peak</span> <span class="o">=</span> <span class="n">DSPDTMF_RX_SENSITIVITY_HIGH_DEFAULT</span><span class="p">;</span>
				<span class="n">n</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">CAPIDTMF_LOW_GROUP_FREQUENCIES</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_BASE_FREQUENCY_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">high_peak</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">high_peak</span> <span class="o">=</span> <span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
						<span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">CAPIDTMF_LOW_GROUP_FREQUENCIES</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="n">result_digit</span> <span class="o">|=</span> <span class="p">(</span><span class="n">byte</span><span class="p">)</span> <span class="n">n</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">low_peak</span> <span class="o">+</span> <span class="n">DSPDTMF_RX_HIGH_EXCEEDING_LOW_DEFAULT</span> <span class="o">&lt;</span> <span class="n">high_peak</span><span class="p">)</span>
					<span class="n">result_digit</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">high_peak</span> <span class="o">+</span> <span class="n">DSPDTMF_RX_LOW_EXCEEDING_HIGH_DEFAULT</span> <span class="o">&lt;</span> <span class="n">low_peak</span><span class="p">)</span>
					<span class="n">result_digit</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>
				<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CAPIDTMF_RECV_TOTAL_FREQUENCY_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">((((</span><span class="kt">short</span><span class="p">)(</span><span class="n">low_peak</span> <span class="o">-</span> <span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">capidtmf_recv_guard_snr_low_table</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
					    <span class="o">||</span> <span class="p">(((</span><span class="kt">short</span><span class="p">)(</span><span class="n">high_peak</span> <span class="o">-</span> <span class="n">goertzel_result_buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">capidtmf_recv_guard_snr_high_table</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
					<span class="p">{</span>
						<span class="n">n</span><span class="o">++</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
					<span class="n">result_digit</span> <span class="o">=</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">result_digit</span> <span class="o">==</span> <span class="n">CAPIDTMF_RECV_NO_DIGIT</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_gap_duration</span><span class="p">)</span>
						<span class="p">{</span>
							<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
							<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
							<span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="k">if</span> <span class="p">((</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
					<span class="p">{</span>
						<span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span>
						<span class="n">n</span> <span class="o">=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">((</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
						    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">result_digit</span> <span class="o">!=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_value</span><span class="p">))</span>
						<span class="p">{</span>
							<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
							<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_value</span> <span class="o">=</span> <span class="n">result_digit</span><span class="p">;</span>
						<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_off_time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">!=</span> <span class="mh">0xffff</span><span class="p">)</span>
						<span class="p">{</span>
							<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">+=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
							<span class="k">if</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">&gt;=</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">min_digit_duration</span><span class="p">)</span>
							<span class="p">{</span>
								<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">current_digit_on_time</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
								<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span> <span class="o">==</span> <span class="n">CAPIDTMF_RECV_DIGIT_BUFFER_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span>
									<span class="mi">0</span> <span class="o">:</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
								<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_read_pos</span><span class="p">)</span>
								<span class="p">{</span>
									<span class="n">trace</span><span class="p">(</span><span class="n">dprintf</span><span class="p">(</span><span class="s">&quot;%s,%d: Receive digit overrun&quot;</span><span class="p">,</span>
										      <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">FILE_</span><span class="p">),</span> <span class="n">__LINE__</span><span class="p">));</span>
								<span class="p">}</span>
								<span class="k">else</span>
								<span class="p">{</span>
									<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_buffer</span><span class="p">[</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_digit</span><span class="p">;</span>
									<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">digit_write_pos</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
									<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state</span> <span class="o">=</span>
										<span class="p">(</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">CAPIDTMF_RECV_INDICATION_DIGIT</span><span class="p">)</span> <span class="o">|</span>
										<span class="p">(</span><span class="o">~</span><span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">indication_state_ack</span> <span class="o">&amp;</span> <span class="n">CAPIDTMF_RECV_INDICATION_DIGIT</span><span class="p">);</span>
								<span class="p">}</span>
							<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="n">cycle_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">sample_number</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">recv</span><span class="p">.</span><span class="n">cycle_counter</span> <span class="o">=</span> <span class="n">cycle_counter</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">capidtmf_init</span><span class="p">(</span><span class="n">t_capidtmf_state</span> <span class="o">*</span><span class="n">p_state</span><span class="p">,</span> <span class="n">byte</span> <span class="n">ulaw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p_state</span><span class="o">-&gt;</span><span class="n">ulaw</span> <span class="o">=</span> <span class="n">ulaw</span><span class="p">;</span>
	<span class="n">capidtmf_recv_init</span><span class="p">(</span><span class="n">p_state</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/*---------------------------------------------------------------------------*/</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
