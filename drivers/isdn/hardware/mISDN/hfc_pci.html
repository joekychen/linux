<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › isdn › hardware › mISDN › hfc_pci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>hfc_pci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  specific defines for CCD&#39;s HFC 2BDS0 PCI chips</span>
<span class="cm"> *</span>
<span class="cm"> * Author     Werner Cornelius (werner@isdn4linux.de)</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1999  by Werner Cornelius (werner@isdn4linux.de)</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * thresholds for transparent B-channel mode</span>
<span class="cm"> * change mask and threshold simultaneously</span>
<span class="cm"> */</span>
<span class="cp">#define HFCPCI_BTRANS_THRESHOLD 128</span>
<span class="cp">#define HFCPCI_FILLEMPTY	64</span>
<span class="cp">#define HFCPCI_BTRANS_THRESMASK 0x00</span>

<span class="cm">/* defines for PCI config */</span>
<span class="cp">#define PCI_ENA_MEMIO		0x02</span>
<span class="cp">#define PCI_ENA_MASTER		0x04</span>

<span class="cm">/* GCI/IOM bus monitor registers */</span>
<span class="cp">#define HCFPCI_C_I		0x08</span>
<span class="cp">#define HFCPCI_TRxR		0x0C</span>
<span class="cp">#define HFCPCI_MON1_D		0x28</span>
<span class="cp">#define HFCPCI_MON2_D		0x2C</span>

<span class="cm">/* GCI/IOM bus timeslot registers */</span>
<span class="cp">#define HFCPCI_B1_SSL		0x80</span>
<span class="cp">#define HFCPCI_B2_SSL		0x84</span>
<span class="cp">#define HFCPCI_AUX1_SSL		0x88</span>
<span class="cp">#define HFCPCI_AUX2_SSL		0x8C</span>
<span class="cp">#define HFCPCI_B1_RSL		0x90</span>
<span class="cp">#define HFCPCI_B2_RSL		0x94</span>
<span class="cp">#define HFCPCI_AUX1_RSL		0x98</span>
<span class="cp">#define HFCPCI_AUX2_RSL		0x9C</span>

<span class="cm">/* GCI/IOM bus data registers */</span>
<span class="cp">#define HFCPCI_B1_D		0xA0</span>
<span class="cp">#define HFCPCI_B2_D		0xA4</span>
<span class="cp">#define HFCPCI_AUX1_D		0xA8</span>
<span class="cp">#define HFCPCI_AUX2_D		0xAC</span>

<span class="cm">/* GCI/IOM bus configuration registers */</span>
<span class="cp">#define HFCPCI_MST_EMOD		0xB4</span>
<span class="cp">#define HFCPCI_MST_MODE		0xB8</span>
<span class="cp">#define HFCPCI_CONNECT		0xBC</span>


<span class="cm">/* Interrupt and status registers */</span>
<span class="cp">#define HFCPCI_FIFO_EN		0x44</span>
<span class="cp">#define HFCPCI_TRM		0x48</span>
<span class="cp">#define HFCPCI_B_MODE		0x4C</span>
<span class="cp">#define HFCPCI_CHIP_ID		0x58</span>
<span class="cp">#define HFCPCI_CIRM		0x60</span>
<span class="cp">#define HFCPCI_CTMT		0x64</span>
<span class="cp">#define HFCPCI_INT_M1		0x68</span>
<span class="cp">#define HFCPCI_INT_M2		0x6C</span>
<span class="cp">#define HFCPCI_INT_S1		0x78</span>
<span class="cp">#define HFCPCI_INT_S2		0x7C</span>
<span class="cp">#define HFCPCI_STATUS		0x70</span>

<span class="cm">/* S/T section registers */</span>
<span class="cp">#define HFCPCI_STATES		0xC0</span>
<span class="cp">#define HFCPCI_SCTRL		0xC4</span>
<span class="cp">#define HFCPCI_SCTRL_E		0xC8</span>
<span class="cp">#define HFCPCI_SCTRL_R		0xCC</span>
<span class="cp">#define HFCPCI_SQ		0xD0</span>
<span class="cp">#define HFCPCI_CLKDEL		0xDC</span>
<span class="cp">#define HFCPCI_B1_REC		0xF0</span>
<span class="cp">#define HFCPCI_B1_SEND		0xF0</span>
<span class="cp">#define HFCPCI_B2_REC		0xF4</span>
<span class="cp">#define HFCPCI_B2_SEND		0xF4</span>
<span class="cp">#define HFCPCI_D_REC		0xF8</span>
<span class="cp">#define HFCPCI_D_SEND		0xF8</span>
<span class="cp">#define HFCPCI_E_REC		0xFC</span>


<span class="cm">/* bits in status register (READ) */</span>
<span class="cp">#define HFCPCI_PCI_PROC		0x02</span>
<span class="cp">#define HFCPCI_NBUSY		0x04</span>
<span class="cp">#define HFCPCI_TIMER_ELAP	0x10</span>
<span class="cp">#define HFCPCI_STATINT		0x20</span>
<span class="cp">#define HFCPCI_FRAMEINT		0x40</span>
<span class="cp">#define HFCPCI_ANYINT		0x80</span>

<span class="cm">/* bits in CTMT (Write) */</span>
<span class="cp">#define HFCPCI_CLTIMER		0x80</span>
<span class="cp">#define HFCPCI_TIM3_125		0x04</span>
<span class="cp">#define HFCPCI_TIM25		0x10</span>
<span class="cp">#define HFCPCI_TIM50		0x14</span>
<span class="cp">#define HFCPCI_TIM400		0x18</span>
<span class="cp">#define HFCPCI_TIM800		0x1C</span>
<span class="cp">#define HFCPCI_AUTO_TIMER	0x20</span>
<span class="cp">#define HFCPCI_TRANSB2		0x02</span>
<span class="cp">#define HFCPCI_TRANSB1		0x01</span>

<span class="cm">/* bits in CIRM (Write) */</span>
<span class="cp">#define HFCPCI_AUX_MSK		0x07</span>
<span class="cp">#define HFCPCI_RESET		0x08</span>
<span class="cp">#define HFCPCI_B1_REV		0x40</span>
<span class="cp">#define HFCPCI_B2_REV		0x80</span>

<span class="cm">/* bits in INT_M1 and INT_S1 */</span>
<span class="cp">#define HFCPCI_INTS_B1TRANS	0x01</span>
<span class="cp">#define HFCPCI_INTS_B2TRANS	0x02</span>
<span class="cp">#define HFCPCI_INTS_DTRANS	0x04</span>
<span class="cp">#define HFCPCI_INTS_B1REC	0x08</span>
<span class="cp">#define HFCPCI_INTS_B2REC	0x10</span>
<span class="cp">#define HFCPCI_INTS_DREC	0x20</span>
<span class="cp">#define HFCPCI_INTS_L1STATE	0x40</span>
<span class="cp">#define HFCPCI_INTS_TIMER	0x80</span>

<span class="cm">/* bits in INT_M2 */</span>
<span class="cp">#define HFCPCI_PROC_TRANS	0x01</span>
<span class="cp">#define HFCPCI_GCI_I_CHG	0x02</span>
<span class="cp">#define HFCPCI_GCI_MON_REC	0x04</span>
<span class="cp">#define HFCPCI_IRQ_ENABLE	0x08</span>
<span class="cp">#define HFCPCI_PMESEL		0x80</span>

<span class="cm">/* bits in STATES */</span>
<span class="cp">#define HFCPCI_STATE_MSK	0x0F</span>
<span class="cp">#define HFCPCI_LOAD_STATE	0x10</span>
<span class="cp">#define HFCPCI_ACTIVATE		0x20</span>
<span class="cp">#define HFCPCI_DO_ACTION	0x40</span>
<span class="cp">#define HFCPCI_NT_G2_G3		0x80</span>

<span class="cm">/* bits in HFCD_MST_MODE */</span>
<span class="cp">#define HFCPCI_MASTER		0x01</span>
<span class="cp">#define HFCPCI_SLAVE		0x00</span>
<span class="cp">#define HFCPCI_F0IO_POSITIV	0x02</span>
<span class="cp">#define HFCPCI_F0_NEGATIV	0x04</span>
<span class="cp">#define HFCPCI_F0_2C4		0x08</span>
<span class="cm">/* remaining bits are for codecs control */</span>

<span class="cm">/* bits in HFCD_SCTRL */</span>
<span class="cp">#define SCTRL_B1_ENA		0x01</span>
<span class="cp">#define SCTRL_B2_ENA		0x02</span>
<span class="cp">#define SCTRL_MODE_TE		0x00</span>
<span class="cp">#define SCTRL_MODE_NT		0x04</span>
<span class="cp">#define SCTRL_LOW_PRIO		0x08</span>
<span class="cp">#define SCTRL_SQ_ENA		0x10</span>
<span class="cp">#define SCTRL_TEST		0x20</span>
<span class="cp">#define SCTRL_NONE_CAP		0x40</span>
<span class="cp">#define SCTRL_PWR_DOWN		0x80</span>

<span class="cm">/* bits in SCTRL_E  */</span>
<span class="cp">#define HFCPCI_AUTO_AWAKE	0x01</span>
<span class="cp">#define HFCPCI_DBIT_1		0x04</span>
<span class="cp">#define HFCPCI_IGNORE_COL	0x08</span>
<span class="cp">#define HFCPCI_CHG_B1_B2	0x80</span>

<span class="cm">/* bits in FIFO_EN register */</span>
<span class="cp">#define HFCPCI_FIFOEN_B1	0x03</span>
<span class="cp">#define HFCPCI_FIFOEN_B2	0x0C</span>
<span class="cp">#define HFCPCI_FIFOEN_DTX	0x10</span>
<span class="cp">#define HFCPCI_FIFOEN_B1TX	0x01</span>
<span class="cp">#define HFCPCI_FIFOEN_B1RX	0x02</span>
<span class="cp">#define HFCPCI_FIFOEN_B2TX	0x04</span>
<span class="cp">#define HFCPCI_FIFOEN_B2RX	0x08</span>


<span class="cm">/* definitions of fifo memory area */</span>
<span class="cp">#define MAX_D_FRAMES 15</span>
<span class="cp">#define MAX_B_FRAMES 31</span>
<span class="cp">#define B_SUB_VAL    0x200</span>
<span class="cp">#define B_FIFO_SIZE  (0x2000 - B_SUB_VAL)</span>
<span class="cp">#define D_FIFO_SIZE  512</span>
<span class="cp">#define D_FREG_MASK  0xF</span>

<span class="k">struct</span> <span class="n">zt</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">z1</span><span class="p">;</span>  <span class="cm">/* Z1 pointer 16 Bit */</span>
	<span class="n">__le16</span> <span class="n">z2</span><span class="p">;</span>  <span class="cm">/* Z2 pointer 16 Bit */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dfifo</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">data</span><span class="p">[</span><span class="n">D_FIFO_SIZE</span><span class="p">];</span> <span class="cm">/* FIFO data space */</span>
	<span class="n">u_char</span> <span class="n">fill1</span><span class="p">[</span><span class="mh">0x20A0</span> <span class="o">-</span> <span class="n">D_FIFO_SIZE</span><span class="p">];</span> <span class="cm">/* reserved, do not use */</span>
	<span class="n">u_char</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">;</span> <span class="cm">/* f pointers */</span>
	<span class="n">u_char</span> <span class="n">fill2</span><span class="p">[</span><span class="mh">0x20C0</span> <span class="o">-</span> <span class="mh">0x20A2</span><span class="p">];</span> <span class="cm">/* reserved, do not use */</span>
	<span class="cm">/* mask index with D_FREG_MASK for access */</span>
	<span class="k">struct</span> <span class="n">zt</span> <span class="n">za</span><span class="p">[</span><span class="n">MAX_D_FRAMES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u_char</span> <span class="n">fill3</span><span class="p">[</span><span class="mh">0x4000</span> <span class="o">-</span> <span class="mh">0x2100</span><span class="p">];</span> <span class="cm">/* align 16K */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bzfifo</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">zt</span>	<span class="n">za</span><span class="p">[</span><span class="n">MAX_B_FRAMES</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="cm">/* only range 0x0..0x1F allowed */</span>
	<span class="n">u_char</span>		<span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">;</span> <span class="cm">/* f pointers */</span>
	<span class="n">u_char</span>		<span class="n">fill</span><span class="p">[</span><span class="mh">0x2100</span> <span class="o">-</span> <span class="mh">0x2082</span><span class="p">];</span> <span class="cm">/* alignment */</span>
<span class="p">};</span>


<span class="k">union</span> <span class="n">fifo_area</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">dfifo</span> <span class="n">d_tx</span><span class="p">;</span> <span class="cm">/* D-send channel */</span>
		<span class="k">struct</span> <span class="n">dfifo</span> <span class="n">d_rx</span><span class="p">;</span> <span class="cm">/* D-receive channel */</span>
	<span class="p">}</span> <span class="n">d_chan</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u_char</span>		<span class="n">fill1</span><span class="p">[</span><span class="mh">0x200</span><span class="p">];</span>
		<span class="n">u_char</span>		<span class="n">txdat_b1</span><span class="p">[</span><span class="n">B_FIFO_SIZE</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">bzfifo</span>	<span class="n">txbz_b1</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bzfifo</span>	<span class="n">txbz_b2</span><span class="p">;</span>
		<span class="n">u_char</span>		<span class="n">txdat_b2</span><span class="p">[</span><span class="n">B_FIFO_SIZE</span><span class="p">];</span>
		<span class="n">u_char</span>		<span class="n">fill2</span><span class="p">[</span><span class="n">D_FIFO_SIZE</span><span class="p">];</span>
		<span class="n">u_char</span>		<span class="n">rxdat_b1</span><span class="p">[</span><span class="n">B_FIFO_SIZE</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">bzfifo</span>	<span class="n">rxbz_b1</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bzfifo</span>	<span class="n">rxbz_b2</span><span class="p">;</span>
		<span class="n">u_char</span> <span class="n">rxdat_b2</span><span class="p">[</span><span class="n">B_FIFO_SIZE</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">b_chans</span><span class="p">;</span>
	<span class="n">u_char</span> <span class="n">fill</span><span class="p">[</span><span class="mi">32768</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define Write_hfc(a, b, c) (writeb(c, (a-&gt;hw.pci_io) + b))</span>
<span class="cp">#define Read_hfc(a, b) (readb((a-&gt;hw.pci_io) + b))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
