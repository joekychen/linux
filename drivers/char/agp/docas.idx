f | backend.c | s | 8.9K | 302 | Michal Kubecek | mkubecek@suse.cz | 1327603008 |  | agp: fix scratch page cleanup  In error cleanup of agp_backend_initialize() and in agp_backend_cleanup(), agp_destroy_page() is passed virtual address of the scratch page. This leads to a kernel warning if the initialization fails (or upon regular cleanup) as pointer to struct page should be passed instead.  Signed-off-by: Michal Kubecek <mkubecek@suse.cz> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | agp.h | s | 8.8K | 245 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | Makefile | g | 805B |  | Daniel Vetter | daniel.vetter@ffwll.ch | 1283977206 |  | agp/intel: make intel-gtt.c into a real source file  Now that the disentangling is complete, stop including intel-gtt.c from intel-agp.c.  The linux build system _really_ doesn't allow .c source files with the same name as the module. It fails with the following message when trying to build such a bugger:  make[3]: Circular drivers/char/agp/intel-agp.o <- drivers/char/agp/intel-agp.o dependency dropped.  Instead of renameing intel-agp.c I've simply created a new module out of intel-gtt.c. Renaming intel-agp.ko to something else is not an option for it will surely kill someones boot process.  This also paves the way to use the gtt code without loading the agp driver.  Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch> Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
f | isoch.c | s | 12K | 395 | Bjorn Helgaas | bjorn.helgaas@hp.com | 1218500018 |  | agp: use dev_printk when possible  Convert printks to use dev_printk().  Signed-off-by: Bjorn Helgaas <bjorn.helgaas@hp.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | frontend.c | s | 23K | 844 | Daniel Vetter | daniel.vetter@ffwll.ch | 1290543285 |  | agp: kill agp_flush_chipset and corresponding ioctl  The intel drm calls the chipset functions now directly. Userspace never called the corresponding ioctl, hence it can be killed, too.  Cc: Dave Airlie <airlied@gmail.com> Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch> Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
f | compat_ioctl.c | s | 7.4K | 232 | Daniel Vetter | daniel.vetter@ffwll.ch | 1290543285 |  | agp: kill agp_flush_chipset and corresponding ioctl  The intel drm calls the chipset functions now directly. Userspace never called the corresponding ioctl, hence it can be killed, too.  Cc: Dave Airlie <airlied@gmail.com> Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch> Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
f | uninorth-agp.c | s | 17K | 613 | Michel Dänzer | daenzer@vmware.com | 1306059789 |  | agp/uninorth: Fix lockups with radeon KMS and >1x.  This was based on a description by Ben Herrenschmidt:  > I've removed that SBA reset from the normal TLB invalidation path and > left it only once after turning AGP on.  About six months ago, he said:  > I did it a bit differently, but yeah, you get the idea. I'm doing a > patch series so don't bother pushing things too hard yet.  But I haven't seen anything from him about this since then, and people are regularly hitting these lockups, so here we are...  Signed-off-by: Michel Dänzer <daenzer@vmware.com> Acked-by: Benjamin Herrenschmidt <benh@kernel.crashing.org> Signed-off-by: Dave Airlie <airlied@gmail.com>
f | sis-agp.c | s | 11K | 403 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | amd64-agp.c | s | 20K | 698 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | sgi-agp.c | s | 7.7K | 285 | Santosh Nayak | santoshprasadnayak@gmail.com | 1334249777 |  | agp: Remove 'break' after 'return' statement.  'break' is unnecessary after 'return' statement. Remove all such 'break' as clean up.  Signed-off-by: Santosh Nayak <santoshprasadnayak@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | hp-agp.c | s | 13K | 458 | Émeric Maschino | emeric.maschino@gmail.com | 1314131519 |  | [IA64] agp/hp-agp: Allow binding user memory to the AGP GART  dmesg reports: [   29.365973] [TTM] AGP Bind memory failed. [   29.366015] radeon 0000:80:00.0: object_init failed for (4096, 0x00000002) [   29.366052] radeon 0000:80:00.0: (-22) create WB bo failed [   29.366087] radeon 0000:80:00.0: Disabling GPU acceleration [   29.366124] [drm] radeon: cp finalized [   29.366168] [drm] radeon: cp finalized [   29.366210] [TTM] Finalizing pool allocator. [   29.366924] [TTM] Zone  kernel: Used memory at exit: 0 kiB. [   29.366961] [TTM] Zone   dma32: Used memory at exit: 0 kiB. [   29.366996] [drm] radeon: ttm finalized [   29.367030] [drm] Forcing AGP to PCI mode  This patch allows binding user memory to the AGP GART on zx1-based systems. dmesg thus no more complains about AGP bind memory failure, disabled GPU acceleration or AGP mode forced to PCI.  Original work from Francisco Jerez in agp/amd-k7 (https://lkml.org/lkml/2010/10/15/469).  Tested-by: Émeric Maschino <emeric.maschino@gmail.com> Signed-off-by: Tony Luck <tony.luck@intel.com>
f | ati-agp.c | s | 14K | 487 | Jerome Glisse | jglisse@redhat.com | 1271995158 |  | agp: use scratch page on memory remove and at GATT creation V4  Convert most AGP chipset to use scratch page as default entries. This help avoiding GPU querying 0 address and trigger computer fault. With KMS and memory manager we bind/unbind AGP memory constantly and it seems that some GPU are still doing AGP traffic even after GPU report being idle with the memory segment.  Tested (radeon GPU KMS + Xorg + compiz + glxgears + quake3) on : - SIS 1039:0001 & 1039:0003 - Intel 865 8086:2571  Compile tested for other bridges  V2 enable scratch page on uninorth V3 fix unbound check in uninorth insert memory (Michel Dänzer) V4 rebase on top of drm-next branch with the lastest intel AGP    changeset (stable should use version V3 of the patch)  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Michel Dänzer <michel@daenzer.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | intel-gtt.c | s | 40K | 1367 | Dave Airlie | airlied@redhat.com | 1334222821 |  | Merge branch 'drm-intel-next' of git://people.freedesktop.org/~danvet/drm-intel into drm-core-next  Daniel Vetter wrote First pull request for 3.5-next, slightly large than usual because new things kept coming in since the last pull for 3.4. Highlights: - first batch of hw enablement for vlv (Jesse et al) and hsw (Eugeni). pci  ids are not yet added, and there's still quite a few patches to merge  (mostly modesetting). To make QA easier I've decided to merge this stuff  in pieces. - loads of cleanups and prep patches spurred by the above. Especially vlv  is a real frankenstein chip, but also hsw is stretching our driver's  code design. Expect more to come in this area for 3.5. - more gmbus fixes, cleanups and improvements by Daniel Kurtz. Again,  there are more patches needed (and some already queued up), but I wanted  to split this a bit for better testing. - pwrite/pread rework and retuning. This series has been in the works for  a few months already and a lot of i-g-t tests have been created for it.  Now it's finally ready to be merged.  Note that one patch in this series  touches include/pagemap.h, that patch is acked-by akpm. - reduce mappable pressure and relocation throughput improvements from  Chris. - mmap offset exhaustion mitigation by Chris Wilson. - a start at figuring out which codepaths in our messy dri1/ums+gem/kms  driver we actually need to support by bailing out of unsupported case.  The driver now refuses to load without kms on gen6+ and disallows a few  ioctls that userspace never used in certain cases. More of this will  definitely come. - More decoupling of global gtt and ppgtt. - Improved dual-link lvds detection by Takashi Iwai. - Shut up the compiler + plus fix the fallout (Ben) - Inverted panel brightness handling (mostly Acer manages to break things  in this way). - Small fixlets and adjustements and some minor things to help debugging.  Regression-wise QA reported quite a few issues on ivb, but all of them turned out to be hw stability issues which are already fixed in drm-intel-fixes (QA runs the nightly regression tests on -next alone, without -fixes automatically merged in). There's still one issue open on snb, it looks like occlusion query writes are not quite as cache coherent as we've expected. With some of the pwrite adjustements we can now reliably hit this. Kernel workaround for it is in the works."  * 'drm-intel-next' of git://people.freedesktop.org/~danvet/drm-intel: (101 commits)   drm/i915: VCS is not the last ring   drm/i915: Add a dual link lvds quirk for MacBook Pro 8,2   drm/i915: make quirks more verbose   drm/i915: dump the DMA fetch addr register on pre-gen6   drm/i915/sdvo: Include YRPB as an additional TV output type   drm/i915: disallow gem init ioctl on ilk   drm/i915: refuse to load on gen6+ without kms   drm/i915: extract gt interrupt handler   drm/i915: use render gen to switch ring irq functions   drm/i915: rip out old HWSTAM missed irq WA for vlv   drm/i915: open code gen6+ ring irqs   drm/i915: ring irq cleanups   drm/i915: add SFUSE_STRAP registers for digital port detection   drm/i915: add WM_LINETIME registers   drm/i915: add WRPLL clocks   drm/i915: add LCPLL control registers   drm/i915: add SSC offsets for SBI access   drm/i915: add port clock selection support for HSW   drm/i915: add S PLL control   drm/i915: add PIXCLK_GATE register   ...  Conflicts: 	drivers/char/agp/intel-agp.h 	drivers/char/agp/intel-gtt.c 	drivers/gpu/drm/i915/i915_debugfs.c
f | parisc-agp.c | s | 10.0K | 339 | Kyle McMartin | kyle@mcmartin.ca | 1288373208 |  | parisc-agp: fix missing slab.h include  Commit 338e4fab added a missing kfree if the alloc_pci_dev failed but forgot to include <linux/slab.h> for the definition of kfree.  Signed-off-by: Kyle McMartin <kyle@redhat.com>
f | sworks-agp.c | s | 15K | 469 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | ali-agp.c | s | 10K | 360 | Jerome Glisse | jglisse@redhat.com | 1271995158 |  | agp: use scratch page on memory remove and at GATT creation V4  Convert most AGP chipset to use scratch page as default entries. This help avoiding GPU querying 0 address and trigger computer fault. With KMS and memory manager we bind/unbind AGP memory constantly and it seems that some GPU are still doing AGP traffic even after GPU report being idle with the memory segment.  Tested (radeon GPU KMS + Xorg + compiz + glxgears + quake3) on : - SIS 1039:0001 & 1039:0003 - Intel 865 8086:2571  Compile tested for other bridges  V2 enable scratch page on uninorth V3 fix unbound check in uninorth insert memory (Michel Dänzer) V4 rebase on top of drm-next branch with the lastest intel AGP    changeset (stable should use version V3 of the patch)  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Michel Dänzer <michel@daenzer.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | generic.c | s | 36K | 1203 | Santosh Nayak | santoshprasadnayak@gmail.com | 1334249781 |  | agp: Use u32 __iomem annotation to silence sparse warning.  Replace "void *" by "u32 __iomem *" to silence sparse warning.  Signed-off-by: Santosh Nayak <santoshprasadnayak@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | intel-agp.c | s | 28K | 811 | Eugeni Dodonov | eugeni.dodonov@intel.com | 1338995129 |  | char/agp: add another Ironlake host bridge  This seems to come on Gigabyte H55M-S2V and was discovered through the https://bugs.freedesktop.org/show_bug.cgi?id=50381 debugging.  Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50381 Signed-off-by: Eugeni Dodonov <eugeni.dodonov@intel.com> Cc: stable@vger.kernel.org Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
f | nvidia-agp.c | s | 12K | 388 | Jerome Glisse | jglisse@redhat.com | 1271995158 |  | agp: use scratch page on memory remove and at GATT creation V4  Convert most AGP chipset to use scratch page as default entries. This help avoiding GPU querying 0 address and trigger computer fault. With KMS and memory manager we bind/unbind AGP memory constantly and it seems that some GPU are still doing AGP traffic even after GPU report being idle with the memory segment.  Tested (radeon GPU KMS + Xorg + compiz + glxgears + quake3) on : - SIS 1039:0001 & 1039:0003 - Intel 865 8086:2571  Compile tested for other bridges  V2 enable scratch page on uninorth V3 fix unbound check in uninorth insert memory (Michel Dänzer) V4 rebase on top of drm-next branch with the lastest intel AGP    changeset (stable should use version V3 of the patch)  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Michel Dänzer <michel@daenzer.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | efficeon-agp.c | s | 12K | 393 | Kulikov Vasiliy | segooon@gmail.com | 1280975301 |  | agp: efficeon-agp: do not use PCI resources before pci_enable_device()  IRQ and resource[] may not have correct values until after PCI hotplug setup occurs at pci_enable_device() time.  The semantic match that finds this problem is as follows:  // <smpl> @@ identifier x; identifier request ~= "pci_request.*||pci_resource.*"; @@  ( * x->irq || * x->resource || * request(x, ...) )  ... *pci_enable_device(x) // </smpl>  Signed-off-by: Kulikov Vasiliy <segooon@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | intel-agp.h | s | 9.6K | 236 | Eugeni Dodonov | eugeni.dodonov@intel.com | 1338995129 |  | char/agp: add another Ironlake host bridge  This seems to come on Gigabyte H55M-S2V and was discovered through the https://bugs.freedesktop.org/show_bug.cgi?id=50381 debugging.  Bugzilla: https://bugs.freedesktop.org/show_bug.cgi?id=50381 Signed-off-by: Eugeni Dodonov <eugeni.dodonov@intel.com> Cc: stable@vger.kernel.org Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
f | via-agp.c | s | 14K | 505 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | Kconfig | g | 5.1K |  | Matt Turner | mattst88@gmail.com | 1296776545 |  | Revert "agp: AMD AGP is used on UP1100 & UP1500 alpha boxen"  This reverts commit f191f144079b0083c6fa7d01a4acbd7263fb5032.  The AMD 751 and 761 chipsets are used on the UP1000, UP1100, and UP1500 OEM motherboards, but they neglect to do anything to make AGP work.  According to Ivan Kokshaysky: There is quite fundamental conflict between the Alpha architecture and x86 AGP implementation - Alpha is entirely cache coherent by design, while x86 AGP is not (I mean native AGP DMA transactions, not a PCI over AGP). There are no such things as non-cacheable mappings or software support for cache flushing/invalidation on Alpha, so x86 AGP code won't work on Nautilus.  So there's no point in allowing this driver to be configured on Alpha.  Signed-off-by: Matt Turner <mattst88@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | compat_ioctl.h | s | 4.3K | 94 | Daniel Vetter | daniel.vetter@ffwll.ch | 1290543285 |  | agp: kill agp_flush_chipset and corresponding ioctl  The intel drm calls the chipset functions now directly. Userspace never called the corresponding ioctl, hence it can be killed, too.  Cc: Dave Airlie <airlied@gmail.com> Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch> Signed-off-by: Chris Wilson <chris@chris-wilson.co.uk>
f | amd-k7-agp.c | s | 15K | 476 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | i460-agp.c | s | 18K | 552 | Justin P. Mattock | justinmattock@gmail.com | 1287392594 |  | Update broken web addresses in the kernel.  The patch below updates broken web addresses in the kernel  Signed-off-by: Justin P. Mattock <justinmattock@gmail.com> Cc: Maciej W. Rozycki <macro@linux-mips.org> Cc: Geert Uytterhoeven <geert@linux-m68k.org> Cc: Finn Thain <fthain@telegraphics.com.au> Cc: Randy Dunlap <rdunlap@xenotime.net> Cc: Matt Turner <mattst88@gmail.com> Cc: Dimitry Torokhov <dmitry.torokhov@gmail.com> Cc: Mike Frysinger <vapier.adi@gmail.com> Acked-by: Ben Pfaff <blp@cs.stanford.edu> Acked-by: Hans J. Koch <hjk@linutronix.de> Reviewed-by: Finn Thain <fthain@telegraphics.com.au> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | alpha-agp.c | s | 5.4K | 181 | Alexey Dobriyan | adobriyan@gmail.com | 1254076765 |  | const: mark struct vm_struct_operations  * mark struct vm_area_struct::vm_ops as const * mark vm_ops in AGP code  But leave TTM code alone, something is fishy there with global vm_ops being used.  Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
