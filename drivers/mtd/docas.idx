d | chips |  | 14 items |  | David Woodhouse | David.Woodhouse@intel.com | 1336970076 |  | mtd: cfi_cmdset_0002: Slight cleanup of fixup messages  These should be semicolons, not commas.  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | cmdlinepart.c | s | 9.9K | 349 | Peter Meerwald | p.meerwald@bct-electronic.com | 1336968216 |  | mtd: cmdlinepart: fix commentary  Signed-off-by: Peter Meerwald <p.meerwald@bct-electronic.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdsuper.c | s | 5.5K | 184 | Linus Torvalds | torvalds@linux-foundation.org | 1320685876 |  | Merge git://git.infradead.org/mtd-2.6  * git://git.infradead.org/mtd-2.6: (226 commits)   mtd: tests: annotate as DANGEROUS in Kconfig   mtd: tests: don't use mtd0 as a default   mtd: clean up usage of MTD_DOCPROBE_ADDRESS   jffs2: add compr=lzo and compr=zlib options   jffs2: implement mount option parsing and compression overriding   mtd: nand: initialize ops.mode   mtd: provide an alias for the redboot module name   mtd: m25p80: don't probe device which has status of 'disabled'   mtd: nand_h1900 never worked   mtd: Add DiskOnChip G3 support   mtd: m25p80: add EON flash EN25Q32B into spi flash id table   mtd: mark block device queue as non-rotational   mtd: r852: make r852_pm_ops static   mtd: m25p80: add support for at25df321a spi data flash   mtd: mxc_nand: preset_v1_v2: unlock all NAND flash blocks   mtd: nand: switch `check_pattern()' to standard `memcmp()'   mtd: nand: invalidate cache on unaligned reads   mtd: nand: do not scan bad blocks with NAND_BBT_NO_OOB set   mtd: nand: wait to set BBT version   mtd: nand: scrub BBT on ECC errors   ...  Fix up trivial conflicts:  - arch/arm/mach-at91/board-usb-a9260.c 	Merged into board-usb-a926x.c  - drivers/mtd/maps/lantiq-flash.c 	add_mtd_partitions -> mtd_device_register vs changed to use 	mtd_device_parse_register.
f | Makefile | g | 1.1K |  | Jonas Gorski | jonas.gorski@gmail.com | 1326132931 |  | mtd: maps: bcm963xx-flash: make CFE partition parsing an mtd parser  Recent BCM63XX devices support a variety of flash types (parallel, SPI, NAND) and share the partition layout. To prevent code duplication make the CFE partition parsing code a stand alone mtd parser to allow SPI or NAND flash drivers to use it.  Signed-off-by: Jonas Gorski <jonas.gorski@gmail.com> Acked-by: Florian Fainelli <florian@openwrt.org> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdcore.c | s | 30K | 1030 | Mike Dunn | mikedunn@newsguy.com | 1336968863 |  | mtd: driver _read() returns max_bitflips; mtd_read() returns -EUCLEAN  The drivers' _read() method, absent an error, returns a non-negative integer indicating the maximum number of bit errors that were corrected in any one region comprising an ecc step.  MTD returns -EUCLEAN if this is >= bitflip_threshold, 0 otherwise.  If bitflip_threshold is zero, the comparison is not made since these devices lack ECC and always return zero in the non-error case (thanks Brian)¹.  Note that this is a subtle change to the driver interface.  This and the preceding patches in this set were tested with ubi on top of the nandsim and docg4 devices, running the ubi test io_basic from mtd-utils.  ¹ http://lists.infradead.org/pipermail/linux-mtd/2012-March/040468.html  Signed-off-by: Mike Dunn <mikedunn@newsguy.com> Acked-by: Robert Jarzmik <robert.jarzmik@free.fr> Acked-by: Brian Norris <computersforpeace@gmail.com> Ivan Djelic <ivan.djelic@parrot.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
d | nand |  | 58 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338594942 |  | 
f | mtdswap.c | s | 35K | 1273 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133586 |  | mtd: do not use mtd->block_markbad directly  Instead, use the new 'mtd_can_have_bb()', or just rely on 'mtd_block_markbad()' return code, which will be -EOPNOTSUPP if bad blocks are not supported.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdcore.h | s | 840B | 21 | Dmitry Eremin-Solenikov | dbaryshkov@gmail.com | 1315742533 |  | mtd: hide parse_mtd_partitions  There is no need to export parse_mtd_partitions() now , as it's fully handled by registration functions. So move the definition to private header and remove respective EXPORT_SYMBOL_GPL.  Signed-off-by: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
d | ubi |  | 18 items |  | Brian Norris | computersforpeace@gmail.com | 1340796135 |  | UBI: correct usage of IS_ENABLED()  Commit "e9b4cf2 UBI: fix debugfs-less systems support" fixed one regression but introduced a different regression - the debugfs is now always compiled out. Root cause: IS_ENABLED() arguments should be used with the CONFIG_* prefix.  Signed-off-by: Brian Norris <computersforpeace@gmail.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | ar7part.c | s | 4.1K | 131 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133519 |  | mtd: introduce mtd_read interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtd_blkdevs.c | s | 13K | 492 | Alexander Stein | alexander.stein@systec-electronic.com | 1332803471 |  | mtd: mtdblock: call mtd_sync() only if opened for write  Because it is useless to call it if the device is opened in R/O mode, and also harmful: on CFI NOR flash it may block for long time waiting for erase operations to complete is another partition with a R/W file-system on this chip.  Artem Bityutskiy: write commit message, amend the patch to match the latest tree (we use mtd_sync(), not mtd->sync() nowadays).  Signed-off-by: Alexander Stein <alexander.stein@systec-electronic.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdblock_ro.c | s | 2.4K | 82 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133520 |  | mtd: introduce mtd_write interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
d | onenand |  | 8 items |  | Mike Dunn | mikedunn@newsguy.com | 1336968863 |  | mtd: driver _read() returns max_bitflips; mtd_read() returns -EUCLEAN  The drivers' _read() method, absent an error, returns a non-negative integer indicating the maximum number of bit errors that were corrected in any one region comprising an ecc step.  MTD returns -EUCLEAN if this is >= bitflip_threshold, 0 otherwise.  If bitflip_threshold is zero, the comparison is not made since these devices lack ECC and always return zero in the non-error case (thanks Brian)¹.  Note that this is a subtle change to the driver interface.  This and the preceding patches in this set were tested with ubi on top of the nandsim and docg4 devices, running the ubi test io_basic from mtd-utils.  ¹ http://lists.infradead.org/pipermail/linux-mtd/2012-March/040468.html  Signed-off-by: Mike Dunn <mikedunn@newsguy.com> Acked-by: Robert Jarzmik <robert.jarzmik@free.fr> Acked-by: Brian Norris <computersforpeace@gmail.com> Ivan Djelic <ivan.djelic@parrot.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | nftlmount.c | s | 25K | 701 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133548 |  | mtd: introduce mtd_block_markbad interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | redboot.c | s | 8.4K | 281 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1332804254 |  | mtd: redboot: remove useless code  We do not need to invoke 'mtd_can_have_bb()' before invoking 'mtd_block_isbad()' because the latter already handles the case when the MTD device does not support bad blocks.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdblock.c | s | 9.9K | 334 | Alexander Stein | alexander.stein@systec-electronic.com | 1332803471 |  | mtd: mtdblock: call mtd_sync() only if opened for write  Because it is useless to call it if the device is opened in R/O mode, and also harmful: on CFI NOR flash it may block for long time waiting for erase operations to complete is another partition with a R/W file-system on this chip.  Artem Bityutskiy: write commit message, amend the patch to match the latest tree (we use mtd_sync(), not mtd->sync() nowadays).  Signed-off-by: Alexander Stein <alexander.stein@systec-electronic.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
d | maps |  | 53 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338594942 |  | 
d | lpddr |  | 4 items |  | Jim Cromie | jim.cromie@gmail.com | 1336967251 |  | mtd: lpddr: replace open-coded ARRAY_SIZE with macro  Signed-off-by: Jim Cromie <jim.cromie@gmail.com> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | ssfdc.c | s | 11K | 375 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133547 |  | mtd: introduce mtd_block_isbad interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
d | tests |  | 9 items |  | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133584 |  | mtd: introduce mtd_can_have_bb helper  This patch introduces new 'mtd_can_have_bb()' helper function which checks whether the flash can have bad eraseblocks. Then it changes all the direct 'mtd->block_isbad' use cases with 'mtd_can_have_bb()'.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | sm_ftl.c | s | 30K | 1030 | Maxim Levitsky | maximlevitsky@gmail.com | 1332806486 |  | mtd: sm_ftl: fix typo in major number.  major == 0 allocates dynamic major, not major == -1  Signed-off-by: Maxim Levitsky <maximlevitsky@gmail.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdoops.c | s | 11K | 383 | Kay Sievers | kay@vrfy.org | 1339797239 |  | kmsg - kmsg_dump() use iterator to receive log buffer content  Provide an iterator to receive the log buffer content, and convert all kmsg_dump() users to it.  The structured data in the kmsg buffer now contains binary data, which should no longer be copied verbatim to the kmsg_dump() users.  The iterator should provide reliable access to the buffer data, and also supports proper log line-aware chunking of data while iterating.  Signed-off-by: Kay Sievers <kay@vrfy.org> Tested-by: Tony Luck <tony.luck@intel.com> Reported-by: Anton Vorontsov <anton.vorontsov@linaro.org> Tested-by: Anton Vorontsov <anton.vorontsov@linaro.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | rfd_ftl.c | s | 18K | 658 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133581 |  | mtd: do not use mtd->sync directly  This patch teaches 'mtd_sync()' to do nothing when the MTD driver does not have the '->sync()' method, which allows us to remove all direct 'mtd->sync' accesses.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | ftl.c | s | 31K | 927 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133581 |  | mtd: do not use mtd->sync directly  This patch teaches 'mtd_sync()' to do nothing when the MTD driver does not have the '->sync()' method, which allows us to remove all direct 'mtd->sync' accesses.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdpart.c | s | 20K | 653 | Mike Dunn | mikedunn@newsguy.com | 1336968863 |  | mtd: driver _read() returns max_bitflips; mtd_read() returns -EUCLEAN  The drivers' _read() method, absent an error, returns a non-negative integer indicating the maximum number of bit errors that were corrected in any one region comprising an ecc step.  MTD returns -EUCLEAN if this is >= bitflip_threshold, 0 otherwise.  If bitflip_threshold is zero, the comparison is not made since these devices lack ECC and always return zero in the non-error case (thanks Brian)¹.  Note that this is a subtle change to the driver interface.  This and the preceding patches in this set were tested with ubi on top of the nandsim and docg4 devices, running the ubi test io_basic from mtd-utils.  ¹ http://lists.infradead.org/pipermail/linux-mtd/2012-March/040468.html  Signed-off-by: Mike Dunn <mikedunn@newsguy.com> Acked-by: Robert Jarzmik <robert.jarzmik@free.fr> Acked-by: Brian Norris <computersforpeace@gmail.com> Ivan Djelic <ivan.djelic@parrot.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>  Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdchar.c | s | 27K | 1027 | Will Newton | will.newton@gmail.com | 1336418990 |  | mtd: fix oops in dataflash driver  I'm seeing an oops in mtd_dataflash.c with Linux 3.3. What appears to be happening is that otp_select_filemode calls mtd_read_fact_prot_reg with -1 for offset and length and a NULL buffer to test if OTP operations are supported. This finds its way down to otp_read in mtd_dataflash.c and causes an oops when memcpying the returned data into the NULL buf.  None of the checks in otp_read catches the negative length and offset. Changing the length of the dummy read to 0 prevents the oops.  Cc: stable@kernel.org [3.3+] Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | inftlmount.c | s | 22K | 692 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133548 |  | mtd: introduce mtd_block_markbad interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | afs.c | s | 6.3K | 224 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1326133519 |  | mtd: introduce mtd_read interface  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | Kconfig | g | 11K |  | Frank Svendsboe | frank.svendsboe@gmail.com | 1338577619 |  | mtd: of_parts: fix breakage in Kconfig  MTD_OF_PARTS and the default setting is not working due to using 'Y' instead of 'y', introduced in commit d6137badeff1ef64b4e0092ec249ebdeaeb3ff37. This made our board, and possibly other boards using DTS defined partitions and not having CONFIG_MTD_OF_PARTS=y defined in the defconfig, fail to mount root.  Signed-off-by: Frank Svendsboe <frank.svendsboe@gmail.com> Cc: stable@kernel.org [3.2+] Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | nftlcore.c | s | 22K | 706 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1332804243 |  | mtd: nftlcore: remove out-of-date and now irrelevant piece of code  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | ofpart.c | s | 4.0K | 148 | Dmitry Eremin-Solenikov | dbaryshkov@gmail.com | 1315742534 |  | mtd: ofpart: add ofoldpart alias  ofpart.ko also provides ofoldpart MTD parser. Add respective MODULE_ALIAS("ofoldpart"); declaration.  Artem: improve the comment  Signed-off-by: Dmitry Eremin-Solenikov <dbaryshkov@gmail.com> Signed-off-by: Artem Bityutskiy <dedekind1@gmail.com>
f | sm_ftl.h | s | 2.5K | 74 | Maxim Levitsky | maximlevitsky@gmail.com | 1287966788 |  | mtd: sm_ftl: cosmetic, use bool when possible  I didn't know that kernel allows use of that typedef.  Signed-off-by: Maxim Levitsky <maximlevitsky@gmail.com> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
d | devices |  | 21 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1338594942 |  | 
f | inftlcore.c | s | 24K | 824 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1332804001 |  | mtd: add leading underscore to all mtd functions  This patch renames all MTD functions by adding a "_" prefix:  mtd->erase -> mtd->_erase mtd->read_oob -> mtd->_read_oob ...  The reason is that we are re-working the MTD API and from now on it is an error to use MTD function pointers directly - we have a corresponding API call for every pointer. By adding a leading "_" we achieve the following:  1. Make sure we convert every direct pointer users 2. A leading "_" suggests that this interface is internal and it becomes    less likely that people will use them directly 3. Make sure all the out-of-tree modules stop compiling and the owners    spot the big API change and amend them.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | mtdconcat.c | s | 23K | 812 | Shmulik Ladkani | shmulik.ladkani@gmail.com | 1332806544 |  | mtd: unify initialization of erase_info->fail_addr  Initialization of 'erase_info->fail_addr' to MTD_FAIL_ADDR_UNKNOWN prior erase operation is duplicated accross several MTD drivers, and also taken care of by some MTD users as well.  Harmonize it: initialize 'fail_addr' within 'mtd_erase()' interface.  Signed-off-by: Shmulik Ladkani <shmulik.ladkani@gmail.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
f | bcm63xxpart.c | s | 6.5K | 200 | Jonas Gorski | jonas.gorski@gmail.com | 1336967703 |  | mtd: bcm63xxpart: handle Broadcom partition order  The original Broadcom partition order has the root fs in front of the kernel, which resulted in miscalculated partition sizes. Detect when such an image is on the flash and also reorder the partitions accordingly.  Signed-off-by: Jonas Gorski <jonas.gorski@gmail.com> Acked-by: Florian Fainelli <florian@openwrt.org> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@linux.intel.com> Signed-off-by: David Woodhouse <David.Woodhouse@intel.com>
