<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › vmwgfx › vmwgfx_drv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>vmwgfx_drv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright © 2009 VMware, Inc., Palo Alto, CA., USA</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the</span>
<span class="cm"> * &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="cm"> * without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="cm"> * distribute, sub license, and/or sell copies of the Software, and to</span>
<span class="cm"> * permit persons to whom the Software is furnished to do so, subject to</span>
<span class="cm"> * the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the</span>
<span class="cm"> * next paragraph) shall be included in all copies or substantial portions</span>
<span class="cm"> * of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL</span>
<span class="cm"> * THE COPYRIGHT HOLDERS, AUTHORS AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM,</span>
<span class="cm"> * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<span class="cm"> * OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE</span>
<span class="cm"> * USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> **************************************************************************/</span>

<span class="cp">#ifndef _VMWGFX_DRV_H_</span>
<span class="cp">#define _VMWGFX_DRV_H_</span>

<span class="cp">#include &quot;vmwgfx_reg.h&quot;</span>
<span class="cp">#include &quot;drmP.h&quot;</span>
<span class="cp">#include &quot;vmwgfx_drm.h&quot;</span>
<span class="cp">#include &quot;drm_hashtab.h&quot;</span>
<span class="cp">#include &quot;linux/suspend.h&quot;</span>
<span class="cp">#include &quot;ttm/ttm_bo_driver.h&quot;</span>
<span class="cp">#include &quot;ttm/ttm_object.h&quot;</span>
<span class="cp">#include &quot;ttm/ttm_lock.h&quot;</span>
<span class="cp">#include &quot;ttm/ttm_execbuf_util.h&quot;</span>
<span class="cp">#include &quot;ttm/ttm_module.h&quot;</span>
<span class="cp">#include &quot;vmwgfx_fence.h&quot;</span>

<span class="cp">#define VMWGFX_DRIVER_DATE &quot;20120209&quot;</span>
<span class="cp">#define VMWGFX_DRIVER_MAJOR 2</span>
<span class="cp">#define VMWGFX_DRIVER_MINOR 4</span>
<span class="cp">#define VMWGFX_DRIVER_PATCHLEVEL 0</span>
<span class="cp">#define VMWGFX_FILE_PAGE_OFFSET 0x00100000</span>
<span class="cp">#define VMWGFX_FIFO_STATIC_SIZE (1024*1024)</span>
<span class="cp">#define VMWGFX_MAX_RELOCATIONS 2048</span>
<span class="cp">#define VMWGFX_MAX_VALIDATIONS 2048</span>
<span class="cp">#define VMWGFX_MAX_DISPLAYS 16</span>
<span class="cp">#define VMWGFX_CMD_BOUNCE_INIT_SIZE 32768</span>

<span class="cp">#define VMW_PL_GMR TTM_PL_PRIV0</span>
<span class="cp">#define VMW_PL_FLAG_GMR TTM_PL_FLAG_PRIV0</span>

<span class="cp">#define VMW_RES_CONTEXT ttm_driver_type0</span>
<span class="cp">#define VMW_RES_SURFACE ttm_driver_type1</span>
<span class="cp">#define VMW_RES_STREAM ttm_driver_type2</span>
<span class="cp">#define VMW_RES_FENCE ttm_driver_type3</span>

<span class="k">struct</span> <span class="n">vmw_fpriv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_master</span> <span class="o">*</span><span class="n">locked_master</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">fence_events</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="n">base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">validate_list</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">gmr_bound</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cur_validate_node</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">on_validate_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_resource</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">kref</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">idr</span> <span class="o">*</span><span class="n">idr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ttm_object_type</span> <span class="n">res_type</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">avail</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">remove_from_lists</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hw_destroy</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">res_free</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">validate_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">query_head</span><span class="p">;</span> <span class="cm">/* Protected by the cmdbuf mutex */</span>
	<span class="cm">/* TODO is a generic snooper needed? */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	void (*snoop)(struct vmw_resource *res,</span>
<span class="c">		      struct ttm_object_file *tfile,</span>
<span class="c">		      SVGA3dCmdHeader *header);</span>
<span class="c">	void *snoop_priv;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_cursor_snooper</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">age</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">image</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_framebuffer</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">vmw_surface_offset</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">vmw_surface</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">vmw_resource</span> <span class="n">res</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lru_head</span><span class="p">;</span> <span class="cm">/* Protected by the resource lock */</span>
	<span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">format</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">mip_levels</span><span class="p">[</span><span class="n">DRM_VMW_MAX_SURFACE_FACES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">drm_vmw_size</span> <span class="o">*</span><span class="n">sizes</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">num_sizes</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">scanout</span><span class="p">;</span>

	<span class="cm">/* TODO so far just a extra pointer */</span>
	<span class="k">struct</span> <span class="n">vmw_cursor_snooper</span> <span class="n">snooper</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">backup</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_surface_offset</span> <span class="o">*</span><span class="n">offsets</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">backup_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timespec</span> <span class="n">lag</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timespec</span> <span class="n">lag_time</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_fifo_state</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved_size</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="o">*</span><span class="n">dynamic_buffer</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="o">*</span><span class="n">static_buffer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">static_buffer_size</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">using_bounce_buffer</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">capabilities</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">fifo_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rw_semaphore</span> <span class="n">rwsem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="n">marker_queue</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_relocation</span> <span class="p">{</span>
	<span class="n">SVGAGuestPtr</span> <span class="o">*</span><span class="n">location</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_sw_context</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">ida</span> <span class="n">bo_list</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">last_cid</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">cid_valid</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">kernel</span><span class="p">;</span> <span class="cm">/**&lt; is the called made from the kernel */</span>
	<span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">cur_ctx</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">last_sid</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">sid_translation</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">sid_valid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">validate_nodes</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_relocation</span> <span class="n">relocs</span><span class="p">[</span><span class="n">VMWGFX_MAX_RELOCATIONS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">cur_reloc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_validate_buffer</span> <span class="n">val_bufs</span><span class="p">[</span><span class="n">VMWGFX_MAX_VALIDATIONS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">cur_val_buf</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">cmd_bounce</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cmd_bounce_size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">resource_list</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">fence_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">query_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">cur_query_bo</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cur_query_cid</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">query_cid_valid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_legacy_display</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">vmw_overlay</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">vmw_master</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ttm_lock</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">fb_surf_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">fb_surf</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_vga_topology_state</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">width</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">height</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">primary</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pos_x</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pos_y</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vmw_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ttm_bo_device</span> <span class="n">bdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_bo_global_ref</span> <span class="n">bo_global_ref</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_global_reference</span> <span class="n">mem_global_ref</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">vmw_fifo_state</span> <span class="n">fifo</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vmw_chipset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">io_start</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vram_start</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vram_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">mmio_start</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">mmio_size</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">fb_max_width</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">fb_max_height</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">initial_width</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">initial_height</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mmio_virt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mmio_mtrr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">capabilities</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">max_gmr_descriptors</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">max_gmr_ids</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">max_gmr_pages</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">memory_size</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">has_gmr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">hw_mutex</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * VGA registers.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">vmw_vga_topology_state</span> <span class="n">vga_save</span><span class="p">[</span><span class="n">VMWGFX_MAX_DISPLAYS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">vga_width</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vga_height</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vga_bpp</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vga_bpl</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vga_pitchlock</span><span class="p">;</span>

	<span class="kt">uint32_t</span> <span class="n">num_displays</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Framebuffer info.</span>
<span class="cm">	 */</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_legacy_display</span> <span class="o">*</span><span class="n">ldu_priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_screen_object_display</span> <span class="o">*</span><span class="n">sou_priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_overlay</span> <span class="o">*</span><span class="n">overlay_priv</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Context and surface management.</span>
<span class="cm">	 */</span>

	<span class="n">rwlock_t</span> <span class="n">resource_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">idr</span> <span class="n">context_idr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">idr</span> <span class="n">surface_idr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">idr</span> <span class="n">stream_idr</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Block lastclose from racing with firstopen.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">init_mutex</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * A resource manager for kernel-only surfaces and</span>
<span class="cm">	 * contexts.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">ttm_object_device</span> <span class="o">*</span><span class="n">tdev</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Fencing and IRQs.</span>
<span class="cm">	 */</span>

	<span class="n">atomic_t</span> <span class="n">marker_seq</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">fence_queue</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">fifo_queue</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fence_queue_waiters</span><span class="p">;</span> <span class="cm">/* Protected by hw_mutex */</span>
	<span class="kt">int</span> <span class="n">goal_queue_waiters</span><span class="p">;</span> <span class="cm">/* Protected by hw_mutex */</span>
	<span class="n">atomic_t</span> <span class="n">fifo_queue_waiters</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">last_read_seqno</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">irq_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_fence_manager</span> <span class="o">*</span><span class="n">fman</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">irq_mask</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Device state</span>
<span class="cm">	 */</span>

	<span class="kt">uint32_t</span> <span class="n">traces_state</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">enable_state</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">config_done_state</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Execbuf</span>
<span class="cm">	 */</span>
	<span class="cm">/**</span>
<span class="cm">	 * Protected by the cmdbuf mutex.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">vmw_sw_context</span> <span class="n">ctx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">cmdbuf_mutex</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Operating mode.</span>
<span class="cm">	 */</span>

	<span class="n">bool</span> <span class="n">stealth</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">is_opened</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">enable_fb</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Master management.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">vmw_master</span> <span class="o">*</span><span class="n">active_master</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_master</span> <span class="n">fbdev_master</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">notifier_block</span> <span class="n">pm_nb</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">suspended</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">release_mutex</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">num_3d_resources</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Query processing. These members</span>
<span class="cm">	 * are protected by the cmdbuf mutex.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">dummy_query_bo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">pinned_bo</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">query_cid</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">dummy_query_bo_pinned</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Surface swapping. The &quot;surface_lru&quot; list is protected by the</span>
<span class="cm">	 * resource lock in order to be able to destroy a surface and take</span>
<span class="cm">	 * it off the lru atomically. &quot;used_memory_size&quot; is currently</span>
<span class="cm">	 * protected by the cmdbuf mutex for simplicity.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">surface_lru</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">used_memory_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="nf">vmw_priv</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">vmw_fpriv</span> <span class="o">*</span><span class="nf">vmw_fpriv</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_fpriv</span> <span class="o">*</span><span class="p">)</span><span class="n">file_priv</span><span class="o">-&gt;</span><span class="n">driver_priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">vmw_master</span> <span class="o">*</span><span class="nf">vmw_master</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_master</span> <span class="o">*</span><span class="n">master</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_master</span> <span class="o">*</span><span class="p">)</span> <span class="n">master</span><span class="o">-&gt;</span><span class="n">driver_priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vmw_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">io_start</span> <span class="o">+</span> <span class="n">VMWGFX_INDEX_PORT</span><span class="p">);</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">io_start</span> <span class="o">+</span> <span class="n">VMWGFX_VALUE_PORT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">uint32_t</span> <span class="nf">vmw_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">outl</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">io_start</span> <span class="o">+</span> <span class="n">VMWGFX_INDEX_PORT</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">io_start</span> <span class="o">+</span> <span class="n">VMWGFX_VALUE_PORT</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">vmw_3d_resource_inc</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="n">bool</span> <span class="n">unhide_svga</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vmw_3d_resource_dec</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="n">bool</span> <span class="n">hide_svga</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * GMR utilities - vmwgfx_gmr.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_gmr_bind</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">pages</span><span class="p">[],</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">num_pages</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">gmr_id</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_gmr_unbind</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">gmr_id</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Resource utilities - vmwgfx_resource.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">vmw_context_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_resource_unreference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">**</span><span class="n">p_res</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">vmw_resource_reference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_context_destroy_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_context_define_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_context_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">id</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">**</span><span class="n">p_res</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_user_lookup_handle</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
				  <span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">**</span><span class="n">out_surf</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">**</span><span class="n">out_buf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_surface_res_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">srf</span><span class="p">,</span>
			    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">res_free</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_user_surface_lookup_handle</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
					  <span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">**</span><span class="n">out</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_destroy_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_define_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_reference_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
			     <span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_surface_validate</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">srf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_dmabuf_bo_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">vmw_bo</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="o">*</span><span class="n">placement</span><span class="p">,</span>
			   <span class="n">bool</span> <span class="n">interuptable</span><span class="p">,</span>
			   <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">bo_free</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_alloc_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_unref_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">uint32_t</span> <span class="n">vmw_dmabuf_validate_node</span><span class="p">(</span><span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span>
					 <span class="kt">uint32_t</span> <span class="n">cur_validate_node</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_dmabuf_validate_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_user_dmabuf_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
				  <span class="kt">uint32_t</span> <span class="n">id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">**</span><span class="n">out</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_stream_claim_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_stream_unref_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_user_stream_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
				  <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">inout_id</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">**</span><span class="n">out</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_resource_unreserve</span><span class="p">(</span><span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">list</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * DMA buffer helper routines - vmwgfx_dmabuf.c</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_to_placement</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="o">*</span><span class="n">placement</span><span class="p">,</span>
				   <span class="n">bool</span> <span class="n">interruptible</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_to_vram</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			      <span class="n">bool</span> <span class="n">pin</span><span class="p">,</span> <span class="n">bool</span> <span class="n">interruptible</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_to_vram_or_gmr</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
				     <span class="n">bool</span> <span class="n">pin</span><span class="p">,</span> <span class="n">bool</span> <span class="n">interruptible</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_to_start_of_vram</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span>
				       <span class="n">bool</span> <span class="n">pin</span><span class="p">,</span> <span class="n">bool</span> <span class="n">interruptible</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dmabuf_unpin</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span>
			    <span class="n">bool</span> <span class="n">interruptible</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_bo_get_guest_ptr</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
				 <span class="n">SVGAGuestPtr</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_bo_pin</span><span class="p">(</span><span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span> <span class="n">bool</span> <span class="n">pin</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Misc Ioctl functionality - vmwgfx_ioctl.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_getparam_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_get_cap_3d_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_present_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_present_readback_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vmw_fops_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">filp</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">poll_table_struct</span> <span class="o">*</span><span class="n">wait</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">vmw_fops_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">filp</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Fifo utilities - vmwgfx_fifo.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_fifo_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">vmw_fifo_state</span> <span class="o">*</span><span class="n">fifo</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_fifo_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">vmw_fifo_state</span> <span class="o">*</span><span class="n">fifo</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="o">*</span><span class="n">vmw_fifo_reserve</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bytes</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_fifo_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bytes</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_fifo_send_fence</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			       <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">seqno</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_fifo_ping_host</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">reason</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">vmw_fifo_have_3d</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">vmw_fifo_have_pitchlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_fifo_emit_dummy_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				     <span class="kt">uint32_t</span> <span class="n">cid</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * TTM glue - vmwgfx_ttm_glue.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_ttm_global_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_ttm_global_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_mmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">filp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * TTM buffer object driver - vmwgfx_buffer.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_vram_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_vram_ne_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_vram_sys_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_vram_gmr_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_vram_gmr_ne_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_sys_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_evictable_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_placement</span> <span class="n">vmw_srf_placement</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ttm_bo_driver</span> <span class="n">vmw_bo_driver</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_dma_quiescent</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Command submission - vmwgfx_execbuf.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_execbuf_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_execbuf_process</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_commands</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">kernel_commands</span><span class="p">,</span>
			       <span class="kt">uint32_t</span> <span class="n">command_size</span><span class="p">,</span>
			       <span class="kt">uint64_t</span> <span class="n">throttle_us</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">drm_vmw_fence_rep</span> <span class="n">__user</span>
			       <span class="o">*</span><span class="n">user_fence_rep</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">vmw_fence_obj</span> <span class="o">**</span><span class="n">out_fence</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span>
<span class="n">vmw_execbuf_release_pinned_bo</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			      <span class="n">bool</span> <span class="n">only_on_cid_match</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">cid</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_execbuf_fence_commands</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">vmw_fence_obj</span> <span class="o">**</span><span class="n">p_fence</span><span class="p">,</span>
				      <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">p_handle</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_execbuf_copy_fence_user</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">vmw_fpriv</span> <span class="o">*</span><span class="n">vmw_fp</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">ret</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">drm_vmw_fence_rep</span> <span class="n">__user</span>
					<span class="o">*</span><span class="n">user_fence_rep</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">vmw_fence_obj</span> <span class="o">*</span><span class="n">fence</span><span class="p">,</span>
					<span class="kt">uint32_t</span> <span class="n">fence_handle</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * IRQs and wating - vmwgfx_irq.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="n">irqreturn_t</span> <span class="n">vmw_irq_handler</span><span class="p">(</span><span class="n">DRM_IRQ_ARGS</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_wait_seqno</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="n">bool</span> <span class="n">lazy</span><span class="p">,</span>
			     <span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">,</span> <span class="n">bool</span> <span class="n">interruptible</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeout</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_irq_preinstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_irq_postinstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_irq_uninstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">vmw_seqno_passed</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_fallback_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			     <span class="n">bool</span> <span class="n">lazy</span><span class="p">,</span>
			     <span class="n">bool</span> <span class="n">fifo_idle</span><span class="p">,</span>
			     <span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">,</span>
			     <span class="n">bool</span> <span class="n">interruptible</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeout</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_update_seqno</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">vmw_fifo_state</span> <span class="o">*</span><span class="n">fifo_state</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_seqno_waiter_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_seqno_waiter_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_goal_waiter_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_goal_waiter_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Rudimentary fence-like objects currently used only for throttling -</span>
<span class="cm"> * vmwgfx_marker.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_marker_queue_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vmw_marker_queue_takedown</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_marker_push</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">,</span>
			  <span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_marker_pull</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">,</span>
			  <span class="kt">uint32_t</span> <span class="n">signaled_seqno</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">vmw_wait_lag</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">vmw_marker_queue</span> <span class="o">*</span><span class="n">queue</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">us</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Kernel framebuffer - vmwgfx_fb.c</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="n">vmw_fb_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_fb_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_fb_off</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_fb_on</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Kernel modesetting - vmwgfx_kms.c</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="n">vmw_kms_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_save_vga</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_restore_vga</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_cursor_bypass_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vmw_kms_cursor_post_execbuf</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vmw_kms_cursor_snoop</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">srf</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ttm_object_file</span> <span class="o">*</span><span class="n">tfile</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span><span class="p">,</span>
			  <span class="n">SVGA3dCmdHeader</span> <span class="o">*</span><span class="n">header</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_write_svga</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">vmw_priv</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="n">width</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">height</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">pitch</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="n">bpp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">depth</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vmw_kms_idle_workqueues</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_master</span> <span class="o">*</span><span class="n">vmaster</span><span class="p">);</span>
<span class="n">bool</span> <span class="n">vmw_kms_validate_mode_vram</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="n">pitch</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="n">height</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">vmw_get_vblank_counter</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_enable_vblank</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vmw_disable_vblank</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_present</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">vmw_framebuffer</span> <span class="o">*</span><span class="n">vfb</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">surface</span><span class="p">,</span>
		    <span class="kt">uint32_t</span> <span class="n">sid</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">destX</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="n">destY</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">drm_vmw_rect</span> <span class="o">*</span><span class="n">clips</span><span class="p">,</span>
		    <span class="kt">uint32_t</span> <span class="n">num_clips</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_readback</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">vmw_framebuffer</span> <span class="o">*</span><span class="n">vfb</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">drm_vmw_fence_rep</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_fence_rep</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">drm_vmw_rect</span> <span class="o">*</span><span class="n">clips</span><span class="p">,</span>
		     <span class="kt">uint32_t</span> <span class="n">num_clips</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_kms_update_layout_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Overlay control - vmwgfx_overlay.c</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="n">vmw_overlay_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_stop_all</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_resume_all</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_pause_all</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_claim</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">out</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_unref</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">stream_id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_num_overlays</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vmw_overlay_num_free_overlays</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * GMR Id manager</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ttm_mem_type_manager_func</span> <span class="n">vmw_gmrid_manager_func</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * Inline helper functions</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vmw_surface_unreference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">**</span><span class="n">srf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">tmp_srf</span> <span class="o">=</span> <span class="o">*</span><span class="n">srf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vmw_resource</span> <span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tmp_srf</span><span class="o">-&gt;</span><span class="n">res</span><span class="p">;</span>
	<span class="o">*</span><span class="n">srf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">vmw_resource_unreference</span><span class="p">(</span><span class="o">&amp;</span><span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="nf">vmw_surface_reference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_surface</span> <span class="o">*</span><span class="n">srf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">vmw_resource_reference</span><span class="p">(</span><span class="o">&amp;</span><span class="n">srf</span><span class="o">-&gt;</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">srf</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">vmw_dmabuf_unreference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">**</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">tmp_buf</span> <span class="o">=</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ttm_buffer_object</span> <span class="o">*</span><span class="n">bo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tmp_buf</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">;</span>
	<span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">ttm_bo_unref</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="nf">vmw_dmabuf_reference</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_dma_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ttm_bo_reference</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ttm_mem_global</span> <span class="o">*</span><span class="nf">vmw_mem_glob</span><span class="p">(</span><span class="k">struct</span> <span class="n">vmw_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ttm_mem_global</span> <span class="o">*</span><span class="p">)</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">mem_global_ref</span><span class="p">.</span><span class="n">object</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
