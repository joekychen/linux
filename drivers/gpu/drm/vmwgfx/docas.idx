f | vmwgfx_gmr.c | s | 7.0K | 225 | Thomas Hellstrom | thellstrom@vmware.com | 1338566420 |  | drm/vmwgfx: Fix nasty write past alloced memory area  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_fence.c | s | 30K | 969 | Thomas Hellstrom | thellstrom@vmware.com | 1329134492 |  | vmwgfx: Clean up pending event references to struct drm_file objects on close  Pending events may have stale pointer references to struct drm_file objects after a file has been closed, but before the event is supposed to be attached to the drm file. Remove such events on file close.  Tested with "modetest".  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_overlay.c | s | 14K | 502 | Thomas Hellstrom | thellstrom@vmware.com | 1317806240 |  | vmwgfx: minor dmabuf utilities cleanup  Add / fix some function comments. Don't move out an fbdev framebuffer when unused. Just unpin. Only have a single function that computes a SVGAGuestPtr from the buffer's current placement, and make it more versatile by accepting a struct ttm_buffer_object  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | Makefile | g | 383B |  | Jakob Bornecrantz | jakob@vmware.com | 1317806234 |  | vmwgfx: Add screen object support  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_fb.c | s | 15K | 543 | Jakob Bornecrantz | jakob@vmware.com | 1329134495 |  | vmwgfx: Pick up the initial size from the width and height regs  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_ioctl.c | s | 8.9K | 283 | Jakob Bornecrantz | jakob@vmware.com | 1324303561 |  | vmwgfx: Remove dmabuf check in present ioctl  Doesn't protect any error code and only gets in the way of debugging.  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Reviewed-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_dmabuf.c | s | 8.9K | 276 | Thomas Hellstrom | thellstrom@vmware.com | 1317806242 |  | vmwgfx: Fix up query processing  Previously, query results could be placed in any buffer object, but since we didn't allow pinned buffer objects, query results could be written when that buffer was evicted, corrupting data in other buffers.  Now, require that buffers holding query results are no more than two pages large, and allow one single pinned such buffer. When the command submission code encounters query result structures in other buffers, the queries in the pinned buffer will be finished using a query barrier for the last hardware context using the buffer. Also if the command submission code detects that a new hardware context is used for queries, all queries of the previous hardware context is also flushed. Currently we use waiting for a no-op occlusion query as a query barrier for a specific context.  The query buffer is also flushed and unpinned on context destructions, master drops and before scanout bo placement.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_reg.h | s | 1.8K | 47 | Jakob Bornecrantz | jakob@vmware.com | 1260830323 |  | drm/vmwgfx: Add DRM driver for VMware Virtual GPU  This commit adds the vmwgfx driver for the VWware Virtual GPU aka SVGA. The driver is under staging the same as Nouveau and Radeon KMS. Hopefully the 2D ioctls are bug free and don't need changing, so that part of the API should be stable. But there there is a pretty big chance that the 3D API will change in the future.  Signed-off-by: Thomas Hellström <thellstrom@vmware.com> Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_kms.h | s | 5.2K | 141 | Jakob Bornecrantz | jakob@vmware.com | 1329134495 |  | vmwgfx: Add page flip support  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Reviewed-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_ldu.c | s | 11K | 350 | Jakob Bornecrantz | jakob@vmware.com | 1329134495 |  | vmwgfx: Pick up the initial size from the width and height regs  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_irq.c | s | 8.7K | 266 | Thomas Hellstrom | thellstrom@vmware.com | 1318258015 |  | vmwgfx: Add fence events  Add a way to send DRM events down the gpu fifo by attaching them to fence objects. This may be useful for Xserver swapbuffer throttling and page-flip done notifications.  Bump version to 2.2 to signal the availability of the FENCE_EVENT ioctl.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | svga_escape.h | s | 2.8K | 76 | Jakob Bornecrantz | jakob@vmware.com | 1317806228 |  | vmwgfx: Update register files to latest from vmware-sdk  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_fence.h | s | 3.9K | 97 | Thomas Hellstrom | thellstrom@vmware.com | 1329134496 |  | vmwgfx: Move function declaration to correct header  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | svga_reg.h | s | 52K | 1401 | Jakob Bornecrantz | jakob@vmware.com | 1317806228 |  | vmwgfx: Update register files to latest from vmware-sdk  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_resource.c | s | 47K | 1590 | Dave Airlie | airlied@redhat.com | 1337766387 |  | ttm: add prime sharing support to TTM (v2)  This adds the ability for ttm common code to take an SG table and use it as the backing for a slave TTM object.  The drivers can then populate their GTT tables using the SG object.  v2: make sure to setup VM for sg bos as well.  Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_ttm_glue.c | s | 3.2K | 85 | Thomas Hellstrom | thellstrom@vmware.com | 1315306114 |  | vmwgfx: Remove the possibility to map the fifo from user-space  This was previously used by user-space to check whether a fence sequence had passed or not. With fence objects that's not needed anymore.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_drv.h | s | 21K | 616 | Thomas Hellstrom | thellstrom@vmware.com | 1329134497 |  | drm/vmwgfx: Bump driver minor  Bump driver minor to signal availability of the page-flip ioctl.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_fifo.c | s | 15K | 473 | Thomas Hellstrom | thellstrom@vmware.com | 1324303560 |  | vmwgfx: Use the revised fifo hw version register when present  The driver implements the needed resource management required to use that register.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_execbuf.c | s | 37K | 1157 | Jakob Bornecrantz | jakob@vmware.com | 1329134493 |  | vmwgfx: Make it possible to get fence from execbuf  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Reviewed-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | svga_types.h | s | 1.8K | 41 | Jakob Bornecrantz | jakob@vmware.com | 1260830316 |  | drm/vmwgfx: Add svga headers for vmwgfx driver  These headers are shared between multiple place where different coding standards apply. They will be fixed up at a later time.  Signed-off-by: Thomas Hellström <thellstrom@vmware.com> Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_buffer.c | s | 9.3K | 305 | Jerome Glisse | jglisse@redhat.com | 1323168002 |  | drm/ttm: isolate dma data from ttm_tt V4  Move dma data to a superset ttm_dma_tt structure which herit from ttm_tt. This allow driver that don't use dma functionalities to not have to waste memory for it.  V2 Rebase on top of no memory account changes (where/when is my    delorean when i need it ?) V3 Make sure page list is initialized empty V4 typo/syntax fixes  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Thomas Hellstrom <thellstrom@vmware.com>
f | Kconfig | g | 435B |  | Thomas Hellstrom | thellstrom@vmware.com | 1318334796 |  | vmwgfx: Take the driver out of staging  Also improve a bit on the Kconfig help.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | svga_overlay.h | s | 4.9K | 163 | Jakob Bornecrantz | jakob@vmware.com | 1317806228 |  | vmwgfx: Update register files to latest from vmware-sdk  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_marker.c | s | 4.3K | 142 | Thomas Hellstrom | thellstrom@vmware.com | 1315306120 |  | vmwgfx: Fix confusion caused by using "fence" in various places  This is needed before we introduce the fence objects. Otherwise this will be even more confusing. The plan is to use the following:  seqno: A 32-bit sequence number that may be passed in the fifo. marker: Objects, carrying a seqno, that track fifo submission time. They are used for fifo lag based throttling. fence objects: Kernel space objects, possibly accessible from user-space and carrying a 32-bit seqno together with signaled status.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_kms.c | s | 54K | 1695 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1337679307 |  | drm: Constify drm_mode_config_funcs pointer  The DRM mode config functions structure declared by drivers and pointed to by the drm_mode_config funcs field is never modified. Make it a const pointer.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Cc: Inki Dae <inki.dae@samsung.com> Cc: Alan Cox <alan@linux.intel.com> Cc: Daniel Vetter <daniel.vetter@ffwll.ch> Cc: Ben Skeggs <bskeggs@redhat.com> Cc: Thomas Hellstrom <thellstrom@vmware.com> Cc: Rob Clark <rob.clark@linaro.org> Reviwed-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_drv.c | s | 33K | 1029 | Linus Torvalds | torvalds@linux-foundation.org | 1332446902 |  | Merge branch 'drm-next' of git://people.freedesktop.org/~airlied/linux  Pull drm main changes from Dave Airlie:  "This is the main drm pull request, I'm probably going to send two more   smaller ones, will explain below.    This contains a patch that is also in the fbdev tree, but it should be   the same patch, it added an API for hot unplugging framebuffer   devices, and I need that API for a new driver.    It also contains some changes to the i2c tree which Jean has acked,   and one change to moorestown platform stuff in x86.    Highlights:    - new drivers: UDL driver for USB displaylink devices, kms only,      should support correct hotplug operations.    - core: i2c speedups + better hotplug support, EDID overriding via      firmware interface - allows user to load a firmware for a broken      monitor/kvm from userspace, it even has documentation for it.    - exynos: new HDMI audio + hdmi 1.4 + virtual output driver    - gma500: code cleanup    - radeon: cleanups, CS optimisations, streamout support and pageflip      fix    - nouveau: NVD9 displayport support + more reclocking work    - i915: re-enabling GMBUS, finish gpu patch (might help hibernation      who knows), missed irq fixes, stencil tiling fixes, interlaced      support, aliasesd PPGTT support for SNB/IVB, swizzling for SNB/IVB,      semaphore fixes    As well as the usual bunch of cleanups and fixes all over the place.    I've got two things I'd like to merge a bit later:     a) AMD support for all their new radeonhd 7000 series GPU and APUs.       AMD dropped this a bit late due to insane internal review       processes, (please AMD just follow Intel and let open source guys       ship stuff early) however I don't want to penalise people who own       this hardware (since its been on sale for 3-4 months and GPU hw       doesn't exactly have a lifetime in years) and consign them to       using closed drivers for longer than necessary.  The changes are       well contained and just plug into the driver new gpu functionality       so they should be fairly regression proof.  I just want to give       them a bit of a run on the hw AMD kindly sent me.     b) drm prime/dma-buf interface code.  This is just infrastructure       code to expose the dma-buf stuff to drm drivers and to userspace.       I'm not planning on pushing any driver support in this cycle       (except maybe exynos), but I'd like to get the infrastructure code       in so for the next cycle I can start getting the driver support       into the individual drivers.  We have started driver support for       i915, nouveau and udl along with I think exynos and omap in       staging.  However this code relies on the dma-buf tree being       pulled into your tree first since it needs the latest interfaces       from that tree.  I'll push to get that tree sent asap.    (oh and any warnings you see in i915 are gcc's fault from what anyone   can see)."  Fix up trivial conflicts in arch/x86/platform/mrst/mrst.c due to the new msic_thermal_platform_data() thermal function being added next to the tc35876x_platform_data() i2c device function..  * 'drm-next' of git://people.freedesktop.org/~airlied/linux: (326 commits)   drm/i915: use DDC_ADDR instead of hard-coding it   drm/radeon: use DDC_ADDR instead of hard-coding it   drm: remove unneeded redefinition of DDC_ADDR   drm/exynos: added virtual display driver.   drm: allow loading an EDID as firmware to override broken monitor   drm/exynos: enable hdmi audio feature   drm/exynos: add default pixel format for plane   drm/exynos: cleanup exynos_hdmi.h   drm/exynos: add is_local member in exynos_drm_subdrv struct   drm/exynos: add subdrv open/close functions   drm/exynos: remove module of exynos drm subdrv   drm/exynos: release pending pageflip events when closed   drm/exynos: added new funtion to get/put dma address.   drm/exynos: update gem and buffer framework.   drm/exynos: added mode_fixup feature and code clean.   drm/exynos: add HDMI version 1.4 support   drm/exynos: remove exynos_mixer.h   gma500: Fix mmap frambuffer   drm/radeon: Drop radeon_gem_object_(un)pin.   drm/radeon: Restrict offset for legacy display engine.   ...
f | vmwgfx_scrn.c | s | 13K | 459 | Jakob Bornecrantz | jakob@vmware.com | 1329134495 |  | vmwgfx: Pick up the initial size from the width and height regs  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | svga3d_reg.h | s | 65K | 1688 | Jakob Bornecrantz | jakob@vmware.com | 1317806228 |  | vmwgfx: Update register files to latest from vmware-sdk  Signed-off-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | vmwgfx_gmrid_manager.c | s | 4.3K | 141 | Thomas Hellstrom | thellstrom@vmware.com | 1314866287 |  | vmwgfx: Restrict number of GMR pages to device limit  When GMR2 is available, make sure we restrict the number of used GMR pages to the limit indicated by the device. This is done by failing a GMRID allocation if the total number of GMR pages exceeds the limit. As a result TTM will then start evicting buffers in GMR memory on a LRU basis until the allocation succeeds.  Signed-off-by: Thomas Hellstrom <thellstrom@vmware.com> Reviewed-by: Jakob Bornecrantz <jakob@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
