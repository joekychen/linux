<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › radeon › r200.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>r200.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright 2008 Advanced Micro Devices, Inc.</span>
<span class="cm"> * Copyright 2008 Red Hat Inc.</span>
<span class="cm"> * Copyright 2009 Jerome Glisse.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice shall be included in</span>
<span class="cm"> * all copies or substantial portions of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</span>
<span class="cm"> * THE COPYRIGHT HOLDER(S) OR AUTHOR(S) BE LIABLE FOR ANY CLAIM, DAMAGES OR</span>
<span class="cm"> * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span>
<span class="cm"> * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span>
<span class="cm"> * OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Dave Airlie</span>
<span class="cm"> *          Alex Deucher</span>
<span class="cm"> *          Jerome Glisse</span>
<span class="cm"> */</span>
<span class="cp">#include &quot;drmP.h&quot;</span>
<span class="cp">#include &quot;drm.h&quot;</span>
<span class="cp">#include &quot;radeon_drm.h&quot;</span>
<span class="cp">#include &quot;radeon_reg.h&quot;</span>
<span class="cp">#include &quot;radeon.h&quot;</span>
<span class="cp">#include &quot;radeon_asic.h&quot;</span>

<span class="cp">#include &quot;r100d.h&quot;</span>
<span class="cp">#include &quot;r200_reg_safe.h&quot;</span>

<span class="cp">#include &quot;r100_track.h&quot;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">r200_get_vtx_size_0</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">vtx_fmt_0</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">vtx_size</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">vtx_size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_Z0</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_W0</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="cm">/* blend weight */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="n">R200_VTX_WEIGHT_COUNT_SHIFT</span><span class="p">))</span>
		<span class="n">vtx_size</span> <span class="o">+=</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&gt;&gt;</span> <span class="n">R200_VTX_WEIGHT_COUNT_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_PV_MATRIX_SEL</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_N0</span><span class="p">)</span>
		<span class="n">vtx_size</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_POINT_SIZE</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_DISCRETE_FOG</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_SHININESS_0</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_SHININESS_1</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">color_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">11</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">color_size</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="n">vtx_size</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>: <span class="n">vtx_size</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_XY1</span><span class="p">)</span>
		<span class="n">vtx_size</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_Z1</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_W1</span><span class="p">)</span>
		<span class="n">vtx_size</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vtx_fmt_0</span> <span class="o">&amp;</span> <span class="n">R200_VTX_N1</span><span class="p">)</span>
		<span class="n">vtx_size</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">vtx_size</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">r200_copy_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">radeon_device</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span>
		  <span class="kt">uint64_t</span> <span class="n">src_offset</span><span class="p">,</span>
		  <span class="kt">uint64_t</span> <span class="n">dst_offset</span><span class="p">,</span>
		  <span class="kt">unsigned</span> <span class="n">num_gpu_pages</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">radeon_fence</span> <span class="o">*</span><span class="n">fence</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">radeon_ring</span> <span class="o">*</span><span class="n">ring</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">ring</span><span class="p">[</span><span class="n">RADEON_RING_TYPE_GFX_INDEX</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">cur_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">num_loops</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* radeon pitch is /64 */</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">num_gpu_pages</span> <span class="o">&lt;&lt;</span> <span class="n">RADEON_GPU_PAGE_SHIFT</span><span class="p">;</span>
	<span class="n">num_loops</span> <span class="o">=</span> <span class="n">DIV_ROUND_UP</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="mh">0x1FFFFF</span><span class="p">);</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">radeon_ring_lock</span><span class="p">(</span><span class="n">rdev</span><span class="p">,</span> <span class="n">ring</span><span class="p">,</span> <span class="n">num_loops</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">64</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;radeon: moving bo (%d).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Must wait for 2D idle &amp; clean before DMA or hangs might happen */</span>
	<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">PACKET0</span><span class="p">(</span><span class="n">RADEON_WAIT_UNTIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_loops</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cur_size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cur_size</span> <span class="o">&gt;</span> <span class="mh">0x1FFFFF</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cur_size</span> <span class="o">=</span> <span class="mh">0x1FFFFF</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">size</span> <span class="o">-=</span> <span class="n">cur_size</span><span class="p">;</span>
		<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">PACKET0</span><span class="p">(</span><span class="mh">0x720</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
		<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">src_offset</span><span class="p">);</span>
		<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">dst_offset</span><span class="p">);</span>
		<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">cur_size</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">));</span>
		<span class="n">src_offset</span> <span class="o">+=</span> <span class="n">cur_size</span><span class="p">;</span>
		<span class="n">dst_offset</span> <span class="o">+=</span> <span class="n">cur_size</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">PACKET0</span><span class="p">(</span><span class="n">RADEON_WAIT_UNTIL</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">radeon_ring_write</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">RADEON_WAIT_DMA_GUI_IDLE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fence</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">radeon_fence_emit</span><span class="p">(</span><span class="n">rdev</span><span class="p">,</span> <span class="n">fence</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">radeon_ring_unlock_commit</span><span class="p">(</span><span class="n">rdev</span><span class="p">,</span> <span class="n">ring</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">r200_get_vtx_size_1</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">vtx_fmt_1</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">vtx_size</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tex_size</span><span class="p">;</span>
	<span class="n">vtx_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tex_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">vtx_fmt_1</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tex_size</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">vtx_size</span> <span class="o">+=</span> <span class="n">tex_size</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">vtx_size</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">r200_packet0_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">radeon_cs_parser</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">radeon_cs_packet</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="n">idx</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">radeon_cs_reloc</span> <span class="o">*</span><span class="n">reloc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r100_cs_track</span> <span class="o">*</span><span class="n">track</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ib</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">r</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">face</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tile_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">idx_value</span><span class="p">;</span>

	<span class="n">ib</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ib</span><span class="p">.</span><span class="n">ptr</span><span class="p">;</span>
	<span class="n">track</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r100_cs_track</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">track</span><span class="p">;</span>
	<span class="n">idx_value</span> <span class="o">=</span> <span class="n">radeon_get_ib_value</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RADEON_CRTC_GUI_TRIG_VLINE</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_parse_vline</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
		<span class="cm">/* FIXME: only allow PACKET3 blit? easier to check for out of</span>
<span class="cm">		 * range access */</span>
	<span class="k">case</span> <span class="n">RADEON_DST_PITCH_OFFSET</span>:
	<span class="k">case</span> <span class="n">RADEON_SRC_PITCH_OFFSET</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_reloc_pitch_offset</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_DEPTHOFFSET</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb</span><span class="p">.</span><span class="n">robj</span> <span class="o">=</span> <span class="n">reloc</span><span class="o">-&gt;</span><span class="n">robj</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb</span><span class="p">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_COLOROFFSET</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">robj</span> <span class="o">=</span> <span class="n">reloc</span><span class="o">-&gt;</span><span class="n">robj</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">offset</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXOFFSET_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXOFFSET_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">;</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">cs_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_CS_KEEP_TILING_FLAGS</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">tiling_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_TILING_MACRO</span><span class="p">)</span>
				<span class="n">tile_flags</span> <span class="o">|=</span> <span class="n">R200_TXO_MACRO_TILE</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">tiling_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_TILING_MICRO</span><span class="p">)</span>
				<span class="n">tile_flags</span> <span class="o">|=</span> <span class="n">R200_TXO_MICRO_TILE</span><span class="p">;</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">tmp</span> <span class="o">|=</span> <span class="n">tile_flags</span><span class="p">;</span>
			<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">robj</span> <span class="o">=</span> <span class="n">reloc</span><span class="o">-&gt;</span><span class="n">robj</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F1_5</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F2_5</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F3_5</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F4_5</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_OFFSET_F5_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXOFFSET_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">;</span>
		<span class="n">face</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="p">((</span><span class="n">i</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="n">R200_PP_TXOFFSET_0</span><span class="p">))</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="n">face</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">offset</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>
		<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="n">face</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">robj</span> <span class="o">=</span> <span class="n">reloc</span><span class="o">-&gt;</span><span class="n">robj</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RE_WIDTH_HEIGHT</span>:
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">maxy</span> <span class="o">=</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7FF</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_COLORPITCH</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">cs_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_CS_KEEP_TILING_FLAGS</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">tiling_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_TILING_MACRO</span><span class="p">)</span>
				<span class="n">tile_flags</span> <span class="o">|=</span> <span class="n">RADEON_COLOR_TILE_ENABLE</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">tiling_flags</span> <span class="o">&amp;</span> <span class="n">RADEON_TILING_MICRO</span><span class="p">)</span>
				<span class="n">tile_flags</span> <span class="o">|=</span> <span class="n">RADEON_COLOR_MICROTILE_ENABLE</span><span class="p">;</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
			<span class="n">tmp</span> <span class="o">|=</span> <span class="n">tile_flags</span><span class="p">;</span>
			<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>

		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_COLORPITCH_MASK</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_DEPTHPITCH</span>:
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb</span><span class="p">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_DEPTHPITCH_MASK</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_CNTL</span>:
		<span class="k">switch</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="n">RADEON_RB3D_COLOR_FORMAT_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">7</span>:
		<span class="k">case</span> <span class="mi">8</span>:
		<span class="k">case</span> <span class="mi">9</span>:
		<span class="k">case</span> <span class="mi">11</span>:
		<span class="k">case</span> <span class="mi">12</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
		<span class="k">case</span> <span class="mi">4</span>:
		<span class="k">case</span> <span class="mi">15</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">6</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;Invalid color buffer format (%d) !</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="n">RADEON_RB3D_COLOR_FORMAT_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">));</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_DEPTHXY_OFFSET_ENABLE</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No support for depth xy offset in kms</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">track</span><span class="o">-&gt;</span><span class="n">z_enabled</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_Z_ENABLE</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">cb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_ZSTENCILCNTL</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb</span><span class="p">.</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
		<span class="k">case</span> <span class="mi">3</span>:
		<span class="k">case</span> <span class="mi">4</span>:
		<span class="k">case</span> <span class="mi">5</span>:
		<span class="k">case</span> <span class="mi">9</span>:
		<span class="k">case</span> <span class="mi">11</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb</span><span class="p">.</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">zb_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_RB3D_ZPASS_ADDR</span>:
		<span class="n">r</span> <span class="o">=</span> <span class="n">r100_cs_packet_next_reloc</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reloc</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">DRM_ERROR</span><span class="p">(</span><span class="s">&quot;No reloc for ib[%d]=0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">idx</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">r100_cs_dump_packet</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pkt</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ib</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">reloc</span><span class="o">-&gt;</span><span class="n">lobj</span><span class="p">.</span><span class="n">gpu_offset</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_PP_CNTL</span>:
		<span class="p">{</span>
			<span class="kt">uint32_t</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">track</span><span class="o">-&gt;</span><span class="n">num_texture</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enabled</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">));</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RADEON_SE_VF_CNTL</span>:
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">vap_vf_cntl</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x210c</span>:
		<span class="cm">/* VAP_VF_MAX_VTX_INDX */</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">max_indx</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="mh">0x00FFFFFFUL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_SE_VTX_FMT_0</span>:
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">vtx_size</span> <span class="o">=</span> <span class="n">r200_get_vtx_size_0</span><span class="p">(</span><span class="n">idx_value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_SE_VTX_FMT_1</span>:
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">vtx_size</span> <span class="o">+=</span> <span class="n">r200_get_vtx_size_1</span><span class="p">(</span><span class="n">idx_value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXSIZE_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXSIZE_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_TEX_USIZE_MASK</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_TEX_VSIZE_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">RADEON_TEX_VSIZE_SHIFT</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXPITCH_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXPITCH_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pitch</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFILTER_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXFILTER_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">num_levels</span> <span class="o">=</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">R200_MAX_MIP_LEVEL_MASK</span><span class="p">)</span>
						 <span class="o">&gt;&gt;</span> <span class="n">R200_MAX_MIP_LEVEL_SHIFT</span><span class="p">);</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">roundup_w</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">27</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">roundup_h</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXMULTI_CTL_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXMULTI_CTL_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_X_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXFORMAT_X_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">txdepth</span> <span class="o">=</span> <span class="n">idx_value</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
		<span class="cm">/* 2D, 3D, CUBE */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">case</span> <span class="mi">3</span>:
		<span class="k">case</span> <span class="mi">4</span>:
		<span class="k">case</span> <span class="mi">5</span>:
		<span class="k">case</span> <span class="mi">6</span>:
		<span class="k">case</span> <span class="mi">7</span>:
			<span class="cm">/* 1D/2D */</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tex_coord_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="cm">/* CUBE */</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tex_coord_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="cm">/* 3D */</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tex_coord_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_TXFORMAT_5</span>:
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_TXFORMAT_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">R200_TXFORMAT_NON_POWER2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">use_pitch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">use_pitch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="n">RADEON_TXFORMAT_WIDTH_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RADEON_TXFORMAT_WIDTH_MASK</span><span class="p">);</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="n">RADEON_TXFORMAT_HEIGHT_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">RADEON_TXFORMAT_HEIGHT_MASK</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">R200_TXFORMAT_LOOKUP_DISABLE</span><span class="p">)</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">lookup_disable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&amp;</span> <span class="n">RADEON_TXFORMAT_FORMAT_MASK</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">R200_TXFORMAT_I8</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_RGB332</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_Y8</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">compress_format</span> <span class="o">=</span> <span class="n">R100_TRACK_COMP_NONE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">R200_TXFORMAT_AI88</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_ARGB1555</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_RGB565</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_ARGB4444</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_VYUY422</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_YVYU422</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_LDVDU655</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_DVDU88</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_AVYU4444</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">compress_format</span> <span class="o">=</span> <span class="n">R100_TRACK_COMP_NONE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">R200_TXFORMAT_ARGB8888</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_RGBA8888</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_ABGR8888</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_BGR111110</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_LDVDU8888</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">compress_format</span> <span class="o">=</span> <span class="n">R100_TRACK_COMP_NONE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">R200_TXFORMAT_DXT1</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">compress_format</span> <span class="o">=</span> <span class="n">R100_TRACK_COMP_DXT1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">R200_TXFORMAT_DXT23</span>:
		<span class="k">case</span> <span class="n">R200_TXFORMAT_DXT45</span>:
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cpp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">compress_format</span> <span class="o">=</span> <span class="n">R100_TRACK_COMP_DXT1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">idx_value</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_0</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_1</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_2</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_3</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_4</span>:
	<span class="k">case</span> <span class="n">R200_PP_CUBIC_FACES_5</span>:
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">idx_value</span><span class="p">;</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">R200_PP_CUBIC_FACES_0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">face</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">face</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">face</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="n">face</span><span class="p">].</span><span class="n">width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">face</span> <span class="o">*</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
			<span class="n">track</span><span class="o">-&gt;</span><span class="n">textures</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cube_info</span><span class="p">[</span><span class="n">face</span><span class="p">].</span><span class="n">height</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="n">face</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">track</span><span class="o">-&gt;</span><span class="n">tex_dirty</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Forbidden register 0x%04X in cs at %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">reg</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">r200_set_safe_registers</span><span class="p">(</span><span class="k">struct</span> <span class="n">radeon_device</span> <span class="o">*</span><span class="n">rdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rdev</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">.</span><span class="n">r100</span><span class="p">.</span><span class="n">reg_safe_bm</span> <span class="o">=</span> <span class="n">r200_reg_safe_bm</span><span class="p">;</span>
	<span class="n">rdev</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">.</span><span class="n">r100</span><span class="p">.</span><span class="n">reg_safe_bm_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">r200_reg_safe_bm</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
