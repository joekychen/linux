f | r600_reg.h | s | 6.8K | 144 | Alex Deucher | alexander.deucher@amd.com | 1337253340 |  | drm/radeon/hdmi: store info about all AFMT blocks  Introduce special struct radeon_afmt for this purpose.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_cs.c | s | 17K | 592 | Alex Deucher | alexander.deucher@amd.com | 1338566421 |  | drm/radeon: fix regression in UMS CS ioctl  radeon_cs_parser_init is called by both the legacy UMS CS ioctl and the KMS CS ioctl.  Protect KMS specific pieces of the code by checking that rdev is not NULL.  Reported-by: Michael Burian <michael.burian@sbg.at>  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreend.h | s | 91K | 1788 | Alex Deucher | alexander.deucher@amd.com | 1339853447 |  | drm/radeon: add some additional 6xx/7xx/EG register init  - SMX_SAR_CTL0 needs to be programmed correctly to prevent problems with memory exports in certain cases. - VC_ENHANCE needs to be initialized on 6xx/7xx.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r520d.h | s | 11K | 183 | Jerome Glisse | jglisse@redhat.com | 1254186956 |  | drm/radeon/kms: Convert R520 to new init path and associated cleanup  Convert the r520 asic support to new init path, change are smaller than previous one as most of the architecture is now in place and more code sharing can happen btw various asics.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@linux.ie>
f | Makefile | g | 3.0K |  | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atom.c | s | 34K | 1310 | Alex Deucher | alexander.deucher@amd.com | 1333361262 |  | drm/radeon/kms: fix fans after resume  On pre-R600 asics, the SpeedFanControl table is not executed as part of ASIC_Init as it is on newer asics.  Fixes: https://bugzilla.kernel.org/show_bug.cgi?id=29412  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_bios.c | s | 15K | 466 | Igor Murzov | intergalactic.anonymous@gmail.com | 1327426472 |  | drm/radeon: finish getting bios earlier  Return a number of bytes read in radeon_atrm_get_bios_chunk() and properly check this value in radeon_atrm_get_bios(). If radeon_atrm_get_bios_chunk() read less bytes then were requested, it means that it finished reading bios data.  Prior to this patch, condition in radeon_atrm_get_bios() was always equivalent to "if (ATRM_BIOS_PAGE <= 0)", so it was always false, thus radeon_atrm_get_bios() was trying to read past the bios data wasting boot time.  On my lenovo ideapad u455 laptop this patch drops bios reading time from ~5.5s to ~1.5s.  Signed-off-by: Igor Murzov <e-mail@date.by> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atom-types.h | s | 1.4K | 37 | Jerome Glisse | jglisse@redhat.com | 1245031313 |  | drm/radeon: introduce kernel modesetting for radeon hardware  Add kernel modesetting support to radeon driver, use the ttm memory manager to manage memory and DRM/GEM to provide userspace API. In order to avoid backward compatibility issue and to allow clean design and code the radeon kernel modesetting use different code path than old radeon/drm driver.  When kernel modesetting is enabled the IOCTL of radeon/drm driver are considered as invalid and an error message is printed in the log and they return failure.  KMS enabled userspace will use new API to talk with the radeon/drm driver. The new API provide functions to create/destroy/share/mmap buffer object which are then managed by the kernel memory manager (here TTM). In order to submit command to the GPU the userspace provide a buffer holding the command stream, along this buffer userspace have to provide a list of buffer object used by the command stream. The kernel radeon driver will then place buffer in GPU accessible memory and will update command stream to reflect the position of the different buffers.  The kernel will also perform security check on command stream provided by the user, we want to catch and forbid any illegal use of the GPU such as DMA into random system memory or into memory not owned by the process supplying the command stream. This part of the code is still incomplete and this why we propose that patch as a staging driver addition, future security might forbid current experimental userspace to run.  This code support the following hardware : R1XX,R2XX,R3XX,R4XX,R5XX (radeon up to X1950). Works is underway to provide support for R6XX, R7XX and newer hardware (radeon from HD2XXX to HD4XXX).  Authors:     Jerome Glisse <jglisse@redhat.com>     Dave Airlie <airlied@redhat.com>     Alex Deucher <alexdeucher@gmail.com>  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com> Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | si_blit_shaders.c | s | 5.8K | 228 | Linus Torvalds | torvalds@linux-foundation.org | 1332608919 |  | 
f | evergreen_hdmi.c | s | 7.6K | 187 | Rafał Miłecki | zajec5@gmail.com | 1339842079 |  | drm/radeon: enable HDMI on DCE5 (AKA NI excluding Aruba)  After recent changes HDMI code is ready to be enabled on DCE5. This patch just changes conditions to execute already present code on DCE5.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Tested-by: Christian König <christian.koenig@amd.com> Tested-by: Andre Heider <a.heider@gmail.com> Tested-by: Zoltán Böszörményi <zboszor@pr.hu> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | sid.h | s | 36K | 801 | Alex Deucher | alexander.deucher@amd.com | 1338884754 |  | drm/radeon: fix gpu_init on si  - Properly set up the RBs - Properly set up the SPI - Properly set up gb_addr_config  This should fix rendering issues on certain cards.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rv200d.h | s | 1.6K | 34 | Jerome Glisse | jglisse@redhat.com | 1254437509 |  | drm/radeon/kms: Convert R100 to new init path (V2)  New init path allow to simply asic initialization and make easier to trace what happen on each different asic. We are removing most callback. More cleanup should happen latter to remove even more callback. Also cleanup register specific to R100,RV200,RV250. Version 2 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_mode.h | s | 22K | 643 | Rafał Miłecki | zajec5@gmail.com | 1337253363 |  | drm/radeon/hdmi: use new AFMT structs  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_pm.c | s | 26K | 775 | Alex Deucher | alexander.deucher@amd.com | 1339841533 |  | drm/radeon: fix regression in dynpm due to multi-ring rework  Not all asics have all rings, so make sure the ring is ready before attempting to check it in the dynpm work handler.  Fixes: https://bugzilla.kernel.org/show_bug.cgi?id=43367  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Christian König <christian.koenig@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_legacy_encoders.c | s | 50K | 1397 | Corentin Chary | corentin.chary@gmail.com | 1337678986 |  | drm/backlight: initialize struct backlight_properties properly  The power field was never correctly initialized.  [airlied: just took the two drm specific bits]  Signed-off-by: Corentin Chary <corentin.chary@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_trace_points.c | s | 201B | 8 | Dave Airlie | airlied@redhat.com | 1292474267 |  | drm/radeon: add initial tracepoint support.  this adds a bo create, and fence seq tracking tracepoints.  This is just an initial set to play around with, we should investigate what others we need would be useful.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_benchmark.c | s | 7.1K | 241 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r100_track.h | s | 2.5K | 89 | Andi Kleen | ak@linux.intel.com | 1318927492 |  | drm/radeon: Remove more bogus inlines in the radeon driver.  Remove bogus inlines in evergreen and r100.  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | ObjectID.h | s | 43K | 556 | Alex Deucher | alexdeucher@gmail.com | 1332312949 |  | drm/radeon/kms: Upstream ObjectID.h updates  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs600d.h | s | 45K | 679 | Alex Deucher | alexander.deucher@amd.com | 1335257413 |  | drm/radeon/kms: add register definitions for audio  This adds register definitions for HDMI/DP audio on DCE2/3/4/5 hardware.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_cs.c | s | 69K | 2249 | Alex Deucher | alexander.deucher@amd.com | 1339853456 |  | drm/radeon: add support for STRMOUT_BASE_UPDATE on 7xx  Required for streamout.  Bump drm minor.  Marek v2: fix pkt->count check  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Marek Olšák <maraeo@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_display.c | s | 50K | 1467 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1337679307 |  | drm: Constify drm_mode_config_funcs pointer  The DRM mode config functions structure declared by drivers and pointed to by the drm_mode_config funcs field is never modified. Make it a const pointer.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Cc: Inki Dae <inki.dae@samsung.com> Cc: Alan Cox <alan@linux.intel.com> Cc: Daniel Vetter <daniel.vetter@ffwll.ch> Cc: Ben Skeggs <bskeggs@redhat.com> Cc: Thomas Hellstrom <thellstrom@vmware.com> Cc: Rob Clark <rob.clark@linaro.org> Reviwed-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r100d.h | s | 58K | 870 | Tijl Coosemans | tijl@coosemans.org | 1292900133 |  | drm/radeon: Definition of R_0003C2_GENMO_WT seems wrong  In drivers/gpu/drm/radeon/r100d.h R_0003C2_GENMO_WT is defined as 0x3C0. I think this should be 0x3C2.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs100d.h | s | 1.8K | 38 | Jerome Glisse | jglisse@redhat.com | 1254437509 |  | drm/radeon/kms: Convert R100 to new init path (V2)  New init path allow to simply asic initialization and make easier to trace what happen on each different asic. We are removing most callback. More cleanup should happen latter to remove even more callback. Also cleanup register specific to R100,RV200,RV250. Version 2 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs600.c | s | 30K | 959 | Alex Deucher | alexander.deucher@amd.com | 1338884673 |  | drm/radeon: make audio_init consistent across asics  Call it in the asic startup callback on all asics. Previously r600 and rv770 called it in the startup and resume callbacks while all the other asics called it in the startup callback.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Rafał Miłecki <zajec5@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r300.c | s | 41K | 1471 | Jerome Glisse | jglisse@redhat.com | 1336580575 |  | drm/radeon: make the ib an inline object  No need to malloc it any more.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Christian König <deathsimple@vodafone.de> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_reg.h | s | 187K | 3591 | Alex Deucher | alexdeucher@gmail.com | 1332312950 |  | drm/radeon/kms: fix up atom HPD gpio parsing for DCE6  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atombios_i2c.c | s | 3.9K | 122 | Alex Deucher | alexander.deucher@amd.com | 1328261885 |  | drm/radeon/kms/dce3+: add support for hw i2c using atom  Starting with DCE3 hardware, atom contains a general purpose ProcessI2cChannelTransaction similar to ProcessAuxChannelTransaction.  Add an implementation using the atom tables for DCE3+ hardware.  This should be a little less CPU intensive than bit banging and may work better in certain cases.  Enable it by setting the radeon hw_i2c module parameter to 1.  E.g., radeon.hw_i2c=1 on the kernel command line in grub.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_prime.c | s | 5.9K | 193 | Dave Airlie | airlied@redhat.com | 1339841645 |  | drm/radeon/prime: reserve/unreserve around pin  I finally got to test this code a bit more and hit the ttm no reserved assert, so add the reservations around the pinning.  Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | si.c | s | 117K | 3588 | Alex Deucher | alexander.deucher@amd.com | 1340979187 |  | drm/radeon: fix VM page table setup on SI  Cayman and trinity allow for variable sized VM page tables, but SI requires that all page tables be the same size.  The current code assumes variablely sized VM page tables so SI may end up with part of each page table overlapping with other memory which could end up being interpreted by the VM hw as garbage.  Change the code to better accomodate SI.  Allocate enough space for at least 2 full page tables and always set last_pfn to max_pfn on SI so each VM is backed by a full page table.  This limits us to only 2 VMs active at any given time on SI.  This will be rectified and the code can be reunified once we move to two level page tables.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_irq_kms.c | s | 7.4K | 237 | Daniel Vetter | daniel.vetter@ffwll.ch | 1336392134 |  | 
f | evergreen_reg.h | s | 12K | 221 | Rafał Miłecki | zajec5@gmail.com | 1335866272 |  | drm/radeon/kms: get rid of hdmi_config_offset  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Tested-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Christian König <deathsimple@vodafone.de> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_fence.c | s | 16K | 556 | Dave Airlie | airlied@redhat.com | 1336582584 |  | drm/radeon/kms: fix warning on 32-bit in atomic fence printing  /ssd/git/drm-core-next/drivers/gpu/drm/radeon/radeon_fence.c: In function ‘radeon_debugfs_fence_info’: /ssd/git/drm-core-next/drivers/gpu/drm/radeon/radeon_fence.c:606:7: warning: format ‘%lx’ expects argument of type ‘long unsigned int’, but argument 3 has type ‘long long int’ [-Wformat]  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_clocks.c | s | 26K | 802 | Arnd Bergmann | arnd@arndb.de | 1334049660 |  | drm/radeon: replace udelay with mdelay for long timeouts  Some architectures require that delays longer than a few miliseconds are called through mdelay. This was triggered on ARM randconfig builds.  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Mathieu Poirier <mathieu.poirier@linaro.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atombios_dp.c | s | 27K | 854 | Adam Jackson | ajax@redhat.com | 1337678343 |  | drm/radeon/dp: Probe branch/sink OUIs  Signed-off-by: Adam Jackson <ajax@redhat.com> Acked-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r200.c | s | 15K | 533 | Jerome Glisse | jglisse@redhat.com | 1336580575 |  | drm/radeon: make the ib an inline object  No need to malloc it any more.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Christian König <deathsimple@vodafone.de> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_device.c | s | 27K | 965 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_irq.c | s | 10K | 333 | Andi Kleen | ak@linux.intel.com | 1318927985 |  | drm/radeon: Move more code out of line  With this patch I'm only about 50k larger with DRM debugging enables (why is that enabled by default?!?), and slightly smaller without.  [airlied: moved r100.c additions to radeon_ring.c]  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_mem.c | s | 7.2K | 253 | Rakib Mullick | rakib.mullick@gmail.com | 1311652633 |  | drivers: use kzalloc/kcalloc instead of 'kmalloc+memset', where possible  Signed-off-by: Rakib Mullick <rakib.mullick@gmail.com> Cc: Jeff Garzik <jgarzik@pobox.com> Cc: David Airlie <airlied@linux.ie> Cc: Tejun Heo <tj@kernel.org> Cc: Joe Perches <joe@perches.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | rv350d.h | s | 2.7K | 50 | Jerome Glisse | jglisse@redhat.com | 1254437506 |  | drm/radeon/kms: Convert RS400/RS480 to new init path & fix legacy VGA (V3)  Also cleanup register specific to RS400/RS480. This patch also fix legacy VGA register used to disable VGA access we were programming wrong register. Now we should properly disable VGA on r100 up to rs400 asics. Note that RS400/RS480 resume is broken, it hangs the computer while reprogramming dynamic clock, doesn't work either without that patch. We need to spend more time investigating this issue. Version 2 of the patch remove dead code that was left commented out in the previous version. Version 3 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_ring.c | s | 13K | 447 | Dave Airlie | airlied@redhat.com | 1338285705 |  | radeon: make radeon_cs_update_pages static.  Just move its only caller into the same file as it and make it static.  Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_ttm.c | s | 24K | 827 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | si_reg.h | s | 4.9K | 102 | Alex Deucher | alexander.deucher@amd.com | 1340218556 |  | drm/radeon: SI tiling fixes for display  - Use the correct union for getting the tiling info - Properly init the PIPE_CONFIG field for SI  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r520.c | s | 8.7K | 305 | Christian König | deathsimple@vodafone.de | 1336032970 |  | drm/radeon: use central function for IB testing  Removing all the different error messages and having just one standard behaviour over all chipset generations.  Signed-off-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_hdmi.c | s | 18K | 516 | Rafał Miłecki | zajec5@gmail.com | 1339842079 |  | drm/radeon: enable HDMI on DCE5 (AKA NI excluding Aruba)  After recent changes HDMI code is ready to be enabled on DCE5. This patch just changes conditions to execute already present code on DCE5.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Tested-by: Christian König <christian.koenig@amd.com> Tested-by: Andre Heider <a.heider@gmail.com> Tested-by: Zoltán Böszörményi <zboszor@pr.hu> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreen_blit_kms.c | s | 22K | 662 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_cursor.c | s | 9.1K | 271 | Michel Dänzer | michel.daenzer@amd.com | 1332233270 |  | drm/radeon: Drop radeon_gem_object_(un)pin.  Only radeon_gem_object_unpin was used anymore, in only one place.  Signed-off-by: Michel Dänzer <michel.daenzer@amd.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | avivod.h | s | 2.4K | 56 | Dave Airlie | airlied@redhat.com | 1266882381 |  | [rfc] drm/radeon/kms: pm debugging check for vbl.  This patch adds a check on avivo chips to see if we are in the VBL region for the active crtcs when we trigger the engine change.  I appear to have glitches locally on pm transistion (not sure all fixes are in yet) and this at least seems to be correct here, maybe others can test on systems with no glitches.
f | rv770.c | s | 34K | 1051 | Alex Deucher | alexander.deucher@amd.com | 1339853447 |  | drm/radeon: add some additional 6xx/7xx/EG register init  - SMX_SAR_CTL0 needs to be programmed correctly to prevent problems with memory exports in certain cases. - VC_ENHANCE needs to be initialized on 6xx/7xx.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_audio.c | s | 7.0K | 229 | Rafał Miłecki | zajec5@gmail.com | 1339842079 |  | drm/radeon: enable HDMI on DCE5 (AKA NI excluding Aruba)  After recent changes HDMI code is ready to be enabled on DCE5. This patch just changes conditions to execute already present code on DCE5.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Tested-by: Christian König <christian.koenig@amd.com> Tested-by: Andre Heider <a.heider@gmail.com> Tested-by: Zoltán Böszörményi <zboszor@pr.hu> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_blit_shaders.c | s | 14K | 629 | Linus Torvalds | torvalds@linux-foundation.org | 1332608919 |  | 
f | r600_blit.c | s | 21K | 741 | Andi Kleen | ak@linux.intel.com | 1318927478 |  | drm/radeon: drop inlines in r600_blit.c  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_asic.h | s | 21K | 458 | Rafał Miłecki | zajec5@gmail.com | 1337678056 |  | drm/radeon/hdmi: compile audio status in 1 function  This optmizes calls, registers reads and assignments.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | mkregtable.c | s | 19K | 661 | Jesper Juhl | jj@chaosbits.net | 1297639374 |  | radeon mkregtable: Add missing fclose() calls  drivers/gpu/drm/radeon/mkregtable.c:parser_auth() almost always remembers to fclose(file) before returning, but it misses two spots.  This is not really important since the process will exit shortly after and thus close the file for us, but being explicit prevents static analysis tools from complaining about leaked memory and missing fclose() calls and it also seems to be the prefered style of the existing code to explicitly close the file.  So, here's a patch to add the two missing fclose() calls.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atom-bits.h | s | 1.8K | 45 | Jerome Glisse | jglisse@redhat.com | 1245031313 |  | drm/radeon: introduce kernel modesetting for radeon hardware  Add kernel modesetting support to radeon driver, use the ttm memory manager to manage memory and DRM/GEM to provide userspace API. In order to avoid backward compatibility issue and to allow clean design and code the radeon kernel modesetting use different code path than old radeon/drm driver.  When kernel modesetting is enabled the IOCTL of radeon/drm driver are considered as invalid and an error message is printed in the log and they return failure.  KMS enabled userspace will use new API to talk with the radeon/drm driver. The new API provide functions to create/destroy/share/mmap buffer object which are then managed by the kernel memory manager (here TTM). In order to submit command to the GPU the userspace provide a buffer holding the command stream, along this buffer userspace have to provide a list of buffer object used by the command stream. The kernel radeon driver will then place buffer in GPU accessible memory and will update command stream to reflect the position of the different buffers.  The kernel will also perform security check on command stream provided by the user, we want to catch and forbid any illegal use of the GPU such as DMA into random system memory or into memory not owned by the process supplying the command stream. This part of the code is still incomplete and this why we propose that patch as a staging driver addition, future security might forbid current experimental userspace to run.  This code support the following hardware : R1XX,R2XX,R3XX,R4XX,R5XX (radeon up to X1950). Works is underway to provide support for R6XX, R7XX and newer hardware (radeon from HD2XXX to HD4XXX).  Authors:     Jerome Glisse <jglisse@redhat.com>     Dave Airlie <airlied@redhat.com>     Alex Deucher <alexdeucher@gmail.com>  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com> Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_blit_common.h | s | 1.7K | 39 | Ilija Hadzic | ihadzic@research.bell-labs.com | 1328261474 |  | drm/radeon/kms: common definitions for blit copy code  R600/700 and Evergreen/NI blit code have a few redundant definitions in respective .c file. Move common definitions into a separate (new) .h file.  Signed-off-by: Ilija Hadzic <ihadzic@research.bell-labs.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_fb.c | s | 10K | 361 | Michel Dänzer | michel.daenzer@amd.com | 1332233266 |  | drm/radeon: Restrict offset for legacy display engine.  The hardware only takes 27 bits for the offset, so larger offsets are truncated, and the display shows random bits other than the intended ones.  Signed-off-by: Michel Dänzer <michel.daenzer@amd.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreen_cs.c | s | 79K | 2751 | Jerome Glisse | jglisse@redhat.com | 1339346506 |  | drm/radeon: fix tiling and command stream checking on evergreen v3  Fix regresson since the introduction of command stream checking on evergreen (thread referenced below). Issue is cause by ddx allocating bo with formula width*height*bpp while programming the GPU command stream with ALIGN(height, 8). In some case (where page alignment does not hide the extra size bo should be according to height alignment) the kernel will reject the command stream.  This patch reprogram the command stream to slice - 1 (slice is a derivative value from height) which avoid rejecting the command stream while keeping the value of command stream checking from a security point of view.  This patch also fix wrong computation of layer size for 2D tiled surface. Which should fix issue when 2D color tiling is enabled. This dump the radeon KMS_DRIVER_MINOR so userspace can know if they are on a fixed kernel or not.  https://lkml.org/lkml/2012/6/3/80 https://bugs.freedesktop.org/show_bug.cgi?id=50892 https://bugs.freedesktop.org/show_bug.cgi?id=50857  !!! STABLE need a custom version of this patch for 3.4 !!!  v2: actually bump the minor version and add comment about stable v3: do compute the height the ddx was trying to use  [airlied: drop left over debug]  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_combios.c | s | 102K | 3365 | Alex Deucher | alexander.deucher@amd.com | 1336033148 |  | drm/radeon: add connector table for SAM440ep embedded board  RV250 found on ppc embedded boards.  Cc: Hans Verkuil <hverkuil@xs4all.nl> Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_trace.h | s | 1.7K | 57 | Dave Airlie | airlied@redhat.com | 1292474267 |  | drm/radeon: add initial tracepoint support.  this adds a bo create, and fence seq tracking tracepoints.  This is just an initial set to play around with, we should investigate what others we need would be useful.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | nid.h | s | 21K | 546 | Alex Deucher | alexander.deucher@amd.com | 1338566414 |  | drm/radeon: fixup tiling group size and backendmap on r6xx-r9xx (v4)  Tiling group size is always 256bits on r6xx/r7xx/r8xx/9xx. Also fix and simplify render backend map. This now properly sets up the backend map on r6xx-9xx which should improve 3D performance.  Vadim benchmarked also: Some benchmarks on juniper (5750), fullscreen 1920x1080, first result - kernel 3.4.0+ (fb21affa), second - with these patches:  Lightsmark:   91 fps => 123 fps    +35% Doom3:        74 fps => 101 fps    +36%  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs400.c | s | 15K | 521 | Christian König | deathsimple@vodafone.de | 1336032970 |  | drm/radeon: use central function for IB testing  Removing all the different error messages and having just one standard behaviour over all chipset generations.  Signed-off-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_ioc32.c | s | 13K | 360 | Arnd Bergmann | arnd@arndb.de | 1261099351 |  | drm: convert drm_ioctl to unlocked_ioctl  drm_ioctl is called with the Big Kernel Lock held, which shows up very high in statistics on vfs_ioctl.  Moving the lock into the drm_ioctl function itself makes sure we blame the right subsystem and it gets us one step closer to eliminating the locked version of fops->ioctl.  Since drm_ioctl does not require the lock itself, we only need to hold it while calling the specific handler. The 32 bit conversion handlers do not interact with any other code, so they don't need the BKL here either and can just call drm_ioctl.  As a bonus, this cleans up all the other users of drm_ioctl which now no longer have to find the inode or call lock_kernel.  [airlied: squashed the non-driver bits of the second patch in here, this provides the flag for drivers to use to select unlocked ioctls - but doesn't modify any drivers].  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Cc: David Airlie <airlied@linux.ie> Cc: dri-devel@lists.sourceforge.net Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | ni_reg.h | s | 4.2K | 76 | Alex Deucher | alexdeucher@gmail.com | 1294373498 |  | drm/radeon/kms: add ni_reg.h  This adds some new NI (northern islands) specific display register defines.  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_kms.c | s | 16K | 478 | Alex Deucher | alexander.deucher@amd.com | 1338884754 |  | drm/radeon: fix gpu_init on si  - Properly set up the RBs - Properly set up the SPI - Properly set up gb_addr_config  This should fix rendering issues on certain cards.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_object.h | s | 6.1K | 165 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rv515.c | s | 34K | 1054 | Christian König | deathsimple@vodafone.de | 1336032970 |  | drm/radeon: use central function for IB testing  Removing all the different error messages and having just one standard behaviour over all chipset generations.  Signed-off-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_family.h | s | 2.7K | 111 | Alex Deucher | alexander.deucher@amd.com | 1332312955 |  | drm/radeon/kms: add trinity (TN) chip family  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atombios_encoders.c | s | 77K | 2189 | Rafał Miłecki | zajec5@gmail.com | 1339842079 |  | drm/radeon: enable HDMI on DCE5 (AKA NI excluding Aruba)  After recent changes HDMI code is ready to be enabled on DCE5. This patch just changes conditions to execute already present code on DCE5.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Tested-by: Christian König <christian.koenig@amd.com> Tested-by: Andre Heider <a.heider@gmail.com> Tested-by: Zoltán Böszörményi <zboszor@pr.hu> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_acpi.c | s | 1.5K | 54 | Jean Delvare | jdelvare@suse.de | 1322733454 |  | drm/radeon/kms: Skip ACPI call to ATIF when possible  I am under the impression that it only makes sense to call the ATIF method if the graphics device has an ACPI handle attached. So we could skip the call altogether if there is no such handle.  Signed-off-by: Jean Delvare <jdelvare@suse.de> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r420d.h | s | 16K | 246 | Jerome Glisse | jglisse@redhat.com | 1254437506 |  | drm/radeon/kms: Convert RS400/RS480 to new init path & fix legacy VGA (V3)  Also cleanup register specific to RS400/RS480. This patch also fix legacy VGA register used to disable VGA access we were programming wrong register. Now we should properly disable VGA on r100 up to rs400 asics. Note that RS400/RS480 resume is broken, it hangs the computer while reprogramming dynamic clock, doesn't work either without that patch. We need to spend more time investigating this issue. Version 2 of the patch remove dead code that was left commented out in the previous version. Version 3 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs400d.h | s | 10K | 158 | Jerome Glisse | jglisse@redhat.com | 1254437506 |  | drm/radeon/kms: Convert RS400/RS480 to new init path & fix legacy VGA (V3)  Also cleanup register specific to RS400/RS480. This patch also fix legacy VGA register used to disable VGA access we were programming wrong register. Now we should properly disable VGA on r100 up to rs400 asics. Note that RS400/RS480 resume is broken, it hangs the computer while reprogramming dynamic clock, doesn't work either without that patch. We need to spend more time investigating this issue. Version 2 of the patch remove dead code that was left commented out in the previous version. Version 3 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r100.c | s | 116K | 3805 | Dan Carpenter | dan.carpenter@oracle.com | 1337249583 |  | drm/radeon: check kmalloc() for failures  We can just return -ENOMEM here if the allocation fails.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_sa.c | s | 10K | 337 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atom.h | s | 4.8K | 137 | Alex Deucher | alexander.deucher@amd.com | 1333361262 |  | drm/radeon/kms: fix fans after resume  On pre-R600 asics, the SpeedFanControl table is not executed as part of ASIC_Init as it is on newer asics.  Fixes: https://bugzilla.kernel.org/show_bug.cgi?id=29412  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atom-names.h | s | 4.6K | 90 | Jerome Glisse | jglisse@redhat.com | 1245031313 |  | drm/radeon: introduce kernel modesetting for radeon hardware  Add kernel modesetting support to radeon driver, use the ttm memory manager to manage memory and DRM/GEM to provide userspace API. In order to avoid backward compatibility issue and to allow clean design and code the radeon kernel modesetting use different code path than old radeon/drm driver.  When kernel modesetting is enabled the IOCTL of radeon/drm driver are considered as invalid and an error message is printed in the log and they return failure.  KMS enabled userspace will use new API to talk with the radeon/drm driver. The new API provide functions to create/destroy/share/mmap buffer object which are then managed by the kernel memory manager (here TTM). In order to submit command to the GPU the userspace provide a buffer holding the command stream, along this buffer userspace have to provide a list of buffer object used by the command stream. The kernel radeon driver will then place buffer in GPU accessible memory and will update command stream to reflect the position of the different buffers.  The kernel will also perform security check on command stream provided by the user, we want to catch and forbid any illegal use of the GPU such as DMA into random system memory or into memory not owned by the process supplying the command stream. This part of the code is still incomplete and this why we propose that patch as a staging driver addition, future security might forbid current experimental userspace to run.  This code support the following hardware : R1XX,R2XX,R3XX,R4XX,R5XX (radeon up to X1950). Works is underway to provide support for R6XX, R7XX and newer hardware (radeon from HD2XXX to HD4XXX).  Authors:     Jerome Glisse <jglisse@redhat.com>     Dave Airlie <airlied@redhat.com>     Alex Deucher <alexdeucher@gmail.com>  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com> Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_test.c | s | 13K | 424 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_asic.c | s | 48K | 1720 | Christian König | deathsimple@vodafone.de | 1336033002 |  | drm/radeon: remove cayman_gpu_is_lockup  Since it is now identical to evergreen_gpu_is_lockup.  Signed-off-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | atombios.h | s | 381K | 6947 | Alex Deucher | alexander.deucher@amd.com | 1332312950 |  | drm/radeon/kms: upstream power table updates  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | cayman_blit_shaders.c | s | 8.1K | 338 | Paul Gortmaker | paul.gortmaker@windriver.com | 1330553708 |  | bug.h: add include of it to various implicit C users  With bug.h currently living right in linux/kernel.h there are files that use BUG_ON and friends but are not including the header explicitly.  Fix them up so we can remove the presence in kernel.h file.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | rv770d.h | s | 26K | 567 | Alex Deucher | alexander.deucher@amd.com | 1339853447 |  | drm/radeon: add some additional 6xx/7xx/EG register init  - SMX_SAR_CTL0 needs to be programmed correctly to prevent problems with memory exports in certain cases. - VC_ENHANCE needs to be initialized on 6xx/7xx.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon.h | s | 57K | 1703 | Alex Deucher | alexander.deucher@amd.com | 1338884754 |  | drm/radeon: fix gpu_init on si  - Properly set up the RBs - Properly set up the SPI - Properly set up gb_addr_config  This should fix rendering issues on certain cards.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | cayman_blit_shaders.h | s | 1.4K | 31 | Alex Deucher | alexdeucher@gmail.com | 1306365571 |  | drm/radeon/kms: add blit support for cayman (v2)  Allows us to use the 3D engine for memory management and allows us to use vram beyond the BAR aperture.  v2: fix copy paste typo Reported-by: Nils Wallménius <nils.wallmenius@gmail.com>  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreen_blit_shaders.h | s | 1.4K | 31 | Alex Deucher | alexdeucher@gmail.com | 1286329590 |  | drm/radeon/kms: add drm blit support for evergreen  This patch implements blit support for bo moves using the 3D engine.  It uses the same method as r6xx/r7xx: - store the base state in an IB - emit variable state and vertex buffers to do the blit  This allows the hw to move bos using the 3D engine and allows full use of vram beyond the pci aperture size.  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_legacy_crtc.c | s | 30K | 924 | Michel Dänzer | michel.daenzer@amd.com | 1332233266 |  | drm/radeon: Restrict offset for legacy display engine.  The hardware only takes 27 bits for the offset, so larger offsets are truncated, and the display shows random bits other than the intended ones.  Signed-off-by: Michel Dänzer <michel.daenzer@amd.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_connectors.c | s | 66K | 1778 | Daniel Vetter | daniel.vetter@ffwll.ch | 1336392134 |  | 
f | radeon_cp.c | s | 64K | 1913 | Jesper Juhl | jj@chaosbits.net | 1335784531 |  | radeon_cp: Remove unneeded tests for NULL before calling release_firmware()  release_firmware() does its own tests for NULL pointers so there's no need to explicitly test before calling it.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | r600_cp.c | s | 78K | 2295 | Arnd Bergmann | arnd@arndb.de | 1334049660 |  | drm/radeon: replace udelay with mdelay for long timeouts  Some architectures require that delays longer than a few miliseconds are called through mdelay. This was triggered on ARM randconfig builds.  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Mathieu Poirier <mathieu.poirier@linaro.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_blit_kms.c | s | 23K | 678 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600.c | s | 113K | 3470 | Alex Deucher | alexander.deucher@amd.com | 1339853447 |  | drm/radeon: add some additional 6xx/7xx/EG register init  - SMX_SAR_CTL0 needs to be programmed correctly to prevent problems with memory exports in certain cases. - VC_ENHANCE needs to be initialized on 6xx/7xx.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_object.c | s | 16K | 589 | Alex Deucher | alexander.deucher@amd.com | 1337766431 |  | drm/radeon: add PRIME support (v2)  This adds prime->fd and fd->prime support to radeon. It passes the sg object to ttm and then populates the gart entries using it.  Compile tested only.  v2: stub kmap + use new helpers + add reimporting  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rv250d.h | s | 7.7K | 121 | Jerome Glisse | jglisse@redhat.com | 1254437509 |  | drm/radeon/kms: Convert R100 to new init path (V2)  New init path allow to simply asic initialization and make easier to trace what happen on each different asic. We are removing most callback. More cleanup should happen latter to remove even more callback. Also cleanup register specific to R100,RV200,RV250. Version 2 correct the placement on IGP of the VRAM inside GPU address space to match the stollen RAM placement of IGP.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600d.h | s | 94K | 1745 | Alex Deucher | alexander.deucher@amd.com | 1339853456 |  | drm/radeon: add support for STRMOUT_BASE_UPDATE on 7xx  Required for streamout.  Bump drm minor.  Marek v2: fix pkt->count check  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Marek Olšák <maraeo@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_drv.c | s | 15K | 402 | Alex Deucher | alexander.deucher@amd.com | 1339853456 |  | drm/radeon: add support for STRMOUT_BASE_UPDATE on 7xx  Required for streamout.  Bump drm minor.  Marek v2: fix pkt->count check  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Marek Olšák <maraeo@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_drv.h | s | 92K | 1936 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | si_blit_shaders.h | s | 1.3K | 28 | Alex Deucher | alexander.deucher@amd.com | 1332312954 |  | drm/radeon/kms: add support for CP setup on SI  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs690.c | s | 26K | 730 | Alex Deucher | alexander.deucher@amd.com | 1338884673 |  | drm/radeon: make audio_init consistent across asics  Call it in the asic startup callback on all asics. Previously r600 and rv770 called it in the startup and resume callbacks while all the other asics called it in the startup callback.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Rafał Miłecki <zajec5@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_atombios.c | s | 102K | 2858 | Alex Deucher | alexander.deucher@amd.com | 1338286099 |  | drm/radeon: fix XFX quirk  Only override the ddc bus if the connector doesn't have a valid one.  The existing code overrode the ddc bus for all connectors even if it had ddc bus.  Fixes ddc on another XFX card with the same pci ids that was broken by the quirk overwriting the correct ddc bus.  Reported-by: Mehdi Aqadjani Memar <m.aqadjanimemar@student.ru.nl> Cc: stable@vger.kernel.org Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | Kconfig | g | 1.6K |  | Alex Deucher | alexdeucher@gmail.com | 1306365725 |  | drm/radeon/kms: clean up the radeon kms Kconfig  - no longer in staging - all radeons supported  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_agp.c | s | 9.8K | 265 | Alex Deucher | alexdeucher@gmail.com | 1282258135 |  | drm/radeon/kms: fix agp mode setup on cards that use pcie bridges  Asics that use an AGP to PCIE bridge don't have the AGP_STATUS register so just use whatever mode the host side setup.  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Cc: Jerome Glisse <glisse@freedesktop.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_gart.c | s | 17K | 619 | Alex Deucher | alexander.deucher@amd.com | 1340979187 |  | drm/radeon: fix VM page table setup on SI  Cayman and trinity allow for variable sized VM page tables, but SI requires that all page tables be the same size.  The current code assumes variablely sized VM page tables so SI may end up with part of each page table overlapping with other memory which could end up being interpreted by the VM hw as garbage.  Change the code to better accomodate SI.  Allocate enough space for at least 2 full page tables and always set last_pfn to max_pfn on SI so each VM is backed by a full page table.  This limits us to only 2 VMs active at any given time on SI.  This will be rectified and the code can be reunified once we move to two level page tables.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | ni.c | s | 44K | 1372 | Rafał Miłecki | zajec5@gmail.com | 1339842079 |  | drm/radeon: enable HDMI on DCE5 (AKA NI excluding Aruba)  After recent changes HDMI code is ready to be enabled on DCE5. This patch just changes conditions to execute already present code on DCE5.  Signed-off-by: Rafał Miłecki <zajec5@gmail.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Tested-by: Christian König <christian.koenig@amd.com> Tested-by: Andre Heider <a.heider@gmail.com> Tested-by: Zoltán Böszörményi <zboszor@pr.hu> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_atpx_handler.c | s | 7.1K | 229 | Dave Airlie | airlied@redhat.com | 1328196316 |  | drm/radeon: fix use after free in ATRM bios reading code.  Fixes: https://bugs.freedesktop.org/show_bug.cgi?id=45503  Reported-and-Debugged-by: mlambda@gmail.com Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r300_reg.h | s | 77K | 1624 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | atombios_crtc.c | s | 54K | 1569 | Alex Deucher | alexander.deucher@amd.com | 1340218556 |  | drm/radeon: SI tiling fixes for display  - Use the correct union for getting the tiling info - Properly init the PIPE_CONFIG field for SI  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Michel Dänzer <michel.daenzer@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
d | reg_srcs |  | 10 items |  | Jerome Glisse | jglisse@redhat.com | 1332752002 |  | drm/radeon/kms: add htile support to the cs checker v3  For 6xx+.  Required for mesa to use htile support for HiZ/HiS. Userspace will check radeon version 2.14 with is bumped either by tiling patch or stream out patch. This patch only add support for htile relocation which should be enough for any userspace to implement the hyperz (using htile buffer) feature.  v2: Jerome: Fix size checking for htile buffer. v3: Jerome: Adapt on top of r600/evergreen cs checker changes,             also check htile surface in case only stencil is             present.  Signed-off-by: Pierre-Eric Pelloux-Prayer <pelloux@gmail.com> Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r500_reg.h | s | 39K | 720 | Alex Deucher | alexander.deucher@amd.com | 1330353973 |  | drm/radeon/kms: add wait_for_vblank asic callback  Required for future functionality.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Christian König <christian.koenig@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_state.c | s | 92K | 2812 | Andi Kleen | ak@linux.intel.com | 1318927985 |  | drm/radeon: Move more code out of line  With this patch I'm only about 50k larger with DRM debugging enables (why is that enabled by default?!?), and slightly smaller without.  [airlied: moved r100.c additions to radeon_ring.c]  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreen.c | s | 107K | 3022 | Alex Deucher | alexander.deucher@amd.com | 1339853447 |  | drm/radeon: add some additional 6xx/7xx/EG register init  - SMX_SAR_CTL0 needs to be programmed correctly to prevent problems with memory exports in certain cases. - VC_ENHANCE needs to be initialized on 6xx/7xx.  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_encoders.c | s | 11K | 330 | Alex Deucher | alexander.deucher@amd.com | 1332312958 |  | drm/radeon/kms: update duallink checks for DCE6  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r300d.h | s | 21K | 347 | Marek Olšák | maraeo@gmail.com | 1294282845 |  | drm/radeon/kms: manage r300 CMASK RAM access and allow CMASK clear  The CMASK RAM is for colorbuffer compression (used in conjunction with MSAA). Only one user (filp) can access it.  The CMASK RAM access is managed in the same way as Hyper-Z, but there is a separate ioctl, because an app that uses MSAA does not necessarily have to use zbuffering.  Signed-off-by: Marek Olšák <maraeo@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_legacy_tv.c | s | 27K | 787 | Andi Kleen | ak@linux.intel.com | 1318927985 |  | drm/radeon: Move more code out of line  With this patch I'm only about 50k larger with DRM debugging enables (why is that enabled by default?!?), and slightly smaller without.  [airlied: moved r100.c additions to radeon_ring.c]  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_gem.c | s | 13K | 474 | Jerome Glisse | jglisse@redhat.com | 1341310629 |  | drm/radeon: fix rare segfault  In gem idle/busy ioctl the radeon object was derefenced after drm_gem_object_unreference_unlocked which in case the object have been destroyed lead to use of a possibly free pointer with possibly wrong data.  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Christian König <christian.koenig@amd.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r420.c | s | 13K | 454 | Christian König | deathsimple@vodafone.de | 1336032970 |  | drm/radeon: use central function for IB testing  Removing all the different error messages and having just one standard behaviour over all chipset generations.  Signed-off-by: Christian König <deathsimple@vodafone.de> Reviewed-by: Alex Deucher <alexander.deucher@amd.com> Reviewed-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_i2c.c | s | 29K | 1069 | Alex Deucher | alexander.deucher@amd.com | 1334133413 |  | drm/radeon: only add the mm i2c bus if the hw_i2c module param is set  It seems it can corrupt the monitor EDID in certain cases on certain boards when running sensors detect.  It's rarely used anyway outside of AIW boards.  http://lists.lm-sensors.org/pipermail/lm-sensors/2012-April/035847.html http://lists.freedesktop.org/archives/xorg/2011-January/052239.html  Signed-off-by: Alex Deucher <alexander.deucher@amd.com> Cc: stable@vger.kernel.org Acked-by: Jean Delvare <khali@linux-fr.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | evergreen_blit_shaders.c | s | 7.8K | 320 | Paul Gortmaker | paul.gortmaker@windriver.com | 1330553708 |  | bug.h: add include of it to various implicit C users  With bug.h currently living right in linux/kernel.h there are files that use BUG_ON and friends but are not including the header explicitly.  Fix them up so we can remove the presence in kernel.h file.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | r300_cmdbuf.c | s | 31K | 1015 | Andi Kleen | ak@linux.intel.com | 1318927985 |  | drm/radeon: Move more code out of line  With this patch I'm only about 50k larger with DRM debugging enables (why is that enabled by default?!?), and slightly smaller without.  [airlied: moved r100.c additions to radeon_ring.c]  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rs690d.h | s | 20K | 306 | Alex Deucher | alexdeucher@gmail.com | 1270011287 |  | drm/radeon/kms: display watermark updates (v2)  - Add module option to force the display priority   0 = auto, 1 = normal, 2 = high - Default to high on r3xx/r4xx/rv515 chips   Fixes flickering problems during heavy acceleration   due to underflow to the display controllers - Fill in minimal support for RS600  v2 - update display priority when bandwidth is updated so the user can change the parameter at runtime and it will take affect on the next modeset.  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | rv515d.h | s | 37K | 636 | Jerome Glisse | jglisse@redhat.com | 1270516871 |  | drm/radeon/kms: simplify & improve GPU reset V2  This simplify and improve GPU reset for R1XX-R6XX hw, it's not 100% reliable here are result: - R1XX/R2XX works bunch of time in a row, sometimes it   seems it can work indifinitly - R3XX/R3XX the most unreliable one, sometimes you will be   able to reset few times, sometimes not even once - R5XX more reliable than previous hw, seems to work most   of the times but once in a while it fails for no obvious   reasons (same status than previous reset just no same   happy ending) - R6XX/R7XX are lot more reliable with this patch, still   it seems that it can fail after a bunch (reset every   2sec for 3hour bring down the GPU & computer)  This have been tested on various hw, for some odd reasons i wasn't able to lockup RS480/RS690 (while they use to love locking up).  Note that on R1XX-R5XX the cursor will disapear after lockup haven't checked why, switch to console and back to X will restore cursor.  Next step is to record the bogus command that leaded to the lockup.  V2 Fix r6xx resume path to avoid reinitializing blit module, use the gpu_lockup boolean to avoid entering inifinite waiting loop on fence while reiniting the GPU  Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | r600_blit_shaders.h | s | 1.5K | 33 | Alex Deucher | alexdeucher@gmail.com | 1284373564 |  | drm/radeon: add some missing copyright headers  Noticed while adding evergreen blit support.  Signed-off-by: Alex Deucher <alexdeucher@gmail.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | radeon_semaphore.c | s | 3.8K | 121 | Jerome Glisse | jglisse@redhat.com | 1336580561 |  | drm/radeon: rip out the ib pool  It isn't necessary any more and the suballocator seems to perform even better.  Signed-off-by: Christian König <deathsimple@vodafone.de> Signed-off-by: Jerome Glisse <jglisse@redhat.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
