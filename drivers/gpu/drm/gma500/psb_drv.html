<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › gma500 › psb_drv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>psb_drv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**************************************************************************</span>
<span class="cm"> * Copyright (c) 2007-2011, Intel Corporation.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms and conditions of the GNU General Public License,</span>
<span class="cm"> * version 2, as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> *</span>
<span class="cm"> **************************************************************************/</span>

<span class="cp">#ifndef _PSB_DRV_H_</span>
<span class="cp">#define _PSB_DRV_H_</span>

<span class="cp">#include &lt;linux/kref.h&gt;</span>

<span class="cp">#include &lt;drm/drmP.h&gt;</span>
<span class="cp">#include &quot;drm_global.h&quot;</span>
<span class="cp">#include &quot;gem_glue.h&quot;</span>
<span class="cp">#include &quot;gma_drm.h&quot;</span>
<span class="cp">#include &quot;psb_reg.h&quot;</span>
<span class="cp">#include &quot;psb_intel_drv.h&quot;</span>
<span class="cp">#include &quot;gtt.h&quot;</span>
<span class="cp">#include &quot;power.h&quot;</span>
<span class="cp">#include &quot;opregion.h&quot;</span>
<span class="cp">#include &quot;oaktrail.h&quot;</span>

<span class="cm">/* Append new drm mode definition here, align with libdrm definition */</span>
<span class="cp">#define DRM_MODE_SCALE_NO_SCALE   	2</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CHIP_PSB_8108</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>		<span class="cm">/* Poulsbo */</span>
	<span class="n">CHIP_PSB_8109</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Poulsbo */</span>
	<span class="n">CHIP_MRST_4100</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>		<span class="cm">/* Moorestown/Oaktrail */</span>
	<span class="n">CHIP_MFLD_0130</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>		<span class="cm">/* Medfield */</span>
<span class="p">};</span>

<span class="cp">#define IS_PSB(dev) (((dev)-&gt;pci_device &amp; 0xfffe) == 0x8108)</span>
<span class="cp">#define IS_MRST(dev) (((dev)-&gt;pci_device &amp; 0xfffc) == 0x4100)</span>
<span class="cp">#define IS_MFLD(dev) (((dev)-&gt;pci_device &amp; 0xfff8) == 0x0130)</span>

<span class="cm">/*</span>
<span class="cm"> * Driver definitions</span>
<span class="cm"> */</span>

<span class="cp">#define DRIVER_NAME &quot;gma500&quot;</span>
<span class="cp">#define DRIVER_DESC &quot;DRM driver for the Intel GMA500&quot;</span>

<span class="cp">#define PSB_DRM_DRIVER_DATE &quot;2011-06-06&quot;</span>
<span class="cp">#define PSB_DRM_DRIVER_MAJOR 1</span>
<span class="cp">#define PSB_DRM_DRIVER_MINOR 0</span>
<span class="cp">#define PSB_DRM_DRIVER_PATCHLEVEL 0</span>

<span class="cm">/*</span>
<span class="cm"> *	Hardware offsets</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_VDC_OFFSET		 0x00000000</span>
<span class="cp">#define PSB_VDC_SIZE		 0x000080000</span>
<span class="cp">#define MRST_MMIO_SIZE		 0x0000C0000</span>
<span class="cp">#define MDFLD_MMIO_SIZE          0x000100000</span>
<span class="cp">#define PSB_SGX_SIZE		 0x8000</span>
<span class="cp">#define PSB_SGX_OFFSET		 0x00040000</span>
<span class="cp">#define MRST_SGX_OFFSET		 0x00080000</span>
<span class="cm">/*</span>
<span class="cm"> *	PCI resource identifiers</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_MMIO_RESOURCE	 0</span>
<span class="cp">#define PSB_GATT_RESOURCE	 2</span>
<span class="cp">#define PSB_GTT_RESOURCE	 3</span>
<span class="cm">/*</span>
<span class="cm"> *	PCI configuration</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_GMCH_CTRL		 0x52</span>
<span class="cp">#define PSB_BSM			 0x5C</span>
<span class="cp">#define _PSB_GMCH_ENABLED	 0x4</span>
<span class="cp">#define PSB_PGETBL_CTL		 0x2020</span>
<span class="cp">#define _PSB_PGETBL_ENABLED	 0x00000001</span>
<span class="cp">#define PSB_SGX_2D_SLAVE_PORT	 0x4000</span>

<span class="cm">/* To get rid of */</span>
<span class="cp">#define PSB_TT_PRIV0_LIMIT	 (256*1024*1024)</span>
<span class="cp">#define PSB_TT_PRIV0_PLIMIT	 (PSB_TT_PRIV0_LIMIT &gt;&gt; PAGE_SHIFT)</span>

<span class="cm">/*</span>
<span class="cm"> *	SGX side MMU definitions (these can probably go)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	Flags for external memory type field.</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_MMU_CACHED_MEMORY	  0x0001	</span><span class="cm">/* Bind to MMU only */</span><span class="cp"></span>
<span class="cp">#define PSB_MMU_RO_MEMORY	  0x0002	</span><span class="cm">/* MMU RO memory */</span><span class="cp"></span>
<span class="cp">#define PSB_MMU_WO_MEMORY	  0x0004	</span><span class="cm">/* MMU WO memory */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> *	PTE&#39;s and PDE&#39;s</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_PDE_MASK		  0x003FFFFF</span>
<span class="cp">#define PSB_PDE_SHIFT		  22</span>
<span class="cp">#define PSB_PTE_SHIFT		  12</span>
<span class="cm">/*</span>
<span class="cm"> *	Cache control</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_PTE_VALID		  0x0001	</span><span class="cm">/* PTE / PDE valid */</span><span class="cp"></span>
<span class="cp">#define PSB_PTE_WO		  0x0002	</span><span class="cm">/* Write only */</span><span class="cp"></span>
<span class="cp">#define PSB_PTE_RO		  0x0004	</span><span class="cm">/* Read only */</span><span class="cp"></span>
<span class="cp">#define PSB_PTE_CACHED		  0x0008	</span><span class="cm">/* CPU cache coherent */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	VDC registers and bits</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_MSVDX_CLOCKGATING	  0x2064</span>
<span class="cp">#define PSB_TOPAZ_CLOCKGATING	  0x2068</span>
<span class="cp">#define PSB_HWSTAM		  0x2098</span>
<span class="cp">#define PSB_INSTPM		  0x20C0</span>
<span class="cp">#define PSB_INT_IDENTITY_R        0x20A4</span>
<span class="cp">#define _PSB_IRQ_ASLE		  (1&lt;&lt;0)</span>
<span class="cp">#define _MDFLD_PIPEC_EVENT_FLAG   (1&lt;&lt;2)</span>
<span class="cp">#define _MDFLD_PIPEC_VBLANK_FLAG  (1&lt;&lt;3)</span>
<span class="cp">#define _PSB_DPST_PIPEB_FLAG      (1&lt;&lt;4)</span>
<span class="cp">#define _MDFLD_PIPEB_EVENT_FLAG   (1&lt;&lt;4)</span>
<span class="cp">#define _PSB_VSYNC_PIPEB_FLAG	  (1&lt;&lt;5)</span>
<span class="cp">#define _PSB_DPST_PIPEA_FLAG      (1&lt;&lt;6)</span>
<span class="cp">#define _PSB_PIPEA_EVENT_FLAG     (1&lt;&lt;6)</span>
<span class="cp">#define _PSB_VSYNC_PIPEA_FLAG	  (1&lt;&lt;7)</span>
<span class="cp">#define _MDFLD_MIPIA_FLAG	  (1&lt;&lt;16)</span>
<span class="cp">#define _MDFLD_MIPIC_FLAG	  (1&lt;&lt;17)</span>
<span class="cp">#define _PSB_IRQ_DISP_HOTSYNC	  (1&lt;&lt;17)</span>
<span class="cp">#define _PSB_IRQ_SGX_FLAG	  (1&lt;&lt;18)</span>
<span class="cp">#define _PSB_IRQ_MSVDX_FLAG	  (1&lt;&lt;19)</span>
<span class="cp">#define _LNC_IRQ_TOPAZ_FLAG	  (1&lt;&lt;20)</span>

<span class="cp">#define _PSB_PIPE_EVENT_FLAG	(_PSB_VSYNC_PIPEA_FLAG | \</span>
<span class="cp">				 _PSB_VSYNC_PIPEB_FLAG)</span>

<span class="cm">/* This flag includes all the display IRQ bits excepts the vblank irqs. */</span>
<span class="cp">#define _MDFLD_DISP_ALL_IRQ_FLAG (_MDFLD_PIPEC_EVENT_FLAG | \</span>
<span class="cp">				  _MDFLD_PIPEB_EVENT_FLAG | \</span>
<span class="cp">				  _PSB_PIPEA_EVENT_FLAG | \</span>
<span class="cp">				  _PSB_VSYNC_PIPEA_FLAG | \</span>
<span class="cp">				  _MDFLD_MIPIA_FLAG | \</span>
<span class="cp">				  _MDFLD_MIPIC_FLAG)</span>
<span class="cp">#define PSB_INT_IDENTITY_R	  0x20A4</span>
<span class="cp">#define PSB_INT_MASK_R		  0x20A8</span>
<span class="cp">#define PSB_INT_ENABLE_R	  0x20A0</span>

<span class="cp">#define _PSB_MMU_ER_MASK      0x0001FF00</span>
<span class="cp">#define _PSB_MMU_ER_HOST      (1 &lt;&lt; 16)</span>
<span class="cp">#define GPIOA			0x5010</span>
<span class="cp">#define GPIOB			0x5014</span>
<span class="cp">#define GPIOC			0x5018</span>
<span class="cp">#define GPIOD			0x501c</span>
<span class="cp">#define GPIOE			0x5020</span>
<span class="cp">#define GPIOF			0x5024</span>
<span class="cp">#define GPIOG			0x5028</span>
<span class="cp">#define GPIOH			0x502c</span>
<span class="cp">#define GPIO_CLOCK_DIR_MASK		(1 &lt;&lt; 0)</span>
<span class="cp">#define GPIO_CLOCK_DIR_IN		(0 &lt;&lt; 1)</span>
<span class="cp">#define GPIO_CLOCK_DIR_OUT		(1 &lt;&lt; 1)</span>
<span class="cp">#define GPIO_CLOCK_VAL_MASK		(1 &lt;&lt; 2)</span>
<span class="cp">#define GPIO_CLOCK_VAL_OUT		(1 &lt;&lt; 3)</span>
<span class="cp">#define GPIO_CLOCK_VAL_IN		(1 &lt;&lt; 4)</span>
<span class="cp">#define GPIO_CLOCK_PULLUP_DISABLE	(1 &lt;&lt; 5)</span>
<span class="cp">#define GPIO_DATA_DIR_MASK		(1 &lt;&lt; 8)</span>
<span class="cp">#define GPIO_DATA_DIR_IN		(0 &lt;&lt; 9)</span>
<span class="cp">#define GPIO_DATA_DIR_OUT		(1 &lt;&lt; 9)</span>
<span class="cp">#define GPIO_DATA_VAL_MASK		(1 &lt;&lt; 10)</span>
<span class="cp">#define GPIO_DATA_VAL_OUT		(1 &lt;&lt; 11)</span>
<span class="cp">#define GPIO_DATA_VAL_IN		(1 &lt;&lt; 12)</span>
<span class="cp">#define GPIO_DATA_PULLUP_DISABLE	(1 &lt;&lt; 13)</span>

<span class="cp">#define VCLK_DIVISOR_VGA0   0x6000</span>
<span class="cp">#define VCLK_DIVISOR_VGA1   0x6004</span>
<span class="cp">#define VCLK_POST_DIV	    0x6010</span>

<span class="cp">#define PSB_COMM_2D (PSB_ENGINE_2D &lt;&lt; 4)</span>
<span class="cp">#define PSB_COMM_3D (PSB_ENGINE_3D &lt;&lt; 4)</span>
<span class="cp">#define PSB_COMM_TA (PSB_ENGINE_TA &lt;&lt; 4)</span>
<span class="cp">#define PSB_COMM_HP (PSB_ENGINE_HP &lt;&lt; 4)</span>
<span class="cp">#define PSB_COMM_USER_IRQ (1024 &gt;&gt; 2)</span>
<span class="cp">#define PSB_COMM_USER_IRQ_LOST (PSB_COMM_USER_IRQ + 1)</span>
<span class="cp">#define PSB_COMM_FW (2048 &gt;&gt; 2)</span>

<span class="cp">#define PSB_UIRQ_VISTEST	       1</span>
<span class="cp">#define PSB_UIRQ_OOM_REPLY	       2</span>
<span class="cp">#define PSB_UIRQ_FIRE_TA_REPLY	       3</span>
<span class="cp">#define PSB_UIRQ_FIRE_RASTER_REPLY     4</span>

<span class="cp">#define PSB_2D_SIZE (256*1024*1024)</span>
<span class="cp">#define PSB_MAX_RELOC_PAGES 1024</span>

<span class="cp">#define PSB_LOW_REG_OFFS 0x0204</span>
<span class="cp">#define PSB_HIGH_REG_OFFS 0x0600</span>

<span class="cp">#define PSB_NUM_VBLANKS 2</span>


<span class="cp">#define PSB_2D_SIZE (256*1024*1024)</span>
<span class="cp">#define PSB_MAX_RELOC_PAGES 1024</span>

<span class="cp">#define PSB_LOW_REG_OFFS 0x0204</span>
<span class="cp">#define PSB_HIGH_REG_OFFS 0x0600</span>

<span class="cp">#define PSB_NUM_VBLANKS 2</span>
<span class="cp">#define PSB_WATCHDOG_DELAY (DRM_HZ * 2)</span>
<span class="cp">#define PSB_LID_DELAY (DRM_HZ / 10)</span>

<span class="cp">#define MDFLD_PNW_B0 0x04</span>
<span class="cp">#define MDFLD_PNW_C0 0x08</span>

<span class="cp">#define MDFLD_DSR_2D_3D_0 	(1 &lt;&lt; 0)</span>
<span class="cp">#define MDFLD_DSR_2D_3D_2 	(1 &lt;&lt; 1)</span>
<span class="cp">#define MDFLD_DSR_CURSOR_0 	(1 &lt;&lt; 2)</span>
<span class="cp">#define MDFLD_DSR_CURSOR_2	(1 &lt;&lt; 3)</span>
<span class="cp">#define MDFLD_DSR_OVERLAY_0 	(1 &lt;&lt; 4)</span>
<span class="cp">#define MDFLD_DSR_OVERLAY_2 	(1 &lt;&lt; 5)</span>
<span class="cp">#define MDFLD_DSR_MIPI_CONTROL	(1 &lt;&lt; 6)</span>
<span class="cp">#define MDFLD_DSR_DAMAGE_MASK_0	((1 &lt;&lt; 0) | (1 &lt;&lt; 2) | (1 &lt;&lt; 4))</span>
<span class="cp">#define MDFLD_DSR_DAMAGE_MASK_2	((1 &lt;&lt; 1) | (1 &lt;&lt; 3) | (1 &lt;&lt; 5))</span>
<span class="cp">#define MDFLD_DSR_2D_3D 	(MDFLD_DSR_2D_3D_0 | MDFLD_DSR_2D_3D_2)</span>

<span class="cp">#define MDFLD_DSR_RR		45</span>
<span class="cp">#define MDFLD_DPU_ENABLE 	(1 &lt;&lt; 31)</span>
<span class="cp">#define MDFLD_DSR_FULLSCREEN 	(1 &lt;&lt; 30)</span>
<span class="cp">#define MDFLD_DSR_DELAY		(DRM_HZ / MDFLD_DSR_RR)</span>

<span class="cp">#define PSB_PWR_STATE_ON		1</span>
<span class="cp">#define PSB_PWR_STATE_OFF		2</span>

<span class="cp">#define PSB_PMPOLICY_NOPM		0</span>
<span class="cp">#define PSB_PMPOLICY_CLOCKGATING	1</span>
<span class="cp">#define PSB_PMPOLICY_POWERDOWN		2</span>

<span class="cp">#define PSB_PMSTATE_POWERUP		0</span>
<span class="cp">#define PSB_PMSTATE_CLOCKGATED		1</span>
<span class="cp">#define PSB_PMSTATE_POWERDOWN		2</span>
<span class="cp">#define PSB_PCIx_MSI_ADDR_LOC		0x94</span>
<span class="cp">#define PSB_PCIx_MSI_DATA_LOC		0x98</span>

<span class="cm">/* Medfield crystal settings */</span>
<span class="cp">#define KSEL_CRYSTAL_19 1</span>
<span class="cp">#define KSEL_BYPASS_19 5</span>
<span class="cp">#define KSEL_BYPASS_25 6</span>
<span class="cp">#define KSEL_BYPASS_83_100 7</span>

<span class="k">struct</span> <span class="n">opregion_header</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_acpi</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_swsci</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_asle</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">psb_intel_opregion</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">opregion_header</span> <span class="o">*</span><span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_acpi</span> <span class="o">*</span><span class="n">acpi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_swsci</span> <span class="o">*</span><span class="n">swsci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_asle</span> <span class="o">*</span><span class="n">asle</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">vbt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">lid_state</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sdvo_device_mapping</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">initialized</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dvo_port</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">slave_addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dvo_wiring</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i2c_pin</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i2c_speed</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ddc_pin</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">intel_gmbus</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">force_bit</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reg0</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Register offset maps</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">psb_offset</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">fp0</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">fp1</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">cntr</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">conf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">src</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">dpll</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">dpll_md</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">htotal</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">hblank</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">hsync</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vtotal</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vblank</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vsync</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">pos</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">surf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">base</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">linoff</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tileoff</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">palette</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Register save state. This is used to hold the context when the</span>
<span class="cm"> *	device is powered off. In the case of Oaktrail this can (but does not</span>
<span class="cm"> *	yet) include screen blank. Operations occuring during the save</span>
<span class="cm"> *	update the register cache instead.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	Common status for pipes.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">psb_pipe</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">fp0</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">fp1</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">cntr</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">conf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">src</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">dpll</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">dpll_md</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">htotal</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">hblank</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">hsync</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vtotal</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vblank</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">vsync</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">pos</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">base</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">surf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">linoff</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tileoff</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">palette</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">psb_state</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">saveVCLK_DIVISOR_VGA0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveVCLK_DIVISOR_VGA1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveVCLK_POST_DIV</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveVGACNTRL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveADPA</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveLVDS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDVOA</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDVOB</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDVOC</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_ON</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_OFF</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_CONTROL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_CYCLE</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_CONTROL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveCLOCKGATING</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPARB</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_AUTO_RATIOS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_PGM_RATIOS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_ON_DELAYS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_OFF_DELAYS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_DIVISOR</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveBCLRPAT_A</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveBCLRPAT_B</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePERF_MODE</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW3</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW4</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW5</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW6</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveCHICKENBIT</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPACURSOR_CTRL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPBCURSOR_CTRL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPACURSOR_BASE</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPBCURSOR_BASE</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPACURSOR_POS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPBCURSOR_POS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OVADD</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC3</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC4</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOV_OGAMC5</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OVADD</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC3</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC4</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveOVC_OGAMC5</span><span class="p">;</span>

	<span class="cm">/* DPST register save */</span>
	<span class="kt">uint32_t</span> <span class="n">saveHISTOGRAM_INT_CONTROL_REG</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveHISTOGRAM_LOGIC_CONTROL_REG</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePWM_CONTROL_LOGIC</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">medfield_state</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">saveMIPI</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveMIPI_C</span><span class="p">;</span>

	<span class="kt">uint32_t</span> <span class="n">savePFIT_CONTROL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_PGM_RATIOS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveHDMIPHYMISCCTL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveHDMIB_CONTROL</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cdv_state</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPCLK_GATE_D</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveRAMCLK_GATE_D</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPARB</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveDSPFW</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">saveADPA</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_CONTROL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_PGM_RATIOS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveLVDS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePFIT_CONTROL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_ON_DELAYS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_OFF_DELAYS</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savePP_CYCLE</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveVGACNTRL</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveIER</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveIMR</span><span class="p">;</span>
	<span class="n">u8</span>	 <span class="n">saveLBB</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">psb_save_area</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">psb_pipe</span> <span class="n">pipe</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">saveBSM</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveVBT</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
	        <span class="k">struct</span> <span class="n">psb_state</span> <span class="n">psb</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">medfield_state</span> <span class="n">mdfld</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">cdv_state</span> <span class="n">cdv</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="kt">uint32_t</span> <span class="n">saveBLC_PWM_CTL2</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">saveBLC_PWM_CTL</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">psb_ops</span><span class="p">;</span>

<span class="cp">#define PSB_NUM_PIPE		3</span>

<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">psb_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">psb_offset</span> <span class="o">*</span><span class="n">regmap</span><span class="p">;</span>
	
	<span class="k">struct</span> <span class="n">child_device_config</span> <span class="o">*</span><span class="n">child_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">child_dev_num</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">psb_gtt</span> <span class="n">gtt</span><span class="p">;</span>

	<span class="cm">/* GTT Memory manager */</span>
	<span class="k">struct</span> <span class="n">psb_gtt_mm</span> <span class="o">*</span><span class="n">gtt_mm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">scratch_page</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">gtt_map</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">stolen_base</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">vram_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vram_stolen_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">gtt_initialized</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">gmch_ctrl</span><span class="p">;</span>		<span class="cm">/* Saved GTT setup */</span>
	<span class="n">u32</span> <span class="n">pge_ctl</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">gtt_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">gtt_mem</span><span class="p">;</span>	<span class="cm">/* Our PCI resource */</span>

	<span class="k">struct</span> <span class="n">psb_mmu_driver</span> <span class="o">*</span><span class="n">mmu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pf_pd</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Register base</span>
<span class="cm">	 */</span>

	<span class="kt">uint8_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">sgx_reg</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">vdc_reg</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gatt_free_offset</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Fencing / irq.</span>
<span class="cm">	 */</span>

	<span class="kt">uint32_t</span> <span class="n">vdc_irq_mask</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pipestat</span><span class="p">[</span><span class="n">PSB_NUM_PIPE</span><span class="p">];</span>

	<span class="n">spinlock_t</span> <span class="n">irqmask_lock</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Power</span>
<span class="cm">	 */</span>

	<span class="n">bool</span> <span class="n">suspended</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">display_power</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">display_count</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Modesetting</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">psb_intel_mode_device</span> <span class="n">mode_dev</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">modeset</span><span class="p">;</span>	<span class="cm">/* true if we have done the mode_device setup */</span>

	<span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">plane_to_crtc_mapping</span><span class="p">[</span><span class="n">PSB_NUM_PIPE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">pipe_to_crtc_mapping</span><span class="p">[</span><span class="n">PSB_NUM_PIPE</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">num_pipe</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * OSPM info (Power management base) (can go ?)</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span> <span class="n">ospm_base</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Sizes info</span>
<span class="cm">	 */</span>

	<span class="n">u32</span> <span class="n">fuse_reg_value</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">video_device_fuse</span><span class="p">;</span>

	<span class="cm">/* PCI revision ID for B0:D2:F0 */</span>
	<span class="kt">uint8_t</span> <span class="n">platform_rev_id</span><span class="p">;</span>

	<span class="cm">/* gmbus */</span>
	<span class="k">struct</span> <span class="n">intel_gmbus</span> <span class="o">*</span><span class="n">gmbus</span><span class="p">;</span>

	<span class="cm">/* Used by SDVO */</span>
	<span class="kt">int</span> <span class="n">crt_ddc_pin</span><span class="p">;</span>
	<span class="cm">/* FIXME: The mappings should be parsed from bios but for now we can</span>
<span class="cm">		  pretend there are no mappings available */</span>
	<span class="k">struct</span> <span class="n">sdvo_device_mapping</span> <span class="n">sdvo_mappings</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">hotplug_supported_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_property</span> <span class="o">*</span><span class="n">broadcast_rgb_property</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_property</span> <span class="o">*</span><span class="n">force_audio_property</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LVDS info</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">backlight_duty_cycle</span><span class="p">;</span>	<span class="cm">/* restore backlight to this value */</span>
	<span class="n">bool</span> <span class="n">panel_wants_dither</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">panel_fixed_mode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">lfp_lvds_vbt_mode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">sdvo_lvds_vbt_mode</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">bdb_lvds_backlight</span> <span class="o">*</span><span class="n">lvds_bl</span><span class="p">;</span> <span class="cm">/* LVDS backlight info from VBT */</span>
	<span class="k">struct</span> <span class="n">psb_intel_i2c_chan</span> <span class="o">*</span><span class="n">lvds_i2c_bus</span><span class="p">;</span> <span class="cm">/* FIXME: Remove this? */</span>

	<span class="cm">/* Feature bits from the VBIOS */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_tv_support</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_dither</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_vbt</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_crt_support</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_use_ssc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">lvds_ssc_freq</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">is_lvds_on</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">is_mipi_on</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mipi_ctrl_display</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">core_freq</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">iLVDS_enable</span><span class="p">;</span>

	<span class="cm">/* Runtime PM state */</span>
	<span class="kt">int</span> <span class="n">rpm_enabled</span><span class="p">;</span>

	<span class="cm">/* MID specific */</span>
	<span class="n">bool</span> <span class="n">has_gct</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">oaktrail_gct_data</span> <span class="n">gct_data</span><span class="p">;</span>

	<span class="cm">/* Oaktrail HDMI state */</span>
	<span class="k">struct</span> <span class="n">oaktrail_hdmi_dev</span> <span class="o">*</span><span class="n">hdmi_priv</span><span class="p">;</span>
	
	<span class="cm">/*</span>
<span class="cm">	 * Register state</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">psb_save_area</span> <span class="n">regs</span><span class="p">;</span>

	<span class="cm">/* MSI reg save */</span>
	<span class="kt">uint32_t</span> <span class="n">msi_addr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">msi_data</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Hotplug handling</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">hotplug_work</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * LID-Switch</span>
<span class="cm">	 */</span>
	<span class="n">spinlock_t</span> <span class="n">lid_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">lid_timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">psb_intel_opregion</span> <span class="n">opregion</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lid_last_state</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Watchdog</span>
<span class="cm">	 */</span>

	<span class="kt">uint32_t</span> <span class="n">apm_reg</span><span class="p">;</span>
	<span class="kt">uint16_t</span> <span class="n">apm_base</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Used for modifying backlight from</span>
<span class="cm">	 * xrandr -- consider removing and using HAL instead</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">backlight_device</span> <span class="o">*</span><span class="n">backlight_device</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_property</span> <span class="o">*</span><span class="n">backlight_property</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">blc_adj1</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">blc_adj2</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">fbdev</span><span class="p">;</span>

	<span class="cm">/* 2D acceleration */</span>
	<span class="n">spinlock_t</span> <span class="n">lock_2d</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Panel brightness</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">brightness</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">brightness_adjusted</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">dsr_enable</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dsr_fb_update</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">dpi_panel_on</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">dsi_configs</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bpp2</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">pipeconf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">dspcntr</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">mdfld_panel_id</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">dplla_96mhz</span><span class="p">;</span>	<span class="cm">/* DPLL data from the VBT */</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> *	Operations for each board type</span>
<span class="cm"> */</span>
 
<span class="k">struct</span> <span class="n">psb_ops</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">accel_2d</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pipes</span><span class="p">;</span>		<span class="cm">/* Number of output pipes */</span>
	<span class="kt">int</span> <span class="n">crtcs</span><span class="p">;</span>		<span class="cm">/* Number of CRTCs */</span>
	<span class="kt">int</span> <span class="n">sgx_offset</span><span class="p">;</span>		<span class="cm">/* Base offset of SGX device */</span>
	<span class="kt">int</span> <span class="n">hdmi_mask</span><span class="p">;</span>		<span class="cm">/* Mask of HDMI CRTCs */</span>
	<span class="kt">int</span> <span class="n">lvds_mask</span><span class="p">;</span>		<span class="cm">/* Mask of LVDS CRTCs */</span>
	<span class="kt">int</span> <span class="n">cursor_needs_phys</span><span class="p">;</span>  <span class="cm">/* If cursor base reg need physical address */</span>

	<span class="cm">/* Sub functions */</span>
	<span class="k">struct</span> <span class="n">drm_crtc_helper_funcs</span> <span class="k">const</span> <span class="o">*</span><span class="n">crtc_helper</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_crtc_funcs</span> <span class="k">const</span> <span class="o">*</span><span class="n">crtc_funcs</span><span class="p">;</span>

	<span class="cm">/* Setup hooks */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">chip_setup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">chip_teardown</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="cm">/* Optional helper caller after modeset */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">errata</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* Display management hooks */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">output_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hotplug</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hotplug_enable</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">on</span><span class="p">);</span>
	<span class="cm">/* Power management hooks */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_pm</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">save_regs</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">restore_regs</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">power_up</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">power_down</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lvds_bl_power</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">on</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_BACKLIGHT_CLASS_DEVICE</span>
	<span class="cm">/* Backlight */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">backlight_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="kt">int</span> <span class="n">i2c_bus</span><span class="p">;</span>		<span class="cm">/* I2C bus identifier for Moorestown */</span>
<span class="p">};</span>



<span class="k">struct</span> <span class="n">psb_mmu_driver</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">drm_crtc_probe_output_modes</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">drm_pick_crtcs</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="nf">psb_priv</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="p">)</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * MMU stuff.</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">psb_mmu_driver</span> <span class="o">*</span><span class="n">psb_mmu_driver_init</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">registers</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">trap_pagefaults</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">invalid_type</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_driver_takedown</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">psb_mmu_get_default_pd</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_driver</span>
						 <span class="o">*</span><span class="n">driver</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_mirror_gtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">mmu_offset</span><span class="p">,</span>
			       <span class="kt">uint32_t</span> <span class="n">gtt_start</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">gtt_pages</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">psb_mmu_alloc_pd</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">,</span>
					   <span class="kt">int</span> <span class="n">trap_pagefaults</span><span class="p">,</span>
					   <span class="kt">int</span> <span class="n">invalid_type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_free_pagedir</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_flush</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rc_prot</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_remove_pfn_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">,</span>
					<span class="kt">uint32_t</span> <span class="n">num_pages</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_mmu_insert_pfn_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
				       <span class="kt">uint32_t</span> <span class="n">start_pfn</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">,</span>
				       <span class="kt">uint32_t</span> <span class="n">num_pages</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_mmu_virtual_to_pfn</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="k">virtual</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pfn</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Enable / disable MMU for different requestors.</span>
<span class="cm"> */</span>


<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_set_pd_context</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hw_context</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_mmu_insert_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pages</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">num_pages</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="n">desired_tile_stride</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="n">hw_tile_stride</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_mmu_remove_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">psb_mmu_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">num_pages</span><span class="p">,</span>
				 <span class="kt">uint32_t</span> <span class="n">desired_tile_stride</span><span class="p">,</span>
				 <span class="kt">uint32_t</span> <span class="n">hw_tile_stride</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> *psb_irq.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="n">irqreturn_t</span> <span class="n">psb_irq_handler</span><span class="p">(</span><span class="n">DRM_IRQ_ARGS</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_irq_enable_dpst</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_irq_disable_dpst</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_irq_preinstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_irq_postinstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_irq_uninstall</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_irq_turn_on_dpst</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_irq_turn_off_dpst</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_irq_uninstall_islands</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hw_islands</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_vblank_wait2</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">sequence</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_vblank_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">sequence</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_enable_vblank</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_disable_vblank</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>
<span class="kt">void</span>
<span class="n">psb_enable_pipestat</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="kt">void</span>
<span class="n">psb_disable_pipestat</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">u32</span> <span class="n">psb_get_vblank_counter</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">crtc</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * framebuffer.c</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psbfb_probed</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psbfb_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_framebuffer</span> <span class="o">*</span><span class="n">fb</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * accel_2d.c</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psbfb_copyarea</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
					<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">region</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psbfb_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_spank</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * psb_reset.c</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_lid_timer_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_lid_timer_takedown</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_print_pagefault</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/* modesetting */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_modeset_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_modeset_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_fbdev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* backlight.c */</span>
<span class="kt">int</span> <span class="n">gma_backlight_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">gma_backlight_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* oaktrail_crtc.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">drm_crtc_helper_funcs</span> <span class="n">oaktrail_helper_funcs</span><span class="p">;</span>

<span class="cm">/* oaktrail_lvds.c */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">oaktrail_lvds_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">psb_intel_mode_device</span> <span class="o">*</span><span class="n">mode_dev</span><span class="p">);</span>

<span class="cm">/* psb_intel_display.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">drm_crtc_helper_funcs</span> <span class="n">psb_intel_helper_funcs</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">drm_crtc_funcs</span> <span class="n">psb_intel_crtc_funcs</span><span class="p">;</span>

<span class="cm">/* psb_intel_lvds.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">drm_connector_helper_funcs</span>
					<span class="n">psb_intel_lvds_connector_helper_funcs</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">drm_connector_funcs</span> <span class="n">psb_intel_lvds_connector_funcs</span><span class="p">;</span>

<span class="cm">/* gem.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_init_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">psb_gem_free_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_get_aperture</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_dumb_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_mode_create_dumb</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_dumb_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_dumb_map_gtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_fault</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_fault</span> <span class="o">*</span><span class="n">vmf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_create_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">psb_gem_mmap_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>

<span class="cm">/* psb_device.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">psb_ops</span> <span class="n">psb_chip_ops</span><span class="p">;</span>

<span class="cm">/* oaktrail_device.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">psb_ops</span> <span class="n">oaktrail_chip_ops</span><span class="p">;</span>

<span class="cm">/* mdlfd_device.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">psb_ops</span> <span class="n">mdfld_chip_ops</span><span class="p">;</span>

<span class="cm">/* cdv_device.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">psb_ops</span> <span class="n">cdv_chip_ops</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Debug print bits setting</span>
<span class="cm"> */</span>
<span class="cp">#define PSB_D_GENERAL (1 &lt;&lt; 0)</span>
<span class="cp">#define PSB_D_INIT    (1 &lt;&lt; 1)</span>
<span class="cp">#define PSB_D_IRQ     (1 &lt;&lt; 2)</span>
<span class="cp">#define PSB_D_ENTRY   (1 &lt;&lt; 3)</span>
<span class="cm">/* debug the get H/V BP/FP count */</span>
<span class="cp">#define PSB_D_HV      (1 &lt;&lt; 4)</span>
<span class="cp">#define PSB_D_DBI_BF  (1 &lt;&lt; 5)</span>
<span class="cp">#define PSB_D_PM      (1 &lt;&lt; 6)</span>
<span class="cp">#define PSB_D_RENDER  (1 &lt;&lt; 7)</span>
<span class="cp">#define PSB_D_REG     (1 &lt;&lt; 8)</span>
<span class="cp">#define PSB_D_MSVDX   (1 &lt;&lt; 9)</span>
<span class="cp">#define PSB_D_TOPAZ   (1 &lt;&lt; 10)</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">drm_psb_no_fb</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">drm_idle_check_interval</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Utilities</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">MRST_MSG_READ32</span><span class="p">(</span><span class="n">uint</span> <span class="n">port</span><span class="p">,</span> <span class="n">uint</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">mcr</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xD0</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">port</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="kt">uint32_t</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_root</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="n">mcr</span><span class="p">);</span>
	<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ret_val</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">pci_root</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret_val</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">MRST_MSG_WRITE32</span><span class="p">(</span><span class="n">uint</span> <span class="n">port</span><span class="p">,</span> <span class="n">uint</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">mcr</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xE0</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">port</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0xF0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_root</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="n">mcr</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">pci_root</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">MDFLD_MSG_READ32</span><span class="p">(</span><span class="n">uint</span> <span class="n">port</span><span class="p">,</span> <span class="n">uint</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">mcr</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x10</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">port</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="kt">uint32_t</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_root</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="n">mcr</span><span class="p">);</span>
	<span class="n">pci_read_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ret_val</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">pci_root</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret_val</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">MDFLD_MSG_WRITE32</span><span class="p">(</span><span class="n">uint</span> <span class="n">port</span><span class="p">,</span> <span class="n">uint</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">mcr</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x11</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">port</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0xF0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_root</span> <span class="o">=</span> <span class="n">pci_get_bus_and_slot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD4</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="n">pci_write_config_dword</span><span class="p">(</span><span class="n">pci_root</span><span class="p">,</span> <span class="mh">0xD0</span><span class="p">,</span> <span class="n">mcr</span><span class="p">);</span>
	<span class="n">pci_dev_put</span><span class="p">(</span><span class="n">pci_root</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">uint32_t</span> <span class="nf">REGISTER_READ</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ioread32</span><span class="p">(</span><span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">vdc_reg</span> <span class="o">+</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define REG_READ(reg)	       REGISTER_READ(dev, (reg))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">REGISTER_WRITE</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">reg</span><span class="p">,</span>
				      <span class="kt">uint32_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
	<span class="n">iowrite32</span><span class="p">((</span><span class="n">val</span><span class="p">),</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">vdc_reg</span> <span class="o">+</span> <span class="p">(</span><span class="n">reg</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#define REG_WRITE(reg, val)	REGISTER_WRITE(dev, (reg), (val))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">REGISTER_WRITE16</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					<span class="kt">uint32_t</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
	<span class="n">iowrite16</span><span class="p">((</span><span class="n">val</span><span class="p">),</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">vdc_reg</span> <span class="o">+</span> <span class="p">(</span><span class="n">reg</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#define REG_WRITE16(reg, val)	  REGISTER_WRITE16(dev, (reg), (val))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">REGISTER_WRITE8</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				       <span class="kt">uint32_t</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_psb_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
	<span class="n">iowrite8</span><span class="p">((</span><span class="n">val</span><span class="p">),</span> <span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">vdc_reg</span> <span class="o">+</span> <span class="p">(</span><span class="n">reg</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#define REG_WRITE8(reg, val)		REGISTER_WRITE8(dev, (reg), (val))</span>

<span class="cp">#define PSB_WVDC32(_val, _offs)		iowrite32(_val, dev_priv-&gt;vdc_reg + (_offs))</span>
<span class="cp">#define PSB_RVDC32(_offs)		ioread32(dev_priv-&gt;vdc_reg + (_offs))</span>

<span class="cm">/* #define TRAP_SGX_PM_FAULT 1 */</span>
<span class="cp">#ifdef TRAP_SGX_PM_FAULT</span>
<span class="cp">#define PSB_RSGX32(_offs)						\</span>
<span class="cp">({									\</span>
<span class="cp">	if (inl(dev_priv-&gt;apm_base + PSB_APM_STS) &amp; 0x3) {		\</span>
<span class="cp">		printk(KERN_ERR						\</span>
<span class="cp">			&quot;access sgx when it&#39;s off!! (READ) %s, %d\n&quot;,	\</span>
<span class="cp">	       __FILE__, __LINE__);					\</span>
<span class="cp">		melay(1000);						\</span>
<span class="cp">	}								\</span>
<span class="cp">	ioread32(dev_priv-&gt;sgx_reg + (_offs));				\</span>
<span class="cp">})</span>
<span class="cp">#else</span>
<span class="cp">#define PSB_RSGX32(_offs)		ioread32(dev_priv-&gt;sgx_reg + (_offs))</span>
<span class="cp">#endif</span>
<span class="cp">#define PSB_WSGX32(_val, _offs)		iowrite32(_val, dev_priv-&gt;sgx_reg + (_offs))</span>

<span class="cp">#define MSVDX_REG_DUMP 0</span>

<span class="cp">#define PSB_WMSVDX32(_val, _offs)	iowrite32(_val, dev_priv-&gt;msvdx_reg + (_offs))</span>
<span class="cp">#define PSB_RMSVDX32(_offs)		ioread32(dev_priv-&gt;msvdx_reg + (_offs))</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
