<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › gma500 › mdfld_dsi_output.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mdfld_dsi_output.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright © 2010 Intel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the next</span>
<span class="cm"> * paragraph) shall be included in all copies or substantial portions of the</span>
<span class="cm"> * Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</span>
<span class="cm"> * THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> * Authors:</span>
<span class="cm"> * jim liu &lt;jim.liu@intel.com&gt;</span>
<span class="cm"> * Jackie Li&lt;yaodong.li@intel.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __MDFLD_DSI_OUTPUT_H__</span>
<span class="cp">#define __MDFLD_DSI_OUTPUT_H__</span>

<span class="cp">#include &lt;linux/backlight.h&gt;</span>
<span class="cp">#include &lt;drm/drmP.h&gt;</span>
<span class="cp">#include &lt;drm/drm.h&gt;</span>
<span class="cp">#include &lt;drm/drm_crtc.h&gt;</span>
<span class="cp">#include &lt;drm/drm_edid.h&gt;</span>

<span class="cp">#include &quot;psb_drv.h&quot;</span>
<span class="cp">#include &quot;psb_intel_drv.h&quot;</span>
<span class="cp">#include &quot;psb_intel_reg.h&quot;</span>
<span class="cp">#include &quot;mdfld_output.h&quot;</span>

<span class="cp">#include &lt;asm/mrst.h&gt;</span>

<span class="cp">#define FLD_MASK(start, end)	(((1 &lt;&lt; ((start) - (end) + 1)) - 1) &lt;&lt; (end))</span>
<span class="cp">#define FLD_VAL(val, start, end) (((val) &lt;&lt; (end)) &amp; FLD_MASK(start, end))</span>
<span class="cp">#define FLD_GET(val, start, end) (((val) &amp; FLD_MASK(start, end)) &gt;&gt; (end))</span>
<span class="cp">#define FLD_MOD(orig, val, start, end) \</span>
<span class="cp">	(((orig) &amp; ~FLD_MASK(start, end)) | FLD_VAL(val, start, end))</span>

<span class="cp">#define REG_FLD_MOD(reg, val, start, end) \</span>
<span class="cp">	REG_WRITE(reg, FLD_MOD(REG_READ(reg), val, start, end))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">REGISTER_FLD_WAIT</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">,</span>
		<span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">end</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">FLD_GET</span><span class="p">(</span><span class="n">REG_READ</span><span class="p">(</span><span class="n">reg</span><span class="p">),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define REG_FLD_WAIT(reg, val, start, end) \</span>
<span class="cp">	REGISTER_FLD_WAIT(dev, reg, val, start, end)</span>

<span class="cp">#define REG_BIT_WAIT(reg, val, bitnum) \</span>
<span class="cp">	REGISTER_FLD_WAIT(dev, reg, val, bitnum, bitnum)</span>

<span class="cp">#define MDFLD_DSI_BRIGHTNESS_MAX_LEVEL 100</span>

<span class="cp">#ifdef DEBUG</span>
<span class="cp">#define CHECK_PIPE(pipe) ({			\</span>
<span class="cp">	const typeof(pipe) __pipe = (pipe);	\</span>
<span class="cp">	BUG_ON(__pipe != 0 &amp;&amp; __pipe != 2);	\</span>
<span class="cp">	__pipe;	})</span>
<span class="cp">#else</span>
<span class="cp">#define CHECK_PIPE(pipe) (pipe)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Actual MIPIA-&gt;MIPIC reg offset is 0x800, value 0x400 is valid for 0 and 2</span>
<span class="cm"> */</span>
<span class="cp">#define REG_OFFSET(pipe) (CHECK_PIPE(pipe) * 0x400)</span>

<span class="cm">/* mdfld DSI controller registers */</span>
<span class="cp">#define MIPI_DEVICE_READY_REG(pipe)		(0xb000 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_INTR_STAT_REG(pipe)		(0xb004 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_INTR_EN_REG(pipe)			(0xb008 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DSI_FUNC_PRG_REG(pipe)		(0xb00c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HS_TX_TIMEOUT_REG(pipe)		(0xb010 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_LP_RX_TIMEOUT_REG(pipe)		(0xb014 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_TURN_AROUND_TIMEOUT_REG(pipe)	(0xb018 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DEVICE_RESET_TIMER_REG(pipe)	(0xb01c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DPI_RESOLUTION_REG(pipe)		(0xb020 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DBI_FIFO_THROTTLE_REG(pipe)	(0xb024 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HSYNC_COUNT_REG(pipe)		(0xb028 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HBP_COUNT_REG(pipe)		(0xb02c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HFP_COUNT_REG(pipe)		(0xb030 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HACTIVE_COUNT_REG(pipe)		(0xb034 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_VSYNC_COUNT_REG(pipe)		(0xb038 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_VBP_COUNT_REG(pipe)		(0xb03c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_VFP_COUNT_REG(pipe)		(0xb040 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HIGH_LOW_SWITCH_COUNT_REG(pipe)	(0xb044 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DPI_CONTROL_REG(pipe)		(0xb048 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DPI_DATA_REG(pipe)			(0xb04c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_INIT_COUNT_REG(pipe)		(0xb050 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_MAX_RETURN_PACK_SIZE_REG(pipe)	(0xb054 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_VIDEO_MODE_FORMAT_REG(pipe)	(0xb058 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_EOT_DISABLE_REG(pipe)		(0xb05c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_LP_BYTECLK_REG(pipe)		(0xb060 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_LP_GEN_DATA_REG(pipe)		(0xb064 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HS_GEN_DATA_REG(pipe)		(0xb068 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_LP_GEN_CTRL_REG(pipe)		(0xb06c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HS_GEN_CTRL_REG(pipe)		(0xb070 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_GEN_FIFO_STAT_REG(pipe)		(0xb074 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_HS_LS_DBI_ENABLE_REG(pipe)		(0xb078 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DPHY_PARAM_REG(pipe)		(0xb080 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DBI_BW_CTRL_REG(pipe)		(0xb084 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_CLK_LANE_SWITCH_TIME_CNT_REG(pipe)	(0xb088 + REG_OFFSET(pipe))</span>

<span class="cp">#define MIPI_CTRL_REG(pipe)			(0xb104 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DATA_ADD_REG(pipe)			(0xb108 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_DATA_LEN_REG(pipe)			(0xb10c + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_CMD_ADD_REG(pipe)			(0xb110 + REG_OFFSET(pipe))</span>
<span class="cp">#define MIPI_CMD_LEN_REG(pipe)			(0xb114 + REG_OFFSET(pipe))</span>

<span class="cm">/* non-uniform reg offset */</span>
<span class="cp">#define MIPI_PORT_CONTROL(pipe)		(CHECK_PIPE(pipe) ? MIPI_C : MIPI)</span>

<span class="cp">#define DSI_DEVICE_READY				(0x1)</span>
<span class="cp">#define DSI_POWER_STATE_ULPS_ENTER			(0x2 &lt;&lt; 1)</span>
<span class="cp">#define DSI_POWER_STATE_ULPS_EXIT			(0x1 &lt;&lt; 1)</span>
<span class="cp">#define DSI_POWER_STATE_ULPS_OFFSET			(0x1)</span>


<span class="cp">#define DSI_ONE_DATA_LANE					(0x1)</span>
<span class="cp">#define DSI_TWO_DATA_LANE					(0x2)</span>
<span class="cp">#define DSI_THREE_DATA_LANE					(0X3)</span>
<span class="cp">#define DSI_FOUR_DATA_LANE					(0x4)</span>
<span class="cp">#define DSI_DPI_VIRT_CHANNEL_OFFSET			(0x3)</span>
<span class="cp">#define DSI_DBI_VIRT_CHANNEL_OFFSET			(0x5)</span>
<span class="cp">#define DSI_DPI_COLOR_FORMAT_RGB565			(0x01 &lt;&lt; 7)</span>
<span class="cp">#define DSI_DPI_COLOR_FORMAT_RGB666			(0x02 &lt;&lt; 7)</span>
<span class="cp">#define DSI_DPI_COLOR_FORMAT_RGB666_UNPACK		(0x03 &lt;&lt; 7)</span>
<span class="cp">#define DSI_DPI_COLOR_FORMAT_RGB888			(0x04 &lt;&lt; 7)</span>
<span class="cp">#define DSI_DBI_COLOR_FORMAT_OPTION2			(0x05 &lt;&lt; 13)</span>

<span class="cp">#define DSI_INTR_STATE_RXSOTERROR			BIT(0)</span>

<span class="cp">#define DSI_INTR_STATE_SPL_PKG_SENT			BIT(30)</span>
<span class="cp">#define DSI_INTR_STATE_TE				BIT(31)</span>

<span class="cp">#define DSI_HS_TX_TIMEOUT_MASK				(0xffffff)</span>

<span class="cp">#define DSI_LP_RX_TIMEOUT_MASK				(0xffffff)</span>

<span class="cp">#define DSI_TURN_AROUND_TIMEOUT_MASK		(0x3f)</span>

<span class="cp">#define DSI_RESET_TIMER_MASK				(0xffff)</span>

<span class="cp">#define DSI_DBI_FIFO_WM_HALF				(0x0)</span>
<span class="cp">#define DSI_DBI_FIFO_WM_QUARTER				(0x1)</span>
<span class="cp">#define DSI_DBI_FIFO_WM_LOW					(0x2)</span>

<span class="cp">#define DSI_DPI_TIMING_MASK					(0xffff)</span>

<span class="cp">#define DSI_INIT_TIMER_MASK					(0xffff)</span>

<span class="cp">#define DSI_DBI_RETURN_PACK_SIZE_MASK		(0x3ff)</span>

<span class="cp">#define DSI_LP_BYTECLK_MASK					(0x0ffff)</span>

<span class="cp">#define DSI_HS_CTRL_GEN_SHORT_W0			(0x03)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_SHORT_W1			(0x13)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_SHORT_W2			(0x23)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_R0					(0x04)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_R1					(0x14)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_R2					(0x24)</span>
<span class="cp">#define DSI_HS_CTRL_GEN_LONG_W				(0x29)</span>
<span class="cp">#define DSI_HS_CTRL_MCS_SHORT_W0			(0x05)</span>
<span class="cp">#define DSI_HS_CTRL_MCS_SHORT_W1			(0x15)</span>
<span class="cp">#define DSI_HS_CTRL_MCS_R0					(0x06)</span>
<span class="cp">#define DSI_HS_CTRL_MCS_LONG_W				(0x39)</span>
<span class="cp">#define DSI_HS_CTRL_VC_OFFSET				(0x06)</span>
<span class="cp">#define DSI_HS_CTRL_WC_OFFSET				(0x08)</span>

<span class="cp">#define	DSI_FIFO_GEN_HS_DATA_FULL			BIT(0)</span>
<span class="cp">#define DSI_FIFO_GEN_HS_DATA_HALF_EMPTY		BIT(1)</span>
<span class="cp">#define DSI_FIFO_GEN_HS_DATA_EMPTY			BIT(2)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_DATA_FULL			BIT(8)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_DATA_HALF_EMPTY		BIT(9)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_DATA_EMPTY			BIT(10)</span>
<span class="cp">#define DSI_FIFO_GEN_HS_CTRL_FULL			BIT(16)</span>
<span class="cp">#define DSI_FIFO_GEN_HS_CTRL_HALF_EMPTY		BIT(17)</span>
<span class="cp">#define DSI_FIFO_GEN_HS_CTRL_EMPTY			BIT(18)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_CTRL_FULL			BIT(24)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_CTRL_HALF_EMPTY		BIT(25)</span>
<span class="cp">#define DSI_FIFO_GEN_LP_CTRL_EMPTY			BIT(26)</span>
<span class="cp">#define DSI_FIFO_DBI_EMPTY					BIT(27)</span>
<span class="cp">#define DSI_FIFO_DPI_EMPTY					BIT(28)</span>

<span class="cp">#define DSI_DBI_HS_LP_SWITCH_MASK			(0x1)</span>

<span class="cp">#define DSI_HS_LP_SWITCH_COUNTER_OFFSET		(0x0)</span>
<span class="cp">#define DSI_LP_HS_SWITCH_COUNTER_OFFSET		(0x16)</span>

<span class="cp">#define DSI_DPI_CTRL_HS_SHUTDOWN			(0x00000001)</span>
<span class="cp">#define DSI_DPI_CTRL_HS_TURN_ON				(0x00000002)</span>

<span class="cm">/*dsi power modes*/</span>
<span class="cp">#define DSI_POWER_MODE_DISPLAY_ON	BIT(2)</span>
<span class="cp">#define DSI_POWER_MODE_NORMAL_ON	BIT(3)</span>
<span class="cp">#define DSI_POWER_MODE_SLEEP_OUT	BIT(4)</span>
<span class="cp">#define DSI_POWER_MODE_PARTIAL_ON	BIT(5)</span>
<span class="cp">#define DSI_POWER_MODE_IDLE_ON		BIT(6)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MDFLD_DSI_VIDEO_NON_BURST_MODE_SYNC_PULSE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MDFLD_DSI_VIDEO_NON_BURST_MODE_SYNC_EVENTS</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MDFLD_DSI_VIDEO_BURST_MODE</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define DSI_DPI_COMPLETE_LAST_LINE			BIT(2)</span>
<span class="cp">#define DSI_DPI_DISABLE_BTA					BIT(3)</span>

<span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">psb_intel_connector</span> <span class="n">base</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">pipe</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">pkg_sender</span><span class="p">;</span>

	<span class="cm">/* Connection status */</span>
	<span class="k">enum</span> <span class="n">drm_connector_status</span> <span class="n">status</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">psb_intel_encoder</span> <span class="n">base</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * DSI config, consists of one DSI connector, two DSI encoders.</span>
<span class="cm"> * DRM will pick up on DSI encoder basing on differents configs.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">fixed_mode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">mode</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span><span class="n">connector</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">changed</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">bpp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">lane_count</span><span class="p">;</span>
	<span class="cm">/*Virtual channel number for this encoder*/</span>
	<span class="kt">int</span> <span class="n">channel_num</span><span class="p">;</span>
	<span class="cm">/*video mode configure*/</span>
	<span class="kt">int</span> <span class="n">video_mode</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">dvr_ic_inited</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span><span class="nf">mdfld_dsi_connector</span><span class="p">(</span>
		<span class="k">struct</span> <span class="n">drm_connector</span> <span class="o">*</span><span class="n">connector</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">psb_intel_connector</span> <span class="o">*</span><span class="n">psb_connector</span><span class="p">;</span>

	<span class="n">psb_connector</span> <span class="o">=</span> <span class="n">to_psb_intel_connector</span><span class="p">(</span><span class="n">connector</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">psb_connector</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mdfld_dsi_connector</span><span class="p">,</span> <span class="n">base</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="nf">mdfld_dsi_encoder</span><span class="p">(</span>
		<span class="k">struct</span> <span class="n">drm_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">psb_intel_encoder</span> <span class="o">*</span><span class="n">psb_encoder</span><span class="p">;</span>

	<span class="n">psb_encoder</span> <span class="o">=</span> <span class="n">to_psb_intel_encoder</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">psb_encoder</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span><span class="p">,</span> <span class="n">base</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span>
	<span class="nf">mdfld_dsi_get_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span><span class="n">connector</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">connector</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="p">)</span><span class="n">connector</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">mdfld_dsi_get_pkg_sender</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span><span class="n">dsi_connector</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">config</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">dsi_connector</span> <span class="o">=</span> <span class="n">config</span><span class="o">-&gt;</span><span class="n">connector</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dsi_connector</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">dsi_connector</span><span class="o">-&gt;</span><span class="n">pkg_sender</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span>
	<span class="nf">mdfld_dsi_encoder_get_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">encoder</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="p">)</span><span class="n">encoder</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span>
	<span class="nf">mdfld_dsi_encoder_get_connector</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">config</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">encoder</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">config</span> <span class="o">=</span> <span class="n">mdfld_dsi_encoder_get_config</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">config</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">config</span><span class="o">-&gt;</span><span class="n">connector</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">mdfld_dsi_encoder_get_pkg_sender</span><span class="p">(</span>
				<span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">dsi_config</span><span class="p">;</span>

	<span class="n">dsi_config</span> <span class="o">=</span> <span class="n">mdfld_dsi_encoder_get_config</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dsi_config</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">mdfld_dsi_get_pkg_sender</span><span class="p">(</span><span class="n">dsi_config</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mdfld_dsi_encoder_get_pipe</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mdfld_dsi_connector</span> <span class="o">*</span><span class="n">connector</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">encoder</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">connector</span> <span class="o">=</span> <span class="n">mdfld_dsi_encoder_get_connector</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">connector</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">connector</span><span class="o">-&gt;</span><span class="n">pipe</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Export functions */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mdfld_dsi_gen_fifo_ready</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					<span class="n">u32</span> <span class="n">gen_fifo_stat_reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">fifo_stat</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mdfld_dsi_brightness_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">dsi_config</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">pipe</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mdfld_dsi_brightness_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">level</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mdfld_dsi_output_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span>
					<span class="k">const</span> <span class="k">struct</span> <span class="n">panel_funcs</span> <span class="o">*</span><span class="n">p_vid_funcs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mdfld_dsi_controller_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">dsi_config</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">pipe</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">mdfld_dsi_get_power_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">mdfld_dsi_config</span> <span class="o">*</span><span class="n">dsi_config</span><span class="p">,</span>
					<span class="n">u32</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="n">bool</span> <span class="n">hs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mdfld_dsi_panel_reset</span><span class="p">(</span><span class="kt">int</span> <span class="n">pipe</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/*__MDFLD_DSI_OUTPUT_H__*/</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
