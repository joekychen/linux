<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › i915 › i915_drv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>i915_drv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* i915_drv.h -- Private header for the I915 driver -*- linux-c -*-</span>
<span class="cm"> */</span>
<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2003 Tungsten Graphics, Inc., Cedar Park, Texas.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the</span>
<span class="cm"> * &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="cm"> * without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="cm"> * distribute, sub license, and/or sell copies of the Software, and to</span>
<span class="cm"> * permit persons to whom the Software is furnished to do so, subject to</span>
<span class="cm"> * the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the</span>
<span class="cm"> * next paragraph) shall be included in all copies or substantial portions</span>
<span class="cm"> * of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="cm"> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT.</span>
<span class="cm"> * IN NO EVENT SHALL TUNGSTEN GRAPHICS AND/OR ITS SUPPLIERS BE LIABLE FOR</span>
<span class="cm"> * ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,</span>
<span class="cm"> * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE</span>
<span class="cm"> * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _I915_DRV_H_</span>
<span class="cp">#define _I915_DRV_H_</span>

<span class="cp">#include &quot;i915_reg.h&quot;</span>
<span class="cp">#include &quot;intel_bios.h&quot;</span>
<span class="cp">#include &quot;intel_ringbuffer.h&quot;</span>
<span class="cp">#include &lt;linux/io-mapping.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c-algo-bit.h&gt;</span>
<span class="cp">#include &lt;drm/intel-gtt.h&gt;</span>
<span class="cp">#include &lt;linux/backlight.h&gt;</span>
<span class="cp">#include &lt;linux/intel-iommu.h&gt;</span>
<span class="cp">#include &lt;linux/kref.h&gt;</span>

<span class="cm">/* General customization:</span>
<span class="cm"> */</span>

<span class="cp">#define DRIVER_AUTHOR		&quot;Tungsten Graphics, Inc.&quot;</span>

<span class="cp">#define DRIVER_NAME		&quot;i915&quot;</span>
<span class="cp">#define DRIVER_DESC		&quot;Intel Graphics&quot;</span>
<span class="cp">#define DRIVER_DATE		&quot;20080730&quot;</span>

<span class="k">enum</span> <span class="n">pipe</span> <span class="p">{</span>
	<span class="n">PIPE_A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PIPE_B</span><span class="p">,</span>
	<span class="n">PIPE_C</span><span class="p">,</span>
	<span class="n">I915_MAX_PIPES</span>
<span class="p">};</span>
<span class="cp">#define pipe_name(p) ((p) + &#39;A&#39;)</span>

<span class="k">enum</span> <span class="n">plane</span> <span class="p">{</span>
	<span class="n">PLANE_A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PLANE_B</span><span class="p">,</span>
	<span class="n">PLANE_C</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#define plane_name(p) ((p) + &#39;A&#39;)</span>

<span class="k">enum</span> <span class="n">port</span> <span class="p">{</span>
	<span class="n">PORT_A</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PORT_B</span><span class="p">,</span>
	<span class="n">PORT_C</span><span class="p">,</span>
	<span class="n">PORT_D</span><span class="p">,</span>
	<span class="n">PORT_E</span><span class="p">,</span>
	<span class="n">I915_MAX_PORTS</span>
<span class="p">};</span>
<span class="cp">#define port_name(p) ((p) + &#39;A&#39;)</span>

<span class="cp">#define I915_GEM_GPU_DOMAINS	(~(I915_GEM_DOMAIN_CPU | I915_GEM_DOMAIN_GTT))</span>

<span class="cp">#define for_each_pipe(p) for ((p) = 0; (p) &lt; dev_priv-&gt;num_pipe; (p)++)</span>

<span class="k">struct</span> <span class="n">intel_pch_pll</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">refcount</span><span class="p">;</span> <span class="cm">/* count of number of CRTCs sharing this PLL */</span>
	<span class="kt">int</span> <span class="n">active</span><span class="p">;</span> <span class="cm">/* count of number of active CRTCs (i.e. DPMS on) */</span>
	<span class="n">bool</span> <span class="n">on</span><span class="p">;</span> <span class="cm">/* is the PLL actually active? Disabled during modeset */</span>
	<span class="kt">int</span> <span class="n">pll_reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fp0_reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fp1_reg</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define I915_NUM_PLLS 2</span>

<span class="cm">/* Interface history:</span>
<span class="cm"> *</span>
<span class="cm"> * 1.1: Original.</span>
<span class="cm"> * 1.2: Add Power Management</span>
<span class="cm"> * 1.3: Add vblank support</span>
<span class="cm"> * 1.4: Fix cmdbuffer path, add heap destroy</span>
<span class="cm"> * 1.5: Add vblank pipe configuration</span>
<span class="cm"> * 1.6: - New ioctl for scheduling buffer swaps on vertical blank</span>
<span class="cm"> *      - Support vertical blank on secondary display pipe</span>
<span class="cm"> */</span>
<span class="cp">#define DRIVER_MAJOR		1</span>
<span class="cp">#define DRIVER_MINOR		6</span>
<span class="cp">#define DRIVER_PATCHLEVEL	0</span>

<span class="cp">#define WATCH_COHERENCY	0</span>
<span class="cp">#define WATCH_LISTS	0</span>

<span class="cp">#define I915_GEM_PHYS_CURSOR_0 1</span>
<span class="cp">#define I915_GEM_PHYS_CURSOR_1 2</span>
<span class="cp">#define I915_GEM_PHYS_OVERLAY_REGS 3</span>
<span class="cp">#define I915_MAX_PHYS_OBJECT (I915_GEM_PHYS_OVERLAY_REGS)</span>

<span class="k">struct</span> <span class="n">drm_i915_gem_phys_object</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">page_list</span><span class="p">;</span>
	<span class="n">drm_dma_handle_t</span> <span class="o">*</span><span class="n">handle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">cur_obj</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mem_block</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mem_block</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mem_block</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">;</span> <span class="cm">/* NULL: free, -1: heap, other: real files */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">opregion_header</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_acpi</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_swsci</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">opregion_asle</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">drm_i915_private</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">intel_opregion</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">opregion_header</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_acpi</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">acpi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_swsci</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">swsci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opregion_asle</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">asle</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">vbt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">lid_state</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define OPREGION_SIZE            (8*1024)</span>

<span class="k">struct</span> <span class="n">intel_overlay</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">intel_overlay_error_state</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">drm_i915_master_private</span> <span class="p">{</span>
	<span class="n">drm_local_map_t</span> <span class="o">*</span><span class="n">sarea</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">_drm_i915_sarea</span> <span class="o">*</span><span class="n">sarea_priv</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define I915_FENCE_REG_NONE -1</span>
<span class="cp">#define I915_MAX_NUM_FENCES 16</span>
<span class="cm">/* 16 fences + sign bit for FENCE_REG_NONE */</span>
<span class="cp">#define I915_MAX_NUM_FENCE_BITS 5</span>

<span class="k">struct</span> <span class="n">drm_i915_fence_reg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lru_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pin_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sdvo_device_mapping</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">initialized</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dvo_port</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">slave_addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dvo_wiring</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i2c_pin</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ddc_pin</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">intel_display_error_state</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">drm_i915_error_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">kref</span> <span class="n">ref</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eir</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pgtbl_er</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ier</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">waiting</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">pipestat</span><span class="p">[</span><span class="n">I915_MAX_PIPES</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">tail</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">head</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">ipeir</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">ipehr</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">instdone</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">acthd</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">semaphore_mboxes</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">][</span><span class="n">I915_NUM_RINGS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
	<span class="cm">/* our own tracking of ring head and tail */</span>
	<span class="n">u32</span> <span class="n">cpu_ring_head</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">cpu_ring_tail</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">error</span><span class="p">;</span> <span class="cm">/* gen6+ */</span>
	<span class="n">u32</span> <span class="n">instpm</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">instps</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">instdone1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">seqno</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">bbaddr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fault_reg</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">done_reg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">faddr</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">fence</span><span class="p">[</span><span class="n">I915_MAX_NUM_FENCES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">timeval</span> <span class="n">time</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_error_ring</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">drm_i915_error_object</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">page_count</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">gtt_offset</span><span class="p">;</span>
			<span class="n">u32</span> <span class="o">*</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span> <span class="o">*</span><span class="n">ringbuffer</span><span class="p">,</span> <span class="o">*</span><span class="n">batchbuffer</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">drm_i915_error_request</span> <span class="p">{</span>
			<span class="kt">long</span> <span class="n">jiffies</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">seqno</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">tail</span><span class="p">;</span>
		<span class="p">}</span> <span class="o">*</span><span class="n">requests</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">num_requests</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">ring</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">drm_i915_error_buffer</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">name</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seqno</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">gtt_offset</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">read_domains</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">write_domain</span><span class="p">;</span>
		<span class="n">s32</span> <span class="n">fence_reg</span><span class="o">:</span><span class="n">I915_MAX_NUM_FENCE_BITS</span><span class="p">;</span>
		<span class="n">s32</span> <span class="n">pinned</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">tiling</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">dirty</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">purgeable</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">s32</span> <span class="n">ring</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cache_level</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">active_bo</span><span class="p">,</span> <span class="o">*</span><span class="n">pinned_bo</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">active_bo_count</span><span class="p">,</span> <span class="n">pinned_bo_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">intel_overlay_error_state</span> <span class="o">*</span><span class="n">overlay</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">intel_display_error_state</span> <span class="o">*</span><span class="n">display</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_i915_display_funcs</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dpms</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">fbc_enabled</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_fbc</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">interval</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_fbc</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_display_clock_speed</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_fifo_size</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">plane</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">update_wm</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">update_sprite_wm</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span>
				 <span class="kt">uint32_t</span> <span class="n">sprite_width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pixel_size</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">sanitize_pm</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">update_linetime_wm</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">crtc_mode_set</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">adjusted_mode</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_framebuffer</span> <span class="o">*</span><span class="n">old_fb</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">off</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">write_eld</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_connector</span> <span class="o">*</span><span class="n">connector</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fdi_link_train</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_clock_gating</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_pch_clock_gating</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">queue_flip</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">drm_framebuffer</span> <span class="o">*</span><span class="n">fb</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">update_plane</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_framebuffer</span> <span class="o">*</span><span class="n">fb</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">force_wake_get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">force_wake_put</span><span class="p">)(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
	<span class="cm">/* clock updates for mode set */</span>
	<span class="cm">/* cursor updates */</span>
	<span class="cm">/* render clock increase/decrease */</span>
	<span class="cm">/* display clock increase/decrease */</span>
	<span class="cm">/* pll clock increase/decrease */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">intel_device_info</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">gen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_mobile</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_i85x</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_i915g</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_i945gm</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_g33</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">need_gfx_hws</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_g4x</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_pineview</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_broadwater</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_crestline</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_ivybridge</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_valleyview</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_pch_split</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_force_wake</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_haswell</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_fbc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_pipe_cxsr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_hotplug</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cursor_needs_physical</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_overlay</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">overlay_needs_physical</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">supports_tv</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_bsd_ring</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_blt_ring</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">has_llc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define I915_PPGTT_PD_ENTRIES 512</span>
<span class="cp">#define I915_PPGTT_PT_ENTRIES 1024</span>
<span class="k">struct</span> <span class="n">i915_hw_ppgtt</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">num_pd_entries</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pt_pages</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pd_offset</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="o">*</span><span class="n">pt_dma_addr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">scratch_page_dma_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">no_fbc_reason</span> <span class="p">{</span>
	<span class="n">FBC_NO_OUTPUT</span><span class="p">,</span> <span class="cm">/* no outputs enabled to compress */</span>
	<span class="n">FBC_STOLEN_TOO_SMALL</span><span class="p">,</span> <span class="cm">/* not enough space to hold compressed buffers */</span>
	<span class="n">FBC_UNSUPPORTED_MODE</span><span class="p">,</span> <span class="cm">/* interlace or doublescanned mode */</span>
	<span class="n">FBC_MODE_TOO_LARGE</span><span class="p">,</span> <span class="cm">/* mode too large for compression */</span>
	<span class="n">FBC_BAD_PLANE</span><span class="p">,</span> <span class="cm">/* fbc not supported on plane */</span>
	<span class="n">FBC_NOT_TILED</span><span class="p">,</span> <span class="cm">/* buffer not tiled */</span>
	<span class="n">FBC_MULTIPLE_PIPES</span><span class="p">,</span> <span class="cm">/* more than one pipe active */</span>
	<span class="n">FBC_MODULE_PARAM</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">intel_pch</span> <span class="p">{</span>
	<span class="n">PCH_IBX</span><span class="p">,</span>	<span class="cm">/* Ibexpeak PCH */</span>
	<span class="n">PCH_CPT</span><span class="p">,</span>	<span class="cm">/* Cougarpoint PCH */</span>
	<span class="n">PCH_LPT</span><span class="p">,</span>	<span class="cm">/* Lynxpoint PCH */</span>
<span class="p">};</span>

<span class="cp">#define QUIRK_PIPEA_FORCE (1&lt;&lt;0)</span>
<span class="cp">#define QUIRK_LVDS_SSC_DISABLE (1&lt;&lt;1)</span>
<span class="cp">#define QUIRK_INVERT_BRIGHTNESS (1&lt;&lt;2)</span>

<span class="k">struct</span> <span class="n">intel_fbdev</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">intel_fbc_work</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">intel_gmbus</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="n">adapter</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">force_bit</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reg0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gpio_reg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_algo_bit_data</span> <span class="n">bit_algo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">intel_device_info</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">relative_constants_mode</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="cm">/** gt_fifo_count and the subsequent register write are synchronized</span>
<span class="cm">	 * with dev-&gt;struct_mutex. */</span>
	<span class="kt">unsigned</span> <span class="n">gt_fifo_count</span><span class="p">;</span>
	<span class="cm">/** forcewake_count is protected by gt_lock */</span>
	<span class="kt">unsigned</span> <span class="n">forcewake_count</span><span class="p">;</span>
	<span class="cm">/** gt_lock is also taken in irq contexts. */</span>
	<span class="k">struct</span> <span class="n">spinlock</span> <span class="n">gt_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">intel_gmbus</span> <span class="n">gmbus</span><span class="p">[</span><span class="n">GMBUS_NUM_PORTS</span><span class="p">];</span>

	<span class="cm">/** gmbus_mutex protects against concurrent usage of the single hw gmbus</span>
<span class="cm">	 * controller on different i2c buses. */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">gmbus_mutex</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Base address of the gmbus and gpio block.</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span> <span class="n">gpio_mmio_base</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">bridge_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="n">ring</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">next_seqno</span><span class="p">;</span>

	<span class="n">drm_dma_handle_t</span> <span class="o">*</span><span class="n">status_page_dmah</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">counter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">pwrctx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">renderctx</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">resource</span> <span class="n">mch_res</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">back_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">front_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">current_page</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">page_flipping</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">irq_received</span><span class="p">;</span>

	<span class="cm">/* protects the irq masks */</span>
	<span class="n">spinlock_t</span> <span class="n">irq_lock</span><span class="p">;</span>

	<span class="cm">/* DPIO indirect register protection */</span>
	<span class="n">spinlock_t</span> <span class="n">dpio_lock</span><span class="p">;</span>

	<span class="cm">/** Cached value of IMR to avoid reads in updating the bitfield */</span>
	<span class="n">u32</span> <span class="n">pipestat</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">irq_mask</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gt_irq_mask</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pch_irq_mask</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">hotplug_supported_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">hotplug_work</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sr01</span><span class="p">,</span> <span class="n">adpa</span><span class="p">,</span> <span class="n">ppcr</span><span class="p">,</span> <span class="n">dvob</span><span class="p">,</span> <span class="n">dvoc</span><span class="p">,</span> <span class="n">lvds</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_pipe</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_pch_pll</span><span class="p">;</span>

	<span class="cm">/* For hangcheck timer */</span>
<span class="cp">#define DRM_I915_HANGCHECK_PERIOD 1500 </span><span class="cm">/* in ms */</span><span class="cp"></span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">hangcheck_timer</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">hangcheck_count</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">last_acthd</span><span class="p">[</span><span class="n">I915_NUM_RINGS</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">last_instdone</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">last_instdone1</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stop_rings</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cfb_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cfb_fb</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">plane</span> <span class="n">cfb_plane</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cfb_y</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">intel_fbc_work</span> <span class="o">*</span><span class="n">fbc_work</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">intel_opregion</span> <span class="n">opregion</span><span class="p">;</span>

	<span class="cm">/* overlay */</span>
	<span class="k">struct</span> <span class="n">intel_overlay</span> <span class="o">*</span><span class="n">overlay</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">sprite_scaling_enabled</span><span class="p">;</span>

	<span class="cm">/* LVDS info */</span>
	<span class="kt">int</span> <span class="n">backlight_level</span><span class="p">;</span>  <span class="cm">/* restore backlight to this value */</span>
	<span class="n">bool</span> <span class="n">backlight_enabled</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">lfp_lvds_vbt_mode</span><span class="p">;</span> <span class="cm">/* if any */</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">sdvo_lvds_vbt_mode</span><span class="p">;</span> <span class="cm">/* if any */</span>

	<span class="cm">/* Feature bits from the VBIOS */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_tv_support</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_dither</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_vbt</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_crt_support</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_use_ssc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">display_clock_mode</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">lvds_ssc_freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bios_lvds_val</span><span class="p">;</span> <span class="cm">/* initial [PCH_]LVDS reg val in VBIOS */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_val</span><span class="p">;</span> <span class="cm">/* used for checking LVDS channel mode */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">lanes</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">preemphasis</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">vswing</span><span class="p">;</span>

		<span class="n">bool</span> <span class="n">initialized</span><span class="p">;</span>
		<span class="n">bool</span> <span class="n">support</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">bpp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">edp_power_seq</span> <span class="n">pps</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">edp</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">no_aux_handshake</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">notifier_block</span> <span class="n">lid_notifier</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">crt_ddc_pin</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_fence_reg</span> <span class="n">fence_regs</span><span class="p">[</span><span class="n">I915_MAX_NUM_FENCES</span><span class="p">];</span> <span class="cm">/* assume 965 */</span>
	<span class="kt">int</span> <span class="n">fence_reg_start</span><span class="p">;</span> <span class="cm">/* 4 if userland hasn&#39;t ioctl&#39;d us yet */</span>
	<span class="kt">int</span> <span class="n">num_fence_regs</span><span class="p">;</span> <span class="cm">/* 8 on pre-965, 16 otherwise */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fsb_freq</span><span class="p">,</span> <span class="n">mem_freq</span><span class="p">,</span> <span class="n">is_ddr3</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">error_lock</span><span class="p">;</span>
	<span class="cm">/* Protected by dev-&gt;error_lock. */</span>
	<span class="k">struct</span> <span class="n">drm_i915_error_state</span> <span class="o">*</span><span class="n">first_error</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">error_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">error_completion</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">wq</span><span class="p">;</span>

	<span class="cm">/* Display functions */</span>
	<span class="k">struct</span> <span class="n">drm_i915_display_funcs</span> <span class="n">display</span><span class="p">;</span>

	<span class="cm">/* PCH chipset type */</span>
	<span class="k">enum</span> <span class="n">intel_pch</span> <span class="n">pch_type</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">quirks</span><span class="p">;</span>

	<span class="cm">/* Register state */</span>
	<span class="n">bool</span> <span class="n">modeset_on_lid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">saveLBB</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPACNTR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBCNTR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPARB</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHWS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEACONF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEBCONF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEASRC</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEBSRC</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFPA0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFPA1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDPLL_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDPLL_A_MD</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHTOTAL_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHBLANK_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHSYNC_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVTOTAL_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVBLANK_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVSYNC_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBCLRPAT_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANSACONF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HTOTAL_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HBLANK_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HSYNC_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VTOTAL_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VBLANK_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VSYNC_A</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEASTAT</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPASTRIDE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPASIZE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPAPOS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPAADDR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPASURF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPATILEOFF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFIT_PGM_RATIOS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBLC_HIST_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBLC_PWM_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBLC_PWM_CTL2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBLC_CPU_PWM_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBLC_CPU_PWM_CTL2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFPB0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFPB1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDPLL_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDPLL_B_MD</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHTOTAL_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHBLANK_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveHSYNC_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVTOTAL_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVBLANK_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVSYNC_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveBCLRPAT_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANSBCONF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HTOTAL_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HBLANK_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_HSYNC_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VTOTAL_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VBLANK_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveTRANS_VSYNC_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEBSTAT</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBSTRIDE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBSIZE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBPOS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBADDR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBSURF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDSPBTILEOFF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVGA0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVGA1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVGA_PD</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveVGACNTRL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveADPA</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveLVDS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_ON_DELAYS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_OFF_DELAYS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDVOA</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDVOB</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDVOC</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_ON</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_OFF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_CONTROL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePP_DIVISOR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFIT_CONTROL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">save_palette_a</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">save_palette_b</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">saveDPFC_CB_BASE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFBC_CFB_BASE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFBC_LL_BASE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFBC_CONTROL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFBC_CONTROL2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveIER</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveIIR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveIMR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDEIER</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDEIMR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveGTIER</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveGTIMR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_RXA_IMR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_RXB_IMR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCACHE_MODE_0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveMI_ARB_STATE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveSWF0</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">saveSWF1</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">saveSWF2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">saveMSR</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">saveSR</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">saveGR</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">saveAR_INDEX</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">saveAR</span><span class="p">[</span><span class="mi">21</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">saveDACMASK</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">saveCR</span><span class="p">[</span><span class="mi">37</span><span class="p">];</span>
	<span class="kt">uint64_t</span> <span class="n">saveFENCE</span><span class="p">[</span><span class="n">I915_MAX_NUM_FENCES</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">saveCURACNTR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURAPOS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURABASE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURBCNTR</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURBPOS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURBBASE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveCURSIZE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDP_B</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDP_C</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDP_D</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_GMCH_DATA_M</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_GMCH_DATA_M</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_GMCH_DATA_N</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_GMCH_DATA_N</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_DP_LINK_M</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_DP_LINK_M</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_DP_LINK_N</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_DP_LINK_N</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_RXA_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_TXA_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_RXB_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveFDI_TXB_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFA_CTL_1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFB_CTL_1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFA_WIN_SZ</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFB_WIN_SZ</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFA_WIN_POS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePFB_WIN_POS</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePCH_DREF_CONTROL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveDISP_ARB_CTL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_DATA_M1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_DATA_N1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_LINK_M1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEA_LINK_N1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_DATA_M1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_DATA_N1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_LINK_M1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePIPEB_LINK_N1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saveMCHBAR_RENDER_STANDBY</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">savePCH_PORT_HOTPLUG</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/** Bridge to intel-gtt-ko */</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">intel_gtt</span> <span class="o">*</span><span class="n">gtt</span><span class="p">;</span>
		<span class="cm">/** Memory allocator for GTT stolen memory */</span>
		<span class="k">struct</span> <span class="n">drm_mm</span> <span class="n">stolen</span><span class="p">;</span>
		<span class="cm">/** Memory allocator for GTT */</span>
		<span class="k">struct</span> <span class="n">drm_mm</span> <span class="n">gtt_space</span><span class="p">;</span>
		<span class="cm">/** List of all objects in gtt_space. Used to restore gtt</span>
<span class="cm">		 * mappings on resume */</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gtt_list</span><span class="p">;</span>

		<span class="cm">/** Usable portion of the GTT for GEM */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gtt_start</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gtt_mappable_end</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gtt_end</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">io_mapping</span> <span class="o">*</span><span class="n">gtt_mapping</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">gtt_mtrr</span><span class="p">;</span>

		<span class="cm">/** PPGTT used for aliasing the PPGTT with the GTT */</span>
		<span class="k">struct</span> <span class="n">i915_hw_ppgtt</span> <span class="o">*</span><span class="n">aliasing_ppgtt</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">shrinker</span> <span class="n">inactive_shrinker</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * List of objects currently involved in rendering.</span>
<span class="cm">		 *</span>
<span class="cm">		 * Includes buffers having the contents of their GPU caches</span>
<span class="cm">		 * flushed, not necessarily primitives.  last_rendering_seqno</span>
<span class="cm">		 * represents when the rendering involved will be completed.</span>
<span class="cm">		 *</span>
<span class="cm">		 * A reference is held on the buffer while on this list.</span>
<span class="cm">		 */</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">active_list</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * List of objects which are not in the ringbuffer but which</span>
<span class="cm">		 * still have a write_domain which needs to be flushed before</span>
<span class="cm">		 * unbinding.</span>
<span class="cm">		 *</span>
<span class="cm">		 * last_rendering_seqno is 0 while an object is in this list.</span>
<span class="cm">		 *</span>
<span class="cm">		 * A reference is held on the buffer while on this list.</span>
<span class="cm">		 */</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">flushing_list</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * LRU list of objects which are not in the ringbuffer and</span>
<span class="cm">		 * are ready to unbind, but are still in the GTT.</span>
<span class="cm">		 *</span>
<span class="cm">		 * last_rendering_seqno is 0 while an object is in this list.</span>
<span class="cm">		 *</span>
<span class="cm">		 * A reference is not held on the buffer while on this list,</span>
<span class="cm">		 * as merely being GTT-bound shouldn&#39;t prevent its being</span>
<span class="cm">		 * freed, and we&#39;ll pull it off the list in the free path.</span>
<span class="cm">		 */</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">inactive_list</span><span class="p">;</span>

		<span class="cm">/** LRU list of objects with fence regs on them. */</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">fence_list</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * We leave the user IRQ off as much as possible,</span>
<span class="cm">		 * but this means that requests will finish and never</span>
<span class="cm">		 * be retired once the system goes idle. Set a timer to</span>
<span class="cm">		 * fire periodically while the ring is running. When it</span>
<span class="cm">		 * fires, go retire requests.</span>
<span class="cm">		 */</span>
		<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">retire_work</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * Are we in a non-interruptible section of code like</span>
<span class="cm">		 * modesetting?</span>
<span class="cm">		 */</span>
		<span class="n">bool</span> <span class="n">interruptible</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * Flag if the X Server, and thus DRM, is not currently in</span>
<span class="cm">		 * control of the device.</span>
<span class="cm">		 *</span>
<span class="cm">		 * This is set between LeaveVT and EnterVT.  It needs to be</span>
<span class="cm">		 * replaced with a semaphore.  It also needs to be</span>
<span class="cm">		 * transitioned away from for kernel modesetting.</span>
<span class="cm">		 */</span>
		<span class="kt">int</span> <span class="n">suspended</span><span class="p">;</span>

		<span class="cm">/**</span>
<span class="cm">		 * Flag if the hardware appears to be wedged.</span>
<span class="cm">		 *</span>
<span class="cm">		 * This is set when attempts to idle the device timeout.</span>
<span class="cm">		 * It prevents command submission from occurring and makes</span>
<span class="cm">		 * every pending request fail</span>
<span class="cm">		 */</span>
		<span class="n">atomic_t</span> <span class="n">wedged</span><span class="p">;</span>

		<span class="cm">/** Bit 6 swizzling required for X tiling */</span>
		<span class="kt">uint32_t</span> <span class="n">bit_6_swizzle_x</span><span class="p">;</span>
		<span class="cm">/** Bit 6 swizzling required for Y tiling */</span>
		<span class="kt">uint32_t</span> <span class="n">bit_6_swizzle_y</span><span class="p">;</span>

		<span class="cm">/* storage for physical objects */</span>
		<span class="k">struct</span> <span class="n">drm_i915_gem_phys_object</span> <span class="o">*</span><span class="n">phys_objs</span><span class="p">[</span><span class="n">I915_MAX_PHYS_OBJECT</span><span class="p">];</span>

		<span class="cm">/* accounting, useful for userland debugging */</span>
		<span class="kt">size_t</span> <span class="n">gtt_total</span><span class="p">;</span>
		<span class="kt">size_t</span> <span class="n">mappable_gtt_total</span><span class="p">;</span>
		<span class="kt">size_t</span> <span class="n">object_memory</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">object_count</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">mm</span><span class="p">;</span>

	<span class="cm">/* Old dri1 support infrastructure, beware the dragons ya fools entering</span>
<span class="cm">	 * here! */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="n">allow_batchbuffer</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">gfx_hws_cpu_addr</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">dri1</span><span class="p">;</span>

	<span class="cm">/* Kernel Modesetting */</span>

	<span class="k">struct</span> <span class="n">sdvo_device_mapping</span> <span class="n">sdvo_mappings</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="cm">/* indicate whether the LVDS_BORDER should be enabled or not */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lvds_border_bits</span><span class="p">;</span>
	<span class="cm">/* Panel fitter placement and size for Ironlake+ */</span>
	<span class="n">u32</span> <span class="n">pch_pf_pos</span><span class="p">,</span> <span class="n">pch_pf_size</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">plane_to_crtc_mapping</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">pipe_to_crtc_mapping</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">wait_queue_head_t</span> <span class="n">pending_flip_queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">intel_pch_pll</span> <span class="n">pch_plls</span><span class="p">[</span><span class="n">I915_NUM_PLLS</span><span class="p">];</span>

	<span class="cm">/* Reclocking support */</span>
	<span class="n">bool</span> <span class="n">render_reclock_avail</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">lvds_downclock_avail</span><span class="p">;</span>
	<span class="cm">/* indicates the reduced downclock for LVDS*/</span>
	<span class="kt">int</span> <span class="n">lvds_downclock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">idle_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">idle_timer</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">busy</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">orig_clock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">child_dev_num</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">child_device_config</span> <span class="o">*</span><span class="n">child_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_connector</span> <span class="o">*</span><span class="n">int_lvds_connector</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_connector</span> <span class="o">*</span><span class="n">int_edp_connector</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">mchbar_need_disable</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">rps_work</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">rps_lock</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pm_iir</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">cur_delay</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">min_delay</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_delay</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fmax</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fstart</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">last_count1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_time1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">chipset_power</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">last_count2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timespec</span> <span class="n">last_time2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gfx_power</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">c_m</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">r_t</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">corr</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="o">*</span><span class="n">mchdev_lock</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">no_fbc_reason</span> <span class="n">no_fbc_reason</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_mm_node</span> <span class="o">*</span><span class="n">compressed_fb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_mm_node</span> <span class="o">*</span><span class="n">compressed_llb</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_gpu_reset</span><span class="p">;</span>

	<span class="cm">/* list of fbdev register on this device */</span>
	<span class="k">struct</span> <span class="n">intel_fbdev</span> <span class="o">*</span><span class="n">fbdev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">backlight_device</span> <span class="o">*</span><span class="n">backlight</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_property</span> <span class="o">*</span><span class="n">broadcast_rgb_property</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_property</span> <span class="o">*</span><span class="n">force_audio_property</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_i915_private_t</span><span class="p">;</span>

<span class="cm">/* Iterate over initialised rings */</span>
<span class="cp">#define for_each_ring(ring__, dev_priv__, i__) \</span>
<span class="cp">	for ((i__) = 0; (i__) &lt; I915_NUM_RINGS; (i__)++) \</span>
<span class="cp">		if (((ring__) = &amp;(dev_priv__)-&gt;ring[(i__)]), intel_ring_initialized((ring__)))</span>

<span class="k">enum</span> <span class="n">hdmi_force_audio</span> <span class="p">{</span>
	<span class="n">HDMI_AUDIO_OFF_DVI</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* no aux data for HDMI-DVI converter */</span>
	<span class="n">HDMI_AUDIO_OFF</span><span class="p">,</span>			<span class="cm">/* force turn off HDMI audio */</span>
	<span class="n">HDMI_AUDIO_AUTO</span><span class="p">,</span>		<span class="cm">/* trust EDID */</span>
	<span class="n">HDMI_AUDIO_ON</span><span class="p">,</span>			<span class="cm">/* force turn on HDMI audio */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">i915_cache_level</span> <span class="p">{</span>
	<span class="n">I915_CACHE_NONE</span><span class="p">,</span>
	<span class="n">I915_CACHE_LLC</span><span class="p">,</span>
	<span class="n">I915_CACHE_LLC_MLC</span><span class="p">,</span> <span class="cm">/* gen6+ */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="n">base</span><span class="p">;</span>

	<span class="cm">/** Current space allocated to this object in the GTT, if any. */</span>
	<span class="k">struct</span> <span class="n">drm_mm_node</span> <span class="o">*</span><span class="n">gtt_space</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gtt_list</span><span class="p">;</span>

	<span class="cm">/** This object&#39;s place on the active/flushing/inactive lists */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ring_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">mm_list</span><span class="p">;</span>
	<span class="cm">/** This object&#39;s place on GPU write list */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gpu_write_list</span><span class="p">;</span>
	<span class="cm">/** This object&#39;s place in the batchbuffer or on the eviction list */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">exec_list</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This is set if the object is on the active or flushing lists</span>
<span class="cm">	 * (has pending rendering), and is not set if it&#39;s on inactive (ready</span>
<span class="cm">	 * to be unbound).</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">active</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This is set if the object has been written to since last bound</span>
<span class="cm">	 * to the GTT</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dirty</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This is set if the object has been written to since the last</span>
<span class="cm">	 * GPU flush.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pending_gpu_write</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Fence register bits (if any) for this object.  Will be set</span>
<span class="cm">	 * as needed when mapped into the GTT.</span>
<span class="cm">	 * Protected by dev-&gt;struct_mutex.</span>
<span class="cm">	 */</span>
	<span class="kt">signed</span> <span class="kt">int</span> <span class="n">fence_reg</span><span class="o">:</span><span class="n">I915_MAX_NUM_FENCE_BITS</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Advice: are the backing pages purgeable?</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">madv</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Current tiling mode for the object.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tiling_mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="cm">/**</span>
<span class="cm">	 * Whether the tiling parameters for the currently associated fence</span>
<span class="cm">	 * register have changed. Note that for the purposes of tracking</span>
<span class="cm">	 * tiling changes we also treat the unfenced register, the register</span>
<span class="cm">	 * slot that the object occupies whilst it executes a fenced</span>
<span class="cm">	 * command (such as BLT on gen2/3), as a &quot;fence&quot;.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fence_dirty</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/** How many users have pinned this object in GTT space. The following</span>
<span class="cm">	 * users can each hold at most one reference: pwrite/pread, pin_ioctl</span>
<span class="cm">	 * (via user_pin_count), execbuffer (objects are not allowed multiple</span>
<span class="cm">	 * times for the same batchbuffer), and the framebuffer code. When</span>
<span class="cm">	 * switching/pageflipping, the framebuffer code has at most two buffers</span>
<span class="cm">	 * pinned per crtc.</span>
<span class="cm">	 *</span>
<span class="cm">	 * In the worst case this is 1 + 1 + 1 + 2*2 = 7. That would fit into 3</span>
<span class="cm">	 * bits with absolutely no headroom. So use 4 bits. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pin_count</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
<span class="cp">#define DRM_I915_GEM_OBJECT_MAX_PIN_COUNT 0xf</span>

	<span class="cm">/**</span>
<span class="cm">	 * Is the object at the current location in the gtt mappable and</span>
<span class="cm">	 * fenceable? Used to avoid costly recalculations.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">map_and_fenceable</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Whether the current gtt mapping needs to be mappable (and isn&#39;t just</span>
<span class="cm">	 * mappable by accident). Track pin and fault separate for a more</span>
<span class="cm">	 * accurate mappable working set.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fault_mappable</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pin_mappable</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Is the GPU currently using a fence to access this buffer,</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pending_fenced_gpu_access</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fenced_gpu_access</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cache_level</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">has_aliasing_ppgtt_mapping</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">has_global_gtt_mapping</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pages</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * DMAR support</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sg_list</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_sg</span><span class="p">;</span>

	<span class="cm">/* prime dma-buf support */</span>
	<span class="k">struct</span> <span class="n">sg_table</span> <span class="o">*</span><span class="n">sg_table</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">dma_buf_vmapping</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vmapping_count</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Used for performing relocations during execbuffer insertion.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">hlist_node</span> <span class="n">exec_node</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exec_handle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_exec_object2</span> <span class="o">*</span><span class="n">exec_entry</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Current offset of the object in GTT space.</span>
<span class="cm">	 *</span>
<span class="cm">	 * This is the same as gtt_space-&gt;start</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span> <span class="n">gtt_offset</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>

	<span class="cm">/** Breadcrumb of last rendering to the buffer. */</span>
	<span class="kt">uint32_t</span> <span class="n">last_rendering_seqno</span><span class="p">;</span>
	<span class="cm">/** Breadcrumb of last fenced GPU access to the buffer. */</span>
	<span class="kt">uint32_t</span> <span class="n">last_fenced_seqno</span><span class="p">;</span>

	<span class="cm">/** Current tiling stride for the object, if it&#39;s tiled. */</span>
	<span class="kt">uint32_t</span> <span class="n">stride</span><span class="p">;</span>

	<span class="cm">/** Record of address bit 17 of each page at last unbind. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">bit_17</span><span class="p">;</span>

	<span class="cm">/** User space pin count and filp owning the pin */</span>
	<span class="kt">uint32_t</span> <span class="n">user_pin_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">pin_filp</span><span class="p">;</span>

	<span class="cm">/** for phy allocated objects */</span>
	<span class="k">struct</span> <span class="n">drm_i915_gem_phys_object</span> <span class="o">*</span><span class="n">phys_obj</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Number of crtcs where this object is currently the fb, but</span>
<span class="cm">	 * will be page flipped away on the next vblank.  When it</span>
<span class="cm">	 * reaches 0, dev_priv-&gt;pending_flip_queue will be woken up.</span>
<span class="cm">	 */</span>
	<span class="n">atomic_t</span> <span class="n">pending_flip</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_intel_bo(x) container_of(x, struct drm_i915_gem_object, base)</span>

<span class="cm">/**</span>
<span class="cm"> * Request queue structure.</span>
<span class="cm"> *</span>
<span class="cm"> * The request queue allows us to note sequence numbers that have been emitted</span>
<span class="cm"> * and may be associated with active buffers to be retired.</span>
<span class="cm"> *</span>
<span class="cm"> * By keeping this list, we can avoid having to do questionable</span>
<span class="cm"> * sequence-number comparisons on buffer last_rendering_seqnos, and associate</span>
<span class="cm"> * an emission time with seqnos for tracking how far ahead of the GPU we are.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">drm_i915_gem_request</span> <span class="p">{</span>
	<span class="cm">/** On Which ring this request was generated */</span>
	<span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>

	<span class="cm">/** GEM sequence number associated with this request. */</span>
	<span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">;</span>

	<span class="cm">/** Postion in the ringbuffer of the end of the request */</span>
	<span class="n">u32</span> <span class="n">tail</span><span class="p">;</span>

	<span class="cm">/** Time at which this request was emitted, in jiffies. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">emitted_jiffies</span><span class="p">;</span>

	<span class="cm">/** global list entry for this request */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_i915_file_private</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">;</span>
	<span class="cm">/** file_priv list entry for this request */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">client_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_i915_file_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">spinlock</span> <span class="n">lock</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">request_list</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">mm</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define INTEL_INFO(dev)	(((struct drm_i915_private *) (dev)-&gt;dev_private)-&gt;info)</span>

<span class="cp">#define IS_I830(dev)		((dev)-&gt;pci_device == 0x3577)</span>
<span class="cp">#define IS_845G(dev)		((dev)-&gt;pci_device == 0x2562)</span>
<span class="cp">#define IS_I85X(dev)		(INTEL_INFO(dev)-&gt;is_i85x)</span>
<span class="cp">#define IS_I865G(dev)		((dev)-&gt;pci_device == 0x2572)</span>
<span class="cp">#define IS_I915G(dev)		(INTEL_INFO(dev)-&gt;is_i915g)</span>
<span class="cp">#define IS_I915GM(dev)		((dev)-&gt;pci_device == 0x2592)</span>
<span class="cp">#define IS_I945G(dev)		((dev)-&gt;pci_device == 0x2772)</span>
<span class="cp">#define IS_I945GM(dev)		(INTEL_INFO(dev)-&gt;is_i945gm)</span>
<span class="cp">#define IS_BROADWATER(dev)	(INTEL_INFO(dev)-&gt;is_broadwater)</span>
<span class="cp">#define IS_CRESTLINE(dev)	(INTEL_INFO(dev)-&gt;is_crestline)</span>
<span class="cp">#define IS_GM45(dev)		((dev)-&gt;pci_device == 0x2A42)</span>
<span class="cp">#define IS_G4X(dev)		(INTEL_INFO(dev)-&gt;is_g4x)</span>
<span class="cp">#define IS_PINEVIEW_G(dev)	((dev)-&gt;pci_device == 0xa001)</span>
<span class="cp">#define IS_PINEVIEW_M(dev)	((dev)-&gt;pci_device == 0xa011)</span>
<span class="cp">#define IS_PINEVIEW(dev)	(INTEL_INFO(dev)-&gt;is_pineview)</span>
<span class="cp">#define IS_G33(dev)		(INTEL_INFO(dev)-&gt;is_g33)</span>
<span class="cp">#define IS_IRONLAKE_D(dev)	((dev)-&gt;pci_device == 0x0042)</span>
<span class="cp">#define IS_IRONLAKE_M(dev)	((dev)-&gt;pci_device == 0x0046)</span>
<span class="cp">#define IS_IVYBRIDGE(dev)	(INTEL_INFO(dev)-&gt;is_ivybridge)</span>
<span class="cp">#define IS_VALLEYVIEW(dev)	(INTEL_INFO(dev)-&gt;is_valleyview)</span>
<span class="cp">#define IS_HASWELL(dev)	(INTEL_INFO(dev)-&gt;is_haswell)</span>
<span class="cp">#define IS_MOBILE(dev)		(INTEL_INFO(dev)-&gt;is_mobile)</span>

<span class="cm">/*</span>
<span class="cm"> * The genX designation typically refers to the render engine, so render</span>
<span class="cm"> * capability related checks should use IS_GEN, while display and other checks</span>
<span class="cm"> * have their own (e.g. HAS_PCH_SPLIT for ILK+ display, IS_foo for particular</span>
<span class="cm"> * chips, etc.).</span>
<span class="cm"> */</span>
<span class="cp">#define IS_GEN2(dev)	(INTEL_INFO(dev)-&gt;gen == 2)</span>
<span class="cp">#define IS_GEN3(dev)	(INTEL_INFO(dev)-&gt;gen == 3)</span>
<span class="cp">#define IS_GEN4(dev)	(INTEL_INFO(dev)-&gt;gen == 4)</span>
<span class="cp">#define IS_GEN5(dev)	(INTEL_INFO(dev)-&gt;gen == 5)</span>
<span class="cp">#define IS_GEN6(dev)	(INTEL_INFO(dev)-&gt;gen == 6)</span>
<span class="cp">#define IS_GEN7(dev)	(INTEL_INFO(dev)-&gt;gen == 7)</span>

<span class="cp">#define HAS_BSD(dev)            (INTEL_INFO(dev)-&gt;has_bsd_ring)</span>
<span class="cp">#define HAS_BLT(dev)            (INTEL_INFO(dev)-&gt;has_blt_ring)</span>
<span class="cp">#define HAS_LLC(dev)            (INTEL_INFO(dev)-&gt;has_llc)</span>
<span class="cp">#define I915_NEED_GFX_HWS(dev)	(INTEL_INFO(dev)-&gt;need_gfx_hws)</span>

<span class="cp">#define HAS_ALIASING_PPGTT(dev)	(INTEL_INFO(dev)-&gt;gen &gt;=6)</span>

<span class="cp">#define HAS_OVERLAY(dev)		(INTEL_INFO(dev)-&gt;has_overlay)</span>
<span class="cp">#define OVERLAY_NEEDS_PHYSICAL(dev)	(INTEL_INFO(dev)-&gt;overlay_needs_physical)</span>

<span class="cm">/* With the 945 and later, Y tiling got adjusted so that it was 32 128-byte</span>
<span class="cm"> * rows, which changed the alignment requirements and fence programming.</span>
<span class="cm"> */</span>
<span class="cp">#define HAS_128_BYTE_Y_TILING(dev) (!IS_GEN2(dev) &amp;&amp; !(IS_I915G(dev) || \</span>
<span class="cp">						      IS_I915GM(dev)))</span>
<span class="cp">#define SUPPORTS_DIGITAL_OUTPUTS(dev)	(!IS_GEN2(dev) &amp;&amp; !IS_PINEVIEW(dev))</span>
<span class="cp">#define SUPPORTS_INTEGRATED_HDMI(dev)	(IS_G4X(dev) || IS_GEN5(dev))</span>
<span class="cp">#define SUPPORTS_INTEGRATED_DP(dev)	(IS_G4X(dev) || IS_GEN5(dev))</span>
<span class="cp">#define SUPPORTS_EDP(dev)		(IS_IRONLAKE_M(dev))</span>
<span class="cp">#define SUPPORTS_TV(dev)		(INTEL_INFO(dev)-&gt;supports_tv)</span>
<span class="cp">#define I915_HAS_HOTPLUG(dev)		 (INTEL_INFO(dev)-&gt;has_hotplug)</span>
<span class="cm">/* dsparb controlled by hw only */</span>
<span class="cp">#define DSPARB_HWCONTROL(dev) (IS_G4X(dev) || IS_IRONLAKE(dev))</span>

<span class="cp">#define HAS_FW_BLC(dev) (INTEL_INFO(dev)-&gt;gen &gt; 2)</span>
<span class="cp">#define HAS_PIPE_CXSR(dev) (INTEL_INFO(dev)-&gt;has_pipe_cxsr)</span>
<span class="cp">#define I915_HAS_FBC(dev) (INTEL_INFO(dev)-&gt;has_fbc)</span>

<span class="cp">#define HAS_PCH_SPLIT(dev) (INTEL_INFO(dev)-&gt;has_pch_split)</span>
<span class="cp">#define HAS_PIPE_CONTROL(dev) (INTEL_INFO(dev)-&gt;gen &gt;= 5)</span>

<span class="cp">#define INTEL_PCH_TYPE(dev) (((struct drm_i915_private *)(dev)-&gt;dev_private)-&gt;pch_type)</span>
<span class="cp">#define HAS_PCH_LPT(dev) (INTEL_PCH_TYPE(dev) == PCH_LPT)</span>
<span class="cp">#define HAS_PCH_CPT(dev) (INTEL_PCH_TYPE(dev) == PCH_CPT)</span>
<span class="cp">#define HAS_PCH_IBX(dev) (INTEL_PCH_TYPE(dev) == PCH_IBX)</span>

<span class="cp">#define HAS_FORCE_WAKE(dev) (INTEL_INFO(dev)-&gt;has_force_wake)</span>

<span class="cp">#include &quot;i915_trace.h&quot;</span>

<span class="cm">/**</span>
<span class="cm"> * RC6 is a special power stage which allows the GPU to enter an very</span>
<span class="cm"> * low-voltage mode when idle, using down to 0V while at this stage.  This</span>
<span class="cm"> * stage is entered automatically when the GPU is idle when RC6 support is</span>
<span class="cm"> * enabled, and as soon as new workload arises GPU wakes up automatically as well.</span>
<span class="cm"> *</span>
<span class="cm"> * There are different RC6 modes available in Intel GPU, which differentiate</span>
<span class="cm"> * among each other with the latency required to enter and leave RC6 and</span>
<span class="cm"> * voltage consumed by the GPU in different states.</span>
<span class="cm"> *</span>
<span class="cm"> * The combination of the following flags define which states GPU is allowed</span>
<span class="cm"> * to enter, while RC6 is the normal RC6 state, RC6p is the deep RC6, and</span>
<span class="cm"> * RC6pp is deepest RC6. Their support by hardware varies according to the</span>
<span class="cm"> * GPU, BIOS, chipset and platform. RC6 is usually the safest one and the one</span>
<span class="cm"> * which brings the most power savings; deeper states save more power, but</span>
<span class="cm"> * require higher latency to switch to and wake up.</span>
<span class="cm"> */</span>
<span class="cp">#define INTEL_RC6_ENABLE			(1&lt;&lt;0)</span>
<span class="cp">#define INTEL_RC6p_ENABLE			(1&lt;&lt;1)</span>
<span class="cp">#define INTEL_RC6pp_ENABLE			(1&lt;&lt;2)</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">drm_ioctl_desc</span> <span class="n">i915_ioctls</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_max_ioctl</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i915_fbpercrtc</span> <span class="n">__always_unused</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_panel_ignore_lid</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i915_powersave</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_semaphores</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i915_lvds_downclock</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_lvds_channel_mode</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_panel_use_ssc</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_vbt_sdvo_panel_type</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_enable_rc6</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_enable_fbc</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">i915_enable_hangcheck</span> <span class="n">__read_mostly</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_enable_ppgtt</span> <span class="n">__read_mostly</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_master_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_master</span> <span class="o">*</span><span class="n">master</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_master_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_master</span> <span class="o">*</span><span class="n">master</span><span class="p">);</span>

				<span class="cm">/* i915_dma.c */</span>
<span class="kt">void</span> <span class="n">i915_update_dri1_breadcrumb</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_kernel_lost_context</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_driver_load</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_driver_unload</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_driver_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_driver_lastclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_driver_preclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_driver_postclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_driver_device_is_agp</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_COMPAT</span>
<span class="k">extern</span> <span class="kt">long</span> <span class="n">i915_compat_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">filp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_emit_box</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_clip_rect</span> <span class="o">*</span><span class="n">box</span><span class="p">,</span>
			 <span class="kt">int</span> <span class="n">DR1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">DR4</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i915_chipset_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i915_mch_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i915_gfx_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_update_gfx_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>


<span class="cm">/* i915_irq.c */</span>
<span class="kt">void</span> <span class="n">i915_hangcheck_elapsed</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_handle_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">wedged</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_irq_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">i915_error_state_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">kref</span> <span class="o">*</span><span class="n">error_ref</span><span class="p">);</span>

<span class="kt">void</span>
<span class="n">i915_enable_pipestat</span><span class="p">(</span><span class="n">drm_i915_private_t</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="kt">void</span>
<span class="n">i915_disable_pipestat</span><span class="p">(</span><span class="n">drm_i915_private_t</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">intel_enable_asle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_DEBUG_FS</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i915_destroy_error_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define i915_destroy_error_state(x)</span>
<span class="cp">#endif</span>


<span class="cm">/* i915_gem.c */</span>
<span class="kt">int</span> <span class="n">i915_gem_init_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_create_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_pread_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_pwrite_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_mmap_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_mmap_gtt_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_set_domain_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_sw_finish_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_execbuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_execbuffer2</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_pin_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_unpin_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_busy_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_throttle_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_madvise_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_entervt_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_leavevt_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_set_tiling</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_get_tiling</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_get_aperture_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_load</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_init_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_flush_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
				     <span class="kt">uint32_t</span> <span class="n">invalidate_domains</span><span class="p">,</span>
				     <span class="kt">uint32_t</span> <span class="n">flush_domains</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">i915_gem_alloc_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
						  <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_free_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_pin</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				     <span class="kt">uint32_t</span> <span class="n">alignment</span><span class="p">,</span>
				     <span class="n">bool</span> <span class="n">map_and_fenceable</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_object_unpin</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_unbind</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_release_mmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_lastclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i915_gem_object_get_pages_gtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				  <span class="n">gfp_t</span> <span class="n">gfpmask</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_mutex_lock_interruptible</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_wait_rendering</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_object_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">to</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_object_move_to_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
				    <span class="n">u32</span> <span class="n">seqno</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i915_gem_dumb_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">drm_mode_create_dumb</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_mmap_gtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		      <span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_dumb_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			  <span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * Returns true if seq1 is later than seq2.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span>
<span class="nf">i915_seqno_passed</span><span class="p">(</span><span class="kt">uint32_t</span> <span class="n">seq1</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">seq2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">int32_t</span><span class="p">)(</span><span class="n">seq1</span> <span class="o">-</span> <span class="n">seq2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u32</span> <span class="n">i915_gem_next_request_seqno</span><span class="p">(</span><span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_get_fence</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_put_fence</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span>
<span class="nf">i915_gem_object_pin_fence</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">fence_reg</span> <span class="o">!=</span> <span class="n">I915_FENCE_REG_NONE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">.</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
		<span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">fence_regs</span><span class="p">[</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">fence_reg</span><span class="p">].</span><span class="n">pin_count</span><span class="o">++</span><span class="p">;</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">i915_gem_object_unpin_fence</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">fence_reg</span> <span class="o">!=</span> <span class="n">I915_FENCE_REG_NONE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">obj</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">.</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
		<span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">fence_regs</span><span class="p">[</span><span class="n">obj</span><span class="o">-&gt;</span><span class="n">fence_reg</span><span class="p">].</span><span class="n">pin_count</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">i915_gem_retire_requests</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_retire_requests_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">i915_gem_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_clflush_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_set_domain</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
					    <span class="kt">uint32_t</span> <span class="n">read_domains</span><span class="p">,</span>
					    <span class="kt">uint32_t</span> <span class="n">write_domain</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_object_finish_gpu</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_init_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_init_swizzling</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_init_ppgtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_cleanup_ringbuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gpu_idle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_idle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_add_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">drm_i915_gem_request</span> <span class="o">*</span><span class="n">request</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_wait_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
				   <span class="kt">uint32_t</span> <span class="n">seqno</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_fault</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_fault</span> <span class="o">*</span><span class="n">vmf</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span>
<span class="n">i915_gem_object_set_to_gtt_domain</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				  <span class="n">bool</span> <span class="n">write</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span>
<span class="n">i915_gem_object_set_to_cpu_domain</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">bool</span> <span class="n">write</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span>
<span class="n">i915_gem_object_pin_to_display_plane</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="n">alignment</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">intel_ring_buffer</span> <span class="o">*</span><span class="n">pipelined</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_attach_phys_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				<span class="kt">int</span> <span class="n">id</span><span class="p">,</span>
				<span class="kt">int</span> <span class="n">align</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_detach_phys_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_free_all_phys_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>

<span class="kt">uint32_t</span>
<span class="n">i915_gem_get_unfenced_gtt_alignment</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				    <span class="kt">uint32_t</span> <span class="n">size</span><span class="p">,</span>
				    <span class="kt">int</span> <span class="n">tiling_mode</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i915_gem_object_set_cache_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				    <span class="k">enum</span> <span class="n">i915_cache_level</span> <span class="n">cache_level</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">i915_gem_prime_import</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">dma_buf</span> <span class="o">*</span><span class="n">dma_buf</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">dma_buf</span> <span class="o">*</span><span class="n">i915_gem_prime_export</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">drm_gem_object</span> <span class="o">*</span><span class="n">gem_obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>


<span class="cm">/* i915_gem_gtt.c */</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_init_aliasing_ppgtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_cleanup_aliasing_ppgtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_ppgtt_bind_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">i915_hw_ppgtt</span> <span class="o">*</span><span class="n">ppgtt</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
			    <span class="k">enum</span> <span class="n">i915_cache_level</span> <span class="n">cache_level</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_ppgtt_unbind_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">i915_hw_ppgtt</span> <span class="o">*</span><span class="n">ppgtt</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">i915_gem_restore_gtt_mappings</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_gtt_prepare_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_gtt_bind_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">i915_cache_level</span> <span class="n">cache_level</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_gtt_unbind_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_gtt_finish_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_init_global_gtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mappable_end</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">end</span><span class="p">);</span>

<span class="cm">/* i915_gem_evict.c */</span>
<span class="kt">int</span> <span class="n">__must_check</span> <span class="n">i915_gem_evict_something</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">min_size</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mappable</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i915_gem_evict_everything</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">purgeable_only</span><span class="p">);</span>

<span class="cm">/* i915_gem_stolen.c */</span>
<span class="kt">int</span> <span class="n">i915_gem_init_stolen</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_cleanup_stolen</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* i915_gem_tiling.c */</span>
<span class="kt">void</span> <span class="n">i915_gem_detect_bit_6_swizzle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_object_do_bit_17_swizzle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_object_save_bit_17_swizzle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>

<span class="cm">/* i915_gem_debug.c */</span>
<span class="kt">void</span> <span class="n">i915_gem_dump_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span>
			  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">where</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">mark</span><span class="p">);</span>
<span class="cp">#if WATCH_LISTS</span>
<span class="kt">int</span> <span class="n">i915_verify_lists</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define i915_verify_lists(dev) 0</span>
<span class="cp">#endif</span>
<span class="kt">void</span> <span class="n">i915_gem_object_check_coherency</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
				     <span class="kt">int</span> <span class="n">handle</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_gem_dump_object</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_gem_object</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span>
			  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">where</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">mark</span><span class="p">);</span>

<span class="cm">/* i915_debugfs.c */</span>
<span class="kt">int</span> <span class="n">i915_debugfs_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_minor</span> <span class="o">*</span><span class="n">minor</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_debugfs_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_minor</span> <span class="o">*</span><span class="n">minor</span><span class="p">);</span>

<span class="cm">/* i915_suspend.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_save_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_restore_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* i915_suspend.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_save_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i915_restore_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* i915_sysfs.c */</span>
<span class="kt">void</span> <span class="n">i915_setup_sysfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">i915_teardown_sysfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/* intel_i2c.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">intel_setup_gmbus</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_teardown_gmbus</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">intel_gmbus_is_port_valid</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">port</span> <span class="o">&gt;=</span> <span class="n">GMBUS_PORT_SSC</span> <span class="o">&amp;&amp;</span> <span class="n">port</span> <span class="o">&lt;=</span> <span class="n">GMBUS_PORT_DPD</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">intel_gmbus_get_adapter</span><span class="p">(</span>
		<span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_gmbus_set_speed</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">speed</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_gmbus_force_bit</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">bool</span> <span class="n">force_bit</span><span class="p">);</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">intel_gmbus_is_forced_bit</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="k">struct</span> <span class="n">intel_gmbus</span><span class="p">,</span> <span class="n">adapter</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">force_bit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_i2c_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* intel_opregion.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">intel_opregion_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_ACPI</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_opregion_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_opregion_fini</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_opregion_asle_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_opregion_gse_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_opregion_enable_asle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_opregion_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_opregion_fini</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_opregion_asle_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_opregion_gse_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_opregion_enable_asle</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* intel_acpi.c */</span>
<span class="cp">#ifdef CONFIG_ACPI</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_register_dsm_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_unregister_dsm_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_register_dsm_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intel_unregister_dsm_handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_ACPI */</span><span class="cp"></span>

<span class="cm">/* modesetting */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_modeset_init_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_modeset_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_modeset_gem_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_modeset_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">intel_modeset_vga_set_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">state</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">intel_fbc_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_disable_fbc</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">bool</span> <span class="n">ironlake_set_drps</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ironlake_init_pch_refclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ironlake_enable_rc6</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">gen6_set_rps</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_detect_pch</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">intel_trans_dp_port_sel</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_crtc</span> <span class="o">*</span><span class="n">crtc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">intel_enable_rc6</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">bool</span> <span class="n">i915_semaphore_is_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__gen6_gt_force_wake_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__gen6_gt_force_wake_mt_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__gen6_gt_force_wake_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__gen6_gt_force_wake_mt_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">vlv_force_wake_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">vlv_force_wake_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cm">/* overlay */</span>
<span class="cp">#ifdef CONFIG_DEBUG_FS</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">intel_overlay_error_state</span> <span class="o">*</span><span class="n">intel_overlay_capture_error_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_overlay_print_error_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="k">struct</span> <span class="n">intel_overlay_error_state</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">intel_display_error_state</span> <span class="o">*</span><span class="n">intel_display_capture_error_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">intel_display_print_error_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">intel_display_error_state</span> <span class="o">*</span><span class="n">error</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/* On SNB platform, before reading ring registers forcewake bit</span>
<span class="cm"> * must be set to prevent GT core from power down and stale values being</span>
<span class="cm"> * returned.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">gen6_gt_force_wake_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">gen6_gt_force_wake_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__gen6_gt_wait_for_fifo</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_i915_private</span> <span class="o">*</span><span class="n">dev_priv</span><span class="p">);</span>

<span class="cp">#define __i915_read(x, y) \</span>
<span class="cp">	u##x i915_read##x(struct drm_i915_private *dev_priv, u32 reg);</span>

<span class="n">__i915_read</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__i915_read</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="n">__i915_read</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<span class="n">__i915_read</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="cp">#undef __i915_read</span>

<span class="cp">#define __i915_write(x, y) \</span>
<span class="cp">	void i915_write##x(struct drm_i915_private *dev_priv, u32 reg, u##x val);</span>

<span class="n">__i915_write</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">__i915_write</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
<span class="n">__i915_write</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
<span class="n">__i915_write</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
<span class="cp">#undef __i915_write</span>

<span class="cp">#define I915_READ8(reg)		i915_read8(dev_priv, (reg))</span>
<span class="cp">#define I915_WRITE8(reg, val)	i915_write8(dev_priv, (reg), (val))</span>

<span class="cp">#define I915_READ16(reg)	i915_read16(dev_priv, (reg))</span>
<span class="cp">#define I915_WRITE16(reg, val)	i915_write16(dev_priv, (reg), (val))</span>
<span class="cp">#define I915_READ16_NOTRACE(reg)	readw(dev_priv-&gt;regs + (reg))</span>
<span class="cp">#define I915_WRITE16_NOTRACE(reg, val)	writew(val, dev_priv-&gt;regs + (reg))</span>

<span class="cp">#define I915_READ(reg)		i915_read32(dev_priv, (reg))</span>
<span class="cp">#define I915_WRITE(reg, val)	i915_write32(dev_priv, (reg), (val))</span>
<span class="cp">#define I915_READ_NOTRACE(reg)		readl(dev_priv-&gt;regs + (reg))</span>
<span class="cp">#define I915_WRITE_NOTRACE(reg, val)	writel(val, dev_priv-&gt;regs + (reg))</span>

<span class="cp">#define I915_WRITE64(reg, val)	i915_write64(dev_priv, (reg), (val))</span>
<span class="cp">#define I915_READ64(reg)	i915_read64(dev_priv, (reg))</span>

<span class="cp">#define POSTING_READ(reg)	(void)I915_READ_NOTRACE(reg)</span>
<span class="cp">#define POSTING_READ16(reg)	(void)I915_READ16_NOTRACE(reg)</span>


<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
