f | via_mm.c | s | 6.3K | 194 | Daniel Vetter | daniel.vetter@ffwll.ch | 1326111099 |  | drm/sis||via: don't return stack garbage from free_mem ioctl  Fallout from my "kill drm_sman" refactor. Unfortunately gcc seems to have failed me and not warned about this.  Tested-by: Jakob Bornecrantz <wallbraker@gmail.com> (on via) Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_dmablit.c | s | 21K | 646 | Joe Perches | joe@perches.com | 1289274095 |  | drivers/gpu: Use vzalloc  Signed-off-by: Joe Perches <joe@perches.com> Reviewed-by: Thomas Hellstrom <thellstrom@vmware.com> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_video.c | s | 2.7K | 80 | Nicolas Kaiser | nikai@nikai.net | 1280708243 |  | drm/via: fixed coding style issues, simplified return  Fixed brace, macro and spacing coding style issues. Simplified  -if (ret) return ret;  -return 0;  +return ret;  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | Makefile | g | 308B |  | Dave Airlie | airlied@redhat.com | 1215996301 |  | drm: reorganise drm tree to be more future proof.  With the coming of kernel based modesetting and the memory manager stuff, the everything in one directory approach was getting very ugly and starting to be unmanageable.  This restructures the drm along the lines of other kernel components.  It creates a drivers/gpu/drm directory and moves the hw drivers into subdirectores. It moves the includes into an include/drm, and sets up the unifdef for the userspace headers we should be exporting.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_map.c | s | 3.3K | 103 | Márton Németh | nm127@freemail.hu | 1339841918 |  | drm via: initialize object_idr  The field obejct_idr of struct drm_via_private was introduced with the commit http://git.kernel.org/?p=linux/kernel/git/torvalds/linux.git;a=commitdiff;h=77ee8f3825054f23b17e9c8f728f061defd86cdc . In that patch idr_init(&dev->object_name_idr) was called instead of idr_init(&dev_priv->object_idr) by mistake, leaving the dev_priv->object_idr uninitialized. To be more exact, the object_idr buffer is filled with zeros because of kzalloc(), but the dev_priv->object_idr.lock spinlock can cause system freeze at lib/idr.c:move_to_free_list() when spin_lock_irqsave() is called on this spinlock.  The patch was tested on Clevo D4J, model D410J laptop, on the following hardware, without AGP kernel module loaded:    # lspci -s 01:00.0 -n   01:00.0 0300: 1106:3108 (rev 01)   # lspci -s 01:00.0 -v   01:00.0 VGA compatible controller: VIA Technologies, Inc. K8M800/K8N800/K8N800A [S3 UniChrome Pro] (rev 01) (prog-if 00 [VGA controller])           Subsystem: CLEVO/KAPOK Computer Device 4702           Flags: bus master, 66MHz, medium devsel, latency 64, IRQ 16           Memory at f0000000 (32-bit, prefetchable) [size=64M]           Memory at d1000000 (32-bit, non-prefetchable) [size=16M]           Expansion ROM at <unassigned> [disabled]           Capabilities: [60] Power Management version 2           Capabilities: [70] AGP version 3.0  Signed-off-by: Márton Németh <nm127@freemail.hu> Reviewed-by: Daniel Vetter <daniel.vetter@ffwll.ch> Cc: stable@vger.kernel.org Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_dmablit.h | s | 5.3K | 119 | Nicolas Kaiser | nikai@nikai.net | 1280708243 |  | drm/via: fixed coding style issues, simplified return  Fixed brace, macro and spacing coding style issues. Simplified  -if (ret) return ret;  -return 0;  +return ret;  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_verifier.c | s | 27K | 1037 | Nicolas Kaiser | nikai@nikai.net | 1280708243 |  | drm/via: fixed coding style issues, simplified return  Fixed brace, macro and spacing coding style issues. Simplified  -if (ret) return ret;  -return 0;  +return ret;  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_3d_reg.h | s | 66K | 1620 | Dave Airlie | airlied@redhat.com | 1215996301 |  | drm: reorganise drm tree to be more future proof.  With the coming of kernel based modesetting and the memory manager stuff, the everything in one directory approach was getting very ugly and starting to be unmanageable.  This restructures the drm along the lines of other kernel components.  It creates a drivers/gpu/drm directory and moves the hw drivers into subdirectores. It moves the includes into an include/drm, and sets up the unifdef for the userspace headers we should be exporting.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_drv.h | s | 5.8K | 137 | Daniel Vetter | daniel.vetter@ffwll.ch | 1324510402 |  | drm/via: use drm_mm instead of drm_sman  To make the transition in a piece-wise and bisectable way possible, I've hijacked the ->owner_list from drm_sman. While transitioning, the list_add was done by the driver, while the list_del was still done by the dying sman code.  Now that we are in full control of ->owner_list, do the list_del ourselves.  v2: Better explain the list_del trickery as suggested by Chris Wilson.  Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
f | via_drv.c | s | 3.5K | 106 | Daniel Vetter | daniel.vetter@ffwll.ch | 1324510399 |  | drm/via: track obj->drm_fd relations in the driver  Exactly like the previous patch for sis.  Signed-off-by: Daniel Vetter <daniel.vetter@ffwll.ch>
f | via_dma.c | s | 20K | 611 | Dave Airlie | airlied@redhat.com | 1282020745 |  | drm: block userspace under allocating buffer and having drivers overwrite it (v2)  With the current screwed but its ABI, ioctls for the drm, Linus pointed out that we could allow userspace to specify the allocation size, but we pass it to the driver which then uses it blindly to store a struct. Now if userspace specifies the allocation size as smaller than the driver needs, the driver can possibly overwrite memory.  This patch restructures the driver ioctls so we store the structure size we are expecting, and make sure we allocate at least that size. The copy from/to userspace are still restricted to the size the user specifies, this allows ioctl structs to grow on both sides of the equation.  Up until now we didn't really use the DRM_IOCTL defines in the kernel, so this cleans them up and adds them for nouveau.  v2: fix nouveau pushbuf arg (thanks to Ben for pointing it out)  Reported-by: Linus Torvalds <torvalds@linuxfoundation.org> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_irq.c | s | 10K | 327 | Nicolas Kaiser | nikai@nikai.net | 1280708243 |  | drm/via: fixed coding style issues, simplified return  Fixed brace, macro and spacing coding style issues. Simplified  -if (ret) return ret;  -return 0;  +return ret;  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
f | via_verifier.h | s | 2.0K | 57 | Nicolas Kaiser | nikai@nikai.net | 1280708243 |  | drm/via: fixed coding style issues, simplified return  Fixed brace, macro and spacing coding style issues. Simplified  -if (ret) return ret;  -return 0;  +return ret;  Signed-off-by: Nicolas Kaiser <nikai@nikai.net> Signed-off-by: Dave Airlie <airlied@redhat.com>
