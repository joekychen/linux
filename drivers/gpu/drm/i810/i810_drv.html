<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › i810 › i810_drv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>i810_drv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* i810_drv.h -- Private header for the Matrox g200/g400 driver -*- linux-c -*-</span>
<span class="cm"> * Created: Mon Dec 13 01:50:01 1999 by jhartmann@precisioninsight.com</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1999 Precision Insight, Inc., Cedar Park, Texas.</span>
<span class="cm"> * Copyright 2000 VA Linux Systems, Inc., Sunnyvale, California.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the next</span>
<span class="cm"> * paragraph) shall be included in all copies or substantial portions of the</span>
<span class="cm"> * Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</span>
<span class="cm"> * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR</span>
<span class="cm"> * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span>
<span class="cm"> * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> * Authors: Rickard E. (Rik) Faith &lt;faith@valinux.com&gt;</span>
<span class="cm"> *	    Jeff Hartmann &lt;jhartmann@valinux.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _I810_DRV_H_</span>
<span class="cp">#define _I810_DRV_H_</span>

<span class="cm">/* General customization:</span>
<span class="cm"> */</span>

<span class="cp">#define DRIVER_AUTHOR		&quot;VA Linux Systems Inc.&quot;</span>

<span class="cp">#define DRIVER_NAME		&quot;i810&quot;</span>
<span class="cp">#define DRIVER_DESC		&quot;Intel i810&quot;</span>
<span class="cp">#define DRIVER_DATE		&quot;20030605&quot;</span>

<span class="cm">/* Interface history</span>
<span class="cm"> *</span>
<span class="cm"> * 1.1   - XFree86 4.1</span>
<span class="cm"> * 1.2   - XvMC interfaces</span>
<span class="cm"> *       - XFree86 4.2</span>
<span class="cm"> * 1.2.1 - Disable copying code (leave stub ioctls for backwards compatibility)</span>
<span class="cm"> *       - Remove requirement for interrupt (leave stubs again)</span>
<span class="cm"> * 1.3   - Add page flipping.</span>
<span class="cm"> * 1.4   - fix DRM interface</span>
<span class="cm"> */</span>
<span class="cp">#define DRIVER_MAJOR		1</span>
<span class="cp">#define DRIVER_MINOR		4</span>
<span class="cp">#define DRIVER_PATCHLEVEL	0</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_i810_buf_priv</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">in_use</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">my_use_idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">currently_mapped</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="k">virtual</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">kernel_virtual</span><span class="p">;</span>
	<span class="n">drm_local_map_t</span> <span class="n">map</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_i810_buf_priv_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_drm_i810_ring_buffer</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">tail_mask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Start</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">End</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">Size</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">virtual_start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">head</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tail</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">space</span><span class="p">;</span>
	<span class="n">drm_local_map_t</span> <span class="n">map</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_i810_ring_buffer_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_i810_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_local_map</span> <span class="o">*</span><span class="n">sarea_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_local_map</span> <span class="o">*</span><span class="n">mmio_map</span><span class="p">;</span>

	<span class="n">drm_i810_sarea_t</span> <span class="o">*</span><span class="n">sarea_priv</span><span class="p">;</span>
	<span class="n">drm_i810_ring_buffer_t</span> <span class="n">ring</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">hw_status_page</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">counter</span><span class="p">;</span>

	<span class="n">dma_addr_t</span> <span class="n">dma_status_page</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_buf</span> <span class="o">*</span><span class="n">mmap_buffer</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">front_di1</span><span class="p">,</span> <span class="n">back_di1</span><span class="p">,</span> <span class="n">zi1</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">back_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">depth_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">overlay_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">overlay_physical</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pitch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">back_pitch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">depth_pitch</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">do_boxes</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dma_used</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">current_page</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">page_flipping</span><span class="p">;</span>

	<span class="n">wait_queue_head_t</span> <span class="n">irq_queue</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">irq_received</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">irq_emitted</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">front_offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_i810_private_t</span><span class="p">;</span>

				<span class="cm">/* i810_dma.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i810_driver_dma_quiescent</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i810_driver_reclaim_buffers_locked</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i810_driver_load</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i810_driver_lastclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i810_driver_preclose</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i810_driver_reclaim_buffers_locked</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">drm_file</span> <span class="o">*</span><span class="n">file_priv</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i810_driver_device_is_agp</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">long</span> <span class="n">i810_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">drm_ioctl_desc</span> <span class="n">i810_ioctls</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i810_max_ioctl</span><span class="p">;</span>

<span class="cp">#define I810_BASE(reg)		((unsigned long) \</span>
<span class="cp">				dev_priv-&gt;mmio_map-&gt;handle)</span>
<span class="cp">#define I810_ADDR(reg)		(I810_BASE(reg) + reg)</span>
<span class="cp">#define I810_DEREF(reg)		(*(__volatile__ int *)I810_ADDR(reg))</span>
<span class="cp">#define I810_READ(reg)		I810_DEREF(reg)</span>
<span class="cp">#define I810_WRITE(reg, val)	do { I810_DEREF(reg) = val; } while (0)</span>
<span class="cp">#define I810_DEREF16(reg)	(*(__volatile__ u16 *)I810_ADDR(reg))</span>
<span class="cp">#define I810_READ16(reg)	I810_DEREF16(reg)</span>
<span class="cp">#define I810_WRITE16(reg, val)	do { I810_DEREF16(reg) = val; } while (0)</span>

<span class="cp">#define I810_VERBOSE 0</span>
<span class="cp">#define RING_LOCALS	unsigned int outring, ringmask; \</span>
<span class="cp">			volatile char *virt;</span>

<span class="cp">#define BEGIN_LP_RING(n) do {					\</span>
<span class="cp">	if (I810_VERBOSE)					\</span>
<span class="cp">		DRM_DEBUG(&quot;BEGIN_LP_RING(%d)\n&quot;, n);		\</span>
<span class="cp">	if (dev_priv-&gt;ring.space &lt; n*4)				\</span>
<span class="cp">		i810_wait_ring(dev, n*4);			\</span>
<span class="cp">	dev_priv-&gt;ring.space -= n*4;				\</span>
<span class="cp">	outring = dev_priv-&gt;ring.tail;				\</span>
<span class="cp">	ringmask = dev_priv-&gt;ring.tail_mask;			\</span>
<span class="cp">	virt = dev_priv-&gt;ring.virtual_start;			\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define ADVANCE_LP_RING() do {					\</span>
<span class="cp">	if (I810_VERBOSE)					\</span>
<span class="cp">		DRM_DEBUG(&quot;ADVANCE_LP_RING\n&quot;);			\</span>
<span class="cp">	dev_priv-&gt;ring.tail = outring;				\</span>
<span class="cp">	I810_WRITE(LP_RING + RING_TAIL, outring);		\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define OUT_RING(n) do {					\</span>
<span class="cp">	if (I810_VERBOSE)					\</span>
<span class="cp">		DRM_DEBUG(&quot;   OUT_RING %x\n&quot;, (int)(n));	\</span>
<span class="cp">	*(volatile unsigned int *)(virt + outring) = n;		\</span>
<span class="cp">	outring += 4;						\</span>
<span class="cp">	outring &amp;= ringmask;					\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define GFX_OP_USER_INTERRUPT		((0&lt;&lt;29)|(2&lt;&lt;23))</span>
<span class="cp">#define GFX_OP_BREAKPOINT_INTERRUPT	((0&lt;&lt;29)|(1&lt;&lt;23))</span>
<span class="cp">#define CMD_REPORT_HEAD			(7&lt;&lt;23)</span>
<span class="cp">#define CMD_STORE_DWORD_IDX		((0x21&lt;&lt;23) | 0x1)</span>
<span class="cp">#define CMD_OP_BATCH_BUFFER  ((0x0&lt;&lt;29)|(0x30&lt;&lt;23)|0x1)</span>

<span class="cp">#define INST_PARSER_CLIENT   0x00000000</span>
<span class="cp">#define INST_OP_FLUSH        0x02000000</span>
<span class="cp">#define INST_FLUSH_MAP_CACHE 0x00000001</span>

<span class="cp">#define BB1_START_ADDR_MASK   (~0x7)</span>
<span class="cp">#define BB1_PROTECTED         (1&lt;&lt;0)</span>
<span class="cp">#define BB1_UNPROTECTED       (0&lt;&lt;0)</span>
<span class="cp">#define BB2_END_ADDR_MASK     (~0x7)</span>

<span class="cp">#define I810REG_HWSTAM		0x02098</span>
<span class="cp">#define I810REG_INT_IDENTITY_R	0x020a4</span>
<span class="cp">#define I810REG_INT_MASK_R	0x020a8</span>
<span class="cp">#define I810REG_INT_ENABLE_R	0x020a0</span>

<span class="cp">#define LP_RING			0x2030</span>
<span class="cp">#define HP_RING			0x2040</span>
<span class="cp">#define RING_TAIL		0x00</span>
<span class="cp">#define TAIL_ADDR		0x000FFFF8</span>
<span class="cp">#define RING_HEAD		0x04</span>
<span class="cp">#define HEAD_WRAP_COUNT		0xFFE00000</span>
<span class="cp">#define HEAD_WRAP_ONE		0x00200000</span>
<span class="cp">#define HEAD_ADDR		0x001FFFFC</span>
<span class="cp">#define RING_START		0x08</span>
<span class="cp">#define START_ADDR		0x00FFFFF8</span>
<span class="cp">#define RING_LEN		0x0C</span>
<span class="cp">#define RING_NR_PAGES		0x000FF000</span>
<span class="cp">#define RING_REPORT_MASK	0x00000006</span>
<span class="cp">#define RING_REPORT_64K		0x00000002</span>
<span class="cp">#define RING_REPORT_128K	0x00000004</span>
<span class="cp">#define RING_NO_REPORT		0x00000000</span>
<span class="cp">#define RING_VALID_MASK		0x00000001</span>
<span class="cp">#define RING_VALID		0x00000001</span>
<span class="cp">#define RING_INVALID		0x00000000</span>

<span class="cp">#define GFX_OP_SCISSOR         ((0x3&lt;&lt;29)|(0x1c&lt;&lt;24)|(0x10&lt;&lt;19))</span>
<span class="cp">#define SC_UPDATE_SCISSOR       (0x1&lt;&lt;1)</span>
<span class="cp">#define SC_ENABLE_MASK          (0x1&lt;&lt;0)</span>
<span class="cp">#define SC_ENABLE               (0x1&lt;&lt;0)</span>

<span class="cp">#define GFX_OP_SCISSOR_INFO    ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|(0x81&lt;&lt;16)|(0x1))</span>
<span class="cp">#define SCI_YMIN_MASK      (0xffff&lt;&lt;16)</span>
<span class="cp">#define SCI_XMIN_MASK      (0xffff&lt;&lt;0)</span>
<span class="cp">#define SCI_YMAX_MASK      (0xffff&lt;&lt;16)</span>
<span class="cp">#define SCI_XMAX_MASK      (0xffff&lt;&lt;0)</span>

<span class="cp">#define GFX_OP_COLOR_FACTOR      ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|(0x1&lt;&lt;16)|0x0)</span>
<span class="cp">#define GFX_OP_STIPPLE           ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|(0x83&lt;&lt;16))</span>
<span class="cp">#define GFX_OP_MAP_INFO          ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|0x2)</span>
<span class="cp">#define GFX_OP_DESTBUFFER_VARS   ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|(0x85&lt;&lt;16)|0x0)</span>
<span class="cp">#define GFX_OP_DRAWRECT_INFO     ((0x3&lt;&lt;29)|(0x1d&lt;&lt;24)|(0x80&lt;&lt;16)|(0x3))</span>
<span class="cp">#define GFX_OP_PRIMITIVE         ((0x3&lt;&lt;29)|(0x1f&lt;&lt;24))</span>

<span class="cp">#define CMD_OP_Z_BUFFER_INFO     ((0x0&lt;&lt;29)|(0x16&lt;&lt;23))</span>
<span class="cp">#define CMD_OP_DESTBUFFER_INFO   ((0x0&lt;&lt;29)|(0x15&lt;&lt;23))</span>
<span class="cp">#define CMD_OP_FRONTBUFFER_INFO  ((0x0&lt;&lt;29)|(0x14&lt;&lt;23))</span>
<span class="cp">#define CMD_OP_WAIT_FOR_EVENT    ((0x0&lt;&lt;29)|(0x03&lt;&lt;23))</span>

<span class="cp">#define BR00_BITBLT_CLIENT   0x40000000</span>
<span class="cp">#define BR00_OP_COLOR_BLT    0x10000000</span>
<span class="cp">#define BR00_OP_SRC_COPY_BLT 0x10C00000</span>
<span class="cp">#define BR13_SOLID_PATTERN   0x80000000</span>

<span class="cp">#define WAIT_FOR_PLANE_A_SCANLINES (1&lt;&lt;1)</span>
<span class="cp">#define WAIT_FOR_PLANE_A_FLIP      (1&lt;&lt;2)</span>
<span class="cp">#define WAIT_FOR_VBLANK (1&lt;&lt;3)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
