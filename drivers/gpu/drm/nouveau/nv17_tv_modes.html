<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › gpu › drm › nouveau › nv17_tv_modes.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>nv17_tv_modes.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2009 Francisco Jerez.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining</span>
<span class="cm"> * a copy of this software and associated documentation files (the</span>
<span class="cm"> * &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="cm"> * without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="cm"> * distribute, sublicense, and/or sell copies of the Software, and to</span>
<span class="cm"> * permit persons to whom the Software is furnished to do so, subject to</span>
<span class="cm"> * the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the</span>
<span class="cm"> * next paragraph) shall be included in all copies or substantial</span>
<span class="cm"> * portions of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span>
<span class="cm"> * IN NO EVENT SHALL THE COPYRIGHT OWNER(S) AND/OR ITS SUPPLIERS BE</span>
<span class="cm"> * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION</span>
<span class="cm"> * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="cm"> * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;drmP.h&quot;</span>
<span class="cp">#include &quot;drm_crtc_helper.h&quot;</span>
<span class="cp">#include &quot;nouveau_drv.h&quot;</span>
<span class="cp">#include &quot;nouveau_encoder.h&quot;</span>
<span class="cp">#include &quot;nouveau_crtc.h&quot;</span>
<span class="cp">#include &quot;nouveau_hw.h&quot;</span>
<span class="cp">#include &quot;nv17_tv.h&quot;</span>

<span class="kt">char</span> <span class="o">*</span><span class="n">nv17_tv_norm_names</span><span class="p">[</span><span class="n">NUM_TV_NORMS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">TV_NORM_PAL</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;PAL&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_PAL_M</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;PAL-M&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_PAL_N</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;PAL-N&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_PAL_NC</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;PAL-Nc&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_NTSC_M</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;NTSC-M&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_NTSC_J</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;NTSC-J&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD480I</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd480i&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD480P</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd480p&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD576I</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd576i&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD576P</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd576p&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD720P</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd720p&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">TV_NORM_HD1080I</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;hd1080i&quot;</span>
<span class="p">};</span>

<span class="cm">/* TV standard specific parameters */</span>

<span class="k">struct</span> <span class="n">nv17_tv_norm_params</span> <span class="n">nv17_tv_norms</span><span class="p">[</span><span class="n">NUM_TV_NORMS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">TV_NORM_PAL</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span>
					<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_PAL_M</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">59940</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span>
					<span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_PAL_N</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span>
					<span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span>
					<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_PAL_NC</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span>
					<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_NTSC_M</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">59940</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span>
					<span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_NTSC_J</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">59940</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span>
					<span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span>
					<span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_HD480I</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">59940</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span>
					<span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span>
					<span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_HD576I</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">TV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tv_enc_mode</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="p">{</span>
					<span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
					<span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span>
					<span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
					<span class="mh">0xd3</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					<span class="mh">0x0</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span>
					<span class="mh">0xbd</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>


	<span class="p">[</span><span class="n">TV_NORM_HD480P</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">CTV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">ctv_enc_mode</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;720x480&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">27000</span><span class="p">,</span>
						   <span class="mi">720</span><span class="p">,</span> <span class="mi">735</span><span class="p">,</span> <span class="mi">743</span><span class="p">,</span> <span class="mi">858</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">490</span><span class="p">,</span> <span class="mi">494</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span><span class="p">)</span> <span class="p">},</span>
				<span class="p">.</span><span class="n">ctv_regs</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x3540000</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x314</span><span class="p">,</span>
					      <span class="mh">0x354003a</span><span class="p">,</span> <span class="mh">0x40000</span><span class="p">,</span> <span class="mh">0x6f0344</span><span class="p">,</span> <span class="mh">0x18100000</span><span class="p">,</span>
					      <span class="mh">0x10160004</span><span class="p">,</span> <span class="mh">0x10060005</span><span class="p">,</span> <span class="mh">0x1006000c</span><span class="p">,</span> <span class="mh">0x10060020</span><span class="p">,</span>
					      <span class="mh">0x10060021</span><span class="p">,</span> <span class="mh">0x140e0022</span><span class="p">,</span> <span class="mh">0x10060202</span><span class="p">,</span> <span class="mh">0x1802020a</span><span class="p">,</span>
					      <span class="mh">0x1810020b</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span>
					      <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span>
					      <span class="mh">0x3ff0000</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x2e001e</span><span class="p">,</span> <span class="mh">0x258012c</span><span class="p">,</span>
					      <span class="mh">0xa0aa04ec</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x80960019</span><span class="p">,</span> <span class="mh">0x12c0300</span><span class="p">,</span>
					      <span class="mh">0x2019</span><span class="p">,</span> <span class="mh">0x600</span><span class="p">,</span> <span class="mh">0x32060019</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x400</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_HD576P</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">CTV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">ctv_enc_mode</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;720x576&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">27000</span><span class="p">,</span>
						   <span class="mi">720</span><span class="p">,</span> <span class="mi">730</span><span class="p">,</span> <span class="mi">738</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">581</span><span class="p">,</span> <span class="mi">585</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span><span class="p">)</span> <span class="p">},</span>
				<span class="p">.</span><span class="n">ctv_regs</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x3540000</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x314</span><span class="p">,</span>
					      <span class="mh">0x354003a</span><span class="p">,</span> <span class="mh">0x40000</span><span class="p">,</span> <span class="mh">0x6f0344</span><span class="p">,</span> <span class="mh">0x18100000</span><span class="p">,</span>
					      <span class="mh">0x10060001</span><span class="p">,</span> <span class="mh">0x10060009</span><span class="p">,</span> <span class="mh">0x10060026</span><span class="p">,</span> <span class="mh">0x10060027</span><span class="p">,</span>
					      <span class="mh">0x140e0028</span><span class="p">,</span> <span class="mh">0x10060268</span><span class="p">,</span> <span class="mh">0x1810026d</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span>
					      <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span>
					      <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x10000fff</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span>
					      <span class="mh">0x3ff0000</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x2e001e</span><span class="p">,</span> <span class="mh">0x258012c</span><span class="p">,</span>
					      <span class="mh">0xa0aa04ec</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x80960019</span><span class="p">,</span> <span class="mh">0x12c0300</span><span class="p">,</span>
					      <span class="mh">0x2019</span><span class="p">,</span> <span class="mh">0x600</span><span class="p">,</span> <span class="mh">0x32060019</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x400</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_HD720P</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">CTV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">ctv_enc_mode</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;1280x720&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">74250</span><span class="p">,</span>
						   <span class="mi">1280</span><span class="p">,</span> <span class="mi">1349</span><span class="p">,</span> <span class="mi">1357</span><span class="p">,</span> <span class="mi">1650</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">725</span><span class="p">,</span> <span class="mi">730</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span><span class="p">)</span> <span class="p">},</span>
				<span class="p">.</span><span class="n">ctv_regs</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1260394</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x622</span><span class="p">,</span>
					      <span class="mh">0x66b0021</span><span class="p">,</span> <span class="mh">0x6004a</span><span class="p">,</span> <span class="mh">0x1210626</span><span class="p">,</span> <span class="mh">0x8170000</span><span class="p">,</span>
					      <span class="mh">0x70004</span><span class="p">,</span> <span class="mh">0x70016</span><span class="p">,</span> <span class="mh">0x70017</span><span class="p">,</span> <span class="mh">0x40f0018</span><span class="p">,</span>
					      <span class="mh">0x702e8</span><span class="p">,</span> <span class="mh">0x81702ed</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span>
					      <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span>
					      <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0xfff</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					      <span class="mh">0x2e40001</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x2e001e</span><span class="p">,</span> <span class="mh">0x258012c</span><span class="p">,</span>
					      <span class="mh">0xa0aa04ec</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x810c0039</span><span class="p">,</span> <span class="mh">0x12c0300</span><span class="p">,</span>
					      <span class="mh">0xc0002039</span><span class="p">,</span> <span class="mh">0x600</span><span class="p">,</span> <span class="mh">0x32060039</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">},</span>

	<span class="p">[</span><span class="n">TV_NORM_HD1080I</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">CTV_ENC_MODE</span><span class="p">,</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">ctv_enc_mode</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;1920x1080&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">74250</span><span class="p">,</span>
						   <span class="mi">1920</span><span class="p">,</span> <span class="mi">1961</span><span class="p">,</span> <span class="mi">2049</span><span class="p">,</span> <span class="mi">2200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">1084</span><span class="p">,</span> <span class="mi">1088</span><span class="p">,</span> <span class="mi">1125</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span>
						   <span class="o">|</span> <span class="n">DRM_MODE_FLAG_INTERLACE</span><span class="p">)</span> <span class="p">},</span>
				<span class="p">.</span><span class="n">ctv_regs</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xac0420</span><span class="p">,</span> <span class="mh">0x44c0478</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="mh">0x4fc0868</span><span class="p">,</span>
					      <span class="mh">0x8940028</span><span class="p">,</span> <span class="mh">0x60054</span><span class="p">,</span> <span class="mh">0xe80870</span><span class="p">,</span> <span class="mh">0xbf70000</span><span class="p">,</span>
					      <span class="mh">0xbc70004</span><span class="p">,</span> <span class="mh">0x70005</span><span class="p">,</span> <span class="mh">0x70012</span><span class="p">,</span> <span class="mh">0x70013</span><span class="p">,</span>
					      <span class="mh">0x40f0014</span><span class="p">,</span> <span class="mh">0x70230</span><span class="p">,</span> <span class="mh">0xbf70232</span><span class="p">,</span> <span class="mh">0xbf70233</span><span class="p">,</span>
					      <span class="mh">0x1c70237</span><span class="p">,</span> <span class="mh">0x70238</span><span class="p">,</span> <span class="mh">0x70244</span><span class="p">,</span> <span class="mh">0x70245</span><span class="p">,</span>
					      <span class="mh">0x40f0246</span><span class="p">,</span> <span class="mh">0x70462</span><span class="p">,</span> <span class="mh">0x1f70464</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
					      <span class="mh">0x2e40001</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x2e001e</span><span class="p">,</span> <span class="mh">0x258012c</span><span class="p">,</span>
					      <span class="mh">0xa0aa04ec</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x815f004c</span><span class="p">,</span> <span class="mh">0x12c0300</span><span class="p">,</span>
					      <span class="mh">0xc000204c</span><span class="p">,</span> <span class="mh">0x600</span><span class="p">,</span> <span class="mh">0x3206004c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span>
				<span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The following is some guesswork on how the TV encoder flicker</span>
<span class="cm"> * filter/rescaler works:</span>
<span class="cm"> *</span>
<span class="cm"> * It seems to use some sort of resampling filter, it is controlled</span>
<span class="cm"> * through the registers at NV_PTV_HFILTER and NV_PTV_VFILTER, they</span>
<span class="cm"> * control the horizontal and vertical stage respectively, there is</span>
<span class="cm"> * also NV_PTV_HFILTER2 the blob fills identically to NV_PTV_HFILTER,</span>
<span class="cm"> * but they seem to do nothing. A rough guess might be that they could</span>
<span class="cm"> * be used to independently control the filtering of each interlaced</span>
<span class="cm"> * field, but I don&#39;t know how they are enabled. The whole filtering</span>
<span class="cm"> * process seems to be disabled with bits 26:27 of PTV_200, but we</span>
<span class="cm"> * aren&#39;t doing that.</span>
<span class="cm"> *</span>
<span class="cm"> * The layout of both register sets is the same:</span>
<span class="cm"> *</span>
<span class="cm"> * A: [BASE+0x18]...[BASE+0x0] [BASE+0x58]..[BASE+0x40]</span>
<span class="cm"> * B: [BASE+0x34]...[BASE+0x1c] [BASE+0x74]..[BASE+0x5c]</span>
<span class="cm"> *</span>
<span class="cm"> * Each coefficient is stored in bits [31],[15:9] in two&#39;s complement</span>
<span class="cm"> * format. They seem to be some kind of weights used in a low-pass</span>
<span class="cm"> * filter. Both A and B coefficients are applied to the 14 nearest</span>
<span class="cm"> * samples on each side (Listed from nearest to furthermost.  They</span>
<span class="cm"> * roughly cover 2 framebuffer pixels on each side).  They are</span>
<span class="cm"> * probably multiplied with some more hardwired weights before being</span>
<span class="cm"> * used: B-coefficients are applied the same on both sides,</span>
<span class="cm"> * A-coefficients are inverted before being applied to the opposite</span>
<span class="cm"> * side.</span>
<span class="cm"> *</span>
<span class="cm"> * After all the hassle, I got the following formula by empirical</span>
<span class="cm"> * means...</span>
<span class="cm"> */</span>

<span class="cp">#define calc_overscan(o) interpolate(0x100, 0xe1, 0xc1, o)</span>

<span class="cp">#define id1 (1LL &lt;&lt; 8)</span>
<span class="cp">#define id2 (1LL &lt;&lt; 16)</span>
<span class="cp">#define id3 (1LL &lt;&lt; 24)</span>
<span class="cp">#define id4 (1LL &lt;&lt; 32)</span>
<span class="cp">#define id5 (1LL &lt;&lt; 48)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">filter_params</span><span class="p">{</span>
	<span class="kt">int64_t</span> <span class="n">k1</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki2</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki3</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">kr</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">kir</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki2r</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki3r</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">kf</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">kif</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki2f</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki3f</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">krf</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">kirf</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki2rf</span><span class="p">;</span>
	<span class="kt">int64_t</span> <span class="n">ki3rf</span><span class="p">;</span>
<span class="p">}</span> <span class="n">fparams</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Horizontal filter parameters */</span>
	<span class="p">{</span>
		<span class="p">{</span><span class="mf">64.311690</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">39.516924</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">6.586143</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">0.000002</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">0.051285</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">26.168746</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.361449</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">9.308169</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">78.180965</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">13.030158</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000001</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">8.801540</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">46.572890</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">7.762145</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="o">-</span><span class="mf">44.565569</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">68.081246</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">39.812074</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.009316</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">29.832207</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">50.047322</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.380017</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">2.546422</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">104.605622</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">141.908641</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">74.322319</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">7.484316</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">37.081621</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">90.397510</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">42.784229</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.289952</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="o">-</span><span class="mf">56.793244</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">31.153584</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.192247</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000003</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">33.541131</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">34.149302</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">5.691537</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">0.000002</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">87.196610</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">88.995169</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">14.832456</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">0.000012</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="mf">17.288138</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">71.864786</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.977408</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000009</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="mf">51.787796</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">21.211771</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">18.993730</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">1.853310</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">41.470726</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">17.775823</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">13.057821</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.15823</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">154.235673</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">44.878641</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">40.656077</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.695595</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="mf">112.201065</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">39.992155</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">25.155714</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">2.113984</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
	<span class="p">},</span>

	<span class="cm">/* Vertical filter parameters */</span>
	<span class="p">{</span>
		<span class="p">{</span><span class="mf">67.601979</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">0.428319</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.071318</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000012</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">3.402339</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">0.000209</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000092</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">0.000010</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">9.180996</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">6.111270</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.024457</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">0.001043</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="mf">6.060315</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.017425</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">0.007830</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000869</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="mf">6.755647</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">5.841348</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">1.469734</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.149656</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">8.293120</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.192888</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.947652</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">0.094507</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">37.526655</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">10.257875</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.823275</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">1.081497</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">2.361928</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.059432</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">1.840671</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.168100</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="o">-</span><span class="mf">14.780391</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">16.042148</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">2.673692</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000000</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">39.541978</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">5.680053</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.946676</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">0.000000</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">152.994486</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">12.625439</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.119579</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">0.002708</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">38.125089</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.855880</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">0.155359</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.002245</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
		<span class="p">{</span><span class="o">-</span><span class="mf">27.476193</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.454976</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">1.286557</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span> <span class="mf">0.025346</span> <span class="o">*</span> <span class="n">id5</span><span class="p">,</span>
		 <span class="mf">20.687300</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="mf">3.014003</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.557786</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.01311</span> <span class="o">*</span> <span class="n">id4</span><span class="p">,</span>
		 <span class="mf">60.008737</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.738273</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="mf">5.408217</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.796798</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
		 <span class="o">-</span><span class="mf">17.296835</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">4.438577</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.809420</span> <span class="o">*</span> <span class="n">id1</span><span class="p">,</span> <span class="mf">0.385491</span> <span class="o">*</span> <span class="n">id1</span><span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tv_setup_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nv17_tv_encoder</span> <span class="o">*</span><span class="n">tv_enc</span> <span class="o">=</span> <span class="n">to_tv_enc</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">nv17_tv_norm_params</span> <span class="o">*</span><span class="n">tv_norm</span> <span class="o">=</span> <span class="n">get_tv_norm</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">mode</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">encoder</span><span class="o">-&gt;</span><span class="n">crtc</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">[])[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">&amp;</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">.</span><span class="n">hfilter</span><span class="p">,</span>
				       <span class="o">&amp;</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">.</span><span class="n">vfilter</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
	<span class="kt">int32_t</span> <span class="n">overscan</span> <span class="o">=</span> <span class="n">calc_overscan</span><span class="p">(</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">overscan</span><span class="p">);</span>
	<span class="kt">int64_t</span> <span class="n">flicker</span> <span class="o">=</span> <span class="p">(</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">flicker</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">id3</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>
	<span class="kt">uint64_t</span> <span class="n">rs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span> <span class="o">*</span> <span class="n">id3</span><span class="p">,</span>
			 <span class="n">mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span> <span class="o">*</span> <span class="n">id3</span><span class="p">};</span>

	<span class="n">do_div</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overscan</span> <span class="o">*</span> <span class="n">tv_norm</span><span class="o">-&gt;</span><span class="n">tv_enc_mode</span><span class="p">.</span><span class="n">hdisplay</span><span class="p">);</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">overscan</span> <span class="o">*</span> <span class="n">tv_norm</span><span class="o">-&gt;</span><span class="n">tv_enc_mode</span><span class="p">.</span><span class="n">vdisplay</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">max</span><span class="p">((</span><span class="kt">int64_t</span><span class="p">)</span><span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">id2</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">filter_params</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fparams</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="kt">int64_t</span> <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">k1</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki2</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span>
					     <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki3</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">)</span>
					<span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">kr</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">kir</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki2r</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span>
					   <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki3r</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
					<span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">kf</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">kif</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki2f</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span>
					   <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki3f</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">flicker</span>
					<span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">krf</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">kirf</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki2rf</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span>
					   <span class="n">p</span><span class="o">-&gt;</span><span class="n">ki3rf</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="o">*</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">flicker</span> <span class="o">*</span> <span class="n">rs</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>

				<span class="p">(</span><span class="o">*</span><span class="n">filters</span><span class="p">[</span><span class="n">k</span><span class="p">])[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">id5</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">39</span>
					<span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span> <span class="o">|</span> <span class="mh">0x7f</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Hardware state saving/restoring */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tv_save_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">base</span><span class="p">,</span>
			   <span class="kt">uint32_t</span> <span class="n">regs</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">base</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x40</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x5c</span> <span class="p">};</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">regs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv_read_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tv_load_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">base</span><span class="p">,</span>
			   <span class="kt">uint32_t</span> <span class="n">regs</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">base</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x40</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="mh">0x5c</span> <span class="p">};</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">nv_write_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offsets</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="n">regs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">nv17_tv_state_save</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nv17_tv_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x40</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv_read_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>

	<span class="n">tv_save_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">hfilter</span><span class="p">);</span>
	<span class="n">tv_save_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER2</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">hfilter2</span><span class="p">);</span>
	<span class="n">tv_save_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_VFILTER</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vfilter</span><span class="p">);</span>

	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">208</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">20</span><span class="n">c</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">304</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">504</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">508</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">604</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">608</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">60</span><span class="n">c</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">610</span><span class="p">);</span>
	<span class="n">nv_save_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">614</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">nv17_tv_state_load</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nv17_tv_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x40</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">nv_write_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">hfilter</span><span class="p">);</span>
	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER2</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">hfilter2</span><span class="p">);</span>
	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_VFILTER</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">vfilter</span><span class="p">);</span>

	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">208</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">20</span><span class="n">c</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">304</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">504</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">508</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">600</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">604</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">608</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">60</span><span class="n">c</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">610</span><span class="p">);</span>
	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="mi">614</span><span class="p">);</span>

	<span class="cm">/* This is required for some settings to kick in. */</span>
	<span class="n">nv_write_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">nv_write_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Timings similar to the ones the blob sets */</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="n">nv17_tv_modes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;320x200&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">320</span><span class="p">,</span> <span class="mi">344</span><span class="p">,</span> <span class="mi">392</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span>
		   <span class="o">|</span> <span class="n">DRM_MODE_FLAG_DBLSCAN</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_CLKDIV2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;320x240&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">320</span><span class="p">,</span> <span class="mi">344</span><span class="p">,</span> <span class="mi">392</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">263</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span>
		   <span class="o">|</span> <span class="n">DRM_MODE_FLAG_DBLSCAN</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_CLKDIV2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;400x300&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">400</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">496</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">314</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span>
		   <span class="o">|</span> <span class="n">DRM_MODE_FLAG_DBLSCAN</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_CLKDIV2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;640x480&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">640</span><span class="p">,</span> <span class="mi">672</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">880</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">492</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;720x480&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">720</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">872</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">493</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;720x576&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">720</span><span class="p">,</span> <span class="mi">776</span><span class="p">,</span> <span class="mi">856</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">588</span><span class="p">,</span> <span class="mi">597</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;800x600&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">800</span><span class="p">,</span> <span class="mi">840</span><span class="p">,</span> <span class="mi">920</span><span class="p">,</span> <span class="mi">1040</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">604</span><span class="p">,</span> <span class="mi">618</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_PHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_PVSYNC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">DRM_MODE</span><span class="p">(</span><span class="s">&quot;1024x768&quot;</span><span class="p">,</span> <span class="n">DRM_MODE_TYPE_DRIVER</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="mi">1024</span><span class="p">,</span> <span class="mi">1064</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1344</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">777</span><span class="p">,</span> <span class="mi">806</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		   <span class="n">DRM_MODE_FLAG_NHSYNC</span> <span class="o">|</span> <span class="n">DRM_MODE_FLAG_NVSYNC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">nv17_tv_update_properties</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nv17_tv_encoder</span> <span class="o">*</span><span class="n">tv_enc</span> <span class="o">=</span> <span class="n">to_tv_enc</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">nv17_tv_state</span> <span class="o">*</span><span class="n">regs</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nv17_tv_norm_params</span> <span class="o">*</span><span class="n">tv_norm</span> <span class="o">=</span> <span class="n">get_tv_norm</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">subconnector</span> <span class="o">=</span> <span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">select_subconnector</span> <span class="o">?</span>
						<span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">select_subconnector</span> <span class="o">:</span>
						<span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">subconnector</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">subconnector</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">DRM_MODE_SUBCONNECTOR_Composite</span>:
	<span class="p">{</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>

		<span class="cm">/* The composite connector may be found on either pin. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">pin_mask</span> <span class="o">&amp;</span> <span class="mh">0x4</span><span class="p">)</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">|=</span> <span class="mh">0x010000</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">pin_mask</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">|=</span> <span class="mh">0x100000</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">|=</span> <span class="mh">0x110000</span><span class="p">;</span>

		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="n">DRM_MODE_SUBCONNECTOR_SVIDEO</span>:
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">=</span> <span class="mh">0x11012</span><span class="p">;</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">DRM_MODE_SUBCONNECTOR_Component</span>:
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">=</span> <span class="mh">0x111333</span><span class="p">;</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">DRM_MODE_SUBCONNECTOR_SCART</span>:
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_204</span> <span class="o">=</span> <span class="mh">0x111012</span><span class="p">;</span>
		<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x20</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tv_norm</span><span class="o">-&gt;</span><span class="n">tv_enc_mode</span><span class="p">.</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x20</span><span class="p">],</span>
					 <span class="mi">255</span><span class="p">,</span> <span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">saturation</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x22</span><span class="p">]</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tv_norm</span><span class="o">-&gt;</span><span class="n">tv_enc_mode</span><span class="p">.</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x22</span><span class="p">],</span>
					 <span class="mi">255</span><span class="p">,</span> <span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">saturation</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">tv_enc</span><span class="p">[</span><span class="mh">0x25</span><span class="p">]</span> <span class="o">=</span> <span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">hue</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>

	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">204</span><span class="p">);</span>
	<span class="n">nv_load_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">nv_load_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="n">nv_load_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">22</span><span class="p">);</span>
	<span class="n">nv_load_tv_enc</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">nv17_tv_update_rescaler</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nv17_tv_encoder</span> <span class="o">*</span><span class="n">tv_enc</span> <span class="o">=</span> <span class="n">to_tv_enc</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">nv17_tv_state</span> <span class="o">*</span><span class="n">regs</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ptv_208</span> <span class="o">=</span> <span class="mh">0x40</span> <span class="o">|</span> <span class="p">(</span><span class="n">calc_overscan</span><span class="p">(</span><span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">overscan</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">tv_setup_filter</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>

	<span class="n">nv_load_ptv</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">regs</span><span class="p">,</span> <span class="mi">208</span><span class="p">);</span>
	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER</span><span class="p">,</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">hfilter</span><span class="p">);</span>
	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_HFILTER2</span><span class="p">,</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">hfilter2</span><span class="p">);</span>
	<span class="n">tv_load_filter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">NV_PTV_VFILTER</span><span class="p">,</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">vfilter</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">nv17_ctv_update_rescaler</span><span class="p">(</span><span class="k">struct</span> <span class="n">drm_encoder</span> <span class="o">*</span><span class="n">encoder</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">drm_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_nouveau_private</span> <span class="o">*</span><span class="n">dev_priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_private</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nv17_tv_encoder</span> <span class="o">*</span><span class="n">tv_enc</span> <span class="o">=</span> <span class="n">to_tv_enc</span><span class="p">(</span><span class="n">encoder</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">head</span> <span class="o">=</span> <span class="n">nouveau_crtc</span><span class="p">(</span><span class="n">encoder</span><span class="o">-&gt;</span><span class="n">crtc</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nv04_crtc_reg</span> <span class="o">*</span><span class="n">regs</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev_priv</span><span class="o">-&gt;</span><span class="n">mode_reg</span><span class="p">.</span><span class="n">crtc_reg</span><span class="p">[</span><span class="n">head</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">crtc_mode</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">encoder</span><span class="o">-&gt;</span><span class="n">crtc</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_display_mode</span> <span class="o">*</span><span class="n">output_mode</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">get_tv_norm</span><span class="p">(</span><span class="n">encoder</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ctv_enc_mode</span><span class="p">.</span><span class="n">mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">overscan</span><span class="p">,</span> <span class="n">hmargin</span><span class="p">,</span> <span class="n">vmargin</span><span class="p">,</span> <span class="n">hratio</span><span class="p">,</span> <span class="n">vratio</span><span class="p">;</span>

	<span class="cm">/* The rescaler doesn&#39;t do the right thing for interlaced modes. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DRM_MODE_FLAG_INTERLACE</span><span class="p">)</span>
		<span class="n">overscan</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">overscan</span> <span class="o">=</span> <span class="n">tv_enc</span><span class="o">-&gt;</span><span class="n">overscan</span><span class="p">;</span>

	<span class="n">hmargin</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span> <span class="o">-</span> <span class="n">crtc_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">vmargin</span> <span class="o">=</span> <span class="p">(</span><span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span> <span class="o">-</span> <span class="n">crtc_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">hmargin</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">hmargin</span><span class="p">,</span> <span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span>
			      <span class="n">hmargin</span><span class="p">,</span> <span class="n">overscan</span><span class="p">);</span>
	<span class="n">vmargin</span> <span class="o">=</span> <span class="n">interpolate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">min</span><span class="p">(</span><span class="n">vmargin</span><span class="p">,</span> <span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span><span class="o">/</span><span class="mi">20</span><span class="p">),</span>
			      <span class="n">vmargin</span><span class="p">,</span> <span class="n">overscan</span><span class="p">);</span>

	<span class="n">hratio</span> <span class="o">=</span> <span class="n">crtc_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span> <span class="o">*</span> <span class="mh">0x800</span> <span class="o">/</span>
		<span class="p">(</span><span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">hmargin</span><span class="p">);</span>
	<span class="n">vratio</span> <span class="o">=</span> <span class="n">crtc_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span> <span class="o">*</span> <span class="mh">0x800</span> <span class="o">/</span>
		<span class="p">(</span><span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">vmargin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_horiz_regs</span><span class="p">[</span><span class="n">FP_VALID_START</span><span class="p">]</span> <span class="o">=</span> <span class="n">hmargin</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_horiz_regs</span><span class="p">[</span><span class="n">FP_VALID_END</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">hdisplay</span> <span class="o">-</span> <span class="n">hmargin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_vert_regs</span><span class="p">[</span><span class="n">FP_VALID_START</span><span class="p">]</span> <span class="o">=</span> <span class="n">vmargin</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_vert_regs</span><span class="p">[</span><span class="n">FP_VALID_END</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_mode</span><span class="o">-&gt;</span><span class="n">vdisplay</span> <span class="o">-</span> <span class="n">vmargin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_debug_1</span> <span class="o">=</span> <span class="n">NV_PRAMDAC_FP_DEBUG_1_YSCALE_TESTMODE_ENABLE</span> <span class="o">|</span>
		<span class="n">XLATE</span><span class="p">(</span><span class="n">vratio</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_DEBUG_1_YSCALE_VALUE</span><span class="p">)</span> <span class="o">|</span>
		<span class="n">NV_PRAMDAC_FP_DEBUG_1_XSCALE_TESTMODE_ENABLE</span> <span class="o">|</span>
		<span class="n">XLATE</span><span class="p">(</span><span class="n">hratio</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_DEBUG_1_XSCALE_VALUE</span><span class="p">);</span>

	<span class="n">NVWriteRAMDAC</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_HVALID_START</span><span class="p">,</span>
		      <span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_horiz_regs</span><span class="p">[</span><span class="n">FP_VALID_START</span><span class="p">]);</span>
	<span class="n">NVWriteRAMDAC</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_HVALID_END</span><span class="p">,</span>
		      <span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_horiz_regs</span><span class="p">[</span><span class="n">FP_VALID_END</span><span class="p">]);</span>
	<span class="n">NVWriteRAMDAC</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_VVALID_START</span><span class="p">,</span>
		      <span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_vert_regs</span><span class="p">[</span><span class="n">FP_VALID_START</span><span class="p">]);</span>
	<span class="n">NVWriteRAMDAC</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_VVALID_END</span><span class="p">,</span>
		      <span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_vert_regs</span><span class="p">[</span><span class="n">FP_VALID_END</span><span class="p">]);</span>
	<span class="n">NVWriteRAMDAC</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">NV_PRAMDAC_FP_DEBUG_1</span><span class="p">,</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">fp_debug_1</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
