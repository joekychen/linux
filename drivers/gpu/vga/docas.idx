f | vga_switcheroo.c | s | 13K | 461 | Takashi Iwai | tiwai@suse.de | 1339236883 |  | vga_switcheroo: Enable/disable audio clients at the right time  The audio clients have to be disabled before disabling the VGA and switching.  Similarly, enabling the audio client should be done at last.  Otherwise the audio-side operation stalls, eventually leading to Oops or lockups.  Tested-by: JÃ¶rg-Volker Peetz <jvpeetz@web.de> Acked-by: Dave Airlie <airlied@redhat.com> Signed-off-by: Takashi Iwai <tiwai@suse.de>
f | vgaarb.c | s | 34K | 1151 | Matthew Garrett | mjg@redhat.com | 1335257421 |  | vga: fix build when fbdev is a module  This fixes the build breakage reported by Stephen in -next when merging the drm-next tree.  Signed-off-by: Dave Airlie <airlied@redhat.com>
f | Kconfig | g | 1.0K |  | Dave Airlie | airlied@redhat.com | 1335257419 |  | vga-switcheroo: select VGA arbitration.  Since Matthew's changes we have to select arbitration.  Reported-by: devh on #radeon Signed-off-by: Dave Airlie <airlied@redhat.com>
f | Makefile | g | 84B |  | Dave Airlie | airlied@linux.ie | 1267424437 |  | vga_switcheroo: initial implementation (v15)  Many new laptops now come with 2 gpus, one to be used for low power modes and one for gaming/on-ac applications. These GPUs are typically wired to the laptop panel and VGA ports via a multiplexer unit which is controlled via ACPI methods.  4 combinations of systems typically exist - with 2 ACPI methods. Intel/ATI - Lenovo W500/T500 - use ATPX ACPI method ATI/ATI - some ASUS - use ATPX ACPI Method Intel/Nvidia - - use _DSM ACPI method Nvidia/Nvidia -  - use _DSM ACPI method.  TODO: This patch adds support for the ATPX method and initial bits for the _DSM methods that need to written by someone with access to the hardware. Add a proper non-debugfs interface - need to get some proper testing first.  v2: add power up/down support for both devices on W500 puts i915/radeon into D3 and cuts power to radeon.  v3: redo probing methods, no DMI list, drm devices call to register with switcheroo, it tries to find an ATPX method on any device and once there is two devices + ATPX it inits the switcher.  v4: ATPX msg handling using buffers - should work on more machines  v5: rearchitect after more mjg59 discussion - move ATPX handling to     radeon driver.  v6: add file headers + initial nouveau bits (to be filled out).  v7: merge delayed switcher code.  v8: avoid suspend/resume of gpu that is off  v9: rearchitect - mjg59 is always right. - move all ATPX code to radeon, should allow simpler DSM also proper ATRM handling  v10: add ATRM support for radeon BIOS, add mutex to lock vgasr_priv  v11: fix bug in resuming Intel for 2nd time.  v12: start fixing up nvidia code blindly.  v13: blindly guess at finishing nvidia code  v14: remove radeon audio hacks - fix up intel resume more like upstream  v15: clean up printks + remove unnecessary igd/dis pointers  mount debugfs  /sys/kernel/debug/vgaswitcheroo/switch - should exist if ATPX detected  + 2 cards.  DIS - immediate change to discrete IGD - immediate change to IGD DDIS - delayed change to discrete DIGD - delayed change to IGD ON - turn on not in use OFF - turn off not in use  Tested on W500 (Intel/ATI) and T500 (Intel/ATI)  Signed-off-by: Dave Airlie <airlied@redhat.com>
