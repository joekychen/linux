<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › message › i2o › i2o_proc.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>i2o_proc.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	procfs handler for Linux I2O subsystem</span>
<span class="cm"> *</span>
<span class="cm"> *	(c) Copyright 1999	Deepak Saxena</span>
<span class="cm"> *</span>
<span class="cm"> *	Originally written by Deepak Saxena(deepak@plexity.net)</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> *	under the terms of the GNU General Public License as published by the</span>
<span class="cm"> *	Free Software Foundation; either version 2 of the License, or (at your</span>
<span class="cm"> *	option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *	This is an initial test release. The code is based on the design of the</span>
<span class="cm"> *	ide procfs system (drivers/block/ide-proc.c). Some code taken from</span>
<span class="cm"> *	i2o-core module by Alan Cox.</span>
<span class="cm"> *</span>
<span class="cm"> *	DISCLAIMER: This code is still under development/test and may cause</span>
<span class="cm"> *	your system to behave unpredictably.  Use at your own discretion.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *	Fixes/additions:</span>
<span class="cm"> *		Juha Sievänen (Juha.Sievanen@cs.Helsinki.FI),</span>
<span class="cm"> *		Auvo Häkkinen (Auvo.Hakkinen@cs.Helsinki.FI)</span>
<span class="cm"> *		University of Helsinki, Department of Computer Science</span>
<span class="cm"> *			LAN entries</span>
<span class="cm"> *		Markus Lidel &lt;Markus.Lidel@shadowconnect.com&gt;</span>
<span class="cm"> *			Changes for new I2O API</span>
<span class="cm"> */</span>

<span class="cp">#define OSM_NAME	&quot;proc-osm&quot;</span>
<span class="cp">#define OSM_VERSION	&quot;1.316&quot;</span>
<span class="cp">#define OSM_DESCRIPTION	&quot;I2O ProcFS OSM&quot;</span>

<span class="cp">#define I2O_MAX_MODULES 4</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>FIXME!</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define FMT_U64_HEX &quot;0x%08x%08x&quot;</span>
<span class="cp">#define U64_VAL(pu64) *((u32*)(pu64)+1), *((u32*)(pu64))</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/i2o.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
<span class="cp">#include &lt;linux/seq_file.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>

<span class="cm">/* Structure used to define /proc entries */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_proc_entry_t</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>		<span class="cm">/* entry name */</span>
	<span class="n">umode_t</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/* mode */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="o">*</span><span class="n">fops</span><span class="p">;</span>	<span class="cm">/* open function */</span>
<span class="p">}</span> <span class="n">i2o_proc_entry</span><span class="p">;</span>

<span class="cm">/* global I2O /proc/i2o entry */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">i2o_proc_dir_root</span><span class="p">;</span>

<span class="cm">/* proc OSM driver struct */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">i2o_driver</span> <span class="n">i2o_proc_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">OSM_NAME</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">print_serial_number</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span> <span class="n">serialno</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* 19990419 -sralston</span>
<span class="cm">	 *      The I2O v1.5 (and v2.0 so far) &quot;official specification&quot;</span>
<span class="cm">	 *      got serial numbers WRONG!</span>
<span class="cm">	 *      Apparently, and despite what Section 3.4.4 says and</span>
<span class="cm">	 *      Figure 3-35 shows (pg 3-39 in the pdf doc),</span>
<span class="cm">	 *      the convention / consensus seems to be:</span>
<span class="cm">	 *        + First byte is SNFormat</span>
<span class="cm">	 *        + Second byte is SNLen (but only if SNFormat==7 (?))</span>
<span class="cm">	 *        + (v2.0) SCSI+BS may use IEEE Registered (64 or 128 bit) format</span>
<span class="cm">	 */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">serialno</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">I2O_SNFORMAT_BINARY</span>:	<span class="cm">/* Binary */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;0x&quot;</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%02X&quot;</span><span class="p">,</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_ASCII</span>:	<span class="cm">/* ASCII */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">serialno</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="sc">&#39; &#39;</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* printable or SNLen? */</span>
			<span class="cm">/* sanity */</span>
			<span class="n">max_len</span> <span class="o">=</span>
			    <span class="p">(</span><span class="n">max_len</span> <span class="o">&lt;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="n">max_len</span> <span class="o">:</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">serialno</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">max_len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

			<span class="cm">/* just print it */</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">serialno</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* print chars for specified length */</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_UNICODE</span>:	<span class="cm">/* UNICODE */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;UNICODE Format.  Can&#39;t Display</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_LAN48_MAC</span>:	<span class="cm">/* LAN-48 MAC Address */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;LAN-48 MAC address @ %pM&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">serialno</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_WAN</span>:	<span class="cm">/* WAN MAC Address */</span>
		<span class="cm">/* FIXME: Figure out what a WAN access address looks like?? */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;WAN Access Address&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

<span class="cm">/* plus new in v2.0 */</span>
	<span class="k">case</span> <span class="n">I2O_SNFORMAT_LAN64_MAC</span>:	<span class="cm">/* LAN-64 MAC Address */</span>
		<span class="cm">/* FIXME: Figure out what a LAN-64 address really looks like?? */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
			   <span class="s">&quot;LAN-64 MAC address @ [?:%02X:%02X:?] %pM&quot;</span><span class="p">,</span>
			   <span class="n">serialno</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">serialno</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_DDM</span>:	<span class="cm">/* I2O DDM */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
			   <span class="s">&quot;DDM: Tid=%03Xh, Rsvd=%04Xh, OrgId=%04Xh&quot;</span><span class="p">,</span>
			   <span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			   <span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_IEEE_REG64</span>:	<span class="cm">/* IEEE Registered (64-bit) */</span>
	<span class="k">case</span> <span class="n">I2O_SNFORMAT_IEEE_REG128</span>:	<span class="cm">/* IEEE Registered (128-bit) */</span>
		<span class="cm">/* FIXME: Figure if this is even close?? */</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
			   <span class="s">&quot;IEEE NodeName(hi,lo)=(%08Xh:%08Xh), PortName(hi,lo)=(%08Xh:%08Xh)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			   <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
			   <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">14</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">I2O_SNFORMAT_UNKNOWN</span>:	<span class="cm">/* Unknown 0    */</span>
	<span class="k">case</span> <span class="n">I2O_SNFORMAT_UNKNOWN2</span>:	<span class="cm">/* Unknown 0xff */</span>
	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown data format (0x%02x)&quot;</span><span class="p">,</span> <span class="n">serialno</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_get_class_name - 	do i2o class name lookup</span>
<span class="cm"> *	@class: class number</span>
<span class="cm"> *</span>
<span class="cm"> *	Return a descriptive string for an i2o class.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">i2o_get_class_name</span><span class="p">(</span><span class="kt">int</span> <span class="n">class</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">i2o_class_name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Executive&quot;</span><span class="p">,</span>
		<span class="s">&quot;Device Driver Module&quot;</span><span class="p">,</span>
		<span class="s">&quot;Block Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;Tape Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;LAN Interface&quot;</span><span class="p">,</span>
		<span class="s">&quot;WAN Interface&quot;</span><span class="p">,</span>
		<span class="s">&quot;Fibre Channel Port&quot;</span><span class="p">,</span>
		<span class="s">&quot;Fibre Channel Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;SCSI Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;ATE Port&quot;</span><span class="p">,</span>
		<span class="s">&quot;ATE Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;Floppy Controller&quot;</span><span class="p">,</span>
		<span class="s">&quot;Floppy Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;Secondary Bus Port&quot;</span><span class="p">,</span>
		<span class="s">&quot;Peer Transport Agent&quot;</span><span class="p">,</span>
		<span class="s">&quot;Peer Transport&quot;</span><span class="p">,</span>
		<span class="s">&quot;Unknown&quot;</span>
	<span class="p">};</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">class</span> <span class="o">&amp;</span> <span class="mh">0xfff</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_EXECUTIVE</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_DDM</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_RANDOM_BLOCK_STORAGE</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_SEQUENTIAL_STORAGE</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_LAN</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_WAN</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_FIBRE_CHANNEL_PORT</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_FIBRE_CHANNEL_PERIPHERAL</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_SCSI_PERIPHERAL</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_ATE_PORT</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_ATE_PERIPHERAL</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_FLOPPY_CONTROLLER</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_FLOPPY_DEVICE</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_BUS_ADAPTER</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_PEER_TRANSPORT_AGENT</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_PEER_TRANSPORT</span>:
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i2o_class_name</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#define SCSI_TABLE_SIZE	13</span>
<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">scsi_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Direct-Access Read/Write&quot;</span><span class="p">,</span>
	<span class="s">&quot;Sequential-Access Storage&quot;</span><span class="p">,</span>
	<span class="s">&quot;Printer&quot;</span><span class="p">,</span>
	<span class="s">&quot;Processor&quot;</span><span class="p">,</span>
	<span class="s">&quot;WORM Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;CD-ROM Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Scanner Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Optical Memory Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Medium Changer Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Communications Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Graphics Art Pre-Press Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Graphics Art Pre-Press Device&quot;</span><span class="p">,</span>
	<span class="s">&quot;Array Controller Device&quot;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">chtostr</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span> <span class="n">chars</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">strncat</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">chars</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_report_query_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block_status</span><span class="p">,</span>
				   <span class="kt">char</span> <span class="o">*</span><span class="n">group</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">block_status</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="o">-</span><span class="n">ETIMEDOUT</span>:
		<span class="k">return</span> <span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Timeout reading group %s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">);</span>
	<span class="k">case</span> <span class="o">-</span><span class="n">ENOMEM</span>:
		<span class="k">return</span> <span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;No free memory to read the table.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">case</span> <span class="o">-</span><span class="n">I2O_PARAMS_STATUS_INVALID_GROUP_ID</span>:
		<span class="k">return</span> <span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Group %s not supported.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">group</span><span class="p">);</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
				  <span class="s">&quot;Error reading group %s. BlockStatus 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">group</span><span class="p">,</span> <span class="o">-</span><span class="n">block_status</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bus_strings</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Local Bus&quot;</span><span class="p">,</span>
	<span class="s">&quot;ISA&quot;</span><span class="p">,</span>
	<span class="s">&quot;EISA&quot;</span><span class="p">,</span>
	<span class="s">&quot;PCI&quot;</span><span class="p">,</span>
	<span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span>
	<span class="s">&quot;NUBUS&quot;</span><span class="p">,</span>
	<span class="s">&quot;CARDBUS&quot;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_hrt</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="n">i2o_hrt</span> <span class="o">*</span><span class="n">hrt</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2o_hrt</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">hrt</span><span class="p">.</span><span class="n">virt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bus</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_version</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
			   <span class="s">&quot;HRT table for controller is too new a version.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;HRT has %d entries of %d bytes each.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">num_entries</span><span class="p">,</span> <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">entry_len</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">num_entries</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Entry %d:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   Adapter ID: %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">adapter_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   Controlling tid: %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parent_tid</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus_type</span> <span class="o">!=</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">bus</span> <span class="o">=</span> <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus_type</span><span class="p">;</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   %s Information</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				   <span class="n">bus_strings</span><span class="p">[</span><span class="n">bus</span><span class="p">]);</span>

			<span class="k">switch</span> <span class="p">(</span><span class="n">bus</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">I2O_BUS_LOCAL</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;     IOBase: %0#6x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">local_bus</span><span class="p">.</span>
					   <span class="n">LbBaseIOPort</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; MemoryBase: %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">local_bus</span><span class="p">.</span>
					   <span class="n">LbBaseMemoryAddress</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">I2O_BUS_ISA</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;     IOBase: %0#6x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">isa_bus</span><span class="p">.</span>
					   <span class="n">IsaBaseIOPort</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; MemoryBase: %0#10x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">isa_bus</span><span class="p">.</span>
					   <span class="n">IsaBaseMemoryAddress</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; CSN: %0#4x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">isa_bus</span><span class="p">.</span><span class="n">CSN</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">I2O_BUS_EISA</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;     IOBase: %0#6x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">eisa_bus</span><span class="p">.</span>
					   <span class="n">EisaBaseIOPort</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; MemoryBase: %0#10x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">eisa_bus</span><span class="p">.</span>
					   <span class="n">EisaBaseMemoryAddress</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; Slot: %0#4x,&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">eisa_bus</span><span class="p">.</span>
					   <span class="n">EisaSlotNumber</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">I2O_BUS_PCI</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;     Bus: %0#4x&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">pci_bus</span><span class="p">.</span>
					   <span class="n">PciBusNumber</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; Dev: %0#4x&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">pci_bus</span><span class="p">.</span>
					   <span class="n">PciDeviceNumber</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; Func: %0#4x&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">pci_bus</span><span class="p">.</span>
					   <span class="n">PciFunctionNumber</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; Vendor: %0#6x&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">pci_bus</span><span class="p">.</span>
					   <span class="n">PciVendorID</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; Device: %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					   <span class="n">hrt</span><span class="o">-&gt;</span><span class="n">hrt_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bus</span><span class="p">.</span><span class="n">pci_bus</span><span class="p">.</span>
					   <span class="n">PciDeviceID</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;      Unsupported Bus Type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   Unknown Bus Type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_lct</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="n">i2o_lct</span> <span class="o">*</span><span class="n">lct</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2o_lct</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">lct</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">entries</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

<span class="cp">#define BUS_TABLE_SIZE 3</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bus_ports</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Generic Bus&quot;</span><span class="p">,</span>
		<span class="s">&quot;SCSI Bus&quot;</span><span class="p">,</span>
		<span class="s">&quot;Fibre Channel Bus&quot;</span>
	<span class="p">};</span>

	<span class="n">entries</span> <span class="o">=</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">table_size</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span><span class="p">;</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;LCT contains %d %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">entries</span><span class="p">,</span>
		   <span class="n">entries</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">&quot;entry&quot;</span> <span class="o">:</span> <span class="s">&quot;entries&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">boot_tid</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Boot Device @ ID %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lct</span><span class="o">-&gt;</span><span class="n">boot_tid</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Current Change Indicator: %#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lct</span><span class="o">-&gt;</span><span class="n">change_ind</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">entries</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Entry %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Class, SubClass  : %s&quot;</span><span class="p">,</span>
			   <span class="n">i2o_get_class_name</span><span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">class_id</span><span class="p">));</span>

		<span class="cm">/*</span>
<span class="cm">		 *      Classes which we&#39;ll print subclass info for</span>
<span class="cm">		 */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">class_id</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">I2O_CLASS_RANDOM_BLOCK_STORAGE</span>:
			<span class="k">switch</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x00</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Direct-Access Read/Write&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x04</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, WORM Drive&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x05</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, CD-ROM Drive&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x07</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Optical Memory Device&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Unknown (0x%02x)&quot;</span><span class="p">,</span>
					   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">I2O_CLASS_LAN</span>:
			<span class="k">switch</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x30</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Ethernet&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x40</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, 100base VG&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x50</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, IEEE 802.5/Token-Ring&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x60</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, ANSI X3T9.5 FDDI&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mh">0x70</span>:
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Fibre Channel&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Unknown Sub-Class (0x%02x)&quot;</span><span class="p">,</span>
					   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">I2O_CLASS_SCSI_PERIPHERAL</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span> <span class="o">&lt;</span> <span class="n">SCSI_TABLE_SIZE</span><span class="p">)</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, %s&quot;</span><span class="p">,</span>
					   <span class="n">scsi_devices</span><span class="p">[</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span>
							<span class="n">sub_class</span><span class="p">]);</span>
			<span class="k">else</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Unknown Device Type&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">I2O_CLASS_BUS_ADAPTER</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sub_class</span> <span class="o">&lt;</span> <span class="n">BUS_TABLE_SIZE</span><span class="p">)</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, %s&quot;</span><span class="p">,</span>
					   <span class="n">bus_ports</span><span class="p">[</span><span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span>
						     <span class="n">sub_class</span><span class="p">]);</span>
			<span class="k">else</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;, Unknown Bus Type&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Local TID        : 0x%03x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tid</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  User TID         : 0x%03x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">user_tid</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Parent TID       : 0x%03x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">parent_tid</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Identity Tag     : 0x%x%x%x%x%x%x%x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">identity_tag</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Change Indicator : %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">change_ind</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  Event Capab Mask : %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="n">lct</span><span class="o">-&gt;</span><span class="n">lct_entry</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">device_flags</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">prodstr</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">i2o_status_block</span> <span class="o">*</span><span class="n">sb</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">status_block</span><span class="p">.</span><span class="n">virt</span><span class="p">;</span>

	<span class="n">i2o_status_get</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>	<span class="c1">// reread the status block</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Organization ID        : %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">org_id</span><span class="p">);</span>

	<span class="n">version</span> <span class="o">=</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">i2o_version</span><span class="p">;</span>

<span class="cm">/* FIXME for Spec 2.0</span>
<span class="cm">	if (version == 0x02) {</span>
<span class="cm">		seq_printf(seq, &quot;Lowest I2O version supported: &quot;);</span>
<span class="cm">		switch(workspace[2]) {</span>
<span class="cm">			case 0x00:</span>
<span class="cm">				seq_printf(seq, &quot;1.0\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">			case 0x01:</span>
<span class="cm">				seq_printf(seq, &quot;1.5\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">			case 0x02:</span>
<span class="cm">				seq_printf(seq, &quot;2.0\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">		}</span>

<span class="cm">		seq_printf(seq, &quot;Highest I2O version supported: &quot;);</span>
<span class="cm">		switch(workspace[3]) {</span>
<span class="cm">			case 0x00:</span>
<span class="cm">				seq_printf(seq, &quot;1.0\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">			case 0x01:</span>
<span class="cm">				seq_printf(seq, &quot;1.5\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">			case 0x02:</span>
<span class="cm">				seq_printf(seq, &quot;2.0\n&quot;);</span>
<span class="cm">				break;</span>
<span class="cm">		}</span>
<span class="cm">	}</span>
<span class="cm">*/</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;IOP ID                 : %0#5x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">iop_id</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Host Unit ID           : %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">host_unit_id</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Segment Number         : %0#5x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">segment_number</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;I2O version            : &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x00</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;1.0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x01</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;1.5</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x02</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;2.0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown version</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;IOP State              : &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span><span class="n">iop_state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x01</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;INIT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x02</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;RESET</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x04</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;HOLD</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x05</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;READY</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x08</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;OPERATIONAL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x10</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x11</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;FAULTED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Messenger Type         : &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span><span class="n">msg_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x00</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Memory mapped</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x01</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Memory mapped only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x02</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Remote only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x03</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Memory mapped and remote</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Inbound Frame Size     : %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">inbound_frame_size</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Max Inbound Frames     : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">max_inbound_frames</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Current Inbound Frames : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">cur_inbound_frames</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Max Outbound Frames    : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">max_outbound_frames</span><span class="p">);</span>

	<span class="cm">/* Spec doesn&#39;t say if NULL terminated or not... */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">prodstr</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">product_id</span><span class="p">,</span> <span class="mi">24</span><span class="p">);</span>
	<span class="n">prodstr</span><span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Product ID             : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">prodstr</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Expected LCT Size      : %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">expected_lct_size</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;IOP Capabilities</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    Context Field Size Support : &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span><span class="n">iop_capabilities</span> <span class="o">&amp;</span> <span class="mh">0x0000003</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports only 32-bit context fields</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports only 64-bit context fields</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports 32-bit and 64-bit context fields, &quot;</span>
			   <span class="s">&quot;but not concurrently</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports 32-bit and 64-bit context fields &quot;</span>
			   <span class="s">&quot;concurrently</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sb</span><span class="o">-&gt;</span><span class="n">iop_capabilities</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    Current Context Field Size : &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span><span class="n">iop_capabilities</span> <span class="o">&amp;</span> <span class="mh">0x0000000C</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports only 32-bit context fields</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">8</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports only 64-bit context fields</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Supports both 32-bit or 64-bit context fields &quot;</span>
			   <span class="s">&quot;concurrently</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    Inbound Peer Support       : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span>
		    <span class="n">iop_capabilities</span> <span class="o">&amp;</span> <span class="mh">0x00000010</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Supported&quot;</span> <span class="o">:</span>
		   <span class="s">&quot;Not supported&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    Outbound Peer Support      : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span>
		    <span class="n">iop_capabilities</span> <span class="o">&amp;</span> <span class="mh">0x00000020</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Supported&quot;</span> <span class="o">:</span>
		   <span class="s">&quot;Not supported&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    Peer to Peer Support       : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">sb</span><span class="o">-&gt;</span>
		    <span class="n">iop_capabilities</span> <span class="o">&amp;</span> <span class="mh">0x00000040</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Supported&quot;</span> <span class="o">:</span>
		   <span class="s">&quot;Not supported&quot;</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Desired private memory size   : %d kB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">desired_mem_size</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Allocated private memory size : %d kB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">current_mem_size</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Private memory base address   : %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">current_mem_base</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Desired private I/O size      : %d kB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">desired_io_size</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Allocated private I/O size    : %d kB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">current_io_size</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Private I/O base address      : %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">sb</span><span class="o">-&gt;</span><span class="n">current_io_base</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">work32</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="o">*</span><span class="n">work8</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">work32</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u16</span> <span class="o">*</span><span class="n">work16</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="n">work32</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hwcap</span><span class="p">;</span>

	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cpu_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Intel 80960 series&quot;</span><span class="p">,</span>
		<span class="s">&quot;AMD2900 series&quot;</span><span class="p">,</span>
		<span class="s">&quot;Motorola 68000 series&quot;</span><span class="p">,</span>
		<span class="s">&quot;ARM series&quot;</span><span class="p">,</span>
		<span class="s">&quot;MIPS series&quot;</span><span class="p">,</span>
		<span class="s">&quot;Sparc series&quot;</span><span class="p">,</span>
		<span class="s">&quot;PowerPC series&quot;</span><span class="p">,</span>
		<span class="s">&quot;Intel x86 series&quot;</span>
	<span class="p">};</span>

	<span class="n">token</span> <span class="o">=</span>
	    <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">work32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">work32</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0x0000 IOP Hardware&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;I2O Vendor ID    : %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Product ID       : %0#6x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;CPU              : &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">work8</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cpu_table</span><span class="p">[</span><span class="n">work8</span><span class="p">[</span><span class="mi">16</span><span class="p">]]);</span>
	<span class="cm">/* Anyone using ProcessorVersion? */</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;RAM              : %dkB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Non-Volatile Mem : %dkB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>

	<span class="n">hwcap</span> <span class="o">=</span> <span class="n">work32</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Capabilities : 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">hwcap</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   [%s] Self booting</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">hwcap</span> <span class="o">&amp;</span> <span class="mh">0x00000001</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   [%s] Upgradable IRTOS</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">hwcap</span> <span class="o">&amp;</span> <span class="mh">0x00000002</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   [%s] Supports downloading DDMs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">hwcap</span> <span class="o">&amp;</span> <span class="mh">0x00000004</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   [%s] Supports installing DDMs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">hwcap</span> <span class="o">&amp;</span> <span class="mh">0x00000008</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;   [%s] Battery-backed RAM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">hwcap</span> <span class="o">&amp;</span> <span class="mh">0x00000010</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Executive group 0003h - Executing DDM List (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_ddm_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_exec_execute_ddm_table</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">ddm_tid</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">module_type</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">i2o_vendor_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">module_id</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">module_name_version</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span>
		<span class="n">u32</span> <span class="n">data_size</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">code_size</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">i2o_exec_execute_ddm_table</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">i2o_exec_execute_ddm_table</span> <span class="n">ddm_table</span><span class="p">[</span><span class="n">I2O_MAX_MODULES</span><span class="p">];</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

	<span class="n">i2o_exec_execute_ddm_table</span> <span class="n">ddm_table</span><span class="p">;</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
				   <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0x0003 Executing DDM List&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
		   <span class="s">&quot;Tid   Module_type     Vendor Mod_id  Module_name             Vrs  Data_size Code_size</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">ddm_table</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">ddm_table</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">row_count</span><span class="p">;</span> <span class="n">ddm_table</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">ddm_table</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;0x%03x &quot;</span><span class="p">,</span> <span class="n">ddm_table</span><span class="p">.</span><span class="n">ddm_tid</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">ddm_table</span><span class="p">.</span><span class="n">module_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x01</span>:
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Downloaded DDM  &quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x22</span>:
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Embedded DDM    &quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;                &quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-#7x&quot;</span><span class="p">,</span> <span class="n">ddm_table</span><span class="p">.</span><span class="n">i2o_vendor_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-#8x&quot;</span><span class="p">,</span> <span class="n">ddm_table</span><span class="p">.</span><span class="n">module_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-29s&quot;</span><span class="p">,</span>
			   <span class="n">chtostr</span><span class="p">(</span><span class="n">ddm_table</span><span class="p">.</span><span class="n">module_name_version</span><span class="p">,</span> <span class="mi">28</span><span class="p">));</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%9d  &quot;</span><span class="p">,</span> <span class="n">ddm_table</span><span class="p">.</span><span class="n">data_size</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%8d&quot;</span><span class="p">,</span> <span class="n">ddm_table</span><span class="p">.</span><span class="n">code_size</span><span class="p">);</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
      <span class="nl">out:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Executive group 0004h - Driver Store (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_driver_store</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">work32</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span>
	    <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">work32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">work32</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0x0004 Driver Store&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Module limit  : %d</span><span class="se">\n</span><span class="s">&quot;</span>
		   <span class="s">&quot;Module count  : %d</span><span class="se">\n</span><span class="s">&quot;</span>
		   <span class="s">&quot;Current space : %d kB</span><span class="se">\n</span><span class="s">&quot;</span>
		   <span class="s">&quot;Free space    : %d kB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">work32</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">work32</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">work32</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Executive group 0005h - Driver Store Table (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_drivers_stored</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_driver_store</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">stored_ddm_index</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">module_type</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">i2o_vendor_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">module_id</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">module_name_version</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">date</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="n">u32</span> <span class="n">module_size</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">mpb_size</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">module_flags</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">i2o_driver_store_table</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">i2o_driver_store_table</span> <span class="n">dst</span><span class="p">[</span><span class="n">I2O_MAX_MODULES</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">i2o_driver_result_table</span><span class="p">;</span>

	<span class="n">i2o_driver_result_table</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>
	<span class="n">i2o_driver_store_table</span> <span class="o">*</span><span class="n">dst</span><span class="p">;</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">i2o_driver_result_table</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0x0005</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
				   <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0x0005 DRIVER STORE TABLE&quot;</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
		   <span class="s">&quot;#  Module_type     Vendor Mod_id  Module_name             Vrs&quot;</span>
		   <span class="s">&quot;Date     Mod_size Par_size Flags</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dst</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dst</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">row_count</span><span class="p">;</span>
	     <span class="n">dst</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">dst</span><span class="p">[</span><span class="o">++</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-3d&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">stored_ddm_index</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">module_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x01</span>:
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Downloaded DDM  &quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x22</span>:
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Embedded DDM    &quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;                &quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-#7x&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">i2o_vendor_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-#8x&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">module_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-29s&quot;</span><span class="p">,</span> <span class="n">chtostr</span><span class="p">(</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">module_name_version</span><span class="p">,</span> <span class="mi">28</span><span class="p">));</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-9s&quot;</span><span class="p">,</span> <span class="n">chtostr</span><span class="p">(</span><span class="n">dst</span><span class="o">-&gt;</span><span class="n">date</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%8d &quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">module_size</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%8d &quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">mpb_size</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;0x%04x&quot;</span><span class="p">,</span> <span class="n">dst</span><span class="o">-&gt;</span><span class="n">module_flags</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F000h - Params Descriptor (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_groups</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">properties</span><span class="p">;</span>

	<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_group_info</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">group_number</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">field_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">properties</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">i2o_group_info</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">i2o_group_info</span> <span class="n">group</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF000 Params Descriptor&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
		   <span class="s">&quot;#  Group   FieldCount RowCount Type   Add Del Clear</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-3d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;0x%04X &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">group_number</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%10d &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">field_count</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%8d &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">row_count</span><span class="p">);</span>

		<span class="n">properties</span> <span class="o">=</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">properties</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">properties</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Table  &quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Scalar &quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">properties</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; + &quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot; - &quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">properties</span> <span class="o">&amp;</span> <span class="mh">0x4</span><span class="p">)</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  + &quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  - &quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">properties</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">)</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  + &quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;  - &quot;</span><span class="p">);</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="nl">out:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F001h - Physical Device Table (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_phys_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">adapter_id</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF001</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0xF001 Physical Device Table&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;#  AdapterId</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-2d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#7x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">adapter_id</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F002h - Claimed Table (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_claimed</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">claimed_tid</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF002</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF002 Claimed Table&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;#  ClaimedTid</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-2d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#7x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">claimed_tid</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F003h - User Table (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_users</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_user_table</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">instance</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">user_tid</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">claim_type</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved1</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">i2o_user_table</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">i2o_user_table</span> <span class="n">user</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF003</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF003 User Table&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;#  Instance UserTid ClaimType</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-3d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#8x &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">user</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">instance</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#7x &quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">user</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">user_tid</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#9x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">-&gt;</span><span class="n">user</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">claim_type</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="o">-&gt;</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="nl">out:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F005h - Private message extensions (table) (optional) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_priv_msgs</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_i2o_private</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">ext_instance</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">organization_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">x_function_code</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">i2o_private</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">i2o_private</span> <span class="n">extension</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0xF005 Private Message Extensions (optional)&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Instance#  OrgId  FunctionCode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%0#9x &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">extension</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ext_instance</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%0#6x &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">extension</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">organization_id</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%0#6x&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">extension</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x_function_code</span><span class="p">);</span>

		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F006h - Authorized User Table (table) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_authorized_users</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">result_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">pad</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">block_size</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">block_status</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">error_info_size</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">row_count</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">more_flag</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">alternate_tid</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_table_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">I2O_PARAMS_TABLE_GET</span><span class="p">,</span> <span class="mh">0xF006</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0xF006 Autohorized User Table&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;#  AlternateTid</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">.</span><span class="n">row_count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%-2d&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%#7x &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">alternate_tid</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">more_flag</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;There is more...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F100h - Device Identity (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_dev_identity</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">work32</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="c1">// allow for &quot;stuff&quot; + up to 256 byte (max) serial number</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>== (allow) 512d bytes (max)</p></td><td class="code"><div class="highlight"><pre>	<span class="k">static</span> <span class="n">u16</span> <span class="o">*</span><span class="n">work16</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="n">work32</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0xF100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">work32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">work32</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF100 Device Identity&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Device Class  : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i2o_get_class_name</span><span class="p">(</span><span class="n">work16</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Owner TID     : %0#5x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Parent TID    : %0#5x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Vendor info   : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">work32</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">16</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Product info  : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">work32</span> <span class="o">+</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">16</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Description   : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">work32</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">16</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Product rev.  : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">work32</span> <span class="o">+</span> <span class="mi">14</span><span class="p">),</span> <span class="mi">8</span><span class="p">));</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Serial number : &quot;</span><span class="p">);</span>
	<span class="n">print_serial_number</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">work32</span> <span class="o">+</span> <span class="mi">16</span><span class="p">),</span>
			    <span class="cm">/* allow for SNLen plus</span>
<span class="cm">			     * possible trailing &#39;\0&#39;</span>
<span class="cm">			     */</span>
			    <span class="k">sizeof</span><span class="p">(</span><span class="n">work32</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">16</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_dev_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F101h - DDM Identity (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_ddm_identity</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">ddm_tid</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">module_name</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">module_rev</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">sn_format</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">serial_number</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">pad</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>	<span class="c1">// allow up to 256 byte (max) serial number</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0xF101</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF101 DDM Identity&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Registering DDM TID : 0x%03x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">ddm_tid</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Module name         : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">module_name</span><span class="p">,</span> <span class="mi">24</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Module revision     : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">module_rev</span><span class="p">,</span> <span class="mi">8</span><span class="p">));</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Serial number       : &quot;</span><span class="p">);</span>
	<span class="n">print_serial_number</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">serial_number</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">-</span> <span class="mi">36</span><span class="p">);</span>
	<span class="cm">/* allow for SNLen plus possible trailing &#39;\0&#39; */</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F102h - User Information (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_uinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">device_name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">service_name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">physical_location</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">instance_number</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0xF102</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="s">&quot;0xF102 User Information&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Device name     : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">device_name</span><span class="p">,</span> <span class="mi">64</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Service name    : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">service_name</span><span class="p">,</span> <span class="mi">64</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Physical name   : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">physical_location</span><span class="p">,</span> <span class="mi">64</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Instance number : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">chtostr</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">instance_number</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F103h - SGL Operating Limits (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_sgl_limits</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">work32</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="k">static</span> <span class="n">u16</span> <span class="o">*</span><span class="n">work16</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="n">work32</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="o">*</span><span class="n">work8</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">work32</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0xF103</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">work32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">work32</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0xF103 SGL Operating Limits&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL chain size        : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Max SGL chain size    : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL chain size target : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work32</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL frag count        : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Max SGL frag count    : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL frag count target : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>

<span class="cm">/* FIXME</span>
<span class="cm">	if (d-&gt;i2oversion == 0x02)</span>
<span class="cm">	{</span>
<span class="cm">*/</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL data alignment    : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work16</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL addr limit        : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">work8</span><span class="p">[</span><span class="mi">20</span><span class="p">]);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;SGL addr sizes supported : &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">work8</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;32 bit &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">work8</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;64 bit &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">work8</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;96 bit &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">work8</span><span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;128 bit &quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">	}</span>
<span class="cm">*/</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Generic group F200h - Sensors (scalar) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_show_sensors</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="p">)</span><span class="n">seq</span><span class="o">-&gt;</span><span class="n">private</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">token</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">sensor_instance</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">component</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">component_instance</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">sensor_class</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">sensor_type</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">scaling_exponent</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">actual_reading</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">minimum_reading</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">low2lowcat_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">lowcat2low_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">lowwarn2low_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">low2lowwarn_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">norm2lowwarn_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">lowwarn2norm_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">nominal_reading</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hiwarn2norm_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">norm2hiwarn_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">high2hiwarn_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hiwarn2high_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hicat2high_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hi2hicat_treshold</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">maximum_reading</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">sensor_state</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">event_enable</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">result</span><span class="p">;</span>

	<span class="n">token</span> <span class="o">=</span> <span class="n">i2o_parm_field_get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="mh">0xF200</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">token</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_query_status</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span>
					<span class="s">&quot;0xF200 Sensors (optional)&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Sensor instance       : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">sensor_instance</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Component             : %d = &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">component</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">component</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Other&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Planar logic Board&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;CPU&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Chassis&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Power Supply&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Storage&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;External&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Component instance    : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">component_instance</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Sensor class          : %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">sensor_class</span> <span class="o">?</span> <span class="s">&quot;Analog&quot;</span> <span class="o">:</span> <span class="s">&quot;Digital&quot;</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Sensor type           : %d = &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">sensor_type</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">sensor_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Other</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Thermal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;DC voltage (DC volts)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;AC voltage (AC volts)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;DC current (DC amps)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;AC current (AC volts)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Door open</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">7</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Fan operational</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Scaling exponent      : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">scaling_exponent</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Actual reading        : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">actual_reading</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Minimum reading       : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">minimum_reading</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Low2LowCat treshold   : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">low2lowcat_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;LowCat2Low treshold   : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">lowcat2low_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;LowWarn2Low treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">lowwarn2low_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Low2LowWarn treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">low2lowwarn_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Norm2LowWarn treshold : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">norm2lowwarn_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;LowWarn2Norm treshold : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">lowwarn2norm_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Nominal reading       : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">nominal_reading</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;HiWarn2Norm treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">hiwarn2norm_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Norm2HiWarn treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">norm2hiwarn_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;High2HiWarn treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">high2hiwarn_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;HiWarn2High treshold  : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">hiwarn2high_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;HiCat2High treshold   : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">hicat2high_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;High2HiCat treshold   : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">result</span><span class="p">.</span><span class="n">hi2hicat_treshold</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Maximum reading       : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">maximum_reading</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Sensor state          : %d = &quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">sensor_state</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">sensor_state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Normal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Abnormal</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Low Catastrophic (LoCat)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Low (Low)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Low Warning (LoWarn)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;High Warning (HiWarn)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">7</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;High (High)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">8</span>:
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;High Catastrophic (HiCat)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;Event_enable : 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">event_enable</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] Operational state change. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] Low catastrophic. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] Low reading. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] Low warning. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span>
		   <span class="s">&quot;    [%s] Change back to normal from out of range state. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] High warning. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] High reading. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s">&quot;    [%s] High catastrophic. </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">event_enable</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;+&quot;</span> <span class="o">:</span> <span class="s">&quot;-&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_hrt</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_hrt</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_lct</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_lct</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_status</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_hw</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_ddm_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_ddm_table</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_driver_store</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_driver_store</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_drivers_stored</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_drivers_stored</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_groups</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_groups</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_phys_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_phys_device</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_claimed</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_claimed</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_users</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_users</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_priv_msgs</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_priv_msgs</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_authorized_users</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_authorized_users</span><span class="p">,</span>
			   <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_dev_identity</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_dev_identity</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_ddm_identity</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_ddm_identity</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_uinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_uinfo</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_sgl_limits</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_sgl_limits</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_sensors</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_sensors</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_seq_open_dev_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">i2o_seq_show_dev_name</span><span class="p">,</span> <span class="n">PDE</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_lct</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_lct</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_hrt</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_hrt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_status</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_hw</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_hw</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_ddm_table</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_ddm_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_driver_store</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_driver_store</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_drivers_stored</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_drivers_stored</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_groups</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_groups</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_phys_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_phys_device</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_claimed</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_claimed</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_users</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_users</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_priv_msgs</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_priv_msgs</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_authorized_users</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_authorized_users</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_dev_name</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_dev_name</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_dev_identity</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_dev_identity</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_ddm_identity</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_ddm_identity</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_uinfo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_uinfo</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_sgl_limits</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_sgl_limits</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">i2o_seq_fops_sensors</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">i2o_seq_open_sensors</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * IOP specific entries...write field just in case someone</span>
<span class="cm"> * ever wants one.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">i2o_proc_entry</span> <span class="n">i2o_proc_generic_iop_entries</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;hrt&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_hrt</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;lct&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_lct</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;status&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_status</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;hw&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_hw</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ddm_table&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_ddm_table</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;driver_store&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_driver_store</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;drivers_stored&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_drivers_stored</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Device specific entries</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">i2o_proc_entry</span> <span class="n">generic_dev_entries</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;groups&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_groups</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;phys_dev&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_phys_device</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;claimed&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_claimed</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;users&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_users</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;priv_msgs&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_priv_msgs</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;authorized_users&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_authorized_users</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;dev_identity&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_dev_identity</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ddm_identity&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_ddm_identity</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;user_info&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_uinfo</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;sgl_limits&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_sgl_limits</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;sensors&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_sensors</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *  Storage unit specific entries (SCSI Periph, BS) with device names</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">i2o_proc_entry</span> <span class="n">rbs_dev_entries</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;dev_name&quot;</span><span class="p">,</span> <span class="n">S_IFREG</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_seq_fops_dev_name</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_create_entries - Creates proc dir entries</span>
<span class="cm"> *	@dir: proc dir entry under which the entries should be placed</span>
<span class="cm"> *	@i2o_pe: pointer to the entries which should be added</span>
<span class="cm"> *	@data: pointer to I2O controller or device</span>
<span class="cm"> *</span>
<span class="cm"> *	Create proc dir entries for a I2O controller or I2O device.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 0 on success or negative error code on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_proc_create_entries</span><span class="p">(</span><span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
				   <span class="n">i2o_proc_entry</span> <span class="o">*</span> <span class="n">i2o_pe</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">i2o_pe</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">proc_create_data</span><span class="p">(</span><span class="n">i2o_pe</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">i2o_pe</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span>
				       <span class="n">i2o_pe</span><span class="o">-&gt;</span><span class="n">fops</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tmp</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

		<span class="n">i2o_pe</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_subdir_remove - Remove child entries from a proc entry</span>
<span class="cm"> *	@dir: proc dir entry from which the childs should be removed</span>
<span class="cm"> *</span>
<span class="cm"> *	Iterate over each i2o proc entry under dir and remove it. If the child</span>
<span class="cm"> *	also has entries, remove them too.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_proc_subdir_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">pe</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
	<span class="n">pe</span> <span class="o">=</span> <span class="n">dir</span><span class="o">-&gt;</span><span class="n">subdir</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">pe</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
		<span class="n">i2o_proc_subdir_remove</span><span class="p">(</span><span class="n">pe</span><span class="p">);</span>
		<span class="n">remove_proc_entry</span><span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
		<span class="n">pe</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_device_add - Add an I2O device to the proc dir</span>
<span class="cm"> *	@dir: proc dir entry to which the device should be added</span>
<span class="cm"> *	@dev: I2O device which should be added</span>
<span class="cm"> *</span>
<span class="cm"> *	Add an I2O device to the proc dir entry dir and create the entries for</span>
<span class="cm"> *	the device depending on the class of the I2O device.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_proc_device_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">buff</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">devdir</span><span class="p">;</span>
	<span class="n">i2o_proc_entry</span> <span class="o">*</span><span class="n">i2o_pe</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">sprintf</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="s">&quot;%03x&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">lct_data</span><span class="p">.</span><span class="n">tid</span><span class="p">);</span>

	<span class="n">osm_debug</span><span class="p">(</span><span class="s">&quot;adding device /proc/i2o/%s/%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">iop</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">buff</span><span class="p">);</span>

	<span class="n">devdir</span> <span class="o">=</span> <span class="n">proc_mkdir</span><span class="p">(</span><span class="n">buff</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">devdir</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">osm_warn</span><span class="p">(</span><span class="s">&quot;Could not allocate procdir!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">devdir</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">dev</span><span class="p">;</span>

	<span class="n">i2o_proc_create_entries</span><span class="p">(</span><span class="n">devdir</span><span class="p">,</span> <span class="n">generic_dev_entries</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* Inform core that we want updates about this device&#39;s status */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">lct_data</span><span class="p">.</span><span class="n">class_id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">I2O_CLASS_SCSI_PERIPHERAL</span>:
	<span class="k">case</span> <span class="n">I2O_CLASS_RANDOM_BLOCK_STORAGE</span>:
		<span class="n">i2o_pe</span> <span class="o">=</span> <span class="n">rbs_dev_entries</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i2o_pe</span><span class="p">)</span>
		<span class="n">i2o_proc_create_entries</span><span class="p">(</span><span class="n">devdir</span><span class="p">,</span> <span class="n">i2o_pe</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_iop_add - Add an I2O controller to the i2o proc tree</span>
<span class="cm"> *	@dir: parent proc dir entry</span>
<span class="cm"> *	@c: I2O controller which should be added</span>
<span class="cm"> *</span>
<span class="cm"> *	Add the entries to the parent proc dir entry. Also each device is added</span>
<span class="cm"> *	to the controllers proc dir entry.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 0 on success or negative error code on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2o_proc_iop_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">iopdir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2o_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="n">osm_debug</span><span class="p">(</span><span class="s">&quot;adding IOP /proc/i2o/%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">iopdir</span> <span class="o">=</span> <span class="n">proc_mkdir</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iopdir</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">iopdir</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>

	<span class="n">i2o_proc_create_entries</span><span class="p">(</span><span class="n">iopdir</span><span class="p">,</span> <span class="n">i2o_proc_generic_iop_entries</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>
	    <span class="n">i2o_proc_device_add</span><span class="p">(</span><span class="n">iopdir</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_iop_remove - Removes an I2O controller from the i2o proc tree</span>
<span class="cm"> *	@dir: parent proc dir entry</span>
<span class="cm"> *	@c: I2O controller which should be removed</span>
<span class="cm"> *</span>
<span class="cm"> *	Iterate over each i2o proc entry and search controller c. If it is found</span>
<span class="cm"> *	remove it from the tree.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_proc_iop_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">pe</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>

	<span class="n">pe</span> <span class="o">=</span> <span class="n">dir</span><span class="o">-&gt;</span><span class="n">subdir</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">pe</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">pe</span><span class="o">-&gt;</span><span class="n">next</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">i2o_proc_subdir_remove</span><span class="p">(</span><span class="n">pe</span><span class="p">);</span>
			<span class="n">remove_proc_entry</span><span class="p">(</span><span class="n">pe</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">osm_debug</span><span class="p">(</span><span class="s">&quot;removing IOP /proc/i2o/%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">pe</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_fs_create - Create the i2o proc fs.</span>
<span class="cm"> *</span>
<span class="cm"> *	Iterate over each I2O controller and create the entries for it.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 0 on success or negative error code on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">i2o_proc_fs_create</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>

	<span class="n">i2o_proc_dir_root</span> <span class="o">=</span> <span class="n">proc_mkdir</span><span class="p">(</span><span class="s">&quot;i2o&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">i2o_proc_dir_root</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_controllers</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>
	    <span class="n">i2o_proc_iop_add</span><span class="p">(</span><span class="n">i2o_proc_dir_root</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_fs_destroy - Cleanup the all i2o proc entries</span>
<span class="cm"> *</span>
<span class="cm"> *	Iterate over each I2O controller and remove the entries for it.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 0 on success or negative error code on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__exit</span> <span class="nf">i2o_proc_fs_destroy</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">i2o_controllers</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span>
	    <span class="n">i2o_proc_iop_remove</span><span class="p">(</span><span class="n">i2o_proc_dir_root</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>

	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;i2o&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_init - Init function for procfs</span>
<span class="cm"> *</span>
<span class="cm"> *	Registers Proc OSM and creates procfs entries.</span>
<span class="cm"> *</span>
<span class="cm"> *	Returns 0 on success or negative error code on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">i2o_proc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="n">OSM_DESCRIPTION</span> <span class="s">&quot; v&quot;</span> <span class="n">OSM_VERSION</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2o_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2o_proc_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2o_proc_fs_create</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2o_proc_driver</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	i2o_proc_exit - Exit function for procfs</span>
<span class="cm"> *</span>
<span class="cm"> *	Unregisters Proc OSM and removes procfs entries.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">i2o_proc_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i2o_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2o_proc_driver</span><span class="p">);</span>
	<span class="n">i2o_proc_fs_destroy</span><span class="p">();</span>
<span class="p">};</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Deepak Saxena&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="n">OSM_DESCRIPTION</span><span class="p">);</span>
<span class="n">MODULE_VERSION</span><span class="p">(</span><span class="n">OSM_VERSION</span><span class="p">);</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">i2o_proc_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">i2o_proc_exit</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
