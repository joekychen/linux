<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › message › i2o › debug.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>debug.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/i2o.h&gt;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">i2o_report_util_cmd</span><span class="p">(</span><span class="n">u8</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">i2o_report_exec_cmd</span><span class="p">(</span><span class="n">u8</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">i2o_report_fail_status</span><span class="p">(</span><span class="n">u8</span> <span class="n">req_status</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span> <span class="n">msg</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">i2o_report_common_status</span><span class="p">(</span><span class="n">u8</span> <span class="n">req_status</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">i2o_report_common_dsc</span><span class="p">(</span><span class="n">u16</span> <span class="n">detailed_status</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes.</span>
<span class="cm"> * Report Cmd name, Request status, Detailed Status.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">i2o_report_status</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">severity</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">i2o_message</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="n">m</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">req_status</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">detailed_status</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="n">I2O_CMD_UTIL_EVT_REGISTER</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>		<span class="c1">// No status in this reply</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s%s: &quot;</span><span class="p">,</span> <span class="n">severity</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">&lt;</span> <span class="mh">0x1F</span><span class="p">)</span>		<span class="c1">// Utility cmd</span>
		<span class="n">i2o_report_util_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>

	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">&gt;=</span> <span class="mh">0xA0</span> <span class="o">&amp;&amp;</span> <span class="n">cmd</span> <span class="o">&lt;=</span> <span class="mh">0xEF</span><span class="p">)</span>	<span class="c1">// Executive cmd</span>
		<span class="n">i2o_report_exec_cmd</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Cmd = %0#2x, &quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>	<span class="c1">// Other cmds</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">MSG_FAIL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2o_report_fail_status</span><span class="p">(</span><span class="n">req_status</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">i2o_report_common_status</span><span class="p">(</span><span class="n">req_status</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">&lt;</span> <span class="mh">0x1F</span> <span class="o">||</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">&gt;=</span> <span class="mh">0xA0</span> <span class="o">&amp;&amp;</span> <span class="n">cmd</span> <span class="o">&lt;=</span> <span class="mh">0xEF</span><span class="p">))</span>
		<span class="n">i2o_report_common_dsc</span><span class="p">(</span><span class="n">detailed_status</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot; / DetailedStatus = %0#4x.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">detailed_status</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Used to dump a message to syslog during debugging */</span>
<span class="kt">void</span> <span class="nf">i2o_dump_message</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2o_message</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef DEBUG</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="n">m</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Dumping I2O message size %d @ %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">((</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;  msg[%d] = %0#10x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes.</span>
<span class="cm"> * Following fail status are common to all classes.</span>
<span class="cm"> * The preserved message must be handled in the reply handler.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_report_fail_status</span><span class="p">(</span><span class="n">u8</span> <span class="n">req_status</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">FAIL_STATUS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;0x80&quot;</span><span class="p">,</span>		<span class="cm">/* not used */</span>
		<span class="s">&quot;SERVICE_SUSPENDED&quot;</span><span class="p">,</span>	<span class="cm">/* 0x81 */</span>
		<span class="s">&quot;SERVICE_TERMINATED&quot;</span><span class="p">,</span>	<span class="cm">/* 0x82 */</span>
		<span class="s">&quot;CONGESTION&quot;</span><span class="p">,</span>
		<span class="s">&quot;FAILURE&quot;</span><span class="p">,</span>
		<span class="s">&quot;STATE_ERROR&quot;</span><span class="p">,</span>
		<span class="s">&quot;TIME_OUT&quot;</span><span class="p">,</span>
		<span class="s">&quot;ROUTING_FAILURE&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_VERSION&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_OFFSET&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_MSG_FLAGS&quot;</span><span class="p">,</span>
		<span class="s">&quot;FRAME_TOO_SMALL&quot;</span><span class="p">,</span>
		<span class="s">&quot;FRAME_TOO_LARGE&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_TARGET_ID&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_INITIATOR_ID&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_INITIATOR_CONTEX&quot;</span><span class="p">,</span>	<span class="cm">/* 0x8F */</span>
		<span class="s">&quot;UNKNOWN_FAILURE&quot;</span>	<span class="cm">/* 0xFF */</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">req_status</span> <span class="o">==</span> <span class="n">I2O_FSC_TRANSPORT_UNKNOWN_FAILURE</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TRANSPORT_UNKNOWN_FAILURE (%0#2x).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">req_status</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TRANSPORT_%s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">FAIL_STATUS</span><span class="p">[</span><span class="n">req_status</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">]);</span>

	<span class="cm">/* Dump some details */</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;  InitiatorId = %d, TargetId = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;  LowestVersion = 0x%02X, HighestVersion = 0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;  FailingHostUnit = 0x%04X,  FailingIOP = 0x%03X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">msg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;  Severity:  0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;(FormatError), &quot;</span>
		       <span class="s">&quot;this msg can never be delivered/processed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;(PathError), &quot;</span>
		       <span class="s">&quot;this msg can no longer be delivered/processed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">18</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;(PathState), &quot;</span>
		       <span class="s">&quot;the system state does not allow delivery.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">19</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
		       <span class="s">&quot;(Congestion), resources temporarily not available;&quot;</span>
		       <span class="s">&quot;do not retry immediately.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes.</span>
<span class="cm"> * Following reply status are common to all classes.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_report_common_status</span><span class="p">(</span><span class="n">u8</span> <span class="n">req_status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">REPLY_STATUS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;SUCCESS&quot;</span><span class="p">,</span>
		<span class="s">&quot;ABORT_DIRTY&quot;</span><span class="p">,</span>
		<span class="s">&quot;ABORT_NO_DATA_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;ABORT_PARTIAL_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;ERROR_DIRTY&quot;</span><span class="p">,</span>
		<span class="s">&quot;ERROR_NO_DATA_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;ERROR_PARTIAL_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;PROCESS_ABORT_DIRTY&quot;</span><span class="p">,</span>
		<span class="s">&quot;PROCESS_ABORT_NO_DATA_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;PROCESS_ABORT_PARTIAL_TRANSFER&quot;</span><span class="p">,</span>
		<span class="s">&quot;TRANSACTION_ERROR&quot;</span><span class="p">,</span>
		<span class="s">&quot;PROGRESS_REPORT&quot;</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">req_status</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">REPLY_STATUS</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;RequestStatus = %0#2x&quot;</span><span class="p">,</span> <span class="n">req_status</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">REPLY_STATUS</span><span class="p">[</span><span class="n">req_status</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes.</span>
<span class="cm"> * Following detailed status are valid  for executive class,</span>
<span class="cm"> * utility class, DDM class and for transaction error replies.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_report_common_dsc</span><span class="p">(</span><span class="n">u16</span> <span class="n">detailed_status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">COMMON_DSC</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;SUCCESS&quot;</span><span class="p">,</span>
		<span class="s">&quot;0x01&quot;</span><span class="p">,</span>		<span class="c1">// not used</span>
		<span class="s">&quot;BAD_KEY&quot;</span><span class="p">,</span>
		<span class="s">&quot;TCL_ERROR&quot;</span><span class="p">,</span>
		<span class="s">&quot;REPLY_BUFFER_FULL&quot;</span><span class="p">,</span>
		<span class="s">&quot;NO_SUCH_PAGE&quot;</span><span class="p">,</span>
		<span class="s">&quot;INSUFFICIENT_RESOURCE_SOFT&quot;</span><span class="p">,</span>
		<span class="s">&quot;INSUFFICIENT_RESOURCE_HARD&quot;</span><span class="p">,</span>
		<span class="s">&quot;0x08&quot;</span><span class="p">,</span>		<span class="c1">// not used</span>
		<span class="s">&quot;CHAIN_BUFFER_TOO_LARGE&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNSUPPORTED_FUNCTION&quot;</span><span class="p">,</span>
		<span class="s">&quot;DEVICE_LOCKED&quot;</span><span class="p">,</span>
		<span class="s">&quot;DEVICE_RESET&quot;</span><span class="p">,</span>
		<span class="s">&quot;INAPPROPRIATE_FUNCTION&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_INITIATOR_ADDRESS&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_MESSAGE_FLAGS&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_OFFSET&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_PARAMETER&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_REQUEST&quot;</span><span class="p">,</span>
		<span class="s">&quot;INVALID_TARGET_ADDRESS&quot;</span><span class="p">,</span>
		<span class="s">&quot;MESSAGE_TOO_LARGE&quot;</span><span class="p">,</span>
		<span class="s">&quot;MESSAGE_TOO_SMALL&quot;</span><span class="p">,</span>
		<span class="s">&quot;MISSING_PARAMETER&quot;</span><span class="p">,</span>
		<span class="s">&quot;TIMEOUT&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN_ERROR&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN_FUNCTION&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNSUPPORTED_VERSION&quot;</span><span class="p">,</span>
		<span class="s">&quot;DEVICE_BUSY&quot;</span><span class="p">,</span>
		<span class="s">&quot;DEVICE_NOT_AVAILABLE&quot;</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">detailed_status</span> <span class="o">&gt;</span> <span class="n">I2O_DSC_DEVICE_NOT_AVAILABLE</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot; / DetailedStatus = %0#4x.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">detailed_status</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot; / %s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">COMMON_DSC</span><span class="p">[</span><span class="n">detailed_status</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_report_util_cmd</span><span class="p">(</span><span class="n">u8</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_NOP</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_NOP, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_ABORT</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_ABORT, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_CLAIM</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_CLAIM, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_CLAIM_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_CONFIG_DIALOG</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_CONFIG_DIALOG, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_DEVICE_RESERVE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_DEVICE_RESERVE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_DEVICE_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_DEVICE_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_EVT_ACK</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_EVENT_ACKNOWLEDGE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_EVT_REGISTER</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_EVENT_REGISTER, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_LOCK</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_LOCK, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_LOCK_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_LOCK_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_PARAMS_GET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_PARAMS_GET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_PARAMS_SET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_PARAMS_SET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_UTIL_REPLY_FAULT_NOTIFY</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;UTIL_REPLY_FAULT_NOTIFY, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Cmd = %0#2x, &quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Used for error reporting/debugging purposes</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2o_report_exec_cmd</span><span class="p">(</span><span class="n">u8</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_ASSIGN</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_ADAPTER_ASSIGN, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_READ</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_ADAPTER_READ, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_ADAPTER_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_BIOS_INFO_SET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_BIOS_INFO_SET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_BOOT_DEVICE_SET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_BOOT_DEVICE_SET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_CONFIG_VALIDATE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_CONFIG_VALIDATE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_CONN_SETUP</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_CONN_SETUP, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DDM_DESTROY</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DDM_DESTROY, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DDM_ENABLE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DDM_ENABLE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DDM_QUIESCE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DDM_QUIESCE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DDM_RESET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DDM_RESET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DDM_SUSPEND</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DDM_SUSPEND, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DEVICE_ASSIGN</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DEVICE_ASSIGN, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_DEVICE_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_DEVICE_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_HRT_GET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_HRT_GET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_CLEAR</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_IOP_CLEAR, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_CONNECT</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_IOP_CONNECT, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_ADAPTER_RESET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_IOP_RESET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_LCT_NOTIFY</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_LCT_NOTIFY, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_OUTBOUND_INIT</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_OUTBOUND_INIT, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_PATH_ENABLE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_PATH_ENABLE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_PATH_QUIESCE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_PATH_QUIESCE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_PATH_RESET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_PATH_RESET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_STATIC_MF_CREATE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_STATIC_MF_CREATE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_STATIC_MF_RELEASE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_STATIC_MF_RELEASE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_STATUS_GET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_STATUS_GET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SW_DOWNLOAD</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SW_DOWNLOAD, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SW_UPLOAD</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SW_UPLOAD, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SW_REMOVE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SW_REMOVE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SYS_ENABLE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SYS_ENABLE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SYS_MODIFY</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SYS_MODIFY, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SYS_QUIESCE</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SYS_QUIESCE, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">I2O_CMD_SYS_TAB_SET</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXEC_SYS_TAB_SET, &quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Cmd = %#02x, &quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">i2o_debug_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: State = &quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(((</span><span class="n">i2o_status_block</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">status_block</span><span class="p">.</span><span class="n">virt</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">iop_state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x01</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;INIT</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x02</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;RESET</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x04</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;HOLD</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x05</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;READY</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x08</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;OPERATIONAL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x10</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FAILED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x11</span>:
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FAULTED</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%x (unknown !!)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="p">((</span><span class="n">i2o_status_block</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">status_block</span><span class="p">.</span><span class="n">virt</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">iop_state</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">i2o_dump_hrt</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2o_controller</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">hrt</span><span class="p">.</span><span class="n">virt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">hrt</span><span class="p">.</span><span class="n">virt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">d</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">state</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
		       <span class="s">&quot;%s: HRT table for controller is too new a version.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">count</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">length</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: HRT has %d entries of %d bytes each.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">c</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">length</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">rows</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Adapter %08X: &quot;</span><span class="p">,</span> <span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">rows</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">state</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TID %04X:[&quot;</span><span class="p">,</span> <span class="n">state</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">);</span>
		<span class="n">state</span> <span class="o">&gt;&gt;=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;H&quot;</span><span class="p">);</span>	<span class="cm">/* Hidden */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;P&quot;</span><span class="p">);</span>	<span class="cm">/* Present */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span>	<span class="cm">/* Controlled */</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;*&quot;</span><span class="p">);</span>	<span class="cm">/* Hard */</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;]:&quot;</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="cm">/* Adapter private bus - easy */</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Local bus %d: I/O at 0x%04X Mem 0x%08X&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			       <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="cm">/* ISA bus */</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;ISA %d: CSN %d I/O at 0x%04X Mem 0x%08X&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			       <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">2</span>:	<span class="cm">/* EISA bus */</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EISA %d: Slot %d I/O at 0x%04X Mem 0x%08X&quot;</span><span class="p">,</span>
			       <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">3</span>:	<span class="cm">/* MCA bus */</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;MCA %d: Slot %d I/O at 0x%04X Mem 0x%08X&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			       <span class="n">d</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="mi">4</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">4</span>:	<span class="cm">/* PCI bus */</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;PCI %d: Bus %d Device %d Function %d&quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			       <span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x80</span>:	<span class="cm">/* Other */</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Unsupported bus type.&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rows</span> <span class="o">+=</span> <span class="n">length</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">i2o_dump_message</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
