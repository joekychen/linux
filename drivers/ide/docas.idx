f | ide-acpi.c | s | 16K | 524 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | ide-cd_ioctl.c | s | 11K | 391 | Tejun Heo | tj@kernel.org | 1303407839 |  | ide: unexport DISK_EVENT_MEDIA_CHANGE for ide-gd and ide-cd  check_events() implementations in both ide-gd and ide-cd are inadequate for in-kernel event polling.  Both generate media change events continuously when certain conditions are met causing infinite event loop between the driver and userland event handler.  As disk event now supports suppression of unlisted events, simply de-listing DISK_EVENT_MEDIA_CHANGE from disk->events resolves the problem.  Internal handling around media revalidation will behave the same while userland will fall back to userland event polling after detecting the device doesn't support disk events.  Signed-off-by: Tejun Heo <tj@kernel.org> Reported-by: Jens Axboe <jaxboe@fusionio.com> Acked-by: "David S. Miller" <davem@davemloft.net> Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | it821x.c | s | 20K | 620 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | opti621.c | s | 4.5K | 144 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894281 |  | ide: change ->set_pio_mode method parameters  Change ->set_pio_mode method parameters to match ->set_piomode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-io.c | s | 23K | 770 | Jens Axboe | jaxboe@fusionio.com | 1302040369 |  | ide: always ensure that blk_delay_queue() is called if we have pending IO  Just because we are not requeuing a request does not mean that some aren't pending. So always issue a blk_delay_queue() if either we are requeueing OR there's pending IO.  This fixes a boot problem for some IDE boxes.  Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | Makefile | g | 3.9K |  | Jean-Christophe PLAGNIOL-VILLARD | plagnioj@jcrosoft.com | 1329154297 |  | ARM: at91: drop ide driver in favor of the pata one  Driver at91_ide is broken and should not be fixed: remove it. Modification of device files that where making use of it. The PATA driver (pata_at91) is able to replace at91_ide.  Signed-off-by: Jean-Christophe PLAGNIOL-VILLARD <plagnioj@jcrosoft.com> Acked-by: Nicolas Ferre <nicolas.ferre@atmel.com>
f | piix.c | s | 14K | 426 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1318360783 |  | piix: ICH7 MWDMA1 errata  Based on libata commit c611bed7.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-sysfs.c | s | 2.8K | 103 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1230909168 |  | ide: move sysfs support to ide-sysfs.c  While at it: - media_string() -> ide_media_string()  There should be no functional changes caused by this patch.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-gd.c | s | 10K | 369 | Tejun Heo | tj@kernel.org | 1303407839 |  | ide: unexport DISK_EVENT_MEDIA_CHANGE for ide-gd and ide-cd  check_events() implementations in both ide-gd and ide-cd are inadequate for in-kernel event polling.  Both generate media change events continuously when certain conditions are met causing infinite event loop between the driver and userland event handler.  As disk event now supports suppression of unlisted events, simply de-listing DISK_EVENT_MEDIA_CHANGE from disk->events resolves the problem.  Internal handling around media revalidation will behave the same while userland will fall back to userland event polling after detecting the device doesn't support disk events.  Signed-off-by: Tejun Heo <tj@kernel.org> Reported-by: Jens Axboe <jaxboe@fusionio.com> Acked-by: "David S. Miller" <davem@davemloft.net> Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | ide-dma.c | s | 13K | 472 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | umc8672.c | s | 5.0K | 155 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | serverworks.c | s | 12K | 389 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | aec62xx.c | s | 9.2K | 289 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-timings.c | s | 6.5K | 179 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263929409 |  | ide: ide_timing_compute() fixup  XFER_SW_DMA_0 mode should be excluded from the extended cycle timing computations.  [ This is just a documentation fix -- code inside the affected   'if' block already makes sure to accept only PIO modes. ]  Noticed-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | dtc2278.c | s | 3.8K | 133 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | ide-pnp.c | s | 2.6K | 89 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cs5520.c | s | 4.7K | 144 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | jmicron.c | s | 4.5K | 149 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | pdc202xx_old.c | s | 10K | 313 | Sergei Shtylyov | sshtylyov@ru.mvista.com | 1271988684 |  | pdc202xx_old: ignore "FIFO empty" bit in test_irq() method  The driver takes into account not only the interrupt status bit but also "FIFO empty" bit in its test_irq() method. This actually is a superfluous check since for the DMA commands calling the dma_test_irq() method further in the interrupt handler makes sure FIFO is emptied.  Signed-off-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | rz1000.c | s | 2.3K | 81 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1230578853 |  | rz1000: apply chipset quirks early (v2)  * Use pci_name(dev) instead of hwif->name in init_hwif_rz1000().  * init_hwif_rz1000() -> rz1000_init_chipset().  Update rz1000_init_one()   to use rz1000_init_chipset() and add now required rz1000_remove().  * Remove superfluous ide_rz1000 chipset type.  v2: * unsigned int rz1000_init_chipset() -> int rz1000_disable_readahead()   per Sergei's suggestion.  Cc: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | via82cxxx.c | s | 14K | 450 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | ide-gd.h | s | 932B | 32 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1238154394 |  | ide: move ->failed_pc to ide_drive_t  Move ->failed_pc from struct ide_{disk,tape}_obj to ide_drive_t.  There should be no functional changes caused by this patch.  Acked-by: Borislav Petkov <petkovbb@gmail.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-4drives.c | s | 1.5K | 48 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | ide-pio-blacklist.c | s | 2.3K | 83 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1216233219 |  | ide: move PIO blacklist to ide-pio-blacklist.c  Move PIO blacklist to ide-pio-blacklist.c.  While at it:  - fix comment  - fix whitespace damage  There should be no functional changes caused by this patch.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-cs.c | s | 12K | 296 | Julia Lawall | Julia.Lawall@lip6.fr | 1339541501 |  | drivers/ide/ide-cs.c: adjust suspicious bit operation  IO_DATA_PATH_WIDTH_8 is 0, so a bit-and with it is always false.  The value IO_DATA_PATH_WIDTH covers the bits of the IO_DATA_PATH constants, so first pick those bits and then make the test using !=.  This problem was found using Coccinelle (http://coccinelle.lip6.fr/).  Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-pm.c | s | 6.5K | 217 | Christoph Hellwig | hch@lst.de | 1281197876 |  | block: remove wrappers for request type/flags  Remove all the trivial wrappers for the cmd_type and cmd_flags fields in struct requests.  This allows much easier grepping for different request types instead of unwinding through macros.  Signed-off-by: Christoph Hellwig <hch@lst.de> Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | q40ide.c | s | 4.1K | 137 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | macide.c | s | 3.0K | 113 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cmd640.c | s | 22K | 740 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | alim15x3.c | s | 14K | 517 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894751 |  | alim15x3: fix handling of UDMA enable bit  Clear UDMA enable bit also for PIO modes.  Based on libata pata_ali host driver.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-io-std.c | s | 6.4K | 221 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | rapide.c | s | 2.0K | 84 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | ide-tape.c | s | 55K | 1764 | Geert Uytterhoeven | geert@linux-m68k.org | 1320788146 |  | ide-{cd,floppy,tape}: Do not include <linux/irq.h>  The top of <linux/irq.h> has this comment:   * Please do not include this file in generic code.  There is currently  * no requirement for any architecture to implement anything held  * within this file.  *  * Thanks. --rmk  Remove inclusion of <linux/irq.h>, to prevent the following compile error from happening soon:  || include/linux/irq.h:132: error: redefinition of ‘struct irq_data’ || include/linux/irq.h:286: error: redefinition of ‘struct irq_chip’  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Acked-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Borislav Petkov <bp@alien8.de> Cc: linux-ide@vger.kernel.org
f | ide-xfer-mode.c | s | 6.7K | 223 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | tx4938ide.c | s | 5.7K | 189 | Atsushi Nemoto | anemo@mba.ocn.ne.jp | 1281349075 |  | tx493xide: use min_t() macro instead of min()  This fixes a warning ("comparison of distinct pointer types lacks a cast") introduced by the commit 040f6b4f14adb2ca5babb84e9fb2ebc6661e0be2 ("tx493xide: use ->pio_mode value to determine pair device speed").  Signed-off-by: Atsushi Nemoto <anemo@mba.ocn.ne.jp> Signed-off-by: David S. Miller <davem@davemloft.net>
f | qd65xx.h | s | 5.8K | 130 | Joao Ramos | joao.ramos@inov.pt | 1245096824 |  | ide: do not access ide_drive_t 'drive_data' field directly  Change ide_drive_t 'drive_data' field from 'unsigned int' type to 'void *' type, allowing a wider range of values/types to be stored in this field.  Added 'ide_get_drivedata' and 'ide_set_drivedata' helpers to get and set the 'drive_data' field.  Fixed all host drivers to maintain coherency with the change in the 'drive_data' field type.  Signed-off-by: Joao Ramos <joao.ramos@inov.pt> [bart: fix qd65xx build, cast to 'unsigned long', minor Coding Style fixups] Acked-by: Sergei Shtylyov <sshtylyov@ru.montavista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide.c | s | 10K | 330 | Rusty Russell | rusty@rustcorp.com.au | 1281533679 |  | ide: use module_param_named rather than module_param_call  It has the additional benefit of typechecking (in this case, an unsigned int).  Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Reviewed-by: Takashi Iwai <tiwai@suse.de>
f | cmd64x.c | s | 12K | 390 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894752 |  | cmd64x: fix handling of address setup timings  Account for the requirements of the DMA mode currently used.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | delkin_cb.c | s | 4.6K | 158 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1242580345 |  | ide: remove hw_regs_t typedef  Remove hw_regs_t typedef and rename struct hw_regs_s to struct ide_hw.  There should be no functional changes caused by this patch.  Acked-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | trm290.c | s | 10K | 328 | Sergei Shtylyov | sshtylyov@ru.mvista.com | 1238523332 |  | ide: turn selectproc() method into dev_select() method (take 5)  Turn selectproc() method into dev_select() method by teaching it to write to the device register and moving it from 'struct ide_port_ops' to 'struct ide_tp_ops'.  Signed-off-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Cc: benh@kernel.crashing.org Cc: petkovbb@gmail.com [bart: add ->dev_select to at91_ide.c and tx4939.c (__BIG_ENDIAN case)] Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | cy82c693.c | s | 6.3K | 194 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1318539890 |  | cy82c693: fix PCI device selection  Wrong PCI device may be selected by cy82c693_set_pio_mode() if modular IDE host drivers are used and there are additional IDE PCI devices installed in the system.  Fix it.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | slc90e66.c | s | 4.8K | 154 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-disk.c | s | 19K | 643 | Borislav Petkov | bp@alien8.de | 1317666498 |  | ide-disk: Fix request requeuing  Simon Kirby reported that on his RAID setup with idedisk underneath the box OOMs after a couple of days of runtime. Running with CONFIG_DEBUG_KMEMLEAK pointed to idedisk_prep_fn() which unconditionally allocates an ide_cmd struct. However, ide_requeue_and_plug() can be called more than once per request, either from the request issue or the IRQ handler path and do blk_peek_request() ends up in idedisk_prep_fn() repeatedly, allocating a struct ide_cmd everytime and "forgetting" the previous pointer.  Make sure the code reuses the old allocated chunk.  Reported-and-tested-by: Simon Kirby <sim@hostway.ca> Cc: <stable@kernel.org> [ 39.x, 3.0.x ] Link: http://marc.info/?l=linux-kernel&m=131667641517919 Link: http://lkml.kernel.org/r/20110922072643.GA27232@hostway.ca Signed-off-by: Borislav Petkov <bp@alien8.de> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-iops.c | s | 13K | 459 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894117 |  | ide: add SATA cable detection support  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-cd.c | s | 45K | 1504 | Geert Uytterhoeven | geert@linux-m68k.org | 1320788146 |  | ide-{cd,floppy,tape}: Do not include <linux/irq.h>  The top of <linux/irq.h> has this comment:   * Please do not include this file in generic code.  There is currently  * no requirement for any architecture to implement anything held  * within this file.  *  * Thanks. --rmk  Remove inclusion of <linux/irq.h>, to prevent the following compile error from happening soon:  || include/linux/irq.h:132: error: redefinition of ‘struct irq_data’ || include/linux/irq.h:286: error: redefinition of ‘struct irq_chip’  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Acked-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Borislav Petkov <bp@alien8.de> Cc: linux-ide@vger.kernel.org
f | ide-park.c | s | 3.4K | 127 | Jens Axboe | jaxboe@fusionio.com | 1299743527 |  | block: remove per-queue plugging  Code has been converted over to the new explicit on-stack plugging, and delay users have been converted to use the new API for that. So lets kill off the old plugging along with aops->sync_page().  Signed-off-by: Jens Axboe <jaxboe@fusionio.com>
f | tc86c001.c | s | 7.6K | 223 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-cd_verbose.c | s | 13K | 337 | FUJITA Tomonori | fujita.tomonori@lab.ntt.co.jp | 1209473335 |  | block: replace sizeof(rq->cmd) with BLK_MAX_CDB  This is a preparation for changing rq->cmd from the static array to a pointer.  Signed-off-by: FUJITA Tomonori <fujita.tomonori@lab.ntt.co.jp> Cc: Boaz Harrosh <bharrosh@panasas.com> Cc: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Cc: Jens Axboe <jens.axboe@oracle.com> Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
f | tx4939ide.c | s | 17K | 554 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | ide-devsets.c | s | 3.8K | 148 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | scc_pata.c | s | 22K | 737 | David S. Miller | davem@davemloft.net | 1267603079 |  | Merge branch 'master' of master.kernel.org:/pub/scm/linux/kernel/git/davem/ide-2.6
f | it8172.c | s | 5.1K | 140 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-floppy_ioctl.c | s | 7.2K | 243 | Paolo Bonzini | pbonzini@redhat.com | 1326582444 |  | block: add and use scsi_blk_cmd_ioctl  Introduce a wrapper around scsi_cmd_ioctl that takes a block device.  The function will then be enhanced to detect partition block devices and, in that case, subject the ioctls to whitelisting.  Cc: linux-scsi@vger.kernel.org Cc: Jens Axboe <axboe@kernel.dk> Cc: James Bottomley <JBottomley@parallels.com> Signed-off-by: Paolo Bonzini <pbonzini@redhat.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | it8213.c | s | 5.5K | 185 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-floppy_proc.c | s | 1.2K | 38 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-h8300.c | s | 2.4K | 85 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1242580345 |  | ide: remove hw_regs_t typedef  Remove hw_regs_t typedef and rename struct hw_regs_s to struct ide_hw.  There should be no functional changes caused by this patch.  Acked-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | sis5513.c | s | 18K | 535 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | gayle.c | s | 4.7K | 157 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | amd74xx.c | s | 10K | 291 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894752 |  | amd74xx: use ->pio_mode value to determine pair device speed  Use the current PIO mode value instead of the current transfer speed of the pair device on the port to determine PIO commmand timings used for both devices on the port.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-generic.c | s | 3.9K | 127 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1242580345 |  | ide: remove hw_regs_t typedef  Remove hw_regs_t typedef and rename struct hw_regs_s to struct ide_hw.  There should be no functional changes caused by this patch.  Acked-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | triflex.c | s | 3.8K | 136 | Mikulas Patocka | mikulas@artax.karlin.mff.cuni.cz | 1318539889 |  | IDE: Don't powerdown Compaq Triflex IDE device on suspend  Don't powerdown Compaq Triflex IDE device on suspend  This fixes APM suspend on Compaq Armada 7400. APM BIOS doesn't suspend if IDE is powered down when suspending. The Triflex controller is found only on old Compaq boards, so this patch will hopefully have no side effects.  This patch fixes a suspend regression introduced in feb22b7f8e62b1b987a3a1dbad95af767a1df832 ("ide: add proper PCI PM support (v2)").  Signed-off-by: Mikulas Patocka <mikulas@artax.karlin.mff.cuni.cz> [bart: add commit's summary in parens] Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sc1200.c | s | 9.2K | 303 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | ide-disk_proc.c | s | 4.6K | 147 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | falconide.c | s | 3.9K | 139 | Sergei Shtylyov | sshtylyov@ru.mvista.com | 1245084778 |  | ide: move ack_intr() method into 'struct ide_port_ops' (take 2)  Move the ack_intr() method into 'struct ide_port_ops', also renaming it to test_irq() while at it...  Signed-off-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | au1xxx-ide.c | s | 15K | 499 | Manuel Lauss | manuel.lauss@googlemail.com | 1319495664 |  | MIPS: Alchemy: kill au1xxx.h header  No longer required  Signed-off-by: Manuel Lauss <manuel.lauss@googlemail.com> To: Linux-MIPS <linux-mips@linux-mips.org> Patchwork: https://patchwork.linux-mips.org/patch/2705/ Signed-off-by: Ralf Baechle <ralf@linux-mips.org>   delete mode 100644 arch/mips/include/asm/mach-au1x00/au1xxx.h
f | qd65xx.c | s | 10K | 365 | David Howells | dhowells@redhat.com | 1332955803 |  | Remove all #inclusions of asm/system.h  Remove all #inclusions of asm/system.h preparatory to splitting and killing it.  Performed with the following command:  perl -p -i -e 's!^#\s*include\s*<asm/system[.]h>.*\n!!' `grep -Irl '^#\s*include\s*<asm/system[.]h>' *`  Signed-off-by: David Howells <dhowells@redhat.com>
f | ide-ioctls.c | s | 6.7K | 247 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | atiixp.c | s | 5.6K | 175 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-atapi.c | s | 17K | 595 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-pci-generic.c | s | 6.0K | 180 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | siimage.c | s | 20K | 710 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894755 |  | siimage: use ->pio_mode value to determine pair device speed  Use the current PIO mode value instead of the physical maximum one of the pair device on the port to determine PIO commmand timings used for both devices on the port.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-disk.h | s | 666B | 24 | Al Viro | viro@zeniv.linux.org.uk | 1224589650 |  | [PATCH] switch ide_disk_ops ->ioctl() to sane prototype  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | Kconfig | g | 29K |  | Linus Torvalds | torvalds@linux-foundation.org | 1320352094 |  | Merge branch 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus  * 'upstream' of git://git.linux-mips.org/pub/scm/ralf/upstream-linus: (37 commits)   MIPS: O32: Provide definition of registers ta0 .. ta3.   MIPS: perf: Add Octeon support for hardware perf.   MIPS: perf: Add support for 64-bit perf counters.   MIPS: perf: Reorganize contents of perf support files.   MIPS: perf: Cleanup formatting in arch/mips/kernel/perf_event.c   MIPS: Add accessor macros for 64-bit performance counter registers.   MIPS: Add probes for more Octeon II CPUs.   MIPS: Add more CPU identifiers for Octeon II CPUs.   MIPS: XLR, XLS: Add comment for smp setup   MIPS: JZ4740: GPIO: Check correct IRQ in demux handler   MIPS: JZ4740: GPIO: Simplify IRQ demuxer   MIPS: JZ4740: Use generic irq chip   MIPS: Alchemy: remove all CONFIG_SOC_AU1??? defines   MIPS: Alchemy: kill au1xxx.h header   MIPS: Alchemy: clean DMA code of CONFIG_SOC_AU1??? defines   MIPS, IDE: Alchem, au1xxx-ide: Remove pb1200/db1200 header dep   MIPS: Alchemy: Redo PCI as platform driver   MIPS: Alchemy: more base address cleanup   MIPS: Alchemy: rewrite USB platform setup.   MIPS: Alchemy: abstract USB block control register access   ...  Fix up trivial conflicts in: 	arch/mips/alchemy/devboards/db1x00/platform.c 	drivers/ide/Kconfig 	drivers/mmc/host/au1xmmc.c 	drivers/video/Kconfig 	sound/mips/Kconfig
f | pmac.c | s | 45K | 1521 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide_platform.c | s | 3.5K | 123 | Thomas Gleixner | tglx@linutronix.de | 1312446591 |  | ide: Fix irq flags madness  commit ec1a123 (IDE: pass IRQ flags to the IDE core) introduced the bogosity of passing unfiltered resource->flags to the irq_flags which are used for request_irq. It results in random bits set (especially IORESOURCE_IRQ which maps to IRQF_PER_CPU).  Filter the bits proper.  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cs5536.c | s | 7.7K | 255 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894753 |  | cs5536: use ->pio_mode value to determine pair device speed  Use the current PIO mode value instead of the physical maximum one of the pair device on the port to determine PIO commmand timings used for both devices on the port.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | buddha.c | s | 5.6K | 186 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add module.h to the implicit modular users  A pending cleanup will mean that module.h won't be implicitly everywhere anymore.  Make sure the modular drivers in the ide dir are actually calling out for <module.h> explicitly in advance.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-proc.c | s | 19K | 677 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | ide-scan-pci.c | s | 2.7K | 95 | Thiago Farina | tfransosi@gmail.com | 1305581086 |  | ide/ide-scan-pci.c: Use for_each_pci_dev().  Use for_each_pci_dev() to simplify the code.  Signed-off-by: Thiago Farina <tfransosi@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-dma-sff.c | s | 8.9K | 282 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | hpt366.c | s | 42K | 1351 | Sergei Shtylyov | sshtylyov@ru.mvista.com | 1288113449 |  | hpt366: fix clock turnaround  DPLL clock (0x21) should be used for writes and PCI clock (0x23) for reads, not vice versa.  Signed-off-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ht6560b.c | s | 10K | 323 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | cs5535.c | s | 6.2K | 182 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894753 |  | cs5535: use ->pio_mode value to determine pair device speed  Use the current PIO mode value instead of the physical maximum one of the pair device on the port to determine PIO commmand timings used for both devices on the port.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ide-floppy.h | s | 1.1K | 32 | Al Viro | viro@zeniv.linux.org.uk | 1224589650 |  | [PATCH] switch ide_disk_ops ->ioctl() to sane prototype  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | ide-taskfile.c | s | 16K | 562 | Cong Wang | amwang@redhat.com | 1332251297 |  | ide: remove the second argument of k[un]map_atomic()  Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Cong Wang <amwang@redhat.com>
f | palm_bk3710.c | s | 10K | 334 | Joe Perches | joe@perches.com | 1307710536 |  | treewide: Convert uses of struct resource to resource_size(ptr)  Several fixes as well where the +1 was missing.  Done via coccinelle scripts like:  @@ struct resource *ptr; @@  - ptr->end - ptr->start + 1 + resource_size(ptr)  and some grep and typing.  Mostly uncompiled, no cross-compilers.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | ide-eh.c | s | 12K | 378 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-legacy.c | s | 1.3K | 47 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ide-floppy.c | s | 14K | 450 | Geert Uytterhoeven | geert@linux-m68k.org | 1320788146 |  | ide-{cd,floppy,tape}: Do not include <linux/irq.h>  The top of <linux/irq.h> has this comment:   * Please do not include this file in generic code.  There is currently  * no requirement for any architecture to implement anything held  * within this file.  *  * Thanks. --rmk  Remove inclusion of <linux/irq.h>, to prevent the following compile error from happening soon:  || include/linux/irq.h:132: error: redefinition of ‘struct irq_data’ || include/linux/irq.h:286: error: redefinition of ‘struct irq_chip’  Signed-off-by: Geert Uytterhoeven <geert@linux-m68k.org> Acked-by: Thomas Gleixner <tglx@linutronix.de> Acked-by: Borislav Petkov <bp@alien8.de> Cc: linux-ide@vger.kernel.org
f | ide-disk_ioctl.c | s | 957B | 27 | Arnd Bergmann | arnd@arndb.de | 1286283670 |  | block: autoconvert trivial BKL users to private mutex  The block device drivers have all gained new lock_kernel calls from a recent pushdown, and some of the drivers were already using the BKL before.  This turns the BKL into a set of per-driver mutexes. Still need to check whether this is safe to do.  file=$1 name=$2 if grep -q lock_kernel ${file} ; then     if grep -q 'include.*linux.mutex.h' ${file} ; then             sed -i '/include.*<linux\/smp_lock.h>/d' ${file}     else             sed -i 's/include.*<linux\/smp_lock.h>.*$/include <linux\/mutex.h>/g' ${file}     fi     sed -i ${file} \         -e "/^#include.*linux.mutex.h/,$ {                 1,/^\(static\||int\||long\)/ {                      /^\(static\||int\||long\)/istatic DEFINE_MUTEX(${name}_mutex);  } }"  \     -e "s/\(un\)*lock_kernel\>[ ]*()/mutex_\1lock(\&${name}_mutex)/g" \     -e '/[      ]*cycle_kernel_lock();/d' else     sed -i -e '/include.*\<smp_lock.h\>/d' ${file}  \                 -e '/cycle_kernel_lock()/d' fi  Signed-off-by: Arnd Bergmann <arnd@arndb.de>
f | sgiioc4.c | s | 16K | 523 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-probe.c | s | 37K | 1316 | Wolfram Sang | w.sang@pengutronix.de | 1284438865 |  | ide: Fix ordering of procfs registry.  We must ensure that ide_proc_port_register_devices() occurs on an interface before ide_proc_register_driver() executes for that interfaces drives.  Therefore defer the registry of the driver device objects backed by ide_bus_type until after ide_proc_port_register_devices() has run and thus all of the drive->proc procfs directory pointers have been setup.  Signed-off-by: Wolfram Sang <w.sang@pengutronix.de> Signed-off-by: David S. Miller <davem@davemloft.net>
f | icside.c | s | 16K | 565 | Christian Dietrich | christian.dietrich@informatik.uni-erlangen.de | 1339004207 |  | ide: icside.c: fix printk format string compile warning  Use correct format string parameter for the peak datarate, and prevent uninitialized use of cycle_time.  Signed-off-by: Christian Dietrich <christian.dietrich@informatik.uni-erlangen.de> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cs5530.c | s | 8.2K | 252 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ns87415.c | s | 9.0K | 291 | Sergei Shtylyov | sshtylyov@ru.mvista.com | 1239192783 |  | ide: refactor tf_read() method  Simplify tf_read() method, making it deal only with 'struct ide_taskfile' and the validity flags that the upper layer passes, and factoring out the code that deals with the high order bytes into ide_tf_readback() to be called from the only two functions interested, ide_complete_cmd() and ide_dump_sector().  This should stop the needless code duplication in this method and so make it about twice smaller than it was; along with simplifying the setup for the method call, this should save both time and space...  Signed-off-by: Sergei Shtylyov <sshtylyov@ru.mvista.com> Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-lib.c | s | 4.4K | 150 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | sl82c105.c | s | 9.5K | 308 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | pdc202xx_new.c | s | 14K | 474 | Bartlomiej Zolnierkiewicz | bzolnier@gmail.com | 1263894329 |  | ide: change ->set_dma_mode method parameters  Change ->set_dma_mode method parameters to match ->set_dmamode method used in struct ata_port_operations.  Signed-off-by: Bartlomiej Zolnierkiewicz <bzolnier@gmail.com>
f | ide-cd.h | s | 3.5K | 105 | Tejun Heo | tj@kernel.org | 1299696867 |  | ide: Convert to bdops->check_events()  Convert ->media_changed() to the new ->check_events() method.  The conversion is mostly mechanical.  The only notable change is that cdrom now doesn't generate any event if @slot_nr isn't CDSL_CURRENT. It used to return -EINVAL which would be treated as media changed.  As media changer isn't supported anyway, this doesn't make any difference.  This makes ide emit the standard disk events and allows kernel event polling.  Currently, only MEDIA_CHANGE event is implemented.  Adding support for EJECT_REQUEST shouldn't be difficult; however, given that ide driver is already deprecated, it probably is best to leave it alone.  Signed-off-by: Tejun Heo <tj@kernel.org> Acked-by: Jens Axboe <axboe@kernel.dk> Cc: Kay Sievers <kay.sievers@vrfy.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: linux-ide@vger.kernel.org
f | ali14xx.c | s | 6.5K | 218 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | setup-pci.c | s | 16K | 561 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103897 |  | ide/ata: Add export.h for EXPORT_SYMBOL/THIS_MODULE where needed  They were getting this implicitly by an include of module.h from device.h -- but we are going to clean that up and break that include chain, so include export.h explicitly now.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
