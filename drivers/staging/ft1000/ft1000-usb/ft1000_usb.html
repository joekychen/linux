<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › ft1000 › ft1000-usb › ft1000_usb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ft1000_usb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _FT1000_USB_H_</span>
<span class="cp">#define _FT1000_USB_H_</span>

<span class="cm">/*Jim*/</span>
<span class="cp">#include &quot;../ft1000.h&quot;</span>
<span class="cp">#include &quot;ft1000_ioctl.h&quot;</span>
<span class="cp">#define FT1000_DRV_VER      0x01010403</span>

<span class="cp">#define  MAX_NUM_APP         6</span>
<span class="cp">#define  MAX_MSG_LIMIT       200</span>
<span class="cp">#define  NUM_OF_FREE_BUFFERS 1500</span>

<span class="cp">#define PSEUDOSZ                16</span>

<span class="cp">#define  SUCCESS             0x00</span>

<span class="k">struct</span> <span class="n">app_info_block</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">nTxMsg</span><span class="p">;</span>                    <span class="c1">// DPRAM msg sent to DSP with app_id</span>
	<span class="n">u32</span> <span class="n">nRxMsg</span><span class="p">;</span>                    <span class="c1">// DPRAM msg rcv from dsp with app_id</span>
	<span class="n">u32</span> <span class="n">nTxMsgReject</span><span class="p">;</span>              <span class="c1">// DPRAM msg rejected due to DSP doorbell set</span>
	<span class="n">u32</span> <span class="n">nRxMsgMiss</span><span class="p">;</span>                <span class="c1">// DPRAM msg dropped due to overflow</span>
	<span class="k">struct</span> <span class="n">fown_struct</span> <span class="o">*</span><span class="n">fileobject</span><span class="p">;</span><span class="c1">// Application&#39;s file object</span>
	<span class="n">u16</span> <span class="n">app_id</span><span class="p">;</span>                    <span class="c1">// Application id</span>
	<span class="kt">int</span> <span class="n">DspBCMsgFlag</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">NumOfMsg</span><span class="p">;</span>                   <span class="c1">// number of messages queued up</span>
	<span class="n">wait_queue_head_t</span> <span class="n">wait_dpram_msg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">app_sqlist</span><span class="p">;</span>   <span class="c1">// link list of msgs for applicaton on slow queue</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/*end of Jim*/</span>
<span class="cp">#define DEBUG(args...) printk(KERN_INFO args)</span>

<span class="cp">#define FALSE           0</span>
<span class="cp">#define TRUE            1</span>

<span class="cp">#define STATUS_SUCCESS  0</span>
<span class="cp">#define STATUS_FAILURE   0x1001</span>

<span class="cp">#define FT1000_STATUS_CLOSING  0x01</span>

<span class="cp">#define LARGE_TIMEOUT   5000</span>

<span class="cp">#define DSPBCMSGID              0x10</span>

<span class="cm">/* Electrabuzz specific DPRAM mapping */</span>
<span class="cm">/* this is used by ft1000_usb driver - isn&#39;t that a bug? */</span>
<span class="cp">#undef FT1000_DPRAM_RX_BASE</span>
<span class="cp">#define FT1000_DPRAM_RX_BASE	0x1800	</span><span class="cm">/* RX AREA (SlowQ) */</span><span class="cp"></span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>MEMORY MAP FOR MAGNEMITE</p></td><td class="code"><div class="highlight"><pre><span class="cm">/* the indexes are swapped comparing to PCMCIA - is it OK or a bug? */</span>
<span class="cp">#undef FT1000_MAG_DSP_LED_INDX</span>
<span class="cp">#define FT1000_MAG_DSP_LED_INDX		0x1	</span><span class="cm">/* dsp led status for PAD device */</span><span class="cp"></span>
<span class="cp">#undef FT1000_MAG_DSP_CON_STATE_INDX</span>
<span class="cp">#define FT1000_MAG_DSP_CON_STATE_INDX	0x0	</span><span class="cm">/* DSP Connection Status Info */</span><span class="cp"></span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Maximum times trying to get ASIC out of reset</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define MAX_ASIC_RESET_CNT      20</span>

<span class="cp">#define MAX_BUF_SIZE            4096</span>

<span class="k">struct</span> <span class="n">ft1000_device</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">net</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span><span class="n">rx_urb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span><span class="n">tx_urb</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">tx_buf</span><span class="p">[</span><span class="n">MAX_BUF_SIZE</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">rx_buf</span><span class="p">[</span><span class="n">MAX_BUF_SIZE</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">bulk_in_endpointAddr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bulk_out_endpointAddr</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>struct ft1000<em>ethernet</em>configuration configuration;</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>struct net<em>device</em>stats stats; //mbelian</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ft1000_debug_dirs</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">int_number</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ft1000_info</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">pFt1000Dev</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>

    <span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">pPollThread</span><span class="p">;</span>

    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">fcodeldr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bootmode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">usbboot</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dspalive</span><span class="p">;</span>
    <span class="n">u16</span> <span class="n">ASIC_ID</span><span class="p">;</span>
    <span class="n">bool</span> <span class="n">fProvComplete</span><span class="p">;</span>
    <span class="n">bool</span> <span class="n">fCondResetPend</span><span class="p">;</span>
    <span class="n">bool</span> <span class="n">fAppMsgPend</span><span class="p">;</span>
    <span class="n">u16</span> <span class="n">DrvErrNum</span><span class="p">;</span>
    <span class="n">u16</span> <span class="n">AsicID</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">DspAsicReset</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">DeviceCreated</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">CardReady</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">NetDevRegDone</span><span class="p">;</span>
    <span class="n">u8</span> <span class="n">CardNumber</span><span class="p">;</span>
    <span class="n">u8</span> <span class="n">DeviceName</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">ft1000_debug_dirs</span> <span class="n">nodes</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">registered</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">mediastate</span><span class="p">;</span>
    <span class="n">u8</span> <span class="n">squeseqnum</span><span class="p">;</span>                 <span class="c1">// sequence number on slow queue</span>
    <span class="n">spinlock_t</span> <span class="n">dpram_lock</span><span class="p">;</span>
    <span class="n">spinlock_t</span> <span class="n">fifo_lock</span><span class="p">;</span>
    <span class="n">u16</span> <span class="n">fifo_cnt</span><span class="p">;</span>
    <span class="n">u8</span> <span class="n">DspVer</span><span class="p">[</span><span class="n">DSPVERSZ</span><span class="p">];</span>        <span class="c1">// DSP version number</span>
    <span class="n">u8</span> <span class="n">HwSerNum</span><span class="p">[</span><span class="n">HWSERNUMSZ</span><span class="p">];</span>    <span class="c1">// Hardware Serial Number</span>
    <span class="n">u8</span> <span class="n">Sku</span><span class="p">[</span><span class="n">SKUSZ</span><span class="p">];</span>              <span class="c1">// SKU</span>
    <span class="n">u8</span> <span class="n">eui64</span><span class="p">[</span><span class="n">EUISZ</span><span class="p">];</span>            <span class="c1">// EUI64</span>
    <span class="kt">time_t</span> <span class="n">ConTm</span><span class="p">;</span>               <span class="c1">// Connection Time</span>
    <span class="n">u8</span> <span class="n">ProductMode</span><span class="p">[</span><span class="n">MODESZ</span><span class="p">];</span>
    <span class="n">u8</span> <span class="n">RfCalVer</span><span class="p">[</span><span class="n">CALVERSZ</span><span class="p">];</span>
    <span class="n">u8</span> <span class="n">RfCalDate</span><span class="p">[</span><span class="n">CALDATESZ</span><span class="p">];</span>
    <span class="n">u16</span> <span class="n">DSP_TIME</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">u16</span> <span class="n">LedStat</span><span class="p">;</span>	<span class="c1">//mbelian</span>
    <span class="n">u16</span> <span class="n">ConStat</span><span class="p">;</span>	<span class="c1">//mbelian</span>
    <span class="n">u16</span> <span class="n">ProgConStat</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">list_head</span> <span class="n">prov_list</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">appcnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">app_info_block</span> <span class="n">app_info</span><span class="p">[</span><span class="n">MAX_NUM_APP</span><span class="p">];</span>
    <span class="n">u16</span> <span class="n">DSPInfoBlklen</span><span class="p">;</span>
    <span class="n">u16</span> <span class="n">DrvMsgPend</span><span class="p">;</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ft1000_reset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">u16</span> <span class="n">DSPInfoBlk</span><span class="p">[</span><span class="n">MAX_DSP_SESS_REC</span><span class="p">];</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="n">u16</span> <span class="n">Rec</span><span class="p">[</span><span class="n">MAX_DSP_SESS_REC</span><span class="p">];</span>
        <span class="n">u32</span> <span class="n">MagRec</span><span class="p">[</span><span class="n">MAX_DSP_SESS_REC</span><span class="o">/</span><span class="mi">2</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">DSPSess</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tempbuf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">netdevname</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">ft1000_proc_dir</span><span class="p">;</span> <span class="c1">//mbelian</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">dpram_blk</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
    <span class="n">u16</span> <span class="o">*</span><span class="n">pbuffer</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="kt">int</span> <span class="n">ft1000_read_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span><span class="o">*</span> <span class="n">Data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">nRegIndx</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_write_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="n">u16</span> <span class="n">nRegIndx</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_read_dpram32</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u16</span> <span class="n">cnt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_write_dpram32</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u16</span> <span class="n">cnt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_read_dpram16</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u8</span> <span class="n">highlow</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_write_dpram16</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="n">u8</span> <span class="n">highlow</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">fix_ft1000_read_dpram32</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">fix_ft1000_write_dpram32</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">indx</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pFileStart</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">size_t</span> <span class="n">FileLength</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">numofmsgbuf</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">ft1000_close</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="n">u16</span> <span class="n">scram_dnldr</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">pFileStart</span><span class="p">,</span> <span class="n">u32</span>  <span class="n">FileLength</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="n">freercvpool</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">spinlock_t</span> <span class="n">free_buff_lock</span><span class="p">;</span>   <span class="c1">// lock to arbitrate free buffer list for receive command data</span>

<span class="kt">int</span> <span class="n">ft1000_create_dev</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ft1000_destroy_dev</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">card_send_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptempbuffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">dpram_blk</span> <span class="o">*</span><span class="n">ft1000_get_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">bufflist</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ft1000_free_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">dpram_blk</span> <span class="o">*</span><span class="n">pdpram_blk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">plist</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">dsp_reload</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">init_ft1000_netdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">usb_interface</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">reg_ft1000_netdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_device</span> <span class="o">*</span><span class="n">ft1000dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ft1000_poll</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">dev_id</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ft1000_init_proc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ft1000_cleanup_proc</span><span class="p">(</span><span class="k">struct</span> <span class="n">ft1000_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>



<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
