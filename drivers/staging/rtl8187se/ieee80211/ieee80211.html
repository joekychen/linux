<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8187se › ieee80211 › ieee80211.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ieee80211.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Merged with mainline ieee80211.h in Aug 2004.  Original ieee802_11</span>
<span class="cm"> * remains copyright by the original authors</span>
<span class="cm"> *</span>
<span class="cm"> * Portions of the merged code are based on Host AP (software wireless</span>
<span class="cm"> * LAN access point) driver for Intersil Prism2/2.5/3.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2001-2002, SSH Communications Security Corp and Jouni Malinen</span>
<span class="cm"> * &lt;jkmaline@cc.hut.fi&gt;</span>
<span class="cm"> * Copyright (c) 2002-2003, Jouni Malinen &lt;jkmaline@cc.hut.fi&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Adaption to a generic IEEE 802.11 stack by James Ketrenos</span>
<span class="cm"> * &lt;jketreno@linux.intel.com&gt;</span>
<span class="cm"> * Copyright (c) 2004, Intel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Modified for Realtek&#39;s wi-fi cards by Andrea Merello</span>
<span class="cm"> * &lt;andreamrl@tiscali.it&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation. See README and COPYING for</span>
<span class="cm"> * more details.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef IEEE80211_H</span>
<span class="cp">#define IEEE80211_H</span>
<span class="cp">#include &lt;linux/if_ether.h&gt; </span><span class="cm">/* ETH_ALEN */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/kernel.h&gt;   </span><span class="cm">/* ARRAY_SIZE */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/jiffies.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/semaphore.h&gt;</span>
<span class="cp">#include &lt;linux/wireless.h&gt;</span>
<span class="cp">#include &lt;linux/ieee80211.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>

<span class="cp">#define KEY_TYPE_NA		0x0</span>
<span class="cp">#define KEY_TYPE_WEP40 		0x1</span>
<span class="cp">#define KEY_TYPE_TKIP		0x2</span>
<span class="cp">#define KEY_TYPE_CCMP		0x4</span>
<span class="cp">#define KEY_TYPE_WEP104		0x5</span>

<span class="cp">#define aSifsTime					10</span>

<span class="cp">#define MGMT_QUEUE_NUM 5</span>


<span class="cp">#define IEEE_CMD_SET_WPA_PARAM			1</span>
<span class="cp">#define	IEEE_CMD_SET_WPA_IE			2</span>
<span class="cp">#define IEEE_CMD_SET_ENCRYPTION			3</span>
<span class="cp">#define IEEE_CMD_MLME				4</span>

<span class="cp">#define IEEE_PARAM_WPA_ENABLED			1</span>
<span class="cp">#define IEEE_PARAM_TKIP_COUNTERMEASURES		2</span>
<span class="cp">#define IEEE_PARAM_DROP_UNENCRYPTED		3</span>
<span class="cp">#define IEEE_PARAM_PRIVACY_INVOKED		4</span>
<span class="cp">#define IEEE_PARAM_AUTH_ALGS			5</span>
<span class="cp">#define IEEE_PARAM_IEEE_802_1X			6</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>It should consistent with the driver_XXX.c
  David, 2006.9.26</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE_PARAM_WPAX_SELECT			7</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Added for notify the encryption type selection
  David, 2006.9.26</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE_PROTO_WPA				1</span>
<span class="cp">#define IEEE_PROTO_RSN				2</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Added for notify the encryption type selection
  David, 2006.9.26</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE_WPAX_USEGROUP			0</span>
<span class="cp">#define IEEE_WPAX_WEP40				1</span>
<span class="cp">#define IEEE_WPAX_TKIP				2</span>
<span class="cp">#define IEEE_WPAX_WRAP   			3</span>
<span class="cp">#define IEEE_WPAX_CCMP				4</span>
<span class="cp">#define IEEE_WPAX_WEP104			5</span>

<span class="cp">#define IEEE_KEY_MGMT_IEEE8021X			1</span>
<span class="cp">#define IEEE_KEY_MGMT_PSK			2</span>



<span class="cp">#define IEEE_MLME_STA_DEAUTH			1</span>
<span class="cp">#define IEEE_MLME_STA_DISASSOC			2</span>


<span class="cp">#define IEEE_CRYPT_ERR_UNKNOWN_ALG		2</span>
<span class="cp">#define IEEE_CRYPT_ERR_UNKNOWN_ADDR		3</span>
<span class="cp">#define IEEE_CRYPT_ERR_CRYPT_INIT_FAILED		4</span>
<span class="cp">#define IEEE_CRYPT_ERR_KEY_SET_FAILED		5</span>
<span class="cp">#define IEEE_CRYPT_ERR_TX_KEY_SET_FAILED		6</span>
<span class="cp">#define IEEE_CRYPT_ERR_CARD_CONF_FAILED		7</span>


<span class="cp">#define	IEEE_CRYPT_ALG_NAME_LEN			16</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>by amy for ps</p></td><td class="code"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">ieee_param</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sta_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
        <span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span> <span class="n">name</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">value</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">wpa_param</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">len</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
			<span class="n">u8</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">wpa_ie</span><span class="p">;</span>
	        <span class="k">struct</span><span class="p">{</span>
			<span class="kt">int</span> <span class="n">command</span><span class="p">;</span>
    			<span class="kt">int</span> <span class="n">reason_code</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">mlme</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span> <span class="n">alg</span><span class="p">[</span><span class="n">IEEE_CRYPT_ALG_NAME_LEN</span><span class="p">];</span>
			<span class="n">u8</span> <span class="n">set_tx</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">idx</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">seq</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* sequence counter (set: RX, get: TX) */</span>
			<span class="n">u16</span> <span class="n">key_len</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">crypt</span><span class="p">;</span>

	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">}</span><span class="n">ieee_param</span><span class="p">;</span>


<span class="cp">#define MSECS(t) msecs_to_jiffies(t)</span>
<span class="cp">#define msleep_interruptible_rtl  msleep_interruptible</span>

<span class="cp">#define IEEE80211_DATA_LEN		2304</span>
<span class="cm">/* Maximum size for the MA-UNITDATA primitive, 802.11 standard section</span>
<span class="cm">   6.2.1.1.2.</span>

<span class="cm">   The figure in section 7.1.2 suggests a body size of up to 2312</span>
<span class="cm">   bytes is allowed, which is a bit confusing, I suspect this</span>
<span class="cm">   represents the 2304 bytes of real data, plus a possible 8 bytes of</span>
<span class="cm">   WEP IV and ICV. (this interpretation suggested by Ramiro Barreiro) */</span>

<span class="cp">#define IEEE80211_3ADDR_LEN 24</span>
<span class="cp">#define IEEE80211_4ADDR_LEN 30</span>
<span class="cp">#define IEEE80211_FCS_LEN    4</span>
<span class="cp">#define IEEE80211_HLEN			IEEE80211_4ADDR_LEN</span>
<span class="cp">#define IEEE80211_FRAME_LEN		(IEEE80211_DATA_LEN + IEEE80211_HLEN)</span>
<span class="cp">#define IEEE80211_MGMT_HDR_LEN 24</span>
<span class="cp">#define IEEE80211_DATA_HDR3_LEN 24</span>
<span class="cp">#define IEEE80211_DATA_HDR4_LEN 30</span>

<span class="cp">#define MIN_FRAG_THRESHOLD     256U</span>
<span class="cp">#define	MAX_FRAG_THRESHOLD     2346U</span>

<span class="cm">/* Frame control field constants */</span>
<span class="cp">#define IEEE80211_FCTL_DSTODS		0x0300 </span><span class="c1">//added by david</span>
<span class="cp">#define IEEE80211_FCTL_WEP		0x4000</span>

<span class="cm">/* debug macros */</span>

<span class="cp">#ifdef CONFIG_IEEE80211_DEBUG</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">ieee80211_debug_level</span><span class="p">;</span>
<span class="cp">#define IEEE80211_DEBUG(level, fmt, args...) \</span>
<span class="cp">do { if (ieee80211_debug_level &amp; (level)) \</span>
<span class="cp">  printk(KERN_DEBUG &quot;ieee80211: %c %s &quot; fmt, \</span>
<span class="cp">         in_interrupt() ? &#39;I&#39; : &#39;U&#39;, __func__ , ## args); } while (0)</span>
<span class="cp">#else</span>
<span class="cp">#define IEEE80211_DEBUG(level, fmt, args...) do {} while (0)</span>
<span class="cp">#endif	</span><span class="cm">/* CONFIG_IEEE80211_DEBUG */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * To use the debug system;</span>
<span class="cm"> *</span>
<span class="cm"> * If you are defining a new debug classification, simply add it to the #define</span>
<span class="cm"> * list here in the form of:</span>
<span class="cm"> *</span>
<span class="cm"> * #define IEEE80211_DL_xxxx VALUE</span>
<span class="cm"> *</span>
<span class="cm"> * shifting value to the left one bit from the previous entry.  xxxx should be</span>
<span class="cm"> * the name of the classification (for example, WEP)</span>
<span class="cm"> *</span>
<span class="cm"> * You then need to either add a IEEE80211_xxxx_DEBUG() macro definition for your</span>
<span class="cm"> * classification, or use IEEE80211_DEBUG(IEEE80211_DL_xxxx, ...) whenever you want</span>
<span class="cm"> * to send output to that classification.</span>
<span class="cm"> *</span>
<span class="cm"> * To add your debug level to the list of levels seen when you perform</span>
<span class="cm"> *</span>
<span class="cm"> * % cat /proc/net/ipw/debug_level</span>
<span class="cm"> *</span>
<span class="cm"> * you simply need to add your entry to the ipw_debug_levels array.</span>
<span class="cm"> *</span>
<span class="cm"> * If you do not see debug_level in /proc/net/ipw then you do not have</span>
<span class="cm"> * CONFIG_IEEE80211_DEBUG defined in your kernel configuration</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define IEEE80211_DL_INFO          (1&lt;&lt;0)</span>
<span class="cp">#define IEEE80211_DL_WX            (1&lt;&lt;1)</span>
<span class="cp">#define IEEE80211_DL_SCAN          (1&lt;&lt;2)</span>
<span class="cp">#define IEEE80211_DL_STATE         (1&lt;&lt;3)</span>
<span class="cp">#define IEEE80211_DL_MGMT          (1&lt;&lt;4)</span>
<span class="cp">#define IEEE80211_DL_FRAG          (1&lt;&lt;5)</span>
<span class="cp">#define IEEE80211_DL_EAP           (1&lt;&lt;6)</span>
<span class="cp">#define IEEE80211_DL_DROP          (1&lt;&lt;7)</span>

<span class="cp">#define IEEE80211_DL_TX            (1&lt;&lt;8)</span>
<span class="cp">#define IEEE80211_DL_RX            (1&lt;&lt;9)</span>

<span class="cp">#define IEEE80211_ERROR(f, a...) printk(KERN_ERR &quot;ieee80211: &quot; f, ## a)</span>
<span class="cp">#define IEEE80211_WARNING(f, a...) printk(KERN_WARNING &quot;ieee80211: &quot; f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_INFO(f, a...)   IEEE80211_DEBUG(IEEE80211_DL_INFO, f, ## a)</span>

<span class="cp">#define IEEE80211_DEBUG_WX(f, a...)     IEEE80211_DEBUG(IEEE80211_DL_WX, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_SCAN(f, a...)   IEEE80211_DEBUG(IEEE80211_DL_SCAN, f, ## a)</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><h1>define IEEE<em>DEBUG</em>SCAN  IEEE80211_WARNING</h1></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE80211_DEBUG_STATE(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_STATE, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_MGMT(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_MGMT, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_FRAG(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_FRAG, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_EAP(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_EAP, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_DROP(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_DROP, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_TX(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_TX, f, ## a)</span>
<span class="cp">#define IEEE80211_DEBUG_RX(f, a...)  IEEE80211_DEBUG(IEEE80211_DL_RX, f, ## a)</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/if_arp.h&gt; </span><span class="cm">/* ARPHRD_ETHER */</span><span class="cp"></span>

<span class="cp">#ifndef WIRELESS_SPY</span>
<span class="cp">#define WIRELESS_SPY		</span><span class="c1">// enable iwspy support</span>
<span class="cp">#endif</span>
<span class="cp">#include &lt;net/iw_handler.h&gt;	</span><span class="c1">// new driver API</span>

<span class="cp">#ifndef ETH_P_PAE</span>
<span class="cp">#define ETH_P_PAE 0x888E </span><span class="cm">/* Port Access Entity (IEEE 802.1X) */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* ETH_P_PAE */</span><span class="cp"></span>

<span class="cp">#define ETH_P_PREAUTH 0x88C7 </span><span class="cm">/* IEEE 802.11i pre-authentication */</span><span class="cp"></span>

<span class="cp">#ifndef ETH_P_80211_RAW</span>
<span class="cp">#define ETH_P_80211_RAW (ETH_P_ECONET + 1)</span>
<span class="cp">#endif</span>

<span class="cm">/* IEEE 802.11 defines */</span>

<span class="cp">#define P80211_OUI_LEN 3</span>

<span class="k">struct</span> <span class="n">ieee80211_snap_hdr</span> <span class="p">{</span>

        <span class="n">u8</span>    <span class="n">dsap</span><span class="p">;</span>   <span class="cm">/* always 0xAA */</span>
        <span class="n">u8</span>    <span class="n">ssap</span><span class="p">;</span>   <span class="cm">/* always 0xAA */</span>
        <span class="n">u8</span>    <span class="n">ctrl</span><span class="p">;</span>   <span class="cm">/* always 0x03 */</span>
        <span class="n">u8</span>    <span class="n">oui</span><span class="p">[</span><span class="n">P80211_OUI_LEN</span><span class="p">];</span>    <span class="cm">/* organizational universal id */</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define SNAP_SIZE sizeof(struct ieee80211_snap_hdr)</span>

<span class="cp">#define WLAN_FC_GET_TYPE(fc) ((fc) &amp; IEEE80211_FCTL_FTYPE)</span>
<span class="cp">#define WLAN_FC_GET_STYPE(fc) ((fc) &amp; IEEE80211_FCTL_STYPE)</span>

<span class="cp">#define WLAN_GET_SEQ_FRAG(seq) ((seq) &amp; IEEE80211_SCTL_FRAG)</span>
<span class="cp">#define WLAN_GET_SEQ_SEQ(seq)  ((seq) &amp; IEEE80211_SCTL_SEQ)</span>

<span class="cp">#define WLAN_CAPABILITY_BSS (1&lt;&lt;0)</span>
<span class="cp">#define WLAN_CAPABILITY_SHORT_SLOT (1&lt;&lt;10)</span>

<span class="cp">#define IEEE80211_STATMASK_SIGNAL (1&lt;&lt;0)</span>
<span class="cp">#define IEEE80211_STATMASK_RSSI (1&lt;&lt;1)</span>
<span class="cp">#define IEEE80211_STATMASK_NOISE (1&lt;&lt;2)</span>
<span class="cp">#define IEEE80211_STATMASK_RATE (1&lt;&lt;3)</span>
<span class="cp">#define IEEE80211_STATMASK_WEMASK 0x7</span>


<span class="cp">#define IEEE80211_CCK_MODULATION    (1&lt;&lt;0)</span>
<span class="cp">#define IEEE80211_OFDM_MODULATION   (1&lt;&lt;1)</span>

<span class="cp">#define IEEE80211_24GHZ_BAND     (1&lt;&lt;0)</span>
<span class="cp">#define IEEE80211_52GHZ_BAND     (1&lt;&lt;1)</span>

<span class="cp">#define IEEE80211_CCK_RATE_LEN  		4</span>
<span class="cp">#define IEEE80211_CCK_RATE_1MB		        0x02</span>
<span class="cp">#define IEEE80211_CCK_RATE_2MB		        0x04</span>
<span class="cp">#define IEEE80211_CCK_RATE_5MB		        0x0B</span>
<span class="cp">#define IEEE80211_CCK_RATE_11MB		        0x16</span>
<span class="cp">#define IEEE80211_OFDM_RATE_LEN 		8</span>
<span class="cp">#define IEEE80211_OFDM_RATE_6MB		        0x0C</span>
<span class="cp">#define IEEE80211_OFDM_RATE_9MB		        0x12</span>
<span class="cp">#define IEEE80211_OFDM_RATE_12MB		0x18</span>
<span class="cp">#define IEEE80211_OFDM_RATE_18MB		0x24</span>
<span class="cp">#define IEEE80211_OFDM_RATE_24MB		0x30</span>
<span class="cp">#define IEEE80211_OFDM_RATE_36MB		0x48</span>
<span class="cp">#define IEEE80211_OFDM_RATE_48MB		0x60</span>
<span class="cp">#define IEEE80211_OFDM_RATE_54MB		0x6C</span>
<span class="cp">#define IEEE80211_BASIC_RATE_MASK		0x80</span>

<span class="cp">#define IEEE80211_CCK_RATE_1MB_MASK		(1&lt;&lt;0)</span>
<span class="cp">#define IEEE80211_CCK_RATE_2MB_MASK		(1&lt;&lt;1)</span>
<span class="cp">#define IEEE80211_CCK_RATE_5MB_MASK		(1&lt;&lt;2)</span>
<span class="cp">#define IEEE80211_CCK_RATE_11MB_MASK		(1&lt;&lt;3)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_6MB_MASK		(1&lt;&lt;4)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_9MB_MASK		(1&lt;&lt;5)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_12MB_MASK		(1&lt;&lt;6)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_18MB_MASK		(1&lt;&lt;7)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_24MB_MASK		(1&lt;&lt;8)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_36MB_MASK		(1&lt;&lt;9)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_48MB_MASK		(1&lt;&lt;10)</span>
<span class="cp">#define IEEE80211_OFDM_RATE_54MB_MASK		(1&lt;&lt;11)</span>

<span class="cp">#define IEEE80211_CCK_RATES_MASK	        0x0000000F</span>
<span class="cp">#define IEEE80211_CCK_BASIC_RATES_MASK	(IEEE80211_CCK_RATE_1MB_MASK | \</span>
<span class="cp">	IEEE80211_CCK_RATE_2MB_MASK)</span>
<span class="cp">#define IEEE80211_CCK_DEFAULT_RATES_MASK	(IEEE80211_CCK_BASIC_RATES_MASK | \</span>
<span class="cp">        IEEE80211_CCK_RATE_5MB_MASK | \</span>
<span class="cp">        IEEE80211_CCK_RATE_11MB_MASK)</span>

<span class="cp">#define IEEE80211_OFDM_RATES_MASK		0x00000FF0</span>
<span class="cp">#define IEEE80211_OFDM_BASIC_RATES_MASK	(IEEE80211_OFDM_RATE_6MB_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_12MB_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_24MB_MASK)</span>
<span class="cp">#define IEEE80211_OFDM_DEFAULT_RATES_MASK	(IEEE80211_OFDM_BASIC_RATES_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_9MB_MASK  | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_18MB_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_36MB_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_48MB_MASK | \</span>
<span class="cp">	IEEE80211_OFDM_RATE_54MB_MASK)</span>
<span class="cp">#define IEEE80211_DEFAULT_RATES_MASK (IEEE80211_OFDM_DEFAULT_RATES_MASK | \</span>
<span class="cp">                                IEEE80211_CCK_DEFAULT_RATES_MASK)</span>

<span class="cp">#define IEEE80211_NUM_OFDM_RATES	    8</span>
<span class="cp">#define IEEE80211_NUM_CCK_RATES	            4</span>
<span class="cp">#define IEEE80211_OFDM_SHIFT_MASK_A         4</span>

<span class="cm">/* this is stolen and modified from the madwifi driver*/</span>
<span class="cp">#define IEEE80211_FC0_TYPE_MASK		0x0c</span>
<span class="cp">#define IEEE80211_FC0_TYPE_DATA		0x08</span>
<span class="cp">#define IEEE80211_FC0_SUBTYPE_MASK	0xB0</span>
<span class="cp">#define IEEE80211_FC0_SUBTYPE_QOS	0x80</span>

<span class="cp">#define IEEE80211_QOS_HAS_SEQ(fc) \</span>
<span class="cp">	(((fc) &amp; (IEEE80211_FC0_TYPE_MASK | IEEE80211_FC0_SUBTYPE_MASK)) == \</span>
<span class="cp">	 (IEEE80211_FC0_TYPE_DATA | IEEE80211_FC0_SUBTYPE_QOS))</span>

<span class="cm">/* this is stolen from ipw2200 driver */</span>
<span class="cp">#define IEEE_IBSS_MAC_HASH_SIZE 31</span>
<span class="k">struct</span> <span class="n">ieee_ibss_seq</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_num</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">frag_num</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">packet_time</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* NOTE: This data is for statistical purposes; not all hardware provides this</span>
<span class="cm"> *       information for frames received.  Not setting these will not cause</span>
<span class="cm"> *       any adverse affects. */</span>
<span class="k">struct</span> <span class="n">ieee80211_rx_stats</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">mac_time</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">signalstrength</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">rssi</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">signal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">noise</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rate</span><span class="p">;</span> <span class="cm">/* in 100 kbps */</span>
	<span class="n">u8</span> <span class="n">received_channel</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">control</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">freq</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nic_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* IEEE 802.11 requires that STA supports concurrent reception of at least</span>
<span class="cm"> * three fragmented frames. This define can be increased to support more</span>
<span class="cm"> * concurrent frames, but it should be noted that each entry can consume about</span>
<span class="cm"> * 2 kB of RAM and increasing cache size will slow down frame reassembly. */</span>
<span class="cp">#define IEEE80211_FRAG_CACHE_LEN 4</span>

<span class="k">struct</span> <span class="n">ieee80211_frag_entry</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">first_frag_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">seq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_frag</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">src_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">dst_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_unicast_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_multicast_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_fragments</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_unicast_octets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_multicast_octets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_deferred_transmissions</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_single_retry_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_multiple_retry_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_retry_limit_exceeded</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_discards</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_unicast_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_multicast_frames</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_fragments</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_unicast_octets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_multicast_octets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_fcs_errors</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_discards_no_buffer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_discards_wrong_sa</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_discards_undecryptable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_message_in_msg_fragments</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_message_in_bad_msg_fragments</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_device</span><span class="p">;</span>

<span class="cp">#include &quot;ieee80211_crypt.h&quot;</span>

<span class="cp">#define SEC_KEY_1         (1&lt;&lt;0)</span>
<span class="cp">#define SEC_KEY_2         (1&lt;&lt;1)</span>
<span class="cp">#define SEC_KEY_3         (1&lt;&lt;2)</span>
<span class="cp">#define SEC_KEY_4         (1&lt;&lt;3)</span>
<span class="cp">#define SEC_ACTIVE_KEY    (1&lt;&lt;4)</span>
<span class="cp">#define SEC_AUTH_MODE     (1&lt;&lt;5)</span>
<span class="cp">#define SEC_UNICAST_GROUP (1&lt;&lt;6)</span>
<span class="cp">#define SEC_LEVEL         (1&lt;&lt;7)</span>
<span class="cp">#define SEC_ENABLED       (1&lt;&lt;8)</span>

<span class="cp">#define SEC_LEVEL_0      0 </span><span class="cm">/* None */</span><span class="cp"></span>
<span class="cp">#define SEC_LEVEL_1      1 </span><span class="cm">/* WEP 40 and 104 bit */</span><span class="cp"></span>
<span class="cp">#define SEC_LEVEL_2      2 </span><span class="cm">/* Level 1 + TKIP */</span><span class="cp"></span>
<span class="cp">#define SEC_LEVEL_2_CKIP 3 </span><span class="cm">/* Level 1 + CKIP */</span><span class="cp"></span>
<span class="cp">#define SEC_LEVEL_3      4 </span><span class="cm">/* Level 2 + CCMP */</span><span class="cp"></span>

<span class="cp">#define WEP_KEYS 4</span>
<span class="cp">#define WEP_KEY_LEN 13</span>

<span class="cp">#define WEP_KEY_LEN_MODIF 32</span>

<span class="k">struct</span> <span class="n">ieee80211_security</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">active_key</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>
            <span class="nl">enabled:</span><span class="mi">1</span><span class="p">,</span>
	    <span class="nl">auth_mode:</span><span class="mi">2</span><span class="p">,</span>
            <span class="nl">auth_algo:</span><span class="mi">4</span><span class="p">,</span>
            <span class="nl">unicast_uses_group:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">key_sizes</span><span class="p">[</span><span class="n">WEP_KEYS</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">keys</span><span class="p">[</span><span class="n">WEP_KEYS</span><span class="p">][</span><span class="n">WEP_KEY_LEN_MODIF</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">level</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>


<span class="cm">/*</span>

<span class="cm"> 802.11 data frame from AP</span>

<span class="cm">      ,-------------------------------------------------------------------.</span>
<span class="cm">Bytes |  2   |  2   |    6    |    6    |    6    |  2   | 0..2312 |   4  |</span>
<span class="cm">      |------|------|---------|---------|---------|------|---------|------|</span>
<span class="cm">Desc. | ctrl | dura |  DA/RA  |   TA    |    SA   | Sequ |  frame  |  fcs |</span>
<span class="cm">      |      | tion | (BSSID) |         |         | ence |  data   |      |</span>
<span class="cm">      `-------------------------------------------------------------------&#39;</span>

<span class="cm">Total: 28-2340 bytes</span>

<span class="cm">*/</span>

<span class="cm">/* Management Frame Information Element Types */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MFIE_TYPE_SSID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_RATES</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_FH_SET</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_DS_SET</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_CF_SET</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_TIM</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_IBSS_SET</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_COUNTRY</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_CHALLENGE</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_ERP</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_RSN</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_RATES_EX</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="n">MFIE_TYPE_GENERIC</span> <span class="o">=</span> <span class="mi">221</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_header_data</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">frame_ctl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">duration_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr2</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr3</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_ctrl</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_hdr_4addr</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">frame_ctl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">duration_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr1</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr2</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr3</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_ctl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr4</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_hdr_3addrqos</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">frame_ctl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">duration_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr1</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr2</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr3</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_ctl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">qos_ctl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_hdr_4addrqos</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">frame_ctl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">duration_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr1</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr2</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">addr3</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_ctl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">addr4</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">qos_ctl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_info_element_hdr</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_info_element</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_authentication</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_header_data</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">algorithm</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">transaction</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>struct ieee80211<em>info</em>element<em>hdr info</em>element;</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_disassoc_frame</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr_3addr</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">reasoncode</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_probe_request</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_header_data</span> <span class="n">header</span><span class="p">;</span>
	<span class="cm">/* struct ieee80211_info_element info_element; */</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_probe_response</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_header_data</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">time_stamp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">beacon_interval</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">capability</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_info_element</span> <span class="n">info_element</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_assoc_request_frame</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr_3addr</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">capability</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">listen_interval</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>u8 current<em>ap[ETH</em>ALEN];</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">ieee80211_info_element_hdr</span> <span class="n">info_element</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_assoc_response_frame</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr_3addr</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">capability</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">aid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_info_element</span> <span class="n">info_element</span><span class="p">;</span> <span class="cm">/* supported rates */</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_txb</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">nr_frags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">encrypted</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">frag_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">payload_size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">fragments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* SWEEP TABLE ENTRIES NUMBER */</span>
<span class="cp">#define MAX_SWEEP_TAB_ENTRIES			42</span>
<span class="cp">#define MAX_SWEEP_TAB_ENTRIES_PER_PACKET	7</span>

<span class="cm">/* MAX_RATES_LENGTH needs to be 12.  The spec says 8, and many APs</span>
<span class="cm"> * only use 8, and then use extended rates for the remaining supported</span>
<span class="cm"> * rates.  Other APs, however, stick all of their supported rates on the</span>
<span class="cm"> * main rates information element... */</span>
<span class="cp">#define MAX_RATES_LENGTH			((u8)12)</span>
<span class="cp">#define MAX_RATES_EX_LENGTH			((u8)16)</span>

<span class="cp">#define MAX_NETWORK_COUNT			128</span>

<span class="cp">#define MAX_CHANNEL_NUMBER			165</span>

<span class="cp">#define IEEE80211_SOFTMAC_SCAN_TIME		100 </span><span class="cm">/* (HZ / 2) */</span><span class="cp"></span>
<span class="cp">#define IEEE80211_SOFTMAC_ASSOC_RETRY_TIME	(HZ * 2)</span>

<span class="cp">#define CRC_LENGTH	4U</span>

<span class="cp">#define MAX_WPA_IE_LEN	64</span>

<span class="cp">#define NETWORK_EMPTY_ESSID	(1 &lt;&lt; 0)</span>
<span class="cp">#define NETWORK_HAS_OFDM	(1 &lt;&lt; 1)</span>
<span class="cp">#define NETWORK_HAS_CCK		(1 &lt;&lt; 2)</span>

<span class="k">struct</span> <span class="n">ieee80211_wmm_ac_param</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">ac_aci_acm_aifsn</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ac_ecwmin_ecwmax</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ac_txop_limit</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_wmm_ts_info</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">ac_dir_tid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ac_up_psb</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_wmm_tspec_elem</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_wmm_ts_info</span> <span class="n">ts_info</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">norm_msdu_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_msdu_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">min_serv_inter</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_serv_inter</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">inact_inter</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">suspen_inter</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">serv_start_time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">min_data_rate</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mean_data_rate</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">peak_data_rate</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_burst_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">delay_bound</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">min_phy_rate</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">surp_band_allow</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">medium_time</span><span class="p">;</span>
<span class="p">}</span><span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">enum</span> <span class="n">eap_type</span> <span class="p">{</span>
	<span class="n">EAP_PACKET</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">EAPOL_START</span><span class="p">,</span>
	<span class="n">EAPOL_LOGOFF</span><span class="p">,</span>
	<span class="n">EAPOL_KEY</span><span class="p">,</span>
	<span class="n">EAPOL_ENCAP_ASF_ALERT</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">eap_types</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">EAP_PACKET</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;EAP-Packet&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">EAPOL_START</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;EAPOL-Start&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">EAPOL_LOGOFF</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;EAPOL-Logoff&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">EAPOL_KEY</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;EAPOL-Key&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">EAPOL_ENCAP_ASF_ALERT</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;EAPOL-Encap-ASF-Alert&quot;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">eap_get_type</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">type</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">eap_types</span><span class="p">))</span> <span class="o">?</span> <span class="s">&quot;Unknown&quot;</span> <span class="o">:</span> <span class="n">eap_types</span><span class="p">[</span><span class="n">type</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">eapol</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">snap</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">ethertype</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">ieee80211_softmac_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_ass_ok</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_ass_err</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_probe_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_probe_rs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_beacons</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_auth_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_auth_rs_ok</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_auth_rs_err</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_auth_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">no_auth_rs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">no_ass_rs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_ass_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_ass_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_probe_rq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reassoc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">swtxstop</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">swtxawake</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define BEACON_PROBE_SSID_ID_POSITION 12</span>

<span class="cm">/*</span>
<span class="cm"> * These are the data types that can make up management packets</span>
<span class="cm"> *</span>
<span class="cm">	u16 auth_algorithm;</span>
<span class="cm">	u16 auth_sequence;</span>
<span class="cm">	u16 beacon_interval;</span>
<span class="cm">	u16 capability;</span>
<span class="cm">	u8 current_ap[ETH_ALEN];</span>
<span class="cm">	u16 listen_interval;</span>
<span class="cm">	struct {</span>
<span class="cm">		u16 association_id:14, reserved:2;</span>
<span class="cm">	} __attribute__ ((packed));</span>
<span class="cm">	u32 time_stamp[2];</span>
<span class="cm">	u16 reason;</span>
<span class="cm">	u16 status;</span>
<span class="cm">*/</span>

<span class="cp">#define IEEE80211_DEFAULT_TX_ESSID &quot;Penguin&quot;</span>
<span class="cp">#define IEEE80211_DEFAULT_BASIC_RATE 10</span>

<span class="k">enum</span> <span class="p">{</span><span class="n">WMM_all_frame</span><span class="p">,</span> <span class="n">WMM_two_frame</span><span class="p">,</span> <span class="n">WMM_four_frame</span><span class="p">,</span> <span class="n">WMM_six_frame</span><span class="p">};</span>
<span class="cp">#define MAX_SP_Len  (WMM_all_frame &lt;&lt; 4)</span>
<span class="cp">#define IEEE80211_QOS_TID 0x0f</span>
<span class="cp">#define QOS_CTL_NOTCONTAIN_ACK (0x01 &lt;&lt; 5)</span>

<span class="cp">#define MAX_IE_LEN						0xFF </span><span class="c1">//+YJ,080625</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_CHANNEL_LIST</span><span class="p">{</span>
	<span class="n">u8</span>	<span class="n">Channel</span><span class="p">[</span><span class="n">MAX_CHANNEL_NUMBER</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">Len</span><span class="p">;</span>
<span class="p">}</span><span class="n">CHANNEL_LIST</span><span class="p">,</span> <span class="o">*</span><span class="n">PCHANNEL_LIST</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>by amy for ps</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE80211_WATCH_DOG_TIME    2000</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>by amy for ps
by amy for antenna</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define ANTENNA_DIVERSITY_TIMER_PERIOD		1000 </span><span class="c1">// 1000 m</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>by amy for antenna</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IEEE80211_DTIM_MBCAST 4</span>
<span class="cp">#define IEEE80211_DTIM_UCAST 2</span>
<span class="cp">#define IEEE80211_DTIM_VALID 1</span>
<span class="cp">#define IEEE80211_DTIM_INVALID 0</span>

<span class="cp">#define IEEE80211_PS_DISABLED 0</span>
<span class="cp">#define IEEE80211_PS_UNICAST IEEE80211_DTIM_UCAST</span>
<span class="cp">#define IEEE80211_PS_MBCAST IEEE80211_DTIM_MBCAST</span>
<span class="cp">#define IEEE80211_PS_ENABLE   IEEE80211_DTIM_VALID</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>added by David for QoS 2006/6/30</p>

<h1>define WMM<em>Hang</em>8187</h1></td><td class="code"><div class="highlight"><pre><span class="cp">#ifdef WMM_Hang_8187</span>
<span class="cp">#undef WMM_Hang_8187</span>
<span class="cp">#endif</span>

<span class="cp">#define WME_AC_BE   0x00</span>
<span class="cp">#define WME_AC_BK   0x01</span>
<span class="cp">#define WME_AC_VI   0x02</span>
<span class="cp">#define WME_AC_VO   0x03</span>
<span class="cp">#define WME_ACI_MASK 0x03</span>
<span class="cp">#define WME_AIFSN_MASK 0x03</span>
<span class="cp">#define WME_AC_PRAM_LEN 16</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>UP Mapping to AC, using in MgntQuery_SequenceNumber() and maybe for DSCP</p>

<h1>define UP2AC(up)    ((up&lt;3) ? ((up==0)?1:0) : (up>>1))</h1></td><td class="code"><div class="highlight"><pre><span class="cp">#define UP2AC(up) (		   \</span>
<span class="cp">	((up) &lt; 1) ? WME_AC_BE : \</span>
<span class="cp">	((up) &lt; 3) ? WME_AC_BK : \</span>
<span class="cp">	((up) &lt; 4) ? WME_AC_BE : \</span>
<span class="cp">	((up) &lt; 6) ? WME_AC_VI : \</span>
<span class="cp">	WME_AC_VO)</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>AC Mapping to UP, using in Tx part for selecting the corresponding TX queue</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define AC2UP(_ac)	(       \</span>
<span class="cp">	((_ac) == WME_AC_VO) ? 6 : \</span>
<span class="cp">	((_ac) == WME_AC_VI) ? 5 : \</span>
<span class="cp">	((_ac) == WME_AC_BK) ? 1 : \</span>
<span class="cp">	0)</span>

<span class="cp">#define	ETHER_ADDR_LEN		6	</span><span class="cm">/* length of an Ethernet address */</span><span class="cp"></span>
<span class="k">struct</span>	<span class="n">ether_header</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">ether_dhost</span><span class="p">[</span><span class="n">ETHER_ADDR_LEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">ether_shost</span><span class="p">[</span><span class="n">ETHER_ADDR_LEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">ether_type</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#ifndef ETHERTYPE_PAE</span>
<span class="cp">#define	ETHERTYPE_PAE	0x888e		</span><span class="cm">/* EAPOL PAE/802.1x */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#ifndef ETHERTYPE_IP</span>
<span class="cp">#define	ETHERTYPE_IP	0x0800		</span><span class="cm">/* IP protocol */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="p">{</span>
	<span class="cm">/* These entries are used to identify a unique network */</span>
	<span class="n">u8</span> <span class="n">bssid</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">channel</span><span class="p">;</span>
	<span class="cm">/* Ensure null-terminated for any debug msgs */</span>
	<span class="n">u8</span> <span class="n">ssid</span><span class="p">[</span><span class="n">IW_ESSID_MAX_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">ssid_len</span><span class="p">;</span>

	<span class="cm">/* These are network statistics */</span>
	<span class="k">struct</span> <span class="n">ieee80211_rx_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">capability</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rates</span><span class="p">[</span><span class="n">MAX_RATES_LENGTH</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">rates_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rates_ex</span><span class="p">[</span><span class="n">MAX_RATES_EX_LENGTH</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">rates_ex_len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_scanned</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_associate</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">time_stamp</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">beacon_interval</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">listen_interval</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">atim_window</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wpa_ie</span><span class="p">[</span><span class="n">MAX_WPA_IE_LEN</span><span class="p">];</span>
	<span class="kt">size_t</span> <span class="n">wpa_ie_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rsn_ie</span><span class="p">[</span><span class="n">MAX_WPA_IE_LEN</span><span class="p">];</span>
	<span class="kt">size_t</span> <span class="n">rsn_ie_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dtim_period</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dtim_data</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_dtim_sta_time</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>appeded for QoS</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span> <span class="n">wmm_info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_wmm_ac_param</span> <span class="n">wmm_param</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">QoS_Enable</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">SignalStrength</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>by amy 080312</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span> <span class="n">HighestOperaRate</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>by amy 080312</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span> <span class="n">Turbo_Enable</span><span class="p">;</span><span class="c1">//enable turbo mode, added by thomas</span>
	<span class="n">u16</span> <span class="n">CountryIeLen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">CountryIeBuf</span><span class="p">[</span><span class="n">MAX_IE_LEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ieee80211_state</span> <span class="p">{</span>

	<span class="cm">/* the card is not linked at all */</span>
	<span class="n">IEEE80211_NOLINK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="cm">/* IEEE80211_ASSOCIATING* are for BSS client mode</span>
<span class="cm">	 * the driver shall not perform RX filtering unless</span>
<span class="cm">	 * the state is LINKED.</span>
<span class="cm">	 * The driver shall just check for the state LINKED and</span>
<span class="cm">	 * defaults to NOLINK for ALL the other states (including</span>
<span class="cm">	 * LINKED_SCANNING)</span>
<span class="cm">	 */</span>

	<span class="cm">/* the association procedure will start (wq scheduling)*/</span>
	<span class="n">IEEE80211_ASSOCIATING</span><span class="p">,</span>
	<span class="n">IEEE80211_ASSOCIATING_RETRY</span><span class="p">,</span>

	<span class="cm">/* the association procedure is sending AUTH request*/</span>
	<span class="n">IEEE80211_ASSOCIATING_AUTHENTICATING</span><span class="p">,</span>

	<span class="cm">/* the association procedure has successfully authenticated</span>
<span class="cm">	 * and is sending association request</span>
<span class="cm">	 */</span>
	<span class="n">IEEE80211_ASSOCIATING_AUTHENTICATED</span><span class="p">,</span>

	<span class="cm">/* the link is ok. the card associated to a BSS or linked</span>
<span class="cm">	 * to a ibss cell or acting as an AP and creating the bss</span>
<span class="cm">	 */</span>
	<span class="n">IEEE80211_LINKED</span><span class="p">,</span>

	<span class="cm">/* same as LINKED, but the driver shall apply RX filter</span>
<span class="cm">	 * rules as we are in NO_LINK mode. As the card is still</span>
<span class="cm">	 * logically linked, but it is doing a syncro site survey</span>
<span class="cm">	 * then it will be back to LINKED state.</span>
<span class="cm">	 */</span>
	<span class="n">IEEE80211_LINKED_SCANNING</span><span class="p">,</span>

<span class="p">};</span>

<span class="cp">#define DEFAULT_MAX_SCAN_AGE (15 * HZ)</span>
<span class="cp">#define DEFAULT_FTS 2346</span>

<span class="cp">#define CFG_IEEE80211_RESERVE_FCS (1&lt;&lt;0)</span>
<span class="cp">#define CFG_IEEE80211_COMPUTE_FCS (1&lt;&lt;1)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">tx_pending_t</span><span class="p">{</span>
	<span class="kt">int</span> <span class="n">frag</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_txb</span> <span class="o">*</span><span class="n">txb</span><span class="p">;</span>
<span class="p">}</span><span class="n">tx_pending_t</span><span class="p">;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">COUNTRY_CODE_FCC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_IC</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_ETSI</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_SPAIN</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_FRANCE</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_MKK</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_MKK1</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_ISRAEL</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_TELEC</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_GLOBAL_DOMAIN</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">COUNTRY_CODE_WORLD_WIDE_13_INDEX</span> <span class="o">=</span> <span class="mi">10</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="cm">/* Bookkeeping structures */</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_stats</span> <span class="n">ieee_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_softmac_stats</span> <span class="n">softmac_stats</span><span class="p">;</span>

	<span class="cm">/* Probe / Beacon management */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">network_free_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">network_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span><span class="n">networks</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">scans</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">scan_age</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">iw_mode</span><span class="p">;</span> <span class="cm">/* operating mode (IW_MODE_*) */</span>

	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">wpax_suitlist_lock</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">tx_headroom</span><span class="p">;</span> <span class="cm">/* Set to size of any additional room needed at front</span>
<span class="cm">			  * of allocated Tx SKBs */</span>
	<span class="n">u32</span> <span class="n">config</span><span class="p">;</span>

	<span class="cm">/* WEP and other encryption related settings at the device level */</span>
	<span class="kt">int</span> <span class="n">open_wep</span><span class="p">;</span> <span class="cm">/* Set to 1 to allow unencrypted frames */</span>

	<span class="kt">int</span> <span class="n">reset_on_keychange</span><span class="p">;</span> <span class="cm">/* Set to 1 if the HW needs to be reset on</span>
<span class="cm">				 * WEP key changes */</span>

	<span class="cm">/* If the host performs {en,de}cryption, then set to 1 */</span>
	<span class="kt">int</span> <span class="n">host_encrypt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">host_decrypt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ieee802_1x</span><span class="p">;</span> <span class="cm">/* is IEEE 802.1X used */</span>

	<span class="cm">/* WPA data */</span>
	<span class="kt">int</span> <span class="n">wpa_enabled</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">drop_unencrypted</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tkip_countermeasures</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">privacy_invoked</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">wpa_ie_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">wpa_ie</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">ap_mac_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">pairwise_key_type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">broadcast_key_type</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">crypt_deinit_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_crypt_data</span> <span class="o">*</span><span class="n">crypt</span><span class="p">[</span><span class="n">WEP_KEYS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">tx_keyidx</span><span class="p">;</span> <span class="cm">/* default TX key index (crypt[tx_keyidx]) */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">crypt_deinit_timer</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">bcrx_sta_key</span><span class="p">;</span> <span class="cm">/* use individual keys to override default keys even</span>
<span class="cm">			   * with RX of broad/multicast frames */</span>

	<span class="cm">/* Fragmentation structures */</span>
	<span class="cm">/* each stream contains an entry */</span>
	<span class="k">struct</span> <span class="n">ieee80211_frag_entry</span> <span class="n">frag_cache</span><span class="p">[</span><span class="mi">17</span><span class="p">][</span><span class="n">IEEE80211_FRAG_CACHE_LEN</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">frag_next_idx</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">fts</span><span class="p">;</span> <span class="cm">/* Fragmentation Threshold */</span>

	<span class="cm">/* This stores infos for the current network.</span>
<span class="cm">	 * Either the network we are associated in INFRASTRUCTURE</span>
<span class="cm">	 * or the network that we are creating in MASTER mode.</span>
<span class="cm">	 * ad-hoc is a mixture ;-).</span>
<span class="cm">	 * Note that in infrastructure mode, even when not associated,</span>
<span class="cm">	 * fields bssid and essid may be valid (if wpa_set and essid_set</span>
<span class="cm">	 * are true) as thy carry the value set by the user via iwconfig</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="n">current_network</span><span class="p">;</span>


	<span class="k">enum</span> <span class="n">ieee80211_state</span> <span class="n">state</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">short_slot</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>       <span class="cm">/* A, B, G */</span>
	<span class="kt">int</span> <span class="n">modulation</span><span class="p">;</span> <span class="cm">/* CCK, OFDM */</span>
	<span class="kt">int</span> <span class="n">freq_band</span><span class="p">;</span>  <span class="cm">/* 2.4Ghz, 5.2Ghz, Mixed */</span>
	<span class="kt">int</span> <span class="n">abg_true</span><span class="p">;</span>   <span class="cm">/* ABG flag              */</span>

	<span class="cm">/* used for forcing the ibss workqueue to terminate</span>
<span class="cm">	 * without wait for the syncro scan to terminate</span>
<span class="cm">	 */</span>
	<span class="kt">short</span> <span class="n">sync_scan_hurryup</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span> <span class="n">pDot11dInfo</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bGlobalDomain</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>For Liteon Ch12~13 passive scan</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span>	<span class="n">MinPassiveChnlNum</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">IbssStartChnl</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>       <span class="cm">/* current rate */</span>
	<span class="kt">int</span> <span class="n">basic_rate</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>FIXME: please callback, see if redundant with softmac_features</p></td><td class="code"><div class="highlight"><pre>	<span class="kt">short</span> <span class="n">active_scan</span><span class="p">;</span>

	<span class="cm">/* this contains flags for selectively enable softmac support */</span>
	<span class="n">u16</span> <span class="n">softmac_features</span><span class="p">;</span>

	<span class="cm">/* if the sequence control field is not filled by HW */</span>
	<span class="n">u16</span> <span class="n">seq_ctrl</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

	<span class="cm">/* association procedure transaction sequence number */</span>
	<span class="n">u16</span> <span class="n">associate_seq</span><span class="p">;</span>

	<span class="cm">/* AID for RTXed association responses */</span>
	<span class="n">u16</span> <span class="n">assoc_id</span><span class="p">;</span>

	<span class="cm">/* power save mode related*/</span>
	<span class="kt">short</span> <span class="n">ps</span><span class="p">;</span>
	<span class="kt">short</span> <span class="n">sta_sleep</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ps_timeout</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">ps_task</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ps_th</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ps_tl</span><span class="p">;</span>

	<span class="kt">short</span> <span class="n">raw_tx</span><span class="p">;</span>
	<span class="cm">/* used if IEEE_SOFTMAC_TX_QUEUE is set */</span>
	<span class="kt">short</span> <span class="n">queue_stop</span><span class="p">;</span>
	<span class="kt">short</span> <span class="n">scanning</span><span class="p">;</span>
	<span class="kt">short</span> <span class="n">proto_started</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">semaphore</span> <span class="n">wx_sem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span> <span class="n">scan_sem</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">mgmt_tx_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">beacon_lock</span><span class="p">;</span>

	<span class="kt">short</span> <span class="n">beacon_txing</span><span class="p">;</span>

	<span class="kt">short</span> <span class="n">wap_set</span><span class="p">;</span>
	<span class="kt">short</span> <span class="n">ssid_set</span><span class="p">;</span>

	<span class="n">u8</span>  <span class="n">wpax_type_set</span><span class="p">;</span>    <span class="c1">//{added by David, 2006.9.28}</span>
	<span class="n">u32</span> <span class="n">wpax_type_notify</span><span class="p">;</span> <span class="c1">//{added by David, 2006.9.26}</span>

	<span class="cm">/* QoS related flag */</span>
	<span class="kt">char</span> <span class="n">init_wmmparam_flag</span><span class="p">;</span>

	<span class="cm">/* for discarding duplicated packets in IBSS */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ibss_mac_hash</span><span class="p">[</span><span class="n">IEEE_IBSS_MAC_HASH_SIZE</span><span class="p">];</span>

	<span class="cm">/* for discarding duplicated packets in BSS */</span>
	<span class="n">u16</span> <span class="n">last_rxseq_num</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span> <span class="cm">/* rx seq previous per-tid */</span>
	<span class="n">u16</span> <span class="n">last_rxfrag_num</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span><span class="cm">/* tx frag previous per-tid */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_packet_time</span><span class="p">[</span><span class="mi">17</span><span class="p">];</span>

	<span class="cm">/* for PS mode */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_rx_ps_time</span><span class="p">;</span>

	<span class="cm">/* used if IEEE_SOFTMAC_SINGLE_QUEUE is set */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">mgmt_queue_ring</span><span class="p">[</span><span class="n">MGMT_QUEUE_NUM</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">mgmt_queue_head</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mgmt_queue_tail</span><span class="p">;</span>


	<span class="cm">/* used if IEEE_SOFTMAC_TX_QUEUE is set */</span>
	<span class="k">struct</span>  <span class="n">tx_pending_t</span> <span class="n">tx_pending</span><span class="p">;</span>

	<span class="cm">/* used if IEEE_SOFTMAC_ASSOCIATE is set */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">associate_timer</span><span class="p">;</span>

	<span class="cm">/* used if IEEE_SOFTMAC_BEACONS is set */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">beacon_timer</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">associate_complete_wq</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>struct work<em>struct associate</em>retry_wq;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">associate_procedure_wq</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>struct work<em>struct softmac</em>scan_wq;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">wx_sync_scan_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">wmm_param_update_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">ps_request_tx_ack_wq</span><span class="p">;</span><span class="c1">//for ps</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>struct work<em>struct hw</em>wakeup<em>wq;
struct work</em>struct hw<em>sleep</em>wq;
struct work<em>struct watch</em>dog_wq;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">bool</span> <span class="n">bInactivePs</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">actscanning</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beinretry</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ListenInterval</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">NumRxDataInPeriod</span><span class="p">;</span> <span class="c1">//YJ,add,080828</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">NumRxBcnInPeriod</span><span class="p">;</span>  <span class="c1">//YJ,add,080828</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">NumRxOkTotal</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">NumRxUnicast</span><span class="p">;</span><span class="c1">//YJ,add,080828,for keep alive</span>
	<span class="n">bool</span> <span class="n">bHwRadioOff</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">softmac_scan_wq</span><span class="p">;</span>
        <span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">associate_retry_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">hw_wakeup_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">hw_sleep_wq</span><span class="p">;</span><span class="c1">//+by amy 080324</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">watch_dog_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">sw_antenna_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span>  <span class="n">start_ibss_wq</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>by amy for rate adaptive 080312</p></td><td class="code"><div class="highlight"><pre>    <span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">rate_adapter_wq</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>by amy for rate adaptive</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">hw_dig_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">tx_pw_wq</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Added for RF power on power off by lizhaoming 080512</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">GPIOChangeRFWorkItem</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">wq</span><span class="p">;</span>

	<span class="cm">/* Callback functions */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_security</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ieee80211_security</span> <span class="o">*</span><span class="n">sec</span><span class="p">);</span>

	<span class="cm">/* Used to TX data frame by using txb structs.</span>
<span class="cm">	 * this is not used if in the softmac_features</span>
<span class="cm">	 * is set the flag IEEE_SOFTMAC_TX_QUEUE</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hard_start_xmit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ieee80211_txb</span> <span class="o">*</span><span class="n">txb</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_port</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* Softmac-generated frames (mamagement) are TXed via this</span>
<span class="cm">	 * callback if the flag IEEE_SOFTMAC_SINGLE_QUEUE is</span>
<span class="cm">	 * not set. As some cards may have different HW queues that</span>
<span class="cm">	 * one might want to use for data and management frames</span>
<span class="cm">	 * the option to have two callbacks might be useful.</span>
<span class="cm">	 * This function can&#39;t sleep.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">softmac_hard_start_xmit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* used instead of hard_start_xmit (not softmac_hard_start_xmit)</span>
<span class="cm">	 * if the IEEE_SOFTMAC_TX_QUEUE feature is used to TX data</span>
<span class="cm">	 * frames. If the option IEEE_SOFTMAC_SINGLE_QUEUE is also set</span>
<span class="cm">	 * then also management frames are sent via this callback.</span>
<span class="cm">	 * This function can&#39;t sleep.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">softmac_data_hard_start_xmit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span><span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>

	<span class="cm">/* stops the HW queue for DATA frames. Useful to avoid</span>
<span class="cm">	 * waste time to TX data frame when we are reassociating</span>
<span class="cm">	 * This function can sleep.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">data_hard_stop</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* OK this is complementar to data_poll_hard_stop */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">data_hard_resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* ask to the driver to retune the radio .</span>
<span class="cm">	 * This function can sleep. the driver should ensure</span>
<span class="cm">	 * the radio has been switched before return.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_chan</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span><span class="kt">short</span> <span class="n">ch</span><span class="p">);</span>

	<span class="cm">/* These are not used if the ieee stack takes care of</span>
<span class="cm">	 * scanning (IEEE_SOFTMAC_SCAN feature set).</span>
<span class="cm">	 * In this case only the set_chan is used.</span>
<span class="cm">	 *</span>
<span class="cm">	 * The syncro version is similar to the start_scan but</span>
<span class="cm">	 * does not return until all channels has been scanned.</span>
<span class="cm">	 * this is called in user context and should sleep,</span>
<span class="cm">	 * it is called in a work_queue when switching to ad-hoc mode</span>
<span class="cm">	 * or in behalf of iwlist scan when the card is associated</span>
<span class="cm">	 * and root user ask for a scan.</span>
<span class="cm">	 * the function stop_scan should stop both the syncro and</span>
<span class="cm">	 * background scanning and can sleep.</span>
<span class="cm">	 * The function start_scan should initiate the background</span>
<span class="cm">	 * scanning and can&#39;t sleep.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">scan_syncro</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">start_scan</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop_scan</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* indicate the driver that the link state is changed</span>
<span class="cm">	 * for example it may indicate the card is associated now.</span>
<span class="cm">	 * Driver might be interested in this to apply RX filter</span>
<span class="cm">	 * rules or simply light the LINK led</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">link_change</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* these two function indicates to the HW when to start</span>
<span class="cm">	 * and stop to send beacons. This is used when the</span>
<span class="cm">	 * IEEE_SOFTMAC_BEACONS is not set. For now the</span>
<span class="cm">	 * stop_send_bacons is NOT guaranteed to be called only</span>
<span class="cm">	 * after start_send_beacons.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">start_send_beacons</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop_send_beacons</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* power save mode related */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">sta_wake_up</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">ps_request_tx_ack</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enter_sleep_state</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">th</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tl</span><span class="p">);</span>
	<span class="kt">short</span> <span class="p">(</span><span class="o">*</span><span class="n">ps_is_queue_empty</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* QoS related */</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>void (<em>wmm_param_update) (struct net_device *dev, u8 *ac_param);
void (</em>wmm<em>param</em>update) (struct ieee80211_device *ieee);</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/* This must be the last item so that it points to the data</span>
<span class="cm">	 * allocated beyond this structure by alloc_ieee80211 */</span>
	<span class="n">u8</span> <span class="n">priv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define IEEE_A            (1&lt;&lt;0)</span>
<span class="cp">#define IEEE_B            (1&lt;&lt;1)</span>
<span class="cp">#define IEEE_G            (1&lt;&lt;2)</span>
<span class="cp">#define IEEE_MODE_MASK    (IEEE_A|IEEE_B|IEEE_G)</span>

<span class="cm">/* Generate a 802.11 header */</span>

<span class="cm">/* Uses the channel change callback directly</span>
<span class="cm"> * instead of [start/stop] scan callbacks</span>
<span class="cm"> */</span>
<span class="cp">#define IEEE_SOFTMAC_SCAN (1&lt;&lt;2)</span>

<span class="cm">/* Perform authentication and association handshake */</span>
<span class="cp">#define IEEE_SOFTMAC_ASSOCIATE (1&lt;&lt;3)</span>

<span class="cm">/* Generate probe requests */</span>
<span class="cp">#define IEEE_SOFTMAC_PROBERQ (1&lt;&lt;4)</span>

<span class="cm">/* Generate response to probe requests */</span>
<span class="cp">#define IEEE_SOFTMAC_PROBERS (1&lt;&lt;5)</span>

<span class="cm">/* The ieee802.11 stack will manages the netif queue</span>
<span class="cm"> * wake/stop for the driver, taking care of 802.11</span>
<span class="cm"> * fragmentation. See softmac.c for details. */</span>
<span class="cp">#define IEEE_SOFTMAC_TX_QUEUE (1&lt;&lt;7)</span>

<span class="cm">/* Uses only the softmac_data_hard_start_xmit</span>
<span class="cm"> * even for TX management frames.</span>
<span class="cm"> */</span>
<span class="cp">#define IEEE_SOFTMAC_SINGLE_QUEUE (1&lt;&lt;8)</span>

<span class="cm">/* Generate beacons.  The stack will enqueue beacons</span>
<span class="cm"> * to the card</span>
<span class="cm"> */</span>
<span class="cp">#define IEEE_SOFTMAC_BEACONS (1&lt;&lt;6)</span>



<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">ieee80211_priv</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">((</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="p">)</span><span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ieee80211_is_empty_essid</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">essid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">essid_len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Single white space is for Linksys APs */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">essid_len</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">essid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39; &#39;</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Otherwise, if the entire essid is 0, we assume it is hidden */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">essid_len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">essid_len</span><span class="o">--</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">essid</span><span class="p">[</span><span class="n">essid_len</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ieee80211_is_valid_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * It is possible for both access points and our device to support</span>
<span class="cm">	 * combinations of modes, so as long as there is one valid combination</span>
<span class="cm">	 * of ap/device supported modes, then return success</span>
<span class="cm">	 *</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">IEEE_A</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">&amp;</span> <span class="n">IEEE80211_OFDM_MODULATION</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">freq_band</span> <span class="o">&amp;</span> <span class="n">IEEE80211_52GHZ_BAND</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">IEEE_G</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">&amp;</span> <span class="n">IEEE80211_OFDM_MODULATION</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">freq_band</span> <span class="o">&amp;</span> <span class="n">IEEE80211_24GHZ_BAND</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">mode</span> <span class="o">&amp;</span> <span class="n">IEEE_B</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">&amp;</span> <span class="n">IEEE80211_CCK_MODULATION</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">freq_band</span> <span class="o">&amp;</span> <span class="n">IEEE80211_24GHZ_BAND</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ieee80211_get_hdrlen</span><span class="p">(</span><span class="n">u16</span> <span class="n">fc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">hdrlen</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">WLAN_FC_GET_TYPE</span><span class="p">(</span><span class="n">fc</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IEEE80211_FTYPE_DATA</span>:
		<span class="k">if</span> <span class="p">((</span><span class="n">fc</span> <span class="o">&amp;</span> <span class="n">IEEE80211_FCTL_FROMDS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fc</span> <span class="o">&amp;</span> <span class="n">IEEE80211_FCTL_TODS</span><span class="p">))</span>
			<span class="n">hdrlen</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span> <span class="cm">/* Addr4 */</span>
		<span class="k">if</span><span class="p">(</span><span class="n">IEEE80211_QOS_HAS_SEQ</span><span class="p">(</span><span class="n">fc</span><span class="p">))</span>
			<span class="n">hdrlen</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* QOS ctrl*/</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IEEE80211_FTYPE_CTL</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">WLAN_FC_GET_STYPE</span><span class="p">(</span><span class="n">fc</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">IEEE80211_STYPE_CTS</span>:
		<span class="k">case</span> <span class="n">IEEE80211_STYPE_ACK</span>:
			<span class="n">hdrlen</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">hdrlen</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">hdrlen</span><span class="p">;</span>
<span class="p">}</span>



<span class="cm">/* ieee80211.c */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">free_ieee80211</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">alloc_ieee80211</span><span class="p">(</span><span class="kt">int</span> <span class="n">sizeof_priv</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_set_encryption</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>

<span class="cm">/* ieee80211_tx.c */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_encrypt_fragment</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">frag</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">hdr_len</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_rtl_xmit</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_txb_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_txb</span> <span class="o">*</span><span class="p">);</span>


<span class="cm">/* ieee80211_rx.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_rtl_rx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">ieee80211_rx_stats</span> <span class="o">*</span><span class="n">rx_stats</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_rx_mgt</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ieee80211_hdr_4addr</span> <span class="o">*</span><span class="n">header</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ieee80211_rx_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">);</span>

<span class="cm">/* ieee80211_wx.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				 <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_encode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				   <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_encode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				   <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_encode_ext</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
                            <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
                            <span class="k">union</span> <span class="n">iwreq_data</span><span class="o">*</span> <span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ieee80211_wx_set_auth</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
                               <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
                               <span class="k">struct</span> <span class="n">iw_param</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ieee80211_wx_set_mlme</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
                               <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
                               <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ieee80211_wx_set_gen_ie</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">ie</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="cm">/* ieee80211_softmac.c */</span>
<span class="k">extern</span> <span class="kt">short</span> <span class="n">ieee80211_is_54g</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span><span class="n">net</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">short</span> <span class="n">ieee80211_is_shortslot</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span><span class="n">net</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_rx_frame_softmac</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">ieee80211_rx_stats</span> <span class="o">*</span><span class="n">rx_stats</span><span class="p">,</span> <span class="n">u16</span> <span class="n">type</span><span class="p">,</span>
			<span class="n">u16</span> <span class="n">stype</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_new_net</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span><span class="n">net</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_xmit</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_txb</span> <span class="o">*</span><span class="n">txb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_check_all_nets</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_bss</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_master_bss</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_ibss</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_associate_abort</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_disassociate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_stop_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_scan_syncro</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_check_all_nets</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_protocol</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_stop_protocol</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_start_protocol</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_stop_protocol</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_reset_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_rtl_wake_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_rtl_stop_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">ieee80211_get_beacon</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_start_send_beacons</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_stop_send_beacons</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wpa_supplicant_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_point</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">notify_wx_assoc_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_ps_tx_ack</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="kt">short</span> <span class="n">success</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">SendDisassociation</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span><span class="n">u8</span><span class="o">*</span> <span class="n">asSta</span><span class="p">,</span><span class="n">u8</span> <span class="n">asRsn</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_rtl_start_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Add for RF power on power off by lizhaoming 080512</p></td><td class="code"><div class="highlight"><pre><span class="k">extern</span> <span class="kt">void</span> <span class="n">SendDisassociation</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
       			 <span class="n">u8</span><span class="o">*</span>                     <span class="n">asSta</span><span class="p">,</span>
        		 <span class="n">u8</span>                      <span class="n">asRsn</span><span class="p">);</span>

<span class="cm">/* ieee80211_crypt_ccmp&amp;tkip&amp;wep.c */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_tkip_null</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_wep_null</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_ccmp_null</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cm">/* ieee80211_softmac_wx.c */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_wap</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			    <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ext</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_wap</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			 <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">awrq</span><span class="p">,</span>
			 <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_essid</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span><span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span><span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_essid</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			      <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_freq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_freq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">b</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_wx_sync_scan_wq</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_rawtx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			       <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_set_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				 <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ieee80211_wx_get_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">iw_request_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				 <span class="k">union</span> <span class="n">iwreq_data</span> <span class="o">*</span><span class="n">wrqu</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">extra</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_softmac_ips_scan_syncro</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ieee80211_sta_ps_send_null_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="kt">short</span> <span class="n">pwr</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">const</span> <span class="kt">long</span> <span class="n">ieee80211_wlan_frequencies</span><span class="p">[];</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ieee80211_increment_scans</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">scans</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ieee80211_get_scans</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">scans</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">escape_essid</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">essid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">essid_len</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">escaped</span><span class="p">[</span><span class="n">IW_ESSID_MAX_SIZE</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">essid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">escaped</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee80211_is_empty_essid</span><span class="p">(</span><span class="n">essid</span><span class="p">,</span> <span class="n">essid_len</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">escaped</span><span class="p">,</span> <span class="s">&quot;&lt;hidden&gt;&quot;</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;&lt;hidden&gt;&quot;</span><span class="p">));</span>
		<span class="k">return</span> <span class="n">escaped</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">essid_len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">essid_len</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">IW_ESSID_MAX_SIZE</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">essid_len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">s</span> <span class="o">==</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">d</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;\\&#39;</span><span class="p">;</span>
			<span class="o">*</span><span class="n">d</span><span class="o">++</span> <span class="o">=</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
			<span class="n">s</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">d</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">escaped</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* IEEE80211_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
