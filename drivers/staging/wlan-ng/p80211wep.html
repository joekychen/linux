<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › wlan-ng › p80211wep.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>p80211wep.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* src/p80211/p80211wep.c</span>
<span class="cm">*</span>
<span class="cm">* WEP encode/decode for P80211.</span>
<span class="cm">*</span>
<span class="cm">* Copyright (C) 2002 AbsoluteValue Systems, Inc.  All Rights Reserved.</span>
<span class="cm">* --------------------------------------------------------------------</span>
<span class="cm">*</span>
<span class="cm">* linux-wlan</span>
<span class="cm">*</span>
<span class="cm">*   The contents of this file are subject to the Mozilla Public</span>
<span class="cm">*   License Version 1.1 (the &quot;License&quot;); you may not use this file</span>
<span class="cm">*   except in compliance with the License. You may obtain a copy of</span>
<span class="cm">*   the License at http://www.mozilla.org/MPL/</span>
<span class="cm">*</span>
<span class="cm">*   Software distributed under the License is distributed on an &quot;AS</span>
<span class="cm">*   IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or</span>
<span class="cm">*   implied. See the License for the specific language governing</span>
<span class="cm">*   rights and limitations under the License.</span>
<span class="cm">*</span>
<span class="cm">*   Alternatively, the contents of this file may be used under the</span>
<span class="cm">*   terms of the GNU Public License version 2 (the &quot;GPL&quot;), in which</span>
<span class="cm">*   case the provisions of the GPL are applicable instead of the</span>
<span class="cm">*   above.  If you wish to allow the use of your version of this file</span>
<span class="cm">*   only under the terms of the GPL and not to allow others to use</span>
<span class="cm">*   your version of this file under the MPL, indicate your decision</span>
<span class="cm">*   by deleting the provisions above and replace them with the notice</span>
<span class="cm">*   and other provisions required by the GPL.  If you do not delete</span>
<span class="cm">*   the provisions above, a recipient may use your version of this</span>
<span class="cm">*   file under either the MPL or the GPL.</span>
<span class="cm">*</span>
<span class="cm">* --------------------------------------------------------------------</span>
<span class="cm">*</span>
<span class="cm">* Inquiries regarding the linux-wlan Open Source project can be</span>
<span class="cm">* made directly to:</span>
<span class="cm">*</span>
<span class="cm">* AbsoluteValue Systems Inc.</span>
<span class="cm">* info@linux-wlan.com</span>
<span class="cm">* http://www.linux-wlan.com</span>
<span class="cm">*</span>
<span class="cm">* --------------------------------------------------------------------</span>
<span class="cm">*</span>
<span class="cm">* Portions of the development of this software were funded by</span>
<span class="cm">* Intersil Corporation as part of PRISM(R) chipset product development.</span>
<span class="cm">*</span>
<span class="cm">* --------------------------------------------------------------------</span>
<span class="cm">*/</span>

<span class="cm">/*================================================================*/</span>
<span class="cm">/* System Includes */</span>

<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/wireless.h&gt;</span>
<span class="cp">#include &lt;linux/random.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="cm">/* #define WEP_DEBUG	*/</span>

<span class="cp">#include &quot;p80211hdr.h&quot;</span>
<span class="cp">#include &quot;p80211types.h&quot;</span>
<span class="cp">#include &quot;p80211msg.h&quot;</span>
<span class="cp">#include &quot;p80211conv.h&quot;</span>
<span class="cp">#include &quot;p80211netdev.h&quot;</span>

<span class="cp">#define WEP_KEY(x)       (((x) &amp; 0xC0) &gt;&gt; 6)</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">wep_crc32_table</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00000000L</span><span class="p">,</span> <span class="mh">0x77073096L</span><span class="p">,</span> <span class="mh">0xee0e612cL</span><span class="p">,</span> <span class="mh">0x990951baL</span><span class="p">,</span> <span class="mh">0x076dc419L</span><span class="p">,</span>
	<span class="mh">0x706af48fL</span><span class="p">,</span> <span class="mh">0xe963a535L</span><span class="p">,</span> <span class="mh">0x9e6495a3L</span><span class="p">,</span> <span class="mh">0x0edb8832L</span><span class="p">,</span> <span class="mh">0x79dcb8a4L</span><span class="p">,</span>
	<span class="mh">0xe0d5e91eL</span><span class="p">,</span> <span class="mh">0x97d2d988L</span><span class="p">,</span> <span class="mh">0x09b64c2bL</span><span class="p">,</span> <span class="mh">0x7eb17cbdL</span><span class="p">,</span> <span class="mh">0xe7b82d07L</span><span class="p">,</span>
	<span class="mh">0x90bf1d91L</span><span class="p">,</span> <span class="mh">0x1db71064L</span><span class="p">,</span> <span class="mh">0x6ab020f2L</span><span class="p">,</span> <span class="mh">0xf3b97148L</span><span class="p">,</span> <span class="mh">0x84be41deL</span><span class="p">,</span>
	<span class="mh">0x1adad47dL</span><span class="p">,</span> <span class="mh">0x6ddde4ebL</span><span class="p">,</span> <span class="mh">0xf4d4b551L</span><span class="p">,</span> <span class="mh">0x83d385c7L</span><span class="p">,</span> <span class="mh">0x136c9856L</span><span class="p">,</span>
	<span class="mh">0x646ba8c0L</span><span class="p">,</span> <span class="mh">0xfd62f97aL</span><span class="p">,</span> <span class="mh">0x8a65c9ecL</span><span class="p">,</span> <span class="mh">0x14015c4fL</span><span class="p">,</span> <span class="mh">0x63066cd9L</span><span class="p">,</span>
	<span class="mh">0xfa0f3d63L</span><span class="p">,</span> <span class="mh">0x8d080df5L</span><span class="p">,</span> <span class="mh">0x3b6e20c8L</span><span class="p">,</span> <span class="mh">0x4c69105eL</span><span class="p">,</span> <span class="mh">0xd56041e4L</span><span class="p">,</span>
	<span class="mh">0xa2677172L</span><span class="p">,</span> <span class="mh">0x3c03e4d1L</span><span class="p">,</span> <span class="mh">0x4b04d447L</span><span class="p">,</span> <span class="mh">0xd20d85fdL</span><span class="p">,</span> <span class="mh">0xa50ab56bL</span><span class="p">,</span>
	<span class="mh">0x35b5a8faL</span><span class="p">,</span> <span class="mh">0x42b2986cL</span><span class="p">,</span> <span class="mh">0xdbbbc9d6L</span><span class="p">,</span> <span class="mh">0xacbcf940L</span><span class="p">,</span> <span class="mh">0x32d86ce3L</span><span class="p">,</span>
	<span class="mh">0x45df5c75L</span><span class="p">,</span> <span class="mh">0xdcd60dcfL</span><span class="p">,</span> <span class="mh">0xabd13d59L</span><span class="p">,</span> <span class="mh">0x26d930acL</span><span class="p">,</span> <span class="mh">0x51de003aL</span><span class="p">,</span>
	<span class="mh">0xc8d75180L</span><span class="p">,</span> <span class="mh">0xbfd06116L</span><span class="p">,</span> <span class="mh">0x21b4f4b5L</span><span class="p">,</span> <span class="mh">0x56b3c423L</span><span class="p">,</span> <span class="mh">0xcfba9599L</span><span class="p">,</span>
	<span class="mh">0xb8bda50fL</span><span class="p">,</span> <span class="mh">0x2802b89eL</span><span class="p">,</span> <span class="mh">0x5f058808L</span><span class="p">,</span> <span class="mh">0xc60cd9b2L</span><span class="p">,</span> <span class="mh">0xb10be924L</span><span class="p">,</span>
	<span class="mh">0x2f6f7c87L</span><span class="p">,</span> <span class="mh">0x58684c11L</span><span class="p">,</span> <span class="mh">0xc1611dabL</span><span class="p">,</span> <span class="mh">0xb6662d3dL</span><span class="p">,</span> <span class="mh">0x76dc4190L</span><span class="p">,</span>
	<span class="mh">0x01db7106L</span><span class="p">,</span> <span class="mh">0x98d220bcL</span><span class="p">,</span> <span class="mh">0xefd5102aL</span><span class="p">,</span> <span class="mh">0x71b18589L</span><span class="p">,</span> <span class="mh">0x06b6b51fL</span><span class="p">,</span>
	<span class="mh">0x9fbfe4a5L</span><span class="p">,</span> <span class="mh">0xe8b8d433L</span><span class="p">,</span> <span class="mh">0x7807c9a2L</span><span class="p">,</span> <span class="mh">0x0f00f934L</span><span class="p">,</span> <span class="mh">0x9609a88eL</span><span class="p">,</span>
	<span class="mh">0xe10e9818L</span><span class="p">,</span> <span class="mh">0x7f6a0dbbL</span><span class="p">,</span> <span class="mh">0x086d3d2dL</span><span class="p">,</span> <span class="mh">0x91646c97L</span><span class="p">,</span> <span class="mh">0xe6635c01L</span><span class="p">,</span>
	<span class="mh">0x6b6b51f4L</span><span class="p">,</span> <span class="mh">0x1c6c6162L</span><span class="p">,</span> <span class="mh">0x856530d8L</span><span class="p">,</span> <span class="mh">0xf262004eL</span><span class="p">,</span> <span class="mh">0x6c0695edL</span><span class="p">,</span>
	<span class="mh">0x1b01a57bL</span><span class="p">,</span> <span class="mh">0x8208f4c1L</span><span class="p">,</span> <span class="mh">0xf50fc457L</span><span class="p">,</span> <span class="mh">0x65b0d9c6L</span><span class="p">,</span> <span class="mh">0x12b7e950L</span><span class="p">,</span>
	<span class="mh">0x8bbeb8eaL</span><span class="p">,</span> <span class="mh">0xfcb9887cL</span><span class="p">,</span> <span class="mh">0x62dd1ddfL</span><span class="p">,</span> <span class="mh">0x15da2d49L</span><span class="p">,</span> <span class="mh">0x8cd37cf3L</span><span class="p">,</span>
	<span class="mh">0xfbd44c65L</span><span class="p">,</span> <span class="mh">0x4db26158L</span><span class="p">,</span> <span class="mh">0x3ab551ceL</span><span class="p">,</span> <span class="mh">0xa3bc0074L</span><span class="p">,</span> <span class="mh">0xd4bb30e2L</span><span class="p">,</span>
	<span class="mh">0x4adfa541L</span><span class="p">,</span> <span class="mh">0x3dd895d7L</span><span class="p">,</span> <span class="mh">0xa4d1c46dL</span><span class="p">,</span> <span class="mh">0xd3d6f4fbL</span><span class="p">,</span> <span class="mh">0x4369e96aL</span><span class="p">,</span>
	<span class="mh">0x346ed9fcL</span><span class="p">,</span> <span class="mh">0xad678846L</span><span class="p">,</span> <span class="mh">0xda60b8d0L</span><span class="p">,</span> <span class="mh">0x44042d73L</span><span class="p">,</span> <span class="mh">0x33031de5L</span><span class="p">,</span>
	<span class="mh">0xaa0a4c5fL</span><span class="p">,</span> <span class="mh">0xdd0d7cc9L</span><span class="p">,</span> <span class="mh">0x5005713cL</span><span class="p">,</span> <span class="mh">0x270241aaL</span><span class="p">,</span> <span class="mh">0xbe0b1010L</span><span class="p">,</span>
	<span class="mh">0xc90c2086L</span><span class="p">,</span> <span class="mh">0x5768b525L</span><span class="p">,</span> <span class="mh">0x206f85b3L</span><span class="p">,</span> <span class="mh">0xb966d409L</span><span class="p">,</span> <span class="mh">0xce61e49fL</span><span class="p">,</span>
	<span class="mh">0x5edef90eL</span><span class="p">,</span> <span class="mh">0x29d9c998L</span><span class="p">,</span> <span class="mh">0xb0d09822L</span><span class="p">,</span> <span class="mh">0xc7d7a8b4L</span><span class="p">,</span> <span class="mh">0x59b33d17L</span><span class="p">,</span>
	<span class="mh">0x2eb40d81L</span><span class="p">,</span> <span class="mh">0xb7bd5c3bL</span><span class="p">,</span> <span class="mh">0xc0ba6cadL</span><span class="p">,</span> <span class="mh">0xedb88320L</span><span class="p">,</span> <span class="mh">0x9abfb3b6L</span><span class="p">,</span>
	<span class="mh">0x03b6e20cL</span><span class="p">,</span> <span class="mh">0x74b1d29aL</span><span class="p">,</span> <span class="mh">0xead54739L</span><span class="p">,</span> <span class="mh">0x9dd277afL</span><span class="p">,</span> <span class="mh">0x04db2615L</span><span class="p">,</span>
	<span class="mh">0x73dc1683L</span><span class="p">,</span> <span class="mh">0xe3630b12L</span><span class="p">,</span> <span class="mh">0x94643b84L</span><span class="p">,</span> <span class="mh">0x0d6d6a3eL</span><span class="p">,</span> <span class="mh">0x7a6a5aa8L</span><span class="p">,</span>
	<span class="mh">0xe40ecf0bL</span><span class="p">,</span> <span class="mh">0x9309ff9dL</span><span class="p">,</span> <span class="mh">0x0a00ae27L</span><span class="p">,</span> <span class="mh">0x7d079eb1L</span><span class="p">,</span> <span class="mh">0xf00f9344L</span><span class="p">,</span>
	<span class="mh">0x8708a3d2L</span><span class="p">,</span> <span class="mh">0x1e01f268L</span><span class="p">,</span> <span class="mh">0x6906c2feL</span><span class="p">,</span> <span class="mh">0xf762575dL</span><span class="p">,</span> <span class="mh">0x806567cbL</span><span class="p">,</span>
	<span class="mh">0x196c3671L</span><span class="p">,</span> <span class="mh">0x6e6b06e7L</span><span class="p">,</span> <span class="mh">0xfed41b76L</span><span class="p">,</span> <span class="mh">0x89d32be0L</span><span class="p">,</span> <span class="mh">0x10da7a5aL</span><span class="p">,</span>
	<span class="mh">0x67dd4accL</span><span class="p">,</span> <span class="mh">0xf9b9df6fL</span><span class="p">,</span> <span class="mh">0x8ebeeff9L</span><span class="p">,</span> <span class="mh">0x17b7be43L</span><span class="p">,</span> <span class="mh">0x60b08ed5L</span><span class="p">,</span>
	<span class="mh">0xd6d6a3e8L</span><span class="p">,</span> <span class="mh">0xa1d1937eL</span><span class="p">,</span> <span class="mh">0x38d8c2c4L</span><span class="p">,</span> <span class="mh">0x4fdff252L</span><span class="p">,</span> <span class="mh">0xd1bb67f1L</span><span class="p">,</span>
	<span class="mh">0xa6bc5767L</span><span class="p">,</span> <span class="mh">0x3fb506ddL</span><span class="p">,</span> <span class="mh">0x48b2364bL</span><span class="p">,</span> <span class="mh">0xd80d2bdaL</span><span class="p">,</span> <span class="mh">0xaf0a1b4cL</span><span class="p">,</span>
	<span class="mh">0x36034af6L</span><span class="p">,</span> <span class="mh">0x41047a60L</span><span class="p">,</span> <span class="mh">0xdf60efc3L</span><span class="p">,</span> <span class="mh">0xa867df55L</span><span class="p">,</span> <span class="mh">0x316e8eefL</span><span class="p">,</span>
	<span class="mh">0x4669be79L</span><span class="p">,</span> <span class="mh">0xcb61b38cL</span><span class="p">,</span> <span class="mh">0xbc66831aL</span><span class="p">,</span> <span class="mh">0x256fd2a0L</span><span class="p">,</span> <span class="mh">0x5268e236L</span><span class="p">,</span>
	<span class="mh">0xcc0c7795L</span><span class="p">,</span> <span class="mh">0xbb0b4703L</span><span class="p">,</span> <span class="mh">0x220216b9L</span><span class="p">,</span> <span class="mh">0x5505262fL</span><span class="p">,</span> <span class="mh">0xc5ba3bbeL</span><span class="p">,</span>
	<span class="mh">0xb2bd0b28L</span><span class="p">,</span> <span class="mh">0x2bb45a92L</span><span class="p">,</span> <span class="mh">0x5cb36a04L</span><span class="p">,</span> <span class="mh">0xc2d7ffa7L</span><span class="p">,</span> <span class="mh">0xb5d0cf31L</span><span class="p">,</span>
	<span class="mh">0x2cd99e8bL</span><span class="p">,</span> <span class="mh">0x5bdeae1dL</span><span class="p">,</span> <span class="mh">0x9b64c2b0L</span><span class="p">,</span> <span class="mh">0xec63f226L</span><span class="p">,</span> <span class="mh">0x756aa39cL</span><span class="p">,</span>
	<span class="mh">0x026d930aL</span><span class="p">,</span> <span class="mh">0x9c0906a9L</span><span class="p">,</span> <span class="mh">0xeb0e363fL</span><span class="p">,</span> <span class="mh">0x72076785L</span><span class="p">,</span> <span class="mh">0x05005713L</span><span class="p">,</span>
	<span class="mh">0x95bf4a82L</span><span class="p">,</span> <span class="mh">0xe2b87a14L</span><span class="p">,</span> <span class="mh">0x7bb12baeL</span><span class="p">,</span> <span class="mh">0x0cb61b38L</span><span class="p">,</span> <span class="mh">0x92d28e9bL</span><span class="p">,</span>
	<span class="mh">0xe5d5be0dL</span><span class="p">,</span> <span class="mh">0x7cdcefb7L</span><span class="p">,</span> <span class="mh">0x0bdbdf21L</span><span class="p">,</span> <span class="mh">0x86d3d2d4L</span><span class="p">,</span> <span class="mh">0xf1d4e242L</span><span class="p">,</span>
	<span class="mh">0x68ddb3f8L</span><span class="p">,</span> <span class="mh">0x1fda836eL</span><span class="p">,</span> <span class="mh">0x81be16cdL</span><span class="p">,</span> <span class="mh">0xf6b9265bL</span><span class="p">,</span> <span class="mh">0x6fb077e1L</span><span class="p">,</span>
	<span class="mh">0x18b74777L</span><span class="p">,</span> <span class="mh">0x88085ae6L</span><span class="p">,</span> <span class="mh">0xff0f6a70L</span><span class="p">,</span> <span class="mh">0x66063bcaL</span><span class="p">,</span> <span class="mh">0x11010b5cL</span><span class="p">,</span>
	<span class="mh">0x8f659effL</span><span class="p">,</span> <span class="mh">0xf862ae69L</span><span class="p">,</span> <span class="mh">0x616bffd3L</span><span class="p">,</span> <span class="mh">0x166ccf45L</span><span class="p">,</span> <span class="mh">0xa00ae278L</span><span class="p">,</span>
	<span class="mh">0xd70dd2eeL</span><span class="p">,</span> <span class="mh">0x4e048354L</span><span class="p">,</span> <span class="mh">0x3903b3c2L</span><span class="p">,</span> <span class="mh">0xa7672661L</span><span class="p">,</span> <span class="mh">0xd06016f7L</span><span class="p">,</span>
	<span class="mh">0x4969474dL</span><span class="p">,</span> <span class="mh">0x3e6e77dbL</span><span class="p">,</span> <span class="mh">0xaed16a4aL</span><span class="p">,</span> <span class="mh">0xd9d65adcL</span><span class="p">,</span> <span class="mh">0x40df0b66L</span><span class="p">,</span>
	<span class="mh">0x37d83bf0L</span><span class="p">,</span> <span class="mh">0xa9bcae53L</span><span class="p">,</span> <span class="mh">0xdebb9ec5L</span><span class="p">,</span> <span class="mh">0x47b2cf7fL</span><span class="p">,</span> <span class="mh">0x30b5ffe9L</span><span class="p">,</span>
	<span class="mh">0xbdbdf21cL</span><span class="p">,</span> <span class="mh">0xcabac28aL</span><span class="p">,</span> <span class="mh">0x53b39330L</span><span class="p">,</span> <span class="mh">0x24b4a3a6L</span><span class="p">,</span> <span class="mh">0xbad03605L</span><span class="p">,</span>
	<span class="mh">0xcdd70693L</span><span class="p">,</span> <span class="mh">0x54de5729L</span><span class="p">,</span> <span class="mh">0x23d967bfL</span><span class="p">,</span> <span class="mh">0xb3667a2eL</span><span class="p">,</span> <span class="mh">0xc4614ab8L</span><span class="p">,</span>
	<span class="mh">0x5d681b02L</span><span class="p">,</span> <span class="mh">0x2a6f2b94L</span><span class="p">,</span> <span class="mh">0xb40bbe37L</span><span class="p">,</span> <span class="mh">0xc30c8ea1L</span><span class="p">,</span> <span class="mh">0x5a05df1bL</span><span class="p">,</span>
	<span class="mh">0x2d02ef8dL</span>
<span class="p">};</span>

<span class="cm">/* keylen in bytes! */</span>

<span class="kt">int</span> <span class="nf">wep_change_key</span><span class="p">(</span><span class="n">wlandevice_t</span> <span class="o">*</span><span class="n">wlandev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">keynum</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">int</span> <span class="n">keylen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keylen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keylen</span> <span class="o">&gt;=</span> <span class="n">MAX_KEYLEN</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keynum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keynum</span> <span class="o">&gt;=</span> <span class="n">NUM_WEPKEYS</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="cp">#ifdef WEP_DEBUG</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
	       <span class="s">&quot;WEP key %d len %d = %02x:%02x:%02x:%02x:%02x:%02x:%02x:%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">keynum</span><span class="p">,</span> <span class="n">keylen</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
	       <span class="n">key</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
<span class="cp">#endif</span>

	<span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keylens</span><span class="p">[</span><span class="n">keynum</span><span class="p">]</span> <span class="o">=</span> <span class="n">keylen</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keys</span><span class="p">[</span><span class="n">keynum</span><span class="p">],</span> <span class="n">key</span><span class="p">,</span> <span class="n">keylen</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  4-byte IV at start of buffer, 4-byte ICV at end of buffer.</span>
<span class="cm">  if successful, buf start is payload begin, length -= 8;</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wep_decrypt</span><span class="p">(</span><span class="n">wlandevice_t</span> <span class="o">*</span><span class="n">wlandev</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">key_override</span><span class="p">,</span>
		<span class="n">u8</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">icv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">crc</span><span class="p">,</span> <span class="n">keylen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">s</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">c_crc</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">keyidx</span><span class="p">;</span>

	<span class="cm">/* Needs to be at least 8 bytes of payload */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* initialize the first bytes of the key from the IV */</span>
	<span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">keyidx</span> <span class="o">=</span> <span class="n">WEP_KEY</span><span class="p">(</span><span class="n">iv</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">key_override</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">keyidx</span> <span class="o">=</span> <span class="n">key_override</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">keyidx</span> <span class="o">&gt;=</span> <span class="n">NUM_WEPKEYS</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>

	<span class="n">keylen</span> <span class="o">=</span> <span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keylens</span><span class="p">[</span><span class="n">keyidx</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">keylen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>

	<span class="cm">/* copy the rest of the key over from the designated key */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keys</span><span class="p">[</span><span class="n">keyidx</span><span class="p">],</span> <span class="n">keylen</span><span class="p">);</span>

	<span class="n">keylen</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>		<span class="cm">/* add in IV bytes */</span>

<span class="cp">#ifdef WEP_DEBUG</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
	       <span class="s">&quot;D %d: %02x %02x %02x (%d %d) %02x:%02x:%02x:%02x:%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
	       <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">keyidx</span><span class="p">,</span> <span class="n">keylen</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
	       <span class="n">key</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
<span class="cp">#endif</span>

	<span class="cm">/* set up the RC4 state */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">keylen</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Apply the RC4 to the data, update the CRC32 */</span>
	<span class="n">crc</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^=</span> <span class="n">s</span><span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">];</span>
		<span class="n">crc</span> <span class="o">=</span> <span class="n">wep_crc32_table</span><span class="p">[(</span><span class="n">crc</span> <span class="o">^</span> <span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">crc</span> <span class="o">=</span> <span class="o">~</span><span class="n">crc</span><span class="p">;</span>

	<span class="cm">/* now let&#39;s check the crc */</span>
	<span class="n">c_crc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span><span class="p">;</span>
	<span class="n">c_crc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">c_crc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">c_crc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">c_crc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^</span> <span class="n">s</span><span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">])</span> <span class="o">!=</span> <span class="n">icv</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			<span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mi">4</span> <span class="o">|</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>	<span class="cm">/* ICV mismatch */</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* encrypts in-place. */</span>
<span class="kt">int</span> <span class="nf">wep_encrypt</span><span class="p">(</span><span class="n">wlandevice_t</span> <span class="o">*</span><span class="n">wlandev</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">keynum</span><span class="p">,</span>
		<span class="n">u8</span> <span class="o">*</span><span class="n">iv</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">icv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">crc</span><span class="p">,</span> <span class="n">keylen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">s</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="cm">/* no point in WEPping an empty frame */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* we need to have a real key.. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keynum</span> <span class="o">&gt;=</span> <span class="n">NUM_WEPKEYS</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">keylen</span> <span class="o">=</span> <span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keylens</span><span class="p">[</span><span class="n">keynum</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">keylen</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>

	<span class="cm">/* use a random IV.  And skip known weak ones. */</span>
	<span class="n">get_random_bytes</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">iv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">iv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">iv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">keylen</span><span class="p">))</span>
		<span class="n">get_random_bytes</span><span class="p">(</span><span class="n">iv</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">iv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keynum</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">;</span>

	<span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">iv</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* copy the rest of the key over from the designated key */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">wlandev</span><span class="o">-&gt;</span><span class="n">wep_keys</span><span class="p">[</span><span class="n">keynum</span><span class="p">],</span> <span class="n">keylen</span><span class="p">);</span>

	<span class="n">keylen</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>		<span class="cm">/* add in IV bytes */</span>

<span class="cp">#ifdef WEP_DEBUG</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span>
	       <span class="s">&quot;E %d (%d/%d %d) %02x %02x %02x %02x:%02x:%02x:%02x:%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
	       <span class="n">iv</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">keynum</span><span class="p">,</span> <span class="n">keylen</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
	       <span class="n">key</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>
<span class="cp">#endif</span>

	<span class="cm">/* set up the RC4 state */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">keylen</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Update CRC32 then apply RC4 to the data */</span>
	<span class="n">crc</span> <span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">crc</span> <span class="o">=</span> <span class="n">wep_crc32_table</span><span class="p">[(</span><span class="n">crc</span> <span class="o">^</span> <span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">]</span> <span class="o">^</span> <span class="p">(</span><span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
		<span class="n">dst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^</span> <span class="n">s</span><span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">crc</span> <span class="o">=</span> <span class="o">~</span><span class="n">crc</span><span class="p">;</span>

	<span class="cm">/* now let&#39;s encrypt the crc */</span>
	<span class="n">icv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span><span class="p">;</span>
	<span class="n">icv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">icv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">icv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">crc</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">swap</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
		<span class="n">icv</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">^=</span> <span class="n">s</span><span class="p">[(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
