<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › winbond › mds_s.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mds_s.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __WINBOND_MDS_H</span>
<span class="cp">#define __WINBOND_MDS_H</span>

<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/atomic.h&gt;</span>

<span class="cp">#include &quot;localpara.h&quot;</span>
<span class="cp">#include &quot;mac_structures.h&quot;</span>

<span class="cm">/* Preamble_Type, see &lt;SFS-802.11G-MIB-203&gt; */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">WLAN_PREAMBLE_TYPE_SHORT</span><span class="p">,</span>
	<span class="n">WLAN_PREAMBLE_TYPE_LONG</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cp">#define MAX_USB_TX_DESCRIPTOR		15	</span><span class="cm">/* IS89C35 ability */</span><span class="cp"></span>
<span class="cp">#define MAX_USB_TX_BUFFER_NUMBER	4	</span><span class="cm">/* Virtual pre-buffer number of MAX_USB_TX_BUFFER */</span><span class="cp"></span>
<span class="cp">#define MAX_USB_TX_BUFFER		4096	</span><span class="cm">/* IS89C35 ability 4n alignment is required for hardware */</span><span class="cp"></span>

<span class="cp">#define AUTH_REQUEST_PAIRWISE_ERROR	0	</span><span class="cm">/* _F flag setting */</span><span class="cp"></span>
<span class="cp">#define AUTH_REQUEST_GROUP_ERROR	1	</span><span class="cm">/* _F flag setting */</span><span class="cp"></span>

<span class="cp">#define CURRENT_FRAGMENT_THRESHOLD	(adapter-&gt;Mds.TxFragmentThreshold &amp; ~0x1)</span>
<span class="cp">#define CURRENT_PREAMBLE_MODE		(psLOCAL-&gt;boShortPreamble ? WLAN_PREAMBLE_TYPE_SHORT : WLAN_PREAMBLE_TYPE_LONG)</span>
<span class="cp">#define CURRENT_TX_RATE_FOR_MNG		(adapter-&gt;sLocalPara.CurrentTxRateForMng)</span>
<span class="cp">#define CURRENT_PROTECT_MECHANISM	(psLOCAL-&gt;boProtectMechanism)</span>
<span class="cp">#define CURRENT_RTS_THRESHOLD		(adapter-&gt;Mds.TxRTSThreshold)</span>

<span class="cp">#define MIB_GS_XMIT_OK_INC		(adapter-&gt;sLocalPara.GS_XMIT_OK++)</span>
<span class="cp">#define MIB_GS_RCV_OK_INC		(adapter-&gt;sLocalPara.GS_RCV_OK++)</span>
<span class="cp">#define MIB_GS_XMIT_ERROR_INC		(adapter-&gt;sLocalPara.GS_XMIT_ERROR)</span>

<span class="cm">/* ---------- TX ----------------------------------- */</span>
<span class="cp">#define ETHERNET_TX_DESCRIPTORS         MAX_USB_TX_BUFFER_NUMBER</span>

<span class="cm">/* ---------- RX ----------------------------------- */</span>
<span class="cp">#define ETHERNET_RX_DESCRIPTORS		8	</span><span class="cm">/* It&#39;s not necessary to allocate more than 2 in sync indicate */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ================================================================</span>
<span class="cm"> * Configration default value</span>
<span class="cm"> * ================================================================</span>
<span class="cm"> */</span>
<span class="cp">#define DEFAULT_MULTICASTLISTMAX	32	</span><span class="cm">/* standard */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_TX_BURSTLENGTH		3	</span><span class="cm">/* 32 Longwords */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_RX_BURSTLENGTH		3	</span><span class="cm">/* 32 Longwords */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_TX_THRESHOLD		0	</span><span class="cm">/* Full Packet */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_RX_THRESHOLD		0	</span><span class="cm">/* Full Packet */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_MAXTXRATE		6	</span><span class="cm">/* 11 Mbps (Long) */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_CHANNEL			3	</span><span class="cm">/* Chennel 3 */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_RTSThreshold		2347	</span><span class="cm">/* Disable RTS */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_PME			0	</span><span class="cm">/* Disable */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_SIFSTIME		10</span>
<span class="cp">#define DEFAULT_ACKTIME_1ML             304	</span><span class="cm">/* 148 + 44 + 112 */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_ACKTIME_2ML             248	</span><span class="cm">/* 148 + 44 + 56 */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_FRAGMENT_THRESHOLD      2346	</span><span class="cm">/* No fragment */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_PREAMBLE_LENGTH		72</span>
<span class="cp">#define DEFAULT_PLCPHEADERTIME_LENGTH	24</span>

<span class="cm">/*</span>
<span class="cm"> * ------------------------------------------------------------------------</span>
<span class="cm"> * 0.96 sec since time unit of the R03 for the current, W89C32 is about 60ns</span>
<span class="cm"> * instead of 960 ns. This shall be fixed in the future W89C32</span>
<span class="cm"> * -------------------------------------------------------------------------</span>
<span class="cm"> */</span>
<span class="cp">#define DEFAULT_MAX_RECEIVE_TIME	16440000</span>

<span class="cp">#define RX_BUF_SIZE			2352	</span><span class="cm">/* 600 - For 301 must be multiple of 8 */</span><span class="cp"></span>
<span class="cp">#define MAX_RX_DESCRIPTORS		18	</span><span class="cm">/* Rx Layer 2 */</span><span class="cp"></span>

<span class="cm">/* For brand-new rx system */</span>
<span class="cp">#define MDS_ID_IGNORE			ETHERNET_RX_DESCRIPTORS</span>

<span class="cm">/* For Tx Packet status classify */</span>
<span class="cp">#define PACKET_FREE_TO_USE		0</span>
<span class="cp">#define PACKET_COME_FROM_NDIS		0x08</span>
<span class="cp">#define PACKET_COME_FROM_MLME		0x80</span>
<span class="cp">#define PACKET_SEND_COMPLETE		0xff</span>

<span class="k">struct</span> <span class="n">wb35_mds</span> <span class="p">{</span>
	<span class="cm">/* For Tx usage */</span>
	<span class="n">u8</span>	<span class="n">TxOwner</span><span class="p">[((</span><span class="n">MAX_USB_TX_BUFFER_NUMBER</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x03</span><span class="p">)];</span>
	<span class="n">u8</span>	<span class="o">*</span><span class="n">pTxBuffer</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">TxBufferSize</span><span class="p">[((</span><span class="n">MAX_USB_TX_BUFFER_NUMBER</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">)];</span>
	<span class="n">u8</span>	<span class="n">TxDesFrom</span><span class="p">[((</span><span class="n">MAX_USB_TX_DESCRIPTOR</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x03</span><span class="p">)];</span><span class="cm">/* 1: MLME 2: NDIS control 3: NDIS data */</span>
	<span class="n">u8</span>	<span class="n">TxCountInBuffer</span><span class="p">[((</span><span class="n">MAX_USB_TX_DESCRIPTOR</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x03</span><span class="p">)];</span>

	<span class="n">u8</span>	<span class="n">TxFillIndex</span><span class="p">;</span>	<span class="cm">/* the next index of TxBuffer can be used */</span>
	<span class="n">u8</span>	<span class="n">TxDesIndex</span><span class="p">;</span>	<span class="cm">/* The next index of TxDes can be used */</span>
	<span class="n">u8</span>	<span class="n">ScanTxPause</span><span class="p">;</span>	<span class="cm">/* data Tx pause because the scanning is progressing, but probe request Tx won&#39;t. */</span>
	<span class="n">u8</span>	<span class="n">TxPause</span><span class="p">;</span>	<span class="cm">/*For pause the Mds_Tx modult */</span>

	<span class="n">atomic_t</span>	<span class="n">TxThreadCount</span><span class="p">;</span>	<span class="cm">/* For thread counting */</span>

	<span class="n">u16</span>	<span class="n">TxResult</span><span class="p">[((</span><span class="n">MAX_USB_TX_DESCRIPTOR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">)];</span><span class="cm">/* Collect the sending result of Mpdu */</span>

	<span class="n">u8</span>	<span class="n">MicRedundant</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span> <span class="cm">/* For tmp use */</span>
	<span class="n">u8</span>	<span class="o">*</span><span class="n">MicWriteAddress</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* The start address to fill the Mic, use 2 point due to Mic maybe fragment */</span>

	<span class="n">u16</span>	<span class="n">MicWriteSize</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">u16</span>	<span class="n">MicAdd</span><span class="p">;</span> <span class="cm">/* If want to add the Mic, this variable equal to 8 */</span>
	<span class="n">u16</span>	<span class="n">MicWriteIndex</span><span class="p">;</span> <span class="cm">/* The number of MicWriteAddress */</span>

	<span class="n">u8</span>	<span class="n">TxRate</span><span class="p">[((</span><span class="n">MAX_USB_TX_DESCRIPTOR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">)][</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* [0] current tx rate, [1] fall back rate */</span>
	<span class="n">u8</span>	<span class="n">TxInfo</span><span class="p">[((</span><span class="n">MAX_USB_TX_DESCRIPTOR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">)];</span> <span class="cm">/*Store information for callback function */</span>

	<span class="cm">/* ---- for Tx Parameter */</span>
	<span class="n">u16</span>	<span class="n">TxFragmentThreshold</span><span class="p">;</span>	<span class="cm">/* For frame body only */</span>
	<span class="n">u16</span>	<span class="n">TxRTSThreshold</span><span class="p">;</span>

	<span class="n">u32</span>	<span class="n">MaxReceiveTime</span><span class="p">;</span>

	<span class="cm">/* depend on OS, */</span>
	<span class="n">u32</span>	<span class="n">MulticastListNo</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">PacketFilter</span><span class="p">;</span> <span class="cm">/* Setting by NDIS, the current packet filter in use. */</span>
	<span class="n">u8</span>	<span class="n">MulticastAddressesArray</span><span class="p">[</span><span class="n">DEFAULT_MULTICASTLISTMAX</span><span class="p">][</span><span class="n">MAC_ADDR_LENGTH</span><span class="p">];</span>

	<span class="cm">/* COUNTERMEASURE */</span>
	<span class="n">u8</span>	<span class="n">bMICfailCount</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">boCounterMeasureBlock</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved_4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">u32</span>	<span class="n">TxTsc</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">TxTsc_2</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
