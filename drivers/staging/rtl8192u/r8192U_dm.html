<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8192u › r8192U_dm.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>r8192U_dm.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*++</span>
<span class="cm">Copyright-c Realtek Semiconductor Corp. All rights reserved.</span>

<span class="cm">Module Name:</span>
<span class="cm">	r8192U_dm.c</span>

<span class="cm">Abstract:</span>
<span class="cm">	HW dynamic mechanism.</span>

<span class="cm">Major Change History:</span>
<span class="cm">	When      	Who				What</span>
<span class="cm">	----------	--------------- -------------------------------</span>
<span class="cm">	2008-05-14	amy                     create version 0 porting from windows code.</span>

<span class="cm">--*/</span>
<span class="cp">#include &quot;r8192U.h&quot;</span>
<span class="cp">#include &quot;r8192U_dm.h&quot;</span>
<span class="cp">#include &quot;r8192U_hw.h&quot;</span>
<span class="cp">#include &quot;r819xU_phy.h&quot;</span>
<span class="cp">#include &quot;r819xU_phyreg.h&quot;</span>
<span class="cp">#include &quot;r8190_rtl8256.h&quot;</span>
<span class="cp">#include &quot;r819xU_cmdpkt.h&quot;</span>
<span class="cm">/*---------------------------Define Local Constant---------------------------*/</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Indicate different AP vendor for IOT issue.</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="n">u32</span> <span class="n">edca_setting_DL</span><span class="p">[</span><span class="n">HT_IOT_PEER_MAX</span><span class="p">]</span> <span class="o">=</span>
		<span class="p">{</span> <span class="mh">0x5e4322</span><span class="p">,</span> 	<span class="mh">0x5e4322</span><span class="p">,</span> 	<span class="mh">0x5e4322</span><span class="p">,</span> 	<span class="mh">0x604322</span><span class="p">,</span> 	<span class="mh">0xa44f</span><span class="p">,</span> 	<span class="mh">0x5ea44f</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u32</span> <span class="n">edca_setting_UL</span><span class="p">[</span><span class="n">HT_IOT_PEER_MAX</span><span class="p">]</span> <span class="o">=</span>
		<span class="p">{</span> <span class="mh">0x5e4322</span><span class="p">,</span> 	<span class="mh">0xa44f</span><span class="p">,</span> 	<span class="mh">0x5e4322</span><span class="p">,</span> 	<span class="mh">0x604322</span><span class="p">,</span> 	<span class="mh">0x5ea44f</span><span class="p">,</span> 	<span class="mh">0x5ea44f</span><span class="p">};</span>


<span class="cp">#define RTK_UL_EDCA 0xa44f</span>
<span class="cp">#define RTK_DL_EDCA 0x5e4322</span>
<span class="cm">/*---------------------------Define Local Constant---------------------------*/</span>


<span class="cm">/*------------------------Define global variable-----------------------------*/</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Debug variable ?</p></td><td class="code"><div class="highlight"><pre><span class="n">dig_t</span>	<span class="n">dm_digtable</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Store current software write register content for MAC PHY.</p></td><td class="code"><div class="highlight"><pre><span class="n">u8</span>		<span class="n">dm_shadow</span><span class="p">[</span><span class="mi">16</span><span class="p">][</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{{</span><span class="mi">0</span><span class="p">}};</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>For Dynamic Rx Path Selection by Signal Strength</p></td><td class="code"><div class="highlight"><pre><span class="n">DRxPathSel</span>	<span class="n">DM_RxPathSelTable</span><span class="p">;</span>
<span class="cm">/*------------------------Define global variable-----------------------------*/</span>


<span class="cm">/*------------------------Define local variable------------------------------*/</span>
<span class="cm">/*------------------------Define local variable------------------------------*/</span>


<span class="cm">/*--------------------Define export function prototype-----------------------*/</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">init_hal_dm</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span> <span class="n">deinit_hal_dm</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">hal_dm_watchdog</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>


<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">init_rate_adaptive</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_txpower_trackingcallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>

<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span><span class="n">bool</span>  <span class="n">binch14</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_restore_dynamic_mechanism_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_backup_dynamic_mechanism_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_change_dynamic_initgain_thresh</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
								<span class="n">u32</span>		<span class="n">dm_type</span><span class="p">,</span>
								<span class="n">u32</span>		<span class="n">dm_value</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">DM_ChangeFsyncSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
												<span class="n">s32</span>		<span class="n">DM_Type</span><span class="p">,</span>
												<span class="n">s32</span>		<span class="n">DM_Value</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span> <span class="n">dm_force_tx_fw_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
										<span class="n">u32</span>		<span class="n">force_type</span><span class="p">,</span>
										<span class="n">u32</span>		<span class="n">force_value</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_init_edca_turbo</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_rf_operation_test_callback</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_rf_pathcheck_workitemcallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span> <span class="n">dm_fsync_timer_callback</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span> <span class="n">dm_check_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="n">dm_shadow_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>


<span class="cm">/*--------------------Define export function prototype-----------------------*/</span>


<span class="cm">/*---------------------Define local function prototype-----------------------*/</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>DM --> Rate Adaptive</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_rate_adaptive</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>DM --> Bandwidth switch</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_init_bandwidth_autoswitch</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_bandwidth_autoswitch</span><span class="p">(</span>	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>DM --> TX power control
static    void    dm<em>initialize</em>txpower<em>tracking(struct net</em>device *dev);</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_txpower_tracking</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>static    void    dm<em>txpower</em>reset<em>recovery(struct net</em>device *dev);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>DM --> BB init gain restore</p></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef RTL8192U</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_bb_initialgain_restore</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>DM --> BB init gain backup</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_bb_initialgain_backup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>DM --> Dynamic Init Gain by RSSI</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_dig_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_ctrl_initgain_byrssi</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_ctrl_initgain_byrssi_highpwr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_ctrl_initgain_byrssi_by_driverrssi</span><span class="p">(</span>	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_ctrl_initgain_byrssi_by_fwfalse_alarm</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_initial_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_pd_th</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_cs_ratio</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">static</span>	<span class="kt">void</span> <span class="n">dm_init_ctstoself</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>DM --> EDCA turbo mode control</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_edca_turbo</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>DM --> HW RF control</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_rfctrl_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cp">#ifndef RTL8190P</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>static    void    dm<em>gpio</em>change<em>rf(struct net</em>device *dev);</p></td><td class="code"><div class="highlight"><pre><span class="cp">#endif</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>DM --> Check PBC</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span> <span class="n">dm_check_pbc_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>DM --> Check current RX RF path state</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_rx_path_selection</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> 	<span class="kt">void</span> <span class="n">dm_init_rxpath_selection</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span> <span class="n">dm_rxpath_sel_byrssi</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>DM --> Fsync for broadcom ap</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="n">dm_init_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">dm_deInit_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>Added by vivi, 20080522</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_check_txrateandretrycount</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/*---------------------Define local function prototype-----------------------*/</span>

<span class="cm">/*---------------------Define of Tx Power Control For Near/Far Range --------*/</span>   <span class="c1">//Add by Jacken 2008/02/18</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_init_dynamic_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_dynamic_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>DM --> For rate adaptive and DIG, we must send RSSI to firmware</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span>	<span class="kt">void</span> <span class="n">dm_send_rssi_tofw</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="n">dm_ctstoself</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cm">/*---------------------------Define function prototype------------------------*/</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>================================================================================</p>

<h1>HW Dynamic mechanism interface.</h1></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Description:
    Prepare SW resource for HW dynamic mechanism.</p>

<p>Assumption:
    This function is only invoked at driver intialization once.</p></td><td class="code"><div class="highlight"><pre><span class="k">extern</span>	<span class="kt">void</span>
<span class="nf">init_hal_dm</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Undecorated Smoothed Signal Strength, it can utilized to dynamic mechanism.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Initial TX Power Control for near/far range , add by amy 2008/05/15, porting from windows code.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_init_dynamic_txpower</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">init_rate_adaptive</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>dm<em>initialize</em>txpower_tracking(dev);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_dig_init</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_init_edca_turbo</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_init_bandwidth_autoswitch</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_init_fsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_init_rxpath_selection</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_init_ctstoself</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>	<span class="c1">// InitHalDm</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">deinit_hal_dm</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">dm_deInit_fsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>


<span class="cp">#ifdef USB_RX_AGGREGATION_SUPPORT</span>
<span class="kt">void</span> <span class="nf">dm_CheckRxAggregation</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">((</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">	if (pHalData-&gt;bForcedUsbRxAggr) {</span>
<span class="cm">		if (pHalData-&gt;ForcedUsbRxAggrInfo == 0) {</span>
<span class="cm">			if (pHalData-&gt;bCurrentRxAggrEnable) {</span>
<span class="cm">				Adapter-&gt;HalFunc.HalUsbRxAggrHandler(Adapter, FALSE);</span>
<span class="cm">			}</span>
<span class="cm">		} else {</span>
<span class="cm">			if (!pHalData-&gt;bCurrentRxAggrEnable || (pHalData-&gt;ForcedUsbRxAggrInfo != pHalData-&gt;LastUsbRxAggrInfoSetting)) {</span>
<span class="cm">				Adapter-&gt;HalFunc.HalUsbRxAggrHandler(Adapter, TRUE);</span>
<span class="cm">			}</span>
<span class="cm">		}</span>
<span class="cm">		return;</span>
<span class="cm">	}</span>

<span class="cm">*/</span>
	<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span> <span class="o">-</span> <span class="n">lastTxOkCnt</span><span class="p">;</span>
	<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span> <span class="o">-</span> <span class="n">lastRxOkCnt</span><span class="p">;</span>

	<span class="k">if</span><span class="p">((</span><span class="n">curTxOkCnt</span> <span class="o">+</span> <span class="n">curRxOkCnt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">15000000</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">curTxOkCnt</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="o">*</span><span class="n">curRxOkCnt</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bCurrentRxAggrEnable</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a8</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bCurrentRxAggrEnable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bCurrentRxAggrEnable</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">ulValue</span><span class="p">;</span>
			<span class="n">ulValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrEn</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrPageNum</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
				<span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrPacketNum</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrTimeout</span><span class="p">);</span>
			<span class="cm">/*</span>
<span class="cm">			 * If usb rx firmware aggregation is enabled,</span>
<span class="cm">			 * when anyone of three threshold conditions above is reached,</span>
<span class="cm">			 * firmware will send aggregated packet to driver.</span>
<span class="cm">			 */</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a8</span><span class="p">,</span> <span class="n">ulValue</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bCurrentRxAggrEnable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span><span class="p">;</span>
	<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span><span class="p">;</span>
<span class="p">}</span>	<span class="c1">// dm_CheckEdcaTurbo</span>
<span class="cp">#endif</span>



<span class="k">extern</span>  <span class="kt">void</span>    <span class="nf">hal_dm_watchdog</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>struct r8192<em>priv *priv = ieee80211</em>priv(dev);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>static u8     previous_bssid[6] ={0};</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/*Add by amy 2008/05/15 ,porting from windows code.*/</span>
	<span class="n">dm_check_rate_adaptive</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_dynamic_txpower</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_txrateandretrycount</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_txpower_tracking</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_ctrl_initgain_byrssi</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_edca_turbo</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_bandwidth_autoswitch</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_rfctrl_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_rx_path_selection</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_check_fsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Add by amy 2008-05-15 porting from windows code.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_check_pbc_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_send_rssi_tofw</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_ctstoself</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef USB_RX_AGGREGATION_SUPPORT</span>
	<span class="n">dm_CheckRxAggregation</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>	<span class="c1">//HalDmWatchDog</span>


<span class="cm">/*</span>
<span class="cm">  * Decide Rate Adaptive Set according to distance (signal strength)</span>
<span class="cm">  *	01/11/2008	MHC		Modify input arguments and RATR table level.</span>
<span class="cm">  *	01/16/2008	MHC		RF_Type is assigned in ReadAdapterInfo(). We must call</span>
<span class="cm">  *						the function after making sure RF_Type.</span>
<span class="cm">  */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="nf">init_rate_adaptive</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">prate_adaptive</span>	<span class="n">pra</span> <span class="o">=</span> <span class="p">(</span><span class="n">prate_adaptive</span><span class="p">)</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_adaptive</span><span class="p">;</span>

	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_MAX</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">high2low_rssi_thresh_for_ra</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_High</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low2high_rssi_thresh_for_ra20M</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_Low_20M</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low2high_rssi_thresh_for_ra40M</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_Low_40M</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>

	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">high_rssi_thresh_for_ra</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_High</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra20M</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_Low_20M</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra40M</span> <span class="o">=</span> <span class="n">RateAdaptiveTH_Low_40M</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">==</span> <span class="n">RT_CID_819x_Netcore</span><span class="p">)</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_enable</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_thresh_for_ra</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>07/10/08 MH Modify for RA smooth scheme.</p></td><td class="code"><div class="highlight"><pre>		<span class="cm">/* 2008/01/11 MH Modify 2T RATR table for different RSSI. 080515 porting by amy from windows code.*/</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">upper_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x8f0f0000</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">middle_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x8f0ff000</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x8f0ff001</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_40M</span>	<span class="o">=</span> 	<span class="mh">0x8f0ff005</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_20M</span>	<span class="o">=</span> 	<span class="mh">0x8f0ff001</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_ratr</span>	<span class="o">=</span> 	<span class="mh">0x0000000d</span><span class="p">;</span><span class="c1">//cosa add for test</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">upper_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x000f0000</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">middle_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x000ff000</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr</span>		<span class="o">=</span> 	<span class="mh">0x000ff001</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_40M</span>	<span class="o">=</span> 	<span class="mh">0x000ff005</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_20M</span>	<span class="o">=</span> 	<span class="mh">0x000ff001</span><span class="p">;</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_ratr</span>	<span class="o">=</span> 	<span class="mh">0x0000000d</span><span class="p">;</span><span class="c1">//cosa add for test</span>
	<span class="p">}</span>

<span class="p">}</span>	<span class="c1">// InitRateAdaptive</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_check_rate_adaptive()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/26/08	amy 	Create version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_check_rate_adaptive</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">prate_adaptive</span>			<span class="n">pra</span> <span class="o">=</span> <span class="p">(</span><span class="n">prate_adaptive</span><span class="p">)</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_adaptive</span><span class="p">;</span>
	<span class="n">u32</span>						<span class="n">currentRATR</span><span class="p">,</span> <span class="n">targetRATR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span>						<span class="n">LowRSSIThreshForRA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HighRSSIThreshForRA</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span>						<span class="n">bshort_gi_enabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span>					<span class="n">ping_rssi_state</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RATE</span><span class="p">,</span> <span class="s">&quot;&lt;---- dm_check_rate_adaptive(): driver is going to unload</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">rate_adaptive_disabled</span><span class="p">)</span><span class="c1">//this variable is set by ioctl.</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>TODO: Only 11n mode is implemented currently,</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WIRELESS_MODE_N_24G</span> <span class="o">||</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WIRELESS_MODE_N_5G</span><span class="p">))</span>
		 <span class="k">return</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span> <span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>RT<em>TRACE(COMP</em>RATE, "dm_CheckRateAdaptive(): \t");</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>Check whether Short GI is enabled</p></td><td class="code"><div class="highlight"><pre>		<span class="n">bshort_gi_enabled</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">&amp;&amp;</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="o">!</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">&amp;&amp;</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="p">);</span>


		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">upper_rssi_threshold_ratr</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">upper_rssi_threshold_ratr</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BIT31</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">bshort_gi_enabled</span><span class="p">)</span><span class="o">?</span> <span class="n">BIT31</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">middle_rssi_threshold_ratr</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">middle_rssi_threshold_ratr</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BIT31</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">bshort_gi_enabled</span><span class="p">)</span><span class="o">?</span> <span class="n">BIT31</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_40M</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BIT31</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">bshort_gi_enabled</span><span class="p">)</span><span class="o">?</span> <span class="n">BIT31</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr_20M</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BIT31</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">bshort_gi_enabled</span><span class="p">)</span><span class="o">?</span> <span class="n">BIT31</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>cosa add for test</p></td><td class="code"><div class="highlight"><pre>		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_ratr</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_ratr</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BIT31</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">bshort_gi_enabled</span><span class="p">)</span><span class="o">?</span> <span class="n">BIT31</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span> <span class="p">;</span>

		<span class="cm">/* 2007/10/08 MH We support RA smooth scheme now. When it is the first</span>
<span class="cm">		   time to link with AP. We will not change upper/lower threshold. If</span>
<span class="cm">		   STA stay in high or low level, we must change two different threshold</span>
<span class="cm">		   to prevent jumping frequently. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">==</span> <span class="n">DM_RATR_STA_HIGH</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">HighRSSIThreshForRA</span> 	<span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">high2low_rssi_thresh_for_ra</span><span class="p">;</span>
			<span class="n">LowRSSIThreshForRA</span>	<span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span><span class="o">?</span>
					<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra40M</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra20M</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">==</span> <span class="n">DM_RATR_STA_LOW</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">HighRSSIThreshForRA</span>	<span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">high_rssi_thresh_for_ra</span><span class="p">;</span>
			<span class="n">LowRSSIThreshForRA</span> 	<span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span><span class="o">?</span>
					<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low2high_rssi_thresh_for_ra40M</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low2high_rssi_thresh_for_ra20M</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">HighRSSIThreshForRA</span>	<span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">high_rssi_thresh_for_ra</span><span class="p">;</span>
			<span class="n">LowRSSIThreshForRA</span>	<span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span><span class="o">?</span>
					<span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra40M</span><span class="p">)</span><span class="o">:</span><span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_thresh_for_ra20M</span><span class="p">);</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>DbgPrint("[DM] THresh H/L=%d/%d\n\r", RATR.HighRSSIThreshForRA, RATR.LowRSSIThreshForRA);</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">HighRSSIThreshForRA</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>DbgPrint("[DM] RSSI=%d STA=HIGH\n\r", pHalData->UndecoratedSmoothedPWDB);</p></td><td class="code"><div class="highlight"><pre>			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_HIGH</span><span class="p">;</span>
			<span class="n">targetRATR</span> <span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">upper_rssi_threshold_ratr</span><span class="p">;</span>
		<span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">LowRSSIThreshForRA</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>DbgPrint("[DM] RSSI=%d STA=Middle\n\r", pHalData->UndecoratedSmoothedPWDB);</p></td><td class="code"><div class="highlight"><pre>			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_MIDDLE</span><span class="p">;</span>
			<span class="n">targetRATR</span> <span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">middle_rssi_threshold_ratr</span><span class="p">;</span>
		<span class="p">}</span><span class="k">else</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>DbgPrint("[DM] RSSI=%d STA=LOW\n\r", pHalData->UndecoratedSmoothedPWDB);</p></td><td class="code"><div class="highlight"><pre>			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_LOW</span><span class="p">;</span>
			<span class="n">targetRATR</span> <span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">low_rssi_threshold_ratr</span><span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>cosa add for test</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_enable</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>pHalData->UndecoratedSmoothedPWDB = 19;</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_thresh_for_ra</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_thresh_for_ra</span><span class="p">)</span> <span class="o">||</span>
					<span class="n">ping_rssi_state</span> <span class="p">)</span>
				<span class="p">{</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>DbgPrint("TestRSSI = %d, set RATR to 0x%x \n", pHalData->UndecoratedSmoothedPWDB, pRA->TestRSSIRATR);</p></td><td class="code"><div class="highlight"><pre>					<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_LOW</span><span class="p">;</span>
					<span class="n">targetRATR</span> <span class="o">=</span> <span class="n">pra</span><span class="o">-&gt;</span><span class="n">ping_rssi_ratr</span><span class="p">;</span>
					<span class="n">ping_rssi_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>else
DbgPrint("TestRSSI is between the range. \n");</p></td><td class="code"><div class="highlight"><pre>			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>DbgPrint("TestRSSI Recover to 0x%x \n", targetRATR);</p></td><td class="code"><div class="highlight"><pre>				<span class="n">ping_rssi_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>2008.04.01
For RTL819X, if pairwisekey = wep/tkip, we support only MCS0~7.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">))</span>
			<span class="n">targetRATR</span> <span class="o">&amp;=</span>  <span class="mh">0xf00fffff</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>Check whether updating of RATR0 is required</p></td><td class="code"><div class="highlight"><pre>		<span class="n">currentRATR</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span> <span class="n">targetRATR</span> <span class="o">!=</span>  <span class="n">currentRATR</span> <span class="p">)</span>
		<span class="p">{</span>
			<span class="n">u32</span> <span class="n">ratr_value</span><span class="p">;</span>
			<span class="n">ratr_value</span> <span class="o">=</span> <span class="n">targetRATR</span><span class="p">;</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RATE</span><span class="p">,</span><span class="s">&quot;currentRATR = %x, targetRATR = %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">currentRATR</span><span class="p">,</span> <span class="n">targetRATR</span><span class="p">);</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">RATE_ALL_OFDM_2SS</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="p">,</span> <span class="n">ratr_value</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

			<span class="n">pra</span><span class="o">-&gt;</span><span class="n">last_ratr</span> <span class="o">=</span> <span class="n">targetRATR</span><span class="p">;</span>
		<span class="p">}</span>

	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pra</span><span class="o">-&gt;</span><span class="n">ratr_state</span> <span class="o">=</span> <span class="n">DM_RATR_STA_MAX</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>	<span class="c1">// dm_CheckRateAdaptive</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_init_bandwidth_autoswitch</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">threshold_20Mhzto40Mhz</span> <span class="o">=</span> <span class="n">BW_AUTO_SWITCH_LOW_HIGH</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">threshold_40Mhzto20Mhz</span> <span class="o">=</span> <span class="n">BW_AUTO_SWITCH_HIGH_LOW</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bforced_tx20Mhz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bautoswitch_enable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="p">}</span>	<span class="c1">// dm_init_bandwidth_autoswitch</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_bandwidth_autoswitch</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20</span> <span class="o">||!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bautoswitch_enable</span><span class="p">){</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span><span class="k">else</span><span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bforced_tx20Mhz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">){</span><span class="c1">//If send packets in 40 Mhz in 20/40</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">threshold_40Mhzto20Mhz</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bforced_tx20Mhz</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span><span class="k">else</span><span class="p">{</span><span class="c1">//in force send packets in 20 Mhz in 20/40</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">threshold_20Mhzto40Mhz</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bandwidth_auto_switch</span><span class="p">.</span><span class="n">bforced_tx20Mhz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>	<span class="c1">// dm_BandwidthAutoSwitch</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>OFDM default at 0db, index=6.</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="n">u32</span> <span class="n">OFDMSwingTable</span><span class="p">[</span><span class="n">OFDM_Table_Length</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x7f8001fe</span><span class="p">,</span>	<span class="c1">// 0, +6db</span>
	<span class="mh">0x71c001c7</span><span class="p">,</span>	<span class="c1">// 1, +5db</span>
	<span class="mh">0x65400195</span><span class="p">,</span>	<span class="c1">// 2, +4db</span>
	<span class="mh">0x5a400169</span><span class="p">,</span>	<span class="c1">// 3, +3db</span>
	<span class="mh">0x50800142</span><span class="p">,</span>	<span class="c1">// 4, +2db</span>
	<span class="mh">0x47c0011f</span><span class="p">,</span>	<span class="c1">// 5, +1db</span>
	<span class="mh">0x40000100</span><span class="p">,</span>	<span class="c1">// 6, +0db ===&gt; default, upper for higher temperature, lower for low temperature</span>
	<span class="mh">0x390000e4</span><span class="p">,</span>	<span class="c1">// 7, -1db</span>
	<span class="mh">0x32c000cb</span><span class="p">,</span>	<span class="c1">// 8, -2db</span>
	<span class="mh">0x2d4000b5</span><span class="p">,</span>	<span class="c1">// 9, -3db</span>
	<span class="mh">0x288000a2</span><span class="p">,</span>	<span class="c1">// 10, -4db</span>
	<span class="mh">0x24000090</span><span class="p">,</span>	<span class="c1">// 11, -5db</span>
	<span class="mh">0x20000080</span><span class="p">,</span>	<span class="c1">// 12, -6db</span>
	<span class="mh">0x1c800072</span><span class="p">,</span>	<span class="c1">// 13, -7db</span>
	<span class="mh">0x19800066</span><span class="p">,</span>	<span class="c1">// 14, -8db</span>
	<span class="mh">0x26c0005b</span><span class="p">,</span>	<span class="c1">// 15, -9db</span>
	<span class="mh">0x24400051</span><span class="p">,</span>	<span class="c1">// 16, -10db</span>
	<span class="mh">0x12000048</span><span class="p">,</span>	<span class="c1">// 17, -11db</span>
	<span class="mh">0x10000040</span>	<span class="c1">// 18, -12db</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span>	<span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">CCK_Table_length</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>	<span class="c1">// 0, +0db ===&gt; CCK40M default</span>
	<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>	<span class="c1">// 1, -1db</span>
	<span class="p">{</span><span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>	<span class="c1">// 2, -2db</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>	<span class="c1">// 3, -3db</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>	<span class="c1">// 4, -4db</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>	<span class="c1">// 5, -5db</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>	<span class="c1">// 6, -6db ===&gt; CCK20M default</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>	<span class="c1">// 7, -7db</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>	<span class="c1">// 8, -8db</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>	<span class="c1">// 9, -9db</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>	<span class="c1">// 10, -10db</span>
	<span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">}</span>	<span class="c1">// 11, -11db</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span>	<span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">CCK_Table_length</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 0, +0db  ===&gt; CCK40M default</span>
	<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 1, -1db</span>
	<span class="p">{</span><span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 2, -2db</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 3, -3db</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 4, -4db</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 5, -5db</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 6, -6db  ===&gt; CCK20M default</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 7, -7db</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 8, -8db</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 9, -9db</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="c1">// 10, -10db</span>
	<span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>	<span class="c1">// 11, -11db</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_TXPowerTrackingCallback_TSSI</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">bool</span>						<span class="n">bHighpowerstate</span><span class="p">,</span> <span class="n">viviflag</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
	<span class="n">DCMD_TXCMD_T</span>			<span class="n">tx_cmd</span><span class="p">;</span>
	<span class="n">u8</span>						<span class="n">powerlevelOFDM24G</span><span class="p">;</span>
	<span class="kt">int</span>						<span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>						<span class="n">RF_Type</span><span class="p">,</span> <span class="n">tmp_report</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
	<span class="n">u32</span>						<span class="n">Value</span><span class="p">;</span>
	<span class="n">u8</span>						<span class="n">Pwr_Flag</span><span class="p">;</span>
	<span class="n">u16</span>						<span class="n">Avg_TSSI_Meas</span><span class="p">,</span> <span class="n">TSSI_13dBm</span><span class="p">,</span> <span class="n">Avg_TSSI_Meas_from_driver</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>RT<em>STATUS                 rtStatus = RT</em>STATUS_SUCCESS;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">bool</span> <span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u32</span>						<span class="n">delta</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">bHighpowerstate</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span><span class="p">;</span>

	<span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">Pwr_Track</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="p">);</span>
	<span class="n">RF_Type</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span><span class="p">;</span>
	<span class="n">Value</span> <span class="o">=</span> <span class="p">(</span><span class="n">RF_Type</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">powerlevelOFDM24G</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;powerlevelOFDM24G = %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">powerlevelOFDM24G</span><span class="p">);</span>

	<span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;=</span><span class="mi">30</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>	<span class="c1">//fill tx_cmd</span>

	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Op</span>		<span class="o">=</span> <span class="n">TXCMD_SET_TX_PWR_TRACKING</span><span class="p">;</span>
	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Length</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Value</span>		<span class="o">=</span> <span class="n">Value</span><span class="p">;</span>
<span class="cp">#ifdef RTL8192U</span>
	<span class="n">rtStatus</span> <span class="o">=</span> <span class="n">SendTxCommandPacket</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tx_cmd</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rtStatus</span> <span class="o">==</span> <span class="n">RT_STATUS_FAILURE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Set configuration with tx cmd queue fail!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#else</span>
	<span class="n">cmpk_message_handle_tx</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tx_cmd</span><span class="p">,</span>
								<span class="n">DESC_PACKET_TYPE_INIT</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DCMD_TXCMD_T</span><span class="p">));</span>
<span class="cp">#endif</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>DbgPrint("hi, vivi, strange\n");</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">Pwr_Flag</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">Pwr_Flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
<span class="cp">#ifdef RTL8190P</span>
		<span class="n">Avg_TSSI_Meas</span> <span class="o">=</span> <span class="n">read_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1bc</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="n">Avg_TSSI_Meas</span> <span class="o">=</span> <span class="n">read_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13c</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="k">if</span><span class="p">(</span><span class="n">Avg_TSSI_Meas</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
<span class="cp">#ifdef RTL8190P</span>
			<span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1d8</span><span class="o">+</span><span class="n">k</span><span class="p">);</span>
<span class="cp">#else</span>
			<span class="k">if</span><span class="p">(</span><span class="n">k</span> <span class="o">!=</span><span class="mi">4</span><span class="p">)</span>
				<span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x134</span><span class="o">+</span><span class="n">k</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13e</span><span class="p">);</span>
<span class="cp">#endif</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;TSSI_report_value = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]);</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>check if the report value is right</p></td><td class="code"><div class="highlight"><pre>		<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">viviflag</span> <span class="o">=</span><span class="n">TRUE</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="n">viviflag</span> <span class="o">==</span><span class="n">TRUE</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">viviflag</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;we filtered the data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
				<span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">+=</span> <span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">=</span> <span class="n">Avg_TSSI_Meas_from_driver</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="mi">5</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Avg_TSSI_Meas_from_driver = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">Avg_TSSI_Meas_from_driver</span><span class="p">);</span>
		<span class="n">TSSI_13dBm</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TSSI_13dBm</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;TSSI_13dBm = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TSSI_13dBm</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>if(abs(Avg<em>TSSI</em>Meas<em>from</em>driver - TSSI<em>13dBm) &lt;= E</em>FOR<em>TX</em>POWER_TRACK)
For MacOS-compatible</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">&gt;</span> <span class="n">TSSI_13dBm</span><span class="p">)</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">-</span> <span class="n">TSSI_13dBm</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">delta</span> <span class="o">=</span> <span class="n">TSSI_13dBm</span> <span class="o">-</span> <span class="n">Avg_TSSI_Meas_from_driver</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">delta</span> <span class="o">&lt;=</span> <span class="n">E_FOR_TX_POWER_TRACK</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;tx power track is done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpowertrackingindex = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpowertrackingindex_real = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="p">);</span>
<span class="cp">#ifdef RTL8190P</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfc_txpowertrackingindex = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfc_txpowertrackingindex_real = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="p">);</span>
<span class="cp">#endif</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;cck_present_attentuation_difference = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;cck_present_attentuation = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">&lt;</span> <span class="n">TSSI_13dBm</span> <span class="o">-</span> <span class="n">E_FOR_TX_POWER_TRACK</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="cp">#ifdef RTL8190P</span>
					<span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="cp">#endif</span>
				<span class="p">)</span>
				<span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="o">--</span><span class="p">;</span>
					<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="o">--</span><span class="p">;</span>
						<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
					<span class="p">}</span>
<span class="cp">#ifdef RTL8190P</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="o">--</span><span class="p">;</span>
					<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="o">--</span><span class="p">;</span>
						<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCTxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
					<span class="p">}</span>
<span class="cp">#endif</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">)</span>
<span class="cp">#ifdef RTL8190P</span>
					<span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">)</span>
<span class="cp">#endif</span>
					<span class="p">)</span>
				<span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="o">++</span><span class="p">;</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="o">++</span><span class="p">;</span>
					<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>

<span class="cp">#ifdef RTL8190P</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="o">++</span><span class="p">;</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="o">++</span><span class="p">;</span>
					<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCTxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
<span class="cp">#endif</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span>
				<span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span> <span class="o">-</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertracking_default</span><span class="p">;</span>

			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span>
				<span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_20Mdefault</span> <span class="o">+</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span>
				<span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_40Mdefault</span> <span class="o">+</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span><span class="p">;</span>

			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">&amp;&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span> <span class="o">&lt;</span><span class="mi">23</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
					<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
					<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span>
					<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpowertrackingindex = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpowertrackingindex_real = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="p">);</span>
<span class="cp">#ifdef RTL8190P</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfc_txpowertrackingindex = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfc_txpowertrackingindex_real = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex_real</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;cck_present_attentuation_difference = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;cck_present_attentuation = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">12</span><span class="o">||</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation_difference</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;tx power track---&gt;limited</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>


	<span class="p">}</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">Avg_TSSI_Meas_from_driver</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span>
			<span class="n">tmp_report</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1ba</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_TXPowerTrackingCallback_ThermalMeter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define ThermalMeterVal	9</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">tmpRegA</span><span class="p">,</span> <span class="n">TempCCk</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tmpOFDMindex</span><span class="p">,</span> <span class="n">tmpCCKindex</span><span class="p">,</span> <span class="n">tmpCCK20Mindex</span><span class="p">,</span> <span class="n">tmpCCK40Mindex</span><span class="p">,</span> <span class="n">tmpval</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">CCKSwingNeedUpdate</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_trackingInit</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>Query OFDM default setting</p></td><td class="code"><div class="highlight"><pre>		<span class="n">tmpRegA</span><span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">OFDM_Table_Length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>	<span class="c1">//find the index</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">tmpRegA</span> <span class="o">==</span> <span class="n">OFDMSwingTable</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span><span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Initial reg0x%x = 0x%x, OFDM_index=0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">tmpRegA</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>Query CCK default setting From 0xa22</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempCCk</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">bMaskByte2</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">CCK_Table_length</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">TempCCk</span> <span class="o">==</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span> <span class="o">=</span><span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Initial reg0x%x = 0x%x, CCK_index=0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">TempCCk</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_trackingInit</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>pHalData->TXPowercount = 0;</p></td><td class="code"><div class="highlight"><pre>		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>==========================</p>

<h1>this is only for test, should be masked</h1></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>read and filter out unreasonable value</p></td><td class="code"><div class="highlight"><pre>	<span class="n">tmpRegA</span> <span class="o">=</span> <span class="n">rtl8192_phy_QueryRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF90_PATH_A</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x078</span><span class="p">);</span>	<span class="c1">// 0x12: RF Reg[10:7]</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Readback ThermalMeterA = %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmpRegA</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">tmpRegA</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="o">||</span> <span class="n">tmpRegA</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">tmpRegA</span> <span class="o">&gt;=</span> <span class="mi">12</span><span class="p">)</span>	<span class="c1">// if over 12, TP will be bad when high temperature</span>
		<span class="n">tmpRegA</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Valid ThermalMeterA = %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tmpRegA</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ThermalMeterVal</span><span class="p">;</span>	<span class="c1">//We use fixed value by Bryant&#39;s suggestion</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ThermalMeterVal</span><span class="p">;</span>	<span class="c1">//We use fixed value by Bryant&#39;s suggestion</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>Get current RF-A temperature index</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">tmpRegA</span><span class="p">)</span>	<span class="c1">//lower temperature</span>
	<span class="p">{</span>
		<span class="n">tmpOFDMindex</span> <span class="o">=</span> <span class="n">tmpCCK20Mindex</span> <span class="o">=</span> <span class="mi">6</span><span class="o">+</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">tmpRegA</span><span class="p">);</span>
		<span class="n">tmpCCK40Mindex</span> <span class="o">=</span> <span class="n">tmpCCK20Mindex</span> <span class="o">-</span> <span class="mi">6</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tmpOFDMindex</span> <span class="o">&gt;=</span> <span class="n">OFDM_Table_Length</span><span class="p">)</span>
			<span class="n">tmpOFDMindex</span> <span class="o">=</span> <span class="n">OFDM_Table_Length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tmpCCK20Mindex</span> <span class="o">&gt;=</span> <span class="n">CCK_Table_length</span><span class="p">)</span>
			<span class="n">tmpCCK20Mindex</span> <span class="o">=</span> <span class="n">CCK_Table_length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tmpCCK40Mindex</span> <span class="o">&gt;=</span> <span class="n">CCK_Table_length</span><span class="p">)</span>
			<span class="n">tmpCCK40Mindex</span> <span class="o">=</span> <span class="n">CCK_Table_length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">tmpval</span> <span class="o">=</span> <span class="p">((</span><span class="n">u8</span><span class="p">)</span><span class="n">tmpRegA</span> <span class="o">-</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tmpval</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span>								<span class="c1">// higher temperature</span>
			<span class="n">tmpOFDMindex</span> <span class="o">=</span> <span class="n">tmpCCK20Mindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="c1">// max to +6dB</span>
		<span class="k">else</span>
			<span class="n">tmpOFDMindex</span> <span class="o">=</span> <span class="n">tmpCCK20Mindex</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">-</span> <span class="n">tmpval</span><span class="p">;</span>
		<span class="n">tmpCCK40Mindex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>DbgPrint("%ddb, tmpOFDMindex = %d, tmpCCK20Mindex = %d, tmpCCK40Mindex = %d",
((u1Byte)tmpRegA - pHalData->ThermalMeter[0]),
tmpOFDMindex, tmpCCK20Mindex, tmpCCK40Mindex);</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>	<span class="c1">//40M</span>
		<span class="n">tmpCCKindex</span> <span class="o">=</span> <span class="n">tmpCCK40Mindex</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">tmpCCKindex</span> <span class="o">=</span> <span class="n">tmpCCK20Mindex</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
		<span class="n">CCKSwingNeedUpdate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
		<span class="n">CCKSwingNeedUpdate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span> <span class="o">!=</span> <span class="n">tmpCCKindex</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span> <span class="o">=</span> <span class="n">tmpCCKindex</span><span class="p">;</span>
		<span class="n">CCKSwingNeedUpdate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">CCKSwingNeedUpdate</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>DbgPrint("Update CCK Swing, CCK<em>index = %d\n", pHalData->CCK</em>index);</p></td><td class="code"><div class="highlight"><pre>		<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span> <span class="o">!=</span> <span class="n">tmpOFDMindex</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span> <span class="o">=</span> <span class="n">tmpOFDMindex</span><span class="p">;</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">OFDMSwingTable</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span><span class="p">]);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Update OFDMSwing[%d] = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span><span class="p">,</span> <span class="n">OFDMSwingTable</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">OFDM_index</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span>	<span class="kt">void</span>	<span class="nf">dm_txpower_trackingcallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="o">*</span><span class="n">dwork</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">work</span><span class="p">,</span><span class="k">struct</span> <span class="n">delayed_work</span><span class="p">,</span><span class="n">work</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dwork</span><span class="p">,</span><span class="k">struct</span> <span class="n">r8192_priv</span><span class="p">,</span><span class="n">txpower_tracking_wq</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>

<span class="cp">#ifdef RTL8190P</span>
	<span class="n">dm_TXPowerTrackingCallback_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDcut</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
		<span class="n">dm_TXPowerTrackingCallback_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dm_TXPowerTrackingCallback_ThermalMeter</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_InitializeTXPowerTracking_TSSI</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>Initial the Tx BB index and mapping value</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 			<span class="mi">12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x7f8001fe</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 			<span class="mi">11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x788001e2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 			<span class="mi">10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x71c001c7</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 			<span class="mi">9</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x6b8001ae</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">8</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x65400195</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">7</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x5fc0017f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">6</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x5a400169</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">5</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x55400155</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">4</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x50800142</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">3</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x4c000130</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x47c0011f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x43c0010f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x40000100</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		       <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x3c8000f2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x390000e4</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x35c000d7</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x32c000cb</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x300000c0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 			    <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x2d4000b5</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">7</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x2ac000ab</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x288000a2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">9</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x26000098</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x24000090</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">23</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">23</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x22000088</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">24</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">24</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x20000080</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">25</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">25</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x1a00006c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">26</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">26</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x1c800072</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">27</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">27</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x18000060</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">28</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">28</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x19800066</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">29</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">29</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x15800056</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">30</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">30</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x26c0005b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">31</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">31</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x14400051</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">32</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">20</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">32</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x24400051</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">33</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">33</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x1300004c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">34</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">22</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">34</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x12000048</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">35</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">23</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">35</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x11000044</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">36</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span> <span class="o">=</span> 		     <span class="o">-</span><span class="mi">24</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="mi">36</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="o">=</span><span class="mh">0x10000040</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>ccktxbb_valuearray[0] is 0xA22 [1] is 0xA24 ...[7] is 0xA29
This Table is for CH1~CH13</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x36</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x23</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x29</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x27</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x26</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x23</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>ccktxbb_valuearray[0] is 0xA22 [1] is 0xA24 ...[7] is 0xA29
This Table is for CH14</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x36</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x32</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x29</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x27</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x26</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x25</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x24</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x23</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x22</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">9</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">10</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">11</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">12</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">13</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">14</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">15</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">16</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">17</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">18</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">19</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">20</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">21</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0d</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="mi">22</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_count</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_trackingInit</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_InitializeTXPowerTracking_ThermalMeter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>Tx Power tracking by Thermal Meter requires Firmware R/W 3-wire. This mechanism
can be enabled only when Firmware R/W 3-wire is enabled. Otherwise, frequent r/w
3-wire by driver causes RF to go into a wrong state.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">FwRWRF</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_count</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_trackingInit</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">dm_initialize_txpower_tracking</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef RTL8190P</span>
	<span class="n">dm_InitializeTXPowerTracking_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDcut</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
		<span class="n">dm_InitializeTXPowerTracking_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dm_InitializeTXPowerTracking_ThermalMeter</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="c1">// dm_InitializeTXPowerTracking</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_CheckTXPowerTracking_TSSI</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">tx_power_track_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">((</span><span class="n">tx_power_track_counter</span> <span class="o">%</span> <span class="mi">30</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">tx_power_track_counter</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
		<span class="p">{</span>
				<span class="n">queue_delayed_work</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">priv_wq</span><span class="p">,</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_tracking_wq</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">tx_power_track_counter</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_CheckTXPowerTracking_ThermalMeter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u8</span> 	<span class="n">TM_Trigger</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>DbgPrint("dm_CheckTXPowerTracking() \n");</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_count</span>  <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_count</span><span class="o">++</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">TM_Trigger</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>Attention!! You have to write all 12bits of data to RF, or it may cause RF to crash
actually write reg0x02 bit1=0, then bit1=1.
DbgPrint("Trigger ThermalMeter, write RF reg0x2 = 0x4d to 0x4f\n");</p></td><td class="code"><div class="highlight"><pre>		<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF90_PATH_A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">bMask12Bits</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">);</span>
		<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF90_PATH_A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">bMask12Bits</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">);</span>
		<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF90_PATH_A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">bMask12Bits</span><span class="p">,</span> <span class="mh">0x4d</span><span class="p">);</span>
		<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF90_PATH_A</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">bMask12Bits</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">);</span>
		<span class="n">TM_Trigger</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-64"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-64">&#182;</a></div><p>DbgPrint("Schedule TxPowerTrackingWorkItem\n");</p></td><td class="code"><div class="highlight"><pre>			<span class="n">queue_delayed_work</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">priv_wq</span><span class="p">,</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpower_tracking_wq</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
		<span class="n">TM_Trigger</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_check_txpower_tracking</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-65"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-65">&#182;</a></div><p>static u32 tx<em>power</em>track_counter = 0;</p></td><td class="code"><div class="highlight"><pre><span class="cp">#ifdef  RTL8190P</span>
	<span class="n">dm_CheckTXPowerTracking_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDcut</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
		<span class="n">dm_CheckTXPowerTracking_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dm_CheckTXPowerTracking_ThermalMeter</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="p">}</span>	<span class="c1">// dm_CheckTXPowerTracking</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_CCKTxPowerAdjust_TSSI</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span>  <span class="n">bInCH14</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">TempVal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-66"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-66">&#182;</a></div><p>Write 0xa22 0xa23</p></td><td class="code"><div class="highlight"><pre>	<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">bInCH14</span><span class="p">){</span></pre></div></td></tr>


<tr id="section-67"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-67">&#182;</a></div><p>Write 0xa22 0xa23</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span><span class="n">bMaskHWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-68"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-68">&#182;</a></div><p>Write 0xa24 ~ 0xa27</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="p">)</span><span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span><span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-69"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-69">&#182;</a></div><p>Write 0xa28  0xa29</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span><span class="n">bMaskLWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span><span class="n">bMaskHWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-70"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-70">&#182;</a></div><p>Write 0xa24 ~ 0xa27</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="p">)</span><span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span><span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-71"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-71">&#182;</a></div><p>Write 0xa28  0xa29</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_ch14_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span><span class="n">bMaskLWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
	<span class="p">}</span>


<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_CCKTxPowerAdjust_ThermalMeter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>	<span class="n">bool</span>  <span class="n">bInCH14</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">TempVal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">bInCH14</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-72"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-72">&#182;</a></div><p>Write 0xa22 0xa23</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">bMaskHWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;CCK not chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-73"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-73">&#182;</a></div><p>Write 0xa24 ~ 0xa27</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="p">)</span><span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;CCK not chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-74"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-74">&#182;</a></div><p>Write 0xa28  0xa29</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch1_Ch13</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="n">bMaskLWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;CCK not chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-75"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-75">&#182;</a></div><pre><code>priv-&gt;CCKTxPowerAdjustCntNotCh14++; //cosa add for debug.
</code></pre>

<p>Write 0xa22 0xa23</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">bMaskHWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;CCK chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-76"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-76">&#182;</a></div><p>Write 0xa24 ~ 0xa27</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span> <span class="p">)</span><span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;CCK chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-77"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-77">&#182;</a></div><p>Write 0xa28  0xa29</p></td><td class="code"><div class="highlight"><pre>		<span class="n">TempVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TempVal</span> <span class="o">=</span> 	<span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">CCKSwingTable_Ch14</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="n">bMaskLWord</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span><span class="s">&quot;CCK chnl 14, reg 0x%x = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="n">TempVal</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>



<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_cck_txpower_adjust</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="n">bool</span>  <span class="n">binch14</span>
<span class="p">)</span>
<span class="p">{</span>	<span class="c1">// dm_CCKTxPowerAdjust</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef RTL8190P</span>
	<span class="n">dm_CCKTxPowerAdjust_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">binch14</span><span class="p">);</span>
<span class="cp">#else</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDcut</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
		<span class="n">dm_CCKTxPowerAdjust_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">binch14</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dm_CCKTxPowerAdjust_ThermalMeter</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">binch14</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>


<span class="cp">#ifndef  RTL8192U</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_txpower_reset_recovery</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span>
<span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Start Reset Recovery ==&gt;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery: Fill in 0xc80 is %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery: Fill in RFA_txPowerTrackingIndex is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery : RF A I/Q Amplify Gain is %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery: CCK Attenuation is %d dB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_present_attentuation</span><span class="p">);</span>
	<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>

	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCTxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery: Fill in 0xc90 is %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery: Fill in RFC_txPowerTrackingIndex is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;Reset Recovery : RF C I/Q Amplify Gain is %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfc_txpowertrackingindex</span><span class="p">].</span><span class="n">txbb_iq_amplifygain</span><span class="p">);</span>

<span class="p">}</span>	<span class="c1">// dm_TXPowerResetRecovery</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_restore_dynamic_mechanism_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> 	<span class="n">reg_ratr</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_adaptive</span><span class="p">.</span><span class="n">last_ratr</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RATE</span><span class="p">,</span> <span class="s">&quot;&lt;---- dm_restore_dynamic_mechanism_state(): driver is going to unload</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-78"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-78">&#182;</a></div><p>Restore previous state for rate adaptive</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_adaptive</span><span class="p">.</span><span class="n">rate_adaptive_disabled</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-79"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-79">&#182;</a></div><p>TODO: Only 11n mode is implemented currently,</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span><span class="o">==</span><span class="n">WIRELESS_MODE_N_24G</span> <span class="o">||</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span><span class="o">==</span><span class="n">WIRELESS_MODE_N_5G</span><span class="p">))</span>
		 <span class="k">return</span><span class="p">;</span>
	<span class="p">{</span>
			<span class="cm">/* 2007/11/15 MH Copy from 8190PCI. */</span>
			<span class="n">u32</span> <span class="n">ratr_value</span><span class="p">;</span>
			<span class="n">ratr_value</span> <span class="o">=</span> <span class="n">reg_ratr</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span>	<span class="c1">// 1T2R, Spatial Stream 2 should be disabled</span>
			<span class="p">{</span>
				<span class="n">ratr_value</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">RATE_ALL_OFDM_2SS</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-80"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-80">&#182;</a></div><p>DbgPrint("HW<em>VAR</em>TATR<em>0 from 0x%x ==> 0x%x\n", ((pu4Byte)(val))[0], ratr</em>value);</p></td><td class="code"><div class="highlight"><pre>			<span class="p">}</span></pre></div></td></tr>


<tr id="section-81"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-81">&#182;</a></div><p>DbgPrint("set HW<em>VAR</em>TATR<em>0 = 0x%x\n", ratr</em>value);
cosa PlatformEFIOWrite4Byte(Adapter, RATR0, ((pu4Byte)(val))[0]);</p></td><td class="code"><div class="highlight"><pre>			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="p">,</span> <span class="n">ratr_value</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-82"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-82">&#182;</a></div><p>Restore TX Power Tracking Index</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_trackingInit</span> <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span><span class="p">){</span>
		<span class="n">dm_txpower_reset_recovery</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-83"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-83">&#182;</a></div><p>Restore BB Initial Gain</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_bb_initialgain_restore</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>	<span class="c1">// DM_RestoreDynamicMechanismState</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_bb_initialgain_restore</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">bit_mask</span> <span class="o">=</span> <span class="mh">0x7f</span><span class="p">;</span> <span class="c1">//Bit0~ Bit6</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span> <span class="n">DIG_ALGO_BY_RSSI</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-84"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-84">&#182;</a></div><p>Disable Initial Gain
PHY_SetBBReg(Adapter, UFWP, bMaskLWord, 0x800);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
	<span class="n">bit_mask</span>  <span class="o">=</span> <span class="n">bMaskByte2</span><span class="p">;</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_CCA</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;dm_BBInitialGainRestore 0xc50 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;dm_BBInitialGainRestore 0xc58 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;dm_BBInitialGainRestore 0xc60 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;dm_BBInitialGainRestore 0xc68 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;dm_BBInitialGainRestore 0xa0a is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-85"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-85">&#182;</a></div><p>Enable Initial Gain
PHY_SetBBReg(Adapter, UFWP, bMaskLWord, 0x100);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>

<span class="p">}</span>	<span class="c1">// dm_BBInitialGainRestore</span>


<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_backup_dynamic_mechanism_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-86"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-86">&#182;</a></div><p>Fsync to avoid reset</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bfsync_processing</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-87"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-87">&#182;</a></div><p>Backup BB InitialGain</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_bb_initialgain_backup</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>	<span class="c1">// DM_BackupDynamicMechanismState</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_bb_initialgain_backup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">bit_mask</span> <span class="o">=</span> <span class="n">bMaskByte0</span><span class="p">;</span> <span class="c1">//Bit0~ Bit6</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span> <span class="n">DIG_ALGO_BY_RSSI</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-88"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-88">&#182;</a></div><p>PHY_SetBBReg(Adapter, UFWP, bMaskLWord, 0x800);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">);</span>
	<span class="n">bit_mask</span>  <span class="o">=</span> <span class="n">bMaskByte2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_CCA</span><span class="p">,</span> <span class="n">bit_mask</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;BBInitialGainBackup 0xc50 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;BBInitialGainBackup 0xc58 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;BBInitialGainBackup 0xc60 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;BBInitialGainBackup 0xc68 is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DIG</span><span class="p">,</span> <span class="s">&quot;BBInitialGainBackup 0xa0a is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span>

<span class="p">}</span>   <span class="c1">// dm_BBInitialGainBakcup</span>

<span class="cp">#endif</span>
<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_change_dynamic_initgain_thresh()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/29/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_change_dynamic_initgain_thresh</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
								<span class="n">u32</span>		<span class="n">dm_type</span><span class="p">,</span>
								<span class="n">u32</span>		<span class="n">dm_value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_THRESH_HIGH</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span> <span class="o">=</span> <span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_THRESH_LOW</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span> <span class="o">=</span> <span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_THRESH_HIGHPWR_HIGH</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span> <span class="o">=</span> <span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_THRESH_HIGHPWR_HIGH</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span> <span class="o">=</span> <span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_ENABLE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span>		<span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_DISABLE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span>		<span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span>	<span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_DBG_MODE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_value</span> <span class="o">&gt;=</span> <span class="n">DM_DBG_MAX</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="n">DM_DBG_OFF</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dbg_mode</span>		<span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_RSSI</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span>			<span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_ALGORITHM</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dm_value</span> <span class="o">&gt;=</span> <span class="n">DIG_ALGO_MAX</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="n">DIG_ALGO_BY_FALSE_ALARM</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">!=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">)</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span>	<span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_BACKOFF</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_value</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">backoff_val</span>		<span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_RX_GAIN_MIN</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_min</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_type</span> <span class="o">==</span> <span class="n">DIG_TYPE_RX_GAIN_MAX</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_value</span> <span class="o">&gt;</span> <span class="mh">0x50</span><span class="p">)</span>
			<span class="n">dm_value</span> <span class="o">=</span> <span class="mh">0x50</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_max</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_value</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>	<span class="cm">/* DM_ChangeDynamicInitGainThresh */</span>
<span class="k">extern</span>	<span class="kt">void</span>
<span class="nf">dm_change_fsync_setting</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="n">s32</span>		<span class="n">DM_Type</span><span class="p">,</span>
	<span class="n">s32</span>		<span class="n">DM_Value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>	<span class="c1">// monitor 0xc38 register</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncMonitor</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-89"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-89">&#182;</a></div><p>DbgPrint("pHalData->framesyncMonitor = %d", pHalData->framesyncMonitor);</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span>
<span class="nf">dm_change_rxpath_selection_setting</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="n">s32</span>		<span class="n">DM_Type</span><span class="p">,</span>
	<span class="n">s32</span>		<span class="n">DM_Value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">prate_adaptive</span> 	<span class="n">pRA</span> <span class="o">=</span> <span class="p">(</span><span class="n">prate_adaptive</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_adaptive</span><span class="p">);</span>


	<span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">Enable</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">DbgMode</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">SS_TH_low</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">diff_TH</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;=</span> <span class="n">CCK_Rx_Version_MAX</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="n">CCK_Rx_Version_1</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span><span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">20</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pRA</span><span class="o">-&gt;</span><span class="n">ping_rssi_enable</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">21</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
		<span class="n">pRA</span><span class="o">-&gt;</span><span class="n">ping_rssi_thresh_for_ra</span> <span class="o">=</span> <span class="n">DM_Value</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_dig_init()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Set DIG scheme init value.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/15/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_dig_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="cm">/* 2007/10/05 MH Disable DIG scheme now. Not tested. */</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">=</span> <span class="n">DIG_ALGO_BY_RSSI</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dbg_mode</span> <span class="o">=</span> <span class="n">DM_DBG_OFF</span><span class="p">;</span>	<span class="c1">//off=by real rssi value, on=by DM_DigTable.Rssi_val for new dig</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* 2007/10/04 MH Define init gain threshold. */</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span>		<span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span>	<span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">initialgain_lowerbound_state</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span> 	<span class="o">=</span> <span class="n">DM_DIG_THRESH_LOW</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span> 	<span class="o">=</span> <span class="n">DM_DIG_THRESH_HIGH</span><span class="p">;</span>

	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_lowthresh</span> <span class="o">=</span> <span class="n">DM_DIG_HIGH_PWR_THRESH_LOW</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span> <span class="o">=</span> <span class="n">DM_DIG_HIGH_PWR_THRESH_HIGH</span><span class="p">;</span>

	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>	<span class="c1">//for new dig debug rssi value</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">backoff_val</span> <span class="o">=</span> <span class="n">DM_DIG_BACKOFF</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_max</span> <span class="o">=</span> <span class="n">DM_DIG_MAX</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">==</span> <span class="n">RT_CID_819x_Netcore</span><span class="p">)</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_min</span> <span class="o">=</span> <span class="n">DM_DIG_MIN_Netcore</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_min</span> <span class="o">=</span> <span class="n">DM_DIG_MIN</span><span class="p">;</span>

<span class="p">}</span>	<span class="cm">/* dm_dig_init */</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_ctrl_initgain_byrssi()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Driver must monitor RSSI and notify firmware to change initial</span>
<span class="cm"> *				gain according to different threshold. BB team provide the</span>
<span class="cm"> *				suggested solution.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:			struct net_device *dev</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/27/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_ctrl_initgain_byrssi</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span> <span class="n">DIG_ALGO_BY_FALSE_ALARM</span><span class="p">)</span>
		<span class="n">dm_ctrl_initgain_byrssi_by_fwfalse_alarm</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span> <span class="n">DIG_ALGO_BY_RSSI</span><span class="p">)</span>
		<span class="n">dm_ctrl_initgain_byrssi_by_driverrssi</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-90"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-90">&#182;</a></div><pre><code>;
</code></pre></td><td class="code"><div class="highlight"><pre>	<span class="k">else</span>
		<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_ctrl_initgain_byrssi_by_driverrssi</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span> 	<span class="n">fw_dig</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-91"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-91">&#182;</a></div><p>DbgPrint("Dig by Sw Rssi \n");</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>	<span class="c1">// if switched algorithm, we have to disable FW Dig.</span>
		<span class="n">fw_dig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">fw_dig</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>	<span class="c1">// execute several times to make sure the FW Dig is disabled</span>
	<span class="p">{</span><span class="c1">// FW DIG Off</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>
		<span class="n">fw_dig</span><span class="o">++</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_OFF</span><span class="p">;</span>	<span class="c1">//fw dig off.</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span><span class="p">)</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span> <span class="o">=</span> <span class="n">DIG_CONNECT</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span> <span class="o">=</span> <span class="n">DIG_DISCONNECT</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-92"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-92">&#182;</a></div><p>DbgPrint("DM<em>DigTable.PreConnectState = %d, DM</em>DigTable.CurConnectState = %d \n",
DM<em>DigTable.PreConnectState, DM</em>DigTable.CurConnectState);</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dbg_mode</span> <span class="o">==</span> <span class="n">DM_DBG_OFF</span><span class="p">)</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-93"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-93">&#182;</a></div><p>DbgPrint("DM<em>DigTable.Rssi</em>val = %d \n", DM<em>DigTable.Rssi</em>val);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dm_initial_gain</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_pd_th</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dm_cs_ratio</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_connect_state</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span><span class="p">;</span>

<span class="p">}</span>	<span class="cm">/* dm_CtrlInitGainByRssi */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_ctrl_initgain_byrssi_by_fwfalse_alarm</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_enable_flag</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-94"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-94">&#182;</a></div><p>Fw DIG On.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">!=</span> <span class="n">IEEE80211_LINKED</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-95"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-95">&#182;</a></div><p>For smooth, we can not change DIG state.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-96"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-96">&#182;</a></div><p>DbgPrint("Dig by Fw False Alarm\n");
if (DM<em>DigTable.Dig</em>State == DM<em>STA</em>DIG_OFF)</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/*DbgPrint(&quot;DIG Check\n\r RSSI=%d LOW=%d HIGH=%d STATE=%d&quot;,</span>
<span class="cm">	pHalData-&gt;UndecoratedSmoothedPWDB, DM_DigTable.RssiLowThresh,</span>
<span class="cm">	DM_DigTable.RssiHighThresh, DM_DigTable.Dig_State);*/</span>
	<span class="cm">/* 1. When RSSI decrease, We have to judge if it is smaller than a threshold</span>
<span class="cm">		  and then execute the step below. */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="cm">/* 2008/02/05 MH When we execute silent reset, the DIG PHY parameters</span>
<span class="cm">		   will be reset to init value. We must prevent the condition. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">==</span> <span class="n">DM_STA_DIG_OFF</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">==</span> <span class="n">reset_cnt</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-97"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-97">&#182;</a></div><p>If DIG is off, DIG high power state must reset.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_MAX</span><span class="p">;</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_OFF</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-98"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-98">&#182;</a></div><p>1.1 DIG Off.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span></pre></div></td></tr>


<tr id="section-99"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-99">&#182;</a></div><p>1.2 Set initial gain.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-100"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-100">&#182;</a></div><p>1.3 Lower PD_TH for OFDM.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="cm">/* 2008/01/11 MH 40MHZ 90/92 register are not the same. */</span></pre></div></td></tr>


<tr id="section-101"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-101">&#182;</a></div><p>2008/02/05 MH SD3-Jerry 92U/92E PD_TH are the same.</p></td><td class="code"><div class="highlight"><pre>			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="cp">#endif</span>
			<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">				write_nic_byte(pAdapter, rOFDM0_RxDetector1, 0x40);</span>
<span class="cm">			*/</span></pre></div></td></tr>


<tr id="section-102"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-102">&#182;</a></div><p>else if (pAdapter->HardwareType == HARDWARE<em>TYPE</em>RTL8192E)</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-103"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-103">&#182;</a></div><p>else
PlatformEFIOWrite1Byte(pAdapter, rOFDM0_RxDetector1, 0x40);</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-104"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-104">&#182;</a></div><p>1.4 Lower CS ratio for CCK.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-105"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-105">&#182;</a></div><p>1.5 Higher EDCCA.
PlatformEFIOWrite4Byte(pAdapter, rOFDM0_ECCAThreshold, 0x325);</p></td><td class="code"><div class="highlight"><pre>		<span class="k">return</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="cm">/* 2. When RSSI increase, We have to judge if it is larger than a threshold</span>
<span class="cm">		  and then execute the step below.  */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span><span class="p">)</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">u8</span> <span class="n">reset_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">==</span> <span class="n">DM_STA_DIG_ON</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">==</span> <span class="n">reset_cnt</span><span class="p">))</span>
		<span class="p">{</span>
			<span class="n">dm_ctrl_initgain_byrssi_highpwr</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">!=</span> <span class="n">reset_cnt</span><span class="p">)</span>
				<span class="n">reset_flag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

			<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_ON</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-106"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-106">&#182;</a></div><p>DbgPrint("DIG ON\n\r");</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-107"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-107">&#182;</a></div><p>2.1 Set initial gain.
2008/02/26 MH SD3-Jerry suggest to prevent dirty environment.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="n">reset_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-108"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-108">&#182;</a></div><p>2.2 Higher PD_TH for OFDM.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="cm">/* 2008/01/11 MH 40MHZ 90/92 register are not the same. */</span></pre></div></td></tr>


<tr id="section-109"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-109">&#182;</a></div><p>2008/02/05 MH SD3-Jerry 92U/92E PD_TH are the same.</p></td><td class="code"><div class="highlight"><pre>			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x20</span><span class="p">);</span>
			<span class="cp">#endif</span>
			<span class="cm">/*</span>
<span class="cm">			else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">				write_nic_byte(dev, rOFDM0_RxDetector1, 0x42);</span>
<span class="cm">			*/</span></pre></div></td></tr>


<tr id="section-110"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-110">&#182;</a></div><p>else if (pAdapter->HardwareType == HARDWARE<em>TYPE</em>RTL8192E)</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-111"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-111">&#182;</a></div><p>else
PlatformEFIOWrite1Byte(pAdapter, rOFDM0_RxDetector1, 0x42);</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-112"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-112">&#182;</a></div><p>2.3 Higher CS ratio for CCK.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0a</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-113"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-113">&#182;</a></div><p>2.4 Lower EDCCA.</p></td><td class="code"><div class="highlight"><pre>		<span class="cm">/* 2008/01/11 MH 90/92 series are the same. */</span></pre></div></td></tr>


<tr id="section-114"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-114">&#182;</a></div><p>PlatformEFIOWrite4Byte(pAdapter, rOFDM0_ECCAThreshold, 0x346);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-115"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-115">&#182;</a></div><p>2.5 DIG On.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>	<span class="c1">// Only clear byte 1 and rewrite.</span>

	<span class="p">}</span>

	<span class="n">dm_ctrl_initgain_byrssi_highpwr</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>	<span class="cm">/* dm_CtrlInitGainByRssi */</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_ctrl_initgain_byrssi_highpwr()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/28/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_ctrl_initgain_byrssi_highpwr</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">reset_cnt_highpwr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-116"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-116">&#182;</a></div><p>For smooth, we can not change high power DIG state in the range.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_lowthresh</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* 3. When RSSI &gt;75% or &lt;70%, it is a high power issue. We have to judge if</span>
<span class="cm">		  it is larger than a threshold and then execute the step below.  */</span></pre></div></td></tr>


<tr id="section-117"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-117">&#182;</a></div><p>2008/02/05 MH SD3-Jerry Modify PD_TH for high power issue.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span> <span class="o">==</span> <span class="n">DM_STA_DIG_ON</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">==</span> <span class="n">reset_cnt_highpwr</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_ON</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-118"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-118">&#182;</a></div><p>3.1 Higher PD_TH for OFDM for high power state.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x10</span><span class="p">);</span>
			<span class="cp">#endif</span>

			<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">				write_nic_byte(dev, rOFDM0_RxDetector1, 0x41);</span>
<span class="cm">			*/</span>

		<span class="p">}</span>
		<span class="k">else</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span> <span class="o">==</span> <span class="n">DM_STA_DIG_OFF</span><span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">==</span> <span class="n">reset_cnt_highpwr</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_highpwr_state</span> <span class="o">=</span> <span class="n">DM_STA_DIG_OFF</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_lowthresh</span> <span class="o">&amp;&amp;</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-119"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-119">&#182;</a></div><p>3.2 Recover PD_TH for OFDM for normal power region.</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="cp">#ifdef RTL8190P</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
				<span class="cp">#else</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x20</span><span class="p">);</span>
				<span class="cp">#endif</span>
				<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">					write_nic_byte(dev, rOFDM0_RxDetector1, 0x42);</span>
<span class="cm">				*/</span>

			<span class="p">}</span>
			<span class="k">else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">reset_cnt_highpwr</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>

<span class="p">}</span>	<span class="cm">/* dm_CtrlInitGainByRssiHighPwr */</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_initial_gain</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span>					<span class="n">initial_gain</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span>				<span class="n">initialized</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_write</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span>			<span class="n">reset_cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">initialized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_connect_state</span> <span class="o">==</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span> <span class="o">==</span> <span class="n">DIG_CONNECT</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span><span class="o">+</span><span class="mi">10</span><span class="o">-</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">backoff_val</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_max</span><span class="p">)</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_max</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span><span class="o">+</span><span class="mi">10</span><span class="o">-</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">backoff_val</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_min</span><span class="p">)</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rx_gain_range_min</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span><span class="o">+</span><span class="mi">10</span><span class="o">-</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">backoff_val</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>		<span class="c1">//current state is disconnected</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="k">else</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_ig_value</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>	<span class="c1">// disconnected -&gt; connected or connected -&gt; disconnected</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_ig_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-120"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-120">&#182;</a></div><p>DbgPrint("DM<em>DigTable.CurIGValue = 0x%x, DM</em>DigTable.PreIGValue = 0x%x\n", DM<em>DigTable.CurIGValue, DM</em>DigTable.PreIGValue);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-121"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-121">&#182;</a></div><p>if silent reset happened, we should rewrite the values back</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">!=</span> <span class="n">reset_cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">force_write</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_ig_value</span> <span class="o">!=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">))</span>
		<span class="n">force_write</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="p">{</span>
		<span class="k">if</span><span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_ig_value</span> <span class="o">!=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span><span class="p">)</span>
			<span class="o">||</span> <span class="o">!</span><span class="n">initialized</span> <span class="o">||</span> <span class="n">force_write</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">initial_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-122"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-122">&#182;</a></div><p>DbgPrint("Write initial gain = 0x%x\n", initial_gain);
Set initial gain.</p></td><td class="code"><div class="highlight"><pre>			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_ig_value</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_ig_value</span><span class="p">;</span>
			<span class="n">initialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">force_write</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_pd_th</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u8</span>				<span class="n">initialized</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_write</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span>			<span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">initialized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_connect_state</span> <span class="o">==</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span> <span class="o">==</span> <span class="n">DIG_CONNECT</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_highthresh</span><span class="p">)</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">DIG_PD_AT_HIGH_POWER</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&lt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span><span class="p">))</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">DIG_PD_AT_LOW_POWER</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&lt;</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_power_lowthresh</span><span class="p">))</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">DIG_PD_AT_NORMAL_POWER</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">prepd_thstate</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">DIG_PD_AT_LOW_POWER</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>	<span class="c1">// disconnected -&gt; connected or connected -&gt; disconnected</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">=</span> <span class="n">DIG_PD_AT_LOW_POWER</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-123"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-123">&#182;</a></div><p>if silent reset happened, we should rewrite the values back</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">!=</span> <span class="n">reset_cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">force_write</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="p">{</span>
		<span class="k">if</span><span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">prepd_thstate</span> <span class="o">!=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">initialized</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">)</span> <span class="o">||</span> <span class="n">force_write</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-124"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-124">&#182;</a></div><p>DbgPrint("Write PD<em>TH state = %d\n", DM</em>DigTable.CurPD_THState);</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">==</span> <span class="n">DIG_PD_AT_LOW_POWER</span><span class="p">)</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-125"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-125">&#182;</a></div><p>Lower PD_TH for OFDM.</p></td><td class="code"><div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="cm">/* 2008/01/11 MH 40MHZ 90/92 register are not the same. */</span></pre></div></td></tr>


<tr id="section-126"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-126">&#182;</a></div><p>2008/02/05 MH SD3-Jerry 92U/92E PD_TH are the same.</p></td><td class="code"><div class="highlight"><pre>					<span class="cp">#ifdef RTL8190P</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
					<span class="cp">#else</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x00</span><span class="p">);</span>
					<span class="cp">#endif</span>
					<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">						write_nic_byte(dev, rOFDM0_RxDetector1, 0x40);</span>
<span class="cm">					*/</span>
				<span class="p">}</span>
				<span class="k">else</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">==</span> <span class="n">DIG_PD_AT_NORMAL_POWER</span><span class="p">)</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-127"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-127">&#182;</a></div><p>Higher PD_TH for OFDM.</p></td><td class="code"><div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="cm">/* 2008/01/11 MH 40MHZ 90/92 register are not the same. */</span></pre></div></td></tr>


<tr id="section-128"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-128">&#182;</a></div><p>2008/02/05 MH SD3-Jerry 92U/92E PD_TH are the same.</p></td><td class="code"><div class="highlight"><pre>					<span class="cp">#ifdef RTL8190P</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
					<span class="cp">#else</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x20</span><span class="p">);</span>
					<span class="cp">#endif</span>
					<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">						write_nic_byte(dev, rOFDM0_RxDetector1, 0x42);</span>
<span class="cm">					*/</span>
				<span class="p">}</span>
				<span class="k">else</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span> <span class="o">==</span> <span class="n">DIG_PD_AT_HIGH_POWER</span><span class="p">)</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-129"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-129">&#182;</a></div><p>Higher PD_TH for OFDM for high power state.</p></td><td class="code"><div class="highlight"><pre>				<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="cp">#ifdef RTL8190P</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
					<span class="cp">#else</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">rOFDM0_XATxAFE</span><span class="o">+</span><span class="mi">3</span><span class="p">),</span> <span class="mh">0x10</span><span class="p">);</span>
					<span class="cp">#endif</span>
					<span class="cm">/*else if (priv-&gt;card_8192 == HARDWARE_TYPE_RTL8190P)</span>
<span class="cm">						write_nic_byte(dev, rOFDM0_RxDetector1, 0x41);</span>
<span class="cm">					*/</span>
				<span class="p">}</span>
				<span class="k">else</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector1</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">prepd_thstate</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">curpd_thstate</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">initialized</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span>
				<span class="n">initialized</span><span class="o">++</span><span class="p">;</span>
			<span class="n">force_write</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span>	<span class="kt">void</span> <span class="nf">dm_cs_ratio</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">static</span> <span class="n">u8</span>				<span class="n">initialized</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">force_write</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span>			<span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm_switch</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">initialized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">pre_connect_state</span> <span class="o">==</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">cur_connect_state</span> <span class="o">==</span> <span class="n">DIG_CONNECT</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&lt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_low_thresh</span><span class="p">))</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">=</span> <span class="n">DIG_CS_RATIO_LOWER</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_val</span> <span class="o">&gt;=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">rssi_high_thresh</span><span class="p">)</span> <span class="p">)</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">=</span> <span class="n">DIG_CS_RATIO_HIGHER</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">precs_ratio_state</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">=</span> <span class="n">DIG_CS_RATIO_LOWER</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>	<span class="c1">// disconnected -&gt; connected or connected -&gt; disconnected</span>
	<span class="p">{</span>
		<span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">=</span> <span class="n">DIG_CS_RATIO_LOWER</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-130"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-130">&#182;</a></div><p>if silent reset happened, we should rewrite the values back</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">!=</span> <span class="n">reset_cnt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">force_write</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="p">{</span>
		<span class="k">if</span><span class="p">((</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">precs_ratio_state</span> <span class="o">!=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span><span class="p">)</span> <span class="o">||</span>
			<span class="o">!</span><span class="n">initialized</span> <span class="o">||</span> <span class="n">force_write</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-131"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-131">&#182;</a></div><p>DbgPrint("Write CS<em>ratio state = %d\n", DM</em>DigTable.CurCS_ratioState);</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">==</span> <span class="n">DIG_CS_RATIO_LOWER</span><span class="p">)</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-132"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-132">&#182;</a></div><p>Lower CS ratio for CCK.</p></td><td class="code"><div class="highlight"><pre>				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span> <span class="o">==</span> <span class="n">DIG_CS_RATIO_HIGHER</span><span class="p">)</span>
			<span class="p">{</span></pre></div></td></tr>


<tr id="section-133"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-133">&#182;</a></div><p>Higher CS ratio for CCK.</p></td><td class="code"><div class="highlight"><pre>				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0a</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">dm_digtable</span><span class="p">.</span><span class="n">precs_ratio_state</span> <span class="o">=</span> <span class="n">dm_digtable</span><span class="p">.</span><span class="n">curcs_ratio_state</span><span class="p">;</span>
			<span class="n">initialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">force_write</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_init_edca_turbo</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bis_any_nonbepkts</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bis_cur_rdlstate</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>	<span class="c1">// dm_init_edca_turbo</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_check_edca_turbo</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-134"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-134">&#182;</a></div><p>PSTA_QOS            pStaQos = pMgntInfo->pStaQos;</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-135"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-135">&#182;</a></div><p>Keep past Tx/Rx packet count for RT-to-RT EDCA turbo.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>			<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>			<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>				<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>				<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-136"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-136">&#182;</a></div><p>Do not be Turbo if it's under WiFi config and Qos Enabled, because the EDCA parameters
should follow the settings from QAP. By Bruce, 2007-12-07.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">!=</span> <span class="n">IEEE80211_LINKED</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">dm_CheckEdcaTurbo_EXIT</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-137"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-137">&#182;</a></div><p>We do not turn on EDCA turbo mode for some AP that has IOT issue</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_EDCA_TURBO</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">dm_CheckEdcaTurbo_EXIT</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-138"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-138">&#182;</a></div><p>printk("========>%s():bis<em>any</em>nonbepkts is %d\n",<strong>FUNCTION</strong>,priv->bis<em>any</em>nonbepkts);
Check the status for current condition.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bis_any_nonbepkts</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span> <span class="o">-</span> <span class="n">lastTxOkCnt</span><span class="p">;</span>
		<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span> <span class="o">-</span> <span class="n">lastRxOkCnt</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-139"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-139">&#182;</a></div><p>For RT-AP, we needs to turn it on when Rx>Tx</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">curRxOkCnt</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="o">*</span><span class="n">curTxOkCnt</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-140"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-140">&#182;</a></div><p>printk("%s():curRxOkCnt > 4*curTxOkCnt\n");</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bis_cur_rdlstate</span> <span class="o">||</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_BE</span><span class="p">,</span> <span class="n">edca_setting_DL</span><span class="p">[</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span><span class="p">]);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bis_cur_rdlstate</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-141"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-141">&#182;</a></div><p>printk("%s():curRxOkCnt &lt; 4*curTxOkCnt\n");</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bis_cur_rdlstate</span> <span class="o">||</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_BE</span><span class="p">,</span> <span class="n">edca_setting_UL</span><span class="p">[</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span><span class="p">]);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bis_cur_rdlstate</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>

		<span class="p">}</span>

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-142"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-142">&#182;</a></div><p>Turn Off EDCA turbo here.
Restore original EDCA according to the declaration of AP.</p></td><td class="code"><div class="highlight"><pre>		 <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span><span class="p">)</span>
		<span class="p">{</span>

			<span class="p">{</span>
				<span class="n">u8</span>		<span class="n">u1bAIFS</span><span class="p">;</span>
				<span class="n">u32</span>		<span class="n">u4bAcParam</span><span class="p">;</span>
				<span class="k">struct</span> <span class="n">ieee80211_qos_parameters</span> <span class="o">*</span><span class="n">qos_parameters</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">qos_data</span><span class="p">.</span><span class="n">parameters</span><span class="p">;</span>
				<span class="n">u8</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-143"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-143">&#182;</a></div><p>For Each time updating EDCA parameter, reset EDCA turbo mode status.</p></td><td class="code"><div class="highlight"><pre>				<span class="n">dm_init_edca_turbo</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
				<span class="n">u1bAIFS</span> <span class="o">=</span> <span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">aifs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">((</span><span class="n">mode</span><span class="o">&amp;</span><span class="p">(</span><span class="n">IEEE_G</span><span class="o">|</span><span class="n">IEEE_N_24G</span><span class="p">))</span> <span class="o">?</span><span class="mi">9</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">aSifsTime</span><span class="p">;</span>
				<span class="n">u4bAcParam</span> <span class="o">=</span> <span class="p">((((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">tx_op_limit</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">&lt;&lt;</span> <span class="n">AC_PARAM_TXOP_LIMIT_OFFSET</span><span class="p">)</span><span class="o">|</span>
					<span class="p">(((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">cw_max</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">&lt;&lt;</span> <span class="n">AC_PARAM_ECW_MAX_OFFSET</span><span class="p">)</span><span class="o">|</span>
					<span class="p">(((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">cw_min</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">&lt;&lt;</span> <span class="n">AC_PARAM_ECW_MIN_OFFSET</span><span class="p">)</span><span class="o">|</span>
					<span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="n">u1bAIFS</span> <span class="o">&lt;&lt;</span> <span class="n">AC_PARAM_AIFS_OFFSET</span><span class="p">));</span></pre></div></td></tr>


<tr id="section-144"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-144">&#182;</a></div><p>write<em>nic</em>dword(dev, WDCAPARA_ADD[i], u4bAcParam);</p></td><td class="code"><div class="highlight"><pre>				<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_BE</span><span class="p">,</span>  <span class="n">u4bAcParam</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-145"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-145">&#182;</a></div><p>Check ACM bit.
If it is set, immediately set ACM control bit to downgrading AC for passing WMM testplan. Annie, 2005-12-13.</p></td><td class="code"><div class="highlight"><pre>				<span class="p">{</span></pre></div></td></tr>


<tr id="section-146"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-146">&#182;</a></div><p>TODO:  Modified this part and try to set acm control in only 1 IO processing!!</p></td><td class="code"><div class="highlight"><pre>					<span class="n">PACI_AIFSN</span>	<span class="n">pAciAifsn</span> <span class="o">=</span> <span class="p">(</span><span class="n">PACI_AIFSN</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">aifs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
					<span class="n">u8</span>		<span class="n">AcmCtrl</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span> <span class="n">dev</span><span class="p">,</span> <span class="n">AcmHwCtrl</span> <span class="p">);</span>
					<span class="k">if</span><span class="p">(</span> <span class="n">pAciAifsn</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">.</span><span class="n">ACM</span> <span class="p">)</span>
					<span class="p">{</span> <span class="c1">// ACM bit is 1.</span>
						<span class="n">AcmCtrl</span> <span class="o">|=</span> <span class="n">AcmHw_BeqEn</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span> <span class="c1">// ACM bit is 0.</span>
						<span class="n">AcmCtrl</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">AcmHw_BeqEn</span><span class="p">);</span>
					<span class="p">}</span>

					<span class="n">RT_TRACE</span><span class="p">(</span> <span class="n">COMP_QOS</span><span class="p">,</span><span class="s">&quot;SetHwReg8190pci(): [HW_VAR_ACM_CTRL] Write 0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">AcmCtrl</span> <span class="p">)</span> <span class="p">;</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">AcmHwCtrl</span><span class="p">,</span> <span class="n">AcmCtrl</span> <span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcurrent_turbo_EDCA</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>


<span class="nl">dm_CheckEdcaTurbo_EXIT:</span></pre></div></td></tr>


<tr id="section-147"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-147">&#182;</a></div><p>Set variables for next time.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bis_any_nonbepkts</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span><span class="p">;</span>
	<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span><span class="p">;</span>
<span class="p">}</span>	<span class="c1">// dm_CheckEdcaTurbo</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">DM_CTSToSelfSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">,</span><span class="n">u32</span> <span class="n">DM_Type</span><span class="p">,</span> <span class="n">u32</span> <span class="n">DM_Value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">((</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>	<span class="c1">// CTS to self disable/enable</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bCTSToSelfEnable</span> <span class="o">=</span> <span class="p">(</span><span class="n">bool</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-148"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-148">&#182;</a></div><p>DbgPrint("pMgntInfo->bCTSToSelfEnable = %d\n", pMgntInfo->bCTSToSelfEnable);</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">DM_Type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">//CTS to self Th</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_Value</span> <span class="o">&gt;=</span> <span class="mi">50</span><span class="p">)</span>
			<span class="n">DM_Value</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">CTSToSelfTH</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DM_Value</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-149"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-149">&#182;</a></div><p>DbgPrint("pMgntInfo->CTSToSelfTH = %d\n", pMgntInfo->CTSToSelfTH);</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_init_ctstoself</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">((</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bCTSToSelfEnable</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">CTSToSelfTH</span> <span class="o">=</span> <span class="n">CTSToSelfTHVal</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_ctstoself</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">((</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>				<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span>				<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>						<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>						<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bCTSToSelfEnable</span> <span class="o">!=</span> <span class="n">TRUE</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HT_IOT_ACT_FORCED_CTS2SELF</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/*</span>
<span class="cm">	1. Uplink</span>
<span class="cm">	2. Linksys350/Linksys300N</span>
<span class="cm">	3. &lt;50 disable, &gt;55 enable</span>
<span class="cm">	*/</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">curTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span> <span class="o">-</span> <span class="n">lastTxOkCnt</span><span class="p">;</span>
		<span class="n">curRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span> <span class="o">-</span> <span class="n">lastRxOkCnt</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">curRxOkCnt</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="o">*</span><span class="n">curTxOkCnt</span><span class="p">)</span>	<span class="c1">//downlink, disable CTS to self</span>
		<span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HT_IOT_ACT_FORCED_CTS2SELF</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-150"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-150">&#182;</a></div><p>DbgPrint("dm_CTSToSelf() ==> CTS to self disabled -- downlink\n");</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span>	<span class="c1">//uplink</span>
		<span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_FORCED_CTS2SELF</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">lastTxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">txbytesunicast</span><span class="p">;</span>
		<span class="n">lastRxOkCnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxbytesunicast</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_check_rfctrl_gpio()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Copy 8187B template for 9xseries.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/28/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_check_rfctrl_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span></pre></div></td></tr>


<tr id="section-151"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-151">&#182;</a></div><p>struct r8192<em>priv *priv = ieee80211</em>priv(dev);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-152"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-152">&#182;</a></div><p>Work around for DTM test, we will not enable HW - radio on/off because r/w
page 1 register before extra bus is enabled causing system failures when resuming
from S4. 20080218, Emily</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-153"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-153">&#182;</a></div><p>Stop to execute workitem to prevent S3/S4 bug.</p></td><td class="code"><div class="highlight"><pre><span class="cp">#ifdef RTL8190P</span>
	<span class="k">return</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef RTL8192U</span>
	<span class="k">return</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef RTL8192E</span>
		<span class="n">queue_delayed_work</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">priv_wq</span><span class="p">,</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">gpio_change_rf_wq</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="p">}</span>	<span class="cm">/* dm_CheckRfCtrlGPIO */</span>

<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_check_pbc_gpio()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Check if PBC button is pressed.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/28/2008	amy 	Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="nf">dm_check_pbc_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef RTL8192U</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">tmp1byte</span><span class="p">;</span>


	<span class="n">tmp1byte</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">GPI</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">tmp1byte</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tmp1byte</span><span class="o">&amp;</span><span class="n">BIT6</span> <span class="o">||</span> <span class="n">tmp1byte</span><span class="o">&amp;</span><span class="n">BIT0</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-154"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-154">&#182;</a></div><p>Here we only set bPbcPressed to TRUE
After trigger PBC, the variable will be set to FALSE</p></td><td class="code"><div class="highlight"><pre>		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_IO</span><span class="p">,</span> <span class="s">&quot;CheckPbcGPIO - PBC is pressed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bpbc_pressed</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

<span class="p">}</span>

<span class="cp">#ifdef RTL8192E</span>

<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_GPIOChangeRF</span>
<span class="cm"> * Overview:	PCI will not support workitem call back HW radio on-off control.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	02/21/2008	MHC		Create Version 0.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="nf">dm_gpio_change_rf_callback</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="o">*</span><span class="n">dwork</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">work</span><span class="p">,</span><span class="k">struct</span> <span class="n">delayed_work</span><span class="p">,</span><span class="n">work</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dwork</span><span class="p">,</span><span class="k">struct</span> <span class="n">r8192_priv</span><span class="p">,</span><span class="n">gpio_change_rf_wq</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tmp1byte</span><span class="p">;</span>
	<span class="n">RT_RF_POWER_STATE</span>	<span class="n">eRfPowerStateToSet</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bActuallySet</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">do</span><span class="p">{</span>
		<span class="n">bActuallySet</span><span class="o">=</span><span class="nb">false</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_INIT</span> <span class="o">|</span> <span class="n">COMP_POWER</span> <span class="o">|</span> <span class="n">COMP_RF</span><span class="p">),</span><span class="s">&quot;dm_gpio_change_rf_callback(): Callback function breaks out!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-155"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-155">&#182;</a></div><p>0x108 GPIO input register is read only
set 0x108 B1= 1: RF-ON; 0: RF-OFF.</p></td><td class="code"><div class="highlight"><pre>			<span class="n">tmp1byte</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">GPI</span><span class="p">);</span>

			<span class="n">eRfPowerStateToSet</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp1byte</span><span class="o">&amp;</span><span class="n">BIT1</span><span class="p">)</span> <span class="o">?</span>  <span class="n">eRfOn</span> <span class="o">:</span> <span class="n">eRfOff</span><span class="p">;</span>

			<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRadioOff</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">eRfPowerStateToSet</span> <span class="o">==</span> <span class="n">eRfOn</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RF</span><span class="p">,</span> <span class="s">&quot;gpiochangeRF  - HW Radio ON</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRadioOff</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
				<span class="n">bActuallySet</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRadioOff</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">eRfPowerStateToSet</span> <span class="o">==</span> <span class="n">eRfOff</span><span class="p">))</span>
			<span class="p">{</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RF</span><span class="p">,</span> <span class="s">&quot;gpiochangeRF  - HW Radio OFF</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRadioOff</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
				<span class="n">bActuallySet</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span><span class="p">(</span><span class="n">bActuallySet</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="cp">#ifdef TO_DO</span>
				<span class="n">MgntActSet_RF_State</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRfPowerStateToSet</span><span class="p">,</span> <span class="n">RF_CHANGE_BY_HW</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-156"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-156">&#182;</a></div><p>DrvIFIndicateCurrentPhyStatus(pAdapter);</p></td><td class="code"><div class="highlight"><pre>				<span class="cp">#endif</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">2000</span><span class="p">);</span>
			<span class="p">}</span>

		<span class="p">}</span>
	<span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">TRUE</span><span class="p">)</span>

<span class="p">}</span>	<span class="cm">/* dm_GPIOChangeRF */</span>

<span class="cp">#endif</span>
<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	DM_RFPathCheckWorkItemCallBack()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Check if Current RF RX path is enabled</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	01/30/2008	MHC		Create Version 0.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">extern</span>	<span class="kt">void</span>	<span class="nf">dm_rf_pathcheck_workitemcallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="o">*</span><span class="n">dwork</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">work</span><span class="p">,</span><span class="k">struct</span> <span class="n">delayed_work</span><span class="p">,</span><span class="n">work</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dwork</span><span class="p">,</span><span class="k">struct</span> <span class="n">r8192_priv</span><span class="p">,</span><span class="n">rfpath_check_wq</span><span class="p">);</span>
       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-157"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-157">&#182;</a></div><p>bool bactually_set = false;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span> <span class="n">rfpath</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>


	<span class="cm">/* 2008/01/30 MH After discussing with SD3 Jerry, 0xc04/0xd04 register will</span>
<span class="cm">	   always be the same. We only read 0xc04 now. */</span>
	<span class="n">rfpath</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc04</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-158"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-158">&#182;</a></div><p>Check Bit 0-3, it means if RF A-D is enabled.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RF90_PATH_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rfpath</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x01</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">Enable</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">dm_rxpath_sel_byrssi</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>	<span class="cm">/* DM_RFPathCheckWorkItemCallBack */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_init_rxpath_selection</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">Enable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="c1">//default enabled</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">SS_TH_low</span> <span class="o">=</span> <span class="n">RxPathSelection_SS_TH_low</span><span class="p">;</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">diff_TH</span> <span class="o">=</span> <span class="n">RxPathSelection_diff_TH</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">==</span> <span class="n">RT_CID_819x_Netcore</span><span class="p">)</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">=</span> <span class="n">CCK_Rx_Version_2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">=</span> <span class="n">CCK_Rx_Version_1</span><span class="p">;</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">DbgMode</span> <span class="o">=</span> <span class="n">DM_DBG_OFF</span><span class="p">;</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">disabledRF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_pwdb_sta</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">64</span><span class="p">;</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_enable_rssi_th</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_rxpath_sel_byrssi</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span>				<span class="n">i</span><span class="p">,</span> <span class="n">max_rssi_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">min_rssi_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sec_rssi_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rf_num</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">tmp_max_rssi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmp_min_rssi</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmp_sec_rssi</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">cck_default_Rx</span><span class="o">=</span><span class="mh">0x2</span><span class="p">;</span>	<span class="c1">//RF-C</span>
	<span class="n">u8</span>				<span class="n">cck_optional_Rx</span><span class="o">=</span><span class="mh">0x3</span><span class="p">;</span><span class="c1">//RF-D</span>
	<span class="kt">long</span>				<span class="n">tmp_cck_max_pwdb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmp_cck_min_pwdb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tmp_cck_sec_pwdb</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">cck_rx_ver2_max_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cck_rx_ver2_min_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cck_rx_ver2_sec_index</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">cur_rf_rssi</span><span class="p">;</span>
	<span class="kt">long</span>				<span class="n">cur_cck_pwdb</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span>			<span class="n">disabled_rf_cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cck_Rx_Path_initialized</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">update_cck_rx_path</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">!=</span> <span class="n">RF_2T4R</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">cck_Rx_Path_initialized</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_Rx_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa07</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">);</span>
		<span class="n">cck_Rx_Path_initialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">disabledRF</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">disabledRF</span> <span class="o">&amp;=~</span> <span class="p">(</span><span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc04</span><span class="p">));</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WIRELESS_MODE_B</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">=</span> <span class="n">CCK_Rx_Version_2</span><span class="p">;</span>	<span class="c1">//pure B mode, fixed cck version2</span></pre></div></td></tr>


<tr id="section-159"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-159">&#182;</a></div><p>DbgPrint("Pure B mode, use cck rx version2 \n");</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span></pre></div></td></tr>


<tr id="section-160"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-160">&#182;</a></div><p>decide max/sec/min rssi index</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">RF90_PATH_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">DbgMode</span><span class="p">)</span>
			<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="p">{</span>
			<span class="n">rf_num</span><span class="o">++</span><span class="p">;</span>
			<span class="n">cur_rf_rssi</span> <span class="o">=</span> <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_rssi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

			<span class="k">if</span><span class="p">(</span><span class="n">rf_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>	<span class="c1">// find first enabled rf path and the rssi values</span>
			<span class="p">{</span>	<span class="c1">//initialize, set all rssi index to the same one</span>
				<span class="n">max_rssi_index</span> <span class="o">=</span> <span class="n">min_rssi_index</span> <span class="o">=</span> <span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">tmp_max_rssi</span> <span class="o">=</span> <span class="n">tmp_min_rssi</span> <span class="o">=</span> <span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">rf_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
			<span class="p">{</span>	<span class="c1">// we pick up the max index first, and let sec and min to be the same one</span>
				<span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">&gt;=</span> <span class="n">tmp_max_rssi</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">tmp_max_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">max_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">tmp_min_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">min_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">&gt;</span> <span class="n">tmp_max_rssi</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">tmp_max_rssi</span><span class="p">;</span>
					<span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">max_rssi_index</span><span class="p">;</span>
					<span class="n">tmp_max_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">max_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">==</span> <span class="n">tmp_max_rssi</span><span class="p">)</span>
				<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
					<span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">cur_rf_rssi</span> <span class="o">&lt;</span> <span class="n">tmp_max_rssi</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">&gt;</span> <span class="n">tmp_sec_rssi</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">==</span> <span class="n">tmp_sec_rssi</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">tmp_sec_rssi</span> <span class="o">==</span> <span class="n">tmp_min_rssi</span><span class="p">)</span>
					<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
						<span class="n">tmp_sec_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
						<span class="n">sec_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span></pre></div></td></tr>


<tr id="section-161"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-161">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">cur_rf_rssi</span> <span class="o">&lt;</span> <span class="n">tmp_sec_rssi</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">&gt;</span> <span class="n">tmp_min_rssi</span><span class="p">))</span>
				<span class="p">{</span></pre></div></td></tr>


<tr id="section-162"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-162">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">==</span> <span class="n">tmp_min_rssi</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">tmp_sec_rssi</span> <span class="o">==</span> <span class="n">tmp_min_rssi</span><span class="p">)</span>
					<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
						<span class="n">tmp_min_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
						<span class="n">min_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span></pre></div></td></tr>


<tr id="section-163"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-163">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_rf_rssi</span> <span class="o">&lt;</span> <span class="n">tmp_min_rssi</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">tmp_min_rssi</span> <span class="o">=</span> <span class="n">cur_rf_rssi</span><span class="p">;</span>
					<span class="n">min_rssi_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">rf_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-164"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-164">&#182;</a></div><p>decide max/sec/min cck pwdb index</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">==</span> <span class="n">CCK_Rx_Version_2</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">RF90_PATH_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="p">{</span>
				<span class="n">rf_num</span><span class="o">++</span><span class="p">;</span>
				<span class="n">cur_cck_pwdb</span> <span class="o">=</span>  <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_pwdb_sta</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

				<span class="k">if</span><span class="p">(</span><span class="n">rf_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>	<span class="c1">// find first enabled rf path and the rssi values</span>
				<span class="p">{</span>	<span class="c1">//initialize, set all rssi index to the same one</span>
					<span class="n">cck_rx_ver2_max_index</span> <span class="o">=</span> <span class="n">cck_rx_ver2_min_index</span> <span class="o">=</span> <span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="n">tmp_cck_max_pwdb</span> <span class="o">=</span> <span class="n">tmp_cck_min_pwdb</span> <span class="o">=</span> <span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">rf_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
				<span class="p">{</span>	<span class="c1">// we pick up the max index first, and let sec and min to be the same one</span>
					<span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">&gt;=</span> <span class="n">tmp_cck_max_pwdb</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">tmp_cck_max_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_max_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span>
					<span class="p">{</span>
						<span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">tmp_cck_min_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">cck_rx_ver2_min_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">&gt;</span> <span class="n">tmp_cck_max_pwdb</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">tmp_cck_max_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">cck_rx_ver2_max_index</span><span class="p">;</span>
						<span class="n">tmp_cck_max_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_max_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">==</span> <span class="n">tmp_cck_max_pwdb</span><span class="p">)</span>
					<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
						<span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">cur_cck_pwdb</span> <span class="o">&lt;</span> <span class="n">tmp_cck_max_pwdb</span><span class="p">)</span> <span class="o">&amp;&amp;</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">&gt;</span> <span class="n">tmp_cck_sec_pwdb</span><span class="p">))</span>
					<span class="p">{</span>
						<span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">==</span> <span class="n">tmp_cck_sec_pwdb</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="k">if</span><span class="p">(</span><span class="n">tmp_cck_sec_pwdb</span> <span class="o">==</span> <span class="n">tmp_cck_min_pwdb</span><span class="p">)</span>
						<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
							<span class="n">tmp_cck_sec_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
							<span class="n">cck_rx_ver2_sec_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">else</span>
						<span class="p">{</span></pre></div></td></tr>


<tr id="section-165"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-165">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">cur_cck_pwdb</span> <span class="o">&lt;</span> <span class="n">tmp_cck_sec_pwdb</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">&gt;</span> <span class="n">tmp_cck_min_pwdb</span><span class="p">))</span>
					<span class="p">{</span></pre></div></td></tr>


<tr id="section-166"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-166">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">==</span> <span class="n">tmp_cck_min_pwdb</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="k">if</span><span class="p">(</span><span class="n">tmp_cck_sec_pwdb</span> <span class="o">==</span> <span class="n">tmp_cck_min_pwdb</span><span class="p">)</span>
						<span class="p">{</span>	<span class="c1">// let sec and min point to the different index</span>
							<span class="n">tmp_cck_min_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
							<span class="n">cck_rx_ver2_min_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
						<span class="p">}</span>
						<span class="k">else</span>
						<span class="p">{</span></pre></div></td></tr>


<tr id="section-167"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-167">&#182;</a></div><p>This case we don't need to set any index</p></td><td class="code"><div class="highlight"><pre>						<span class="p">}</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">cur_cck_pwdb</span> <span class="o">&lt;</span> <span class="n">tmp_cck_min_pwdb</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">tmp_cck_min_pwdb</span> <span class="o">=</span> <span class="n">cur_cck_pwdb</span><span class="p">;</span>
						<span class="n">cck_rx_ver2_min_index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>

			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-168"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-168">&#182;</a></div><p>Set CCK Rx path
reg0xA07[3:2]=cck default rx path, reg0xa07[1:0]=cck optional rx path.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">update_cck_rx_path</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">==</span> <span class="n">CCK_Rx_Version_2</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">cck_default_Rx</span> <span class="o">=</span> <span class="n">cck_rx_ver2_max_index</span><span class="p">;</span>
		<span class="n">cck_optional_Rx</span> <span class="o">=</span> <span class="n">cck_rx_ver2_sec_index</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">tmp_cck_max_pwdb</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">64</span><span class="p">)</span>
			<span class="n">update_cck_rx_path</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">tmp_min_rssi</span> <span class="o">&lt;</span> <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">SS_TH_low</span> <span class="o">&amp;&amp;</span> <span class="n">disabled_rf_cnt</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">((</span><span class="n">tmp_max_rssi</span> <span class="o">-</span> <span class="n">tmp_min_rssi</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">diff_TH</span><span class="p">)</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-169"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-169">&#182;</a></div><p>record the enabled rssi threshold</p></td><td class="code"><div class="highlight"><pre>			<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_enable_rssi_th</span><span class="p">[</span><span class="n">min_rssi_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_max_rssi</span><span class="o">+</span><span class="mi">5</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-170"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-170">&#182;</a></div><p>disable the BB Rx path, OFDM</p></td><td class="code"><div class="highlight"><pre>			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x1</span><span class="o">&lt;&lt;</span><span class="n">min_rssi_index</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>	<span class="c1">// 0xc04[3:0]</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM1_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x1</span><span class="o">&lt;&lt;</span><span class="n">min_rssi_index</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>	<span class="c1">// 0xd04[3:0]</span>
			<span class="n">disabled_rf_cnt</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_method</span> <span class="o">==</span> <span class="n">CCK_Rx_Version_1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">cck_default_Rx</span> <span class="o">=</span> <span class="n">max_rssi_index</span><span class="p">;</span>
			<span class="n">cck_optional_Rx</span> <span class="o">=</span> <span class="n">sec_rssi_index</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">tmp_max_rssi</span><span class="p">)</span>
				<span class="n">update_cck_rx_path</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">update_cck_rx_path</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_Rx_path</span> <span class="o">=</span> <span class="p">(</span><span class="n">cck_default_Rx</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">cck_optional_Rx</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_AFESetting</span><span class="p">,</span> <span class="mh">0x0f000000</span><span class="p">,</span> <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">cck_Rx_path</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">disabledRF</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">((</span><span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">disabledRF</span><span class="o">&gt;&gt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span>	<span class="c1">//disabled rf</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">tmp_max_rssi</span> <span class="o">&gt;=</span> <span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_enable_rssi_th</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="p">{</span></pre></div></td></tr>


<tr id="section-171"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-171">&#182;</a></div><p>enable the BB Rx path
DbgPrint("RF-%d is enabled. \n", 0x1&lt;<i);</p></td><td class="code"><div class="highlight"><pre>					<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>	<span class="c1">// 0xc04[3:0]</span>
					<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM1_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>	<span class="c1">// 0xd04[3:0]</span>
					<span class="n">DM_RxPathSelTable</span><span class="p">.</span><span class="n">rf_enable_rssi_th</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
					<span class="n">disabled_rf_cnt</span><span class="o">--</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_check_rx_path_selection()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Call a workitem to check current RXRF path and Rx Path selection by RSSI.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/28/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span>	<span class="kt">void</span>	<span class="nf">dm_check_rx_path_selection</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">queue_delayed_work</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">priv_wq</span><span class="p">,</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfpath_check_wq</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>	<span class="cm">/* dm_CheckRxRFPath */</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_init_fsync</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_time_interval</span> <span class="o">=</span> <span class="mi">500</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rate_bitmap</span> <span class="o">=</span> <span class="mh">0x0f000800</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rssi_threshold</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="cp">#ifdef RTL8190P</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bfsync_enable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bfsync_enable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_multiple_timeinterval</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_firstdiff_ratethreshold</span><span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_seconddiff_ratethreshold</span><span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">Default_Fsync</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncMonitor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="c1">// current default 0xc38 monitor on</span>

	<span class="n">init_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">dm_fsync_timer_callback</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_deInit_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_fsync_timer_callback</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">((</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">data</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">rate_index</span><span class="p">,</span> <span class="n">rate_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rate_count_diff</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span>		<span class="n">bSwitchFromCountDiff</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">bool</span>		<span class="n">bDoubleTimeInterval</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span> <span class="o">&amp;&amp;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bfsync_enable</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_CDD_FSYNC</span><span class="p">))</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-172"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-172">&#182;</a></div><p>Count rate 54, MCS [7], [12, 13, 14, 15]</p></td><td class="code"><div class="highlight"><pre>		<span class="n">u32</span> <span class="n">rate_bitmap</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">rate_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">rate_index</span> <span class="o">&lt;=</span> <span class="mi">27</span><span class="p">;</span> <span class="n">rate_index</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">rate_bitmap</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">rate_index</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rate_bitmap</span> <span class="o">&amp;</span>  <span class="n">rate_bitmap</span><span class="p">)</span>
				<span class="n">rate_count</span><span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_rate_histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">rate_index</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="k">if</span><span class="p">(</span><span class="n">rate_count</span> <span class="o">&lt;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span><span class="p">)</span>
			<span class="n">rate_count_diff</span> <span class="o">=</span> <span class="mh">0xffffffff</span> <span class="o">-</span> <span class="n">rate_count</span> <span class="o">+</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rate_count_diff</span> <span class="o">=</span> <span class="n">rate_count</span> <span class="o">-</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">rate_count_diff</span> <span class="o">&lt;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rateCountDiffRecord</span><span class="p">)</span>
		<span class="p">{</span>

			<span class="n">u32</span> <span class="n">DiffNum</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rateCountDiffRecord</span> <span class="o">-</span> <span class="n">rate_count_diff</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-173"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-173">&#182;</a></div><p>Continue count</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">DiffNum</span> <span class="o">&gt;=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_seconddiff_ratethreshold</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-174"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-174">&#182;</a></div><p>Continue count over</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">&gt;=</span><span class="mi">2</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">bSwitchFromCountDiff</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-175"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-175">&#182;</a></div><p>Stop the continued count</p></td><td class="code"><div class="highlight"><pre>			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-176"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-176">&#182;</a></div><p>If Count diff &lt;= FsyncRateCountThreshold</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">rate_count_diff</span> <span class="o">&lt;=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_firstdiff_ratethreshold</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">bSwitchFromCountDiff</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span> <span class="o">=</span> <span class="n">rate_count</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rateCountDiffRecord</span> <span class="o">=</span> <span class="n">rate_count_diff</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;rateRecord %d rateCount %d, rateCountdiff %d bSwitchFsync %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span><span class="p">,</span> <span class="n">rate_count</span><span class="p">,</span> <span class="n">rate_count_diff</span> <span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-177"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-177">&#182;</a></div><p>if we never receive those mcs rate and rssi > 30 % then switch fsyn</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rssi_threshold</span> <span class="o">&amp;&amp;</span> <span class="n">bSwitchFromCountDiff</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">bDoubleTimeInterval</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span> <span class="o">=</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">;</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">)</span>
			<span class="p">{</span>
			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">);</span>
			<span class="cp">#endif</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC3e</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
			<span class="cp">#endif</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC3e</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rssi_threshold</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="cp">#ifdef RTL8190P</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
			<span class="cp">#else</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
			<span class="cp">#endif</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC3e</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bDoubleTimeInterval</span><span class="p">){</span>
			<span class="k">if</span><span class="p">(</span><span class="n">timer_pending</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">))</span>
				<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">MSECS</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_time_interval</span><span class="o">*</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_multiple_timeinterval</span><span class="p">);</span>
			<span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span><span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">timer_pending</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">))</span>
				<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">MSECS</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_time_interval</span><span class="p">);</span>
			<span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-178"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-178">&#182;</a></div><p>Let Register return to default value;</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="cp">#ifdef RTL8190P</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="cp">#else</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
		<span class="cp">#endif</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC3e</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cp">#ifdef RTL8190P</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x164052cd</span><span class="p">);</span>
	<span class="cp">#else</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x465c52cd</span><span class="p">);</span>
	<span class="cp">#endif</span>
	<span class="p">}</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;ContinueDiffCount %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;rateRecord %d rateCount %d, rateCountdiff %d bSwitchFsync %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span><span class="p">,</span> <span class="n">rate_count</span><span class="p">,</span> <span class="n">rate_count_diff</span> <span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_StartHWFsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x465c12cf</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc3b</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_EndSWFsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
	<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">));</span></pre></div></td></tr>


<tr id="section-179"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-179">&#182;</a></div><p>Let Register return to default value;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

		<span class="cp">#ifdef RTL8190P</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="cp">#else</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC36</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
		<span class="cp">#endif</span>

		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC3e</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifndef RTL8190P</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x465c52cd</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_StartSWFsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> 			<span class="n">rateIndex</span><span class="p">;</span>
	<span class="n">u32</span> 			<span class="n">rateBitmap</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-180"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-180">&#182;</a></div><p>Initial rate record to zero, start to record.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-181"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-181">&#182;</a></div><p>Initialize continue diff count to zero, start to record.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ContinueDiffCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rateCountDiffRecord</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bswitch_fsync</span>  <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">==</span> <span class="n">WIRELESS_MODE_N_24G</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_firstdiff_ratethreshold</span><span class="o">=</span> <span class="mi">600</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_seconddiff_ratethreshold</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_firstdiff_ratethreshold</span><span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_seconddiff_ratethreshold</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">rateIndex</span> <span class="o">&lt;=</span> <span class="mi">27</span><span class="p">;</span> <span class="n">rateIndex</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">rateBitmap</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">rateIndex</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rate_bitmap</span> <span class="o">&amp;</span>  <span class="n">rateBitmap</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rate_record</span> <span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_rate_histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">rateIndex</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">timer_pending</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">))</span>
		<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">MSECS</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_time_interval</span><span class="p">);</span>
	<span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fsync_timer</span><span class="p">);</span>

<span class="cp">#ifndef RTL8190P</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x465c12cd</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_EndHWFsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">,</span> <span class="mh">0x465c52cd</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc3b</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">dm_check_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define	RegC38_Default				0</span>
<span class="cp">#define	RegC38_NonFsync_Other_AP	1</span>
<span class="cp">#define	RegC38_Fsync_AP_BCM		2</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-182"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-182">&#182;</a></div><p>u32             framesyncC34;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">static</span> <span class="n">u8</span>		<span class="n">reg_c38_State</span><span class="o">=</span><span class="n">RegC38_Default</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span>	<span class="n">reset_cnt</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;RSSI %d TimeInterval %d MultipleTimeInterval %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rssi_threshold</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_time_interval</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_multiple_timeinterval</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_HALDM</span><span class="p">,</span> <span class="s">&quot;RateBitmap 0x%x FirstDiffRateThreshold %d SecondDiffRateThreshold %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_rate_bitmap</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_firstdiff_ratethreshold</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_seconddiff_ratethreshold</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_CDD_FSYNC</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bfsync_enable</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">switch</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">case</span> <span class="n">Default_Fsync</span>:
					<span class="n">dm_StartHWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">HW_Fsync</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">SW_Fsync</span>:
					<span class="n">dm_EndSWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">dm_StartHWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">HW_Fsync</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">HW_Fsync</span>:
				<span class="nl">default:</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="k">switch</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">case</span> <span class="n">Default_Fsync</span>:
					<span class="n">dm_StartSWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">SW_Fsync</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">HW_Fsync</span>:
					<span class="n">dm_EndHWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">dm_StartSWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">SW_Fsync</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="n">SW_Fsync</span>:
				<span class="nl">default:</span>
					<span class="k">break</span><span class="p">;</span>

			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncMonitor</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">reg_c38_State</span> <span class="o">!=</span> <span class="n">RegC38_Fsync_AP_BCM</span><span class="p">)</span>
			<span class="p">{</span>	<span class="c1">//For broadcom AP we write different default value</span>
				<span class="cp">#ifdef RTL8190P</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
				<span class="cp">#else</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">);</span>
				<span class="cp">#endif</span>

				<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_Fsync_AP_BCM</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">switch</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">case</span> <span class="n">HW_Fsync</span>:
				<span class="n">dm_EndHWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">Default_Fsync</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">SW_Fsync</span>:
				<span class="n">dm_EndSWFsync</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">fsync_state</span> <span class="o">=</span> <span class="n">Default_Fsync</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">Default_Fsync</span>:
			<span class="nl">default:</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncMonitor</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;=</span> <span class="n">RegC38_TH</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">reg_c38_State</span> <span class="o">!=</span> <span class="n">RegC38_NonFsync_Other_AP</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="cp">#ifdef RTL8190P</span>
							<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
						<span class="cp">#else</span>
							<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
						<span class="cp">#endif</span>

						<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_NonFsync_Other_AP</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">RegC38_TH</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">reg_c38_State</span><span class="p">)</span>
					<span class="p">{</span>
						<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span><span class="p">);</span>
						<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_Default</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-183"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-183">&#182;</a></div><p>DbgPrint("Fsync is idle, rssi>=40, write 0xc38 = 0x%x \n", pHalData->framesync);</p></td><td class="code"><div class="highlight"><pre>					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="n">reg_c38_State</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span><span class="p">);</span>
					<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_Default</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-184"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-184">&#182;</a></div><p>DbgPrint("Fsync is idle, not connected, write 0xc38 = 0x%x \n", pHalData->framesync);</p></td><td class="code"><div class="highlight"><pre>				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncMonitor</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span> <span class="o">!=</span> <span class="n">reset_cnt</span><span class="p">)</span>
		<span class="p">{</span>	<span class="c1">//After silent reset, the reg_c38_State will be returned to default value</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span><span class="p">);</span>
			<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_Default</span><span class="p">;</span>
			<span class="n">reset_cnt</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reset_count</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-185"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-185">&#182;</a></div><p>DbgPrint("reg<em>c38</em>State = 0 for silent reset. \n");</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">reg_c38_State</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span><span class="p">);</span>
			<span class="n">reg_c38_State</span> <span class="o">=</span> <span class="n">RegC38_Default</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-186"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-186">&#182;</a></div><p>DbgPrint("framesync no monitor, write 0xc38 = 0x%x \n", pHalData->framesync);</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	dm_shadow_init()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Store all NIC MAC/BB register content.</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	05/29/2008	amy		Create Version 0 porting from windows code.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="nf">dm_shadow_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">page</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">offset</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">page</span><span class="o">++</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">offset</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">dm_shadow</span><span class="p">[</span><span class="n">page</span><span class="p">][</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="o">+</span><span class="n">page</span><span class="o">*</span><span class="mi">256</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-187"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-187">&#182;</a></div><p>DbgPrint("P-%d/O-%02x=%02x\r\n", page, offset, DM_Shadow[page][offset]);</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">page</span><span class="o">++</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">offset</span><span class="o">++</span><span class="p">)</span>
			<span class="n">dm_shadow</span><span class="p">[</span><span class="n">page</span><span class="p">][</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="o">+</span><span class="n">page</span><span class="o">*</span><span class="mi">256</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">;</span> <span class="n">page</span><span class="o">++</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">offset</span><span class="o">++</span><span class="p">)</span>
			<span class="n">dm_shadow</span><span class="p">[</span><span class="n">page</span><span class="p">][</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="o">+</span><span class="n">page</span><span class="o">*</span><span class="mi">256</span><span class="p">);</span>

<span class="p">}</span>   <span class="cm">/* dm_shadow_init */</span>

<span class="cm">/*---------------------------Define function prototype------------------------*/</span>
<span class="cm">/*-----------------------------------------------------------------------------</span>
<span class="cm"> * Function:	DM_DynamicTxPower()</span>
<span class="cm"> *</span>
<span class="cm"> * Overview:	Detect Signal strength to control TX Registry</span>
<span class="cm">			Tx Power Control For Near/Far Range</span>
<span class="cm"> *</span>
<span class="cm"> * Input:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Output:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Return:		NONE</span>
<span class="cm"> *</span>
<span class="cm"> * Revised History:</span>
<span class="cm"> *	When		Who		Remark</span>
<span class="cm"> *	03/06/2008	Jacken	Create Version 0.</span>
<span class="cm"> *</span>
<span class="cm"> *---------------------------------------------------------------------------*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_init_dynamic_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-188"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-188">&#182;</a></div><p>Initial TX Power Control for near/far range , add by amy 2008/05/15, porting from windows code.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>    <span class="c1">//Default to enable Tx Power Control</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_High</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_Low</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_dynamic_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">txhipower_threshhold</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">txlowpower_threshold</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">bdynamic_txpower_enable</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-189"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-189">&#182;</a></div><p>printk("priv->ieee80211->current<em>network.unknown</em>cap<em>exist is %d ,priv->ieee80211->current</em>network.broadcom<em>cap</em>exist is %d\n",priv->ieee80211->current<em>network.unknown</em>cap<em>exist,priv->ieee80211->current</em>network.broadcom<em>cap</em>exist);</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">atheros_cap_exist</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">==</span> <span class="n">IEEE_G</span><span class="p">)){</span>
		<span class="n">txhipower_threshhold</span> <span class="o">=</span> <span class="n">TX_POWER_ATHEROAP_THRESH_HIGH</span><span class="p">;</span>
		<span class="n">txlowpower_threshold</span> <span class="o">=</span> <span class="n">TX_POWER_ATHEROAP_THRESH_LOW</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">txhipower_threshhold</span> <span class="o">=</span> <span class="n">TX_POWER_NEAR_FIELD_THRESH_HIGH</span><span class="p">;</span>
		<span class="n">txlowpower_threshold</span> <span class="o">=</span> <span class="n">TX_POWER_NEAR_FIELD_THRESH_LOW</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-190"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-190">&#182;</a></div><p>printk("=======>%s(): txhipower<em>threshhold is %d,txlowpower</em>threshold is %d\n",<strong>FUNCTION</strong>,txhipower<em>threshhold,txlowpower</em>threshold);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TXAGC</span><span class="p">,</span><span class="s">&quot;priv-&gt;undecorated_smoothed_pwdb = %ld </span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">IEEE80211_LINKED</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">txhipower_threshhold</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span></pre></div></td></tr>


<tr id="section-191"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-191">&#182;</a></div><p>high power state check</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">txlowpower_threshold</span> <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span></pre></div></td></tr>


<tr id="section-192"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-192">&#182;</a></div><p>low power state check</p></td><td class="code"><div class="highlight"><pre>			<span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="mi">35</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="mi">40</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-193"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-193">&#182;</a></div><p>pHalData->bTXPowerCtrlforNearFarRange = !pHalData->bTXPowerCtrlforNearFarRange;</p></td><td class="code"><div class="highlight"><pre>		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span> <span class="o">!=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_High</span> <span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span> <span class="o">!=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_Low</span> <span class="p">)</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TXAGC</span><span class="p">,</span><span class="s">&quot;SetTxPowerLevel8190()  channel = %d </span><span class="se">\n</span><span class="s">&quot;</span> <span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>

<span class="cp">#if  defined(RTL8190P) || defined(RTL8192E)</span>
		<span class="n">SetTxPowerLevel8190</span><span class="p">(</span><span class="n">Adapter</span><span class="p">,</span><span class="n">pHalData</span><span class="o">-&gt;</span><span class="n">CurrentChannel</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef RTL8192U</span>
		<span class="n">rtl8192_phy_setTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-194"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-194">&#182;</a></div><p>pHalData->bStartTxCtrlByTPCNFR = FALSE;    //Clear th flag of Set TX Power from Sitesurvey</p></td><td class="code"><div class="highlight"><pre><span class="cp">#endif</span>
	<span class="p">}</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_High</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxHighPower</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bLastDTPFlag_Low</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bDynamicTxLowPower</span><span class="p">;</span>

<span class="p">}</span>	<span class="cm">/* dm_dynamic_txpower */</span></pre></div></td></tr>


<tr id="section-195"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-195">&#182;</a></div><p>added by vivi, for read tx rate and retrycount</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_check_txrateandretrycount</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ieee80211</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-196"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-196">&#182;</a></div><p>for 11n tx rate
priv->stats.CurrentShowTxate = read<em>nic</em>byte(dev, Current<em>Tx</em>Rate_Reg);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">softmac_stats</span><span class="p">.</span><span class="n">CurrentShowTxate</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">Current_Tx_Rate_Reg</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-197"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-197">&#182;</a></div><p>printk("=============>tx<em>rate</em>reg:%x\n", ieee->softmac<em>stats.CurrentShowTxate);
for initial tx rate
priv->stats.last</em>packet<em>rate = read</em>nic<em>byte(dev, Initial</em>Tx<em>Rate</em>Reg);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">softmac_stats</span><span class="p">.</span><span class="n">last_packet_rate</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span> <span class="p">,</span><span class="n">Initial_Tx_Rate_Reg</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-198"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-198">&#182;</a></div><p>for tx tx retry count
priv->stats.txretrycount = read<em>nic</em>dword(dev, Tx<em>Retry</em>Count_Reg);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">softmac_stats</span><span class="p">.</span><span class="n">txretrycount</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">Tx_Retry_Count_Reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dm_send_rssi_tofw</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">DCMD_TXCMD_T</span>			<span class="n">tx_cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">ieee80211_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-199"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-199">&#182;</a></div><p>If we test chariot, we should stop the TX command ?
Because 92E will always silent reset when we send tx command. We use register
0x1e0(byte) to notify driver.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">DRIVER_RSSI</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Op</span>		<span class="o">=</span> <span class="n">TXCMD_SET_RX_RSSI</span><span class="p">;</span>
	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Length</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">tx_cmd</span><span class="p">.</span><span class="n">Value</span>		<span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">;</span>

	<span class="n">cmpk_message_handle_tx</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tx_cmd</span><span class="p">,</span>
								<span class="n">DESC_PACKET_TYPE_INIT</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">DCMD_TXCMD_T</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*---------------------------Define function prototype------------------------*/</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
