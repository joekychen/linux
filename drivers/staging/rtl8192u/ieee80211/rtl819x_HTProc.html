<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8192u › ieee80211 › rtl819x_HTProc.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>rtl819x_HTProc.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>As this function is mainly ported from Windows driver, so leave the name little changed. If any confusion caused, tell me. Created by WB. 2008.05.08</p></td><td class="code"><div class="highlight"><pre><span class="cp">#include &quot;ieee80211.h&quot;</span>
<span class="cp">#include &quot;rtl819x_HT.h&quot;</span>
<span class="n">u8</span> <span class="n">MCS_FILTER_ALL</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>

<span class="n">u8</span> <span class="n">MCS_FILTER_1SS</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>

<span class="n">u16</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">77</span><span class="p">]</span> <span class="o">=</span>
	<span class="p">{</span>	<span class="p">{</span>	<span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">78</span> <span class="p">,</span><span class="mi">104</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span>
			<span class="mi">39</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span> <span class="mi">468</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span>
			<span class="mi">195</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span>
			<span class="mi">286</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">429</span><span class="p">},</span>			<span class="c1">// Long GI, 20MHz</span>
			<span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span>
			<span class="mi">43</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">462</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">578</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span>
			<span class="mi">217</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span>
			<span class="mi">318</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">477</span><span class="p">}</span>	<span class="p">},</span>		<span class="c1">// Short GI, 20MHz</span>
		<span class="p">{</span>	<span class="p">{</span><span class="mi">27</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span>
			<span class="mi">81</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">729</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">864</span><span class="p">,</span> <span class="mi">972</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span>
			<span class="mi">12</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span>
			<span class="mi">405</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span>
			<span class="mi">594</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">729</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">729</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">891</span><span class="p">},</span> 	<span class="c1">// Long GI, 40MHz</span>
			<span class="p">{</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span>
			<span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">960</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span>
			<span class="mi">13</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span>
			<span class="mi">450</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span>
			<span class="mi">660</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">990</span><span class="p">}</span>	<span class="p">}</span>	<span class="c1">// Short GI, 40MHz</span>
	<span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">NETGEAR834Bv2_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">};</span>	<span class="c1">//cosa 03202008</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">PCI_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">EDIMAX_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">};</span>
<span class="k">static</span> <span class="n">u8</span> <span class="n">AIRLINK_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">};</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>static u8 DLINK_ATHEROS[3] = {0x00, 0x1c, 0xf0};</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="n">u8</span> <span class="n">CISCO_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">};</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>2008/04/01 MH For Cisco G mode RX TP We need to change FW duration. Should we put the
code in other place??
static u8 WIFI<em>CISCO</em>G_AP[3] = {0x00, 0x40, 0x96};</p></td><td class="code"><div class="highlight"><pre><span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function update default settings in pHTInfo structure</span>
<span class="cm"> *   input:  PRT_HIGH_THROUGHPUT	pHTInfo</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:  These value need be modified if any changes.</span>
<span class="cm"> * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTUpdateDefaultSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>const typeof( ((struct ieee80211<em>device *)0)->pHTInfo ) *</em>_mptr = &pHTInfo;</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>printk("pHTinfo:%p, &amp;pHTinfo:%p, mptr:%p,  offsetof:%x\n", pHTInfo, &amp;pHTInfo, <em>_mptr, offsetof(struct ieee80211</em>device, pHTInfo));
printk("===>ieee:%p,\n", ieee);
ShortGI support</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span><span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>40MHz channel support</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>CCK rate support in 40MHz channel</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>AMSDU related</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span> <span class="o">=</span> <span class="mi">7935UL</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>AMPDU related</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//// 0: 2n13(8K), 1:2n14(16K), 2:2n15(32K), 3:2n16(64k)</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="c1">// 0: No restriction, 1: 1/8usec, 2: 1/4usec, 3: 1/2usec, 4: 1usec, 5: 2usec, 6: 4usec, 7:8usec</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>MIMO Power Save</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span><span class="c1">// 0: Static Mimo Ps, 1: Dynamic Mimo Ps, 3: No Limitation, 2: Reserved(Set to 3 automatically.)</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>8190 only. Assign rate operation mode to firmware</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bTxDisableRateFallBack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bTxUseDriverAssingedRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#ifdef 	TO_DO_LIST</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>8190 only. Assign duration operation mode to firmware</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pMgntInfo</span><span class="o">-&gt;</span><span class="n">bTxEnableFwCalcDur</span> <span class="o">=</span> <span class="p">(</span><span class="n">BOOLEAN</span><span class="p">)</span><span class="n">pNdisCommon</span><span class="o">-&gt;</span><span class="n">bRegTxEnableFwCalcDur</span><span class="p">;</span>
<span class="cp">#endif</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>8190 only, Realtek proprietary aggregation mode
Set MPDUDensity=2,   1: Set MPDUDensity=2(32k)  for Realtek AP and set MPDUDensity=0(8k) for others</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="c1">//0: Set MPDUDensity=2,   1: Set MPDUDensity=2(32k)  for Realtek AP and set MPDUDensity=0(8k) for others</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>For Rx Reorder Control</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRxReorderEnable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RxReorderWinSize</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RxReorderPendingTime</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

<span class="cp">#ifdef USB_TX_DRIVER_AGGREGATION_ENABLE</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbTxAggrNum</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef USB_RX_AGGREGATION_SUPPORT</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrEn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrPageNum</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrPacketNum</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">UsbRxFwAggrTimeout</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="c1">////usb rx FW aggregation timeout threshold.It&#39;s in units of 64us</span>
<span class="cp">#endif</span>


<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function print out each field on HT capability IE mainly from (Beacon/ProbeRsp/AssocReq)</span>
<span class="cm"> *   input:  u8*	CapIE       //Capability IE to be printed out</span>
<span class="cm"> *   	     u8* 	TitleString //mainly print out caller function</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:  Driver should not print out this message by default.</span>
<span class="cm"> * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTDebugHTCapability</span><span class="p">(</span><span class="n">u8</span><span class="o">*</span> <span class="n">CapIE</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">TitleString</span> <span class="p">)</span>
<span class="p">{</span>

	<span class="k">static</span> <span class="n">u8</span>	<span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>	<span class="c1">// For 11n EWC definition, 2007.07.17, by Emily</span>
	<span class="n">PHT_CAPABILITY_ELE</span> 		<span class="n">pCapELE</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">CapIE</span><span class="p">,</span> <span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">)))</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>EWC IE</p></td><td class="code"><div class="highlight"><pre>		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;EWC IE in %s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">CapIE</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="p">}</span><span class="k">else</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">CapIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;&lt;Log HT Capability&gt;. Called by %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TitleString</span> <span class="p">);</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Supported Channel Width = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;20MHz&quot;</span><span class="o">:</span> <span class="s">&quot;20/40MHz&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support Short GI for 20M = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;YES&quot;</span><span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support Short GI for 40M = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;YES&quot;</span><span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support TX STBC = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxSTBC</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;YES&quot;</span><span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Max AMSDU Size = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;3839&quot;</span><span class="o">:</span> <span class="s">&quot;7935&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support CCK in 20/40 mode = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;YES&quot;</span><span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Max AMPDU Factor = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">MPDU Density = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">MCS Rate Set = [%x][%x][%x][%x][%x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
				<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function print out each field on HT Information IE mainly from (Beacon/ProbeRsp)</span>
<span class="cm"> *   input:  u8*	InfoIE       //Capability IE to be printed out</span>
<span class="cm"> *   	     u8* 	TitleString //mainly print out caller function</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:  Driver should not print out this message by default.</span>
<span class="cm"> * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTDebugHTInfo</span><span class="p">(</span><span class="n">u8</span><span class="o">*</span>	<span class="n">InfoIE</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">TitleString</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">static</span> <span class="n">u8</span>	<span class="n">EWC11NHTInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">};</span>	<span class="c1">// For 11n EWC definition, 2007.07.17, by Emily</span>
	<span class="n">PHT_INFORMATION_ELE</span>		<span class="n">pHTInfoEle</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">InfoIE</span><span class="p">,</span> <span class="n">EWC11NHTInfo</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTInfo</span><span class="p">)))</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>Not EWC IE</p></td><td class="code"><div class="highlight"><pre>		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;EWC IE in %s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
		<span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">InfoIE</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="p">}</span><span class="k">else</span>
		<span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">InfoIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>


	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;&lt;Log HT Information Element&gt;. Called by %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TitleString</span><span class="p">);</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Primary channel = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ControlChl</span><span class="p">);</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Senondary channel =&quot;</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;Not Present</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;Upper channel</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;Reserved. Eooro!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;Lower Channel</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Recommended channel width = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;20Mhz&quot;</span><span class="o">:</span> <span class="s">&quot;40Mhz&quot;</span><span class="p">);</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Operation mode for protection = &quot;</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;No Protection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT non-member protection mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;Suggest to open protection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT mixed mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Basic MCS Rate Set = [%x][%x][%x][%x][%x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>\
				<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">*	Return:     	true if station in half n mode and AP supports 40 bw</span>
<span class="cm">*/</span>
<span class="n">bool</span> <span class="nf">IsHTHalfNmode40Bandwidth</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	 <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span> <span class="p">)</span>	<span class="c1">// wireless is n mode</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>	<span class="c1">// station supports 40 bw</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span> 	<span class="c1">// station in half n mode</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(((</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">)</span> <span class="c1">// ap support 40 bw</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">IsHTHalfNmodeSGI</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">bool</span> <span class="n">is40MHz</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	 <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span> <span class="p">)</span>	<span class="c1">// wireless is n mode</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span> 	<span class="c1">// station in half n mode</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">is40MHz</span><span class="p">)</span> <span class="c1">// ap support 40 bw</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(((</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span><span class="p">)</span> <span class="c1">// ap support 40 bw short GI</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(((</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span><span class="p">)</span> <span class="c1">// ap support 40 bw short GI</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u16</span> <span class="nf">HTHalfMcsToDataRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> 	<span class="n">u8</span>	<span class="n">nMcsRate</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u8</span>	<span class="n">is40MHz</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span><span class="p">;</span>

	<span class="n">is40MHz</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">IsHTHalfNmode40Bandwidth</span><span class="p">(</span><span class="n">ieee</span><span class="p">))</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">isShortGI</span> <span class="o">=</span> <span class="p">(</span><span class="n">IsHTHalfNmodeSGI</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">is40MHz</span><span class="p">))</span><span class="o">?</span> <span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][(</span><span class="n">nMcsRate</span><span class="o">&amp;</span><span class="mh">0x7f</span><span class="p">)];</span>
<span class="p">}</span>


<span class="n">u16</span> <span class="nf">HTMcsToDataRate</span><span class="p">(</span> <span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="n">nMcsRate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">u8</span>	<span class="n">is40MHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span><span class="o">?</span>
						<span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="p">)</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
						<span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="p">)</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][(</span><span class="n">nMcsRate</span><span class="o">&amp;</span><span class="mh">0x7f</span><span class="p">)];</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function returns current datarate.</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8 			nDataRate</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  tx rate</span>
<span class="cm"> *  notice:  quite unsure about how to use this function //wb</span>
<span class="cm"> * *****************************************************************************************************************/</span>
<span class="n">u16</span>  <span class="nf">TxCountToDataRate</span><span class="p">(</span> <span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="n">nDataRate</span><span class="p">)</span>
<span class="p">{</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>PRT<em>HIGH</em>THROUGHPUT    pHTInfo = ieee->pHTInfo;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u16</span>		<span class="n">CCKOFDMRate</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x02</span> <span class="p">,</span> <span class="mh">0x04</span> <span class="p">,</span> <span class="mh">0x0b</span> <span class="p">,</span> <span class="mh">0x16</span> <span class="p">,</span> <span class="mh">0x0c</span> <span class="p">,</span> <span class="mh">0x12</span> <span class="p">,</span> <span class="mh">0x18</span> <span class="p">,</span> <span class="mh">0x24</span> <span class="p">,</span> <span class="mh">0x30</span> <span class="p">,</span> <span class="mh">0x48</span> <span class="p">,</span> <span class="mh">0x60</span> <span class="p">,</span> <span class="mh">0x6c</span><span class="p">};</span>
	<span class="n">u8</span>	<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">nDataRate</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">return</span> <span class="n">CCKOFDMRate</span><span class="p">[</span><span class="n">nDataRate</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x10</span> <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x1f</span><span class="p">)</span><span class="c1">//if(nDataRate &gt; 11 &amp;&amp; nDataRate &lt; 28 )</span>
		<span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>nDataRate = nDataRate - 12;</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span><span class="mh">0x20</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x2f</span> <span class="p">)</span> <span class="c1">//(27, 44)</span>
		<span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>nDataRate = nDataRate - 28;</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x30</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x3f</span> <span class="p">)</span>  <span class="c1">//(43, 60)</span>
		<span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>nDataRate = nDataRate - 44;</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x40</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x4f</span> <span class="p">)</span> <span class="c1">//(59, 76)</span>
		<span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>nDataRate = nDataRate - 60;</p></td><td class="code"><div class="highlight"><pre>		<span class="p">}</span>
		<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][</span><span class="n">nDataRate</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>



<span class="n">bool</span> <span class="nf">IsHTHalfNmodeAPs</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_network</span><span class="o">*</span> <span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>
	<span class="k">if</span><span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">PCI_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">EDIMAX_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">AIRLINK_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">ralink_cap_exist</span><span class="p">))</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span>
		    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span>
		    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">NETGEAR834Bv2_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">broadcom_cap_exist</span><span class="p">))</span>
		  <span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function returns peer IOT.</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:</span>
<span class="cm"> *  notice:</span>
<span class="cm"> * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTIOTPeerDetermine</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_network</span><span class="o">*</span> <span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_REALTEK</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">broadcom_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">NETGEAR834Bv2_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">PCI_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">EDIMAX_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">AIRLINK_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
			 <span class="n">net</span><span class="o">-&gt;</span><span class="n">ralink_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_RALINK</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">atheros_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_ATHEROS</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">CISCO_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_CISCO</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_UNKNOWN</span><span class="p">;</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_IOT</span><span class="p">,</span> <span class="s">&quot;Joseph debug!! IOTPEER: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span><span class="p">);</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Check whether driver should declare received rate up to MCS13 only since some chipset is not good</span>
<span class="cm"> *	     at receiving MCS14~15 frame from some AP.</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8 *			PeerMacAddr</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  return 1 if driver should declare MCS13 only(otherwise return 0)</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HTIOTActIsDisableMCS14</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
 <span class="p">}</span>


<span class="cm">/**</span>
<span class="cm">* Function:	HTIOTActIsDisableMCS15</span>
<span class="cm">*</span>
<span class="cm">* Overview:	Check whether driver should declare capability of receiving MCS15</span>
<span class="cm">*</span>
<span class="cm">* Input:</span>
<span class="cm">*			PADAPTER		Adapter,</span>
<span class="cm">*</span>
<span class="cm">* Output:		None</span>
<span class="cm">* Return:     	true if driver should disable MCS15</span>
<span class="cm">* 2008.04.15	Emily</span>
<span class="cm">*/</span>
<span class="n">bool</span> <span class="nf">HTIOTActIsDisableMCS15</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="cp">#ifdef TODO</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>Apply for 819u only</p></td><td class="code"><div class="highlight"><pre><span class="cp">#if (HAL_CODE_BASE==RTL8192)</span>

<span class="cp">#if (DEV_BUS_TYPE == USB_INTERFACE)</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Alway disable MCS15 by Jerry Chang's request.by Emily, 2008.04.15</p></td><td class="code"><div class="highlight"><pre>	<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#elif (DEV_BUS_TYPE == PCI_INTERFACE)</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>Enable MCS15 if the peer is Cisco AP. by Emily, 2008.05.12
if(pBssDesc->bCiscoCapExist)
    retValue = false;
else</p></td><td class="code"><div class="highlight"><pre>		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Jerry Chang suggest that 8190 1x2 does not need to disable MCS15</p></td><td class="code"><div class="highlight"><pre>	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm">* Function:	HTIOTActIsDisableMCSTwoSpatialStream</span>
<span class="cm">*</span>
<span class="cm">* Overview:	Check whether driver should declare capability of receiving All 2 ss packets</span>
<span class="cm">*</span>
<span class="cm">* Input:</span>
<span class="cm">*			PADAPTER		Adapter,</span>
<span class="cm">*</span>
<span class="cm">* Output:		None</span>
<span class="cm">* Return:     	true if driver should disable all two spatial stream packet</span>
<span class="cm">* 2008.04.21	Emily</span>
<span class="cm">*/</span>
<span class="n">bool</span> <span class="nf">HTIOTActIsDisableMCSTwoSpatialStream</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

<span class="cp">#ifdef TODO</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>Apply for 819u only</p></td><td class="code"><div class="highlight"><pre><span class="cp">#endif</span>
	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Check whether driver should disable EDCA turbo mode</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			PeerMacAddr</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  return 1 if driver should disable EDCA turbo mode(otherwise return 0)</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HTIOTActIsDisableEDCATurbo</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> 	<span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>	<span class="c1">// default enable EDCA Turbo mode.</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>Set specific EDCA parameter for different AP in DM handler.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Check whether we need to use OFDM to sned MGNT frame for broadcom AP</span>
<span class="cm"> *   input:  struct ieee80211_network *network   //current network we live</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  return 1 if true</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HTIOTActIsMgntUseCCK6M</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span><span class="n">network</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">retValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>2008/01/25 MH Judeg if we need to use OFDM to sned MGNT frame for broadcom AP.
2008/01/28 MH We must prevent that we select null bssid to link.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">network</span><span class="o">-&gt;</span><span class="n">broadcom_cap_exist</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">HTIOTActIsCCDFsync</span><span class="p">(</span><span class="n">u8</span><span class="o">*</span> <span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">retValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span>	<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">PeerMacAddr</span><span class="p">,</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">PeerMacAddr</span><span class="p">,</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">PeerMacAddr</span><span class="p">,</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span><span class="mi">0</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTResetIOTSetting</span><span class="p">(</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>		<span class="n">pHTInfo</span>
<span class="p">)</span>
<span class="p">{</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_UNKNOWN</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Construct Capablility Element in Beacon... if HTEnable is turned on</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			posHTCap //pointer to store Capability Ele</span>
<span class="cm"> *   	     u8*			len //store length of CE</span>
<span class="cm"> *   	     u8				IsEncrypt //whether encrypt, needed further</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:  posHTCap can&#39;t be null and should be initialized before.</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTConstructCapabilityElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">posHTCap</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">IsEncrypt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHT</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">PHT_CAPABILITY_ELE</span> 	<span class="n">pCapELE</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>u8 bIsDeclareMCS13;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">((</span><span class="n">posHTCap</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pHT</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posHTCap or pHTInfo can&#39;t be null in HTConstructCapabilityElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">==</span> <span class="n">HT_SPEC_VER_EWC</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">u8</span>	<span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>	<span class="c1">// For 11n EWC definition, 2007.07.17, by Emily</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">,</span> <span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">));</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="p">}</span><span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)</span><span class="n">posHTCap</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>HT capability info</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">AdvCoding</span> 		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// This feature is not supported now!!</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>pCapELE->ChlWidth         = (pHT->bRegBW40MHz?1:0);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MimoPwrSave</span> 		<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">GreenField</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// This feature is not supported now!!</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// We can receive Short GI!!</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// We can receive Short GI!!</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p>DbgPrint("TX HT cap/info ele BW=%d SG20=%d SG40=%d\n\r",
pCapELE->ChlWidth, pCapELE->ShortGI20Mhz, pCapELE->ShortGI40Mhz);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxSTBC</span> 		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">RxSTBC</span> 		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DelayBA</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="c1">// Do not support now!!</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span>	<span class="o">=</span> <span class="p">(</span><span class="n">MAX_RECEIVE_BUFFER_SIZE</span><span class="o">&gt;=</span><span class="mi">7935</span><span class="p">)</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span> 		<span class="o">=</span> <span class="p">((</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">PSMP</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Do not support now!!</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">LSigTxopProtect</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Do not support now!!</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>MAC HT parameters info
TODO: Nedd to take care of this part</p></td><td class="code"><div class="highlight"><pre>	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;TX HT cap/info ele BW=%d MaxAMSDUSize:%d DssCCk:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="n">IsEncrypt</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span> 	<span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="c1">// 8us</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span> 	<span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// 2 is for 32 K and 3 is 64K</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span> 	<span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 2 is for 32 K and 3 is 64K</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span> 	<span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// no density</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>Supported MCS set</p></td><td class="code"><div class="highlight"><pre>	<span class="n">memcpy</span><span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11HTOperationalRateSet</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_MCS15</span><span class="p">)</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x7f</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_MCS14</span><span class="p">)</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xbf</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_ALL_2SS</span><span class="p">)</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x00</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-36"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-36">&#182;</a></div><p>2008.06.12
For RTL819X, if pairwisekey = wep/tkip, ap is ralink, we support only MCS0~7.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-37"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-37">&#182;</a></div><p>Extended HT Capability Info</p></td><td class="code"><div class="highlight"><pre>	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ExtHTCapInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-38"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-38">&#182;</a></div><p>TXBF Capabilities</p></td><td class="code"><div class="highlight"><pre>	<span class="n">memset</span><span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxBFCap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-39"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-39">&#182;</a></div><p>Antenna Selection Capabilities</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ASCap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-40"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-40">&#182;</a></div><p>add 2 to give space for element ID and len when construct frames</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">==</span> <span class="n">HT_SPEC_VER_EWC</span><span class="p">)</span>
		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-41"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-41">&#182;</a></div><p>IEEE80211<em>DEBUG</em>DATA(IEEE80211<em>DL</em>DATA | IEEE80211<em>DL</em>HT, posHTCap, *len -2);</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-42"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-42">&#182;</a></div><p>Print each field in detail. Driver should not print out this message by default
HTDebugHTCapability(posHTCap, (u8*)"HTConstructCapability()");</p></td><td class="code"><div class="highlight"><pre>	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Construct  Information Element in Beacon... if HTEnable is turned on</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			posHTCap //pointer to store Information Ele</span>
<span class="cm"> *   	     u8*			len   //store len of</span>
<span class="cm"> *   	     u8				IsEncrypt //whether encrypt, needed further</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:  posHTCap can&#39;t be null and be initialized before. only AP and IBSS sta should do this</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTConstructInfoElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">posHTInfo</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">IsEncrypt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHT</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">PHT_INFORMATION_ELE</span>		<span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)</span><span class="n">posHTInfo</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">posHTInfo</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pHTInfoEle</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span>
	<span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posHTInfo or pHTInfoEle can&#39;t be null in HTConstructInfoElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">posHTInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_ADHOC</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_MASTER</span><span class="p">))</span> <span class="c1">//ap mode is not currently supported</span>
	<span class="p">{</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ControlChl</span> 			<span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span> 			<span class="o">=</span> <span class="p">((</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span><span class="o">?</span><span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="o">:</span>
											<span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="o">&lt;=</span><span class="mi">6</span><span class="p">)</span><span class="o">?</span>
												<span class="nl">HT_EXTCHNL_OFFSET_UPPER:</span><span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">);</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span>	<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RIFS</span> 					<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PSMPAccessOnly</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">SrvIntGranularity</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">OptMode</span>				<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">NonGFDevPresent</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">DualBeacon</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">SecondaryBeacon</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">LSigTxopProtectFull</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PcoActive</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PcoPhase</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">memset</span><span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>


		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//same above</span>

	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-43"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-43">&#182;</a></div><p>STA should not generate High Throughput Information Element</p></td><td class="code"><div class="highlight"><pre>		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-44"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-44">&#182;</a></div><p>IEEE80211<em>DEBUG</em>DATA(IEEE80211<em>DL</em>DATA | IEEE80211<em>DL</em>HT, posHTInfo, *len - 2);
HTDebugHTInfo(posHTInfo, "HTConstructInforElement");</p></td><td class="code"><div class="highlight"><pre>	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  *  According to experiment, Realtek AP to STA (based on rtl8190) may achieve best performance</span>
<span class="cm">  *  if both STA and AP set limitation of aggregation size to 32K, that is, set AMPDU density to 2</span>
<span class="cm">  *  (Ref: IEEE 11n specification). However, if Realtek STA associates to other AP, STA should set</span>
<span class="cm">  *  limitation of aggregation size to 8K, otherwise, performance of traffic stream from STA to AP</span>
<span class="cm">  *  will be much less than the traffic stream from AP to STA if both of the stream runs concurrently</span>
<span class="cm">  *  at the same time.</span>
<span class="cm">  *</span>
<span class="cm">  *  Frame Format</span>
<span class="cm">  *  Element ID		Length		OUI			Type1		Reserved</span>
<span class="cm">  *  1 byte			1 byte		3 bytes		1 byte		1 byte</span>
<span class="cm">  *</span>
<span class="cm">  *  OUI 		= 0x00, 0xe0, 0x4c,</span>
<span class="cm">  *  Type 	= 0x02</span>
<span class="cm">  *  Reserved 	= 0x00</span>
<span class="cm">  *</span>
<span class="cm">  *  2007.8.21 by Emily</span>
<span class="cm">*/</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Construct  Information Element in Beacon... in RT2RT condition</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			posRT2RTAgg //pointer to store Information Ele</span>
<span class="cm"> *   	     u8*			len   //store len</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice:</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTConstructRT2RTAggElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">posRT2RTAgg</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">posRT2RTAgg</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posRT2RTAgg can&#39;t be null in HTConstructRT2RTAggElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">posRT2RTAgg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xe0</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x4c</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span><span class="c1">//*posRT2RTAgg = 0x02;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">posRT2RTAgg</span> <span class="o">|=</span> <span class="mh">0x08</span><span class="p">;</span><span class="c1">//RT_HT_CAP_USE_WOW;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">return</span><span class="p">;</span>
<span class="cp">#ifdef TODO</span>
<span class="cp">#if (HAL_CODE_BASE == RTL8192 &amp;&amp; DEV_BUS_TYPE == USB_INTERFACE)</span>
	<span class="cm">/*</span>

<span class="cm">//DIVIDER</span>
<span class="cm">	   section of code.</span>
<span class="cm">	if(IS_UNDER_11N_AES_MODE(Adapter))</span>
<span class="cm">	{</span>
<span class="cm">		posRT2RTAgg-&gt;Octet[5] |=RT_HT_CAP_USE_AMPDU;</span>
<span class="cm">	}else</span>
<span class="cm">	{</span>
<span class="cm">		posRT2RTAgg-&gt;Octet[5] &amp;= 0xfb;</span>
<span class="cm">	}</span>
<span class="cm">	*/</span>

<span class="cp">#else</span></pre></div></td></tr>


<tr id="section-45"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-45">&#182;</a></div><p>Emily. If it is required to Ask Realtek AP to send AMPDU during AES mode, enable this</p></td><td class="code"><div class="highlight"><pre><span class="cp">#endif</span>

	<span class="n">posRT2RTAgg</span><span class="o">-&gt;</span><span class="n">Length</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="cp">#endif</span>




<span class="p">}</span>


<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  Pick the right Rate Adaptive table to use</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			pOperateMCS //A pointer to MCS rate bitmap</span>
<span class="cm"> *  return:  always we return true</span>
<span class="cm"> *  notice:</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HT_PickMCSRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">pOperateMCS</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>					<span class="n">i</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pOperateMCS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;pOperateMCS can&#39;t be null in HT_PickMCSRate()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span>
	<span class="p">{</span>
	<span class="k">case</span> <span class="n">IEEE_A</span>:
	<span class="k">case</span> <span class="n">IEEE_B</span>:
	<span class="k">case</span> <span class="n">IEEE_G</span>:</pre></div></td></tr>


<tr id="section-46"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-46">&#182;</a></div><p>Do Nothing</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-47"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-47">&#182;</a></div><p>legacy rate routine handled at selectedrate</p></td><td class="code"><div class="highlight"><pre>			<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">15</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
				<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">IEEE_N_24G</span>:	<span class="c1">//assume CCK rate ok</span>
	<span class="k">case</span> <span class="n">IEEE_N_5G</span>:</pre></div></td></tr>


<tr id="section-48"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-48">&#182;</a></div><p>no MCS rate</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-49"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-49">&#182;</a></div><p>Legacy part we only use 6, 5.5,2,1 for N<em>24G and 6 for N</em>5G.
Legacy part shall be handled at SelectRateSet().</p></td><td class="code"><div class="highlight"><pre>			<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span><span class="n">RATE_ADPT_1SS_MASK</span><span class="p">;</span>	<span class="c1">//support MCS 0~7</span>
			<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span><span class="n">RATE_ADPT_2SS_MASK</span><span class="p">;</span>
			<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;=</span><span class="n">RATE_ADPT_MCS32_MASK</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-50"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-50">&#182;</a></div><p>HT part
TODO: may be different if we have different number of antenna</p></td><td class="code"><div class="highlight"><pre>	<span class="nl">default:</span>

			<span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">*	Description:</span>
<span class="cm">*		This function will get the highest speed rate in input MCS set.</span>
<span class="cm">*</span>
<span class="cm">*	/param 	Adapter			Pionter to Adapter entity</span>
<span class="cm">*			pMCSRateSet		Pointer to MCS rate bitmap</span>
<span class="cm">*			pMCSFilter		Pointer to MCS rate filter</span>
<span class="cm">*</span>
<span class="cm">*	/return	Highest MCS rate included in pMCSRateSet and filtered by pMCSFilter.</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  This function will get the highest speed rate in input MCS set.</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *   	     u8* 			pMCSRateSet //Pointer to MCS rate bitmap</span>
<span class="cm"> *   	     u8*			pMCSFilter //Pointer to MCS rate filter</span>
<span class="cm"> *  return:  Highest MCS rate included in pMCSRateSet and filtered by pMCSFilter</span>
<span class="cm"> *  notice:</span>
<span class="cm">  * *****************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HTGetHighestMCSRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">pMCSRateSet</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">pMCSFilter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>		<span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">bitMap</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">mcsRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">availableMcsRate</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pMCSRateSet</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">pMCSFilter</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;pMCSRateSet or pMCSFilter can&#39;t be null in HTGetHighestMCSRate()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pMCSRateSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pMCSFilter</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">bitMap</span> <span class="o">=</span> <span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span><span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">if</span><span class="p">((</span><span class="n">bitMap</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="n">HTMcsToDataRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">))</span> <span class="o">&gt;</span> <span class="n">HTMcsToDataRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">mcsRate</span><span class="p">))</span>
						<span class="n">mcsRate</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">bitMap</span> <span class="o">=</span> <span class="n">bitMap</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">mcsRate</span><span class="o">|</span><span class="mh">0x80</span><span class="p">);</span>
<span class="p">}</span>



<span class="cm">/*</span>
<span class="cm">**</span>
<span class="cm">**1.Filter our operation rate set with AP&#39;s rate set</span>
<span class="cm">**2.shall reference channel bandwidth, STBC, Antenna number</span>
<span class="cm">**3.generate rate adative table for firmware</span>
<span class="cm">**David 20060906</span>
<span class="cm">**</span>
<span class="cm">** \pHTSupportedCap: the connected STA&#39;s supported rate Capability element</span>
<span class="cm">*/</span>
<span class="n">u8</span> <span class="nf">HTFilterMCSRate</span><span class="p">(</span> <span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">pSupportMCS</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span> <span class="n">pOperateMCS</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u8</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-51"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-51">&#182;</a></div><p>should never reach here</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">i</span><span class="o">&lt;=</span><span class="mi">15</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11HTOperationalRateSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&amp;</span><span class="n">pSupportMCS</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-52"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-52">&#182;</a></div><p>filter out operational rate set not supported by AP, the lenth of it is 16</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-53"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-53">&#182;</a></div><p>TODO: adjust our operational rate set  according to our channel bandwidth, STBC and Antenna number</p></td><td class="code"><div class="highlight"><pre>	<span class="n">HT_PickMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pOperateMCS</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-54"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-54">&#182;</a></div><p>TODO: fill suggested rate adaptive rate index and give firmware info using Tx command packet
we also shall suggested the first start rate set according to our singal strength</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-55"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-55">&#182;</a></div><p>For RTL819X, if pairwisekey = wep/tkip, we support only MCS0~7.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">HTSetConnectBwMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH</span>	<span class="n">Bandwidth</span><span class="p">,</span> <span class="n">HT_EXTCHNL_OFFSET</span>	<span class="n">Offset</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">HTOnAssocRsp</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">PHT_CAPABILITY_ELE</span>		<span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">PHT_INFORMATION_ELE</span>		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">nMaxAMSDUSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span><span class="o">*</span>	<span class="n">pMcsFilter</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">static</span> <span class="n">u8</span>				<span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>		<span class="c1">// For 11n EWC definition, 2007.07.17, by Emily</span>
	<span class="k">static</span> <span class="n">u8</span>				<span class="n">EWC11NHTInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">};</span>	<span class="c1">// For 11n EWC definition, 2007.07.17, by Emily</span>

	<span class="k">if</span><span class="p">(</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span> <span class="p">)</span>
	<span class="p">{</span>
		<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_ERR</span><span class="p">,</span> <span class="s">&quot;&lt;=== HTOnAssocRsp(): HT_DISABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;===&gt; HTOnAssocRsp_wq(): HT_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-56"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-56">&#182;</a></div><p>For RTL819X, we support only MCS0~15.
And also, we do not know how to use MCS32 now.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-57"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-57">&#182;</a></div><p>IEEE80211<em>DEBUG</em>DATA(IEEE80211<em>DL</em>DATA, pHTInfo->PeerHTCapBuf, sizeof(HT<em>CAPABILITY</em>ELE));
IEEE80211<em>DEBUG</em>DATA(IEEE80211<em>DL</em>DATA, pHTInfo->PeerHTInfoBuf, sizeof(HT<em>INFORMATION</em>ELE));</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">,</span><span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">)))</span>
		<span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_CAPABILITY_ELE</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">,</span> <span class="n">EWC11NHTInfo</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTInfo</span><span class="p">)))</span>
		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-58"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-58">&#182;</a></div><p>HTDebugHTCapability(pHTInfo->PeerHTCapBuf,"HTOnAssocRsp<em>wq");
HTDebugHTInfo(pHTInfo->PeerHTInfoBuf,"HTOnAssocRsp</em>wq");</p></td><td class="code"><div class="highlight"><pre>	<span class="n">IEEE80211_DEBUG_DATA</span><span class="p">(</span><span class="n">IEEE80211_DL_DATA</span><span class="o">|</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="n">pPeerHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">HT_CAPABILITY_ELE</span><span class="p">));</span></pre></div></td></tr>


<tr id="section-59"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-59">&#182;</a></div><p>//////////////////////////////////////////////////////
Configurations:
//////////////////////////////////////////////////////</p></td><td class="code"><div class="highlight"><pre>	<span class="n">HTSetConnectBwMode</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="p">(</span><span class="n">HT_CHANNEL_WIDTH</span><span class="p">)(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">),</span> <span class="p">(</span><span class="n">HT_EXTCHNL_OFFSET</span><span class="p">)(</span><span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span><span class="p">));</span></pre></div></td></tr>


<tr id="section-60"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-60">&#182;</a></div><p>IEEE80211<em>DEBUG</em>DATA(IEEE80211<em>DL</em>DATA|IEEE80211<em>DL</em>HT, pPeerHTInfo, sizeof(HT<em>INFORMATION</em>ELE));
Config Supported Channel Width setting</p></td><td class="code"><div class="highlight"><pre>		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">=</span> <span class="p">((</span><span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nb">true</span><span class="o">:</span><span class="nb">false</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-61"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-61">&#182;</a></div><p>if(pHTInfo->bCurBW40MHz == true)</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="o">=</span>
		<span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span><span class="p">)</span><span class="o">?</span><span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nb">true</span><span class="o">:</span><span class="nb">false</span><span class="p">)</span><span class="o">:</span><span class="nb">false</span><span class="p">);</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="o">=</span>
		<span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span><span class="p">)</span><span class="o">?</span><span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nb">true</span><span class="o">:</span><span class="nb">false</span><span class="p">)</span><span class="o">:</span><span class="nb">false</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-62"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-62">&#182;</a></div><p>Update short GI/ long GI setting</p>

<p>TODO:</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-63"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-63">&#182;</a></div><p>Config TX STBC setting</p>

<p>TODO:</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span>
		<span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span><span class="p">)</span><span class="o">?</span><span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">DssCCk</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nb">true</span><span class="o">:</span><span class="nb">false</span><span class="p">)</span><span class="o">:</span><span class="nb">false</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-64"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-64">&#182;</a></div><p>Config DSSS/CCK  mode in 40MHz mode</p>

<p>TODO:</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span><span class="p">;</span>

	<span class="n">nMaxAMSDUSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="mi">3839</span><span class="o">:</span><span class="mi">7935</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span> <span class="o">&gt;</span> <span class="n">nMaxAMSDUSize</span> <span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">nMaxAMSDUSize</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-65"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-65">&#182;</a></div><p>Config and configure A-MSDU setting</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-66"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-66">&#182;</a></div><p>Config A-MPDU setting</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-67"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-67">&#182;</a></div><p>&lt;1> Decide AMPDU Factor</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-68"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-68">&#182;</a></div><p>By Emily</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span> <span class="o">&gt;</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span>

	<span class="p">}</span><span class="k">else</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-69"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-69">&#182;</a></div><p>Decide AMPDU Factor according to protocol handshake</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span> <span class="o">!=</span> <span class="n">KEY_TYPE_NA</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-70"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-70">&#182;</a></div><p>Set MPDU density to 2 to Realtek AP, and set it to 0 for others
Replace MPDU factor declared in original association response frame format. 2007.08.20 by Emily</p></td><td class="code"><div class="highlight"><pre>				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">HT_AGG_SIZE_64K</span><span class="p">;</span>
		<span class="p">}</span><span class="k">else</span>
		<span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span> <span class="o">&lt;</span> <span class="n">HT_AGG_SIZE_32K</span><span class="p">)</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">HT_AGG_SIZE_32K</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-71"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-71">&#182;</a></div><p>Realtek may set 32k in security mode and 64k for others</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span> <span class="o">&gt;</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span> <span class="o">!=</span> <span class="n">KEY_TYPE_NA</span> <span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> 	<span class="o">=</span> <span class="mi">7</span><span class="p">;</span> <span class="c1">// 8us</span></pre></div></td></tr>


<tr id="section-72"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-72">&#182;</a></div><p>&lt;2> Set AMPDU Minimum MPDU Start Spacing
802.11n 3.0 section 9.7d.3</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-73"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-73">&#182;</a></div><p>Force TX AMSDU</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="p">{</span>

			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ForcedAMSDUMode</span> <span class="o">=</span> <span class="n">HT_AGG_FORCE_ENABLE</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ForcedAMSDUMaxSize</span> <span class="o">=</span> <span class="mi">7935</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span>  <span class="n">HT_IOT_ACT_TX_USE_AMSDU_8K</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-74"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-74">&#182;</a></div><p>Lanhsin: mark for tmp to avoid deauth by ap from  s3
if(memcmp(pMgntInfo->Bssid, NETGEAR834Bv2_BROADCOM, 3)==0)</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurRxReorderEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRxReorderEnable</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-75"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-75">&#182;</a></div><p>Rx Reorder Setting</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-76"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-76">&#182;</a></div><p>Filter out unsupported HT rate for this AP
Update RATR table
This is only for 8190 ,8192 or later product which using firmware to handle rate adaptive mechanism.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>

	<span class="n">HTFilterMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-77"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-77">&#182;</a></div><p>Handle Ralink AP bad MCS rate set condition. Joseph.
This fix the bug of Ralink AP. This may be removed in the future.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerMimoPs</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MimoPwrSave</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerMimoPs</span> <span class="o">==</span> <span class="n">MIMO_PS_STATIC</span><span class="p">)</span>
		<span class="n">pMcsFilter</span> <span class="o">=</span> <span class="n">MCS_FILTER_1SS</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pMcsFilter</span> <span class="o">=</span> <span class="n">MCS_FILTER_ALL</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-78"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-78">&#182;</a></div><p>Config MIMO Power Save setting</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span> <span class="o">=</span> <span class="n">HTGetHighestMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">,</span> <span class="n">pMcsFilter</span><span class="p">);</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTCurrentOperaRate</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-79"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-79">&#182;</a></div><p>WB add for MCS8 bug
pMcsFilter = MCS<em>FILTER</em>1SS;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span> <span class="o">=</span> <span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">;</span>



<span class="p">}</span>

<span class="kt">void</span> <span class="n">HTSetConnectBwModeCallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">);</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  initialize HT info(struct PRT_HIGH_THROUGHPUT)</span>
<span class="cm"> *   input:  struct ieee80211_device* 	ieee</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice: This function is called when *  (1) MPInitialization Phase *  (2) Receiving of Deauthentication from AP</span>
<span class="cm">********************************************************************************************************************/</span></pre></div></td></tr>


<tr id="section-80"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-80">&#182;</a></div><p>Config current operation mode.</p></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">HTInitializeHTInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span> <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-81"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-81">&#182;</a></div><p>TODO: Should this funciton be called when receiving of Disassociation?</p></td><td class="code"><div class="highlight"><pre>	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;===========&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-82"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-82">&#182;</a></div><p>These parameters will be reset when receiving deauthentication packet</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-83"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-83">&#182;</a></div><p>40MHz channel support</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bForcedShortGI</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-84"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-84">&#182;</a></div><p>Short GI support</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-85"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-85">&#182;</a></div><p>CCK rate support
This flag is set to true to support CCK rate by default.
It will be affected by "pHTInfo->bRegSuppCCK" and AP capabilities only when associate to
11N BSS.</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-86"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-86">&#182;</a></div><p>AMSDU related</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-87"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-87">&#182;</a></div><p>AMPUD related</p></td><td class="code"><div class="highlight"><pre>	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTCap</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTCap</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTInfo</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTInfo</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span><span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">));</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ChnlOp</span> <span class="o">=</span> <span class="n">CHNLOP_NONE</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-88"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-88">&#182;</a></div><p>Initialize all of the parameters related to 11n</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">=</span> <span class="n">HT_SPEC_VER_IEEE</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-89"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-89">&#182;</a></div><p>Set default IEEE spec for Draft N</p></td><td class="code"><div class="highlight"><pre>	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-90"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-90">&#182;</a></div><p>Realtek proprietary aggregation mode</p></td><td class="code"><div class="highlight"><pre>	<span class="p">{</span>
		<span class="n">u8</span><span class="o">*</span> <span class="n">RegHTSuppRateSets</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RegHTSuppRateSet</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>	<span class="c1">//support MCS 0~7</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>	<span class="c1">//support MCS 8~15</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>	<span class="c1">//support MCS 32</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  initialize Bss HT structure(struct PBSS_HT)</span>
<span class="cm"> *   input:  PBSS_HT pBssHT //to be initialized</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice: This function is called when initialize network structure</span>
<span class="cm">********************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTInitializeBssDesc</span><span class="p">(</span><span class="n">PBSS_HT</span> <span class="n">pBssHT</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdSupportHT</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapBuf</span><span class="p">));</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoBuf</span><span class="p">));</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTSpecVer</span><span class="o">=</span> <span class="n">HT_SPEC_VER_IEEE</span><span class="p">;</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  initialize Bss HT structure(struct PBSS_HT)</span>
<span class="cm"> *   input:  struct ieee80211_device 	*ieee</span>
<span class="cm"> *   	     struct ieee80211_network 	*pNetwork //usually current network we are live in</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  none</span>
<span class="cm"> *  notice: This function should ONLY be called before association</span>
<span class="cm">********************************************************************************************************************/</span>
<span class="kt">void</span> <span class="nf">HTResetSelfAndSavePeerSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> 	<span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span> <span class="n">pNetwork</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>		<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-91"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-91">&#182;</a></div><p>MCS rate initialized here</p></td><td class="code"><div class="highlight"><pre>	<span class="n">u8</span>	<span class="n">bIOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-92"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-92">&#182;</a></div><p>u16                        nMaxAMSDUSize;
PHT<em>CAPABILITY</em>ELE        pPeerHTCap = (PHT<em>CAPABILITY</em>ELE)pNetwork->bssht.bdHTCapBuf;
PHT<em>INFORMATION</em>ELE        pPeerHTInfo = (PHT<em>INFORMATION</em>ELE)pNetwork->bssht.bdHTInfoBuf;
u8*    pMcsFilter;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;==============&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>
	<span class="cm">/*unmark bEnableHT flag here is the same reason why unmarked in function ieee80211_softmac_new_net. WB 2008.09.10*/</span></pre></div></td></tr>


<tr id="section-93"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-93">&#182;</a></div><p>Save Peer Setting before Association</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdSupportHT</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">=</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTSpecVer</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-94"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-94">&#182;</a></div><p>if( pHTInfo->bEnableHT &amp;&amp;  pNetwork->bssht.bdSupportHT)</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> 	<span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span> <span class="o">&lt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapBuf</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">&lt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">))</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoBuf</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-95"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-95">&#182;</a></div><p>Save HTCap and HTInfo information Element</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTLongSlotTime</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">else</span>
		<span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span></pre></div></td></tr>


<tr id="section-96"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-96">&#182;</a></div><p>Check whether RT to RT aggregation mode is enabled</p></td><td class="code"><div class="highlight"><pre>		<span class="n">HTIOTPeerDetermine</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-97"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-97">&#182;</a></div><p>Determine the IOT Peer Vendor.</p></td><td class="code"><div class="highlight"><pre>		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCS14</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_MCS14</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCS15</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_MCS15</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCSTwoSpatialStream</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_ALL_2SS</span><span class="p">;</span>


		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableEDCATurbo</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_EDCA_TURBO</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsMgntUseCCK6M</span><span class="p">(</span><span class="n">pNetwork</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_MGNT_USE_CCK_6M</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsCCDFsync</span><span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_CDD_FSYNC</span><span class="p">;</span>


	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTUpdateSelfAndPeerSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> 	<span class="k">struct</span> <span class="n">ieee80211_network</span> <span class="o">*</span> <span class="n">pNetwork</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span>	<span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-98"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-98">&#182;</a></div><p>Decide IOT Action
Must be called after the parameter of pHTInfo->bCurrentRT2RTAggregation is decided</p></td><td class="code"><div class="highlight"><pre>	<span class="n">PHT_INFORMATION_ELE</span>		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PHT_INFORMATION_ELE</span><span class="p">)</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoBuf</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span><span class="p">)</span>
	<span class="p">{</span></pre></div></td></tr>


<tr id="section-99"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-99">&#182;</a></div><p>PHT<em>CAPABILITY</em>ELE        pPeerHTCap = (PHT<em>CAPABILITY</em>ELE)pNetwork->bssht.bdHTCapBuf;</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span> <span class="o">=</span> <span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-100"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-100">&#182;</a></div><p>Config current operation mode.</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTUseDefaultSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span> <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-101"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-101">&#182;</a></div><p><TODO: Config according to OBSS non-HT STA present!!></p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bEnableHT</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-102"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-102">&#182;</a></div><p>u8    regBwOpMode;</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-103"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-103">&#182;</a></div><p>Set BWOpMode register</p></td><td class="code"><div class="highlight"><pre>		<span class="n">HTFilterMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11HTOperationalRateSet</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-104"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-104">&#182;</a></div><p>update RATR index0</p></td><td class="code"><div class="highlight"><pre><span class="cp">#ifdef TODO</span>
		<span class="n">Adapter</span><span class="o">-&gt;</span><span class="n">HalFunc</span><span class="p">.</span><span class="n">InitHalRATRTableHandler</span><span class="p">(</span> <span class="n">Adapter</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pMgntInfo</span><span class="o">-&gt;</span><span class="n">dot11OperationalRateSet</span><span class="p">,</span> <span class="n">pMgntInfo</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span> <span class="o">=</span> <span class="n">HTGetHighestMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">,</span> <span class="n">MCS_FILTER_ALL</span><span class="p">);</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTCurrentOperaRate</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span><span class="p">;</span>

	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/********************************************************************************************************************</span>
<span class="cm"> *function:  check whether HT control field exists</span>
<span class="cm"> *   input:  struct ieee80211_device 	*ieee</span>
<span class="cm"> *   	     u8*			pFrame //coming skb-&gt;data</span>
<span class="cm"> *  output:  none</span>
<span class="cm"> *  return:  return true if HT control field exists(false otherwise)</span>
<span class="cm"> *  notice:</span>
<span class="cm">********************************************************************************************************************/</span>
<span class="n">u8</span> <span class="nf">HTCCheck</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span>	<span class="n">pFrame</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">IsQoSDataFrame</span><span class="p">(</span><span class="n">pFrame</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">Frame_Order</span><span class="p">(</span><span class="n">pFrame</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT CONTROL FILED EXIST!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span></pre></div></td></tr>


<tr id="section-105"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-105">&#182;</a></div><p>function below is not implemented at all. WB</p></td><td class="code"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">HTSetConnectBwMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH</span>	<span class="n">Bandwidth</span><span class="p">,</span> <span class="n">HT_EXTCHNL_OFFSET</span>	<span class="n">Offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span> <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-106"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-106">&#182;</a></div><p>This function set bandwidth mode in protocol layer.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-107"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-107">&#182;</a></div><p>u32 flags = 0;</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-108"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-108">&#182;</a></div><p>To reduce dummy operation
if((pHTInfo->bCurBW40MHz==false &amp;&amp; Bandwidth==HT<em>CHANNEL</em>WIDTH<em>20) ||
   (pHTInfo->bCurBW40MHz==true &amp;&amp; Bandwidth==HT</em>CHANNEL<em>WIDTH</em>20_40 &amp;&amp; Offset==pHTInfo->CurSTAExtChnlOffset))
    return;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-109"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-109">&#182;</a></div><p>spin<em>lock</em>irqsave(&amp;(ieee->bw_spinlock), flags);</p></td><td class="code"><div class="highlight"><pre>		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-110"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-110">&#182;</a></div><pre><code>spin_unlock_irqrestore(&amp;(ieee-&gt;bw_spinlock), flags);
</code></pre></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span><span class="p">(</span><span class="n">Bandwidth</span><span class="o">==</span><span class="n">HT_CHANNEL_WIDTH_20_40</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">)))</span>
	 <span class="p">{</span></pre></div></td></tr>


<tr id="section-111"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-111">&#182;</a></div><p>if in half N mode, set to 20M bandwidth please 09.08.2008 WB.</p></td><td class="code"><div class="highlight"><pre>		<span class="k">if</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="o">&lt;</span><span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">Offset</span><span class="o">==</span><span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span>
			<span class="n">Offset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="n">Offset</span><span class="o">==</span><span class="n">HT_EXTCHNL_OFFSET_UPPER</span> <span class="o">||</span> <span class="n">Offset</span><span class="o">==</span><span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-112"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-112">&#182;</a></div><p>Handle Illegal extension channel offset!!</p></td><td class="code"><div class="highlight"><pre>	<span class="n">HTSetConnectBwModeCallback</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-113"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-113">&#182;</a></div><p>TODO: 2007.7.13 by Emily Wait 2000ms  in order to guarantee that switching
  bandwidth is executed after scan is finished. It is a temporal solution
  because software should ganrantee the last operation of switching bandwidth
  is executed properlly.</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTSetConnectBwModeCallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_device</span><span class="o">*</span> <span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PRT_HIGH_THROUGHPUT</span> <span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">IEEE80211_DEBUG</span><span class="p">(</span><span class="n">IEEE80211_DL_HT</span><span class="p">,</span> <span class="s">&quot;======&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span><span class="o">==</span><span class="n">HT_EXTCHNL_OFFSET_UPPER</span><span class="p">)</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="o">+</span><span class="mi">2</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span><span class="o">==</span><span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>

		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">SetBWModeHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span><span class="p">,</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">SetBWModeHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">,</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">HTUpdateSelfAndPeerSetting</span><span class="p">);</span>

</pre></div></td></tr>


<tr id="section-114"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-114">&#182;</a></div><p>spin<em>unlock</em>irqrestore(&amp;(ieee->bw_spinlock), flags);</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
