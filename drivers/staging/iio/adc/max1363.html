<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › iio › adc › max1363.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>max1363.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _MAX1363_H_</span>
<span class="cp">#define  _MAX1363_H_</span>

<span class="cp">#define MAX1363_SETUP_BYTE(a) ((a) | 0x80)</span>

<span class="cm">/* There is a fair bit more defined here than currently</span>
<span class="cm"> * used, but the intention is to support everything these</span>
<span class="cm"> * chips do in the long run */</span>

<span class="cm">/* see data sheets */</span>
<span class="cm">/* max1363 and max1236, max1237, max1238, max1239 */</span>
<span class="cp">#define MAX1363_SETUP_AIN3_IS_AIN3_REF_IS_VDD	0x00</span>
<span class="cp">#define MAX1363_SETUP_AIN3_IS_REF_EXT_TO_REF	0x20</span>
<span class="cp">#define MAX1363_SETUP_AIN3_IS_AIN3_REF_IS_INT	0x40</span>
<span class="cp">#define MAX1363_SETUP_AIN3_IS_REF_REF_IS_INT	0x60</span>
<span class="cp">#define MAX1363_SETUP_POWER_UP_INT_REF		0x10</span>
<span class="cp">#define MAX1363_SETUP_POWER_DOWN_INT_REF	0x00</span>

<span class="cm">/* think about includeing max11600 etc - more settings */</span>
<span class="cp">#define MAX1363_SETUP_EXT_CLOCK			0x08</span>
<span class="cp">#define MAX1363_SETUP_INT_CLOCK			0x00</span>
<span class="cp">#define MAX1363_SETUP_UNIPOLAR			0x00</span>
<span class="cp">#define MAX1363_SETUP_BIPOLAR			0x04</span>
<span class="cp">#define MAX1363_SETUP_RESET			0x00</span>
<span class="cp">#define MAX1363_SETUP_NORESET			0x02</span>
<span class="cm">/* max1363 only - though don&#39;t care on others.</span>
<span class="cm"> * For now monitor modes are not implemented as the relevant</span>
<span class="cm"> * line is not connected on my test board.</span>
<span class="cm"> * The definitions are here as I intend to add this soon.</span>
<span class="cm"> */</span>
<span class="cp">#define MAX1363_SETUP_MONITOR_SETUP		0x01</span>

<span class="cm">/* Specific to the max1363 */</span>
<span class="cp">#define MAX1363_MON_RESET_CHAN(a) (1 &lt;&lt; ((a) + 4))</span>
<span class="cp">#define MAX1363_MON_INT_ENABLE			0x01</span>

<span class="cm">/* defined for readability reasons */</span>
<span class="cm">/* All chips */</span>
<span class="cp">#define MAX1363_CONFIG_BYTE(a) ((a))</span>

<span class="cp">#define MAX1363_CONFIG_SE			0x01</span>
<span class="cp">#define MAX1363_CONFIG_DE			0x00</span>
<span class="cp">#define MAX1363_CONFIG_SCAN_TO_CS		0x00</span>
<span class="cp">#define MAX1363_CONFIG_SCAN_SINGLE_8		0x20</span>
<span class="cp">#define MAX1363_CONFIG_SCAN_MONITOR_MODE	0x40</span>
<span class="cp">#define MAX1363_CONFIG_SCAN_SINGLE_1		0x60</span>
<span class="cm">/* max123{6-9} only */</span>
<span class="cp">#define MAX1236_SCAN_MID_TO_CHANNEL		0x40</span>

<span class="cm">/* max1363 only - merely part of channel selects or don&#39;t care for others*/</span>
<span class="cp">#define MAX1363_CONFIG_EN_MON_MODE_READ 0x18</span>

<span class="cp">#define MAX1363_CHANNEL_SEL(a) ((a) &lt;&lt; 1)</span>

<span class="cm">/* max1363 strictly 0x06 - but doesn&#39;t matter */</span>
<span class="cp">#define MAX1363_CHANNEL_SEL_MASK		0x1E</span>
<span class="cp">#define MAX1363_SCAN_MASK			0x60</span>
<span class="cp">#define MAX1363_SE_DE_MASK			0x01</span>

<span class="cp">#define MAX1363_MAX_CHANNELS 25</span>
<span class="cm">/**</span>
<span class="cm"> * struct max1363_mode - scan mode information</span>
<span class="cm"> * @conf:	The corresponding value of the configuration register</span>
<span class="cm"> * @modemask:	Bit mask corresponding to channels enabled in this mode</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">max1363_mode</span> <span class="p">{</span>
	<span class="kt">int8_t</span>		<span class="n">conf</span><span class="p">;</span>
	<span class="n">DECLARE_BITMAP</span><span class="p">(</span><span class="n">modemask</span><span class="p">,</span> <span class="n">MAX1363_MAX_CHANNELS</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* This must be maintained along side the max1363_mode_table in max1363_core */</span>
<span class="k">enum</span> <span class="n">max1363_modes</span> <span class="p">{</span>
	<span class="cm">/* Single read of a single channel */</span>
	<span class="n">_s0</span><span class="p">,</span> <span class="n">_s1</span><span class="p">,</span> <span class="n">_s2</span><span class="p">,</span> <span class="n">_s3</span><span class="p">,</span> <span class="n">_s4</span><span class="p">,</span> <span class="n">_s5</span><span class="p">,</span> <span class="n">_s6</span><span class="p">,</span> <span class="n">_s7</span><span class="p">,</span> <span class="n">_s8</span><span class="p">,</span> <span class="n">_s9</span><span class="p">,</span> <span class="n">_s10</span><span class="p">,</span> <span class="n">_s11</span><span class="p">,</span>
	<span class="cm">/* Differential single read */</span>
	<span class="n">d0m1</span><span class="p">,</span> <span class="n">d2m3</span><span class="p">,</span> <span class="n">d4m5</span><span class="p">,</span> <span class="n">d6m7</span><span class="p">,</span> <span class="n">d8m9</span><span class="p">,</span> <span class="n">d10m11</span><span class="p">,</span>
	<span class="n">d1m0</span><span class="p">,</span> <span class="n">d3m2</span><span class="p">,</span> <span class="n">d5m4</span><span class="p">,</span> <span class="n">d7m6</span><span class="p">,</span> <span class="n">d9m8</span><span class="p">,</span> <span class="n">d11m10</span><span class="p">,</span>
	<span class="cm">/* Scan to channel and mid to channel where overlapping */</span>
	<span class="n">s0to1</span><span class="p">,</span> <span class="n">s0to2</span><span class="p">,</span> <span class="n">s2to3</span><span class="p">,</span> <span class="n">s0to3</span><span class="p">,</span> <span class="n">s0to4</span><span class="p">,</span> <span class="n">s0to5</span><span class="p">,</span> <span class="n">s0to6</span><span class="p">,</span>
	<span class="n">s6to7</span><span class="p">,</span> <span class="n">s0to7</span><span class="p">,</span> <span class="n">s6to8</span><span class="p">,</span> <span class="n">s0to8</span><span class="p">,</span> <span class="n">s6to9</span><span class="p">,</span>
	<span class="n">s0to9</span><span class="p">,</span> <span class="n">s6to10</span><span class="p">,</span> <span class="n">s0to10</span><span class="p">,</span> <span class="n">s6to11</span><span class="p">,</span> <span class="n">s0to11</span><span class="p">,</span>
	<span class="cm">/* Differential scan to channel and mid to channel where overlapping */</span>
	<span class="n">d0m1to2m3</span><span class="p">,</span> <span class="n">d0m1to4m5</span><span class="p">,</span> <span class="n">d0m1to6m7</span><span class="p">,</span> <span class="n">d6m7to8m9</span><span class="p">,</span>
	<span class="n">d0m1to8m9</span><span class="p">,</span> <span class="n">d6m7to10m11</span><span class="p">,</span> <span class="n">d0m1to10m11</span><span class="p">,</span> <span class="n">d1m0to3m2</span><span class="p">,</span>
	<span class="n">d1m0to5m4</span><span class="p">,</span> <span class="n">d1m0to7m6</span><span class="p">,</span> <span class="n">d7m6to9m8</span><span class="p">,</span> <span class="n">d1m0to9m8</span><span class="p">,</span>
	<span class="n">d7m6to11m10</span><span class="p">,</span> <span class="n">d1m0to11m10</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct max1363_chip_info - chip specifc information</span>
<span class="cm"> * @name:		indentification string for chip</span>
<span class="cm"> * @bits:		accuracy of the adc in bits</span>
<span class="cm"> * @int_vref_mv:	the internal reference voltage</span>
<span class="cm"> * @info:		iio core function callbacks structure</span>
<span class="cm"> * @mode_list:		array of available scan modes</span>
<span class="cm"> * @num_modes:		the number of scan modes available</span>
<span class="cm"> * @default_mode:	the scan mode in which the chip starts up</span>
<span class="cm"> * @channel:		channel specification</span>
<span class="cm"> * @num_channels:	number of channels</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">max1363_chip_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">iio_info</span>		<span class="o">*</span><span class="n">info</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iio_chan_spec</span> <span class="o">*</span><span class="n">channels</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_channels</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">enum</span> <span class="n">max1363_modes</span>	<span class="o">*</span><span class="n">mode_list</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">max1363_modes</span>		<span class="n">default_mode</span><span class="p">;</span>
	<span class="n">u16</span>				<span class="n">int_vref_mv</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">num_modes</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">bits</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct max1363_state - driver instance specific data</span>
<span class="cm"> * @client:		i2c_client</span>
<span class="cm"> * @setupbyte:		cache of current device setup byte</span>
<span class="cm"> * @configbyte:		cache of current device config byte</span>
<span class="cm"> * @chip_info:		chip model specific constants, available modes etc</span>
<span class="cm"> * @current_mode:	the scan mode of this chip</span>
<span class="cm"> * @requestedmask:	a valid requested set of channels</span>
<span class="cm"> * @reg:		supply regulator</span>
<span class="cm"> * @monitor_on:		whether monitor mode is enabled</span>
<span class="cm"> * @monitor_speed:	parameter corresponding to device monitor speed setting</span>
<span class="cm"> * @mask_high:		bitmask for enabled high thresholds</span>
<span class="cm"> * @mask_low:		bitmask for enabled low thresholds</span>
<span class="cm"> * @thresh_high:	high threshold values</span>
<span class="cm"> * @thresh_low:		low threshold values</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">max1363_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span>		<span class="o">*</span><span class="n">client</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">setupbyte</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">configbyte</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">max1363_chip_info</span>	<span class="o">*</span><span class="n">chip_info</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">max1363_mode</span>	<span class="o">*</span><span class="n">current_mode</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">requestedmask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator</span>		<span class="o">*</span><span class="n">reg</span><span class="p">;</span>

	<span class="cm">/* Using monitor modes and buffer at the same time is</span>
<span class="cm">	   currently not supported */</span>
	<span class="n">bool</span>				<span class="n">monitor_on</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>			<span class="n">monitor_speed</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">mask_high</span><span class="p">;</span>
	<span class="n">u8</span>				<span class="n">mask_low</span><span class="p">;</span>
	<span class="cm">/* 4x unipolar first then the fours bipolar ones */</span>
	<span class="n">s16</span>				<span class="n">thresh_high</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">s16</span>				<span class="n">thresh_low</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">max1363_mode</span>
<span class="o">*</span><span class="n">max1363_match_mode</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">mask</span><span class="p">,</span>
		    <span class="k">const</span> <span class="k">struct</span> <span class="n">max1363_chip_info</span> <span class="o">*</span><span class="n">ci</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">max1363_set_scan_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">max1363_state</span> <span class="o">*</span><span class="n">st</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_MAX1363_RING_BUFFER</span>
<span class="kt">int</span> <span class="n">max1363_update_scan_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">,</span>
			     <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">scan_mask</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">max1363_register_ring_funcs_and_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">max1363_ring_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>

<span class="cp">#else </span><span class="cm">/* CONFIG_MAX1363_RING_BUFFER */</span><span class="cp"></span>
<span class="kt">int</span> <span class="nf">max1363_update_scan_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">,</span>
			     <span class="k">const</span> <span class="kt">long</span> <span class="o">*</span><span class="n">scan_mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">max1363_register_ring_funcs_and_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">max1363_ring_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_MAX1363_RING_BUFFER */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _MAX1363_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
