<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › iio › accel › adis16240.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>adis16240.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef SPI_ADIS16240_H_</span>
<span class="cp">#define SPI_ADIS16240_H_</span>

<span class="cp">#define ADIS16240_STARTUP_DELAY	220 </span><span class="cm">/* ms */</span><span class="cp"></span>

<span class="cp">#define ADIS16240_READ_REG(a)    a</span>
<span class="cp">#define ADIS16240_WRITE_REG(a) ((a) | 0x80)</span>

<span class="cm">/* Flash memory write count */</span>
<span class="cp">#define ADIS16240_FLASH_CNT      0x00</span>
<span class="cm">/* Output, power supply */</span>
<span class="cp">#define ADIS16240_SUPPLY_OUT     0x02</span>
<span class="cm">/* Output, x-axis accelerometer */</span>
<span class="cp">#define ADIS16240_XACCL_OUT      0x04</span>
<span class="cm">/* Output, y-axis accelerometer */</span>
<span class="cp">#define ADIS16240_YACCL_OUT      0x06</span>
<span class="cm">/* Output, z-axis accelerometer */</span>
<span class="cp">#define ADIS16240_ZACCL_OUT      0x08</span>
<span class="cm">/* Output, auxiliary ADC input */</span>
<span class="cp">#define ADIS16240_AUX_ADC        0x0A</span>
<span class="cm">/* Output, temperature */</span>
<span class="cp">#define ADIS16240_TEMP_OUT       0x0C</span>
<span class="cm">/* Output, x-axis acceleration peak */</span>
<span class="cp">#define ADIS16240_XPEAK_OUT      0x0E</span>
<span class="cm">/* Output, y-axis acceleration peak */</span>
<span class="cp">#define ADIS16240_YPEAK_OUT      0x10</span>
<span class="cm">/* Output, z-axis acceleration peak */</span>
<span class="cp">#define ADIS16240_ZPEAK_OUT      0x12</span>
<span class="cm">/* Output, sum-of-squares acceleration peak */</span>
<span class="cp">#define ADIS16240_XYZPEAK_OUT    0x14</span>
<span class="cm">/* Output, Capture Buffer 1, X and Y acceleration */</span>
<span class="cp">#define ADIS16240_CAPT_BUF1      0x16</span>
<span class="cm">/* Output, Capture Buffer 2, Z acceleration */</span>
<span class="cp">#define ADIS16240_CAPT_BUF2      0x18</span>
<span class="cm">/* Diagnostic, error flags */</span>
<span class="cp">#define ADIS16240_DIAG_STAT      0x1A</span>
<span class="cm">/* Diagnostic, event counter */</span>
<span class="cp">#define ADIS16240_EVNT_CNTR      0x1C</span>
<span class="cm">/* Diagnostic, check sum value from firmware test */</span>
<span class="cp">#define ADIS16240_CHK_SUM        0x1E</span>
<span class="cm">/* Calibration, x-axis acceleration offset adjustment */</span>
<span class="cp">#define ADIS16240_XACCL_OFF      0x20</span>
<span class="cm">/* Calibration, y-axis acceleration offset adjustment */</span>
<span class="cp">#define ADIS16240_YACCL_OFF      0x22</span>
<span class="cm">/* Calibration, z-axis acceleration offset adjustment */</span>
<span class="cp">#define ADIS16240_ZACCL_OFF      0x24</span>
<span class="cm">/* Clock, hour and minute */</span>
<span class="cp">#define ADIS16240_CLK_TIME       0x2E</span>
<span class="cm">/* Clock, month and day */</span>
<span class="cp">#define ADIS16240_CLK_DATE       0x30</span>
<span class="cm">/* Clock, year */</span>
<span class="cp">#define ADIS16240_CLK_YEAR       0x32</span>
<span class="cm">/* Wake-up setting, hour and minute */</span>
<span class="cp">#define ADIS16240_WAKE_TIME      0x34</span>
<span class="cm">/* Wake-up setting, month and day */</span>
<span class="cp">#define ADIS16240_WAKE_DATE      0x36</span>
<span class="cm">/* Alarm 1 amplitude threshold */</span>
<span class="cp">#define ADIS16240_ALM_MAG1       0x38</span>
<span class="cm">/* Alarm 2 amplitude threshold */</span>
<span class="cp">#define ADIS16240_ALM_MAG2       0x3A</span>
<span class="cm">/* Alarm control */</span>
<span class="cp">#define ADIS16240_ALM_CTRL       0x3C</span>
<span class="cm">/* Capture, external trigger control */</span>
<span class="cp">#define ADIS16240_XTRIG_CTRL     0x3E</span>
<span class="cm">/* Capture, address pointer */</span>
<span class="cp">#define ADIS16240_CAPT_PNTR      0x40</span>
<span class="cm">/* Capture, configuration and control */</span>
<span class="cp">#define ADIS16240_CAPT_CTRL      0x42</span>
<span class="cm">/* General-purpose digital input/output control */</span>
<span class="cp">#define ADIS16240_GPIO_CTRL      0x44</span>
<span class="cm">/* Miscellaneous control */</span>
<span class="cp">#define ADIS16240_MSC_CTRL       0x46</span>
<span class="cm">/* Internal sample period (rate) control */</span>
<span class="cp">#define ADIS16240_SMPL_PRD       0x48</span>
<span class="cm">/* System command */</span>
<span class="cp">#define ADIS16240_GLOB_CMD       0x4A</span>

<span class="cp">#define ADIS16240_OUTPUTS        6</span>

<span class="cm">/* MSC_CTRL */</span>
<span class="cm">/* Enables sum-of-squares output (XYZPEAK_OUT) */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_XYZPEAK_OUT_EN	(1 &lt;&lt; 15)</span>
<span class="cm">/* Enables peak tracking output (XPEAK_OUT, YPEAK_OUT, and ZPEAK_OUT) */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_X_Y_ZPEAK_OUT_EN	(1 &lt;&lt; 14)</span>
<span class="cm">/* Self-test enable: 1 = apply electrostatic force, 0 = disabled */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_SELF_TEST_EN	        (1 &lt;&lt; 8)</span>
<span class="cm">/* Data-ready enable: 1 = enabled, 0 = disabled */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_DATA_RDY_EN	        (1 &lt;&lt; 2)</span>
<span class="cm">/* Data-ready polarity: 1 = active high, 0 = active low */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_ACTIVE_HIGH	        (1 &lt;&lt; 1)</span>
<span class="cm">/* Data-ready line selection: 1 = DIO2, 0 = DIO1 */</span>
<span class="cp">#define ADIS16240_MSC_CTRL_DATA_RDY_DIO2	(1 &lt;&lt; 0)</span>

<span class="cm">/* DIAG_STAT */</span>
<span class="cm">/* Alarm 2 status: 1 = alarm active, 0 = alarm inactive */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_ALARM2      (1&lt;&lt;9)</span>
<span class="cm">/* Alarm 1 status: 1 = alarm active, 0 = alarm inactive */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_ALARM1      (1&lt;&lt;8)</span>
<span class="cm">/* Capture buffer full: 1 = capture buffer is full */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_CPT_BUF_FUL (1&lt;&lt;7)</span>
<span class="cm">/* Flash test, checksum flag: 1 = mismatch, 0 = match */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_CHKSUM      (1&lt;&lt;6)</span>
<span class="cm">/* Power-on, self-test flag: 1 = failure, 0 = pass */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_PWRON_FAIL  (1&lt;&lt;5)</span>
<span class="cm">/* Power-on self-test: 1 = in-progress, 0 = complete */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_PWRON_BUSY  (1&lt;&lt;4)</span>
<span class="cm">/* SPI communications failure */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_SPI_FAIL	(1&lt;&lt;3)</span>
<span class="cm">/* Flash update failure */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_FLASH_UPT	(1&lt;&lt;2)</span>
<span class="cm">/* Power supply above 3.625 V */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_POWER_HIGH	(1&lt;&lt;1)</span>
 <span class="cm">/* Power supply below 3.15 V */</span>
<span class="cp">#define ADIS16240_DIAG_STAT_POWER_LOW	(1&lt;&lt;0)</span>

<span class="cm">/* GLOB_CMD */</span>
<span class="cp">#define ADIS16240_GLOB_CMD_RESUME	(1&lt;&lt;8)</span>
<span class="cp">#define ADIS16240_GLOB_CMD_SW_RESET	(1&lt;&lt;7)</span>
<span class="cp">#define ADIS16240_GLOB_CMD_STANDBY	(1&lt;&lt;2)</span>

<span class="cp">#define ADIS16240_ERROR_ACTIVE          (1&lt;&lt;14)</span>

<span class="cp">#define ADIS16240_MAX_TX 24</span>
<span class="cp">#define ADIS16240_MAX_RX 24</span>

<span class="cm">/**</span>
<span class="cm"> * struct adis16240_state - device instance specific data</span>
<span class="cm"> * @us:			actual spi_device</span>
<span class="cm"> * @trig:		data ready trigger registered with iio</span>
<span class="cm"> * @tx:			transmit buffer</span>
<span class="cm"> * @rx:			receive buffer</span>
<span class="cm"> * @buf_lock:		mutex to protect tx and rx</span>
<span class="cm"> **/</span>
<span class="k">struct</span> <span class="n">adis16240_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">spi_device</span>	<span class="o">*</span><span class="n">us</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iio_trigger</span>	<span class="o">*</span><span class="n">trig</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">buf_lock</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">tx</span><span class="p">[</span><span class="n">ADIS16240_MAX_TX</span><span class="p">]</span> <span class="n">____cacheline_aligned</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rx</span><span class="p">[</span><span class="n">ADIS16240_MAX_RX</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">adis16240_set_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">);</span>

<span class="cm">/* At the moment triggers are only used for ring buffer</span>
<span class="cm"> * filling. This may change!</span>
<span class="cm"> */</span>

<span class="cp">#define ADIS16240_SCAN_SUPPLY	0</span>
<span class="cp">#define ADIS16240_SCAN_ACC_X	1</span>
<span class="cp">#define ADIS16240_SCAN_ACC_Y	2</span>
<span class="cp">#define ADIS16240_SCAN_ACC_Z	3</span>
<span class="cp">#define ADIS16240_SCAN_AUX_ADC	4</span>
<span class="cp">#define ADIS16240_SCAN_TEMP	5</span>

<span class="cp">#ifdef CONFIG_IIO_BUFFER</span>
<span class="kt">void</span> <span class="n">adis16240_remove_trigger</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">adis16240_probe_trigger</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>

<span class="kt">ssize_t</span> <span class="n">adis16240_read_data_from_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
				      <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>


<span class="kt">int</span> <span class="n">adis16240_configure_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">adis16240_unconfigure_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">);</span>

<span class="cp">#else </span><span class="cm">/* CONFIG_IIO_BUFFER */</span><span class="cp"></span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">adis16240_remove_trigger</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">adis16240_probe_trigger</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">ssize_t</span>
<span class="nf">adis16240_read_data_from_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
			      <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">adis16240_configure_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">adis16240_unconfigure_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">iio_dev</span> <span class="o">*</span><span class="n">indio_dev</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_IIO_BUFFER */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* SPI_ADIS16240_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
