<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › comedi › drivers › addi-data › hwdrv_apci3200.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>hwdrv_apci3200.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">@verbatim</span>

<span class="cm">Copyright (C) 2004,2005  ADDI-DATA GmbH for the source code of this module.</span>

<span class="cm">	ADDI-DATA GmbH</span>
<span class="cm">	Dieselstrasse 3</span>
<span class="cm">	D-77833 Ottersweier</span>
<span class="cm">	Tel: +19(0)7223/9493-0</span>
<span class="cm">	Fax: +49(0)7223/9493-92</span>
<span class="cm">	http://www.addi-data.com</span>
<span class="cm">	info@addi-data.com</span>

<span class="cm">This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</span>

<span class="cm">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>

<span class="cm">You should also find the complete GPL in the COPYING file accompanying this source code.</span>

<span class="cm">@endverbatim</span>
<span class="cm">*/</span>
<span class="cm">/*</span>

<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | (C) ADDI-DATA GmbH          Dieselstraße 3       D-77833 Ottersweier  |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Tel : +49 (0) 7223/9493-0     | email    : info@addi-data.com         |</span>
<span class="cm">  | Fax : +49 (0) 7223/9493-92    | Internet : http://www.addi-data.com   |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project     : APCI-3200       | Compiler   : GCC                      |</span>
<span class="cm">  | Module name : hwdrv_apci3200.c| Version    : 2.96                     |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project manager: Eric Stolz   | Date       :  02/12/2002              |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Description :   Hardware Layer Access For APCI-3200                   |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |                             UPDATES                                   |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  |   Date   |   Author  |          Description of updates                |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  | 02.07.04 | J. Krauth | Modification from the driver in order to       |</span>
<span class="cm">  |          |           | correct some errors when using several boards. |</span>
<span class="cm">  |          |           |                                                |</span>
<span class="cm">  |          |           |                                                |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  | 26.10.04 | J. Krauth | - Update for COMEDI 0.7.68                     |</span>
<span class="cm">  |          |           | - Read eeprom value                            |</span>
<span class="cm">  |          |           | - Append APCI-3300                             |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  |                               Included files                               |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="cp">#include &quot;hwdrv_apci3200.h&quot;</span>
<span class="cm">/* Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
<span class="cp">#include &quot;addi_amcc_S5920.h&quot;</span>
<span class="cm">/* #define PRINT_INFO */</span>

<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
<span class="cm">/*</span>
<span class="cm">  int i_CJCAvailable=1;</span>
<span class="cm">  int i_CJCPolarity=0;</span>
<span class="cm">  int i_CJCGain=2;/* changed from 0 to 2 */</span>
  <span class="kt">int</span> <span class="n">i_InterruptFlag</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ADDIDATAPolarity</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ADDIDATAGain</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_AutoCalibration</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>   <span class="cm">/* : auto calibration */</span>
  <span class="kt">int</span> <span class="n">i_ADDIDATAConversionTime</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ADDIDATAType</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ChannelNo</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ChannelCount</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_ScanType</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_FirstChannel</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_LastChannel</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_Sum</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_Offset</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Channel_num</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="k">static</span> <span class="kt">int</span> <span class="n">i_Count</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i_Initialised</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">96</span><span class="p">];</span> <span class="cm">/* Buffer */</span>
<span class="err">*/</span>
<span class="k">struct</span> <span class="n">str_BoardInfos</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>	<span class="cm">/*  100 will be the max number of boards to be used */</span>
<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

<span class="cm">/* Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Function   Name   : int i_AddiHeaderRW_ReadEeprom                          |*/</span>
<span class="cm">/*|                               (int    i_NbOfWordsToRead,                   |*/</span>
<span class="cm">/*|                                unsigned int dw_PCIBoardEepromAddress,             |*/</span>
<span class="cm">/*|                                unsigned short   w_EepromStartAddress,                |*/</span>
<span class="cm">/*|                                unsigned short * pw_DataRead)                          |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Task              : Read word from the 5920 eeprom.                        |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Input Parameters  : int    i_NbOfWordsToRead : Nbr. of word to read        |*/</span>
<span class="cm">/*|                     unsigned int dw_PCIBoardEepromAddress : Address of the eeprom |*/</span>
<span class="cm">/*|                     unsigned short   w_EepromStartAddress : Eeprom start address     |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Output Parameters : unsigned short * pw_DataRead : Read data                          |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Return Value      : -                                                      |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>

<span class="kt">int</span> <span class="nf">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="kt">int</span> <span class="n">i_NbOfWordsToRead</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_EepromStartAddress</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">pw_DataRead</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_WordCounter</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pb_ReadByte</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ReadLowByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ReadHighByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_SelectedAddressLow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_SelectedAddressHigh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_ReadWord</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i_WordCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_WordCounter</span> <span class="o">&lt;</span> <span class="n">i_NbOfWordsToRead</span><span class="p">;</span>
		<span class="n">i_WordCounter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
				<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
				<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
			<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Counter</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i_Counter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">b_SelectedAddressLow</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_EepromStartAddress</span> <span class="o">+</span> <span class="n">i_Counter</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>	<span class="cm">/* Read the low 8 bit part */</span>
			<span class="n">b_SelectedAddressHigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_EepromStartAddress</span> <span class="o">+</span> <span class="n">i_Counter</span><span class="p">)</span> <span class="o">/</span> <span class="mi">256</span><span class="p">;</span>	<span class="cm">/* Read the high 8 bit part */</span>

			<span class="cm">/* Select the load low address mode */</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_LOAD_LOW</span><span class="p">,</span>
				<span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span>
				<span class="mi">3</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Load the low address */</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">b_SelectedAddressLow</span><span class="p">,</span>
				<span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span>
				<span class="mi">2</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Select the load high address mode */</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_LOAD_HIGH</span><span class="p">,</span>
				<span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span>
				<span class="mi">3</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Load the high address */</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">b_SelectedAddressHigh</span><span class="p">,</span>
				<span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span>
				<span class="mi">2</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Select the READ mode */</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_BEGIN_READ</span><span class="p">,</span>
				<span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span>
				<span class="mi">3</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Read data into the EEPROM */</span>
			<span class="o">*</span><span class="n">pb_ReadByte</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
				<span class="n">AMCC_OP_REG_MCSR</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>

			<span class="cm">/* Wait on busy */</span>
			<span class="k">do</span> <span class="p">{</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">dw_PCIBoardEepromAddress</span> <span class="o">+</span>
					<span class="n">AMCC_OP_REG_MCSR</span><span class="p">);</span>
				<span class="n">dw_eeprom_busy</span> <span class="o">=</span> <span class="n">dw_eeprom_busy</span> <span class="o">&amp;</span> <span class="n">EEPROM_BUSY</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">dw_eeprom_busy</span> <span class="o">==</span> <span class="n">EEPROM_BUSY</span><span class="p">);</span>

			<span class="cm">/* Select the upper address part */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_Counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">b_ReadLowByte</span> <span class="o">=</span> <span class="n">pb_ReadByte</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="k">else</span>
				<span class="n">b_ReadHighByte</span> <span class="o">=</span> <span class="n">pb_ReadByte</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>


			<span class="cm">/* Sleep */</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

		<span class="p">}</span>
		<span class="n">w_ReadWord</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">b_ReadLowByte</span> <span class="o">|</span> <span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span><span class="n">b_ReadHighByte</span><span class="p">)</span> <span class="o">*</span>
				<span class="mi">256</span><span class="p">));</span>

		<span class="n">pw_DataRead</span><span class="p">[</span><span class="n">i_WordCounter</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_ReadWord</span><span class="p">;</span>

		<span class="n">w_EepromStartAddress</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/*  to read the next word */</span>

	<span class="p">}</span>			<span class="cm">/*  for (...) i_NbOfWordsToRead */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Function   Name   : void v_GetAPCI3200EepromCalibrationValue (void)        |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Task              : Read calibration value from the APCI-3200 eeprom.      |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Input Parameters  : -                                                      |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Output Parameters : -                                                      |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>
<span class="cm">/*| Return Value      : -                                                      |*/</span>
<span class="cm">/*+----------------------------------------------------------------------------+*/</span>

<span class="kt">void</span> <span class="nf">v_GetAPCI3200EepromCalibrationValue</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_BoardInfos</span> <span class="o">*</span><span class="n">BoardInformations</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_AnalogInputMainHeaderAddress</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_AnalogInputComponentAddress</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_NumberOfModuls</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_CurrentSources</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_ModulCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_FirstHeaderSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_NumberOfInputs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_CJCFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_NumberOfGainValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_SingleHeaderAddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_SingleHeaderSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Input</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_GainFactorAddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_GainFactorValue</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_GainIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_GainValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*****************************************/</span>
  <span class="cm">/** Get the Analog input header address **/</span>
  <span class="cm">/*****************************************/</span>
	<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
		<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="mh">0x116</span><span class="p">,</span>	<span class="cm">/* w_EepromStartAddress: Analog input header address */</span>
		<span class="o">&amp;</span><span class="n">w_AnalogInputMainHeaderAddress</span><span class="p">);</span>

  <span class="cm">/*******************************************/</span>
  <span class="cm">/** Compute the real analog input address **/</span>
  <span class="cm">/*******************************************/</span>
	<span class="n">w_AnalogInputMainHeaderAddress</span> <span class="o">=</span> <span class="n">w_AnalogInputMainHeaderAddress</span> <span class="o">+</span> <span class="mh">0x100</span><span class="p">;</span>

  <span class="cm">/******************************/</span>
  <span class="cm">/** Get the number of moduls **/</span>
  <span class="cm">/******************************/</span>
	<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
		<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputMainHeaderAddress</span> <span class="o">+</span> <span class="mh">0x02</span><span class="p">,</span>	<span class="cm">/* w_EepromStartAddress: Number of conponment */</span>
		<span class="o">&amp;</span><span class="n">w_NumberOfModuls</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">w_ModulCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">w_ModulCounter</span> <span class="o">&lt;</span> <span class="n">w_NumberOfModuls</span><span class="p">;</span>
		<span class="n">w_ModulCounter</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/***********************************/</span>
      <span class="cm">/** Compute the component address **/</span>
      <span class="cm">/***********************************/</span>
		<span class="n">w_AnalogInputComponentAddress</span> <span class="o">=</span>
			<span class="n">w_AnalogInputMainHeaderAddress</span> <span class="o">+</span>
			<span class="p">(</span><span class="n">w_FirstHeaderSize</span> <span class="o">*</span> <span class="n">w_ModulCounter</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x04</span><span class="p">;</span>

      <span class="cm">/****************************/</span>
      <span class="cm">/** Read first header size **/</span>
      <span class="cm">/****************************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span><span class="p">,</span>	<span class="cm">/*  Address of the first header */</span>
			<span class="o">&amp;</span><span class="n">w_FirstHeaderSize</span><span class="p">);</span>

		<span class="n">w_FirstHeaderSize</span> <span class="o">=</span> <span class="n">w_FirstHeaderSize</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

      <span class="cm">/***************************/</span>
      <span class="cm">/** Read number of inputs **/</span>
      <span class="cm">/***************************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mh">0x06</span><span class="p">,</span>	<span class="cm">/*  Number of inputs for the first modul */</span>
			<span class="o">&amp;</span><span class="n">w_NumberOfInputs</span><span class="p">);</span>

		<span class="n">w_NumberOfInputs</span> <span class="o">=</span> <span class="n">w_NumberOfInputs</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

      <span class="cm">/***********************/</span>
      <span class="cm">/** Read the CJC flag **/</span>
      <span class="cm">/***********************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">,</span>	<span class="cm">/*  CJC flag */</span>
			<span class="o">&amp;</span><span class="n">w_CJCFlag</span><span class="p">);</span>

		<span class="n">w_CJCFlag</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_CJCFlag</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>	<span class="cm">/*  Get only the CJC flag */</span>

      <span class="cm">/*******************************/</span>
      <span class="cm">/** Read number of gain value **/</span>
      <span class="cm">/*******************************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mh">0x44</span><span class="p">,</span>	<span class="cm">/*  Number of gain value */</span>
			<span class="o">&amp;</span><span class="n">w_NumberOfGainValue</span><span class="p">);</span>

		<span class="n">w_NumberOfGainValue</span> <span class="o">=</span> <span class="n">w_NumberOfGainValue</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>

      <span class="cm">/***********************************/</span>
      <span class="cm">/** Compute single header address **/</span>
      <span class="cm">/***********************************/</span>
		<span class="n">w_SingleHeaderAddress</span> <span class="o">=</span>
			<span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mh">0x46</span> <span class="o">+</span>
			<span class="p">(((</span><span class="n">w_NumberOfGainValue</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
			<span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">w_NumberOfGainValue</span><span class="p">)</span> <span class="o">+</span>
			<span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(((</span><span class="n">w_NumberOfGainValue</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">));</span>

      <span class="cm">/********************************************/</span>
      <span class="cm">/** Read current sources value for input 1 **/</span>
      <span class="cm">/********************************************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_SingleHeaderAddress</span><span class="p">,</span>	<span class="cm">/* w_EepromStartAddress: Single header address */</span>
			<span class="o">&amp;</span><span class="n">w_SingleHeaderSize</span><span class="p">);</span>

		<span class="n">w_SingleHeaderSize</span> <span class="o">=</span> <span class="n">w_SingleHeaderSize</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

      <span class="cm">/*************************************/</span>
      <span class="cm">/** Read gain factor for the module **/</span>
      <span class="cm">/*************************************/</span>
		<span class="n">w_GainFactorAddress</span> <span class="o">=</span> <span class="n">w_AnalogInputComponentAddress</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">w_GainIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">w_GainIndex</span> <span class="o">&lt;</span> <span class="n">w_NumberOfGainValue</span><span class="p">;</span>
			<span class="n">w_GainIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	  <span class="cm">/************************************/</span>
	  <span class="cm">/** Read gain value for the module **/</span>
	  <span class="cm">/************************************/</span>
			<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
				<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mi">70</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_NumberOfGainValue</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="mh">0x02</span> <span class="o">*</span> <span class="n">w_GainIndex</span><span class="p">),</span>	<span class="cm">/*  Gain value */</span>
				<span class="o">&amp;</span><span class="n">w_GainValue</span><span class="p">);</span>

			<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">w_GainValue</span><span class="p">[</span><span class="n">w_GainIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">w_GainValue</span><span class="p">;</span>

<span class="cp">#             ifdef PRINT_INFO</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Gain value = %d&quot;</span><span class="p">,</span>
				<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">w_GainValue</span><span class="p">[</span><span class="n">w_GainIndex</span><span class="p">]);</span>
<span class="cp">#             endif</span>

	  <span class="cm">/*************************************/</span>
	  <span class="cm">/** Read gain factor for the module **/</span>
	  <span class="cm">/*************************************/</span>
			<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
				<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_AnalogInputComponentAddress</span> <span class="o">+</span> <span class="mi">70</span> <span class="o">+</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">w_NumberOfGainValue</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_NumberOfGainValue</span> <span class="o">/</span> <span class="mi">16</span><span class="p">))))</span> <span class="o">+</span> <span class="p">(</span><span class="mh">0x04</span> <span class="o">*</span> <span class="n">w_GainIndex</span><span class="p">),</span>	<span class="cm">/*  Gain factor */</span>
				<span class="n">w_GainFactorValue</span><span class="p">);</span>

			<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">ul_GainFactor</span><span class="p">[</span><span class="n">w_GainIndex</span><span class="p">]</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">w_GainFactorValue</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span>
				<span class="n">w_GainFactorValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="cp">#             ifdef PRINT_INFO</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> w_GainFactorValue [%d] = %lu&quot;</span><span class="p">,</span> <span class="n">w_GainIndex</span><span class="p">,</span>
				<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">ul_GainFactor</span><span class="p">[</span><span class="n">w_GainIndex</span><span class="p">]);</span>
<span class="cp">#             endif</span>
		<span class="p">}</span>

      <span class="cm">/***************************************************************/</span>
      <span class="cm">/** Read current source value for each channels of the module **/</span>
      <span class="cm">/***************************************************************/</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">w_Input</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">w_Input</span> <span class="o">&lt;</span> <span class="n">w_NumberOfInputs</span><span class="p">;</span> <span class="n">w_Input</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	  <span class="cm">/********************************************/</span>
	  <span class="cm">/** Read current sources value for input 1 **/</span>
	  <span class="cm">/********************************************/</span>
			<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
				<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span>
				<span class="p">(</span><span class="n">w_Input</span> <span class="o">*</span> <span class="n">w_SingleHeaderSize</span><span class="p">)</span> <span class="o">+</span>
				<span class="n">w_SingleHeaderAddress</span> <span class="o">+</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="n">w_CurrentSources</span><span class="p">);</span>

	  <span class="cm">/************************************/</span>
	  <span class="cm">/** Save the current sources value **/</span>
	  <span class="cm">/************************************/</span>
			<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">ul_CurrentSource</span><span class="p">[</span><span class="n">w_Input</span><span class="p">]</span> <span class="o">=</span>
				<span class="p">(</span><span class="n">w_CurrentSources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">((</span><span class="n">w_CurrentSources</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>

<span class="cp">#             ifdef PRINT_INFO</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Current sources [%d] = %lu&quot;</span><span class="p">,</span> <span class="n">w_Input</span><span class="p">,</span>
				<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
				<span class="n">ul_CurrentSource</span><span class="p">[</span><span class="n">w_Input</span><span class="p">]);</span>
<span class="cp">#             endif</span>
		<span class="p">}</span>

      <span class="cm">/***************************************/</span>
      <span class="cm">/** Read the CJC current source value **/</span>
      <span class="cm">/***************************************/</span>
		<span class="n">i_AddiHeaderRW_ReadEeprom</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* i_NbOfWordsToRead */</span>
			<span class="n">dw_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="p">(</span><span class="n">w_Input</span> <span class="o">*</span> <span class="n">w_SingleHeaderSize</span><span class="p">)</span> <span class="o">+</span> <span class="n">w_SingleHeaderAddress</span> <span class="o">+</span>
			<span class="mh">0x0C</span><span class="p">,</span> <span class="n">w_CurrentSources</span><span class="p">);</span>

      <span class="cm">/************************************/</span>
      <span class="cm">/** Save the current sources value **/</span>
      <span class="cm">/************************************/</span>
		<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
			<span class="n">ul_CurrentSourceCJC</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">w_CurrentSources</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
			<span class="p">((</span><span class="n">w_CurrentSources</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>

<span class="cp">#          ifdef PRINT_INFO</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Current sources CJC = %lu&quot;</span><span class="p">,</span>
			<span class="n">BoardInformations</span><span class="o">-&gt;</span><span class="n">s_Module</span><span class="p">[</span><span class="n">w_ModulCounter</span><span class="p">].</span>
			<span class="n">ul_CurrentSourceCJC</span><span class="p">);</span>
<span class="cp">#          endif</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_GetChannelCalibrationValue</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Channel_num</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">CJCCurrentSource</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ChannelCurrentSource</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ChannelGainFactor</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#ifdef PRINT_INFO</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Channel = %u&quot;</span><span class="p">,</span> <span class="n">ui_Channel_num</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="cm">/* Test if single or differential mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ConnectionType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* if diff */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="n">ui_Channel_num</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="n">ui_Channel_num</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="n">ui_Channel_num</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="n">ui_Channel_num</span> <span class="o">-</span> <span class="mi">6</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/*  if single */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">3</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">5</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">7</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">9</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">10</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">11</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">13</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ui_Channel_num</span> <span class="o">==</span> <span class="mi">15</span><span class="p">))</span>
			<span class="n">i_DiffChannel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i_Module</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Test if thermocouple or RTD mode */</span>
	<span class="o">*</span><span class="n">CJCCurrentSource</span> <span class="o">=</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i_Module</span><span class="p">].</span><span class="n">ul_CurrentSourceCJC</span><span class="p">;</span>
<span class="cp">#ifdef PRINT_INFO</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> CJCCurrentSource = %lu&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">CJCCurrentSource</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="o">*</span><span class="n">ChannelCurrentSource</span> <span class="o">=</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i_Module</span><span class="p">].</span>
		<span class="n">ul_CurrentSource</span><span class="p">[</span><span class="n">i_DiffChannel</span><span class="p">];</span>
<span class="cp">#ifdef PRINT_INFO</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> ChannelCurrentSource = %lu&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">ChannelCurrentSource</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="cm">/*       } */</span>
	<span class="cm">/*    } */</span>

	<span class="cm">/* Channle gain factor */</span>
	<span class="o">*</span><span class="n">ChannelGainFactor</span> <span class="o">=</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i_Module</span><span class="p">].</span>
		<span class="n">ul_GainFactor</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAGain</span><span class="p">];</span>
<span class="cp">#ifdef PRINT_INFO</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> ChannelGainFactor = %lu&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">ChannelGainFactor</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadDigitalInput                       |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read  value  of the selected channel or port           |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int ui_NoOfChannels    : No Of Channels To read  for Port</span>
<span class="cm">  Channel Numberfor single channel</span>
<span class="cm">  |                     unsigned int data[0]            : 0: Read single channel</span>
<span class="cm">  1: Read port value</span>
<span class="cm">  data[1]              Port number</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--	data[0] :Read status value</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_ReadDigitalInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_NoOfChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ui_NoOfChannel</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>
	<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseReserved</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ui_Temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if  (ui_Temp==0) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_Temp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The port number is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(data[1] &lt; 0 || data[1] &gt;1) */</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">case</span> <span class="mi">2</span>:
				<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">3</span>:
				<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot; chan spec wrong&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>

			<span class="p">}</span>	<span class="cm">/* switch(ui_NoOfChannels) */</span>
		<span class="p">}</span>		<span class="cm">/* if  (ui_Temp==1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* elseif  (ui_Temp==1) */</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ConfigDigitalOutput                     |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,				 |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Configures The Digital Output Subdevice.               |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev : Driver handle                     |</span>
<span class="cm">  |			  data[0]  :1  Memory enable</span>
<span class="cm">  0  Memory Disable</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error			 |</span>
<span class="cm">  |																	 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ConfigDigitalOutput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;Not a valid Data !!! ,Data should be 1 or 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if  ( (data[0]!=0) &amp;&amp; (data[0]!=1) ) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">b_OutputMemoryStatus</span> <span class="o">=</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if  (data[0]) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">b_OutputMemoryStatus</span> <span class="o">=</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* else if  (data[0]) */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_WriteDigitalOutput                      |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,				 |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : writes To the digital Output Subdevice                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     struct comedi_subdevice *s     : Subdevice Pointer            |</span>
<span class="cm">  |                     struct comedi_insn *insn       : Insn Structure Pointer       |</span>
<span class="cm">  |                     unsigned int *data          : Data Pointer contains        |</span>
<span class="cm">  |                                          configuration parameters as below |</span>
<span class="cm">  |                     data[0]             :Value to output</span>
<span class="cm">  data[1]             : 0 o/p single channel</span>
<span class="cm">  1 o/p port</span>
<span class="cm">  data[2]             : port no</span>
<span class="cm">  data[3]             :0 set the digital o/p on</span>
<span class="cm">  1 set the digital o/p off</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error	     	 |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_WriteDigitalOutput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_NoOfChannel</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>	<span class="cm">/*  get the channel */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">b_OutputMemoryStatus</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>

	<span class="p">}</span>			<span class="cm">/* if(devpriv-&gt;b_OutputMemoryStatus ) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(devpriv-&gt;b_OutputMemoryStatus ) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
			<span class="n">outl</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* if(data[1]==0) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">case</span> <span class="mi">2</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
						<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span>
							<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">3</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* switch(ui_NoOfChannels) */</span>

				<span class="n">outl</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/*  if(data[1]==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* else if(data[1]==1) */</span>
		<span class="p">}</span>		<span class="cm">/* elseif(data[1]==0) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[3]==0) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
				<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">;</span>
				<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0xf</span><span class="p">;</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>
				<span class="n">outl</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if(data[1]==0) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>

					<span class="k">case</span> <span class="mi">2</span>:
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span>
							<span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
						<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span>
									<span class="n">data</span>
									<span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">^</span>
							<span class="mh">0xf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>

						<span class="k">break</span><span class="p">;</span>
					<span class="k">case</span> <span class="mi">3</span>:
						<span class="k">break</span><span class="p">;</span>

					<span class="nl">default:</span>
						<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
							<span class="s">&quot; chan spec wrong&quot;</span><span class="p">);</span>
						<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>
					<span class="p">}</span>	<span class="cm">/* switch(ui_NoOfChannels) */</span>

					<span class="n">outl</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/*  if(data[1]==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* else if(data[1]==1) */</span>
			<span class="p">}</span>	<span class="cm">/* elseif(data[1]==0) */</span>
		<span class="p">}</span>		<span class="cm">/* if(data[3]==1); */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified functionality does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if else data[3]==1) */</span>
	<span class="p">}</span>			<span class="cm">/* if else data[3]==0) */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadDigitalOutput                       |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read  value  of the selected channel or port           |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int ui_NoOfChannels    : No Of Channels To read       |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  data[0]                 :0 read single channel</span>
<span class="cm">  1 read port value</span>
<span class="cm">  data[1]                  port no</span>

<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadDigitalOutput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_NoOfChannel</span><span class="p">;</span>
	<span class="n">ui_NoOfChannel</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>
	<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ui_Temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if  (ui_Temp==0) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_Temp</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The port selection is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(data[1] &lt;0 ||data[1] &gt;1) */</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">2</span>:
				<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="mi">3</span>:
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot; chan spec wrong&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  switch(ui_NoOfChannels) */</span>
		<span class="p">}</span>		<span class="cm">/*  if  (ui_Temp==1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/*  else if (ui_Temp==1) */</span>
	<span class="p">}</span>			<span class="cm">/*  else if  (ui_Temp==0) */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ConfigAnalogInput                       |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Configures The Analog Input Subdevice                  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     struct comedi_subdevice *s     : Subdevice Pointer            |</span>
<span class="cm">  |                     struct comedi_insn *insn       : Insn Structure Pointer       |</span>
<span class="cm">  |                     unsigned int *data          : Data Pointer contains        |</span>
<span class="cm">  |                                          configuration parameters as below |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |					data[0]</span>
<span class="cm">  |                                               0:Normal AI                  |</span>
<span class="cm">  |                                               1:RTD                        |</span>
<span class="cm">  |                                               2:THERMOCOUPLE               |</span>
<span class="cm">  |				    data[1]            : Gain To Use                 |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[2]            : Polarity</span>
<span class="cm">  |                                                0:Bipolar                   |</span>
<span class="cm">  |                                                1:Unipolar                  |</span>
<span class="cm">  |															    	 |</span>
<span class="cm">  |                           data[3]            : Offset Range</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[4]            : Coupling</span>
<span class="cm">  |                                                0:DC Coupling               |</span>
<span class="cm">  |                                                1:AC Coupling               |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[5]            :Differential/Single</span>
<span class="cm">  |                                                0:Single                    |</span>
<span class="cm">  |                                                1:Differential              |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[6]            :TimerReloadValue</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[7]            :ConvertingTimeUnit</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                           data[8]             :0 Analog voltage measurement</span>
<span class="cm">  1 Resistance measurement</span>
<span class="cm">  2 Temperature measurement</span>
<span class="cm">  |                           data[9]            :Interrupt</span>
<span class="cm">  |                                              0:Disable</span>
<span class="cm">  |                                              1:Enable</span>
<span class="cm">  data[10]           :Type of Thermocouple</span>
<span class="cm">  |                          data[11]           : 0: single channel</span>
<span class="cm">  Module Number</span>
<span class="cm">  |</span>
<span class="cm">  |                          data[12]</span>
<span class="cm">  |                                             0:Single Read</span>
<span class="cm">  |                                             1:Read more channel</span>
<span class="cm">  2:Single scan</span>
<span class="cm">  |                                             3:Continuous Scan</span>
<span class="cm">  data[13]          :Number of channels to read</span>
<span class="cm">  |                          data[14]          :RTD connection type</span>
<span class="cm">  :0:RTD not used</span>
<span class="cm">  1:RTD 2 wire connection</span>
<span class="cm">  2:RTD 3 wire connection</span>
<span class="cm">  3:RTD 4 wire connection</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  |                                                                            |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ConfigAnalogInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_Config</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ul_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Dummy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

<span class="cp">#ifdef PRINT_INFO</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/*  Initialize the structure */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">b_StructInitialized</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCAvailable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCPolarity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCGain</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* changed from 0 to 2 */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_AutoCalibration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="cm">/* : auto calibration */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_Channel_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">b_StructInitialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="cm">/* Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ConnectionType</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

		<span class="cm">/* Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">MAX_MODULE</span><span class="p">]));</span>

		<span class="n">v_GetAPCI3200EepromCalibrationValue</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">]);</span>

<span class="cp">#ifdef PRINT_INFO</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_MODULE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_Module[%i].ul_CurrentSourceCJC = %lu&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i</span><span class="p">].</span>
				<span class="n">ul_CurrentSourceCJC</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_Module[%i].ul_CurrentSource [%i] = %lu&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ul_CurrentSource</span><span class="p">[</span><span class="n">i2</span><span class="p">]);</span>
			<span class="p">}</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_Module[%i].ul_GainFactor [%i] = %lu&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ul_GainFactor</span><span class="p">[</span><span class="n">i2</span><span class="p">]);</span>
			<span class="p">}</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i2</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i2</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_Module[%i].w_GainValue [%i] = %u&quot;</span><span class="p">,</span>
					<span class="n">i</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">s_Module</span><span class="p">[</span><span class="n">i</span><span class="p">].</span>
					<span class="n">w_GainValue</span><span class="p">[</span><span class="n">i2</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="p">}</span>
<span class="cp">#endif</span>
		<span class="cm">/* End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of acquisition type is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[0]!=0 &amp;&amp; data[0]!=1 &amp;&amp; data[0]!=2) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span>
			<span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Error in selection of RTD connection type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if(data[14]!=0 &amp;&amp; data[14]!=1 &amp;&amp; data[14]!=2 &amp;&amp; data[14]!=4) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[0]==1 ) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of gain is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if(data[1]&lt;0 || data[1]&gt;7) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of polarity is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[2]!=0 &amp;&amp;  data[2]!=1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of offset range  is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if(data[3]!=0) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of coupling is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[4]!=0 &amp;&amp;  data[4]!=1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of single/differential mode is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[5]!=0 &amp;&amp;  data[5]!=1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of functionality</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/* if(data[8]!=0 &amp;&amp; data[8]!=1 &amp;&amp; data[2]!=2) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">20</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">40</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">80</span>
			<span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">160</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of conversion time reload value is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if (data[6]!=20 &amp;&amp; data[6]!=40 &amp;&amp; data[6]!=80 &amp;&amp; data[6]!=160 ) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of conversion time unit  is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if(data[7]!=2) */</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of interrupt enable is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[9]!=0 &amp;&amp;  data[9]!=1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of module is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[11] &lt;0 ||  data[11]&gt;1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of singlechannel/scan selection is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[12] &lt; 0 ||  data[12]&gt; 3) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of number of channels is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if(data[13] &lt;0 ||data[13] &gt;15) */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/*</span>
<span class="cm">	   i_ChannelCount=data[13];</span>
<span class="cm">	   i_ScanType=data[12];</span>
<span class="cm">	   i_ADDIDATAPolarity = data[2];</span>
<span class="cm">	   i_ADDIDATAGain=data[1];</span>
<span class="cm">	   i_ADDIDATAConversionTime=data[6];</span>
<span class="cm">	   i_ADDIDATAConversionTimeUnit=data[7];</span>
<span class="cm">	   i_ADDIDATAType=data[0];</span>
<span class="cm">	 */</span>

	<span class="cm">/*  Save acquisition configuration for the actual board */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelCount</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAPolarity</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAGain</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAType</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="cm">/* Begin JK 19.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ConnectionType</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="cm">/* End JK 19.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* Begin JK 19.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_ScanValueArray</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">));</span>	<span class="cm">/*  7 is the maximal number of channels */</span>
	<span class="cm">/* End JK 19.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>

	<span class="cm">/* BEGIN JK 02.07.04 : This while can&#39;t be do, it block the process when using severals boards */</span>
	<span class="cm">/* while(i_InterruptFlag==1) */</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifndef MSXBOX</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="cp">#else</span>
		<span class="cm">/*  In the case where the driver is compiled for the MSX-Box */</span>
		<span class="cm">/*  we used a printk to have a little delay because udelay */</span>
		<span class="cm">/*  seems to be broken under the MSX-Box. */</span>
		<span class="cm">/*  This solution hat to be studied. */</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="p">}</span>
	<span class="cm">/* END JK 02.07.04 : This while can&#39;t be do, it block the process when using severals boards */</span>

	<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>	<span class="cm">/*  get the channel */</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* i_ChannelNo=ui_ChannelNo; */</span>
	<span class="cm">/* ui_Channel_num =ui_ChannelNo; */</span>

	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_Channel_num</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span><span class="p">;</span>

	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ui_ChannelNo</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The Selection of the channel is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if(ui_ChannelNo&lt;0 || ui_ChannelNo&gt;15) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[5]==0) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ui_ChannelNo</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The Selection of the channel is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if(ui_ChannelNo&lt;0 || ui_ChannelNo&gt;3) */</span>
		<span class="p">}</span>		<span class="cm">/* if(data[14]==2) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ui_ChannelNo</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The Selection of the channel is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if(ui_ChannelNo&lt;0 || ui_ChannelNo&gt;7) */</span>
		<span class="p">}</span>		<span class="cm">/* elseif(data[14]==2) */</span>
	<span class="p">}</span>			<span class="cm">/* elseif(data[5]==0) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_Offset=0; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=0 &amp;&amp; ui_ChannelNo &lt;=3) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_Offset=64; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=4 &amp;&amp; ui_ChannelNo &lt;=7) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">8</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_Offset=128; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=8 &amp;&amp; ui_ChannelNo &lt;=11) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">12</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_Offset=192; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">192</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=12 &amp;&amp; ui_ChannelNo &lt;=15) */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
					<span class="cm">/* i_Offset=0; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo ==0 ) */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
					<span class="cm">/* i_Offset=0; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
					<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="p">}</span>	<span class="cm">/*  if(ui_ChannelNo ==1) */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
					<span class="cm">/* i_Offset=128; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
					<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo ==2 ) */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
					<span class="cm">/* i_Offset=192; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">192</span><span class="p">;</span>
					<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo ==3) */</span>

				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_ChannelNo=0; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(data[14]==2) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_Offset=0; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=0 &amp;&amp; ui_ChannelNo &lt;=1) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_ChannelNo=i_ChannelNo-2; */</span>
				<span class="cm">/* i_Offset=64; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">=</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">-</span>
					<span class="mi">2</span><span class="p">;</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=2 &amp;&amp; ui_ChannelNo &lt;=3) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_ChannelNo=i_ChannelNo-4; */</span>
				<span class="cm">/* i_Offset=128; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">=</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">-</span>
					<span class="mi">4</span><span class="p">;</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=4 &amp;&amp; ui_ChannelNo &lt;=5) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&gt;=</span> <span class="mi">6</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ChannelNo</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* i_ChannelNo=i_ChannelNo-6; */</span>
				<span class="cm">/* i_Offset=192; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">=</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span> <span class="o">-</span>
					<span class="mi">6</span><span class="p">;</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">192</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span> <span class="o">-</span> <span class="mi">6</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(ui_ChannelNo &gt;=6 &amp;&amp; ui_ChannelNo &lt;=7) */</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> This selection of polarity does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(data[2]) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[12]==0 || data[12]==1) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* i_Offset=0; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* i_Offset=64; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* i_Offset=128; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* i_Offset=192; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">=</span> <span class="mi">192</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in module selection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[11]) */</span>
	<span class="p">}</span>			<span class="cm">/*  elseif(data[12]==0 || data[12]==1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i_err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* if(i_ScanType!=1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* i_Count=0; */</span>
		<span class="cm">/* i_Sum=0; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
	<span class="p">}</span>			<span class="cm">/* if(i_ScanType!=1) */</span>

	<span class="n">ul_Config</span> <span class="o">=</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Write the channel to configure */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* outl(0 | ui_ChannelNo , devpriv-&gt;iobase+i_Offset + 0x4); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mi">0</span> <span class="o">|</span> <span class="n">ui_ChannelNo</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mh">0x4</span><span class="p">);</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Reset the configuration */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* outl(0 , devpriv-&gt;iobase+i_Offset + 0x0); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

  <span class="cm">/***************************/</span>
	<span class="cm">/* Write the configuration */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* outl(ul_Config , devpriv-&gt;iobase+i_Offset + 0x0); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ul_Config</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

  <span class="cm">/***************************/</span>
	<span class="cm">/*Reset the calibration bit */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* ul_Temp = inl(devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">ul_Temp</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* outl((ul_Temp &amp; 0xFFF9FFFF) , devpriv-&gt;iobase+.i_Offset + 12); */</span>
	<span class="n">outl</span><span class="p">((</span><span class="n">ul_Temp</span> <span class="o">&amp;</span> <span class="mh">0xFFF9FFFF</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span> <span class="o">=</span> <span class="n">current</span><span class="p">;</span>
		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* i_InterruptFlag=1; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
	<span class="p">}</span>			<span class="cm">/*  if(data[9]==1) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* i_InterruptFlag=0; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
	<span class="p">}</span>			<span class="cm">/* else  if(data[9]==1) */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* i_Initialised=1; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* if(i_ScanType==1) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
	<span class="p">{</span>
		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* i_Sum=i_Sum+1; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

		<span class="n">insn</span><span class="o">-&gt;</span><span class="n">unused</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">i_APCI3200_ReadAnalogInput</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">insn</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ui_Dummy</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadAnalogInput                         |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read  value  of the selected channel			         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int ui_NoOfChannels    : No Of Channels To read       |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |				data[0]  : Digital Value Of Input             |</span>
<span class="cm">  |				data[1]  : Calibration Offset Value           |</span>
<span class="cm">  |				data[2]  : Calibration Gain Value</span>
<span class="cm">  |				data[3]  : CJC value</span>
<span class="cm">  |				data[4]  : CJC offset value</span>
<span class="cm">  |				data[5]  : CJC gain value</span>
<span class="cm">  | Begin JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values</span>
<span class="cm">  |				data[6] : CJC current source from eeprom</span>
<span class="cm">  |				data[7] : Channel current source from eeprom</span>
<span class="cm">  |				data[8] : Channle gain factor from eeprom</span>
<span class="cm">  | End JK 21.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadAnalogInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DummyValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_ConvertCJCCalibration</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* if(i_Initialised==0) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
	<span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(i_Initialised==0); */</span>

<span class="cp">#ifdef PRINT_INFO</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> insn-&gt;unused[0] = %i&quot;</span><span class="p">,</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">unused</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="cp">#endif</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">unused</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:

		<span class="n">i_APCI3200_Read1AnalogInputChannel</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">insn</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* ui_InterruptChannelValue[i_Count+0]=ui_DummyValue; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
			<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
			<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DummyValue</span><span class="p">;</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

		<span class="cm">/* Begin JK 25.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="n">i_APCI3200_GetChannelCalibrationValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_Channel_num</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
			<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">6</span><span class="p">],</span>
			<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
			<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">7</span><span class="p">],</span>
			<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
			<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]);</span>

<span class="cp">#ifdef PRINT_INFO</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count+6] = %lu&quot;</span><span class="p">,</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]);</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count+7] = %lu&quot;</span><span class="p">,</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]);</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count+8] = %lu&quot;</span><span class="p">,</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]);</span>
<span class="cp">#endif</span>

		<span class="cm">/* End JK 25.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* if((i_ADDIDATAType==2) &amp;&amp; (i_InterruptFlag == FALSE) &amp;&amp; (i_CJCAvailable==1)) */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAType</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCAvailable</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">{</span>
			<span class="n">i_APCI3200_ReadCJCValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* ui_InterruptChannelValue[i_Count + 3]=ui_DummyValue; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
					<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DummyValue</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">}</span>		<span class="cm">/* if((i_ADDIDATAType==2) &amp;&amp; (i_InterruptFlag == FALSE)) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* ui_InterruptChannelValue[i_Count + 3]=0; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
					<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">}</span>		<span class="cm">/* elseif((i_ADDIDATAType==2) &amp;&amp; (i_InterruptFlag == FALSE) &amp;&amp; (i_CJCAvailable==1)) */</span>

		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* if (( i_AutoCalibration == FALSE) &amp;&amp; (i_InterruptFlag == FALSE)) */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_AutoCalibration</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">))</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">{</span>
			<span class="n">i_APCI3200_ReadCalibrationOffsetValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* ui_InterruptChannelValue[i_Count + 1]=ui_DummyValue; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
					<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DummyValue</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="n">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* ui_InterruptChannelValue[i_Count + 2]=ui_DummyValue; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
					<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DummyValue</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">}</span>		<span class="cm">/* if (( i_AutoCalibration == FALSE) &amp;&amp; (i_InterruptFlag == FALSE)) */</span>

		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* if((i_ADDIDATAType==2) &amp;&amp; (i_InterruptFlag == FALSE)&amp;&amp; (i_CJCAvailable==1)) */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAType</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCAvailable</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">{</span>
	  <span class="cm">/**********************************************************/</span>
			<span class="cm">/*Test if the Calibration channel must be read for the CJC */</span>
	  <span class="cm">/**********************************************************/</span>
	  <span class="cm">/**********************************/</span>
			<span class="cm">/*Test if the polarity is the same */</span>
	  <span class="cm">/**********************************/</span>
			<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
			<span class="cm">/* if(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCPolarity</span> <span class="o">!=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAPolarity</span><span class="p">)</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">{</span>
				<span class="n">i_ConvertCJCCalibration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* if(i_CJCGain==i_ADDIDATAGain) */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_CJCGain</span> <span class="o">==</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAGain</span><span class="p">)</span>
					<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
				<span class="p">{</span>
					<span class="n">i_ConvertCJCCalibration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* if(i_CJCGain==i_ADDIDATAGain) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">i_ConvertCJCCalibration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_CJCGain==i_ADDIDATAGain) */</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_ConvertCJCCalibration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">i_APCI3200_ReadCJCCalOffset</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* ui_InterruptChannelValue[i_Count+4]=ui_DummyValue; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span>
					<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">ui_DummyValue</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

				<span class="n">i_APCI3200_ReadCJCCalGain</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>

				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* ui_InterruptChannelValue[i_Count+5]=ui_DummyValue; */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span>
					<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">ui_DummyValue</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* if(i_ConvertCJCCalibration==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
				<span class="cm">/* ui_InterruptChannelValue[i_Count+4]=0; */</span>
				<span class="cm">/* ui_InterruptChannelValue[i_Count+5]=0; */</span>

				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span>
					<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">s_BoardInfos</span>
					<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_ConvertCJCCalibration==1) */</span>
		<span class="p">}</span>		<span class="cm">/* if((i_ADDIDATAType==2) &amp;&amp; (i_InterruptFlag == FALSE)) */</span>

		<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
		<span class="cm">/* if(i_ScanType!=1) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* i_Count=0; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if(i_ScanType!=1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* i_Count=i_Count +6; */</span>
			<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
			<span class="cm">/* s_BoardInfos [dev-&gt;minor].i_Count=s_BoardInfos [dev-&gt;minor].i_Count +6; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">9</span><span class="p">;</span>
			<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="p">}</span>		<span class="cm">/* else if(i_ScanType!=1) */</span>

		<span class="cm">/* if((i_ScanType==1) &amp;&amp;(i_InterruptFlag==1)) */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="cm">/* i_Count=i_Count-6; */</span>
			<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
			<span class="cm">/* s_BoardInfos [dev-&gt;minor].i_Count=s_BoardInfos [dev-&gt;minor].i_Count-6; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">-</span> <span class="mi">9</span><span class="p">;</span>
			<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="p">}</span>
		<span class="cm">/* if(i_ScanType==0) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			   data[0]= ui_InterruptChannelValue[0];</span>
<span class="cm">			   data[1]= ui_InterruptChannelValue[1];</span>
<span class="cm">			   data[2]= ui_InterruptChannelValue[2];</span>
<span class="cm">			   data[3]= ui_InterruptChannelValue[3];</span>
<span class="cm">			   data[4]= ui_InterruptChannelValue[4];</span>
<span class="cm">			   data[5]= ui_InterruptChannelValue[5];</span>
<span class="cm">			 */</span>
<span class="cp">#ifdef PRINT_INFO</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> data[0]= s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[0];&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>

			<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
			<span class="cm">/* printk(&quot;\n 0 - i_APCI3200_GetChannelCalibrationValue data [6] = %lu, data [7] = %lu, data [8] = %lu&quot;, data [6], data [7], data [8]); */</span>
			<span class="n">i_APCI3200_GetChannelCalibrationValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_Channel_num</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]);</span>
			<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* data[i]=ui_InterruptChannelValue[i]; */</span>
			<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="cm">/* i_Count=0; */</span>
		<span class="cm">/* i_Sum=0; */</span>
		<span class="cm">/* if(i_ScanType==1) */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* i_Initialised=0; */</span>
			<span class="cm">/* i_InterruptFlag=0; */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The parameters passed are in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(insn-&gt;unused[0]) */</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_Read1AnalogInputChannel                 |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read  value  of the selected channel			         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int ui_NoOfChannel    : Channel No to read            |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : Digital Value read                   |</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_Read1AnalogInputChannel</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* ui_ChannelNo=i_ChannelNo; */</span>
	<span class="n">ui_ChannelNo</span> <span class="o">=</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span><span class="p">;</span>

	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Write the channel to configure */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Begin JK 20.10.2004: Bad channel value is used when using differential mode */</span>
	<span class="cm">/* outl(0 | ui_Channel_num , devpriv-&gt;iobase+i_Offset + 0x4); */</span>
	<span class="cm">/* outl(0 | s_BoardInfos [dev-&gt;minor].ui_Channel_num , devpriv-&gt;iobase+s_BoardInfos [dev-&gt;minor].i_Offset + 0x4); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mi">0</span> <span class="o">|</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mh">0x4</span><span class="p">);</span>
	<span class="cm">/* End JK 20.10.2004: Bad channel value is used when using differential mode */</span>

  <span class="cm">/*******************************/</span>
	<span class="cm">/* Set the convert timing unit */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>

  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>

  <span class="cm">/**************************************************************************/</span>
	<span class="cm">/* Set the start end stop index to the selected channel and set the start */</span>
  <span class="cm">/**************************************************************************/</span>

	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_ChannelNo</span> <span class="o">|</span> <span class="p">(</span><span class="n">ui_ChannelNo</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x80000</span><span class="p">;</span>

  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/************************/</span>
		<span class="cm">/* Enable the interrupt */</span>
      <span class="cm">/************************/</span>
		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>

  <span class="cm">/******************************/</span>
	<span class="cm">/* Write the command register */</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(ui_CommandRegister, devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

  <span class="cm">/*****************************/</span>
	<span class="cm">/*Test if interrupt is enable */</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
	  <span class="cm">/*************************/</span>
			<span class="cm">/*Read the EOC Status bit */</span>
	  <span class="cm">/*************************/</span>

			<span class="cm">/* ui_EOC = inl(devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

      <span class="cm">/***************************************/</span>
		<span class="cm">/* Read the digital value of the input */</span>
      <span class="cm">/***************************************/</span>

		<span class="cm">/* data[0] = inl (devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>
		<span class="cm">/* END JK 06.07.04: Management of sevrals boards */</span>

	<span class="p">}</span>			<span class="cm">/*  if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadCalibrationOffsetValue              |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read calibration offset  value  of the selected channel|</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : Calibration offset Value   |</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadCalibrationOffsetValue</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* BEGIN JK 06.07.04: Management of sevrals boards */</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Write the channel to configure */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Begin JK 20.10.2004: This seems not necessary ! */</span>
	<span class="cm">/* outl(0 | ui_Channel_num , devpriv-&gt;iobase+i_Offset + 0x4); */</span>
	<span class="cm">/* outl(0 | s_BoardInfos [dev-&gt;minor].ui_Channel_num , devpriv-&gt;iobase+s_BoardInfos [dev-&gt;minor].i_Offset + 0x4); */</span>
	<span class="cm">/* End JK 20.10.2004: This seems not necessary ! */</span>

  <span class="cm">/*******************************/</span>
	<span class="cm">/* Set the convert timing unit */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/*Read the calibration offset */</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/* ui_Temp = inl(devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>

  <span class="cm">/*********************************/</span>
	<span class="cm">/*Configure the Offset Conversion */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl((ui_Temp | 0x00020000), devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">outl</span><span class="p">((</span><span class="n">ui_Temp</span> <span class="o">|</span> <span class="mh">0x00020000</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/*Initialise ui_CommandRegister */</span>
  <span class="cm">/*******************************/</span>

	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>

      <span class="cm">/**********************/</span>
		<span class="cm">/*Enable the interrupt */</span>
      <span class="cm">/**********************/</span>

		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>

	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>

  <span class="cm">/**********************/</span>
	<span class="cm">/*Start the conversion */</span>
  <span class="cm">/**********************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">;</span>

  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the command regiter */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_CommandRegister, devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

  <span class="cm">/*****************************/</span>
	<span class="cm">/*Test if interrupt is enable */</span>
  <span class="cm">/*****************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">do</span> <span class="p">{</span>
	  <span class="cm">/*******************/</span>
			<span class="cm">/*Read the EOC flag */</span>
	  <span class="cm">/*******************/</span>

			<span class="cm">/* ui_EOC = inl (devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

      <span class="cm">/**************************************************/</span>
		<span class="cm">/*Read the digital value of the calibration Offset */</span>
      <span class="cm">/**************************************************/</span>

		<span class="cm">/* data[0] = inl(devpriv-&gt;iobase+i_Offset+ 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadCalibrationGainValue                |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read calibration gain  value  of the selected channel  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : Calibration gain Value Of Input     |</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Write the channel to configure */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* Begin JK 20.10.2004: This seems not necessary ! */</span>
	<span class="cm">/* outl(0 | ui_Channel_num , devpriv-&gt;iobase+i_Offset + 0x4); */</span>
	<span class="cm">/* outl(0 | s_BoardInfos [dev-&gt;minor].ui_Channel_num , devpriv-&gt;iobase+s_BoardInfos [dev-&gt;minor].i_Offset + 0x4); */</span>
	<span class="cm">/* End JK 20.10.2004: This seems not necessary ! */</span>

  <span class="cm">/***************************/</span>
	<span class="cm">/*Read the calibration gain */</span>
  <span class="cm">/***************************/</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* Set the convert timing unit */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/*Configure the Gain Conversion */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(0x00040000 , devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00040000</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>

  <span class="cm">/*******************************/</span>
	<span class="cm">/*Initialise ui_CommandRegister */</span>
  <span class="cm">/*******************************/</span>

	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>

      <span class="cm">/**********************/</span>
		<span class="cm">/*Enable the interrupt */</span>
      <span class="cm">/**********************/</span>

		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>

	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>

  <span class="cm">/**********************/</span>
	<span class="cm">/*Start the conversion */</span>
  <span class="cm">/**********************/</span>

	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">;</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the command regiter */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_CommandRegister , devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

  <span class="cm">/*****************************/</span>
	<span class="cm">/*Test if interrupt is enable */</span>
  <span class="cm">/*****************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">do</span> <span class="p">{</span>

	  <span class="cm">/*******************/</span>
			<span class="cm">/*Read the EOC flag */</span>
	  <span class="cm">/*******************/</span>

			<span class="cm">/* ui_EOC = inl(devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

      <span class="cm">/************************************************/</span>
		<span class="cm">/*Read the digital value of the calibration Gain */</span>
      <span class="cm">/************************************************/</span>

		<span class="cm">/* data[0] = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>

	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadCJCValue                            |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read CJC  value  of the selected channel               |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : CJC Value                           |</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_ReadCJCValue</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/******************************/</span>
	<span class="cm">/*Set the converting time unit */</span>
  <span class="cm">/******************************/</span>

	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>

  <span class="cm">/******************************/</span>
	<span class="cm">/*Configure the CJC Conversion */</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl( 0x00000400 , devpriv-&gt;iobase+i_Offset + 4); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00000400</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/*Initialise dw_CommandRegister */</span>
  <span class="cm">/*******************************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/**********************/</span>
		<span class="cm">/*Enable the interrupt */</span>
      <span class="cm">/**********************/</span>
		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>
	<span class="p">}</span>

  <span class="cm">/**********************/</span>
	<span class="cm">/*Start the conversion */</span>
  <span class="cm">/**********************/</span>

	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">;</span>

  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the command regiter */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_CommandRegister , devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

  <span class="cm">/*****************************/</span>
	<span class="cm">/*Test if interrupt is enable */</span>
  <span class="cm">/*****************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>

	  <span class="cm">/*******************/</span>
			<span class="cm">/*Read the EOC flag */</span>
	  <span class="cm">/*******************/</span>

			<span class="cm">/* ui_EOC = inl(devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

      <span class="cm">/***********************************/</span>
		<span class="cm">/*Read the digital value of the CJC */</span>
      <span class="cm">/***********************************/</span>

		<span class="cm">/* data[0] = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>

	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadCJCCalOffset                        |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read CJC calibration offset  value  of the selected channel</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : CJC calibration offset Value</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadCJCCalOffset</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/*******************************************/</span>
	<span class="cm">/*Read calibration offset value for the CJC */</span>
  <span class="cm">/*******************************************/</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* Set the convert timing unit */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/*Configure the CJC Conversion */</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(0x00000400 , devpriv-&gt;iobase+i_Offset + 4); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00000400</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/*Configure the Offset Conversion */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(0x00020000, devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00020000</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/*Initialise ui_CommandRegister */</span>
  <span class="cm">/*******************************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>

	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/**********************/</span>
		<span class="cm">/*Enable the interrupt */</span>
      <span class="cm">/**********************/</span>
		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>

	<span class="p">}</span>

  <span class="cm">/**********************/</span>
	<span class="cm">/*Start the conversion */</span>
  <span class="cm">/**********************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">;</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the command regiter */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_CommandRegister,devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
	  <span class="cm">/*******************/</span>
			<span class="cm">/*Read the EOC flag */</span>
	  <span class="cm">/*******************/</span>
			<span class="cm">/* ui_EOC = inl(devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>

      <span class="cm">/**************************************************/</span>
		<span class="cm">/*Read the digital value of the calibration Offset */</span>
      <span class="cm">/**************************************************/</span>
		<span class="cm">/* data[0] = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_ReadCJCGainValue                        |</span>
<span class="cm">  |			          (struct comedi_device *dev,struct comedi_subdevice *s,       |</span>
<span class="cm">  |                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Read CJC calibration gain value</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     unsigned int ui_NoOfChannels    : No Of Channels To read       |</span>
<span class="cm">  |                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			          data[0]  : CJC calibration gain value</span>
<span class="cm">  |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_ReadCJCCalGain</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_EOC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* Set the convert timing unit */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTimeUnit , devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTimeUnit</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* Set the convert timing */</span>
  <span class="cm">/**************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(i_ADDIDATAConversionTime , devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAConversionTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/*Configure the CJC Conversion */</span>
  <span class="cm">/******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(0x00000400,devpriv-&gt;iobase+i_Offset + 4); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00000400</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/*Configure the Gain Conversion */</span>
  <span class="cm">/*******************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(0x00040000,devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x00040000</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>

  <span class="cm">/*******************************/</span>
	<span class="cm">/*Initialise dw_CommandRegister */</span>
  <span class="cm">/*******************************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/*Test if the interrupt is enable */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_ENABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_ENABLE</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/**********************/</span>
		<span class="cm">/*Enable the interrupt */</span>
      <span class="cm">/**********************/</span>
		<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00100000</span><span class="p">;</span>
	<span class="p">}</span>
  <span class="cm">/**********************/</span>
	<span class="cm">/*Start the conversion */</span>
  <span class="cm">/**********************/</span>
	<span class="n">ui_CommandRegister</span> <span class="o">=</span> <span class="n">ui_CommandRegister</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">;</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the command regiter */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_CommandRegister ,devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_CommandRegister</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">do</span> <span class="p">{</span>
	  <span class="cm">/*******************/</span>
			<span class="cm">/*Read the EOC flag */</span>
	  <span class="cm">/*******************/</span>
			<span class="cm">/* ui_EOC = inl(devpriv-&gt;iobase+i_Offset + 20) &amp; 1; */</span>
			<span class="n">ui_EOC</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">ui_EOC</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">);</span>
      <span class="cm">/************************************************/</span>
		<span class="cm">/*Read the digital value of the calibration Gain */</span>
      <span class="cm">/************************************************/</span>
		<span class="cm">/* data[0] = inl (devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/* if (i_InterruptFlag == ADDIDATA_DISABLE) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_InsnBits_AnalogInput_Test               |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Tests the Selected Anlog Input Channel                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     struct comedi_subdevice *s     : Subdevice Pointer            |</span>
<span class="cm">  |                     struct comedi_insn *insn       : Insn Structure Pointer       |</span>
<span class="cm">  |                     unsigned int *data          : Data Pointer contains        |</span>
<span class="cm">  |                                          configuration parameters as below |</span>
<span class="cm">  |</span>
<span class="cm">  |</span>
<span class="cm">  |                           data[0]            : 0 TestAnalogInputShortCircuit</span>
<span class="cm">  |									     1 TestAnalogInputConnection							 														                        |</span>

<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  |			        data[0]            : Digital value obtained      |</span>
<span class="cm">  |                           data[1]            : calibration offset          |</span>
<span class="cm">  |                           data[2]            : calibration gain            |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_InsnBits_AnalogInput_Test</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Configuration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Temp</span><span class="p">;</span>		<span class="cm">/* ,i_TimeUnit; */</span>
	<span class="cm">/* if(i_Initialised==0) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(i_Initialised==0); */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of functionality</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[0]!=0 &amp;&amp; data[0]!=1) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>	<span class="cm">/* Perform Short Circuit TEST */</span>
	<span class="p">{</span>
      <span class="cm">/**************************/</span>
		<span class="cm">/*Set the short-cicuit bit */</span>
      <span class="cm">/**************************/</span>
		<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
		<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span>
			<span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
		<span class="cm">/* outl((0x00001000 |i_ChannelNo) , devpriv-&gt;iobase+i_Offset + 4); */</span>
		<span class="n">outl</span><span class="p">((</span><span class="mh">0x00001000</span> <span class="o">|</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span><span class="p">),</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
			<span class="mi">4</span><span class="p">);</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/*Set the time unit to ns */</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/* i_TimeUnit= i_ADDIDATAConversionTimeUnit;</span>
<span class="cm">		   i_ADDIDATAConversionTimeUnit= 1; */</span>
		<span class="cm">/* i_Temp= i_InterruptFlag ; */</span>
		<span class="n">i_Temp</span> <span class="o">=</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span><span class="p">;</span>
		<span class="cm">/* i_InterruptFlag = ADDIDATA_DISABLE; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">;</span>
		<span class="n">i_APCI3200_Read1AnalogInputChannel</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">insn</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="cm">/* if(i_AutoCalibration == FALSE) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_AutoCalibration</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
			<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Offset</span> <span class="o">+</span>
							<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

			<span class="cm">/* outl((0x00001000 |i_ChannelNo) , devpriv-&gt;iobase+i_Offset + 4); */</span>
			<span class="n">outl</span><span class="p">((</span><span class="mh">0x00001000</span> <span class="o">|</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">i_ChannelNo</span><span class="p">),</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">data</span><span class="o">++</span><span class="p">;</span>
			<span class="n">i_APCI3200_ReadCalibrationOffsetValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
			<span class="n">data</span><span class="o">++</span><span class="p">;</span>
			<span class="n">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
		<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span>
			<span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
		<span class="cm">/* outl((0x00000800|i_ChannelNo) , devpriv-&gt;iobase+i_Offset + 4); */</span>
		<span class="n">outl</span><span class="p">((</span><span class="mh">0x00000800</span> <span class="o">|</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ChannelNo</span><span class="p">),</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
			<span class="mi">4</span><span class="p">);</span>
		<span class="cm">/* ui_Configuration = inl(devpriv-&gt;iobase+i_Offset + 0); */</span>
		<span class="n">ui_Configuration</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">0</span><span class="p">);</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/*Set the time unit to ns */</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/* i_TimeUnit= i_ADDIDATAConversionTimeUnit;</span>
<span class="cm">		   i_ADDIDATAConversionTimeUnit= 1; */</span>
		<span class="cm">/* i_Temp= i_InterruptFlag ; */</span>
		<span class="n">i_Temp</span> <span class="o">=</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span><span class="p">;</span>
		<span class="cm">/* i_InterruptFlag = ADDIDATA_DISABLE; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="n">ADDIDATA_DISABLE</span><span class="p">;</span>
		<span class="n">i_APCI3200_Read1AnalogInputChannel</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">insn</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="cm">/* if(i_AutoCalibration == FALSE) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_AutoCalibration</span> <span class="o">==</span> <span class="n">FALSE</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
			<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Offset</span> <span class="o">+</span>
							<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
			<span class="cm">/* outl((0x00000800|i_ChannelNo) , devpriv-&gt;iobase+i_Offset + 4); */</span>
			<span class="n">outl</span><span class="p">((</span><span class="mh">0x00000800</span> <span class="o">|</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">i_ChannelNo</span><span class="p">),</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">data</span><span class="o">++</span><span class="p">;</span>
			<span class="n">i_APCI3200_ReadCalibrationOffsetValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
			<span class="n">data</span><span class="o">++</span><span class="p">;</span>
			<span class="n">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="cm">/* i_InterruptFlag=i_Temp ; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="n">i_Temp</span><span class="p">;</span>
	<span class="cm">/* printk(&quot;\ni_InterruptFlag=%d\n&quot;,i_InterruptFlag); */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : int i_APCI3200_InsnWriteReleaseAnalogInput             |</span>
<span class="cm">  |			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">  |                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              :  Resets the channels                                                      |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">  |                     struct comedi_subdevice *s     : Subdevice Pointer            |</span>
<span class="cm">  |                     struct comedi_insn *insn       : Insn Structure Pointer       |</span>
<span class="cm">  |                     unsigned int *data          : Data Pointer</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>

<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">  |			                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_InsnWriteReleaseAnalogInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function name     :int i_APCI3200_CommandTestAnalogInput(struct comedi_device *dev|</span>
<span class="cm">  |			,struct comedi_subdevice *s,struct comedi_cmd *cmd)			         |</span>
<span class="cm">  |                                        									 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Test validity for a command for cyclic anlog input     |</span>
<span class="cm">  |                       acquisition  						     			 |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev									 |</span>
<span class="cm">  |                     struct comedi_subdevice *s									 |</span>
<span class="cm">  |                     struct comedi_cmd *cmd              					         |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      :0              					                     |</span>
<span class="cm">  |                    													     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_CommandTestAnalogInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>		<span class="cm">/*  divisor1,divisor2; */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Triggermode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_TriggerEdge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_NbrOfChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Cpt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_ConversionTimeForAllChannels</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_SCANTimeNewUnit</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
	<span class="cm">/*  step 1: make sure trigger sources are trivially valid */</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span><span class="p">;</span>
	<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">&amp;=</span> <span class="n">TRIG_NOW</span> <span class="o">|</span> <span class="n">TRIG_EXT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span><span class="p">;</span>
	<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">&amp;=</span> <span class="n">TRIG_TIMER</span> <span class="o">|</span> <span class="n">TRIG_FOLLOW</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span><span class="p">;</span>
	<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span> <span class="o">&amp;=</span> <span class="n">TRIG_TIMER</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span><span class="p">;</span>
	<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span> <span class="o">&amp;=</span> <span class="n">TRIG_COUNT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span><span class="p">;</span>
	<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span> <span class="o">&amp;=</span> <span class="n">TRIG_COUNT</span> <span class="o">|</span> <span class="n">TRIG_NONE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span> <span class="o">||</span> <span class="n">tmp</span> <span class="o">!=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="cm">/* if(i_InterruptFlag==0) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
		<span class="cm">/*           printk(&quot;\nThe interrupt should be enabled\n&quot;); */</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">!=</span> <span class="n">TRIG_NOW</span> <span class="o">&amp;&amp;</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">!=</span> <span class="n">TRIG_EXT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">==</span> <span class="n">TRIG_EXT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_TriggerEdge</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">i_Triggermode</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i_TriggerEdge</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">i_TriggerEdge</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The trigger edge selection is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i_Triggermode</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The trigger mode selection is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">!=</span> <span class="n">TRIG_TIMER</span> <span class="o">&amp;&amp;</span>
		<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">!=</span> <span class="n">TRIG_FOLLOW</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span> <span class="o">!=</span> <span class="n">TRIG_TIMER</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span> <span class="o">!=</span> <span class="n">TRIG_COUNT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_end_src</span> <span class="o">=</span> <span class="n">TRIG_COUNT</span><span class="p">;</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span> <span class="o">!=</span> <span class="n">TRIG_NONE</span> <span class="o">&amp;&amp;</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span> <span class="o">!=</span> <span class="n">TRIG_COUNT</span><span class="p">)</span>
		<span class="n">err</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* i_FirstChannel=cmd-&gt;chanlist[0]; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_FirstChannel</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">chanlist</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="cm">/* i_LastChannel=cmd-&gt;chanlist[1]; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_LastChannel</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">chanlist</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span> <span class="o">==</span> <span class="n">TRIG_TIMER</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_ConvertTime</span> <span class="o">!=</span> <span class="mi">20</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ConvertTime</span> <span class="o">!=</span> <span class="mi">40</span>
			<span class="o">&amp;&amp;</span> <span class="n">ui_ConvertTime</span> <span class="o">!=</span> <span class="mi">80</span> <span class="o">&amp;&amp;</span> <span class="n">ui_ConvertTime</span> <span class="o">!=</span> <span class="mi">160</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of conversion time reload value is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if (ui_ConvertTime!=20 &amp;&amp; ui_ConvertTime!=40 &amp;&amp; ui_ConvertTime!=80 &amp;&amp; ui_ConvertTime!=160 ) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_ConvertTimeBase</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The selection of conversion time unit  is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if(ui_ConvertTimeBase!=2) */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">==</span> <span class="n">TRIG_FOLLOW</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(cmd-&gt;scan_begin_src==TRIG_FOLLOW) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_DelayTimeBase</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">ui_DelayTimeBase</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The Delay time base selection is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_DelayTime</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">ui_DelayTime</span> <span class="o">&gt;</span> <span class="mi">1023</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The Delay time value is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">fpu_begin</span><span class="p">();</span>
		<span class="n">d_SCANTimeNewUnit</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">ui_DelayTime</span><span class="p">;</span>
		<span class="cm">/* i_NbrOfChannel= i_LastChannel-i_FirstChannel + 4; */</span>
		<span class="n">i_NbrOfChannel</span> <span class="o">=</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_LastChannel</span> <span class="o">-</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_FirstChannel</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>
      <span class="cm">/**********************************************************/</span>
		<span class="cm">/*calculate the total conversion time for all the channels */</span>
      <span class="cm">/**********************************************************/</span>
		<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">=</span>
			<span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ui_ConvertTime</span> <span class="o">/</span>
			<span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">i_NbrOfChannel</span><span class="p">);</span>

      <span class="cm">/*******************************/</span>
		<span class="cm">/*Convert the frequence in time */</span>
      <span class="cm">/*******************************/</span>
		<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">=</span>
			<span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">d_ConversionTimeForAllChannels</span><span class="p">;</span>
		<span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="cm">/***********************************/</span>
		<span class="cm">/*Test if the time unit is the same */</span>
      <span class="cm">/***********************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ui_DelayTimeBase</span> <span class="o">&lt;=</span> <span class="n">ui_ConvertTimeBase</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i_Cpt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">i_Cpt</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">ui_ConvertTimeBase</span> <span class="o">-</span> <span class="n">ui_DelayTimeBase</span><span class="p">);</span>
				<span class="n">i_Cpt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

				<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">=</span>
					<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
				<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">=</span>
					<span class="n">d_ConversionTimeForAllChannels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i_Cpt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">i_Cpt</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">ui_DelayTimeBase</span> <span class="o">-</span> <span class="n">ui_ConvertTimeBase</span><span class="p">);</span>
				<span class="n">i_Cpt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">d_SCANTimeNewUnit</span> <span class="o">=</span> <span class="n">d_SCANTimeNewUnit</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>

			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">d_ConversionTimeForAllChannels</span> <span class="o">&gt;=</span> <span class="n">d_SCANTimeNewUnit</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">SCAN Delay value cannot be used</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	  <span class="cm">/*********************************/</span>
			<span class="cm">/*SCAN Delay value cannot be used */</span>
	  <span class="cm">/*********************************/</span>
			<span class="n">err</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">fpu_end</span><span class="p">();</span>
	<span class="p">}</span>			<span class="cm">/* else if(cmd-&gt;scan_begin_src==TRIG_FOLLOW) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_APCI3200_Reset</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function name     :int i_APCI3200_StopCyclicAcquisition(struct comedi_device *dev,|</span>
<span class="cm">  | 											     struct comedi_subdevice *s)|</span>
<span class="cm">  |                                        									 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Stop the  acquisition  						     |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev									 |</span>
<span class="cm">  |                     struct comedi_subdevice *s									 |</span>
<span class="cm">  |                                                 					         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      :0              					                     |</span>
<span class="cm">  |                    													     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_StopCyclicAcquisition</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Configuration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* i_InterruptFlag=0; */</span>
	<span class="cm">/* i_Initialised=0; */</span>
	<span class="cm">/* i_Count=0; */</span>
	<span class="cm">/* i_Sum=0; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="cm">/*******************/</span>
	<span class="cm">/*Read the register */</span>
  <span class="cm">/*******************/</span>
	<span class="cm">/* ui_Configuration = inl(devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span>
		<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/*Reset the START and IRQ bit */</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl((ui_Configuration &amp; 0xFFE7FFFF),devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">((</span><span class="n">ui_Configuration</span> <span class="o">&amp;</span> <span class="mh">0xFFE7FFFF</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function name     : int i_APCI3200_CommandAnalogInput(struct comedi_device *dev,  |</span>
<span class="cm">  |												struct comedi_subdevice *s) |</span>
<span class="cm">  |                                        									 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Does asynchronous acquisition                          |</span>
<span class="cm">  |                     Determines the mode 1 or 2.						     |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev									 |</span>
<span class="cm">  |                     struct comedi_subdevice *s									 |</span>
<span class="cm">  |                     														 |</span>
<span class="cm">  |                     														 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      :              					                         |</span>
<span class="cm">  |                    													     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_CommandAnalogInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">comedi_cmd</span> <span class="o">*</span><span class="n">cmd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="o">-&gt;</span><span class="n">cmd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Configuration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* INT  i_CurrentSource = 0; */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Trigger</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_TriggerEdge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Triggermode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ScanMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DelayMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* i_FirstChannel=cmd-&gt;chanlist[0]; */</span>
	<span class="cm">/* i_LastChannel=cmd-&gt;chanlist[1]; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_FirstChannel</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">chanlist</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_LastChannel</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">chanlist</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_src</span> <span class="o">==</span> <span class="n">TRIG_EXT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_Trigger</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">ui_TriggerEdge</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">ui_Triggermode</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">start_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(cmd-&gt;start_src==TRIG_EXT) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_Trigger</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* elseif(cmd-&gt;start_src==TRIG_EXT) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">stop_src</span> <span class="o">==</span> <span class="n">TRIG_COUNT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_ScanMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if (cmd-&gt;stop_src==TRIG_COUNT) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_ScanMode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* else if (cmd-&gt;stop_src==TRIG_COUNT) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_src</span> <span class="o">==</span> <span class="n">TRIG_FOLLOW</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ui_DelayMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(cmd-&gt;scan_begin_src==TRIG_FOLLOW) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_DelayTime</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">ui_DelayTimeBase</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">scan_begin_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">ui_DelayMode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* else if(cmd-&gt;scan_begin_src==TRIG_FOLLOW) */</span>
	<span class="cm">/*         printk(&quot;\nui_DelayTime=%u\n&quot;,ui_DelayTime); */</span>
	<span class="cm">/*         printk(&quot;\nui_DelayTimeBase=%u\n&quot;,ui_DelayTimeBase); */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_src</span> <span class="o">==</span> <span class="n">TRIG_TIMER</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_arg</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">;</span>
		<span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">convert_arg</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ui_ConvertTime</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ui_ConvertTimeBase</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*  if(i_ADDIDATAType ==1 || ((i_ADDIDATAType==2))) */</span>
	<span class="cm">/*    { */</span>
  <span class="cm">/**************************************************/</span>
	<span class="cm">/*Read the old configuration of the current source */</span>
  <span class="cm">/**************************************************/</span>
	<span class="cm">/* ui_Configuration = inl(devpriv-&gt;iobase+i_Offset + 12); */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span>
		<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
  <span class="cm">/***********************************************/</span>
	<span class="cm">/*Write the configuration of the current source */</span>
  <span class="cm">/***********************************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl((ui_Configuration &amp; 0xFFC00000 ), devpriv-&gt;iobase+i_Offset +12); */</span>
	<span class="n">outl</span><span class="p">((</span><span class="n">ui_Configuration</span> <span class="o">&amp;</span> <span class="mh">0xFFC00000</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
	<span class="cm">/*  } */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/*      printk(&quot;\nfirstchannel=%u\n&quot;,i_FirstChannel); */</span>
	<span class="cm">/*      printk(&quot;\nlastchannel=%u\n&quot;,i_LastChannel); */</span>
	<span class="cm">/*      printk(&quot;\nui_Trigger=%u\n&quot;,ui_Trigger); */</span>
	<span class="cm">/*      printk(&quot;\nui_TriggerEdge=%u\n&quot;,ui_TriggerEdge); */</span>
	<span class="cm">/*      printk(&quot;\nui_Triggermode=%u\n&quot;,ui_Triggermode); */</span>
	<span class="cm">/*       printk(&quot;\nui_DelayMode=%u\n&quot;,ui_DelayMode); */</span>
	<span class="cm">/*      printk(&quot;\nui_ScanMode=%u\n&quot;,ui_ScanMode); */</span>

	<span class="cm">/* ui_Configuration = i_FirstChannel |(i_LastChannel &lt;&lt; 8)| 0x00100000 | */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_FirstChannel</span> <span class="o">|</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
			<span class="n">minor</span><span class="p">].</span>
		<span class="n">i_LastChannel</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00100000</span> <span class="o">|</span> <span class="p">(</span><span class="n">ui_Trigger</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">ui_TriggerEdge</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ui_Triggermode</span> <span class="o">&lt;&lt;</span> <span class="mi">27</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ui_DelayMode</span>
		<span class="o">&lt;&lt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ui_ScanMode</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>

  <span class="cm">/*************************/</span>
	<span class="cm">/*Write the Configuration */</span>
  <span class="cm">/*************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl( ui_Configuration, devpriv-&gt;iobase+i_Offset + 0x8); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_Configuration</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mh">0x8</span><span class="p">);</span>
  <span class="cm">/***********************/</span>
	<span class="cm">/*Write the Delay Value */</span>
  <span class="cm">/***********************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_DelayTime,devpriv-&gt;iobase+i_Offset + 40); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_DelayTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">40</span><span class="p">);</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/*Write the Delay time base */</span>
  <span class="cm">/***************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_DelayTimeBase,devpriv-&gt;iobase+i_Offset + 44); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_DelayTimeBase</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">44</span><span class="p">);</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/*Write the conversion time value */</span>
  <span class="cm">/*********************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_ConvertTime,devpriv-&gt;iobase+i_Offset + 32); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_ConvertTime</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>

  <span class="cm">/********************************/</span>
	<span class="cm">/*Write the conversion time base */</span>
  <span class="cm">/********************************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl(ui_ConvertTimeBase,devpriv-&gt;iobase+i_Offset + 36); */</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">ui_ConvertTimeBase</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">36</span><span class="p">);</span>
  <span class="cm">/*******************/</span>
	<span class="cm">/*Read the register */</span>
  <span class="cm">/*******************/</span>
	<span class="cm">/* ui_Configuration = inl(devpriv-&gt;iobase+i_Offset + 4); */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span>
		<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="cm">/******************/</span>
	<span class="cm">/*Set the SCAN bit */</span>
  <span class="cm">/******************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>

	<span class="cm">/* outl(((ui_Configuration &amp; 0x1E0FF) | 0x00002000),devpriv-&gt;iobase+i_Offset + 4); */</span>
	<span class="n">outl</span><span class="p">(((</span><span class="n">ui_Configuration</span> <span class="o">&amp;</span> <span class="mh">0x1E0FF</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x00002000</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
  <span class="cm">/*******************/</span>
	<span class="cm">/*Read the register */</span>
  <span class="cm">/*******************/</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* ui_Configuration = inl(devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">ui_Configuration</span> <span class="o">=</span>
		<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

  <span class="cm">/*******************/</span>
	<span class="cm">/*Set the START bit */</span>
  <span class="cm">/*******************/</span>
	<span class="cm">/* while (((inl(devpriv-&gt;iobase+i_Offset+12)&gt;&gt;19) &amp; 1) != 1); */</span>
	<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span>
					<span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
	<span class="cm">/* outl((ui_Configuration | 0x00080000),devpriv-&gt;iobase+i_Offset + 8); */</span>
	<span class="n">outl</span><span class="p">((</span><span class="n">ui_Configuration</span> <span class="o">|</span> <span class="mh">0x00080000</span><span class="p">),</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   :  int i_APCI3200_Reset(struct comedi_device *dev)			     |</span>
<span class="cm">  |							                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              :Resets the registers of the card                        |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  :                                                        |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      :                                                        |</span>
<span class="cm">  |					                                                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI3200_Reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_Temp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Dummy</span><span class="p">;</span>
	<span class="cm">/* i_InterruptFlag=0; */</span>
	<span class="cm">/* i_Initialised==0; */</span>
	<span class="cm">/* i_Count=0; */</span>
	<span class="cm">/* i_Sum=0; */</span>

	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Initialised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">b_StructInitialized</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">outl</span><span class="p">(</span><span class="mh">0x83838383</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x60</span><span class="p">);</span>

	<span class="cm">/*  Enable the interrupt for the controller */</span>
	<span class="n">dw_Dummy</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">outl</span><span class="p">(</span><span class="n">dw_Dummy</span> <span class="o">|</span> <span class="mh">0x2000</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">outl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span><span class="p">);</span>	<span class="cm">/* Resets the output */</span>
  <span class="cm">/***************/</span>
	<span class="cm">/*Empty the buffer */</span>
  <span class="cm">/**************/</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Temp</span> <span class="o">&lt;=</span> <span class="mi">95</span><span class="p">;</span> <span class="n">i_Temp</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* ui_InterruptChannelValue[i_Temp]=0; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_InterruptChannelValue</span><span class="p">[</span><span class="n">i_Temp</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* for(i_Temp=0;i_Temp&lt;=95;i_Temp++) */</span>
  <span class="cm">/*****************************/</span>
	<span class="cm">/*Reset the START and IRQ bit */</span>
  <span class="cm">/*****************************/</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Temp</span> <span class="o">&lt;=</span> <span class="mi">192</span><span class="p">;)</span> <span class="p">{</span>
		<span class="k">while</span> <span class="p">(((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">i_Temp</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">;</span>
		<span class="n">outl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">i_Temp</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">i_Temp</span> <span class="o">=</span> <span class="n">i_Temp</span> <span class="o">+</span> <span class="mi">64</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* for(i_Temp=0;i_Temp&lt;=192;i_Temp+64) */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function   Name   : static void v_APCI3200_Interrupt					     |</span>
<span class="cm">  |					  (int irq , void *d)				 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : Interrupt processing Routine                           |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : int irq                 : irq number                   |</span>
<span class="cm">  |                     void *d                 : void pointer                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Output Parameters :	--													 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">  |		            : FALSE : Error occur. Return the error					 |</span>
<span class="cm">  |					                                                         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">void</span> <span class="nf">v_APCI3200_Interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_StatusRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_ChannelNumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_CalibrationFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_CJCFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DummyValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DigitalTemperature</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_DigitalInput</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_ConvertCJCCalibration</span><span class="p">;</span>

	<span class="cm">/* BEGIN JK TEST */</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* END JK TEST */</span>

	<span class="cm">/* printk (&quot;\n i_ScanType = %i i_ADDIDATAType = %i&quot;, s_BoardInfos [dev-&gt;minor].i_ScanType, s_BoardInfos [dev-&gt;minor].i_ADDIDATAType); */</span>

	<span class="cm">/* switch(i_ScanType) */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ScanType</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="cm">/* switch(i_ADDIDATAType) */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_ADDIDATAType</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">case</span> <span class="mi">1</span>:

	  <span class="cm">/************************************/</span>
			<span class="cm">/*Read the interrupt status register */</span>
	  <span class="cm">/************************************/</span>
			<span class="cm">/* ui_StatusRegister = inl(devpriv-&gt;iobase+i_Offset + 16); */</span>
			<span class="n">ui_StatusRegister</span> <span class="o">=</span>
				<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">ui_StatusRegister</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* i_CalibrationFlag = ((inl(devpriv-&gt;iobase+i_Offset + 12) &amp; 0x00060000) &gt;&gt; 17); */</span>
				<span class="n">i_CalibrationFlag</span> <span class="o">=</span>
					<span class="p">((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Offset</span> <span class="o">+</span>
							<span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00060000</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
					<span class="mi">17</span><span class="p">);</span>
	      <span class="cm">/*************************/</span>
				<span class="cm">/*Read the channel number */</span>
	      <span class="cm">/*************************/</span>
				<span class="cm">/* ui_ChannelNumber = inl(devpriv-&gt;iobase+i_Offset + 24); */</span>

	      <span class="cm">/*************************************/</span>
				<span class="cm">/*Read the digital analog input value */</span>
	      <span class="cm">/*************************************/</span>
				<span class="cm">/* ui_DigitalInput = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
				<span class="n">ui_DigitalInput</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>

	      <span class="cm">/***********************************************/</span>
				<span class="cm">/* Test if the value read is the channel value */</span>
	      <span class="cm">/***********************************************/</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 0] = ui_DigitalInput; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DigitalInput</span><span class="p">;</span>

					<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
					<span class="cm">/*</span>
<span class="cm">					   printk(&quot;\n 1 - i_APCI3200_GetChannelCalibrationValue (dev, s_BoardInfos %i&quot;, ui_ChannelNumber);</span>
<span class="cm">					   i_APCI3200_GetChannelCalibrationValue (dev, s_BoardInfos [dev-&gt;minor].ui_Channel_num,</span>
<span class="cm">					   &amp;s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count + 6],</span>
<span class="cm">					   &amp;s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count + 7],</span>
<span class="cm">					   &amp;s_BoardInfos [dev-&gt;minor].ui_InterruptChannelValue[s_BoardInfos [dev-&gt;minor].i_Count + 8]);</span>
<span class="cm">					 */</span>
					<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

		  <span class="cm">/******************************************************/</span>
					<span class="cm">/*Start the conversion of the calibration offset value */</span>
		  <span class="cm">/******************************************************/</span>
					<span class="n">i_APCI3200_ReadCalibrationOffsetValue</span>
						<span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* if (i_CalibrationFlag == 0) */</span>
	      <span class="cm">/**********************************************************/</span>
				<span class="cm">/* Test if the value read is the calibration offset value */</span>
	      <span class="cm">/**********************************************************/</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

		  <span class="cm">/******************/</span>
					<span class="cm">/* Save the value */</span>
		  <span class="cm">/******************/</span>

					<span class="cm">/* ui_InterruptChannelValue[i_Count + 1] = ui_DigitalInput; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DigitalInput</span><span class="p">;</span>

		  <span class="cm">/******************************************************/</span>
					<span class="cm">/* Start the conversion of the calibration gain value */</span>
		  <span class="cm">/******************************************************/</span>
					<span class="n">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* if (i_CalibrationFlag == 1) */</span>
	      <span class="cm">/******************************************************/</span>
				<span class="cm">/*Test if the value read is the calibration gain value */</span>
	      <span class="cm">/******************************************************/</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>

		  <span class="cm">/****************/</span>
					<span class="cm">/*Save the value */</span>
		  <span class="cm">/****************/</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 2] = ui_DigitalInput; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ui_DigitalInput</span><span class="p">;</span>
					<span class="cm">/* if(i_ScanType==1) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

						<span class="cm">/* i_InterruptFlag=0; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="cm">/* i_Count=i_Count + 6; */</span>
						<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
						<span class="cm">/* s_BoardInfos [dev-&gt;minor].i_Count=s_BoardInfos [dev-&gt;minor].i_Count + 6; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Count</span> <span class="o">=</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
							<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">9</span><span class="p">;</span>
						<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
					<span class="p">}</span>	<span class="cm">/* if(i_ScanType==1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* i_Count=0; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* elseif(i_ScanType==1) */</span>
					<span class="cm">/* if(i_ScanType!=1) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_ScanType</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">send_sig</span><span class="p">(</span><span class="n">SIGIO</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/*  send signal to the sample */</span>
					<span class="p">}</span>	<span class="cm">/* if(i_ScanType!=1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* if(i_ChannelCount==i_Sum) */</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_ChannelCount</span> <span class="o">==</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span><span class="p">)</span> <span class="p">{</span>
							<span class="n">send_sig</span><span class="p">(</span><span class="n">SIGIO</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/*  send signal to the sample */</span>
						<span class="p">}</span>
					<span class="p">}</span>	<span class="cm">/* if(i_ScanType!=1) */</span>
				<span class="p">}</span>	<span class="cm">/* if (i_CalibrationFlag == 2) */</span>
			<span class="p">}</span>	<span class="cm">/*  if ((ui_StatusRegister &amp; 0x2) == 0x2) */</span>

			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">2</span>:
	  <span class="cm">/************************************/</span>
			<span class="cm">/*Read the interrupt status register */</span>
	  <span class="cm">/************************************/</span>

			<span class="cm">/* ui_StatusRegister = inl(devpriv-&gt;iobase+i_Offset + 16); */</span>
			<span class="n">ui_StatusRegister</span> <span class="o">=</span>
				<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	  <span class="cm">/*************************/</span>
			<span class="cm">/*Test if interrupt occur */</span>
	  <span class="cm">/*************************/</span>

			<span class="k">if</span> <span class="p">((</span><span class="n">ui_StatusRegister</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>

				<span class="cm">/* i_CJCFlag = ((inl(devpriv-&gt;iobase+i_Offset + 4) &amp; 0x00000400) &gt;&gt; 10); */</span>
				<span class="n">i_CJCFlag</span> <span class="o">=</span>
					<span class="p">((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Offset</span> <span class="o">+</span>
							<span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00000400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>

				<span class="cm">/* i_CalibrationFlag = ((inl(devpriv-&gt;iobase+i_Offset + 12) &amp; 0x00060000) &gt;&gt; 17); */</span>
				<span class="n">i_CalibrationFlag</span> <span class="o">=</span>
					<span class="p">((</span><span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Offset</span> <span class="o">+</span>
							<span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00060000</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
					<span class="mi">17</span><span class="p">);</span>

	      <span class="cm">/*************************/</span>
				<span class="cm">/*Read the channel number */</span>
	      <span class="cm">/*************************/</span>

				<span class="cm">/* ui_ChannelNumber = inl(devpriv-&gt;iobase+i_Offset + 24); */</span>
				<span class="n">ui_ChannelNumber</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">24</span><span class="p">);</span>
				<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
				<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_Channel_num</span> <span class="o">=</span>
					<span class="n">ui_ChannelNumber</span><span class="p">;</span>
				<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

	      <span class="cm">/************************************/</span>
				<span class="cm">/*Read the digital temperature value */</span>
	      <span class="cm">/************************************/</span>
				<span class="cm">/* ui_DigitalTemperature = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
				<span class="n">ui_DigitalTemperature</span> <span class="o">=</span>
					<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>

	      <span class="cm">/*********************************************/</span>
				<span class="cm">/*Test if the value read is the channel value */</span>
	      <span class="cm">/*********************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 0]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

		  <span class="cm">/*********************************/</span>
					<span class="cm">/*Start the conversion of the CJC */</span>
		  <span class="cm">/*********************************/</span>
					<span class="n">i_APCI3200_ReadCJCValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/* if ((i_CalibrationFlag == 0) &amp;&amp; (i_CJCFlag == 0)) */</span>

		 <span class="cm">/*****************************************/</span>
				<span class="cm">/*Test if the value read is the CJC value */</span>
		 <span class="cm">/*****************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 3]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

		  <span class="cm">/******************************************************/</span>
					<span class="cm">/*Start the conversion of the calibration offset value */</span>
		  <span class="cm">/******************************************************/</span>
					<span class="n">i_APCI3200_ReadCalibrationOffsetValue</span>
						<span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/*  if ((i_CJCFlag == 1) &amp;&amp; (i_CalibrationFlag == 0)) */</span>

		 <span class="cm">/********************************************************/</span>
				<span class="cm">/*Test if the value read is the calibration offset value */</span>
		 <span class="cm">/********************************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 1]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

		  <span class="cm">/****************************************************/</span>
					<span class="cm">/*Start the conversion of the calibration gain value */</span>
		  <span class="cm">/****************************************************/</span>
					<span class="n">i_APCI3200_ReadCalibrationGainValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/* if ((i_CalibrationFlag == 1) &amp;&amp; (i_CJCFlag == 0)) */</span>

	      <span class="cm">/******************************************************/</span>
				<span class="cm">/*Test if the value read is the calibration gain value */</span>
	      <span class="cm">/******************************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 2]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

		  <span class="cm">/**********************************************************/</span>
					<span class="cm">/*Test if the Calibration channel must be read for the CJC */</span>
		  <span class="cm">/**********************************************************/</span>

					<span class="cm">/*Test if the polarity is the same */</span>
		  <span class="cm">/**********************************/</span>
					<span class="cm">/* if(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_CJCPolarity</span> <span class="o">!=</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_ADDIDATAPolarity</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">i_ConvertCJCCalibration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* if(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* if(i_CJCGain==i_ADDIDATAGain) */</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_CJCGain</span> <span class="o">==</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span>
							<span class="n">i_ADDIDATAGain</span><span class="p">)</span> <span class="p">{</span>
							<span class="n">i_ConvertCJCCalibration</span>
								<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="p">}</span>	<span class="cm">/* if(i_CJCGain==i_ADDIDATAGain) */</span>
						<span class="k">else</span> <span class="p">{</span>
							<span class="n">i_ConvertCJCCalibration</span>
								<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="p">}</span>	<span class="cm">/* elseif(i_CJCGain==i_ADDIDATAGain) */</span>
					<span class="p">}</span>	<span class="cm">/* elseif(i_CJCPolarity!=i_ADDIDATAPolarity) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">i_ConvertCJCCalibration</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		      <span class="cm">/****************************************************************/</span>
						<span class="cm">/*Start the conversion of the calibration gain value for the CJC */</span>
		      <span class="cm">/****************************************************************/</span>
						<span class="n">i_APCI3200_ReadCJCCalOffset</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>

					<span class="p">}</span>	<span class="cm">/* if(i_ConvertCJCCalibration==1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* ui_InterruptChannelValue[i_Count + 4]=0; */</span>
						<span class="cm">/* ui_InterruptChannelValue[i_Count + 5]=0; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">ui_InterruptChannelValue</span>
							<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span>
							<span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">ui_InterruptChannelValue</span>
							<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span>
							<span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* elseif(i_ConvertCJCCalibration==1) */</span>
				<span class="p">}</span>	<span class="cm">/* else if ((i_CalibrationFlag == 2) &amp;&amp; (i_CJCFlag == 0)) */</span>

		 <span class="cm">/********************************************************************/</span>
				<span class="cm">/*Test if the value read is the calibration offset value for the CJC */</span>
		 <span class="cm">/********************************************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 4]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

		  <span class="cm">/****************************************************************/</span>
					<span class="cm">/*Start the conversion of the calibration gain value for the CJC */</span>
		  <span class="cm">/****************************************************************/</span>
					<span class="n">i_APCI3200_ReadCJCCalGain</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">ui_DummyValue</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/* if ((i_CalibrationFlag == 1) &amp;&amp; (i_CJCFlag == 1)) */</span>

	      <span class="cm">/******************************************************************/</span>
				<span class="cm">/*Test if the value read is the calibration gain value for the CJC */</span>
	      <span class="cm">/******************************************************************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">i_CalibrationFlag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
					<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i_CJCFlag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/* ui_InterruptChannelValue[i_Count + 5]=ui_DigitalTemperature; */</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">ui_InterruptChannelValue</span>
						<span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_Count</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
						<span class="n">ui_DigitalTemperature</span><span class="p">;</span>

					<span class="cm">/* if(i_ScanType==1) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_ScanType</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

						<span class="cm">/* i_InterruptFlag=0; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
						<span class="cm">/* i_Count=i_Count + 6; */</span>
						<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
						<span class="cm">/* s_BoardInfos [dev-&gt;minor].i_Count=s_BoardInfos [dev-&gt;minor].i_Count + 6; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Count</span> <span class="o">=</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
							<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="mi">9</span><span class="p">;</span>
						<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
					<span class="p">}</span>	<span class="cm">/* if(i_ScanType==1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* i_Count=0; */</span>
						<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* elseif(i_ScanType==1) */</span>

					<span class="cm">/* if(i_ScanType!=1) */</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
						<span class="n">i_ScanType</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">send_sig</span><span class="p">(</span><span class="n">SIGIO</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/*  send signal to the sample */</span>
					<span class="p">}</span>	<span class="cm">/* if(i_ScanType!=1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/* if(i_ChannelCount==i_Sum) */</span>
						<span class="k">if</span> <span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
							<span class="n">i_ChannelCount</span> <span class="o">==</span>
							<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
								<span class="n">minor</span><span class="p">].</span><span class="n">i_Sum</span><span class="p">)</span> <span class="p">{</span>
							<span class="n">send_sig</span><span class="p">(</span><span class="n">SIGIO</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/*  send signal to the sample */</span>

						<span class="p">}</span>	<span class="cm">/* if(i_ChannelCount==i_Sum) */</span>
					<span class="p">}</span>	<span class="cm">/* else if(i_ScanType!=1) */</span>
				<span class="p">}</span>	<span class="cm">/* if ((i_CalibrationFlag == 2) &amp;&amp; (i_CJCFlag == 1)) */</span>

			<span class="p">}</span>	<span class="cm">/* else if ((ui_StatusRegister &amp; 0x2) == 0x2) */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(i_ADDIDATAType) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">i_APCI3200_InterruptHandleEos</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(i_ScanType) */</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Function name     :int i_APCI3200_InterruptHandleEos(struct comedi_device *dev)   |</span>
<span class="cm">  |                                        									 |</span>
<span class="cm">  |                                            						         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Task              : .                   |</span>
<span class="cm">  |                     This function copies the acquired data(from FIFO)      |</span>
<span class="cm">  |				to Comedi buffer.		 							 |</span>
<span class="cm">  |                     										                 |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Input Parameters  : struct comedi_device *dev									 |</span>
<span class="cm">  |                     														 |</span>
<span class="cm">  |                                                 					         |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">  | Return Value      : 0            					                         |</span>
<span class="cm">  |                    													     |</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_APCI3200_InterruptHandleEos</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_StatusRegister</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">subdevices</span> <span class="o">+</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* BEGIN JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
	<span class="cm">/* comedi_async *async = s-&gt;async; */</span>
	<span class="cm">/* UINT *data; */</span>
	<span class="cm">/* data=async-&gt;data+async-&gt;buf_int_ptr;//new samples added from here onwards */</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* END JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>

  <span class="cm">/************************************/</span>
	<span class="cm">/*Read the interrupt status register */</span>
  <span class="cm">/************************************/</span>
	<span class="cm">/* ui_StatusRegister = inl(devpriv-&gt;iobase+i_Offset + 16); */</span>
	<span class="n">ui_StatusRegister</span> <span class="o">=</span>
		<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>

  <span class="cm">/*************************/</span>
	<span class="cm">/*Test if interrupt occur */</span>
  <span class="cm">/*************************/</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">ui_StatusRegister</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/*Read the channel number */</span>
      <span class="cm">/*************************/</span>
		<span class="cm">/* ui_ChannelNumber = inl(devpriv-&gt;iobase+i_Offset + 24); */</span>
		<span class="cm">/* BEGIN JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
		<span class="cm">/* This value is not used */</span>
		<span class="cm">/* ui_ChannelNumber = inl(devpriv-&gt;iobase+s_BoardInfos [dev-&gt;minor].i_Offset + 24); */</span>
		<span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* END JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>

      <span class="cm">/*************************************/</span>
		<span class="cm">/*Read the digital Analog Input value */</span>
      <span class="cm">/*************************************/</span>

		<span class="cm">/* data[i_Count] = inl(devpriv-&gt;iobase+i_Offset + 28); */</span>
		<span class="cm">/* Begin JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
		<span class="cm">/* data[s_BoardInfos [dev-&gt;minor].i_Count] = inl(devpriv-&gt;iobase+s_BoardInfos [dev-&gt;minor].i_Offset + 28); */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">ui_ScanValueArray</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
				<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Offset</span> <span class="o">+</span> <span class="mi">28</span><span class="p">);</span>
		<span class="cm">/* End JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>

		<span class="cm">/* if((i_Count == (i_LastChannel-i_FirstChannel+3))) */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">==</span>
				<span class="p">(</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_LastChannel</span> <span class="o">-</span>
					<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">i_FirstChannel</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)))</span> <span class="p">{</span>

			<span class="cm">/* Begin JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>
			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span><span class="o">++</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_FirstChannel</span><span class="p">;</span>
				<span class="n">i</span> <span class="o">&lt;=</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_LastChannel</span><span class="p">;</span>
				<span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">i_APCI3200_GetChannelCalibrationValue</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_ScanValueArray</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
							<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span>
								<span class="n">s_BoardInfos</span>
								<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
								<span class="n">i_FirstChannel</span><span class="p">)</span>
							<span class="o">*</span> <span class="mi">3</span><span class="p">)],</span>
					<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_ScanValueArray</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
							<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span>
								<span class="n">s_BoardInfos</span>
								<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
								<span class="n">i_FirstChannel</span><span class="p">)</span>
							<span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
					<span class="n">ui_ScanValueArray</span><span class="p">[</span><span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span>
							<span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">+</span> <span class="p">((</span><span class="n">i</span> <span class="o">-</span>
								<span class="n">s_BoardInfos</span>
								<span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
								<span class="n">i_FirstChannel</span><span class="p">)</span>
							<span class="o">*</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
			<span class="p">}</span>

			<span class="cm">/* End JK 22.10.2004: APCI-3200 / APCI-3300 Reading of EEPROM values */</span>

			<span class="cm">/* i_Count=-1; */</span>

			<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

			<span class="cm">/* async-&gt;buf_int_count+=(i_LastChannel-i_FirstChannel+4)*sizeof(unsigned int); */</span>
			<span class="cm">/* Begin JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
			<span class="cm">/* async-&gt;buf_int_count+=(s_BoardInfos [dev-&gt;minor].i_LastChannel-s_BoardInfos [dev-&gt;minor].i_FirstChannel+4)*sizeof(unsigned int); */</span>
			<span class="cm">/* End JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
			<span class="cm">/* async-&gt;buf_int_ptr+=(i_LastChannel-i_FirstChannel+4)*sizeof(unsigned int); */</span>
			<span class="cm">/* Begin JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
			<span class="cm">/* async-&gt;buf_int_ptr+=(s_BoardInfos [dev-&gt;minor].i_LastChannel-s_BoardInfos [dev-&gt;minor].i_FirstChannel+4)*sizeof(unsigned int); */</span>
			<span class="cm">/* comedi_eos(dev,s); */</span>

			<span class="cm">/*  Set the event type (Comedi Buffer End Of Scan) */</span>
			<span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">|=</span> <span class="n">COMEDI_CB_EOS</span><span class="p">;</span>

			<span class="cm">/*  Test if enougth memory is available and allocate it for 7 values */</span>
			<span class="cm">/* n = comedi_buf_write_alloc(s-&gt;async, 7*sizeof(unsigned int)); */</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">comedi_buf_write_alloc</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="p">,</span>
				<span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">));</span>

			<span class="cm">/*  If not enough memory available, event is set to Comedi Buffer Error */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="p">((</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)))</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">comedi_buf_write_alloc n = %i&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
				<span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">|=</span> <span class="n">COMEDI_CB_ERROR</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/*  Write all 7 scan values in the comedi buffer */</span>
			<span class="n">comedi_buf_memcpy_to</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span>
				<span class="n">ui_ScanValueArray</span><span class="p">,</span> <span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">));</span>

			<span class="cm">/*  Update comedi buffer pinters indexes */</span>
			<span class="n">comedi_buf_write_free</span><span class="p">(</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">async</span><span class="p">,</span>
				<span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">));</span>

			<span class="cm">/*  Send events */</span>
			<span class="n">comedi_event</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
			<span class="cm">/* End JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>

			<span class="cm">/* BEGIN JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
			<span class="cm">/*  */</span>
			<span class="cm">/* if (s-&gt;async-&gt;buf_int_ptr&gt;=s-&gt;async-&gt;data_len) //  for buffer rool over */</span>
			<span class="cm">/*   { */</span>
			<span class="cm">/*     /* buffer rollover */</span> <span class="err">*/</span>
			<span class="cm">/*     s-&gt;async-&gt;buf_int_ptr=0; */</span>
			<span class="cm">/*     comedi_eobuf(dev,s); */</span>
			<span class="cm">/*   } */</span>
			<span class="cm">/* End JK 18.10.2004: APCI-3200 Driver update 0.7.57 -&gt; 0.7.68 */</span>
		<span class="p">}</span>
		<span class="cm">/* i_Count++; */</span>
		<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_Count</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* i_InterruptFlag=0; */</span>
	<span class="n">s_BoardInfos</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">].</span><span class="n">i_InterruptFlag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
