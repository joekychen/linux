<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › comedi › drivers › addi-data › hwdrv_apci1500.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>hwdrv_apci1500.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">@verbatim</span>

<span class="cm">Copyright (C) 2004,2005  ADDI-DATA GmbH for the source code of this module.</span>

<span class="cm">	ADDI-DATA GmbH</span>
<span class="cm">	Dieselstrasse 3</span>
<span class="cm">	D-77833 Ottersweier</span>
<span class="cm">	Tel: +19(0)7223/9493-0</span>
<span class="cm">	Fax: +49(0)7223/9493-92</span>
<span class="cm">	http://www.addi-data.com</span>
<span class="cm">	info@addi-data.com</span>

<span class="cm">This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</span>

<span class="cm">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>

<span class="cm">You should also find the complete GPL in the COPYING file accompanying this source code.</span>

<span class="cm">@endverbatim</span>
<span class="cm">*/</span>
<span class="cm">/*</span>

<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | (C) ADDI-DATA GmbH          Dieselstraße 3       D-77833 Ottersweier  |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Tel : +49 (0) 7223/9493-0     | email    : info@addi-data.com         |</span>
<span class="cm">  | Fax : +49 (0) 7223/9493-92    | Internet : http://www.addi-data.com   |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project     : APCI-1500       | Compiler   : GCC                      |</span>
<span class="cm">  | Module name : hwdrv_apci1500.c| Version    : 2.96                     |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project manager: Eric Stolz   | Date       :  02/12/2002              |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Description :   Hardware Layer Access For APCI-1500                   |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |                             UPDATES                                   |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  |   Date   |   Author  |          Description of updates                |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  |          |           |                                                |</span>
<span class="cm">  |          |           |                                                |</span>
<span class="cm">  |          |           |                                                |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="cp">#include &quot;hwdrv_apci1500.h&quot;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">i_TimerCounter1Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_TimerCounter2Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_WatchdogCounter3Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_Event1Status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Event2Status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_Logic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_CounterLogic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_InputChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i_TimerCounter1Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_TimerCounter2Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	   <span class="n">i_WatchdogCounter3Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">  +----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_ConfigDigitalInputEvent                 |</span>
<span class="cm">|			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">|                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : An event can be generated for each port.               |</span>
<span class="cm">|                     The first event is related to the first 8 channels     |</span>
<span class="cm">|                     (port 1) and the second to the following 6 channels    |</span>
<span class="cm">|                     (port 2). An interrupt is generated when one or both   |</span>
<span class="cm">|                     events have occurred                                   |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev : Driver handle                     |</span>
<span class="cm">|                     unsigned int *data     : Data Pointer contains             |</span>
<span class="cm">|                                          configuration parameters as below |</span>
<span class="cm">|                                                                            |</span>
<span class="cm">|			  data[0]            :Number of the input port on        |</span>
<span class="cm">|                                         which the event will take place    |</span>
<span class="cm">|                                         (1 or 2)</span>
<span class="cm">|                      data[1]            : The event logic for port 1 has    |</span>
<span class="cm">|                                            three possibilities             |</span>
<span class="cm">|                                        :0  APCI1500_AND       :This logic  |</span>
<span class="cm">|                                                                links       |</span>
<span class="cm">|                                                                the inputs  |</span>
<span class="cm">|                                                                with an AND |</span>
<span class="cm">|                                                                logic.      |</span>
<span class="cm">|                                          1 APCI1500_OR        :This logic  |</span>
<span class="cm">|                                                                links       |</span>
<span class="cm">|                                                                the inputs  |</span>
<span class="cm">|                                                                with a      |</span>
<span class="cm">|                                                                OR logic.   |</span>
<span class="cm">|                                          2    APCI1500_OR_PRIORITY        |</span>
<span class="cm">|								:This logic                          |</span>
<span class="cm">|                                                                links       |</span>
<span class="cm">|                                                                the inputs  |</span>
<span class="cm">|                                                                with a      |</span>
<span class="cm">|                                                                priority    |</span>
<span class="cm">|                                                                OR logic.   |</span>
<span class="cm">|                                                                Input 1     |</span>
<span class="cm">|                                                                has the     |</span>
<span class="cm">|                                                                highest     |</span>
<span class="cm">|                                                                priority    |</span>
<span class="cm">|                                                                level and   |</span>
<span class="cm">|                                                                input   8   |</span>
<span class="cm">|                                                                the smallest|</span>
<span class="cm">|                                            For the second port the user has|</span>
<span class="cm">|                                            1 possibility:                  |</span>
<span class="cm">|                                            APCI1500_OR        :This logic  |</span>
<span class="cm">|                                                                links       |</span>
<span class="cm">|                                                                the inputs  |</span>
<span class="cm">|                                                                with a      |</span>
<span class="cm">|                                                                polarity    |</span>
<span class="cm">|                                                                OR logic    |</span>
<span class="cm">|                     data[2]              : These 8-character word for port1|</span>
<span class="cm">|                                            and 6-character word for port 2 |</span>
<span class="cm">|                                            give the mask of the event.     |</span>
<span class="cm">|                                            Each place gives the state      |</span>
<span class="cm">|                                            of the input channels and can   |</span>
<span class="cm">|                                            have one of these six characters|</span>
<span class="cm">|                                                     |</span>
<span class="cm">|                                       0  : This input must be on 0         |</span>
<span class="cm">|                                       1  : This input must be on 1         |</span>
<span class="cm">|                                       2  : This input reacts to            |</span>
<span class="cm">|                                            a falling edge                  |</span>
<span class="cm">|                                       3  : This input reacts to a          |</span>
<span class="cm">|                                            rising edge                     |</span>
<span class="cm">|                                       4  : This input reacts to both edges |</span>
<span class="cm">|</span>
<span class="cm">|								5  : This input is not               |</span>
<span class="cm">|                                            used for event   				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ConfigDigitalInputEvent</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					      <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					      <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_PatternPolarity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_PatternTransition</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_PatternMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_MaxChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_EventMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_PatternTransitionCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_RegValue</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

      <span class="cm">/*************************************************/</span>
	<span class="cm">/* Selects the master interrupt control register */</span>
      <span class="cm">/*************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
      <span class="cm">/**********************************************/</span>
	<span class="cm">/* Disables  the main interrupt on the board */</span>
      <span class="cm">/**********************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_MaxChannel</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/*  if (data[0] == 1) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">i_MaxChannel</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if(data[0]==2) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified port event  does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if(data[0]==2) */</span>
	<span class="p">}</span>			<span class="cm">/* else  if (data[0] == 1) */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_AND</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_OR</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_OR_PRIORITY</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified interrupt logic does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[1]); */</span>

	<span class="n">i_Logic</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i_Count</span> <span class="o">=</span> <span class="n">i_MaxChannel</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Count</span><span class="o">--</span><span class="p">,</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_EventMask</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">];</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">i_EventMask</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">i_PatternMask</span> <span class="o">=</span>
				<span class="n">i_PatternMask</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span> <span class="n">i_Count</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">i_PatternMask</span> <span class="o">=</span>
				<span class="n">i_PatternMask</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span> <span class="n">i_Count</span><span class="p">));</span>
			<span class="n">i_PatternPolarity</span> <span class="o">=</span>
				<span class="n">i_PatternPolarity</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span>
					<span class="n">i_Count</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">i_PatternMask</span> <span class="o">=</span>
				<span class="n">i_PatternMask</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span> <span class="n">i_Count</span><span class="p">));</span>
			<span class="n">i_PatternTransition</span> <span class="o">=</span>
				<span class="n">i_PatternTransition</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span>
					<span class="n">i_Count</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">i_PatternMask</span> <span class="o">=</span>
				<span class="n">i_PatternMask</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span> <span class="n">i_Count</span><span class="p">));</span>
			<span class="n">i_PatternPolarity</span> <span class="o">=</span>
				<span class="n">i_PatternPolarity</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span>
					<span class="n">i_Count</span><span class="p">));</span>
			<span class="n">i_PatternTransition</span> <span class="o">=</span>
				<span class="n">i_PatternTransition</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span>
					<span class="n">i_Count</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="n">i_PatternTransition</span> <span class="o">=</span>
				<span class="n">i_PatternTransition</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_MaxChannel</span> <span class="o">-</span>
					<span class="n">i_Count</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The option indicated in the event mask does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(i_EventMask) */</span>
	<span class="p">}</span>			<span class="cm">/* for (i_Count = i_MaxChannel; i_Count &gt;0;i_Count --) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		    <span class="cm">/****************************/</span>
		<span class="cm">/* Test the interrupt logic */</span>
		    <span class="cm">/****************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_AND</span> <span class="o">||</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_OR</span> <span class="o">||</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_OR_PRIORITY</span><span class="p">)</span> <span class="p">{</span>
		       <span class="cm">/**************************************/</span>
			<span class="cm">/* Tests if a transition was declared */</span>
			<span class="cm">/* for a OR PRIORITY logic            */</span>
		       <span class="cm">/**************************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_OR_PRIORITY</span>
				<span class="o">&amp;&amp;</span> <span class="n">i_PatternTransition</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			      <span class="cm">/********************************************/</span>
				<span class="cm">/* Transition error on an OR PRIORITY logic */</span>
			      <span class="cm">/********************************************/</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Transition error on an OR PRIORITY logic</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (data[1]== APCI1500_OR_PRIORITY &amp;&amp; i_PatternTransition != 0) */</span>

		       <span class="cm">/*************************************/</span>
			<span class="cm">/* Tests if more than one transition */</span>
			<span class="cm">/* was declared for an AND logic     */</span>
		       <span class="cm">/*************************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_AND</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_Count</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i_Count</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_PatternTransitionCount</span> <span class="o">=</span>
						<span class="n">i_PatternTransitionCount</span> <span class="o">+</span>
						<span class="p">((</span><span class="n">i_PatternTransition</span> <span class="o">&gt;&gt;</span>
							<span class="n">i_Count</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/* for (i_Count = 0; i_Count &lt; 8; i_Count++) */</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_PatternTransitionCount</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				  <span class="cm">/****************************************/</span>
					<span class="cm">/* Transition error on an AND logic     */</span>
				  <span class="cm">/****************************************/</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Transition error on an AND logic</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (i_PatternTransitionCount &gt; 1) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (data[1]== APCI1500_AND) */</span>

			    <span class="cm">/*****************************************************************/</span>
			<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
			    <span class="cm">/*****************************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="cm">/******************/</span>
			<span class="cm">/* Disable Port A */</span>
			    <span class="cm">/******************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0xF0</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="cm">/**********************************************/</span>
			<span class="cm">/* Selects the polarity register of port 1    */</span>
			    <span class="cm">/**********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_PATTERN_POLARITY</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternPolarity</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

			<span class="cm">/*********************************************/</span>
			<span class="cm">/* Selects the pattern mask register of      */</span>
			<span class="cm">/* port 1                                    */</span>
			    <span class="cm">/*********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_PATTERN_MASK</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternMask</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the pattern transition register  */</span>
			<span class="cm">/* of port 1                                */</span>
			    <span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_PATTERN_TRANSITION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternTransition</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		      <span class="cm">/******************************************/</span>
			<span class="cm">/* Selects the mode specification mask    */</span>
			<span class="cm">/* register of port 1                     */</span>
			  <span class="cm">/******************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_RegValue</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		      <span class="cm">/******************************************/</span>
			<span class="cm">/* Selects the mode specification mask    */</span>
			<span class="cm">/* register of port 1                     */</span>
			  <span class="cm">/******************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		      <span class="cm">/**********************/</span>
			<span class="cm">/* Port A new mode    */</span>
			  <span class="cm">/**********************/</span>

			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0xF9</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="mh">0x9</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

			<span class="n">i_Event1Status</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		      <span class="cm">/*****************************************************************/</span>
			<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
			  <span class="cm">/*****************************************************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		      <span class="cm">/*****************/</span>
			<span class="cm">/* Enable Port A */</span>
			  <span class="cm">/*****************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		<span class="p">}</span>		<span class="cm">/*  if(data[1]==APCI1500_AND||data[1]==APCI1500_OR||data[1]==APCI1500_OR_PRIORITY) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The choice for interrupt logic does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  else }// if(data[1]==APCI1500_AND||data[1]==APCI1500_OR||data[1]==APCI1500_OR_PRIORITY) */</span>
	<span class="p">}</span>			<span class="cm">/*    if (data[0]== 1) */</span>

		 <span class="cm">/************************************/</span>
	<span class="cm">/* Test if event setting for port 2 */</span>
		 <span class="cm">/************************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		    <span class="cm">/************************/</span>
		<span class="cm">/* Test the event logic */</span>
		    <span class="cm">/************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_OR</span><span class="p">)</span> <span class="p">{</span>
		       <span class="cm">/*****************************************************************/</span>
			<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/******************/</span>
			<span class="cm">/* Disable Port B */</span>
		       <span class="cm">/******************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0x74</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/****************************************/</span>
			<span class="cm">/* Selects the mode specification mask  */</span>
			<span class="cm">/* register of port B                   */</span>
		       <span class="cm">/****************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_RegValue</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		       <span class="cm">/******************************************/</span>
			<span class="cm">/* Selects the mode specification mask    */</span>
			<span class="cm">/* register of port B                     */</span>
		       <span class="cm">/******************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0xF9</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		       <span class="cm">/**********************************/</span>
			<span class="cm">/* Selects error channels 1 and 2 */</span>
		       <span class="cm">/**********************************/</span>

			<span class="n">i_PatternMask</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_PatternMask</span> <span class="o">|</span> <span class="mh">0xC0</span><span class="p">);</span>
			<span class="n">i_PatternPolarity</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_PatternPolarity</span> <span class="o">|</span> <span class="mh">0xC0</span><span class="p">);</span>
			<span class="n">i_PatternTransition</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_PatternTransition</span> <span class="o">|</span> <span class="mh">0xC0</span><span class="p">);</span>

		       <span class="cm">/**********************************************/</span>
			<span class="cm">/* Selects the polarity register of port 2    */</span>
		       <span class="cm">/**********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_POLARITY</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternPolarity</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/**********************************************/</span>
			<span class="cm">/* Selects the pattern transition register    */</span>
			<span class="cm">/* of port 2                                  */</span>
		       <span class="cm">/**********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_TRANSITION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternTransition</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/**********************************************/</span>
			<span class="cm">/* Selects the pattern Mask register    */</span>
			<span class="cm">/* of port 2                                  */</span>
		       <span class="cm">/**********************************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_MASK</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_PatternMask</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		       <span class="cm">/******************************************/</span>
			<span class="cm">/* Selects the mode specification mask    */</span>
			<span class="cm">/* register of port 2                     */</span>
		       <span class="cm">/******************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_RegValue</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/******************************************/</span>
			<span class="cm">/* Selects the mode specification mask    */</span>
			<span class="cm">/* register of port 2                     */</span>
		       <span class="cm">/******************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0xF9</span><span class="p">)</span> <span class="o">|</span> <span class="mi">4</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

			<span class="n">i_Event2Status</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		       <span class="cm">/*****************************************************************/</span>
			<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************/</span>
			<span class="cm">/* Enable Port B */</span>
		       <span class="cm">/*****************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/*   if (data[1] == APCI1500_OR) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The choice for interrupt logic does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* elseif (data[1] == APCI1500_OR) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[0]==2) */</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_StartStopInputEvent                     |</span>
<span class="cm">|			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">|                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              :  Allows or disallows a port event                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">|		              unsigned int ui_Channel : Channel number to read       |</span>
<span class="cm">|                     unsigned int *data          : Data Pointer to read status  |</span>
<span class="cm">|                      data[0]                 :0 Start input event</span>
<span class="cm">|                                               1 Stop input event</span>
<span class="cm">|                      data[1]                 :No of port (1 or 2)</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_StartStopInputEvent</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_Event1InterruptStatus</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i_Event2InterruptStatus</span> <span class="o">=</span>
		<span class="mi">0</span><span class="p">,</span> <span class="n">i_RegValue</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">START</span>:
	      <span class="cm">/*************************/</span>
		<span class="cm">/* Tests the port number */</span>
	      <span class="cm">/*************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		  <span class="cm">/***************************/</span>
			<span class="cm">/* Test if port 1 selected */</span>
		  <span class="cm">/***************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		    <span class="cm">/*****************************/</span>
				<span class="cm">/* Test if event initialised */</span>
		    <span class="cm">/*****************************/</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_Event1Status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/******************/</span>
					<span class="cm">/* Disable Port A */</span>
		       <span class="cm">/******************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/***************************************************/</span>
					<span class="cm">/* Selects the command and status register of      */</span>
					<span class="cm">/* port 1                                          */</span>
		       <span class="cm">/***************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*************************************/</span>
					<span class="cm">/* Allows the pattern interrupt      */</span>
		       <span class="cm">/*************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xC0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************/</span>
					<span class="cm">/* Enable Port A */</span>
		       <span class="cm">/*****************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">i_Event1InterruptStatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">i_RegValue</span> <span class="o">=</span>
						<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

					<span class="cm">/* Selects the master interrupt control register */</span>
		       <span class="cm">/*************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/**********************************************/</span>
					<span class="cm">/* Authorizes the main interrupt on the board */</span>
		       <span class="cm">/**********************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/*  if(i_Event1Status==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Event 1 not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* else if(i_Event1Status==1) */</span>
			<span class="p">}</span>	<span class="cm">/* if (data[1]==1) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_Event2Status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			    <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
			    <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/******************/</span>
					<span class="cm">/* Disable Port B */</span>
		       <span class="cm">/******************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0x74</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/***************************************************/</span>
					<span class="cm">/* Selects the command and status register of      */</span>
					<span class="cm">/* port 2                                          */</span>
		       <span class="cm">/***************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*************************************/</span>
					<span class="cm">/* Allows the pattern interrupt      */</span>
		       <span class="cm">/*************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xC0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************/</span>
					<span class="cm">/* Enable Port B */</span>
		       <span class="cm">/*****************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

					<span class="cm">/* Selects the master interrupt control register */</span>
		       <span class="cm">/*************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/**********************************************/</span>
					<span class="cm">/* Authorizes the main interrupt on the board */</span>
		       <span class="cm">/**********************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">i_Event2InterruptStatus</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_Event2Status==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Event 2 not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* else if(i_Event2Status==1) */</span>
			<span class="p">}</span>	<span class="cm">/*  if(data[1]==2) */</span>
		<span class="p">}</span>		<span class="cm">/*  if (data[1] == 1 || data[0] == 2) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The port parameter is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if (data[1] == 1 || data[0] == 2) */</span>

		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">STOP</span>:
		  <span class="cm">/*************************/</span>
		<span class="cm">/* Tests the port number */</span>
		  <span class="cm">/*************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		  <span class="cm">/***************************/</span>
			<span class="cm">/* Test if port 1 selected */</span>
		  <span class="cm">/***************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		    <span class="cm">/*****************************/</span>
				<span class="cm">/* Test if event initialised */</span>
		    <span class="cm">/*****************************/</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_Event1Status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/******************/</span>
					<span class="cm">/* Disable Port A */</span>
		       <span class="cm">/******************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/***************************************************/</span>
					<span class="cm">/* Selects the command and status register of      */</span>
					<span class="cm">/* port 1                                          */</span>
		       <span class="cm">/***************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*************************************/</span>
					<span class="cm">/* Inhibits the pattern interrupt      */</span>
		       <span class="cm">/*************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************/</span>
					<span class="cm">/* Enable Port A */</span>
		       <span class="cm">/*****************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">i_Event1InterruptStatus</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_Event1Status==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Event 1 not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* else if(i_Event1Status==1) */</span>
			<span class="p">}</span>	<span class="cm">/* if (data[1]==1) */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			 <span class="cm">/*****************************/</span>
				<span class="cm">/* Test if event initialised */</span>
			 <span class="cm">/*****************************/</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_Event2Status</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			  <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
			  <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			  <span class="cm">/******************/</span>
					<span class="cm">/* Disable Port B */</span>
			  <span class="cm">/******************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0x74</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			  <span class="cm">/***************************************************/</span>
					<span class="cm">/* Selects the command and status register of      */</span>
					<span class="cm">/* port 2                                         */</span>
			  <span class="cm">/***************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*************************************/</span>
					<span class="cm">/* Inhibits the pattern interrupt      */</span>
		       <span class="cm">/*************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="cm">/* Selects the APCI1500_RW_MASTER_CONFIGURATION_CONTROL register */</span>
		       <span class="cm">/*****************************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		       <span class="cm">/*****************/</span>
					<span class="cm">/* Enable Port B */</span>
		       <span class="cm">/*****************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">i_Event2InterruptStatus</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_Event2Status==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Event 2 not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* else if(i_Event2Status==1) */</span>
			<span class="p">}</span>	<span class="cm">/* if(data[1]==2) */</span>

		<span class="p">}</span>		<span class="cm">/*  if (data[1] == 1 || data[1] == 2) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The port parameter is in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if (data[1] == 1 || data[1] == 2) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The option of START/STOP logic does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[0]) */</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_Initialisation                          |</span>
<span class="cm">|			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">|                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Return the status of the digital input                 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">|		              unsigned int ui_Channel : Channel number to read       |</span>
<span class="cm">|                     unsigned int *data          : Data Pointer to read status  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_Initialisation</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_DummyRead</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="cm">/******************/</span>
	<span class="cm">/* Software reset */</span>
    <span class="cm">/******************/</span>
	<span class="n">i_DummyRead</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_DummyRead</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the master configuration control register */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the mode specification register of port A */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/* Selects the data path polarity register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* High level of port A means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/* Selects the data direction register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/*  Selects the command and status register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of port A:  */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the handshake specification register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_HANDSHAKE_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes the register */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the mode specification register of port B */</span>
	 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data path polarity register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* A high level of port B means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x7F</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data direction register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of port B:         */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the handshake specification register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_HANDSHAKE_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes the register */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	   <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the data path polarity register of port C */</span>
	   <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* High level of port C means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x9</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data direction register of port C */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs except channel 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0E</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the special IO register of port C */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_SPECIAL_IO_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes it */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	   <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
	   <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of timer 1         */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	   <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
	   <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates Timer 2 interrupt management:               */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	  <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 3 */</span>
	  <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of Timer 3 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates interrupt management of timer 3:            */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/*************************************************/</span>
	<span class="cm">/* Selects the master interrupt control register */</span>
	 <span class="cm">/*************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes all interrupts */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_ReadMoreDigitalInput                    |</span>
<span class="cm">|			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">|                     struct comedi_insn *insn,unsigned int *data)                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Return the status of the Requested digital inputs      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">|                     unsigned int ui_NoOfChannels    : No Of Channels To be Read    |</span>
<span class="cm">|                      unsigned int *data             : Data Pointer</span>
<span class="cm">|                      data[0]                 : 0 Read a single channel</span>
<span class="cm">|                                                1 read a port value</span>
<span class="cm">|                      data[1]                 : port value</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--	data[0]    :The read status value</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ReadMoreDigitalInput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_PortValue</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Mask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Channel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_TmpValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ui_Channel</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">ui_Channel</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ui_TmpValue</span> <span class="o">=</span>
				<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">inw</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span>
				<span class="n">APCI1500_DIGITAL_IP</span><span class="p">);</span>
			<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">ui_TmpValue</span> <span class="o">&gt;&gt;</span> <span class="n">ui_Channel</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if(ui_Channel &gt;= 0 &amp;&amp; ui_Channel &lt;=15) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The channel specification are in error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>
		<span class="p">}</span>		<span class="cm">/* else if(ui_Channel &gt;= 0 &amp;&amp; ui_Channel &lt;=15) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:

		<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">inw</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span>
			<span class="n">APCI1500_DIGITAL_IP</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">ui_Channel</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">ui_Mask</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ui_PortValue</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">ui_Mask</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="n">ui_Mask</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
			<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">ui_PortValue</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">ui_Mask</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">8</span>:
			<span class="n">ui_Mask</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
			<span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">ui_PortValue</span><span class="p">))</span> <span class="o">&amp;</span> <span class="n">ui_Mask</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">15</span>:
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel cannot be read </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(ui_Channel) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified functionality does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[0]) */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_ConfigDigitalOutputErrorInterrupt</span>
<span class="cm">|                      (struct comedi_device *dev,struct comedi_subdevice *s struct comedi_insn</span>
<span class="cm">|                      *insn,unsigned int *data)                                  |</span>
<span class="cm">|				                                                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Configures the digital output memory and the digital</span>
<span class="cm">|                      output error interrupt                                 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev : Driver handle                     |</span>
<span class="cm">|                     unsigned int *data         : Data Pointer contains         |</span>
<span class="cm">|                                          configuration parameters as below |</span>
<span class="cm">|                      struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                       struct comedi_insn *insn      :pointer to insn structure                                                                                                                |</span>
<span class="cm">|					  data[0]  :1:Memory on                          |</span>
<span class="cm">|					            0:Memory off                         |</span>
<span class="cm">|                              data[1]  :1 Enable the voltage error interrupt</span>
<span class="cm">|							   :0 Disable the voltage error interrupt 		                                                                                                    |</span>
<span class="cm">|																	 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ConfigDigitalOutputErrorInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
							<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
							<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
							<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">b_OutputMemoryStatus</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_WriteDigitalOutput                      |</span>
<span class="cm">|			  (struct comedi_device *dev,struct comedi_subdevice *s,               |</span>
<span class="cm">|                      struct comedi_insn *insn,unsigned int *data)                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Writes port value  To the selected port                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">|                     unsigned int ui_NoOfChannels    : No Of Channels To Write      |</span>
<span class="cm">|                     unsigned int *data              : Data Pointer to read status  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_WriteDigitalOutput</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp1</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_NoOfChannel</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>	<span class="cm">/*  get the channel */</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">b_OutputMemoryStatus</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ui_Temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span>			<span class="cm">/* if(!devpriv-&gt;b_OutputMemoryStatus ) */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
			<span class="n">outw</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span> <span class="n">APCI1500_DIGITAL_OP</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* if(data[1]==0) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">case</span> <span class="mi">2</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
						<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span>
							<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="k">case</span> <span class="mi">4</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
						<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span>
							<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="k">case</span> <span class="mi">8</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
						<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span>
							<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="k">case</span> <span class="mi">15</span>:
					<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">ui_Temp</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>

				<span class="nl">default:</span>
					<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot; chan spec wrong&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>

				<span class="p">}</span>	<span class="cm">/* switch(ui_NoOfChannels) */</span>

				<span class="n">outw</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span>
					<span class="n">APCI1500_DIGITAL_OP</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/*  if(data[1]==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* else if(data[1]==1) */</span>
		<span class="p">}</span>		<span class="cm">/* elseif(data[1]==0) */</span>
	<span class="p">}</span>			<span class="cm">/* if(data[3]==0) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
				<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">;</span>
				<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
					<span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="o">^</span>
					<span class="mh">0xffffffff</span><span class="p">;</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>
				<span class="n">outw</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span>
					<span class="n">APCI1500_DIGITAL_OP</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if(data[1]==0) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">switch</span> <span class="p">(</span><span class="n">ui_NoOfChannel</span><span class="p">)</span> <span class="p">{</span>

					<span class="k">case</span> <span class="mi">2</span>:
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span>
							<span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
						<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span>
									<span class="n">data</span>
									<span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">^</span>
							<span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>

					<span class="k">case</span> <span class="mi">4</span>:
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span>
							<span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
						<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span>
									<span class="n">data</span>
									<span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">^</span>
							<span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>

					<span class="k">case</span> <span class="mi">8</span>:
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
						<span class="n">ui_Temp1</span> <span class="o">=</span>
							<span class="n">ui_Temp1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
						<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">ui_Temp</span> <span class="o">|</span> <span class="n">ui_Temp1</span><span class="p">;</span>
						<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
							<span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span>
									<span class="n">data</span>
									<span class="p">[</span><span class="mi">2</span><span class="p">]))</span> <span class="o">^</span>
							<span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ui_Temp</span><span class="p">;</span>
						<span class="k">break</span><span class="p">;</span>

					<span class="k">case</span> <span class="mi">15</span>:
						<span class="k">break</span><span class="p">;</span>

					<span class="nl">default:</span>
						<span class="n">comedi_error</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
							<span class="s">&quot; chan spec wrong&quot;</span><span class="p">);</span>
						<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>	<span class="cm">/*  &quot;sorry channel spec wrong &quot; */</span>

					<span class="p">}</span>	<span class="cm">/* switch(ui_NoOfChannels) */</span>

					<span class="n">outw</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span>
						<span class="n">APCI1500_DIGITAL_OP</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/*  if(data[1]==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified channel not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* else if(data[1]==1) */</span>
			<span class="p">}</span>	<span class="cm">/* elseif(data[1]==0) */</span>
		<span class="p">}</span>		<span class="cm">/* if(data[3]==1); */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Specified functionality does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if else data[3]==1) */</span>
	<span class="p">}</span>			<span class="cm">/* if else data[3]==0) */</span>
	<span class="n">ui_Temp</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_ConfigCounterTimerWatchdog(comedi_device</span>
<span class="cm">|                   *dev,struct comedi_subdevice *s,struct comedi_insn *insn,unsigned int *data)|</span>
<span class="cm">|				                                                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Configures The Watchdog                                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev      : Driver handle                |</span>
<span class="cm">|                     struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                      struct comedi_insn *insn      :pointer to insn structure      |</span>
<span class="cm">|                     unsigned int *data         : Data Pointer to read status                                                       data[0]                : 2     APCI1500_1_8_KHZ</span>
<span class="cm">|                                              1     APCI1500_3_6_KHZ        |</span>
<span class="cm">|                                              0     APCI1500_115_KHZ</span>
<span class="cm">|                      data[1]                : 0     Counter1/Timer1</span>
<span class="cm">|                                               1     Counter2/Timer2</span>
<span class="cm">|                                               2     Counter3/Watchdog</span>
<span class="cm">|                      data[2]                : 0     Counter</span>
<span class="cm">|                                               1     Timer/Watchdog</span>
<span class="cm">|                      data[3]                :         This parameter has    |</span>
<span class="cm">|                                                      two meanings.         |</span>
<span class="cm">|                                                    - If the counter/timer  |</span>
<span class="cm">|                                                      is used as a counter  |</span>
<span class="cm">|                                                      the limit value of    |</span>
<span class="cm">|                                                      the counter is given  |</span>
<span class="cm">|                                                                            |</span>
<span class="cm">|                                                    - If the counter/timer  |</span>
<span class="cm">|                                                      is used as a timer,   |</span>
<span class="cm">|                                                      the divider factor    |</span>
<span class="cm">|                                                      for the output is     |</span>
<span class="cm">|                                                      given.</span>
<span class="cm">|                       data[4]                 : 0    APCI1500_CONTINUOUS</span>
<span class="cm">|                                                 1    APCI1500_SINGLE</span>
<span class="cm">|                       data[5]                 : 0    Software Trigger</span>
<span class="cm">|                                                 1    Hardware Trigger</span>
<span class="cm">|</span>
<span class="cm">|                       data[6]                  :0    Software gate</span>
<span class="cm">|                                                 1    Hardware gate</span>
<span class="cm">|                       data[7]                  :0    Interrupt Disable</span>
<span class="cm">|                                                 1    Interrupt Enable</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ConfigCounterTimerWatchdog</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
						 <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
						 <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
						 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_TimerCounterMode</span><span class="p">,</span> <span class="n">i_MasterConfiguration</span><span class="p">;</span>

	<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span> <span class="o">=</span> <span class="n">current</span><span class="p">;</span>

<span class="cm">/* Selection of the input clock */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">outw</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span> <span class="n">APCI1500_CLK_SELECT</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/*  if(data[0]==0||data[0]==1||data[0]==2) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The option for input clock selection does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if(data[0]!=3) */</span>
	<span class="p">}</span>			<span class="cm">/* elseif(data[0]==0||data[0]==1||data[0]==2) */</span>
	<span class="cm">/* Select the counter/timer */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">COUNTER1</span>:
		<span class="cm">/* selecting counter or timer */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_COUNTER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_TIMER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice is not a timer nor a counter</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[2]) */</span>

		<span class="cm">/* Selecting  single or continuous mode */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_CONTINUOUS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SINGLE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This option for single/continuous mode does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[4]) */</span>

		<span class="n">i_TimerCounterMode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|</span> <span class="mi">7</span><span class="p">;</span>
			 <span class="cm">/*************************/</span>
		<span class="cm">/* Test the reload value */</span>
			 <span class="cm">/*************************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_ENABLE</span>
				<span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_DISABLE</span><span class="p">)</span> <span class="p">{</span>

				<span class="cm">/************************************************/</span>
				<span class="cm">/* Selects the mode register of timer/counter 1 */</span>
				<span class="cm">/************************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_MODE_SPECIFICATION</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="cm">/***********************/</span>
				<span class="cm">/* Writes the new mode */</span>
				<span class="cm">/***********************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_TimerCounterMode</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of timer/counter 1 */</span>
				<span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_TIME_CST_LOW</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/*************************/</span>
				<span class="cm">/* Writes the low value  */</span>
				  <span class="cm">/*************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				   <span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of timer/counter 1 */</span>
				   <span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_TIME_CST_HIGH</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/**************************/</span>
				<span class="cm">/* Writes the high value  */</span>
				  <span class="cm">/**************************/</span>

				<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				     <span class="cm">/*********************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/**********************/</span>
				<span class="cm">/* Reads the register */</span>
				     <span class="cm">/**********************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				       <span class="cm">/********************************************************/</span>
				<span class="cm">/* Enables timer/counter 1 and triggers timer/counter 1 */</span>
				       <span class="cm">/********************************************************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">i_MasterConfiguration</span> <span class="o">|</span> <span class="mh">0x40</span><span class="p">;</span>

				    <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				    <span class="cm">/*********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/********************************/</span>
				<span class="cm">/* Writes the new configuration */</span>
				      <span class="cm">/********************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_MasterConfiguration</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					 <span class="cm">/****************************************/</span>
				<span class="cm">/* Selects the commands register of     */</span>
				<span class="cm">/* timer/counter 1                      */</span>
					 <span class="cm">/****************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				       <span class="cm">/***************************/</span>
				<span class="cm">/* Disable timer/counter 1 */</span>
				       <span class="cm">/***************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					  <span class="cm">/****************************************/</span>
				<span class="cm">/* Selects the commands register of     */</span>
				<span class="cm">/* timer/counter 1                      */</span>
					  <span class="cm">/****************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/***************************/</span>
				<span class="cm">/* Trigger timer/counter 1 */</span>
				      <span class="cm">/***************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="mh">0x2</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of interrupt enable or disable</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
		<span class="p">}</span>		<span class="cm">/*  if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of reload value</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
		<span class="n">i_TimerCounter1Init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">COUNTER2</span>:		<span class="cm">/* selecting counter or timer */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_COUNTER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_TIMER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice is not a timer nor a counter</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[2]) */</span>

		<span class="cm">/* Selecting  single or continuous mode */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_CONTINUOUS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SINGLE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This option for single/continuous mode does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[4]) */</span>

		<span class="cm">/* Selecting  software or hardware trigger */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SOFTWARE_TRIGGER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_HARDWARE_TRIGGER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice for software or hardware trigger does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[5]) */</span>

		<span class="cm">/* Selecting  software or hardware gate */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SOFTWARE_GATE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_HARDWARE_GATE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice for software or hardware gate does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[6]) */</span>

		<span class="n">i_TimerCounterMode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">|</span> <span class="mi">7</span><span class="p">;</span>

			     <span class="cm">/*************************/</span>
		<span class="cm">/* Test the reload value */</span>
			     <span class="cm">/*************************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_ENABLE</span>
				<span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_DISABLE</span><span class="p">)</span> <span class="p">{</span>

				<span class="cm">/************************************************/</span>
				<span class="cm">/* Selects the mode register of timer/counter 2 */</span>
				<span class="cm">/************************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_MODE_SPECIFICATION</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="cm">/***********************/</span>
				<span class="cm">/* Writes the new mode */</span>
				<span class="cm">/***********************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_TimerCounterMode</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of timer/counter 2 */</span>
				<span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_TIME_CST_LOW</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/*************************/</span>
				<span class="cm">/* Writes the low value  */</span>
				  <span class="cm">/*************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				   <span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of timer/counter 2 */</span>
				   <span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_TIME_CST_HIGH</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/**************************/</span>
				<span class="cm">/* Writes the high value  */</span>
				  <span class="cm">/**************************/</span>

				<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				     <span class="cm">/*********************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/**********************/</span>
				<span class="cm">/* Reads the register */</span>
				     <span class="cm">/**********************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				       <span class="cm">/********************************************************/</span>
				<span class="cm">/* Enables timer/counter 2 and triggers timer/counter 2 */</span>
				       <span class="cm">/********************************************************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">i_MasterConfiguration</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>

				    <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				    <span class="cm">/*********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/********************************/</span>
				<span class="cm">/* Writes the new configuration */</span>
				      <span class="cm">/********************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_MasterConfiguration</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					 <span class="cm">/****************************************/</span>
				<span class="cm">/* Selects the commands register of     */</span>
				<span class="cm">/* timer/counter 2                      */</span>
					 <span class="cm">/****************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				       <span class="cm">/***************************/</span>
				<span class="cm">/* Disable timer/counter 2 */</span>
				       <span class="cm">/***************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					  <span class="cm">/****************************************/</span>
				<span class="cm">/* Selects the commands register of     */</span>
				<span class="cm">/* timer/counter 2                      */</span>
					  <span class="cm">/****************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/***************************/</span>
				<span class="cm">/* Trigger timer/counter 1 */</span>
				      <span class="cm">/***************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="mh">0x2</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of interrupt enable or disable</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
		<span class="p">}</span>		<span class="cm">/*  if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of reload value</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
		<span class="n">i_TimerCounter2Init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">COUNTER3</span>:		<span class="cm">/* selecting counter or watchdog */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_COUNTER</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_WATCHDOG</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice is not a watchdog nor a counter</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[2]) */</span>

		<span class="cm">/* Selecting  single or continuous mode */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_CONTINUOUS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SINGLE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This option for single/continuous mode does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[4]) */</span>

		<span class="cm">/* Selecting  software or hardware gate */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_SOFTWARE_GATE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">APCI1500_HARDWARE_GATE</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">This choice for software or hardware gate does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  switch(data[6]) */</span>

		      <span class="cm">/*****************************/</span>
		<span class="cm">/* Test if used for watchdog */</span>
			  <span class="cm">/*****************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_WATCHDOG</span><span class="p">)</span> <span class="p">{</span>
			     <span class="cm">/*****************************/</span>
			<span class="cm">/* - Enables the output line */</span>
			<span class="cm">/* - Enables retrigger       */</span>
			<span class="cm">/* - Pulses output           */</span>
			     <span class="cm">/*****************************/</span>
			<span class="n">i_TimerCounterMode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|</span> <span class="mh">0x54</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if (data[2] == APCI1500_WATCHDOG) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">i_TimerCounterMode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">|</span> <span class="mi">7</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* elseif (data[2] == APCI1500_WATCHDOG) */</span>
				 <span class="cm">/*************************/</span>
		<span class="cm">/* Test the reload value */</span>
			     <span class="cm">/*************************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_ENABLE</span>
				<span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_DISABLE</span><span class="p">)</span> <span class="p">{</span>

				<span class="cm">/************************************************/</span>
				<span class="cm">/* Selects the mode register of watchdog/counter 3 */</span>
				<span class="cm">/************************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_MODE_SPECIFICATION</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="cm">/***********************/</span>
				<span class="cm">/* Writes the new mode */</span>
				<span class="cm">/***********************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_TimerCounterMode</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of watchdog/counter 3 */</span>
				<span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_TIME_CST_LOW</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/*************************/</span>
				<span class="cm">/* Writes the low value  */</span>
				  <span class="cm">/*************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				   <span class="cm">/****************************************************/</span>
				<span class="cm">/* Selects the constant register of watchdog/counter 3 */</span>
				   <span class="cm">/****************************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_TIME_CST_HIGH</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				  <span class="cm">/**************************/</span>
				<span class="cm">/* Writes the high value  */</span>
				  <span class="cm">/**************************/</span>

				<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				     <span class="cm">/*********************************************/</span>

				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				     <span class="cm">/**********************/</span>
				<span class="cm">/* Reads the register */</span>
				     <span class="cm">/**********************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				       <span class="cm">/********************************************************/</span>
				<span class="cm">/* Enables watchdog/counter 3 and triggers watchdog/counter 3 */</span>
				       <span class="cm">/********************************************************/</span>

				<span class="n">i_MasterConfiguration</span> <span class="o">=</span>
					<span class="n">i_MasterConfiguration</span> <span class="o">|</span> <span class="mh">0x10</span><span class="p">;</span>

				    <span class="cm">/*********************************************/</span>
				<span class="cm">/* Selects the master configuration register */</span>
				    <span class="cm">/*********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/********************************/</span>
				<span class="cm">/* Writes the new configuration */</span>
				      <span class="cm">/********************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_MasterConfiguration</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				      <span class="cm">/********************/</span>
				<span class="cm">/* Test if COUNTER */</span>
					  <span class="cm">/********************/</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">APCI1500_COUNTER</span><span class="p">)</span> <span class="p">{</span>

					    <span class="cm">/*************************************/</span>
					<span class="cm">/* Selects the command register of   */</span>
					<span class="cm">/* watchdog/counter 3                */</span>
						 <span class="cm">/*************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					      <span class="cm">/*************************************************/</span>
					<span class="cm">/* Disable the  watchdog/counter 3 and starts it */</span>
						  <span class="cm">/*************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

					      <span class="cm">/*************************************/</span>
					<span class="cm">/* Selects the command register of   */</span>
					<span class="cm">/* watchdog/counter 3                */</span>
						  <span class="cm">/*************************************/</span>

					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					     <span class="cm">/*************************************************/</span>
					<span class="cm">/* Trigger the  watchdog/counter 3 and starts it */</span>
						 <span class="cm">/*************************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0x2</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="p">}</span>	<span class="cm">/* elseif(data[2]==APCI1500_COUNTER) */</span>

			<span class="p">}</span>	<span class="cm">/* if(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of interrupt enable or disable</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(data[7]== APCI1500_ENABLE ||data[7]== APCI1500_DISABLE) */</span>
		<span class="p">}</span>		<span class="cm">/*  if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error in selection of reload value</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if ((data[3]&gt;= 0) &amp;&amp; (data[3] &lt;= 65535)) */</span>
		<span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
		<span class="n">i_WatchdogCounter3Init</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified counter</span><span class="se">\t</span><span class="s">imer option does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[1]) */</span>
	<span class="n">i_CounterLogic</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_StartStopTriggerTimerCounterWatchdog      |</span>
<span class="cm">|				(struct comedi_device *dev,struct comedi_subdevice *s,</span>
<span class="cm">|                         struct comedi_insn *insn,unsigned int *data);                  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Start / Stop or trigger the timer counter or Watchdog  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev     : Driver handle                 |</span>
<span class="cm">|                     struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                      struct comedi_insn *insn      :pointer to insn structure      |</span>
<span class="cm">|                     unsigned int *data         : Data Pointer to read status   |</span>
<span class="cm">|                      data[0]                : 0     Counter1/Timer1</span>
<span class="cm">|                                               1     Counter2/Timer2</span>
<span class="cm">|                                               2     Counter3/Watchdog</span>
<span class="cm">|                      data[1]                : 0     start</span>
<span class="cm">|                                               1     stop</span>
<span class="cm">|                                               2     Trigger</span>
<span class="cm">|                      data[2]                : 0     Counter</span>
<span class="cm">|                                               1     Timer/Watchdog</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_StartStopTriggerTimerCounterWatchdog</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
							   <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
							   <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
							   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_CommandAndStatusValue</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">COUNTER1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">START</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter1Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC4</span><span class="p">;</span>	<span class="cm">/* Enable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_TimerCounterWatchdogInterrupt==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xE4</span><span class="p">;</span>	<span class="cm">/* disable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounterWatchdogInterrupt==1) */</span>
					      <span class="cm">/**************************/</span>
				<span class="cm">/* Starts timer/counter 1 */</span>
					      <span class="cm">/**************************/</span>
				<span class="n">i_TimerCounter1Enabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="cm">/********************************************/</span>
				<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter1Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Counter/Timer1 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">STOP</span>:

					      <span class="cm">/**************************/</span>
			<span class="cm">/* Stop timer/counter 1 */</span>
					      <span class="cm">/**************************/</span>

						<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_TimerCounter1Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">TRIGGER</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter1Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter1Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						 <span class="cm">/************************/</span>
					<span class="cm">/* Set Trigger and gate */</span>
						 <span class="cm">/************************/</span>

					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x6</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter1Enabled==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
						   <span class="cm">/***************/</span>
					<span class="cm">/* Set Trigger */</span>
						   <span class="cm">/***************/</span>

					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounter1Enabled==1) */</span>

						<span class="cm">/********************************************/</span>
				<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter1Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Counter/Timer1 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified option for start/stop/trigger does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(data[1]) */</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">COUNTER2</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">START</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter2Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC4</span><span class="p">;</span>	<span class="cm">/* Enable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_TimerCounterWatchdogInterrupt==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xE4</span><span class="p">;</span>	<span class="cm">/* disable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounterWatchdogInterrupt==1) */</span>
					      <span class="cm">/**************************/</span>
				<span class="cm">/* Starts timer/counter 2 */</span>
					      <span class="cm">/**************************/</span>
				<span class="n">i_TimerCounter2Enabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="cm">/********************************************/</span>
				<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter2Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Counter/Timer2 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">STOP</span>:

					      <span class="cm">/**************************/</span>
			<span class="cm">/* Stop timer/counter 2 */</span>
					      <span class="cm">/**************************/</span>

						<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_TimerCounter2Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TRIGGER</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter2Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter2Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						 <span class="cm">/************************/</span>
					<span class="cm">/* Set Trigger and gate */</span>
						 <span class="cm">/************************/</span>

					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x6</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter2Enabled==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
						   <span class="cm">/***************/</span>
					<span class="cm">/* Set Trigger */</span>
						   <span class="cm">/***************/</span>

					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounter2Enabled==1) */</span>

						<span class="cm">/********************************************/</span>
				<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter2Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Counter/Timer2 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified option for start/stop/trigger does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(data[1]) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COUNTER3</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">START</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC4</span><span class="p">;</span>	<span class="cm">/* Enable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/*  if(i_TimerCounterWatchdogInterrupt==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xE4</span><span class="p">;</span>	<span class="cm">/* disable the interrupt */</span>
				<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounterWatchdogInterrupt==1) */</span>
					      <span class="cm">/**************************/</span>
				<span class="cm">/* Starts Watchdog/counter 3 */</span>
					      <span class="cm">/**************************/</span>
				<span class="n">i_WatchdogCounter3Enabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
						<span class="cm">/********************************************/</span>
				<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

			<span class="p">}</span>	<span class="cm">/*  if( i_WatchdogCounter3init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Watchdog/Counter3 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">STOP</span>:

					      <span class="cm">/**************************/</span>
			<span class="cm">/* Stop Watchdog/counter 3 */</span>
					      <span class="cm">/**************************/</span>

						<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_WatchdogCounter3Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">TRIGGER</span>:
			<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">0</span>:	<span class="cm">/* triggering counter 3 */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
							       <span class="cm">/************************/</span>
						<span class="cm">/* Set Trigger and gate */</span>
							       <span class="cm">/************************/</span>

						<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* if( i_WatchdogCounter3Enabled==1) */</span>
					<span class="k">else</span> <span class="p">{</span>
							   <span class="cm">/***************/</span>
						<span class="cm">/* Set Trigger */</span>
							   <span class="cm">/***************/</span>

						<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/* elseif(i_WatchdogCounter3Enabled==1) */</span>

						<span class="cm">/********************************************/</span>
					<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* if( i_WatchdogCounter3Init==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Counter3 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">1</span>:
				<span class="cm">/* triggering Watchdog 3 */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

						<span class="cm">/********************************************/</span>
					<span class="cm">/* Selects the commands and status register */</span>
						<span class="cm">/********************************************/</span>
					<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
					<span class="n">outb</span><span class="p">(</span><span class="mh">0x6</span><span class="p">,</span>
						<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
						<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="p">}</span>	<span class="cm">/* if( i_WatchdogCounter3Init==1) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Watchdog 3 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Wrong choice of watchdog/counter3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* switch(data[2]) */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified option for start/stop/trigger does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* switch(data[1]) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The specified choice for counter/watchdog/timer does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[0]) */</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_ReadCounterTimerWatchdog                |</span>
<span class="cm">|			(struct comedi_device *dev,struct comedi_subdevice *s,struct comedi_insn *insn,</span>
<span class="cm">|                    unsigned int *data); 	                                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read The Watchdog                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :   struct comedi_device *dev      : Driver handle              |</span>
<span class="cm">|                     struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                      struct comedi_insn *insn      :pointer to insn structure      |</span>
<span class="cm">|                     unsigned int *data          : Data Pointer to read status  |</span>
<span class="cm">|                      data[0]                : 0     Counter1/Timer1</span>
<span class="cm">|                                               1     Counter2/Timer2</span>
<span class="cm">|                                               2     Counter3/Watchdog</span>
<span class="cm">|</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ReadCounterTimerWatchdog</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_CommandAndStatusValue</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">COUNTER1</span>:
		<span class="cm">/* Read counter/timer1 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter1Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter1Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		  <span class="cm">/************************/</span>
				<span class="cm">/* Set RCC and gate */</span>
		  <span class="cm">/************************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter1Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
		    <span class="cm">/***************/</span>
				<span class="cm">/* Set RCC */</span>
		    <span class="cm">/***************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x8</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounter1Init==1) */</span>

		<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
		<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		 <span class="cm">/***************************************/</span>
			<span class="cm">/* Selects the counter register (high) */</span>
		 <span class="cm">/***************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR1_VALUE_HIGH</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR1_VALUE_LOW</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* if( i_TimerCounter1Init==1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Timer/Counter1 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* elseif( i_TimerCounter1Init==1) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COUNTER2</span>:
		<span class="cm">/* Read counter/timer2 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter2Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_TimerCounter2Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		  <span class="cm">/************************/</span>
				<span class="cm">/* Set RCC and gate */</span>
		  <span class="cm">/************************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter2Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
		    <span class="cm">/***************/</span>
				<span class="cm">/* Set RCC */</span>
		    <span class="cm">/***************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x8</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_TimerCounter2Init==1) */</span>

		<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
		<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		 <span class="cm">/***************************************/</span>
			<span class="cm">/* Selects the counter register (high) */</span>
		 <span class="cm">/***************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR2_VALUE_HIGH</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR2_VALUE_LOW</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* if( i_TimerCounter2Init==1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Timer/Counter2 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* elseif( i_TimerCounter2Init==1) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">COUNTER3</span>:
		<span class="cm">/* Read counter/watchdog2 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Init</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_WatchdogCounter3Enabled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		  <span class="cm">/************************/</span>
				<span class="cm">/* Set RCC and gate */</span>
		  <span class="cm">/************************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0xC</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if( i_TimerCounter2Init==1) */</span>
			<span class="k">else</span> <span class="p">{</span>
		    <span class="cm">/***************/</span>
				<span class="cm">/* Set RCC */</span>
		    <span class="cm">/***************/</span>

				<span class="n">i_CommandAndStatusValue</span> <span class="o">=</span> <span class="mh">0x8</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_WatchdogCounter3Init==1) */</span>

		<span class="cm">/********************************************/</span>
			<span class="cm">/* Selects the commands and status register */</span>
		<span class="cm">/********************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_CommandAndStatusValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

		 <span class="cm">/***************************************/</span>
			<span class="cm">/* Selects the counter register (high) */</span>
		 <span class="cm">/***************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR3_VALUE_HIGH</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_R_CPT_TMR3_VALUE_LOW</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="p">}</span>		<span class="cm">/* if( i_WatchdogCounter3Init==1) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">WatchdogCounter3 not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* elseif( i_WatchdogCounter3Init==1) */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The choice of timer/counter/watchdog does not exist</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* switch(data[0]) */</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int  i_APCI1500_ReadInterruptMask                      |</span>
<span class="cm">|			(struct comedi_device *dev,struct comedi_subdevice *s,struct comedi_insn *insn,</span>
<span class="cm">|                    unsigned int *data); 	                                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read the interrupt mask                                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :   struct comedi_device *dev      : Driver handle              |</span>
<span class="cm">|                     struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                      struct comedi_insn *insn      :pointer to insn structure      |</span>
<span class="cm">|                     unsigned int *data          : Data Pointer to read status  |</span>


<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--	data[0]:The interrupt mask value												                           data[1]:Channel no</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ReadInterruptMask</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_InterruptMask</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_InputChannel</span><span class="p">;</span>
	<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int  i_APCI1500_ConfigureInterrupt                     |</span>
<span class="cm">|			(struct comedi_device *dev,struct comedi_subdevice *s,struct comedi_insn *insn,</span>
<span class="cm">|                    unsigned int *data); 	                                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Configures the interrupt registers                     |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :   struct comedi_device *dev      : Driver handle              |</span>
<span class="cm">|                     struct comedi_subdevice *s,   :pointer to subdevice structure</span>
<span class="cm">|                      struct comedi_insn *insn      :pointer to insn structure      |</span>
<span class="cm">|                     unsigned int *data          : Data Pointer                 |</span>
<span class="cm">|</span>

<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_ConfigureInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Status</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_RegValue</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_Constant</span><span class="p">;</span>
	<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span> <span class="o">=</span> <span class="n">current</span><span class="p">;</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i_Constant</span> <span class="o">=</span> <span class="mh">0xC0</span><span class="p">;</span>
	<span class="p">}</span>			<span class="cm">/* if(data[0]==1) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">i_Constant</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* if{data[0]==0) */</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">The parameter passed to driver is in error for enabling the voltage interrupt</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/* else if(data[0]==0) */</span>
	<span class="p">}</span>			<span class="cm">/* elseif(data[0]==1) */</span>

	 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the mode specification register of port B */</span>
	 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
      <span class="cm">/*********************************************/</span>
	<span class="cm">/* Writes the new configuration (APCI1500_OR) */</span>
      <span class="cm">/*********************************************/</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0xF9</span><span class="p">)</span> <span class="o">|</span> <span class="n">APCI1500_OR</span><span class="p">;</span>

	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
       <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
       <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/*****************************************/</span>
	<span class="cm">/* Authorises the interrupt on the board */</span>
	<span class="cm">/*****************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xC0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/***************************************************/</span>
	<span class="cm">/* Selects the pattern polarity register of port B */</span>
	<span class="cm">/***************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_Constant</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the pattern transition register of port B */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_TRANSITION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_Constant</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/***********************************************/</span>
	<span class="cm">/* Selects the pattern mask register of port B */</span>
	<span class="cm">/***********************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_PATTERN_MASK</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_Constant</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of port A */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/***********************************/</span>
	<span class="cm">/* Deletes the interrupt of port A */</span>
	 <span class="cm">/***********************************/</span>

	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of port  B */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/***********************************/</span>
	<span class="cm">/* Deletes the interrupt of port B */</span>
	 <span class="cm">/***********************************/</span>

	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/***********************************/</span>
	<span class="cm">/* Deletes the interrupt of timer 1 */</span>
	 <span class="cm">/***********************************/</span>

	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/***********************************/</span>
	<span class="cm">/* Deletes the interrupt of timer 2 */</span>
	 <span class="cm">/***********************************/</span>

	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 3 */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/***********************************/</span>
	<span class="cm">/* Deletes the interrupt of timer 3 */</span>
	 <span class="cm">/***********************************/</span>

	<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	 <span class="cm">/*************************************************/</span>
	<span class="cm">/* Selects the master interrupt control register */</span>
	 <span class="cm">/*************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/**********************************************/</span>
	<span class="cm">/* Authorizes the main interrupt on the board */</span>
	<span class="cm">/**********************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

      <span class="cm">/***************************/</span>
	<span class="cm">/* Enables the PCI interrupt */</span>
      <span class="cm">/*****************************/</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x3000</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">ui_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">ui_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">outl</span><span class="p">(</span><span class="mh">0x23000</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : static void v_APCI1500_Interrupt					     |</span>
<span class="cm">|					  (int irq , void *d)      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Interrupt handler                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : int irq                 : irq number                   |</span>
<span class="cm">|                     void *d                 : void pointer                 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : TRUE  : No error occur                                 |</span>
<span class="cm">|		            : FALSE : Error occur. Return the error          |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">v_APCI1500_Interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_InterruptStatus</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_RegValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

 <span class="cm">/***********************************/</span>
	<span class="cm">/* Read the board interrupt status */</span>
 <span class="cm">/***********************************/</span>
	<span class="n">ui_InterruptStatus</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>

  <span class="cm">/***************************************/</span>
	<span class="cm">/* Test if board generated a interrupt */</span>
  <span class="cm">/***************************************/</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">ui_InterruptStatus</span> <span class="o">&amp;</span> <span class="mh">0x800000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x800000</span><span class="p">)</span> <span class="p">{</span>
      <span class="cm">/************************/</span>
		<span class="cm">/* Disable all Interrupt */</span>
      <span class="cm">/************************/</span>
      <span class="cm">/*************************************************/</span>
		<span class="cm">/* Selects the master interrupt control register */</span>
      <span class="cm">/*************************************************/</span>
		<span class="cm">/* outb(APCI1500_RW_MASTER_INTERRUPT_CONTROL,devpriv-&gt;iobase+APCI1500_Z8536_CONTROL_REGISTER); */</span>
	<span class="cm">/**********************************************/</span>
		<span class="cm">/* Disables  the main interrupt on the board */</span>
	<span class="cm">/**********************************************/</span>
		<span class="cm">/* outb(0x00,devpriv-&gt;iobase+APCI1500_Z8536_CONTROL_REGISTER); */</span>

   <span class="cm">/*****************************************************/</span>
		<span class="cm">/* Selects the command and status register of port A */</span>
   <span class="cm">/*****************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="n">i_RegValue</span> <span class="o">=</span>
			<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
	   <span class="cm">/*****************************************************/</span>
			<span class="cm">/* Selects the command and status register of port A */</span>
	   <span class="cm">/*****************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	    <span class="cm">/***********************************/</span>
			<span class="cm">/* Deletes the interrupt of port A */</span>
	    <span class="cm">/***********************************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_Logic</span> <span class="o">==</span> <span class="n">APCI1500_OR_PRIORITY</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">i_RegValue</span> <span class="o">=</span>
					<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	      <span class="cm">/***************************************************/</span>
				<span class="cm">/* Selects the interrupt vector register of port A */</span>
	      <span class="cm">/***************************************************/</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_INTERRUPT_CONTROL</span><span class="p">,</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
				<span class="n">i_RegValue</span> <span class="o">=</span>
					<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
					<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

				<span class="n">i_InputChannel</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>

			<span class="p">}</span>	<span class="cm">/*  if(i_Logic==APCI1500_OR_PRIORITY) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">i_InputChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* elseif(i_Logic==APCI1500_OR_PRIORITY) */</span>
		<span class="p">}</span>		<span class="cm">/*  if ((i_RegValue &amp; 0x60) == 0x60) */</span>

	   <span class="cm">/*****************************************************/</span>
		<span class="cm">/* Selects the command and status register of port B */</span>
	   <span class="cm">/*****************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="n">i_RegValue</span> <span class="o">=</span>
			<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
	     <span class="cm">/*****************************************************/</span>
			<span class="cm">/* Selects the command and status register of port B */</span>
	     <span class="cm">/*****************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	     <span class="cm">/***********************************/</span>
			<span class="cm">/* Deletes the interrupt of port B */</span>
	     <span class="cm">/***********************************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s">&quot;</span><span class="p">);</span>
	     <span class="cm">/****************/</span>
			<span class="cm">/* Reads port B */</span>
	     <span class="cm">/****************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span>
				<span class="n">inb</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_PORT_B</span><span class="p">);</span>

			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">;</span>
	      <span class="cm">/**************************************/</span>
			<span class="cm">/* Tests if this is an external error */</span>
	      <span class="cm">/**************************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">i_RegValue</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* Disable the interrupt */</span>
		     <span class="cm">/*****************************************************/</span>
				<span class="cm">/* Selects the command and status register of port B */</span>
		     <span class="cm">/*****************************************************/</span>
				<span class="n">outl</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAmcc</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">);</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_InterruptMask</span> <span class="o">=</span>
						<span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mh">0x40</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* if (i_RegValue &amp; 0x80) */</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">i_InterruptMask</span> <span class="o">=</span>
						<span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/* if (i_RegValue &amp; 0x40) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (i_RegValue) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mi">2</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (i_RegValue) */</span>
		<span class="p">}</span>		<span class="cm">/* if ((i_RegValue &amp; 0x60) == 0x60) */</span>

		<span class="cm">/*****************************************************/</span>
		<span class="cm">/* Selects the command and status register of timer 1 */</span>
		<span class="cm">/*****************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="n">i_RegValue</span> <span class="o">=</span>
			<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="cm">/* Selects the command and status register of timer 1 */</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		   <span class="cm">/***********************************/</span>
			<span class="cm">/* Deletes the interrupt of timer 1 */</span>
		   <span class="cm">/***********************************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mi">4</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if ((i_RegValue &amp; 0x60) == 0x60) */</span>
		<span class="cm">/*****************************************************/</span>
		<span class="cm">/* Selects the command and status register of timer 2 */</span>
		<span class="cm">/*****************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="n">i_RegValue</span> <span class="o">=</span>
			<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="cm">/* Selects the command and status register of timer 2 */</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		   <span class="cm">/***********************************/</span>
			<span class="cm">/* Deletes the interrupt of timer 2 */</span>
		   <span class="cm">/***********************************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mi">8</span><span class="p">;</span>
		<span class="p">}</span>		<span class="cm">/*  if ((i_RegValue &amp; 0x60) == 0x60) */</span>

		<span class="cm">/*****************************************************/</span>
		<span class="cm">/* Selects the command and status register of timer 3 */</span>
		<span class="cm">/*****************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="n">i_RegValue</span> <span class="o">=</span>
			<span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x60</span><span class="p">)</span> <span class="p">{</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="cm">/* Selects the command and status register of timer 3 */</span>
		   <span class="cm">/*****************************************************/</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
		   <span class="cm">/***********************************/</span>
			<span class="cm">/* Deletes the interrupt of timer 3 */</span>
		   <span class="cm">/***********************************/</span>
			<span class="n">i_RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_RegValue</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="n">outb</span><span class="p">(</span><span class="n">i_RegValue</span><span class="p">,</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span>
				<span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i_CounterLogic</span> <span class="o">==</span> <span class="n">APCI1500_COUNTER</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mh">0x10</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/* if(i_CounterLogic==APCI1500_COUNTER) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="n">i_InterruptMask</span> <span class="o">|</span> <span class="mh">0x20</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>		<span class="cm">/*  if ((i_RegValue &amp; 0x60) == 0x60) */</span>

		<span class="n">send_sig</span><span class="p">(</span><span class="n">SIGIO</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/*  send signal to the sample */</span>
	       <span class="cm">/***********************/</span>
		<span class="cm">/* Enable all Interrupts */</span>
	       <span class="cm">/***********************/</span>

	       <span class="cm">/*************************************************/</span>
		<span class="cm">/* Selects the master interrupt control register */</span>
	       <span class="cm">/*************************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	       <span class="cm">/**********************************************/</span>
		<span class="cm">/* Authorizes the main interrupt on the board */</span>
	       <span class="cm">/**********************************************/</span>
		<span class="n">outb</span><span class="p">(</span><span class="mh">0xD0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="p">}</span>			<span class="cm">/*   if ((ui_InterruptStatus &amp; 0x800000) == 0x800000) */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Interrupt from unknown source</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="p">}</span>			<span class="cm">/* else if ((ui_InterruptStatus &amp; 0x800000) == 0x800000) */</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : int i_APCI1500_Reset(struct comedi_device *dev)               |                                                       |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              :resets all the registers                                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : struct comedi_device *dev</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters :	--													 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :                                                        |</span>
<span class="cm">|			                                                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">i_APCI1500_Reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_DummyRead</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_TimerCounter1Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_TimerCounter2Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_WatchdogCounter3Init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_Event1Status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_Event2Status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_TimerCounterWatchdogInterrupt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_Logic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_CounterLogic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_InterruptMask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_InputChannel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_TimerCounter1Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_TimerCounter2Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">i_WatchdogCounter3Enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="cm">/******************/</span>
	<span class="cm">/* Software reset */</span>
    <span class="cm">/******************/</span>
	<span class="n">i_DummyRead</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">i_DummyRead</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the master configuration control register */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_CONFIGURATION_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xF4</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the mode specification register of port A */</span>
	<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/* Selects the data path polarity register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* High level of port A means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	<span class="cm">/* Selects the data direction register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/*  Selects the command and status register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of port A:  */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the handshake specification register of port A */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_HANDSHAKE_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes the register */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the mode specification register of port B */</span>
	 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data path polarity register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* A high level of port B means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x7F</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data direction register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of port B:         */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the handshake specification register of port B */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_HANDSHAKE_SPECIFICATION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes the register */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>

	   <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the data path polarity register of port C */</span>
	   <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_DATA_PCITCH_POLARITY</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* High level of port C means 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x9</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the data direction register of port C */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_DATA_DIRECTION</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* All bits used as inputs except channel 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0E</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the special IO register of port C */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_C_SPECIAL_IO_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes it */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	   <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
	   <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates the interrupt management of timer 1         */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	   <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
	   <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates Timer 2 interrupt management:               */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	  <span class="cm">/******************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 3 */</span>
	  <span class="cm">/******************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes IP and IUS */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Selects the command and status register of Timer 3 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deactivates interrupt management of timer 3:            */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0xE0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	 <span class="cm">/*************************************************/</span>
	<span class="cm">/* Selects the master interrupt control register */</span>
	 <span class="cm">/*************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* Deletes all interrupts */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="cm">/* reset all the digital outputs */</span>
	<span class="n">outw</span><span class="p">(</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">i_IobaseAddon</span> <span class="o">+</span> <span class="n">APCI1500_DIGITAL_OP</span><span class="p">);</span>
<span class="cm">/*******************************/</span>
<span class="cm">/* Disable the board interrupt */</span>
<span class="cm">/*******************************/</span>
 <span class="cm">/*************************************************/</span>
	<span class="cm">/* Selects the master interrupt control register */</span>
 <span class="cm">/*************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_MASTER_INTERRUPT_CONTROL</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
 <span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of port A */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_A_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of port B */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_PORT_B_COMMAND_AND_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 1 */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR1_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/*****************************************************/</span>
	<span class="cm">/* Selects the command and status register of timer 2 */</span>
 <span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR2_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/*****************************************************/</span>
<span class="cm">/* Selects the command and status register of timer 3*/</span>
<span class="cm">/*****************************************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">APCI1500_RW_CPT_TMR3_CMD_STATUS</span><span class="p">,</span>
		<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
<span class="cm">/****************************/</span>
<span class="cm">/* Deactivates all interrupts */</span>
<span class="cm">/******************************/</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">iobase</span> <span class="o">+</span> <span class="n">APCI1500_Z8536_CONTROL_REGISTER</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
