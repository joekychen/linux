<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › comedi › drivers › addi-data › addi_eeprom.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>addi_eeprom.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">@verbatim</span>

<span class="cm">Copyright (C) 2004,2005  ADDI-DATA GmbH for the source code of this module.</span>

<span class="cm">	ADDI-DATA GmbH</span>
<span class="cm">	Dieselstrasse 3</span>
<span class="cm">	D-77833 Ottersweier</span>
<span class="cm">	Tel: +19(0)7223/9493-0</span>
<span class="cm">	Fax: +49(0)7223/9493-92</span>
<span class="cm">	http://www.addi-data.com</span>
<span class="cm">	info@addi-data.com</span>

<span class="cm">This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</span>

<span class="cm">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>

<span class="cm">You should also find the complete GPL in the COPYING file accompanying this source code.</span>

<span class="cm">@endverbatim</span>
<span class="cm">*/</span>
<span class="cm">/*</span>

<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | (C) ADDI-DATA GmbH          Dieselstrasse 3      D-77833 Ottersweier  |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Tel : +49 (0) 7223/9493-0     | email    : info@addi-data.com         |</span>
<span class="cm">  | Fax : +49 (0) 7223/9493-92    | Internet : http://www.addi-data.com   |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Project   : ADDI DATA         | Compiler : GCC 			              |</span>
<span class="cm">  | Modulname : addi_eeprom.c     | Version  : 2.96                       |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project manager: Eric Stolz   | Date     :  02/12/2002                |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Description : ADDI EEPROM  Module                                     |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |                             UPDATE&#39;S                                  |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |   Date   |   Author  |          Description of updates                |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">  |          | 		 | 						  |</span>
<span class="cm">  |          |           | 						  |</span>
<span class="cm">  +----------+-----------+------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="cp">#define NVCMD_BEGIN_READ 	(0x7 &lt;&lt; 5)	</span><span class="cm">/*  nvRam begin read command */</span><span class="cp"></span>
<span class="cp">#define NVCMD_LOAD_LOW   	(0x4 &lt;&lt; 5)	</span><span class="cm">/*  nvRam load low command */</span><span class="cp"></span>
<span class="cp">#define NVCMD_LOAD_HIGH  	(0x5 &lt;&lt; 5)	</span><span class="cm">/*  nvRam load high command */</span><span class="cp"></span>
<span class="cp">#define EE76_CMD_LEN    	13	</span><span class="cm">/*  bits in instructions */</span><span class="cp"></span>
<span class="cp">#define EE_READ         	0x0180	</span><span class="cm">/*  01 1000 0000 read instruction */</span><span class="cp"></span>

<span class="cp">#define EEPROM_DIGITALINPUT 			0</span>
<span class="cp">#define EEPROM_DIGITALOUTPUT			1</span>
<span class="cp">#define EEPROM_ANALOGINPUT				2</span>
<span class="cp">#define EEPROM_ANALOGOUTPUT				3</span>
<span class="cp">#define EEPROM_TIMER					4</span>
<span class="cp">#define EEPROM_WATCHDOG					5</span>
<span class="cp">#define EEPROM_TIMER_WATCHDOG_COUNTER	10</span>

<span class="k">struct</span> <span class="n">str_Functionality</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">str_MainHeader</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_HeaderSize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Nfunctions</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_Functionality</span> <span class="n">s_Functions</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">str_DigitalInputHeader</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Nchannel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Interruptible</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_NinterruptLogic</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">str_DigitalOutputHeader</span> <span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Nchannel</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* used for timer as well as watchdog */</span>

<span class="k">struct</span> <span class="n">str_TimerDetails</span> <span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_HeaderSize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Resolution</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Mode</span><span class="p">;</span>		<span class="cm">/*  in case of Watchdog it is functionality */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_MinTiming</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_TimeBase</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">str_TimerMainHeader</span> <span class="p">{</span>


	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Ntimer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_TimerDetails</span> <span class="n">s_TimerDetails</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/*   supports 4 timers */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">str_AnalogOutputHeader</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Nchannel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Resolution</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">str_AnalogInputHeader</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Nchannel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_MinConvertTiming</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_MinDelayTiming</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_HasDma</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Resolution</span><span class="p">;</span>
<span class="p">};</span>


		<span class="cm">/*****************************************/</span>
		<span class="cm">/*            Read Header Functions              */</span>
		<span class="cm">/*****************************************/</span>

<span class="kt">int</span> <span class="n">i_EepromReadMainHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i_EepromReadDigitalInputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_DigitalInputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i_EepromReadDigitalOutputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_DigitalOutputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i_EepromReadTimerHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_TimerMainHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i_EepromReadAnlogOutputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_AnalogOutputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">i_EepromReadAnlogInputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_AnalogInputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">);</span>

		<span class="cm">/******************************************/</span>
		<span class="cm">/*      Eeprom Specific Functions                         */</span>
		<span class="cm">/******************************************/</span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_EepromStartAddress</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">v_EepromClock76</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_RegisterValue</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">v_EepromSendCommand76</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_EepromCommand</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_DataLengthInBits</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">v_EepromCs76Read</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">pw_Value</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function   Name   : unsigned short w_EepromReadWord                                  |</span>
<span class="cm">|				(unsigned short	w_PCIBoardEepromAddress,             		 |</span>
<span class="cm">|				 char *	pc_PCIChipInformation,               		 |</span>
<span class="cm">|				 unsigned short   w_EepromStartAddress)                		 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read from eepromn a word                               |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      unsigned short w_EepromStartAddress    : Selected eeprom address |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : Read word value from eeprom                            |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">w_EepromReadWord</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_EepromStartAddress</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ReadByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ReadLowByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ReadHighByte</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_SelectedAddressLow</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_SelectedAddressHigh</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_ReadWord</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/**************************/</span>

	<span class="cm">/* Test the PCI chip type */</span>

	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="s">&quot;S5920&quot;</span><span class="p">))</span> <span class="o">||</span>
		<span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="s">&quot;S5933&quot;</span><span class="p">)))</span>
	<span class="p">{</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">b_Counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">b_Counter</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">b_Counter</span><span class="o">++</span><span class="p">)</span>
		<span class="p">{</span>

			<span class="n">b_SelectedAddressLow</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_EepromStartAddress</span> <span class="o">+</span> <span class="n">b_Counter</span><span class="p">)</span> <span class="o">%</span> <span class="mi">256</span><span class="p">;</span>	<span class="cm">/* Read the low 8 bit part */</span>

			<span class="n">b_SelectedAddressHigh</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_EepromStartAddress</span> <span class="o">+</span> <span class="n">b_Counter</span><span class="p">)</span> <span class="o">/</span> <span class="mi">256</span><span class="p">;</span>	<span class="cm">/* Read the high 8 bit part */</span>

	      <span class="cm">/************************************/</span>

			<span class="cm">/* Select the load low address mode */</span>

	      <span class="cm">/************************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_LOAD_LOW</span><span class="p">,</span> <span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3F</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/************************/</span>

			<span class="cm">/* Load the low address */</span>

	      <span class="cm">/************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">b_SelectedAddressLow</span><span class="p">,</span>
				<span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3E</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/*************************************/</span>

			<span class="cm">/* Select the load high address mode */</span>

	      <span class="cm">/*************************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_LOAD_HIGH</span><span class="p">,</span> <span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3F</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/*************************/</span>

			<span class="cm">/* Load the high address */</span>

	      <span class="cm">/*************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">b_SelectedAddressHigh</span><span class="p">,</span>
				<span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3E</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/************************/</span>

			<span class="cm">/* Select the READ mode */</span>

	      <span class="cm">/************************/</span>

			<span class="n">outb</span><span class="p">(</span><span class="n">NVCMD_BEGIN_READ</span><span class="p">,</span> <span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3F</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/*****************************/</span>

			<span class="cm">/* Read data into the EEPROM */</span>

	      <span class="cm">/*****************************/</span>

			<span class="n">b_ReadByte</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3E</span><span class="p">);</span>

	      <span class="cm">/****************/</span>

			<span class="cm">/* Wait on busy */</span>

	      <span class="cm">/****************/</span>

			<span class="n">v_EepromWaitBusy</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">);</span>

	      <span class="cm">/*********************************/</span>

			<span class="cm">/* Select the upper address part */</span>

	      <span class="cm">/*********************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_Counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="p">{</span>

				<span class="n">b_ReadLowByte</span> <span class="o">=</span> <span class="n">b_ReadByte</span><span class="p">;</span>

			<span class="p">}</span>	<span class="cm">/*  if(b_Counter==0) */</span>

			<span class="k">else</span>
			<span class="p">{</span>

				<span class="n">b_ReadHighByte</span> <span class="o">=</span> <span class="n">b_ReadByte</span><span class="p">;</span>

			<span class="p">}</span>	<span class="cm">/*  if(b_Counter==0) */</span>

		<span class="p">}</span>		<span class="cm">/*  for (b_Counter=0; b_Counter&lt;2; b_Counter++) */</span>

		<span class="n">w_ReadWord</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_ReadLowByte</span> <span class="o">|</span> <span class="p">(((</span><span class="kt">unsigned</span> <span class="kt">short</span><span class="p">)</span> <span class="n">b_ReadHighByte</span><span class="p">)</span> <span class="o">*</span> <span class="mi">256</span><span class="p">));</span>

	<span class="p">}</span>			<span class="cm">/*  end of if ((!strcmp(pc_PCIChipInformation, &quot;S5920&quot;)) || (!strcmp(pc_PCIChipInformation, &quot;S5933&quot;))) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="s">&quot;93C76&quot;</span><span class="p">))</span>
	<span class="p">{</span>

	   <span class="cm">/*************************************/</span>

		<span class="cm">/* Read 16 bit from the EEPROM 93C76 */</span>

	   <span class="cm">/*************************************/</span>

		<span class="n">v_EepromCs76Read</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">w_EepromStartAddress</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">w_ReadWord</span><span class="p">);</span>

	<span class="p">}</span>

	<span class="k">return</span> <span class="n">w_ReadWord</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/*</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">| Function   Name   : void v_EepromWaitBusy                                  |</span>

<span class="cm">|			(unsigned short	w_PCIBoardEepromAddress)                    	 |</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">| Task              : Wait the busy flag from PCI controller                 |</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom base address |</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">| Output Parameters : -                                                      |</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">| Return Value      : -                                                      |</span>

<span class="cm">+----------------------------------------------------------------------------+</span>

<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">v_EepromWaitBusy</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_EepromBusy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">do</span>
	<span class="p">{</span>

	   <span class="cm">/*************/</span>

		<span class="cm">/* IMPORTANT */</span>

	   <span class="cm">/*************/</span>

	   <span class="cm">/************************************************************************/</span>

		<span class="cm">/* An error has been written in the AMCC 5933 book at the page B-13 */</span>

		<span class="cm">/* Ex: if you read a byte and look for the busy statusEEPROM=0x80 and   */</span>

		<span class="cm">/*      the operator register is AMCC_OP_REG_MCSR+3 */</span>

		<span class="cm">/*      unsigned short read  EEPROM=0x8000 andAMCC_OP_REG_MCSR+2                  */</span>

		<span class="cm">/*      unsigned int read  EEPROM=0x80000000 and AMCC_OP_REG_MCSR */</span>

	   <span class="cm">/************************************************************************/</span>

		<span class="n">b_EepromBusy</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span> <span class="o">+</span> <span class="mh">0x3F</span><span class="p">);</span>
		<span class="n">b_EepromBusy</span> <span class="o">=</span> <span class="n">b_EepromBusy</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">b_EepromBusy</span> <span class="o">==</span> <span class="mh">0x80</span><span class="p">);</span>

<span class="p">}</span>

<span class="cm">/*</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Function   Name   : void v_EepromClock76(unsigned int dw_Address,                      |</span>

<span class="cm">|					   unsigned int dw_RegisterValue)                 			  |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Task              : This function sends the clocking sequence to the EEPROM.    |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Input Parameters  : unsigned int dw_Address : PCI eeprom base address                  |</span>

<span class="cm">|		      unsigned int dw_RegisterValue : PCI eeprom register value to write.|</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Output Parameters : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Return Value      : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">v_EepromClock76</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_RegisterValue</span><span class="p">)</span>
<span class="p">{</span>

   <span class="cm">/************************/</span>

	<span class="cm">/* Set EEPROM clock Low */</span>

   <span class="cm">/************************/</span>

	<span class="n">outl</span><span class="p">(</span><span class="n">dw_RegisterValue</span> <span class="o">&amp;</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">dw_Address</span><span class="p">);</span>

   <span class="cm">/***************/</span>

	<span class="cm">/* Wait 0.1 ms */</span>

   <span class="cm">/***************/</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

   <span class="cm">/*************************/</span>

	<span class="cm">/* Set EEPROM clock High */</span>

   <span class="cm">/*************************/</span>

	<span class="n">outl</span><span class="p">(</span><span class="n">dw_RegisterValue</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">dw_Address</span><span class="p">);</span>

   <span class="cm">/***************/</span>

	<span class="cm">/* Wait 0.1 ms */</span>

   <span class="cm">/***************/</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="p">}</span>

<span class="cm">/*</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Function   Name   : void v_EepromSendCommand76(unsigned int dw_Address,                |</span>

<span class="cm">|					   unsigned int   dw_EepromCommand,                		  |</span>

<span class="cm">|					   unsigned char    b_DataLengthInBits)                        |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Task              : This function sends a Command to the EEPROM 93C76.          |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Input Parameters  : unsigned int dw_Address : PCI eeprom base address                  |</span>

<span class="cm">|		      unsigned int dw_EepromCommand : PCI eeprom command to write.       |</span>

<span class="cm">|		      unsigned char  b_DataLengthInBits : PCI eeprom command data length.  |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Output Parameters : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Return Value      : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">v_EepromSendCommand76</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_EepromCommand</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_DataLengthInBits</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">char</span> <span class="n">c_BitPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="cm">/*****************************/</span>

	<span class="cm">/* Enable EEPROM Chip Select */</span>

   <span class="cm">/*****************************/</span>

	<span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>

   <span class="cm">/********************************************************************/</span>

	<span class="cm">/* Toggle EEPROM&#39;s Chip select to get it out of Shift Register Mode */</span>

   <span class="cm">/********************************************************************/</span>

	<span class="n">outl</span><span class="p">(</span><span class="n">dw_RegisterValue</span><span class="p">,</span> <span class="n">dw_Address</span><span class="p">);</span>

   <span class="cm">/***************/</span>

	<span class="cm">/* Wait 0.1 ms */</span>

   <span class="cm">/***************/</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

   <span class="cm">/*******************************************/</span>

	<span class="cm">/* Send EEPROM command - one bit at a time */</span>

   <span class="cm">/*******************************************/</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">c_BitPos</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_DataLengthInBits</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="n">c_BitPos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c_BitPos</span><span class="o">--</span><span class="p">)</span>
	<span class="p">{</span>

      <span class="cm">/**********************************/</span>

		<span class="cm">/* Check if current bit is 0 or 1 */</span>

      <span class="cm">/**********************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dw_EepromCommand</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">c_BitPos</span><span class="p">))</span>
		<span class="p">{</span>

	 <span class="cm">/***********/</span>

			<span class="cm">/* Write 1 */</span>

	 <span class="cm">/***********/</span>

			<span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="n">dw_RegisterValue</span> <span class="o">|</span> <span class="mh">0x4</span><span class="p">;</span>

		<span class="p">}</span>

		<span class="k">else</span>
		<span class="p">{</span>

	 <span class="cm">/***********/</span>

			<span class="cm">/* Write 0 */</span>

	 <span class="cm">/***********/</span>

			<span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="n">dw_RegisterValue</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>

		<span class="p">}</span>

      <span class="cm">/*********************/</span>

		<span class="cm">/* Write the command */</span>

      <span class="cm">/*********************/</span>

		<span class="n">outl</span><span class="p">(</span><span class="n">dw_RegisterValue</span><span class="p">,</span> <span class="n">dw_Address</span><span class="p">);</span>

      <span class="cm">/***************/</span>

		<span class="cm">/* Wait 0.1 ms */</span>

      <span class="cm">/***************/</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

      <span class="cm">/****************************/</span>

		<span class="cm">/* Trigger the EEPROM clock */</span>

      <span class="cm">/****************************/</span>

		<span class="n">v_EepromClock76</span><span class="p">(</span><span class="n">dw_Address</span><span class="p">,</span> <span class="n">dw_RegisterValue</span><span class="p">);</span>

	<span class="p">}</span>

<span class="p">}</span>

<span class="cm">/*</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Function   Name   : void v_EepromCs76Read(unsigned int dw_Address,                     |</span>

<span class="cm">|					   unsigned short    w_offset,                      			  |</span>

<span class="cm">|					   unsigned short *   pw_Value)                      			  |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Task              : This function read a value from the EEPROM 93C76.           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Input Parameters  : unsigned int dw_Address : PCI eeprom base address                  |</span>

<span class="cm">|		      unsigned short    w_offset : Offset of the address to read             |</span>

<span class="cm">|		      unsigned short *   pw_Value : PCI eeprom 16 bit read value.            |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Output Parameters : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">| Return Value      : -                                                           |</span>

<span class="cm">+---------------------------------------------------------------------------------+</span>

<span class="cm">*/</span>

<span class="kt">void</span> <span class="nf">v_EepromCs76Read</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">pw_Value</span><span class="p">)</span>
<span class="p">{</span>

        <span class="kt">char</span> <span class="n">c_BitPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_RegisterValueRead</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="cm">/*************************************************/</span>

	<span class="cm">/* Send EEPROM read command and offset to EEPROM */</span>

   <span class="cm">/*************************************************/</span>

	<span class="n">v_EepromSendCommand76</span><span class="p">(</span><span class="n">dw_Address</span><span class="p">,</span> <span class="p">(</span><span class="n">EE_READ</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">w_offset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
		<span class="n">EE76_CMD_LEN</span><span class="p">);</span>

   <span class="cm">/*******************************/</span>

	<span class="cm">/* Get the last register value */</span>

   <span class="cm">/*******************************/</span>

	<span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="p">(((</span><span class="n">w_offset</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x2</span><span class="p">;</span>

   <span class="cm">/*****************************/</span>

	<span class="cm">/* Set the 16-bit value of 0 */</span>

   <span class="cm">/*****************************/</span>

	<span class="o">*</span><span class="n">pw_Value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

   <span class="cm">/************************/</span>

	<span class="cm">/* Get the 16-bit value */</span>

   <span class="cm">/************************/</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">c_BitPos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c_BitPos</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">c_BitPos</span><span class="o">++</span><span class="p">)</span>
	<span class="p">{</span>

      <span class="cm">/****************************/</span>

		<span class="cm">/* Trigger the EEPROM clock */</span>

      <span class="cm">/****************************/</span>

		<span class="n">v_EepromClock76</span><span class="p">(</span><span class="n">dw_Address</span><span class="p">,</span> <span class="n">dw_RegisterValue</span><span class="p">);</span>

      <span class="cm">/**********************/</span>

		<span class="cm">/* Get the result bit */</span>

      <span class="cm">/**********************/</span>

		<span class="n">dw_RegisterValueRead</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">dw_Address</span><span class="p">);</span>

      <span class="cm">/***************/</span>

		<span class="cm">/* Wait 0.1 ms */</span>

      <span class="cm">/***************/</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

      <span class="cm">/***************************************/</span>

		<span class="cm">/* Get bit value and shift into result */</span>

      <span class="cm">/***************************************/</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dw_RegisterValueRead</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">)</span>
		<span class="p">{</span>

	 <span class="cm">/**********/</span>

			<span class="cm">/* Read 1 */</span>

	 <span class="cm">/**********/</span>

			<span class="o">*</span><span class="n">pw_Value</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">pw_Value</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">;</span>

		<span class="p">}</span>

		<span class="k">else</span>
		<span class="p">{</span>

	 <span class="cm">/**********/</span>

			<span class="cm">/* Read 0 */</span>

	 <span class="cm">/**********/</span>

			<span class="o">*</span><span class="n">pw_Value</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">pw_Value</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="p">}</span>

	<span class="p">}</span>

   <span class="cm">/*************************/</span>

	<span class="cm">/* Clear all EEPROM bits */</span>

   <span class="cm">/*************************/</span>

	<span class="n">dw_RegisterValue</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>

   <span class="cm">/********************************************************************/</span>

	<span class="cm">/* Toggle EEPROM&#39;s Chip select to get it out of Shift Register Mode */</span>

   <span class="cm">/********************************************************************/</span>

	<span class="n">outl</span><span class="p">(</span><span class="n">dw_RegisterValue</span><span class="p">,</span> <span class="n">dw_Address</span><span class="p">);</span>

   <span class="cm">/***************/</span>

	<span class="cm">/* Wait 0.1 ms */</span>

   <span class="cm">/***************/</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

<span class="p">}</span>

	<span class="cm">/******************************************/</span>
	<span class="cm">/*      EEPROM HEADER READ FUNCTIONS      */</span>
	<span class="cm">/******************************************/</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadMainHeader(unsigned short w_PCIBoardEepromAddress,  |</span>
<span class="cm">|				char *	pc_PCIChipInformation,struct comedi_device *dev)    |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read from eeprom Main Header                           |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			  struct comedi_device *dev		   : comedi device structure |</span>
<span class="cm">|											 pointer				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_EepromReadMainHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Temp</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">w_Count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui_Temp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_MainHeader</span> <span class="n">s_MainHeader</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_DigitalInputHeader</span> <span class="n">s_DigitalInputHeader</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_DigitalOutputHeader</span> <span class="n">s_DigitalOutputHeader</span><span class="p">;</span>
	<span class="cm">/* struct str_TimerMainHeader     s_TimerMainHeader,s_WatchdogMainHeader; */</span>
	<span class="k">struct</span> <span class="n">str_AnalogOutputHeader</span> <span class="n">s_AnalogOutputHeader</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">str_AnalogInputHeader</span> <span class="n">s_AnalogInputHeader</span><span class="p">;</span>

	<span class="cm">/* Read size */</span>
	<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">w_HeaderSize</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>

	<span class="cm">/* Read nbr of functionality */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">b_Nfunctions</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">w_Temp</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>

	<span class="cm">/* Read functionality details */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s_MainHeader</span><span class="p">.</span><span class="n">b_Nfunctions</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Read Type */</span>
		<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">w_Count</span><span class="p">);</span>
		<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b_Type</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">w_Temp</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>
		<span class="n">w_Count</span> <span class="o">=</span> <span class="n">w_Count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="cm">/* Read Address */</span>
		<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_Address</span> <span class="o">=</span>
			<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">w_Count</span><span class="p">);</span>
		<span class="n">w_Count</span> <span class="o">=</span> <span class="n">w_Count</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Display main header info */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s_MainHeader</span><span class="p">.</span><span class="n">b_Nfunctions</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b_Type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">EEPROM_DIGITALINPUT</span>:
			<span class="n">i_EepromReadDigitalInputHeader</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
				<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
				<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_Address</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">s_DigitalInputHeader</span><span class="p">);</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrDiChannel</span> <span class="o">=</span>
				<span class="n">s_DigitalInputHeader</span><span class="p">.</span><span class="n">w_Nchannel</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_DIGITALOUTPUT</span>:
			<span class="n">i_EepromReadDigitalOutputHeader</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
				<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
				<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_Address</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">s_DigitalOutputHeader</span><span class="p">);</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrDoChannel</span> <span class="o">=</span>
				<span class="n">s_DigitalOutputHeader</span><span class="p">.</span><span class="n">w_Nchannel</span><span class="p">;</span>
			<span class="n">ui_Temp</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_DoMaxdata</span> <span class="o">=</span>
				<span class="n">ui_Temp</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">32</span> <span class="o">-</span>
					<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrDoChannel</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_ANALOGINPUT</span>:
			<span class="n">i_EepromReadAnlogInputHeader</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
				<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
				<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_Address</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">s_AnalogInputHeader</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">this_board</span><span class="o">-&gt;</span><span class="n">pc_DriverName</span><span class="p">,</span> <span class="s">&quot;apci3200&quot;</span><span class="p">)))</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrAiChannel</span> <span class="o">=</span>
					<span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">w_Nchannel</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrAiChannel</span> <span class="o">=</span>
					<span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">w_Nchannel</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_Dma</span> <span class="o">=</span>
				<span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">b_HasDma</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">ui_MinAcquisitiontimeNs</span> <span class="o">=</span>
				<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">w_MinConvertTiming</span> <span class="o">*</span>
				<span class="mi">1000</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">ui_MinDelaytimeNs</span> <span class="o">=</span>
				<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">w_MinDelayTiming</span> <span class="o">*</span>
				<span class="mi">1000</span><span class="p">;</span>
			<span class="n">ui_Temp</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_AiMaxdata</span> <span class="o">=</span>
				<span class="n">ui_Temp</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span>
				<span class="n">s_AnalogInputHeader</span><span class="p">.</span><span class="n">b_Resolution</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_ANALOGOUTPUT</span>:
			<span class="n">i_EepromReadAnlogOutputHeader</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
				<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
				<span class="n">s_MainHeader</span><span class="p">.</span><span class="n">s_Functions</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_Address</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">s_AnalogOutputHeader</span><span class="p">);</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_NbrAoChannel</span> <span class="o">=</span>
				<span class="n">s_AnalogOutputHeader</span><span class="p">.</span><span class="n">w_Nchannel</span><span class="p">;</span>
			<span class="n">ui_Temp</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_AoMaxdata</span> <span class="o">=</span>
				<span class="n">ui_Temp</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span>
				<span class="n">s_AnalogOutputHeader</span><span class="p">.</span><span class="n">b_Resolution</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_TIMER</span>:
			<span class="cm">/* Timer subdevice present */</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_Timer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_WATCHDOG</span>:
			<span class="cm">/* Timer subdevice present */</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_Timer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">EEPROM_TIMER_WATCHDOG_COUNTER</span>:
			<span class="cm">/* Timer subdevice present */</span>
			<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_EeParameters</span><span class="p">.</span><span class="n">i_Timer</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadDigitalInputHeader(unsigned short 					 |</span>
<span class="cm">|			w_PCIBoardEepromAddress,char *pc_PCIChipInformation,	 |</span>
<span class="cm">|			unsigned short w_Address,struct str_DigitalInputHeader *s_Header)		 |</span>
<span class="cm">|																	 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read Digital Input Header                              |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			 struct str_DigitalInputHeader *s_Header: Digita Input Header   |</span>
<span class="cm">|												   Pointer			 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_EepromReadDigitalInputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_DigitalInputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Temp</span><span class="p">;</span>

	<span class="cm">/*  read nbr of channels */</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Nchannel</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>

	<span class="cm">/*  interruptible or not */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">b_Interruptible</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">;</span>

<span class="cm">/* How many interruptible logic */</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_NinterruptLogic</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadDigitalOutputHeader(unsigned short 				 |</span>
<span class="cm">|			w_PCIBoardEepromAddress,char *pc_PCIChipInformation,	 |</span>
<span class="cm">|			unsigned short w_Address,struct str_DigitalOutputHeader *s_Header)	     |</span>
<span class="cm">|																	 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read Digital Output Header                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			 struct str_DigitalOutputHeader *s_Header: Digital Output Header|</span>
<span class="cm">|											   Pointer				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_EepromReadDigitalOutputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_DigitalOutputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">)</span>
<span class="p">{</span>
<span class="cm">/* Read Nbr channels */</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Nchannel</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadTimerHeader(unsigned short w_PCIBoardEepromAddress, |</span>
<span class="cm">|			char *pc_PCIChipInformation,WORD w_Address,				 |</span>
<span class="cm">|			struct str_TimerMainHeader *s_Header)							 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read Timer or Watchdog Header                          |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			 struct str_TimerMainHeader *s_Header: Timer Header			 |</span>
<span class="cm">|											   Pointer				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="nf">i_EepromReadTimerHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_TimerMainHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">i</span><span class="p">,</span> <span class="n">w_Size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w_Temp</span><span class="p">;</span>

<span class="cm">/* Read No of Timer */</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Ntimer</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
<span class="cm">/* Read header size */</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Ntimer</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_HeaderSize</span> <span class="o">=</span>
			<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
			<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">w_Size</span> <span class="o">+</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
			<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">w_Size</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>

		<span class="cm">/* Read Resolution */</span>
		<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b_Resolution</span> <span class="o">=</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>

		<span class="cm">/* Read Mode */</span>
		<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b_Mode</span> <span class="o">=</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>

		<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
			<span class="n">pc_PCIChipInformation</span><span class="p">,</span>
			<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">w_Size</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>

		<span class="cm">/* Read MinTiming */</span>
		<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_MinTiming</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3FF</span><span class="p">;</span>

		<span class="cm">/* Read Timebase */</span>
		<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">b_TimeBase</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">w_Temp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>
		<span class="n">w_Size</span> <span class="o">+=</span> <span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">s_TimerDetails</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w_HeaderSize</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadAnlogOutputHeader(unsigned short 					 |</span>
<span class="cm">|			w_PCIBoardEepromAddress,char *pc_PCIChipInformation,	 |</span>
<span class="cm">|			unsigned short w_Address,str_AnalogOutputHeader *s_Header)         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read Nalog Output  Header                              |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			 str_AnalogOutputHeader *s_Header:Anlog Output Header    |</span>
<span class="cm">|											   Pointer				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_EepromReadAnlogOutputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_AnalogOutputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Temp</span><span class="p">;</span>
	<span class="cm">/*  No of channels for 1st hard component */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Nchannel</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03FF</span><span class="p">;</span>
	<span class="cm">/*  Resolution for 1st hard component */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">b_Resolution</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name  : int i_EepromReadAnlogInputHeader(unsigned short 					 |</span>
<span class="cm">|			w_PCIBoardEepromAddress,char *pc_PCIChipInformation,     |</span>
<span class="cm">|			unsigned short w_Address,struct str_AnalogInputHeader *s_Header)          |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Read Nalog Output  Header                              |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned short w_PCIBoardEepromAddress : PCI eeprom address      |</span>
<span class="cm">|																	 |</span>
<span class="cm">|		      char *pc_PCIChipInformation  : PCI Chip Type.          |</span>
<span class="cm">|																	 |</span>
<span class="cm">|			 struct str_AnalogInputHeader *s_Header:Anlog Input Header      |</span>
<span class="cm">|											   Pointer				 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0							                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="cm">/* Reads only for ONE  hardware component */</span>
<span class="kt">int</span> <span class="nf">i_EepromReadAnlogInputHeader</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Address</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">str_AnalogInputHeader</span> <span class="o">*</span><span class="n">s_Header</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">w_Temp</span><span class="p">,</span> <span class="n">w_Offset</span><span class="p">;</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_Nchannel</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03FF</span><span class="p">;</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_MinConvertTiming</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">w_MinDelayTiming</span> <span class="o">=</span>
		<span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span>
		<span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">30</span><span class="p">);</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">20</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">b_HasDma</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">;</span>	<span class="cm">/*  whether dma present or not */</span>

	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span> <span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="mi">72</span><span class="p">);</span>	<span class="cm">/*  reading Y */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_Temp</span> <span class="o">&amp;</span> <span class="mh">0x00FF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">w_Temp</span><span class="p">)</span>		<span class="cm">/* Y&gt;0 */</span>
	<span class="p">{</span>
		<span class="n">w_Offset</span> <span class="o">=</span> <span class="mi">74</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">w_Temp</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">w_Temp</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)));</span>	<span class="cm">/*  offset of first analog input single header */</span>
		<span class="n">w_Offset</span> <span class="o">=</span> <span class="n">w_Offset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/*  resolution */</span>
	<span class="p">}</span> <span class="k">else</span>			<span class="cm">/* Y=0 */</span>
	<span class="p">{</span>
		<span class="n">w_Offset</span> <span class="o">=</span> <span class="mi">74</span><span class="p">;</span>
		<span class="n">w_Offset</span> <span class="o">=</span> <span class="n">w_Offset</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/*  resolution */</span>
	<span class="p">}</span>

<span class="cm">/* read Resolution */</span>
	<span class="n">w_Temp</span> <span class="o">=</span> <span class="n">w_EepromReadWord</span><span class="p">(</span><span class="n">w_PCIBoardEepromAddress</span><span class="p">,</span>
		<span class="n">pc_PCIChipInformation</span><span class="p">,</span> <span class="mh">0x100</span> <span class="o">+</span> <span class="n">w_Address</span> <span class="o">+</span> <span class="n">w_Offset</span><span class="p">);</span>
	<span class="n">s_Header</span><span class="o">-&gt;</span><span class="n">b_Resolution</span> <span class="o">=</span> <span class="n">w_Temp</span> <span class="o">&amp;</span> <span class="mh">0x001F</span><span class="p">;</span>	<span class="cm">/*  last 5 bits */</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
