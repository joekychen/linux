<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › comedi › drivers › addi-data › APCI1710_Pwm.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>APCI1710_Pwm.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm">@verbatim</span>

<span class="cm">Copyright (C) 2004,2005  ADDI-DATA GmbH for the source code of this module.</span>

<span class="cm">	ADDI-DATA GmbH</span>
<span class="cm">	Dieselstrasse 3</span>
<span class="cm">	D-77833 Ottersweier</span>
<span class="cm">	Tel: +19(0)7223/9493-0</span>
<span class="cm">	Fax: +49(0)7223/9493-92</span>
<span class="cm">	http://www.addi-data.com</span>
<span class="cm">	info@addi-data.com</span>

<span class="cm">This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.</span>

<span class="cm">This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>

<span class="cm">You should also find the complete GPL in the COPYING file accompanying this source code.</span>

<span class="cm">@endverbatim</span>
<span class="cm">*/</span>
<span class="cm">/*</span>

<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | (C) ADDI-DATA GmbH          Dieselstraße 3       D-77833 Ottersweier  |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Tel : +49 (0) 7223/9493-0     | email    : info@addi-data.com         |</span>
<span class="cm">  | Fax : +49 (0) 7223/9493-92    | Internet : http://www.addi-data.com   |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Project     : API APCI1710    | Compiler : gcc                        |</span>
<span class="cm">  | Module name : PWM.C           | Version  : 2.96                       |</span>
<span class="cm">  +-------------------------------+---------------------------------------+</span>
<span class="cm">  | Project manager: Eric Stolz   | Date     :  02/12/2002                |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | Description :   APCI-1710 Wulse wide modulation module                |</span>
<span class="cm">  |                                                                       |</span>
<span class="cm">  |                                                                       |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |                             UPDATES                                   |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  |   Date   |   Author  |          Description of updates                |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">  | 08/05/00 | Guinot C  | - 0400/0228 All Function in RING 0             |</span>
<span class="cm">  |          |           |   available                                    |</span>
<span class="cm">  +-----------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">|                               Included files                               |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="cp">#include &quot;APCI1710_Pwm.h&quot;</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     :INT i_APCI1710_InsnConfigPWM(struct comedi_device *dev,</span>
<span class="cm">struct comedi_subdevice *s,struct comedi_insn *insn,unsigned int *data)                        |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Pwm Init and Get Pwm Initialisation                    |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_InsnConfigPWM</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ConfigType</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">b_ConfigType</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">b_ConfigType</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">APCI1710_PWM_INIT</span>:
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">i_APCI1710_InitPWM</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">),</span>	<span class="cm">/*   b_ModulNbr */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>	<span class="cm">/* b_PWM */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>	<span class="cm">/*  b_ClockSelection */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>	<span class="cm">/*  b_TimingUnit */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>	<span class="cm">/* ul_LowTiming */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>	<span class="cm">/* ul_HighTiming */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>	<span class="cm">/* pul_RealLowTiming */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>	<span class="cm">/* pul_RealHighTiming */</span>
			<span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">APCI1710_PWM_GETINITDATA</span>:
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">i_APCI1710_GetPWMInitialisation</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">),</span>	<span class="cm">/*  b_ModulNbr */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>	<span class="cm">/* b_PWM */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>	<span class="cm">/* pb_TimingUnit */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>	<span class="cm">/* pul_LowTiming */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>	<span class="cm">/* pul_HighTiming */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>	<span class="cm">/*  pb_StartLevel */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>	<span class="cm">/*  pb_StopMode */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>	<span class="cm">/*  pb_StopLevel */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>	<span class="cm">/*  pb_ExternGate */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>	<span class="cm">/*  pb_InterruptEnable */</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>	<span class="cm">/*  pb_Enable */</span>
			<span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot; Config Parameter Wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i_ReturnValue</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_ i_APCI1710_InitPWM                               |</span>
<span class="cm">|                                       (unsigned char_     b_BoardHandle,            |</span>
<span class="cm">|                                        unsigned char_     b_ModulNbr,               |</span>
<span class="cm">|                                        unsigned char_     b_PWM,                    |</span>
<span class="cm">|                                        unsigned char_     b_ClockSelection,         |</span>
<span class="cm">|                                        unsigned char_     b_TimingUnit,             |</span>
<span class="cm">|                                        ULONG_   ul_LowTiming,              |</span>
<span class="cm">|                                        ULONG_   ul_HighTiming,             |</span>
<span class="cm">|                                        PULONG_ pul_RealLowTiming,          |</span>
<span class="cm">|                                        PULONG_ pul_RealHighTiming)         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Configure the selected PWM (b_PWM) from selected module|</span>
<span class="cm">|                     (b_ModulNbr). The ul_LowTiming, ul_HighTiming and      |</span>
<span class="cm">|                     ul_TimingUnit determine the low/high timing base for   |</span>
<span class="cm">|                     the period. pul_RealLowTiming, pul_RealHighTiming      |</span>
<span class="cm">|                     return the real timing value.                          |</span>
<span class="cm">|                     You must calling this function be for you call any     |</span>
<span class="cm">|                     other function witch access of the PWM.                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned char_     b_BoardHandle    : Handle of board APCI-1710 |</span>
<span class="cm">|                     unsigned char_     b_ModulNbr       : Module number to configure|</span>
<span class="cm">|                                                  (0 to 3)                  |</span>
<span class="cm">|                     unsigned char_     b_PWM            : Selected PWM (0 or 1).    |</span>
<span class="cm">|                     unsigned char_     b_ClockSelection : Selection from PCI bus    |</span>
<span class="cm">|                                                  clock                     |</span>
<span class="cm">|                                                   - APCI1710_30MHZ :       |</span>
<span class="cm">|                                                     The PC have a 30 MHz   |</span>
<span class="cm">|                                                     PCI bus clock          |</span>
<span class="cm">|                                                   - APCI1710_33MHZ :       |</span>
<span class="cm">|                                                     The PC have a 33 MHz   |</span>
<span class="cm">|                                                     PCI bus clock          |</span>
<span class="cm">|                                                   - APCI1710_40MHZ         |</span>
<span class="cm">|                                                     The APCI-1710 have a   |</span>
<span class="cm">|                                                     integrated 40Mhz       |</span>
<span class="cm">|                                                     quartz.                |</span>
<span class="cm">|                     unsigned char_     b_TimingUnit     : Base timing Unit (0 to 4) |</span>
<span class="cm">|                                                       0 : ns               |</span>
<span class="cm">|                                                       1 : æs               |</span>
<span class="cm">|                                                       2 : ms               |</span>
<span class="cm">|                                                       3 : s                |</span>
<span class="cm">|                                                       4 : mn               |</span>
<span class="cm">|                     ULONG_    ul_LowTiming     : Low base timing value.    |</span>
<span class="cm">|                     ULONG_    ul_HighTiming    : High base timing value.   |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : PULONG_  pul_RealLowTiming  : Real low base timing     |</span>
<span class="cm">|                                                   value.                   |</span>
<span class="cm">|                     PULONG_  pul_RealHighTiming : Real high base timing    |</span>
<span class="cm">|                                                   value.                   |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0: No error                                            |</span>
<span class="cm">|                    -1: The handle parameter of the board is wrong          |</span>
<span class="cm">|                    -2: Module selection wrong                              |</span>
<span class="cm">|                    -3: The module is not a PWM module                      |</span>
<span class="cm">|                    -4: PWM selection is wrong                              |</span>
<span class="cm">|                    -5: The selected input clock is wrong                   |</span>
<span class="cm">|                    -6: Timing Unit selection is wrong                      |</span>
<span class="cm">|                    -7: Low base timing selection is wrong                  |</span>
<span class="cm">|                    -8: High base timing selection is wrong                 |</span>
<span class="cm">|                    -9: You can not used the 40MHz clock selection with     |</span>
<span class="cm">|                        this board                                          |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_InitPWM</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ClockSelection</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_TimingUnit</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_LowTiming</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_HighTiming</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">pul_RealLowTiming</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">pul_RealHighTiming</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_LowTimerValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_HighTimerValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Command</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_RealLowTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_RealHighTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/******************/</span>
				<span class="cm">/* Test the clock */</span>
				<span class="cm">/******************/</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">||</span>
					<span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">||</span>
					<span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">))</span> <span class="p">{</span>
					<span class="cm">/************************/</span>
					<span class="cm">/* Test the timing unit */</span>
					<span class="cm">/************************/</span>

					<span class="k">if</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
						<span class="cm">/*********************************/</span>
						<span class="cm">/* Test the low timing selection */</span>
						<span class="cm">/*********************************/</span>

						<span class="k">if</span> <span class="p">(((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">266</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571230650UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571230UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span> <span class="mi">9UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">242</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">519691043UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">519691UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">520UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span> <span class="mi">8UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429496729UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429496UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">7UL</span><span class="p">)))</span> <span class="p">{</span>
							<span class="cm">/**********************************/</span>
							<span class="cm">/* Test the High timing selection */</span>
							<span class="cm">/**********************************/</span>

							<span class="k">if</span> <span class="p">(((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">266</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571230650UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571230UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">9UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">242</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">519691043UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">519691UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">520UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">8UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429496729UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429496UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">7UL</span><span class="p">)))</span> <span class="p">{</span>
								<span class="cm">/**************************/</span>
								<span class="cm">/* Test the board version */</span>
								<span class="cm">/**************************/</span>

								<span class="k">if</span> <span class="p">(((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">b_BoardVersion</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">))</span> <span class="p">{</span>

									<span class="cm">/************************************/</span>
									<span class="cm">/* Calculate the low division fator */</span>
									<span class="cm">/************************************/</span>

									<span class="n">fpu_begin</span>
										<span class="p">();</span>

									<span class="k">switch</span> <span class="p">(</span><span class="n">b_TimingUnit</span><span class="p">)</span> <span class="p">{</span>
										<span class="cm">/******/</span>
										<span class="cm">/* ns */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">0</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_LowTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.00025</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_LowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* æs */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">1</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_LowTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="mf">0.25</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_LowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* ms */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">2</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_LowTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_LowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/*****/</span>
										<span class="cm">/* s */</span>
										<span class="cm">/*****/</span>

									<span class="k">case</span> <span class="mi">3</span>:
										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_LowTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_LowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* mn */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">4</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="n">ul_LowTiming</span>
												<span class="o">*</span>
												<span class="mi">60</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)(</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_LowTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">))</span>
											<span class="o">/</span>
											<span class="mi">60</span><span class="p">;</span>
										<span class="n">d_RealLowTiming</span>
											<span class="o">=</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">))</span>
											<span class="o">/</span>
											<span class="mf">60.0</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealLowTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_LowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_LowTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_LowTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*************************************/</span>
									<span class="cm">/* Calculate the high division fator */</span>
									<span class="cm">/*************************************/</span>

									<span class="k">switch</span> <span class="p">(</span><span class="n">b_TimingUnit</span><span class="p">)</span> <span class="p">{</span>
										<span class="cm">/******/</span>
										<span class="cm">/* ns */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">0</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_HighTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.00025</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_HighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* æs */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">1</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_HighTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="mf">0.25</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_HighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* ms */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">2</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_HighTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_HighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/*****/</span>
										<span class="cm">/* s */</span>
										<span class="cm">/*****/</span>

									<span class="k">case</span> <span class="mi">3</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTiming</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_HighTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>
										<span class="n">d_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_HighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>

										<span class="cm">/******/</span>
										<span class="cm">/* mn */</span>
										<span class="cm">/******/</span>

									<span class="k">case</span> <span class="mi">4</span>:

										<span class="cm">/******************/</span>
										<span class="cm">/* Timer 0 factor */</span>
										<span class="cm">/******************/</span>

										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="n">ul_HighTiming</span>
												<span class="o">*</span>
												<span class="mi">60</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="n">b_ClockSelection</span><span class="p">));</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Round the value */</span>
										<span class="cm">/*******************/</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)(</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="n">ul_HighTimerValue</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="cm">/*****************************/</span>
										<span class="cm">/* Calculate the real timing */</span>
										<span class="cm">/*****************************/</span>

										<span class="o">*</span><span class="n">pul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">))</span>
											<span class="o">/</span>
											<span class="mi">60</span><span class="p">;</span>
										<span class="n">d_RealHighTiming</span>
											<span class="o">=</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">/</span>
											<span class="p">(</span><span class="mf">250000.0</span>
												<span class="o">*</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="n">b_ClockSelection</span><span class="p">))</span>
											<span class="o">/</span>
											<span class="mf">60.0</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">pul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
											<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">=</span>
												<span class="o">*</span><span class="n">pul_RealHighTiming</span>
												<span class="o">+</span>
												<span class="mi">1</span><span class="p">;</span>
										<span class="p">}</span>

										<span class="n">ul_HighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_HighTiming</span>
											<span class="o">-</span>
											<span class="mi">1</span><span class="p">;</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">-</span>
											<span class="mi">2</span><span class="p">;</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">ul_HighTimerValue</span>
												<span class="o">=</span>
												<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
												<span class="p">(</span>
												<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
												<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
												<span class="o">*</span>
												<span class="mf">1.007752288</span><span class="p">);</span>
										<span class="p">}</span>

										<span class="k">break</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">fpu_end</span><span class="p">();</span>
									<span class="cm">/****************************/</span>
									<span class="cm">/* Save the clock selection */</span>
									<span class="cm">/****************************/</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">b_ClockSelection</span>
										<span class="o">=</span>
										<span class="n">b_ClockSelection</span><span class="p">;</span>

									<span class="cm">/************************/</span>
									<span class="cm">/* Save the timing unit */</span>
									<span class="cm">/************************/</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">b_TimingUnit</span>
										<span class="o">=</span>
										<span class="n">b_TimingUnit</span><span class="p">;</span>

									<span class="cm">/****************************/</span>
									<span class="cm">/* Save the low base timing */</span>
									<span class="cm">/****************************/</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">d_LowTiming</span>
										<span class="o">=</span>
										<span class="n">d_RealLowTiming</span><span class="p">;</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="o">*</span><span class="n">pul_RealLowTiming</span><span class="p">;</span>

									<span class="cm">/****************************/</span>
									<span class="cm">/* Save the high base timing */</span>
									<span class="cm">/****************************/</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">d_HighTiming</span>
										<span class="o">=</span>
										<span class="n">d_RealHighTiming</span><span class="p">;</span>

									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="o">*</span><span class="n">pul_RealHighTiming</span><span class="p">;</span>

									<span class="cm">/************************/</span>
									<span class="cm">/* Write the low timing */</span>
									<span class="cm">/************************/</span>

									<span class="n">outl</span><span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

									<span class="cm">/*************************/</span>
									<span class="cm">/* Write the high timing */</span>
									<span class="cm">/*************************/</span>

									<span class="n">outl</span><span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

									<span class="cm">/***************************/</span>
									<span class="cm">/* Set the clock selection */</span>
									<span class="cm">/***************************/</span>

									<span class="n">dw_Command</span>
										<span class="o">=</span>
										<span class="n">inl</span>
										<span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_BoardInfos</span><span class="p">.</span>
										<span class="n">ui_Address</span>
										<span class="o">+</span>
										<span class="mi">8</span>
										<span class="o">+</span>
										<span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

									<span class="n">dw_Command</span>
										<span class="o">=</span>
										<span class="n">dw_Command</span>
										<span class="o">&amp;</span>
										<span class="mh">0x7F</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">dw_Command</span>
											<span class="o">=</span>
											<span class="n">dw_Command</span>
											<span class="o">|</span>
											<span class="mh">0x80</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/***************************/</span>
									<span class="cm">/* Set the clock selection */</span>
									<span class="cm">/***************************/</span>

									<span class="n">outl</span><span class="p">(</span><span class="n">dw_Command</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

									<span class="cm">/*************/</span>
									<span class="cm">/* PWM init. */</span>
									<span class="cm">/*************/</span>
									<span class="n">devpriv</span><span class="o">-&gt;</span>
										<span class="n">s_ModuleInfo</span>
										<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
										<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
										<span class="n">s_PWMInfo</span>
										<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
										<span class="n">b_PWMInit</span>
										<span class="o">=</span>
										<span class="mi">1</span><span class="p">;</span>
								<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
									<span class="cm">/***************************************************/</span>
									<span class="cm">/* You can not used the 40MHz clock selection with */</span>
									<span class="cm">/* this board                                      */</span>
									<span class="cm">/***************************************************/</span>
									<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;You can not used the 40MHz clock selection with this board</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
									<span class="n">i_ReturnValue</span>
										<span class="o">=</span>
										<span class="o">-</span><span class="mi">9</span><span class="p">;</span>
								<span class="p">}</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								<span class="cm">/***************************************/</span>
								<span class="cm">/* High base timing selection is wrong */</span>
								<span class="cm">/***************************************/</span>
								<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;High base timing selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
								<span class="n">i_ReturnValue</span> <span class="o">=</span>
									<span class="o">-</span><span class="mi">8</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="cm">/**************************************/</span>
							<span class="cm">/* Low base timing selection is wrong */</span>
							<span class="cm">/**************************************/</span>
							<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Low base timing selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
							<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>	<span class="cm">/*  if ((b_TimingUnit &gt;= 0) &amp;&amp; (b_TimingUnit &lt;= 4)) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/**********************************/</span>
						<span class="cm">/* Timing unit selection is wrong */</span>
						<span class="cm">/**********************************/</span>
						<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Timing unit selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/*  if ((b_TimingUnit &gt;= 0) &amp;&amp; (b_TimingUnit &lt;= 4)) */</span>
				<span class="p">}</span>	<span class="cm">/*  if ((b_ClockSelection == APCI1710_30MHZ) || (b_ClockSelection == APCI1710_33MHZ) || (b_ClockSelection == APCI1710_40MHZ)) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/*******************************/</span>
					<span class="cm">/* The selected clock is wrong */</span>
					<span class="cm">/*******************************/</span>
					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The selected clock is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if ((b_ClockSelection == APCI1710_30MHZ) || (b_ClockSelection == APCI1710_33MHZ) || (b_ClockSelection == APCI1710_40MHZ)) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_ i_APCI1710_GetPWMInitialisation                  |</span>
<span class="cm">|                                       (unsigned char_     b_BoardHandle,            |</span>
<span class="cm">|                                        unsigned char_     b_ModulNbr,               |</span>
<span class="cm">|                                        unsigned char_     b_PWM,                    |</span>
<span class="cm">|                                        unsigned char *_   pb_TimingUnit,             |</span>
<span class="cm">|                                        PULONG_ pul_LowTiming,              |</span>
<span class="cm">|                                        PULONG_ pul_HighTiming,             |</span>
<span class="cm">|                                        unsigned char *_   pb_StartLevel,             |</span>
<span class="cm">|                                        unsigned char *_   pb_StopMode,               |</span>
<span class="cm">|                                        unsigned char *_   pb_StopLevel,              |</span>
<span class="cm">|                                        unsigned char *_   pb_ExternGate,             |</span>
<span class="cm">|                                        unsigned char *_   pb_InterruptEnable,        |</span>
<span class="cm">|                                        unsigned char *_   pb_Enable)                 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Return the PWM (b_PWM) initialisation from selected    |</span>
<span class="cm">|                     module (b_ModulNbr). You must calling the              |</span>
<span class="cm">|                     &quot;i_APCI1710_InitPWM&quot; function be for you call this     |</span>
<span class="cm">|                     function.                                              |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned char_ b_BoardHandle : Handle of board APCI-1710        |</span>
<span class="cm">|                     unsigned char_ b_ModulNbr    : Selected module number (0 to 3)  |</span>
<span class="cm">|                     unsigned char_ b_PWM         : Selected PWM (0 or 1)            |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : unsigned char *_  pb_TimingUnit      : Base timing Unit (0 to 4) |</span>
<span class="cm">|                                                       0 : ns               |</span>
<span class="cm">|                                                       1 : æs               |</span>
<span class="cm">|                                                       2 : ms               |</span>
<span class="cm">|                                                       3 : s                |</span>
<span class="cm">|                                                       4 : mn               |</span>
<span class="cm">|                     PULONG_ pul_LowTiming      : Low base timing value.    |</span>
<span class="cm">|                     PULONG_ pul_HighTiming     : High base timing value.   |</span>
<span class="cm">|                     unsigned char *_  pb_StartLevel      : Start period level        |</span>
<span class="cm">|                                                  selection                 |</span>
<span class="cm">|                                                       0 : The period start |</span>
<span class="cm">|                                                           with a low level |</span>
<span class="cm">|                                                       1 : The period start |</span>
<span class="cm">|                                                           with a high level|</span>
<span class="cm">|                     unsigned char *_  pb_StopMode        : Stop mode selection       |</span>
<span class="cm">|                                                  0 : The PWM is stopped    |</span>
<span class="cm">|                                                      directly after the    |</span>
<span class="cm">|                                                     &quot;i_APCI1710_DisablePWM&quot;|</span>
<span class="cm">|                                                      function and break the|</span>
<span class="cm">|                                                      last period           |</span>
<span class="cm">|                                                  1 : After the             |</span>
<span class="cm">|                                                     &quot;i_APCI1710_DisablePWM&quot;|</span>
<span class="cm">|                                                      function the PWM is   |</span>
<span class="cm">|                                                      stopped at the end    |</span>
<span class="cm">|                                                      from last period cycle|</span>
<span class="cm">|                     unsigned char *_  pb_StopLevel        : Stop PWM level selection |</span>
<span class="cm">|                                                    0 : The output signal   |</span>
<span class="cm">|                                                        keep the level after|</span>
<span class="cm">|                                                        the                 |</span>
<span class="cm">|                                                     &quot;i_APCI1710_DisablePWM&quot;|</span>
<span class="cm">|                                                        function            |</span>
<span class="cm">|                                                    1 : The output signal is|</span>
<span class="cm">|                                                        set to low after the|</span>
<span class="cm">|                                                     &quot;i_APCI1710_DisablePWM&quot;|</span>
<span class="cm">|                                                        function            |</span>
<span class="cm">|                                                    2 : The output signal is|</span>
<span class="cm">|                                                        set to high after   |</span>
<span class="cm">|                                                        the                 |</span>
<span class="cm">|                                                     &quot;i_APCI1710_DisablePWM&quot;|</span>
<span class="cm">|                                                        function            |</span>
<span class="cm">|                     unsigned char *_  pb_ExternGate      : Extern gate action        |</span>
<span class="cm">|                                                  selection                 |</span>
<span class="cm">|                                                   0 : Extern gate signal   |</span>
<span class="cm">|                                                       not used.            |</span>
<span class="cm">|                                                   1 : Extern gate signal   |</span>
<span class="cm">|                                                       used.                |</span>
<span class="cm">|                     unsigned char *_  pb_InterruptEnable : Enable or disable the PWM |</span>
<span class="cm">|                                                  interrupt.                |</span>
<span class="cm">|                                                  - APCI1710_ENABLE :       |</span>
<span class="cm">|                                                    Enable the PWM interrupt|</span>
<span class="cm">|                                                    A interrupt occur after |</span>
<span class="cm">|                                                    each period             |</span>
<span class="cm">|                                                  - APCI1710_DISABLE :      |</span>
<span class="cm">|                                                    Disable the PWM         |</span>
<span class="cm">|                                                    interrupt               |</span>
<span class="cm">|                     unsigned char *_  pb_Enable          : Indicate if the PWM is    |</span>
<span class="cm">|                                                  enabled or no             |</span>
<span class="cm">|                                                       0 : PWM not enabled  |</span>
<span class="cm">|                                                       1 : PWM enabled      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :  0: No error                                           |</span>
<span class="cm">|                     -1: The handle parameter of the board is wrong         |</span>
<span class="cm">|                     -2: Module selection wrong                             |</span>
<span class="cm">|                     -3: The module is not a PWM module                     |</span>
<span class="cm">|                     -4: PWM selection is wrong                             |</span>
<span class="cm">|                     -5: PWM not initialised see function                   |</span>
<span class="cm">|                         &quot;i_APCI1710_InitPWM&quot;                               |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_GetPWMInitialisation</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_TimingUnit</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">pul_LowTiming</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">pul_HighTiming</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_StartLevel</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_StopMode</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_StopLevel</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_ExternGate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_InterruptEnable</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_Enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Command</span><span class="p">;</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/***************************/</span>
				<span class="cm">/* Test if PWM initialised */</span>
				<span class="cm">/***************************/</span>

				<span class="n">dw_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
					<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* Read the low timing */</span>
					<span class="cm">/***********************/</span>

					<span class="o">*</span><span class="n">pul_LowTiming</span> <span class="o">=</span>
						<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
						<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
						<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

					<span class="cm">/************************/</span>
					<span class="cm">/* Read the high timing */</span>
					<span class="cm">/************************/</span>

					<span class="o">*</span><span class="n">pul_HighTiming</span> <span class="o">=</span>
						<span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
						<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
						<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

					<span class="cm">/********************/</span>
					<span class="cm">/* Read the command */</span>
					<span class="cm">/********************/</span>

					<span class="n">dw_Command</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
						<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
						<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

					<span class="o">*</span><span class="n">pb_StartLevel</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">*</span><span class="n">pb_StopMode</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">*</span><span class="n">pb_StopLevel</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">*</span><span class="n">pb_ExternGate</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="o">*</span><span class="n">pb_InterruptEnable</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">pb_StopLevel</span><span class="p">)</span> <span class="p">{</span>
						<span class="o">*</span><span class="n">pb_StopLevel</span> <span class="o">=</span>
							<span class="o">*</span><span class="n">pb_StopLevel</span> <span class="o">+</span>
							<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span>
								<span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>

					<span class="cm">/********************/</span>
					<span class="cm">/* Read the command */</span>
					<span class="cm">/********************/</span>

					<span class="n">dw_Command</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
						<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
						<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

					<span class="o">*</span><span class="n">pb_Enable</span> <span class="o">=</span>
						<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Command</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>

					<span class="o">*</span><span class="n">pb_TimingUnit</span> <span class="o">=</span> <span class="n">devpriv</span><span class="o">-&gt;</span>
						<span class="n">s_ModuleInfo</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
						<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
						<span class="n">s_PWMInfo</span><span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span><span class="n">b_TimingUnit</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* PWM not initialised */</span>
					<span class="cm">/***********************/</span>
					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     :INT i_APCI1710_InsnWritePWM(struct comedi_device *dev,</span>
<span class="cm">struct comedi_subdevice *s,struct comedi_insn *insn,unsigned int *data)                        |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Pwm Enable Disable and Set New Timing                  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_InsnWritePWM</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_WriteType</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">b_WriteType</span> <span class="o">=</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">b_WriteType</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">APCI1710_PWM_ENABLE</span>:
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">i_APCI1710_EnablePWM</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">),</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">APCI1710_PWM_DISABLE</span>:
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">i_APCI1710_DisablePWM</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">),</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">APCI1710_PWM_NEWTIMING</span>:
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">i_APCI1710_SetNewPWMTiming</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">),</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Write Config Parameter Wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i_ReturnValue</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_     i_APCI1710_EnablePWM                         |</span>
<span class="cm">|                                       (unsigned char_  b_BoardHandle,               |</span>
<span class="cm">|                                        unsigned char_  b_ModulNbr,                  |</span>
<span class="cm">|                                        unsigned char_  b_PWM,                       |</span>
<span class="cm">|                                        unsigned char_  b_StartLevel,                |</span>
<span class="cm">|                                        unsigned char_  b_StopMode,                  |</span>
<span class="cm">|                                        unsigned char_  b_StopLevel,                 |</span>
<span class="cm">|                                        unsigned char_  b_ExternGate,                |</span>
<span class="cm">|                                        unsigned char_  b_InterruptEnable)           |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Enable the selected PWM (b_PWM) from selected module   |</span>
<span class="cm">|                     (b_ModulNbr). You must calling the &quot;i_APCI1710_InitPWM&quot;|</span>
<span class="cm">|                     function be for you call this function.                |</span>
<span class="cm">|                     If you enable the PWM interrupt, the PWM generate a    |</span>
<span class="cm">|                     interrupt after each period.                           |</span>
<span class="cm">|                     See function &quot;i_APCI1710_SetBoardIntRoutineX&quot; and the  |</span>
<span class="cm">|                     Interrupt mask description chapter.                    |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned char_ b_BoardHandle     : Handle of board APCI-1710    |</span>
<span class="cm">|                     unsigned char_ b_ModulNbr        : Selected module number       |</span>
<span class="cm">|                                               (0 to 3)                     |</span>
<span class="cm">|                     unsigned char_ b_PWM             : Selected PWM (0 or 1)        |</span>
<span class="cm">|                     unsigned char_ b_StartLevel      : Start period level selection |</span>
<span class="cm">|                                                0 : The period start with a |</span>
<span class="cm">|                                                    low level               |</span>
<span class="cm">|                                                1 : The period start with a |</span>
<span class="cm">|                                                    high level              |</span>
<span class="cm">|                     unsigned char_ b_StopMode        : Stop mode selection          |</span>
<span class="cm">|                                                0 : The PWM is stopped      |</span>
<span class="cm">|                                                    directly after the      |</span>
<span class="cm">|                                                    &quot;i_APCI1710_DisablePWM&quot; |</span>
<span class="cm">|                                                    function and break the  |</span>
<span class="cm">|                                                    last period             |</span>
<span class="cm">|                                                1 : After the               |</span>
<span class="cm">|                                                    &quot;i_APCI1710_DisablePWM&quot; |</span>
<span class="cm">|                                                     function the PWM is    |</span>
<span class="cm">|                                                     stopped at the end from|</span>
<span class="cm">|                                                     last period cycle.     |</span>
<span class="cm">|                     unsigned char_ b_StopLevel       : Stop PWM level selection     |</span>
<span class="cm">|                                                0 : The output signal keep  |</span>
<span class="cm">|                                                    the level after the     |</span>
<span class="cm">|                                                    &quot;i_APCI1710_DisablePWM&quot; |</span>
<span class="cm">|                                                    function                |</span>
<span class="cm">|                                                1 : The output signal is set|</span>
<span class="cm">|                                                    to low after the        |</span>
<span class="cm">|                                                    &quot;i_APCI1710_DisablePWM&quot; |</span>
<span class="cm">|                                                    function                |</span>
<span class="cm">|                                                2 : The output signal is set|</span>
<span class="cm">|                                                    to high after the       |</span>
<span class="cm">|                                                    &quot;i_APCI1710_DisablePWM&quot; |</span>
<span class="cm">|                                                    function                |</span>
<span class="cm">|                     unsigned char_ b_ExternGate      : Extern gate action selection |</span>
<span class="cm">|                                                0 : Extern gate signal not  |</span>
<span class="cm">|                                                    used.                   |</span>
<span class="cm">|                                                1 : Extern gate signal used.|</span>
<span class="cm">|                     unsigned char_ b_InterruptEnable : Enable or disable the PWM    |</span>
<span class="cm">|                                               interrupt.                   |</span>
<span class="cm">|                                               - APCI1710_ENABLE :          |</span>
<span class="cm">|                                                 Enable the PWM interrupt   |</span>
<span class="cm">|                                                 A interrupt occur after    |</span>
<span class="cm">|                                                 each period                |</span>
<span class="cm">|                                               - APCI1710_DISABLE :         |</span>
<span class="cm">|                                                 Disable the PWM interrupt  |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0:  No error                                           |</span>
<span class="cm">|                    -1:  The handle parameter of the board is wrong         |</span>
<span class="cm">|                    -2:  Module selection wrong                             |</span>
<span class="cm">|                    -3:  The module is not a PWM module                     |</span>
<span class="cm">|                    -4:  PWM selection is wrong                             |</span>
<span class="cm">|                    -5:  PWM not initialised see function                   |</span>
<span class="cm">|                         &quot;i_APCI1710_InitPWM&quot;                               |</span>
<span class="cm">|                    -6:  PWM start level selection is wrong                 |</span>
<span class="cm">|                    -7:  PWM stop mode selection is wrong                   |</span>
<span class="cm">|                    -8:  PWM stop level selection is wrong                  |</span>
<span class="cm">|                    -9:  Extern gate signal selection is wrong              |</span>
<span class="cm">|                    -10: Interrupt parameter is wrong                       |</span>
<span class="cm">|                    -11: Interrupt function not initialised.                |</span>
<span class="cm">|                         See function &quot;i_APCI1710_SetBoardIntRoutineX&quot;      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_EnablePWM</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_StartLevel</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_StopMode</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_StopLevel</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ExternGate</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_InterruptEnable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Command</span><span class="p">;</span>

	<span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">tsk_Current</span> <span class="o">=</span> <span class="n">current</span><span class="p">;</span>	<span class="cm">/*  Save the current process task structure */</span>
	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/***************************/</span>
				<span class="cm">/* Test if PWM initialised */</span>
				<span class="cm">/***************************/</span>

				<span class="n">dw_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
					<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/**********************************/</span>
					<span class="cm">/* Test the start level selection */</span>
					<span class="cm">/**********************************/</span>

					<span class="k">if</span> <span class="p">(</span><span class="n">b_StartLevel</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
						<span class="cm">/**********************/</span>
						<span class="cm">/* Test the stop mode */</span>
						<span class="cm">/**********************/</span>

						<span class="k">if</span> <span class="p">(</span><span class="n">b_StopMode</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
							<span class="cm">/***********************/</span>
							<span class="cm">/* Test the stop level */</span>
							<span class="cm">/***********************/</span>

							<span class="k">if</span> <span class="p">(</span><span class="n">b_StopLevel</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
								<span class="cm">/*****************************/</span>
								<span class="cm">/* Test the extern gate mode */</span>
								<span class="cm">/*****************************/</span>

								<span class="k">if</span> <span class="p">(</span><span class="n">b_ExternGate</span>
									<span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
									<span class="cm">/*****************************/</span>
									<span class="cm">/* Test the interrupt action */</span>
									<span class="cm">/*****************************/</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_InterruptEnable</span> <span class="o">==</span> <span class="n">APCI1710_ENABLE</span> <span class="o">||</span> <span class="n">b_InterruptEnable</span> <span class="o">==</span> <span class="n">APCI1710_DISABLE</span><span class="p">)</span> <span class="p">{</span>
										<span class="cm">/******************************************/</span>
										<span class="cm">/* Test if interrupt function initialised */</span>
										<span class="cm">/******************************************/</span>

										<span class="cm">/********************/</span>
										<span class="cm">/* Read the command */</span>
										<span class="cm">/********************/</span>

										<span class="n">dw_Command</span>
											<span class="o">=</span>
											<span class="n">inl</span>
											<span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span>
											<span class="n">s_BoardInfos</span><span class="p">.</span>
											<span class="n">ui_Address</span>
											<span class="o">+</span>
											<span class="mi">8</span>
											<span class="o">+</span>
											<span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

										<span class="n">dw_Command</span>
											<span class="o">=</span>
											<span class="n">dw_Command</span>
											<span class="o">&amp;</span>
											<span class="mh">0x80</span><span class="p">;</span>

										<span class="cm">/********************/</span>
										<span class="cm">/* Make the command */</span>
										<span class="cm">/********************/</span>

										<span class="n">dw_Command</span>
											<span class="o">=</span>
											<span class="n">dw_Command</span>
											<span class="o">|</span>
											<span class="n">b_StopMode</span>
											<span class="o">|</span>
											<span class="p">(</span><span class="n">b_InterruptEnable</span>
											<span class="o">&lt;&lt;</span>
											<span class="mi">3</span><span class="p">)</span>
											<span class="o">|</span>
											<span class="p">(</span><span class="n">b_ExternGate</span>
											<span class="o">&lt;&lt;</span>
											<span class="mi">4</span><span class="p">)</span>
											<span class="o">|</span>
											<span class="p">(</span><span class="n">b_StartLevel</span>
											<span class="o">&lt;&lt;</span>
											<span class="mi">5</span><span class="p">);</span>

										<span class="k">if</span> <span class="p">(</span><span class="n">b_StopLevel</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
											<span class="n">dw_Command</span>
												<span class="o">=</span>
												<span class="n">dw_Command</span>
												<span class="o">|</span>
												<span class="mi">2</span><span class="p">;</span>

											<span class="k">if</span> <span class="p">(</span><span class="n">b_StopLevel</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
												<span class="n">dw_Command</span>
													<span class="o">=</span>
													<span class="n">dw_Command</span>
													<span class="o">|</span>
													<span class="mi">4</span><span class="p">;</span>
											<span class="p">}</span>
										<span class="p">}</span>

										<span class="n">devpriv</span><span class="o">-&gt;</span>
											<span class="n">s_ModuleInfo</span>
											<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
											<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
											<span class="n">s_PWMInfo</span>
											<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
											<span class="n">b_InterruptEnable</span>
											<span class="o">=</span>
											<span class="n">b_InterruptEnable</span><span class="p">;</span>

										<span class="cm">/*******************/</span>
										<span class="cm">/* Set the command */</span>
										<span class="cm">/*******************/</span>

										<span class="n">outl</span><span class="p">(</span><span class="n">dw_Command</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

										<span class="cm">/******************/</span>
										<span class="cm">/* Enable the PWM */</span>
										<span class="cm">/******************/</span>
										<span class="n">outl</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>
									<span class="p">}</span>	<span class="cm">/*  if (b_InterruptEnable == APCI1710_ENABLE || b_InterruptEnable == APCI1710_DISABLE) */</span>
									<span class="k">else</span> <span class="p">{</span>
										<span class="cm">/********************************/</span>
										<span class="cm">/* Interrupt parameter is wrong */</span>
										<span class="cm">/********************************/</span>
										<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Interrupt parameter is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
										<span class="n">i_ReturnValue</span>
											<span class="o">=</span>
											<span class="o">-</span><span class="mi">10</span><span class="p">;</span>
									<span class="p">}</span>	<span class="cm">/*  if (b_InterruptEnable == APCI1710_ENABLE || b_InterruptEnable == APCI1710_DISABLE) */</span>
								<span class="p">}</span>	<span class="cm">/*  if (b_ExternGate &gt;= 0 &amp;&amp; b_ExternGate &lt;= 1) */</span>
								<span class="k">else</span> <span class="p">{</span>
									<span class="cm">/*****************************************/</span>
									<span class="cm">/* Extern gate signal selection is wrong */</span>
									<span class="cm">/*****************************************/</span>
									<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Extern gate signal selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
									<span class="n">i_ReturnValue</span>
										<span class="o">=</span>
										<span class="o">-</span><span class="mi">9</span><span class="p">;</span>
								<span class="p">}</span>	<span class="cm">/*  if (b_ExternGate &gt;= 0 &amp;&amp; b_ExternGate &lt;= 1) */</span>
							<span class="p">}</span>	<span class="cm">/*  if (b_StopLevel &gt;= 0 &amp;&amp; b_StopLevel &lt;= 2) */</span>
							<span class="k">else</span> <span class="p">{</span>
								<span class="cm">/*************************************/</span>
								<span class="cm">/* PWM stop level selection is wrong */</span>
								<span class="cm">/*************************************/</span>
								<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM stop level selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
								<span class="n">i_ReturnValue</span> <span class="o">=</span>
									<span class="o">-</span><span class="mi">8</span><span class="p">;</span>
							<span class="p">}</span>	<span class="cm">/*  if (b_StopLevel &gt;= 0 &amp;&amp; b_StopLevel &lt;= 2) */</span>
						<span class="p">}</span>	<span class="cm">/*  if (b_StopMode &gt;= 0 &amp;&amp; b_StopMode &lt;= 1) */</span>
						<span class="k">else</span> <span class="p">{</span>
							<span class="cm">/************************************/</span>
							<span class="cm">/* PWM stop mode selection is wrong */</span>
							<span class="cm">/************************************/</span>
							<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM stop mode selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
							<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">;</span>
						<span class="p">}</span>	<span class="cm">/*  if (b_StopMode &gt;= 0 &amp;&amp; b_StopMode &lt;= 1) */</span>
					<span class="p">}</span>	<span class="cm">/*  if (b_StartLevel &gt;= 0 &amp;&amp; b_StartLevel &lt;= 1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/**************************************/</span>
						<span class="cm">/* PWM start level selection is wrong */</span>
						<span class="cm">/**************************************/</span>
						<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM start level selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/*  if (b_StartLevel &gt;= 0 &amp;&amp; b_StartLevel &lt;= 1) */</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* PWM not initialised */</span>
					<span class="cm">/***********************/</span>
					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_ i_APCI1710_DisablePWM (unsigned char_  b_BoardHandle,     |</span>
<span class="cm">|                                                  unsigned char_  b_ModulNbr,        |</span>
<span class="cm">|                                                  unsigned char_  b_PWM)             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Disable the selected PWM (b_PWM) from selected module  |</span>
<span class="cm">|                     (b_ModulNbr). The output signal level depend of the    |</span>
<span class="cm">|                     initialisation by the &quot;i_APCI1710_EnablePWM&quot;.          |</span>
<span class="cm">|                     See the b_StartLevel, b_StopMode and b_StopLevel       |</span>
<span class="cm">|                     parameters from this function.                         |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  :BYTE_ b_BoardHandle : Handle of board APCI-1710         |</span>
<span class="cm">|                    unsigned char_ b_ModulNbr    : Selected module number (0 to 3)   |</span>
<span class="cm">|                    unsigned char_ b_PWM         : Selected PWM (0 or 1)             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :  0: No error                                           |</span>
<span class="cm">|                     -1: The handle parameter of the board is wrong         |</span>
<span class="cm">|                     -2: Module selection wrong                             |</span>
<span class="cm">|                     -3: The module is not a PWM module                     |</span>
<span class="cm">|                     -4: PWM selection is wrong                             |</span>
<span class="cm">|                     -5: PWM not initialised see function                   |</span>
<span class="cm">|                         &quot;i_APCI1710_InitPWM&quot;                               |</span>
<span class="cm">|                     -6: PWM not enabled see function                       |</span>
<span class="cm">|                         &quot;i_APCI1710_EnablePWM&quot;                             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_DisablePWM</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Status</span><span class="p">;</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/***************************/</span>
				<span class="cm">/* Test if PWM initialised */</span>
				<span class="cm">/***************************/</span>

				<span class="n">dw_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
					<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* Test if PWM enabled */</span>
					<span class="cm">/***********************/</span>

					<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
						<span class="cm">/*******************/</span>
						<span class="cm">/* Disable the PWM */</span>
						<span class="cm">/*******************/</span>
						<span class="n">outl</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
							<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span>
							<span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
							<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>
					<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/*******************/</span>
						<span class="cm">/* PWM not enabled */</span>
						<span class="cm">/*******************/</span>
						<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x1) */</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* PWM not initialised */</span>
					<span class="cm">/***********************/</span>
					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot; PWM not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_ i_APCI1710_SetNewPWMTiming                       |</span>
<span class="cm">|                                       (unsigned char_     b_BoardHandle,            |</span>
<span class="cm">|                                        unsigned char_     b_ModulNbr,               |</span>
<span class="cm">|                                        unsigned char_     b_PWM,                    |</span>
<span class="cm">|                                        unsigned char_     b_ClockSelection,         |</span>
<span class="cm">|                                        unsigned char_     b_TimingUnit,             |</span>
<span class="cm">|                                        ULONG_   ul_LowTiming,              |</span>
<span class="cm">|                                        ULONG_   ul_HighTiming)             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Set a new timing. The ul_LowTiming, ul_HighTiming and  |</span>
<span class="cm">|                     ul_TimingUnit determine the low/high timing base for   |</span>
<span class="cm">|                     the period.                                            |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned char_     b_BoardHandle    : Handle of board APCI-1710 |</span>
<span class="cm">|                     unsigned char_     b_ModulNbr       : Module number to configure|</span>
<span class="cm">|                                                  (0 to 3)                  |</span>
<span class="cm">|                     unsigned char_     b_PWM            : Selected PWM (0 or 1).    |</span>
<span class="cm">|                     unsigned char_     b_TimingUnit     : Base timing Unit (0 to 4) |</span>
<span class="cm">|                                                       0 : ns               |</span>
<span class="cm">|                                                       1 : æs               |</span>
<span class="cm">|                                                       2 : ms               |</span>
<span class="cm">|                                                       3 : s                |</span>
<span class="cm">|                                                       4 : mn               |</span>
<span class="cm">|                     ULONG_    ul_LowTiming     : Low base timing value.    |</span>
<span class="cm">|                     ULONG_    ul_HighTiming    : High base timing value.   |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : -                                                      |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      : 0: No error                                            |</span>
<span class="cm">|                    -1: The handle parameter of the board is wrong          |</span>
<span class="cm">|                    -2: Module selection wrong                              |</span>
<span class="cm">|                    -3: The module is not a PWM module                      |</span>
<span class="cm">|                    -4: PWM selection is wrong                              |</span>
<span class="cm">|                    -5: PWM not initialised                                 |</span>
<span class="cm">|                    -6: Timing Unit selection is wrong                      |</span>
<span class="cm">|                    -7: Low base timing selection is wrong                  |</span>
<span class="cm">|                    -8: High base timing selection is wrong                 |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_SetNewPWMTiming</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_TimingUnit</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_LowTiming</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_HighTiming</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ClockSelection</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_LowTimerValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_HighTimerValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_RealLowTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ul_RealHighTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Command</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_RealLowTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">double</span> <span class="n">d_RealHighTiming</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/***************************/</span>
				<span class="cm">/* Test if PWM initialised */</span>
				<span class="cm">/***************************/</span>

				<span class="n">dw_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
					<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">b_ClockSelection</span> <span class="o">=</span> <span class="n">devpriv</span><span class="o">-&gt;</span>
						<span class="n">s_ModuleInfo</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
						<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
						<span class="n">b_ClockSelection</span><span class="p">;</span>

					<span class="cm">/************************/</span>
					<span class="cm">/* Test the timing unit */</span>
					<span class="cm">/************************/</span>

					<span class="k">if</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
						<span class="cm">/*********************************/</span>
						<span class="cm">/* Test the low timing selection */</span>
						<span class="cm">/*********************************/</span>

						<span class="k">if</span> <span class="p">(((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">266</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571230650UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571230UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">571UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_30MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span> <span class="mi">9UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">242</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">519691043UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">519691UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">520UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_33MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span> <span class="mi">8UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mh">0xFFFFFFFFUL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429496729UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429496UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">429UL</span><span class="p">))</span>
							<span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span>
									<span class="n">APCI1710_40MHZ</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span>
									<span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
								<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_LowTiming</span>
									<span class="o">&lt;=</span>
									<span class="mi">7UL</span><span class="p">)))</span> <span class="p">{</span>
							<span class="cm">/**********************************/</span>
							<span class="cm">/* Test the High timing selection */</span>
							<span class="cm">/**********************************/</span>

							<span class="k">if</span> <span class="p">(((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">266</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571230650UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571230UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">571UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_30MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">9UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">242</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">519691043UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">519691UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">520UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_33MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">8UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mh">0xFFFFFFFFUL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429496729UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429496UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">429UL</span><span class="p">))</span> <span class="o">||</span> <span class="p">((</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b_TimingUnit</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ul_HighTiming</span> <span class="o">&lt;=</span> <span class="mi">7UL</span><span class="p">)))</span> <span class="p">{</span>
								<span class="cm">/************************************/</span>
								<span class="cm">/* Calculate the low division fator */</span>
								<span class="cm">/************************************/</span>

								<span class="n">fpu_begin</span><span class="p">();</span>
								<span class="k">switch</span> <span class="p">(</span><span class="n">b_TimingUnit</span><span class="p">)</span> <span class="p">{</span>
									<span class="cm">/******/</span>
									<span class="cm">/* ns */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">0</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.00025</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealLowTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_LowTiming</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* æs */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">1</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="mf">0.25</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealLowTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_LowTiming</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* ms */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">2</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250.0</span>
										<span class="o">*</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250.0</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealLowTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_LowTiming</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/*****/</span>
									<span class="cm">/* s */</span>
									<span class="cm">/*****/</span>

								<span class="k">case</span> <span class="mi">3</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealLowTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_LowTiming</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* mn */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">4</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="n">ul_LowTiming</span>
											<span class="o">*</span>
											<span class="mi">60</span><span class="p">)</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)(</span><span class="n">ul_LowTiming</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_LowTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">))</span>
										<span class="o">/</span>
										<span class="mi">60</span><span class="p">;</span>
									<span class="n">d_RealLowTiming</span>
										<span class="o">=</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">))</span>
										<span class="o">/</span>
										<span class="mf">60.0</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_LowTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealLowTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealLowTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealLowTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_LowTiming</span>
										<span class="o">=</span>
										<span class="n">ul_LowTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_LowTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_LowTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_LowTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>
								<span class="p">}</span>

								<span class="cm">/*************************************/</span>
								<span class="cm">/* Calculate the high division fator */</span>
								<span class="cm">/*************************************/</span>

								<span class="k">switch</span> <span class="p">(</span><span class="n">b_TimingUnit</span><span class="p">)</span> <span class="p">{</span>
									<span class="cm">/******/</span>
									<span class="cm">/* ns */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">0</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.00025</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.00025</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealHighTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_HighTiming</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* æs */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">1</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="mf">0.25</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealHighTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_HighTiming</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* ms */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">2</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250.0</span>
										<span class="o">*</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250.0</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealHighTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_HighTiming</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/*****/</span>
									<span class="cm">/* s */</span>
									<span class="cm">/*****/</span>

								<span class="k">case</span> <span class="mi">3</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTiming</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>
									<span class="n">d_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">b_ClockSelection</span><span class="p">);</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealHighTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_HighTiming</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>

									<span class="cm">/******/</span>
									<span class="cm">/* mn */</span>
									<span class="cm">/******/</span>

								<span class="k">case</span> <span class="mi">4</span>:

									<span class="cm">/******************/</span>
									<span class="cm">/* Timer 0 factor */</span>
									<span class="cm">/******************/</span>

									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="n">ul_HighTiming</span>
											<span class="o">*</span>
											<span class="mi">60</span><span class="p">)</span>
										<span class="o">*</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="n">b_ClockSelection</span><span class="p">));</span>

									<span class="cm">/*******************/</span>
									<span class="cm">/* Round the value */</span>
									<span class="cm">/*******************/</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)(</span><span class="n">ul_HighTiming</span> <span class="o">*</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)))</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="n">ul_HighTimerValue</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="cm">/*****************************/</span>
									<span class="cm">/* Calculate the real timing */</span>
									<span class="cm">/*****************************/</span>

									<span class="n">ul_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
										<span class="p">(</span><span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">))</span>
										<span class="o">/</span>
										<span class="mi">60</span><span class="p">;</span>
									<span class="n">d_RealHighTiming</span>
										<span class="o">=</span>
										<span class="p">(</span>
										<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">/</span>
										<span class="p">(</span><span class="mf">250000.0</span>
											<span class="o">*</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="n">b_ClockSelection</span><span class="p">))</span>
										<span class="o">/</span>
										<span class="mf">60.0</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">((</span><span class="kt">double</span><span class="p">)(((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_HighTimerValue</span> <span class="o">/</span> <span class="p">(</span><span class="mf">250000.0</span> <span class="o">*</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">b_ClockSelection</span><span class="p">))</span> <span class="o">/</span> <span class="mf">60.0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)((</span><span class="kt">double</span><span class="p">)</span><span class="n">ul_RealHighTiming</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">))</span> <span class="p">{</span>
										<span class="n">ul_RealHighTiming</span>
											<span class="o">=</span>
											<span class="n">ul_RealHighTiming</span>
											<span class="o">+</span>
											<span class="mi">1</span><span class="p">;</span>
									<span class="p">}</span>

									<span class="n">ul_HighTiming</span>
										<span class="o">=</span>
										<span class="n">ul_HighTiming</span>
										<span class="o">-</span>
										<span class="mi">1</span><span class="p">;</span>
									<span class="n">ul_HighTimerValue</span>
										<span class="o">=</span>
										<span class="n">ul_HighTimerValue</span>
										<span class="o">-</span>
										<span class="mi">2</span><span class="p">;</span>

									<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">!=</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
										<span class="n">ul_HighTimerValue</span>
											<span class="o">=</span>
											<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span>
											<span class="p">(</span>
											<span class="p">(</span><span class="kt">double</span><span class="p">)</span>
											<span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">)</span>
											<span class="o">*</span>
											<span class="mf">1.007752288</span><span class="p">);</span>
									<span class="p">}</span>

									<span class="k">break</span><span class="p">;</span>
								<span class="p">}</span>

								<span class="n">fpu_end</span><span class="p">();</span>

								<span class="cm">/************************/</span>
								<span class="cm">/* Save the timing unit */</span>
								<span class="cm">/************************/</span>

								<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_ModuleInfo</span>
									<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
									<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
									<span class="n">s_PWMInfo</span>
									<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
									<span class="n">b_TimingUnit</span>
									<span class="o">=</span>
									<span class="n">b_TimingUnit</span><span class="p">;</span>

								<span class="cm">/****************************/</span>
								<span class="cm">/* Save the low base timing */</span>
								<span class="cm">/****************************/</span>

								<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_ModuleInfo</span>
									<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
									<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
									<span class="n">s_PWMInfo</span>
									<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
									<span class="n">d_LowTiming</span>
									<span class="o">=</span>
									<span class="n">d_RealLowTiming</span><span class="p">;</span>

								<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_ModuleInfo</span>
									<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
									<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
									<span class="n">s_PWMInfo</span>
									<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
									<span class="n">ul_RealLowTiming</span>
									<span class="o">=</span>
									<span class="n">ul_RealLowTiming</span><span class="p">;</span>

								<span class="cm">/****************************/</span>
								<span class="cm">/* Save the high base timing */</span>
								<span class="cm">/****************************/</span>

								<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_ModuleInfo</span>
									<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
									<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
									<span class="n">s_PWMInfo</span>
									<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
									<span class="n">d_HighTiming</span>
									<span class="o">=</span>
									<span class="n">d_RealHighTiming</span><span class="p">;</span>

								<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_ModuleInfo</span>
									<span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">].</span>
									<span class="n">s_PWMModuleInfo</span><span class="p">.</span>
									<span class="n">s_PWMInfo</span>
									<span class="p">[</span><span class="n">b_PWM</span><span class="p">].</span>
									<span class="n">ul_RealHighTiming</span>
									<span class="o">=</span>
									<span class="n">ul_RealHighTiming</span><span class="p">;</span>

								<span class="cm">/************************/</span>
								<span class="cm">/* Write the low timing */</span>
								<span class="cm">/************************/</span>

								<span class="n">outl</span><span class="p">(</span><span class="n">ul_LowTimerValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

								<span class="cm">/*************************/</span>
								<span class="cm">/* Write the high timing */</span>
								<span class="cm">/*************************/</span>

								<span class="n">outl</span><span class="p">(</span><span class="n">ul_HighTimerValue</span><span class="p">,</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span><span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

								<span class="cm">/***************************/</span>
								<span class="cm">/* Set the clock selection */</span>
								<span class="cm">/***************************/</span>

								<span class="n">dw_Command</span> <span class="o">=</span>
									<span class="n">inl</span>
									<span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_BoardInfos</span><span class="p">.</span>
									<span class="n">ui_Address</span>
									<span class="o">+</span> <span class="mi">8</span> <span class="o">+</span>
									<span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

								<span class="n">dw_Command</span> <span class="o">=</span>
									<span class="n">dw_Command</span>
									<span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">;</span>

								<span class="k">if</span> <span class="p">(</span><span class="n">b_ClockSelection</span> <span class="o">==</span> <span class="n">APCI1710_40MHZ</span><span class="p">)</span> <span class="p">{</span>
									<span class="n">dw_Command</span>
										<span class="o">=</span>
										<span class="n">dw_Command</span>
										<span class="o">|</span>
										<span class="mh">0x80</span><span class="p">;</span>
								<span class="p">}</span>

								<span class="cm">/***************************/</span>
								<span class="cm">/* Set the clock selection */</span>
								<span class="cm">/***************************/</span>

								<span class="n">outl</span><span class="p">(</span><span class="n">dw_Command</span><span class="p">,</span>
									<span class="n">devpriv</span><span class="o">-&gt;</span>
									<span class="n">s_BoardInfos</span><span class="p">.</span>
									<span class="n">ui_Address</span>
									<span class="o">+</span> <span class="mi">8</span> <span class="o">+</span>
									<span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>
							<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
								<span class="cm">/***************************************/</span>
								<span class="cm">/* High base timing selection is wrong */</span>
								<span class="cm">/***************************************/</span>
								<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;High base timing selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
								<span class="n">i_ReturnValue</span> <span class="o">=</span>
									<span class="o">-</span><span class="mi">8</span><span class="p">;</span>
							<span class="p">}</span>
						<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
							<span class="cm">/**************************************/</span>
							<span class="cm">/* Low base timing selection is wrong */</span>
							<span class="cm">/**************************************/</span>
							<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Low base timing selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
							<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>	<span class="cm">/*  if ((b_TimingUnit &gt;= 0) &amp;&amp; (b_TimingUnit &lt;= 4)) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/**********************************/</span>
						<span class="cm">/* Timing unit selection is wrong */</span>
						<span class="cm">/**********************************/</span>
						<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Timing unit selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/*  if ((b_TimingUnit &gt;= 0) &amp;&amp; (b_TimingUnit &lt;= 4)) */</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* PWM not initialised */</span>
					<span class="cm">/***********************/</span>
					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>
				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>
			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>
		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Function Name     : _INT_ i_APCI1710_GetPWMStatus                          |</span>
<span class="cm">|                               (unsigned char_    b_BoardHandle,                     |</span>
<span class="cm">|                                unsigned char_    b_ModulNbr,                        |</span>
<span class="cm">|                                unsigned char_    b_PWM,                             |</span>
<span class="cm">|                                unsigned char *_  pb_PWMOutputStatus,                 |</span>
<span class="cm">|                                unsigned char *_  pb_ExternGateStatus)                |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Task              : Return the status from selected PWM (b_PWM) from       |</span>
<span class="cm">|                     selected module (b_ModulNbr).                          |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Input Parameters  : unsigned char_  b_BoardHandle : Handle of board APCI-1710       |</span>
<span class="cm">|                     unsigned char_  b_PWM         : Selected PWM (0 or 1)           |</span>
<span class="cm">|                     unsigned char_  b_ModulNbr    : Selected module number (0 to 3)</span>
<span class="cm">	b_ModulNbr			=(unsigned char)  CR_AREF(insn-&gt;chanspec);</span>
<span class="cm">	b_PWM				=(unsigned char)  data[0];</span>

<span class="cm"> |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Output Parameters : unsigned char *_  pb_PWMOutputStatus  : Return the PWM output    |</span>
<span class="cm">|                                                   level status.            |</span>
<span class="cm">|                                                    0 : The PWM output level|</span>
<span class="cm">|                                                        is low.             |</span>
<span class="cm">|                                                    1 : The PWM output level|</span>
<span class="cm">|                                                        is high.            |</span>
<span class="cm">|                     unsigned char *_  pb_ExternGateStatus : Return the extern gate   |</span>
<span class="cm">|                                                   level status.            |</span>
<span class="cm">|                                                    0 : The extern gate is  |</span>
<span class="cm">|                                                        low.                |</span>
<span class="cm">|                                                    1 : The extern gate is  |</span>
<span class="cm">|                                                        high.</span>
<span class="cm">    pb_PWMOutputStatus	=(unsigned char *) data[0];</span>
<span class="cm">	pb_ExternGateStatus =(unsigned char *) data[1];             |</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">| Return Value      :  0: No error                                           |</span>
<span class="cm">|                     -1: The handle parameter of the board is wrong         |</span>
<span class="cm">|                     -2: Module selection wrong                             |</span>
<span class="cm">|                     -3: The module is not a PWM module                     |</span>
<span class="cm">|                     -4: PWM selection is wrong                             |</span>
<span class="cm">|                     -5: PWM not initialised see function                   |</span>
<span class="cm">|                         &quot;i_APCI1710_InitPWM&quot;                               |</span>
<span class="cm">|                     -6: PWM not enabled see function &quot;i_APCI1710_EnablePWM&quot;|</span>
<span class="cm">+----------------------------------------------------------------------------+</span>
<span class="cm">*/</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_InsnReadGetPWMStatus</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dw_Status</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_ModulNbr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b_PWM</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_PWMOutputStatus</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pb_ExternGateStatus</span><span class="p">;</span>

	<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>
	<span class="n">b_ModulNbr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_AREF</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>
	<span class="n">b_PWM</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="n">CR_CHAN</span><span class="p">(</span><span class="n">insn</span><span class="o">-&gt;</span><span class="n">chanspec</span><span class="p">);</span>
	<span class="n">pb_PWMOutputStatus</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">pb_ExternGateStatus</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Test the module number */</span>
	<span class="cm">/**************************/</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">b_ModulNbr</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/***************/</span>
		<span class="cm">/* Test if PWM */</span>
		<span class="cm">/***************/</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
				<span class="n">dw_MolduleConfiguration</span><span class="p">[</span><span class="n">b_ModulNbr</span><span class="p">]</span> <span class="o">&amp;</span>
				<span class="mh">0xFFFF0000UL</span><span class="p">)</span> <span class="o">==</span> <span class="n">APCI1710_PWM</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/**************************/</span>
			<span class="cm">/* Test the PWM selection */</span>
			<span class="cm">/**************************/</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">b_PWM</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/***************************/</span>
				<span class="cm">/* Test if PWM initialised */</span>
				<span class="cm">/***************************/</span>

				<span class="n">dw_Status</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_BoardInfos</span><span class="p">.</span>
					<span class="n">ui_Address</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">b_PWM</span><span class="p">)</span> <span class="o">+</span>
					<span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b_ModulNbr</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* Test if PWM enabled */</span>
					<span class="cm">/***********************/</span>

					<span class="k">if</span> <span class="p">(</span><span class="n">dw_Status</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
						<span class="o">*</span><span class="n">pb_PWMOutputStatus</span> <span class="o">=</span>
							<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Status</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span>
							<span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
						<span class="o">*</span><span class="n">pb_ExternGateStatus</span> <span class="o">=</span>
							<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span><span class="p">)</span> <span class="p">((</span><span class="n">dw_Status</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span>
							<span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
					<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x1) */</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="cm">/*******************/</span>
						<span class="cm">/* PWM not enabled */</span>
						<span class="cm">/*******************/</span>

						<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not enabled </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
						<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">;</span>
					<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x1) */</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="cm">/***********************/</span>
					<span class="cm">/* PWM not initialised */</span>
					<span class="cm">/***********************/</span>

					<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;PWM not initialised</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
					<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
				<span class="p">}</span>	<span class="cm">/*  if (dw_Status &amp; 0x10) */</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="cm">/******************************/</span>
				<span class="cm">/* Tor PWM selection is wrong */</span>
				<span class="cm">/******************************/</span>

				<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Tor PWM selection is wrong</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>	<span class="cm">/*  if (b_PWM &gt;= 0 &amp;&amp; b_PWM &lt;= 1) */</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/**********************************/</span>
			<span class="cm">/* The module is not a PWM module */</span>
			<span class="cm">/**********************************/</span>

			<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;The module is not a PWM module</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/***********************/</span>
		<span class="cm">/* Module number error */</span>
		<span class="cm">/***********************/</span>

		<span class="n">DPRINTK</span><span class="p">(</span><span class="s">&quot;Module number error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">i_ReturnValue</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">i_ReturnValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">i_APCI1710_InsnBitsReadPWMInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">comedi_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">comedi_subdevice</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="k">struct</span> <span class="n">comedi_insn</span> <span class="o">*</span><span class="n">insn</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_InterruptParameters</span><span class="p">.</span>
		<span class="n">s_FIFOInterruptParameters</span><span class="p">[</span><span class="n">devpriv</span><span class="o">-&gt;</span>
		<span class="n">s_InterruptParameters</span><span class="p">.</span><span class="n">ui_Read</span><span class="p">].</span><span class="n">b_OldModuleMask</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_InterruptParameters</span><span class="p">.</span>
		<span class="n">s_FIFOInterruptParameters</span><span class="p">[</span><span class="n">devpriv</span><span class="o">-&gt;</span>
		<span class="n">s_InterruptParameters</span><span class="p">.</span><span class="n">ui_Read</span><span class="p">].</span><span class="n">ul_OldInterruptMask</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">devpriv</span><span class="o">-&gt;</span><span class="n">s_InterruptParameters</span><span class="p">.</span>
		<span class="n">s_FIFOInterruptParameters</span><span class="p">[</span><span class="n">devpriv</span><span class="o">-&gt;</span>
		<span class="n">s_InterruptParameters</span><span class="p">.</span><span class="n">ui_Read</span><span class="p">].</span><span class="n">ul_OldCounterLatchValue</span><span class="p">;</span>

	<span class="cm">/**************************/</span>
	<span class="cm">/* Increment the read FIFO */</span>
	<span class="cm">/***************************/</span>

	<span class="n">devpriv</span><span class="o">-&gt;</span>
		<span class="n">s_InterruptParameters</span><span class="p">.</span>
		<span class="n">ui_Read</span> <span class="o">=</span> <span class="p">(</span><span class="n">devpriv</span><span class="o">-&gt;</span>
		<span class="n">s_InterruptParameters</span><span class="p">.</span><span class="n">ui_Read</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">APCI1710_SAVE_INTERRUPT</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">insn</span><span class="o">-&gt;</span><span class="n">n</span><span class="p">;</span>

<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
