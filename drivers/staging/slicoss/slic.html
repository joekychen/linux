<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › slicoss › slic.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>slic.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2000-2002 Alacritech, Inc.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> *</span>
<span class="cm"> * 1. Redistributions of source code must retain the above copyright</span>
<span class="cm"> *    notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> * 2. Redistributions in binary form must reproduce the above</span>
<span class="cm"> *    copyright notice, this list of conditions and the following</span>
<span class="cm"> *    disclaimer in the documentation and/or other materials provided</span>
<span class="cm"> *    with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY ALACRITECH, INC. ``AS IS&#39;&#39; AND ANY</span>
<span class="cm"> * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="cm"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<span class="cm"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL ALACRITECH, INC. OR</span>
<span class="cm"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="cm"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF</span>
<span class="cm"> * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND</span>
<span class="cm"> * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<span class="cm"> * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT</span>
<span class="cm"> * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm"> * SUCH DAMAGE.</span>
<span class="cm"> *</span>
<span class="cm"> * The views and conclusions contained in the software and documentation</span>
<span class="cm"> * are those of the authors and should not be interpreted as representing</span>
<span class="cm"> * official policies, either expressed or implied, of Alacritech, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> **************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * FILENAME: slic.h</span>
<span class="cm"> *</span>
<span class="cm"> * This is the base set of header definitions for the SLICOSS driver.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __SLIC_DRIVER_H__</span>
<span class="cp">#define __SLIC_DRIVER_H__</span>

<span class="cm">/* firmware stuff */</span>
<span class="cp">#define OASIS_UCODE_VERS_STRING	&quot;1.2&quot;</span>
<span class="cp">#define OASIS_UCODE_VERS_DATE  	&quot;2006/03/27 15:10:37&quot;</span>
<span class="cp">#define OASIS_UCODE_HOSTIF_ID  	3</span>

<span class="cp">#define MOJAVE_UCODE_VERS_STRING	&quot;1.2&quot;</span>
<span class="cp">#define MOJAVE_UCODE_VERS_DATE  	&quot;2006/03/27 15:12:22&quot;</span>
<span class="cp">#define MOJAVE_UCODE_HOSTIF_ID  	3</span>

<span class="cp">#define GB_RCVUCODE_VERS_STRING	&quot;1.2&quot;</span>
<span class="cp">#define GB_RCVUCODE_VERS_DATE  	&quot;2006/03/27 15:12:15&quot;</span>
<span class="k">static</span> <span class="n">u32</span> <span class="n">OasisRcvUCodeLen</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="k">static</span> <span class="n">u32</span> <span class="n">GBRcvUCodeLen</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
<span class="cp">#define SECTION_SIZE 65536</span>

<span class="k">struct</span> <span class="n">slic_spinlock</span> <span class="p">{</span>
	<span class="n">spinlock_t</span>	<span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLIC_RSPQ_PAGES_GB        10</span>
<span class="cp">#define SLIC_RSPQ_BUFSINPAGE      (PAGE_SIZE / SLIC_RSPBUF_SIZE)</span>

<span class="k">struct</span> <span class="n">slic_rspqueue</span> <span class="p">{</span>
    <span class="n">u32</span>             <span class="n">offset</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">pageindex</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">num_pages</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_rspbuf</span> <span class="o">*</span><span class="n">rspbuf</span><span class="p">;</span>
    <span class="n">u32</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">[</span><span class="n">SLIC_RSPQ_PAGES_GB</span><span class="p">];</span>
    <span class="n">dma_addr_t</span>          <span class="n">paddr</span><span class="p">[</span><span class="n">SLIC_RSPQ_PAGES_GB</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define SLIC_RCVQ_EXPANSION         1</span>
<span class="cp">#define SLIC_RCVQ_ENTRIES           (256 * SLIC_RCVQ_EXPANSION)</span>
<span class="cp">#define SLIC_RCVQ_MINENTRIES        (SLIC_RCVQ_ENTRIES / 2)</span>
<span class="cp">#define SLIC_RCVQ_MAX_PROCESS_ISR   ((SLIC_RCVQ_ENTRIES * 4))</span>
<span class="cp">#define SLIC_RCVQ_RCVBUFSIZE        2048</span>
<span class="cp">#define SLIC_RCVQ_FILLENTRIES       (16 * SLIC_RCVQ_EXPANSION)</span>
<span class="cp">#define SLIC_RCVQ_FILLTHRESH        (SLIC_RCVQ_ENTRIES - SLIC_RCVQ_FILLENTRIES)</span>

<span class="k">struct</span> <span class="n">slic_rcvqueue</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">sk_buff</span>    <span class="o">*</span><span class="n">head</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sk_buff</span>    <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">count</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">size</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">errors</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_rcvbuf_info</span> <span class="p">{</span>
    <span class="n">u32</span>     <span class="n">id</span><span class="p">;</span>
    <span class="n">u32</span>     <span class="n">starttime</span><span class="p">;</span>
    <span class="n">u32</span>     <span class="n">stoptime</span><span class="p">;</span>
    <span class="n">u32</span>     <span class="n">slicworld</span><span class="p">;</span>
    <span class="n">u32</span>     <span class="n">lasttime</span><span class="p">;</span>
    <span class="n">u32</span>     <span class="n">lastid</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/*</span>
<span class="cm"> SLIC Handle structure.  Used to restrict handle values to</span>
<span class="cm"> 32 bits by using an index rather than an address.</span>
<span class="cm"> Simplifies ucode in 64-bit systems</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">slic_handle_word</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">ushort</span>      <span class="n">index</span><span class="p">;</span>
			<span class="n">ushort</span>      <span class="n">bottombits</span><span class="p">;</span> <span class="cm">/* to denote num bufs to card */</span>
		<span class="p">}</span>  <span class="n">parts</span><span class="p">;</span>
		<span class="n">u32</span>         <span class="n">whole</span><span class="p">;</span>
	<span class="p">}</span>  <span class="n">handle</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_handle</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">slic_handle_word</span>  <span class="n">token</span><span class="p">;</span>  <span class="cm">/* token passed between host and card*/</span>
    <span class="n">ushort</span>                      <span class="n">type</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">;</span>    <span class="cm">/* actual address of the object*/</span>
    <span class="n">ushort</span>                      <span class="n">offset</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_handle</span>       <span class="o">*</span><span class="n">other_handle</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_handle</span>       <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLIC_HANDLE_FREE        0x0000</span>
<span class="cp">#define SLIC_HANDLE_DATA        0x0001</span>
<span class="cp">#define SLIC_HANDLE_CMD         0x0002</span>
<span class="cp">#define SLIC_HANDLE_CONTEXT     0x0003</span>
<span class="cp">#define SLIC_HANDLE_TEAM        0x0004</span>

<span class="cp">#define handle_index        handle.parts.index</span>
<span class="cp">#define handle_bottom       handle.parts.bottombits</span>
<span class="cp">#define handle_token        handle.whole</span>

<span class="cp">#define SLIC_HOSTCMD_SIZE    512</span>

<span class="k">struct</span> <span class="n">slic_hostcmd</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">slic_host64_cmd</span>  <span class="n">cmd64</span><span class="p">;</span>
    <span class="n">u32</span>                    <span class="n">type</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sk_buff</span>            <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
    <span class="n">u32</span>                    <span class="n">paddrl</span><span class="p">;</span>
    <span class="n">u32</span>                    <span class="n">paddrh</span><span class="p">;</span>
    <span class="n">u32</span>                    <span class="n">busy</span><span class="p">;</span>
    <span class="n">u32</span>                    <span class="n">cmdsize</span><span class="p">;</span>
    <span class="n">ushort</span>                     <span class="n">numbufs</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_handle</span>    <span class="o">*</span><span class="n">pslic_handle</span><span class="p">;</span><span class="cm">/* handle associated with command */</span>
    <span class="k">struct</span> <span class="n">slic_hostcmd</span>    <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_hostcmd</span>    <span class="o">*</span><span class="n">next_all</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLIC_CMDQ_CMDSINPAGE    (PAGE_SIZE / SLIC_HOSTCMD_SIZE)</span>
<span class="cp">#define SLIC_CMD_DUMB            3</span>
<span class="cp">#define SLIC_CMDQ_INITCMDS       256</span>
<span class="cp">#define SLIC_CMDQ_MAXCMDS        256</span>
<span class="cp">#define SLIC_CMDQ_MAXOUTSTAND    SLIC_CMDQ_MAXCMDS</span>
<span class="cp">#define SLIC_CMDQ_MAXPAGES       (SLIC_CMDQ_MAXCMDS / SLIC_CMDQ_CMDSINPAGE)</span>
<span class="cp">#define SLIC_CMDQ_INITPAGES      (SLIC_CMDQ_INITCMDS / SLIC_CMDQ_CMDSINPAGE)</span>

<span class="k">struct</span> <span class="n">slic_cmdqmem</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">pagecnt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">pages</span><span class="p">[</span><span class="n">SLIC_CMDQ_MAXPAGES</span><span class="p">];</span>
	<span class="n">dma_addr_t</span> <span class="n">dma_pages</span><span class="p">[</span><span class="n">SLIC_CMDQ_MAXPAGES</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_cmdqueue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">slic_hostcmd</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">slic_hostcmd</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">slic_spinlock</span> <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLIC_MAX_CARDS              32</span>
<span class="cp">#define SLIC_MAX_PORTS              4        </span><span class="cm">/* Max # of ports per card   */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">mcast_address</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">address</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mcast_address</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CARD_DOWN        0x00000000</span>
<span class="cp">#define CARD_UP          0x00000001</span>
<span class="cp">#define CARD_FAIL        0x00000002</span>
<span class="cp">#define CARD_DIAG        0x00000003</span>
<span class="cp">#define CARD_SLEEP       0x00000004</span>

<span class="cp">#define ADAPT_DOWN             0x00</span>
<span class="cp">#define ADAPT_UP               0x01</span>
<span class="cp">#define ADAPT_FAIL             0x02</span>
<span class="cp">#define ADAPT_RESET            0x03</span>
<span class="cp">#define ADAPT_SLEEP            0x04</span>

<span class="cp">#define ADAPT_FLAGS_BOOTTIME            0x0001</span>
<span class="cp">#define ADAPT_FLAGS_IS64BIT             0x0002</span>
<span class="cp">#define ADAPT_FLAGS_PENDINGLINKDOWN     0x0004</span>
<span class="cp">#define ADAPT_FLAGS_FIBERMEDIA          0x0008</span>
<span class="cp">#define ADAPT_FLAGS_LOCKS_ALLOCED       0x0010</span>
<span class="cp">#define ADAPT_FLAGS_INT_REGISTERED      0x0020</span>
<span class="cp">#define ADAPT_FLAGS_LOAD_TIMER_SET      0x0040</span>
<span class="cp">#define ADAPT_FLAGS_STATS_TIMER_SET     0x0080</span>
<span class="cp">#define ADAPT_FLAGS_RESET_TIMER_SET     0x0100</span>

<span class="cp">#define LINK_DOWN              0x00</span>
<span class="cp">#define LINK_CONFIG            0x01</span>
<span class="cp">#define LINK_UP                0x02</span>

<span class="cp">#define LINK_10MB              0x00</span>
<span class="cp">#define LINK_100MB             0x01</span>
<span class="cp">#define LINK_AUTOSPEED         0x02</span>
<span class="cp">#define LINK_1000MB            0x03</span>
<span class="cp">#define LINK_10000MB           0x04</span>

<span class="cp">#define LINK_HALFD             0x00</span>
<span class="cp">#define LINK_FULLD             0x01</span>
<span class="cp">#define LINK_AUTOD             0x02</span>

<span class="cp">#define MAC_DIRECTED     0x00000001</span>
<span class="cp">#define MAC_BCAST        0x00000002</span>
<span class="cp">#define MAC_MCAST        0x00000004</span>
<span class="cp">#define MAC_PROMISC      0x00000008</span>
<span class="cp">#define MAC_LOOPBACK     0x00000010</span>
<span class="cp">#define MAC_ALLMCAST     0x00000020</span>

<span class="cp">#define SLIC_DUPLEX(x)    ((x == LINK_FULLD) ? &quot;FDX&quot; : &quot;HDX&quot;)</span>
<span class="cp">#define SLIC_SPEED(x)     ((x == LINK_100MB) ? &quot;100Mb&quot; : ((x == LINK_1000MB) ?\</span>
<span class="cp">				&quot;1000Mb&quot; : &quot; 10Mb&quot;))</span>
<span class="cp">#define SLIC_LINKSTATE(x) ((x == LINK_DOWN) ? &quot;Down&quot; : &quot;Up  &quot;)</span>
<span class="cp">#define SLIC_ADAPTER_STATE(x) ((x == ADAPT_UP) ? &quot;UP&quot; : &quot;Down&quot;)</span>
<span class="cp">#define SLIC_CARD_STATE(x)    ((x == CARD_UP) ? &quot;UP&quot; : &quot;Down&quot;)</span>

<span class="k">struct</span> <span class="n">slic_iface_stats</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Stats</span>
<span class="cm">     */</span>
    <span class="n">u64</span>        <span class="n">xmt_bytes</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmt_ucast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmt_mcast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmt_bcast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmt_errors</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmt_discards</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmit_collisions</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmit_excess_xmit_collisions</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_bytes</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_ucast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_mcast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_bcast</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_errors</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_discards</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sliccp_stats</span> <span class="p">{</span>
    <span class="n">u64</span>        <span class="n">xmit_tcp_segs</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">xmit_tcp_bytes</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_tcp_segs</span><span class="p">;</span>
    <span class="n">u64</span>        <span class="n">rcv_tcp_bytes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slicnet_stats</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">sliccp_stats</span>        <span class="n">tcp</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_iface_stats</span>      <span class="n">iface</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLIC_LOADTIMER_PERIOD     1</span>
<span class="cp">#define SLIC_INTAGG_DEFAULT       200</span>
<span class="cp">#define SLIC_LOAD_0               0</span>
<span class="cp">#define SLIC_INTAGG_0             0</span>
<span class="cp">#define SLIC_LOAD_1               8000</span>
<span class="cp">#define SLIC_LOAD_2               10000</span>
<span class="cp">#define SLIC_LOAD_3               12000</span>
<span class="cp">#define SLIC_LOAD_4               14000</span>
<span class="cp">#define SLIC_LOAD_5               16000</span>
<span class="cp">#define SLIC_INTAGG_1             50</span>
<span class="cp">#define SLIC_INTAGG_2             100</span>
<span class="cp">#define SLIC_INTAGG_3             150</span>
<span class="cp">#define SLIC_INTAGG_4             200</span>
<span class="cp">#define SLIC_INTAGG_5             250</span>
<span class="cp">#define SLIC_LOAD_1GB             3000</span>
<span class="cp">#define SLIC_LOAD_2GB             6000</span>
<span class="cp">#define SLIC_LOAD_3GB             12000</span>
<span class="cp">#define SLIC_LOAD_4GB             24000</span>
<span class="cp">#define SLIC_LOAD_5GB             48000</span>
<span class="cp">#define SLIC_INTAGG_1GB           50</span>
<span class="cp">#define SLIC_INTAGG_2GB           75</span>
<span class="cp">#define SLIC_INTAGG_3GB           100</span>
<span class="cp">#define SLIC_INTAGG_4GB           100</span>
<span class="cp">#define SLIC_INTAGG_5GB           100</span>

<span class="k">struct</span> <span class="n">ether_header</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>    <span class="n">ether_dhost</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>    <span class="n">ether_shost</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="n">ushort</span>   <span class="n">ether_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sliccard</span> <span class="p">{</span>
    <span class="n">uint</span>              <span class="n">busnumber</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">slotnumber</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">state</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">cardnum</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">card_size</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">adapters_activated</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">adapters_allocated</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">adapters_sleeping</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">gennumber</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">events</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">loadlevel_current</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">load</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">reset_in_progress</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">pingstatus</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">bad_pingstatus</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">timer_list</span> <span class="n">loadtimer</span><span class="p">;</span>
    <span class="n">u32</span>           <span class="n">loadtimerset</span><span class="p">;</span>
    <span class="n">uint</span>              <span class="n">config_set</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_config</span>  <span class="n">config</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dentry</span>      <span class="o">*</span><span class="n">debugfs_dir</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dentry</span>      <span class="o">*</span><span class="n">debugfs_cardinfo</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">adapter</span>  <span class="o">*</span><span class="n">master</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">adapter</span>  <span class="o">*</span><span class="n">adapter</span><span class="p">[</span><span class="n">SLIC_MAX_PORTS</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">sliccard</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">error_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">error_rmiss_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">xmit_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">num_isrs</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">false_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">max_isr_rcvs</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">max_isr_xmits</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_interrupt_yields</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">tx_packets</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">debug_ix</span><span class="p">;</span>
    <span class="n">ushort</span>              <span class="n">reg_type</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">ushort</span>              <span class="n">reg_offset</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">u32</span>             <span class="n">reg_value</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="n">u32</span>             <span class="n">reg_valueh</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define NUM_CFG_SPACES      2</span>
<span class="cp">#define NUM_CFG_REGS        64</span>
<span class="cp">#define NUM_CFG_REG_ULONGS  (NUM_CFG_REGS / sizeof(u32))</span>

<span class="k">struct</span> <span class="n">physcard</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">adapter</span>  <span class="o">*</span><span class="n">adapter</span><span class="p">[</span><span class="n">SLIC_MAX_PORTS</span><span class="p">];</span>
    <span class="k">struct</span> <span class="n">physcard</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">adapters_allocd</span><span class="p">;</span>

 <span class="cm">/*  the following is not currently needed</span>
<span class="cm">    u32               bridge_busnum;</span>
<span class="cm">    u32               bridge_cfg[NUM_CFG_SPACES][NUM_CFG_REG_ULONGS];</span>
<span class="cm"> */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">base_driver</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span> <span class="n">driver_lock</span><span class="p">;</span>
    <span class="n">u32</span>              <span class="n">num_slic_cards</span><span class="p">;</span>
    <span class="n">u32</span>              <span class="n">num_slic_ports</span><span class="p">;</span>
    <span class="n">u32</span>              <span class="n">num_slic_ports_active</span><span class="p">;</span>
    <span class="n">u32</span>              <span class="n">dynamic_intagg</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sliccard</span>  <span class="o">*</span><span class="n">slic_card</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">physcard</span>  <span class="o">*</span><span class="n">phys_card</span><span class="p">;</span>
    <span class="n">uint</span>                 <span class="n">cardnuminuse</span><span class="p">[</span><span class="n">SLIC_MAX_CARDS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_shmem</span> <span class="p">{</span>
    <span class="k">volatile</span> <span class="n">u32</span>          <span class="n">isr</span><span class="p">;</span>
    <span class="k">volatile</span> <span class="n">u32</span>          <span class="n">linkstatus</span><span class="p">;</span>
    <span class="k">volatile</span> <span class="k">struct</span> <span class="n">slic_stats</span>     <span class="n">inicstats</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_reg_params</span> <span class="p">{</span>
    <span class="n">u32</span>       <span class="n">linkspeed</span><span class="p">;</span>
    <span class="n">u32</span>       <span class="n">linkduplex</span><span class="p">;</span>
    <span class="n">u32</span>       <span class="n">fail_on_bad_eeprom</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_upr</span> <span class="p">{</span>
    <span class="n">uint</span>               <span class="n">adapter</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">upr_request</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">upr_data</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">upr_data_h</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">upr_buffer</span><span class="p">;</span>
    <span class="n">u32</span>            <span class="n">upr_buffer_h</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_upr</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slic_ifevents</span> <span class="p">{</span>
    <span class="n">uint</span>        <span class="n">oflow802</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">uflow802</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Tprtoflow</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">rcvearly</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Bufov</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Carre</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Longe</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Invp</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Crc</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Drbl</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">Code</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">IpHlen</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">IpLen</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">IpCsum</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">TpCsum</span><span class="p">;</span>
    <span class="n">uint</span>        <span class="n">TpHlen</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">adapter</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">ifp</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">sliccard</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">port</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">physcard</span> <span class="o">*</span><span class="n">physcard</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">physport</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">cardindex</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">card_size</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">chipid</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">net_device</span>  <span class="o">*</span><span class="n">netdev</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">net_device</span>  <span class="o">*</span><span class="n">next_netdevice</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span>     <span class="n">adapter_lock</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span>     <span class="n">reset_lock</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">pci_dev</span>     <span class="o">*</span><span class="n">pcidev</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">busnumber</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">slotnumber</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">functionnumber</span><span class="p">;</span>
    <span class="n">ushort</span>              <span class="n">vendid</span><span class="p">;</span>
    <span class="n">ushort</span>              <span class="n">devid</span><span class="p">;</span>
    <span class="n">ushort</span>              <span class="n">subsysid</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">irq</span><span class="p">;</span>
    <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">memorybase</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">memorylength</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">drambase</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">dramlength</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">queues_initialized</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">allocated</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">activated</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">intrregistered</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">isp_initialized</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">gennumber</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">curaddrupper</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_shmem</span>      <span class="o">*</span><span class="n">pshmem</span><span class="p">;</span>
    <span class="n">dma_addr_t</span>          <span class="n">phys_shmem</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">isrcopy</span><span class="p">;</span>
    <span class="n">__iomem</span> <span class="k">struct</span> <span class="n">slic_regs</span>       <span class="o">*</span><span class="n">slic_regs</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">state</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">linkstate</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">linkspeed</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">linkduplex</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">flags</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">macaddr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>               <span class="n">currmacaddr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="n">u32</span>             <span class="n">macopts</span><span class="p">;</span>
    <span class="n">ushort</span>              <span class="n">devflags_prev</span><span class="p">;</span>
    <span class="n">u64</span>             <span class="n">mcastmask</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">mcast_address</span>   <span class="o">*</span><span class="n">mcastaddrs</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_upr</span>   <span class="o">*</span><span class="n">upr_list</span><span class="p">;</span>
    <span class="n">uint</span>                <span class="n">upr_busy</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">timer_list</span>   <span class="n">pingtimer</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">pingtimerset</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">timer_list</span>   <span class="n">loadtimer</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">loadtimerset</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">dentry</span>      <span class="o">*</span><span class="n">debugfs_entry</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span>     <span class="n">upr_lock</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span>     <span class="n">bit64reglock</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_rspqueue</span>     <span class="n">rspqueue</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_rcvqueue</span>     <span class="n">rcvqueue</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_cmdqueue</span>     <span class="n">cmdq_free</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_cmdqueue</span>     <span class="n">cmdq_done</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_cmdqueue</span>     <span class="n">cmdq_all</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_cmdqmem</span>      <span class="n">cmdqmem</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">     *  SLIC Handles</span>
<span class="cm">    */</span>
    <span class="k">struct</span> <span class="n">slic_handle</span> <span class="n">slic_handles</span><span class="p">[</span><span class="n">SLIC_CMDQ_MAXCMDS</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* Object handles*/</span>
    <span class="k">struct</span> <span class="n">slic_handle</span> <span class="o">*</span><span class="n">pfree_slic_handles</span><span class="p">;</span>          <span class="cm">/* Free object handles*/</span>
    <span class="k">struct</span> <span class="n">slic_spinlock</span>     <span class="n">handle_lock</span><span class="p">;</span>           <span class="cm">/* Object handle list lock*/</span>
    <span class="n">ushort</span>              <span class="n">slic_handle_ix</span><span class="p">;</span>

    <span class="n">u32</span>             <span class="n">xmitq_full</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">all_reg_writes</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">icr_reg_writes</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">isr_reg_writes</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">error_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">error_rmiss_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rx_errors</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_drops</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">xmit_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">linkevent_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">upr_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">num_isrs</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">false_interrupts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">tx_packets</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">xmit_completes</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">tx_drops</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_broadcasts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_multicasts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_unicasts</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">max_isr_rcvs</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">max_isr_xmits</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">rcv_interrupt_yields</span><span class="p">;</span>
    <span class="n">u32</span>             <span class="n">intagg_period</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">inicpm_state</span>    <span class="o">*</span><span class="n">inicpm_info</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">pinicpm_info</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_reg_params</span>   <span class="n">reg_params</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_ifevents</span>  <span class="n">if_events</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slic_stats</span>        <span class="n">inicstats_prev</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">slicnet_stats</span>     <span class="n">slic_stats</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#define UPDATE_STATS(largestat, newstat, oldstat)                        \</span>
<span class="cp">{                                                                        \</span>
<span class="cp">    if ((newstat) &lt; (oldstat))                                           \</span>
<span class="cp">	(largestat) += ((newstat) + (0xFFFFFFFF - oldstat + 1));         \</span>
<span class="cp">    else                                                                 \</span>
<span class="cp">	(largestat) += ((newstat) - (oldstat));                          \</span>
<span class="cp">}</span>

<span class="cp">#define UPDATE_STATS_GB(largestat, newstat, oldstat)                     \</span>
<span class="cp">{                                                                        \</span>
<span class="cp">    (largestat) += ((newstat) - (oldstat));                              \</span>
<span class="cp">}</span>

<span class="cp">#if BITS_PER_LONG == 64</span>
<span class="cp">#define   SLIC_GET_ADDR_LOW(_addr)  (u32)((u64)(_addr) &amp; \</span>
<span class="cp">	0x00000000FFFFFFFF)</span>
<span class="cp">#define   SLIC_GET_ADDR_HIGH(_addr)  (u32)(((u64)(_addr) &gt;&gt; 32) &amp; \</span>
<span class="cp">	0x00000000FFFFFFFF)</span>
<span class="cp">#elif BITS_PER_LONG == 32</span>
<span class="cp">#define   SLIC_GET_ADDR_LOW(_addr)   (u32)(_addr)</span>
<span class="cp">#define   SLIC_GET_ADDR_HIGH(_addr)  (u32)0</span>
<span class="cp">#else</span>
<span class="cp">#error BITS_PER_LONG must be 32 or 64</span>
<span class="cp">#endif</span>

<span class="cp">#define FLUSH		true</span>
<span class="cp">#define DONT_FLUSH	false</span>

<span class="cp">#define SIOCSLICDUMPCARD         (SIOCDEVPRIVATE+9)</span>
<span class="cp">#define SIOCSLICSETINTAGG        (SIOCDEVPRIVATE+10)</span>
<span class="cp">#define SIOCSLICTRACEDUMP        (SIOCDEVPRIVATE+11)</span>

<span class="cp">#endif </span><span class="cm">/*  __SLIC_DRIVER_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
