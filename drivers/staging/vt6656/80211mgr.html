<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › vt6656 › 80211mgr.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>80211mgr.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 1996, 2003 VIA Networking Technologies, Inc.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along</span>
<span class="cm"> * with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> *</span>
<span class="cm"> * File: 80211mgr.c</span>
<span class="cm"> *</span>
<span class="cm"> * Purpose: Handles the 802.11 management support functions</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Lyndon Chen</span>
<span class="cm"> *</span>
<span class="cm"> * Date: May 8, 2002</span>
<span class="cm"> *</span>
<span class="cm"> * Functions:</span>
<span class="cm"> *      vMgrEncodeBeacon - Encode the Beacon frame</span>
<span class="cm"> *      vMgrDecodeBeacon - Decode the Beacon frame</span>
<span class="cm"> *      vMgrEncodeIBSSATIM - Encode the IBSS ATIM frame</span>
<span class="cm"> *      vMgrDecodeIBSSATIM - Decode the IBSS ATIM frame</span>
<span class="cm"> *      vMgrEncodeDisassociation - Encode the Disassociation frame</span>
<span class="cm"> *      vMgrDecodeDisassociation - Decode the Disassociation frame</span>
<span class="cm"> *      vMgrEncodeAssocRequest - Encode the Association request frame</span>
<span class="cm"> *      vMgrDecodeAssocRequest - Decode the Association request frame</span>
<span class="cm"> *      vMgrEncodeAssocResponse - Encode the Association response frame</span>
<span class="cm"> *      vMgrDecodeAssocResponse - Decode the Association response frame</span>
<span class="cm"> *      vMgrEncodeReAssocRequest - Encode the ReAssociation request frame</span>
<span class="cm"> *      vMgrDecodeReAssocRequest - Decode the ReAssociation request frame</span>
<span class="cm"> *      vMgrEncodeProbeRequest - Encode the Probe request frame</span>
<span class="cm"> *      vMgrDecodeProbeRequest - Decode the Probe request frame</span>
<span class="cm"> *      vMgrEncodeProbeResponse - Encode the Probe response frame</span>
<span class="cm"> *      vMgrDecodeProbeResponse - Decode the Probe response frame</span>
<span class="cm"> *      vMgrEncodeAuthen - Encode the Authentication frame</span>
<span class="cm"> *      vMgrDecodeAuthen - Decode the Authentication frame</span>
<span class="cm"> *      vMgrEncodeDeauthen - Encode the DeAuthentication frame</span>
<span class="cm"> *      vMgrDecodeDeauthen - Decode the DeAuthentication frame</span>
<span class="cm"> *      vMgrEncodeReassocResponse - Encode the Reassociation response frame</span>
<span class="cm"> *      vMgrDecodeReassocResponse - Decode the Reassociation response frame</span>
<span class="cm"> *</span>
<span class="cm"> * Revision History:</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;tmacro.h&quot;</span>
<span class="cp">#include &quot;tether.h&quot;</span>
<span class="cp">#include &quot;80211mgr.h&quot;</span>
<span class="cp">#include &quot;80211hdr.h&quot;</span>
<span class="cp">#include &quot;device.h&quot;</span>
<span class="cp">#include &quot;wpa.h&quot;</span>

<span class="cm">/*---------------------  Static Definitions -------------------------*/</span>



<span class="cm">/*---------------------  Static Classes  ----------------------------*/</span>

<span class="cm">/*---------------------  Static Variables  --------------------------*/</span>

<span class="k">static</span> <span class="kt">int</span>          <span class="n">msglevel</span>                <span class="o">=</span> <span class="n">MSG_LEVEL_INFO</span><span class="p">;</span>
<span class="cm">/*static int          msglevel                =MSG_LEVEL_DEBUG;*/</span>
<span class="cm">/*---------------------  Static Functions  --------------------------*/</span>



<span class="cm">/*---------------------  Export Variables  --------------------------*/</span>


<span class="cm">/*---------------------  Export Functions  --------------------------*/</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> * Encode Beacon frame body offset</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeBeacon</span><span class="p">(</span>
      <span class="n">PWLAN_FR_BEACON</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pqwTimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">PQWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                    <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_TS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwBeaconInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_BCN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_CAPINFO</span><span class="p">);</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_SSID</span><span class="p">;</span>

    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> * Decode Beacon frame body offset</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrDecodeBeacon</span><span class="p">(</span>
      <span class="n">PWLAN_FR_BEACON</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>        <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pqwTimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">PQWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                    <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_TS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwBeaconInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_BCN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_CAPINFO</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)((</span><span class="n">PBYTE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">)))</span>
                       <span class="o">+</span> <span class="n">WLAN_BEACON_OFF_SSID</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SSID</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SSID</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_FH_PARMS</span>:
            <span class="cm">/* pFrame-&gt;pFHParms = (PWLAN_IE_FH_PARMS)pItem; */</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_DS_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pDSParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pDSParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_DS_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_CF_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pCFParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pCFParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_CF_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_IBSS_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIBSSParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIBSSParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_IBSS_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_TIM</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pTIM</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pTIM</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_TIM</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_RSN</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> 
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_RSN_WPA</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">WPAb_Is_RSN</span><span class="p">((</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
                    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_ERP</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pERP</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pERP</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_ERP</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_COUNTRY</span>:      <span class="cm">/* 7 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Country</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Country</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_COUNTRY</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_PWR_CONSTRAINT</span>:   <span class="cm">/* 32 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_PowerConstraint</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_PowerConstraint</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_PW_CONST</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_CH_SWITCH</span>:    <span class="cm">/* 37 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_CHSW</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_CHSW</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_CH_SW</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_QUIET</span>:        <span class="cm">/* 40 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Quiet</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Quiet</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_QUIET</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_IBSS_DFS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_IBSSDFS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_IBSSDFS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_IBSS_DFS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="nl">default:</span>
            <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;Unrecognized EID=%dd in beacon decode.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>

        <span class="p">}</span>
        <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode IBSS ATIM</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrEncodeIBSSATIM</span><span class="p">(</span>
      <span class="n">PWLAN_FR_IBSSATIM</span>   <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Decode IBSS ATIM</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeIBSSATIM</span><span class="p">(</span>
      <span class="n">PWLAN_FR_IBSSATIM</span>   <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode Disassociation</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeDisassociation</span><span class="p">(</span>
      <span class="n">PWLAN_FR_DISASSOC</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>


    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_DISASSOC_OFF_REASON</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_DISASSOC_OFF_REASON</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Decode Disassociation</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeDisassociation</span><span class="p">(</span>
      <span class="n">PWLAN_FR_DISASSOC</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_DISASSOC_OFF_REASON</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode Association Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrEncodeAssocRequest</span><span class="p">(</span>
      <span class="n">PWLAN_FR_ASSOCREQ</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>
    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwListenInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_LISTEN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_LISTEN_INT</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwListenInterval</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description: (AP)</span>
<span class="cm"> *  Decode Association Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeAssocRequest</span><span class="p">(</span>
      <span class="n">PWLAN_FR_ASSOCREQ</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>   <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>
    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwListenInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_LISTEN_INT</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">WLAN_ASSOCREQ_OFF_SSID</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SSID</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SSID</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_RSN</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_RSN_WPA</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">WPAb_Is_RSN</span><span class="p">((</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
                    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="nl">default:</span>
            <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;Unrecognized EID=%dd in assocreq decode.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                    <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description: (AP)</span>
<span class="cm"> *  Encode Association Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeAssocResponse</span><span class="p">(</span>
      <span class="n">PWLAN_FR_ASSOCRESP</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_STATUS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_AID</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_AID</span>
                  <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Decode Association Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeAssocResponse</span><span class="p">(</span>
     <span class="n">PWLAN_FR_ASSOCRESP</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>   <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_STATUS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_AID</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                           <span class="o">+</span> <span class="n">WLAN_ASSOCRESP_OFF_SUPP_RATES</span><span class="p">);</span>

    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span><span class="p">);</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span> <span class="o">==</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
        <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;pFrame-&gt;pExtSuppRates=[%p].</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pItem</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
        <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode Reassociation Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeReassocRequest</span><span class="p">(</span>
      <span class="n">PWLAN_FR_REASSOCREQ</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwListenInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_LISTEN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pAddrCurrAP</span> <span class="o">=</span> <span class="p">(</span><span class="n">PIEEE_ADDR</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_CURR_AP</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_CURR_AP</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pAddrCurrAP</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description: (AP)</span>
<span class="cm"> *  Decode Reassociation Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrDecodeReassocRequest</span><span class="p">(</span>
      <span class="n">PWLAN_FR_REASSOCREQ</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>   <span class="n">pItem</span><span class="p">;</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwListenInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_LISTEN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pAddrCurrAP</span> <span class="o">=</span> <span class="p">(</span><span class="n">PIEEE_ADDR</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_CURR_AP</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                       <span class="o">+</span> <span class="n">WLAN_REASSOCREQ_OFF_SSID</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SSID</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SSID</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_RSN</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_RSN_WPA</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">WPAb_Is_RSN</span><span class="p">((</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
                    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="nl">default:</span>
            <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;Unrecognized EID=%dd in reassocreq decode.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
                        <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>



<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode Probe Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrEncodeProbeRequest</span><span class="p">(</span>
     <span class="n">PWLAN_FR_PROBEREQ</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Decode Probe Request</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeProbeRequest</span><span class="p">(</span>
     <span class="n">PWLAN_FR_PROBEREQ</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>   <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">)));</span>

    <span class="k">while</span> <span class="p">(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span>

        <span class="k">switch</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SSID</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SSID</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_SUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="nl">default:</span>
            <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;Bad EID=%dd in probereq</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Encode Probe Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrEncodeProbeResponse</span><span class="p">(</span>
     <span class="n">PWLAN_FR_PROBERESP</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pqwTimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">PQWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                    <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_TS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwBeaconInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_BCN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_CAP_INFO</span><span class="p">);</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_CAP_INFO</span> <span class="o">+</span>
                  <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span><span class="p">));</span>
<span class="p">}</span>



<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *  Decode Probe Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeProbeResponse</span><span class="p">(</span>
     <span class="n">PWLAN_FR_PROBERESP</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>    <span class="n">pItem</span><span class="p">;</span>


    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pqwTimestamp</span> <span class="o">=</span> <span class="p">(</span><span class="n">PQWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                    <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_TS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwBeaconInterval</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                       <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_BCN_INT</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_CAP_INFO</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                       <span class="o">+</span> <span class="n">WLAN_PROBERESP_OFF_SSID</span><span class="p">);</span>

    <span class="k">while</span> <span class="p">(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SSID</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSSID</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SSID</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_SUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_FH_PARMS</span>:
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_DS_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pDSParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pDSParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_DS_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_CF_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pCFParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pCFParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_CF_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_IBSS_PARMS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIBSSParms</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIBSSParms</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_IBSS_PARMS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_RSN</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSN</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_RSN_WPA</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">WPAb_Is_RSN</span><span class="p">((</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">==</span> <span class="n">TRUE</span><span class="p">)</span>
                    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pRSNWPA</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_RSN_EXT</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_ERP</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pERP</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pERP</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_ERP</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_COUNTRY</span>:      <span class="cm">/* 7 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Country</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Country</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_COUNTRY</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_PWR_CONSTRAINT</span>:   <span class="cm">/* 32 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_PowerConstraint</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_PowerConstraint</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_PW_CONST</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_CH_SWITCH</span>:    <span class="cm">/* 37 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_CHSW</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_CHSW</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_CH_SW</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_QUIET</span>:        <span class="cm">/* 40 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Quiet</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_Quiet</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_QUIET</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="n">WLAN_EID_IBSS_DFS</span>:
            <span class="k">if</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_IBSSDFS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
                <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pIE_IBSSDFS</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_IBSS_DFS</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="nl">default:</span>
            <span class="n">DBG_PRT</span><span class="p">(</span><span class="n">MSG_LEVEL_DEBUG</span><span class="p">,</span> <span class="n">KERN_INFO</span> <span class="s">&quot;Bad EID=%dd in proberesp</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span>  <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *     Encode Authentication frame</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeAuthen</span><span class="p">(</span>
      <span class="n">PWLAN_FR_AUTHEN</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAuthAlgorithm</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_AUTH_ALG</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAuthSequence</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                     <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_AUTH_SEQ</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_STATUS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_STATUS</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *   Decode Authentication</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeAuthen</span><span class="p">(</span>
      <span class="n">PWLAN_FR_AUTHEN</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>    <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAuthAlgorithm</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_AUTH_ALG</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAuthSequence</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                     <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_AUTH_SEQ</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_STATUS</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                       <span class="o">+</span> <span class="n">WLAN_AUTHEN_OFF_CHALLENGE</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span> <span class="o">==</span> <span class="n">WLAN_EID_CHALLENGE</span><span class="p">))</span>
        <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pChallenge</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_CHALLENGE</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *   Encode Authentication</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeDeauthen</span><span class="p">(</span>
      <span class="n">PWLAN_FR_DEAUTHEN</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_DEAUTHEN_OFF_REASON</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_DEAUTHEN_OFF_REASON</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *   Decode Deauthentication</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrDecodeDeauthen</span><span class="p">(</span>
      <span class="n">PWLAN_FR_DEAUTHEN</span>  <span class="n">pFrame</span>
    <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwReason</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_DEAUTHEN_OFF_REASON</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description: (AP)</span>
<span class="cm"> *   Encode Reassociation Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>

<span class="kt">void</span>
<span class="nf">vMgrEncodeReassocResponse</span><span class="p">(</span>
      <span class="n">PWLAN_FR_REASSOCRESP</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_STATUS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_AID</span><span class="p">);</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">WLAN_HDR_ADDR3_LEN</span> <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_AID</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*+</span>
<span class="cm"> *</span>
<span class="cm"> * Routine Description:</span>
<span class="cm"> *   Decode Reassociation Response</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Return Value:</span>
<span class="cm"> *    None.</span>
<span class="cm"> *</span>
<span class="cm">-*/</span>


<span class="kt">void</span>
<span class="nf">vMgrDecodeReassocResponse</span><span class="p">(</span>
      <span class="n">PWLAN_FR_REASSOCRESP</span>  <span class="n">pFrame</span>
     <span class="p">)</span>
<span class="p">{</span>
    <span class="n">PWLAN_IE</span>   <span class="n">pItem</span><span class="p">;</span>

    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span> <span class="o">=</span> <span class="p">(</span><span class="n">PUWLAN_80211HDR</span><span class="p">)</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span><span class="p">;</span>

    <span class="cm">/* Fixed Fields */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwCapInfo</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_CAP_INFO</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwStatus</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                               <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_STATUS</span><span class="p">);</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pwAid</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWORD</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                            <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_AID</span><span class="p">);</span>

    <span class="cm">/* Information elements */</span>
    <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)(</span><span class="n">WLAN_HDR_A3_DATA_PTR</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pHdr</span><span class="o">-&gt;</span><span class="n">sA3</span><span class="p">))</span>
                                               <span class="o">+</span> <span class="n">WLAN_REASSOCRESP_OFF_SUPP_RATES</span><span class="p">);</span>

    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pSuppRates</span><span class="p">);</span>
    <span class="n">pItem</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE</span><span class="p">)(((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pItem</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">((((</span><span class="n">PBYTE</span><span class="p">)</span><span class="n">pItem</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pBuf</span> <span class="o">+</span> <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pItem</span><span class="o">-&gt;</span><span class="n">byElementID</span> <span class="o">==</span> <span class="n">WLAN_EID_EXTSUPP_RATES</span><span class="p">))</span>
        <span class="n">pFrame</span><span class="o">-&gt;</span><span class="n">pExtSuppRates</span> <span class="o">=</span> <span class="p">(</span><span class="n">PWLAN_IE_SUPP_RATES</span><span class="p">)</span><span class="n">pItem</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
