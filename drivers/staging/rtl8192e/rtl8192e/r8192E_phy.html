<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8192e › rtl8192e › r8192E_phy.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>r8192E_phy.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> * Copyright(c) 2008 - 2010 Realtek Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * wlanfae &lt;wlanfae@realtek.com&gt;</span>
<span class="cm">******************************************************************************/</span>

<span class="cp">#include &quot;rtl_core.h&quot;</span>
<span class="cp">#include &quot;r8192E_hw.h&quot;</span>
<span class="cp">#include &quot;r8192E_phyreg.h&quot;</span>
<span class="cp">#include &quot;r8190P_rtl8256.h&quot;</span>
<span class="cp">#include &quot;r8192E_phy.h&quot;</span>
<span class="cp">#include &quot;rtl_dm.h&quot;</span>

<span class="cp">#include &quot;r8192E_hwimg.h&quot;</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">RF_CHANNEL_TABLE_ZEBRA</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mh">0x085c</span><span class="p">,</span>
	<span class="mh">0x08dc</span><span class="p">,</span>
	<span class="mh">0x095c</span><span class="p">,</span>
	<span class="mh">0x09dc</span><span class="p">,</span>
	<span class="mh">0x0a5c</span><span class="p">,</span>
	<span class="mh">0x0adc</span><span class="p">,</span>
	<span class="mh">0x0b5c</span><span class="p">,</span>
	<span class="mh">0x0bdc</span><span class="p">,</span>
	<span class="mh">0x0c5c</span><span class="p">,</span>
	<span class="mh">0x0cdc</span><span class="p">,</span>
	<span class="mh">0x0d5c</span><span class="p">,</span>
	<span class="mh">0x0ddc</span><span class="p">,</span>
	<span class="mh">0x0e5c</span><span class="p">,</span>
	<span class="mh">0x0f72</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*************************Define local function prototype**********************/</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">phy_FwRFSerialRead</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span>
			      <span class="n">u32</span> <span class="n">Offset</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">phy_FwRFSerialWrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">Offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Data</span><span class="p">);</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">u32</span> <span class="n">dwBitMask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">31</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(((</span><span class="n">dwBitMask</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">rtl8192_phy_CheckIsLegalRFPath</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">eRFPath</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">eRFPath</span> <span class="o">==</span> <span class="n">RF90_PATH_A</span> <span class="o">||</span> <span class="n">eRFPath</span> <span class="o">==</span> <span class="n">RF90_PATH_B</span><span class="p">)</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">eRFPath</span> <span class="o">==</span> <span class="n">RF90_PATH_C</span> <span class="o">||</span> <span class="n">eRFPath</span> <span class="o">==</span> <span class="n">RF90_PATH_D</span><span class="p">)</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_setBBreg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dwRegAddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dwBitMask</span><span class="p">,</span>
		      <span class="n">u32</span> <span class="n">dwData</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u32</span> <span class="n">OriginalValue</span><span class="p">,</span> <span class="n">BitShift</span><span class="p">,</span> <span class="n">NewValue</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dwBitMask</span> <span class="o">!=</span> <span class="n">bMaskDWord</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">OriginalValue</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dwRegAddr</span><span class="p">);</span>
		<span class="n">BitShift</span> <span class="o">=</span> <span class="n">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">dwBitMask</span><span class="p">);</span>
		<span class="n">NewValue</span> <span class="o">=</span> <span class="p">(((</span><span class="n">OriginalValue</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">dwBitMask</span><span class="p">))</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">dwData</span> <span class="o">&lt;&lt;</span> <span class="n">BitShift</span><span class="p">));</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dwRegAddr</span><span class="p">,</span> <span class="n">NewValue</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dwRegAddr</span><span class="p">,</span> <span class="n">dwData</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u32</span> <span class="nf">rtl8192_QueryBBReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dwRegAddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dwBitMask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">Ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">OriginalValue</span><span class="p">,</span> <span class="n">BitShift</span><span class="p">;</span>

	<span class="n">OriginalValue</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">dwRegAddr</span><span class="p">);</span>
	<span class="n">BitShift</span> <span class="o">=</span> <span class="n">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">dwBitMask</span><span class="p">);</span>
	<span class="n">Ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">OriginalValue</span> <span class="o">&amp;</span> <span class="n">dwBitMask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">BitShift</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">Ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="n">u32</span> <span class="nf">rtl8192_phy_RFSerialRead</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				    <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">NewOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bb_reg_definition</span> <span class="o">*</span><span class="n">pPhyReg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">];</span>
	<span class="n">Offset</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">==</span> <span class="n">RF_8256</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span> <span class="mh">0xf00</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">&gt;=</span> <span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x140</span><span class="p">;</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">));</span>
			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x100</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="mh">0x40</span><span class="p">);</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">));</span>

			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span> <span class="o">-</span> <span class="mi">15</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_PHY</span><span class="o">|</span><span class="n">COMP_ERR</span><span class="p">),</span> <span class="s">&quot;check RF type here, need&quot;</span>
			 <span class="s">&quot; to be 8256</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rfHSSIPara2</span><span class="p">,</span> <span class="n">bLSSIReadAddress</span><span class="p">,</span>
			 <span class="n">NewOffset</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rfHSSIPara2</span><span class="p">,</span>  <span class="n">bLSSIReadEdge</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rfHSSIPara2</span><span class="p">,</span>  <span class="n">bLSSIReadEdge</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rfLSSIReadBack</span><span class="p">,</span>
				 <span class="n">bLSSIReadBackData</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">==</span> <span class="n">RF_8256</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xebf</span><span class="p">;</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span>
				<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span> <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="p">}</span>


	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_phy_RFSerialWrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				      <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Offset</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">DataAndAddr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">NewOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bb_reg_definition</span> <span class="o">*</span><span class="n">pPhyReg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">];</span>

	<span class="n">Offset</span> <span class="o">&amp;=</span> <span class="mh">0x3f</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">==</span> <span class="n">RF_8256</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span> <span class="mh">0xf00</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">&gt;=</span> <span class="mi">31</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x140</span><span class="p">;</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span> <span class="o">-</span> <span class="mi">30</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x100</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="mh">0x40</span><span class="p">);</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>
			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span> <span class="o">-</span> <span class="mi">15</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_PHY</span><span class="o">|</span><span class="n">COMP_ERR</span><span class="p">),</span> <span class="s">&quot;check RF type here, need to be&quot;</span>
			 <span class="s">&quot; 8256</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">NewOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">DataAndAddr</span> <span class="o">=</span> <span class="p">(</span><span class="n">Data</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">NewOffset</span><span class="o">&amp;</span><span class="mh">0x3f</span><span class="p">);</span>

	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">,</span> <span class="n">DataAndAddr</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">==</span> <span class="mh">0x0</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">=</span> <span class="n">Data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">==</span> <span class="n">RF_8256</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xebf</span><span class="p">;</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span>
				<span class="n">dev</span><span class="p">,</span>
				<span class="n">pPhyReg</span><span class="o">-&gt;</span><span class="n">rf3wireOffset</span><span class="p">,</span>
				<span class="n">bMaskDWord</span><span class="p">,</span>
				<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RfReg0Value</span><span class="p">[</span><span class="n">eRFPath</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span> <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span>
			  <span class="n">u32</span> <span class="n">RegAddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">BitMask</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">Original_Value</span><span class="p">,</span> <span class="n">BitShift</span><span class="p">,</span> <span class="n">New_Value</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtl8192_phy_CheckIsLegalRFPath</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">!=</span> <span class="n">eRfOn</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">being_init_adapter</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PHY</span><span class="p">,</span> <span class="s">&quot;FW RF CTRL is not ready now</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">Rf_Mode</span> <span class="o">==</span> <span class="n">RF_OP_By_FW</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">BitMask</span> <span class="o">!=</span> <span class="n">bMask12Bits</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Original_Value</span> <span class="o">=</span> <span class="n">phy_FwRFSerialRead</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
							    <span class="n">RegAddr</span><span class="p">);</span>
			<span class="n">BitShift</span> <span class="o">=</span>  <span class="n">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">BitMask</span><span class="p">);</span>
			<span class="n">New_Value</span> <span class="o">=</span> <span class="p">(((</span><span class="n">Original_Value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BitMask</span><span class="p">))</span> <span class="o">|</span>
				    <span class="p">(</span><span class="n">Data</span> <span class="o">&lt;&lt;</span> <span class="n">BitShift</span><span class="p">));</span>

			<span class="n">phy_FwRFSerialWrite</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">RegAddr</span><span class="p">,</span> <span class="n">New_Value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">phy_FwRFSerialWrite</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">RegAddr</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">BitMask</span> <span class="o">!=</span> <span class="n">bMask12Bits</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Original_Value</span> <span class="o">=</span> <span class="n">rtl8192_phy_RFSerialRead</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
								  <span class="n">RegAddr</span><span class="p">);</span>
			<span class="n">BitShift</span> <span class="o">=</span>  <span class="n">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">BitMask</span><span class="p">);</span>
			<span class="n">New_Value</span> <span class="o">=</span> <span class="p">(((</span><span class="n">Original_Value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">BitMask</span><span class="p">))</span> <span class="o">|</span>
				     <span class="p">(</span><span class="n">Data</span> <span class="o">&lt;&lt;</span> <span class="n">BitShift</span><span class="p">));</span>

			<span class="n">rtl8192_phy_RFSerialWrite</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">RegAddr</span><span class="p">,</span>
						  <span class="n">New_Value</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">rtl8192_phy_RFSerialWrite</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">RegAddr</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u32</span> <span class="nf">rtl8192_phy_QueryRFReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span>
			   <span class="n">u32</span> <span class="n">RegAddr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">BitMask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">Original_Value</span><span class="p">,</span> <span class="n">Readback_Value</span><span class="p">,</span> <span class="n">BitShift</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtl8192_phy_CheckIsLegalRFPath</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">!=</span> <span class="n">eRfOn</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">being_init_adapter</span><span class="p">)</span>
		<span class="k">return</span>	<span class="mi">0</span><span class="p">;</span>
	<span class="n">down</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_sem</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">Rf_Mode</span> <span class="o">==</span> <span class="n">RF_OP_By_FW</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">Original_Value</span> <span class="o">=</span> <span class="n">phy_FwRFSerialRead</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">RegAddr</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">Original_Value</span> <span class="o">=</span> <span class="n">rtl8192_phy_RFSerialRead</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
							  <span class="n">RegAddr</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">BitShift</span> <span class="o">=</span>  <span class="n">rtl8192_CalculateBitShift</span><span class="p">(</span><span class="n">BitMask</span><span class="p">);</span>
	<span class="n">Readback_Value</span> <span class="o">=</span> <span class="p">(</span><span class="n">Original_Value</span> <span class="o">&amp;</span> <span class="n">BitMask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">BitShift</span><span class="p">;</span>
	<span class="n">up</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_sem</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Readback_Value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">phy_FwRFSerialRead</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span>		<span class="n">retValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">Data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="p">((</span><span class="n">Offset</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="p">((</span><span class="n">eRFPath</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="mh">0x80000000</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">QPNR</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0x80000000</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">QPNR</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">QPNR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">retValue</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RF_DATA</span><span class="p">);</span>

	<span class="k">return</span>	<span class="n">retValue</span><span class="p">;</span>

<span class="p">}</span>	<span class="cm">/* phy_FwRFSerialRead */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">phy_FwRFSerialWrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">Offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">time</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">Data</span> <span class="o">|=</span> <span class="p">((</span><span class="n">Offset</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="p">((</span><span class="n">eRFPath</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="mh">0x400000</span><span class="p">;</span>
	<span class="n">Data</span> <span class="o">|=</span> <span class="mh">0x80000000</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">QPNR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">++</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">QPNR</span><span class="p">,</span> <span class="n">Data</span><span class="p">);</span>

<span class="p">}</span>	<span class="cm">/* phy_FwRFSerialWrite */</span>


<span class="kt">void</span> <span class="nf">rtl8192_phy_configmac</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">dwArrayLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">pdwArray</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bTXPowerDataReadFromEEPORM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PHY</span><span class="p">,</span> <span class="s">&quot;Rtl819XMACPHY_Array_PG</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dwArrayLen</span> <span class="o">=</span> <span class="n">MACPHY_Array_PGLength</span><span class="p">;</span>
		<span class="n">pdwArray</span> <span class="o">=</span> <span class="n">Rtl819XMACPHY_Array_PG</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PHY</span><span class="p">,</span> <span class="s">&quot;Read rtl819XMACPHY_Array</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dwArrayLen</span> <span class="o">=</span> <span class="n">MACPHY_ArrayLength</span><span class="p">;</span>
		<span class="n">pdwArray</span> <span class="o">=</span> <span class="n">Rtl819XMACPHY_Array</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dwArrayLen</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;The Rtl8190MACPHY_Array[0] is %x Rtl8190MAC&quot;</span>
			 <span class="s">&quot;PHY_Array[1] is %x Rtl8190MACPHY_Array[2] is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x318</span><span class="p">)</span>
			<span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00000800</span><span class="p">;</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
				 <span class="n">pdwArray</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_phyConfigBB</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">ConfigType</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">Rtl819XPHY_REGArray_Table</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">Rtl819XAGCTAB_Array_Table</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">AGCTAB_ArrayLen</span><span class="p">,</span> <span class="n">PHY_REGArrayLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">AGCTAB_ArrayLen</span> <span class="o">=</span> <span class="n">AGCTAB_ArrayLength</span><span class="p">;</span>
	<span class="n">Rtl819XAGCTAB_Array_Table</span> <span class="o">=</span> <span class="n">Rtl819XAGCTAB_Array</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PHY_REGArrayLen</span> <span class="o">=</span> <span class="n">PHY_REGArrayLength</span><span class="p">;</span>
		<span class="n">Rtl819XPHY_REGArray_Table</span> <span class="o">=</span> <span class="n">Rtl819XPHY_REGArray</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PHY_REGArrayLen</span> <span class="o">=</span> <span class="n">PHY_REG_1T2RArrayLength</span><span class="p">;</span>
		<span class="n">Rtl819XPHY_REGArray_Table</span> <span class="o">=</span> <span class="n">Rtl819XPHY_REG_1T2RArray</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ConfigType</span> <span class="o">==</span> <span class="n">BaseBand_Config_PHY_REG</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PHY_REGArrayLen</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">Rtl819XPHY_REGArray_Table</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="n">Rtl819XPHY_REGArray_Table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;i: %x, The Rtl819xUsbPHY_REGArray&quot;</span>
				 <span class="s">&quot;[0] is %x Rtl819xUsbPHY_REGArray[1] is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">i</span><span class="p">,</span> <span class="n">Rtl819XPHY_REGArray_Table</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
				 <span class="n">Rtl819XPHY_REGArray_Table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ConfigType</span> <span class="o">==</span> <span class="n">BaseBand_Config_AGC_TAB</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AGCTAB_ArrayLen</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">Rtl819XAGCTAB_Array_Table</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					 <span class="n">bMaskDWord</span><span class="p">,</span>
					 <span class="n">Rtl819XAGCTAB_Array_Table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;i:%x, The rtl819XAGCTAB_Array[0] &quot;</span>
				 <span class="s">&quot;is %x rtl819XAGCTAB_Array[1] is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				 <span class="n">Rtl819XAGCTAB_Array_Table</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
				 <span class="n">Rtl819XAGCTAB_Array_Table</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_InitBBRFRegDef</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfintfs</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFInterfaceSW</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfintfs</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFInterfaceSW</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfintfs</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFInterfaceSW</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfintfs</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFInterfaceSW</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfintfi</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFInterfaceRB</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfintfi</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFInterfaceRB</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfintfi</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFInterfaceRB</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfintfi</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFInterfaceRB</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfintfo</span> <span class="o">=</span> <span class="n">rFPGA0_XA_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfintfo</span> <span class="o">=</span> <span class="n">rFPGA0_XB_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfintfo</span> <span class="o">=</span> <span class="n">rFPGA0_XC_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfintfo</span> <span class="o">=</span> <span class="n">rFPGA0_XD_RFInterfaceOE</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfintfe</span> <span class="o">=</span> <span class="n">rFPGA0_XA_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfintfe</span> <span class="o">=</span> <span class="n">rFPGA0_XB_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfintfe</span> <span class="o">=</span> <span class="n">rFPGA0_XC_RFInterfaceOE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfintfe</span> <span class="o">=</span> <span class="n">rFPGA0_XD_RFInterfaceOE</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rf3wireOffset</span> <span class="o">=</span> <span class="n">rFPGA0_XA_LSSIParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rf3wireOffset</span> <span class="o">=</span> <span class="n">rFPGA0_XB_LSSIParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rf3wireOffset</span> <span class="o">=</span> <span class="n">rFPGA0_XC_LSSIParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rf3wireOffset</span> <span class="o">=</span> <span class="n">rFPGA0_XD_LSSIParameter</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfLSSI_Select</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfLSSI_Select</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_RFParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfLSSI_Select</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFParameter</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfLSSI_Select</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_RFParameter</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfTxGainStage</span> <span class="o">=</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfTxGainStage</span> <span class="o">=</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfTxGainStage</span> <span class="o">=</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfTxGainStage</span> <span class="o">=</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfHSSIPara1</span> <span class="o">=</span> <span class="n">rFPGA0_XA_HSSIParameter1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfHSSIPara1</span> <span class="o">=</span> <span class="n">rFPGA0_XB_HSSIParameter1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfHSSIPara1</span> <span class="o">=</span> <span class="n">rFPGA0_XC_HSSIParameter1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfHSSIPara1</span> <span class="o">=</span> <span class="n">rFPGA0_XD_HSSIParameter1</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfHSSIPara2</span> <span class="o">=</span> <span class="n">rFPGA0_XA_HSSIParameter2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfHSSIPara2</span> <span class="o">=</span> <span class="n">rFPGA0_XB_HSSIParameter2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfHSSIPara2</span> <span class="o">=</span> <span class="n">rFPGA0_XC_HSSIParameter2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfHSSIPara2</span> <span class="o">=</span> <span class="n">rFPGA0_XD_HSSIParameter2</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfSwitchControl</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_SwitchControl</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfSwitchControl</span> <span class="o">=</span> <span class="n">rFPGA0_XAB_SwitchControl</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfSwitchControl</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_SwitchControl</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfSwitchControl</span> <span class="o">=</span> <span class="n">rFPGA0_XCD_SwitchControl</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfAGCControl1</span> <span class="o">=</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfAGCControl1</span> <span class="o">=</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfAGCControl1</span> <span class="o">=</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfAGCControl1</span> <span class="o">=</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfAGCControl2</span> <span class="o">=</span> <span class="n">rOFDM0_XAAGCCore2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfAGCControl2</span> <span class="o">=</span> <span class="n">rOFDM0_XBAGCCore2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfAGCControl2</span> <span class="o">=</span> <span class="n">rOFDM0_XCAGCCore2</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfAGCControl2</span> <span class="o">=</span> <span class="n">rOFDM0_XDAGCCore2</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfRxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XARxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfRxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XBRxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfRxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XCRxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfRxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XDRxIQImbalance</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfRxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XARxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfRxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XBRxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfRxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XCRxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfRxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XDRxAFE</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfTxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfTxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XBTxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfTxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XCTxIQImbalance</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfTxIQImbalance</span> <span class="o">=</span> <span class="n">rOFDM0_XDTxIQImbalance</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfTxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XATxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfTxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XBTxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfTxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XCTxAFE</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfTxAFE</span> <span class="o">=</span> <span class="n">rOFDM0_XDTxAFE</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_A</span><span class="p">].</span><span class="n">rfLSSIReadBack</span> <span class="o">=</span> <span class="n">rFPGA0_XA_LSSIReadBack</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_B</span><span class="p">].</span><span class="n">rfLSSIReadBack</span> <span class="o">=</span> <span class="n">rFPGA0_XB_LSSIReadBack</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_C</span><span class="p">].</span><span class="n">rfLSSIReadBack</span> <span class="o">=</span> <span class="n">rFPGA0_XC_LSSIReadBack</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PHYRegDef</span><span class="p">[</span><span class="n">RF90_PATH_D</span><span class="p">].</span><span class="n">rfLSSIReadBack</span> <span class="o">=</span> <span class="n">rFPGA0_XD_LSSIReadBack</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_phy_checkBBAndRF</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">enum</span> <span class="n">hw90_block</span> <span class="n">CheckBlock</span><span class="p">,</span>
			      <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">ret</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">CheckTimes</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dwRegRead</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">WriteAddr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">WriteData</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xfffff027</span><span class="p">,</span> <span class="mh">0xaa55a02f</span><span class="p">,</span> <span class="mh">0x00000027</span><span class="p">,</span> <span class="mh">0x55aa502f</span><span class="p">};</span>

	<span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_MAC</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x100</span><span class="p">;</span>
	<span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_PHY0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x900</span><span class="p">;</span>
	<span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_PHY1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x800</span><span class="p">;</span>
	<span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_RF</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x3</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PHY</span><span class="p">,</span> <span class="s">&quot;=======&gt;%s(), CheckBlock:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		 <span class="n">CheckBlock</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CheckTimes</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">CheckBlock</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">HW90_BLOCK_MAC</span>:
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;PHY_CheckBBRFOK(): Never Write &quot;</span>
				 <span class="s">&quot;0x100 here!&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">HW90_BLOCK_PHY0</span>:
		<span class="k">case</span> <span class="n">HW90_BLOCK_PHY1</span>:
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WriteAddr</span><span class="p">[</span><span class="n">CheckBlock</span><span class="p">],</span>
					<span class="n">WriteData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">dwRegRead</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WriteAddr</span><span class="p">[</span><span class="n">CheckBlock</span><span class="p">]);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">HW90_BLOCK_RF</span>:
			<span class="n">WriteData</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xfff</span><span class="p">;</span>
			<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
						 <span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_RF</span><span class="p">],</span>
						 <span class="n">bMask12Bits</span><span class="p">,</span> <span class="n">WriteData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="n">dwRegRead</span> <span class="o">=</span> <span class="n">rtl8192_phy_QueryRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
						 <span class="n">WriteAddr</span><span class="p">[</span><span class="n">HW90_BLOCK_RF</span><span class="p">],</span>
						 <span class="n">bMaskDWord</span><span class="p">);</span>
			<span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>


		<span class="k">if</span> <span class="p">(</span><span class="n">dwRegRead</span> <span class="o">!=</span> <span class="n">WriteData</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;====&gt;error=====dwRegRead: %x, &quot;</span>
				 <span class="s">&quot;WriteData: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dwRegRead</span><span class="p">,</span> <span class="n">WriteData</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">rtl8192_BB_Config_ParaFile</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">bool</span> <span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bRegValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eCheckItem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dwRegValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">bRegValue</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BB_GLOBAL_RESET</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BB_GLOBAL_RESET</span><span class="p">,</span> <span class="p">(</span><span class="n">bRegValue</span><span class="o">|</span><span class="n">BB_GLOBAL_RESET_BIT</span><span class="p">));</span>

	<span class="n">dwRegValue</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="p">(</span><span class="n">dwRegValue</span><span class="o">&amp;</span><span class="p">(</span><span class="o">~</span><span class="n">CPU_GEN_BB_RST</span><span class="p">)));</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">eCheckItem</span> <span class="o">=</span> <span class="p">(</span><span class="k">enum</span> <span class="n">hw90_block</span><span class="p">)</span><span class="n">HW90_BLOCK_PHY0</span><span class="p">;</span>
	     <span class="n">eCheckItem</span> <span class="o">&lt;=</span> <span class="n">HW90_BLOCK_PHY1</span><span class="p">;</span> <span class="n">eCheckItem</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtStatus</span>  <span class="o">=</span> <span class="n">rtl8192_phy_checkBBAndRF</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
					 <span class="p">(</span><span class="k">enum</span> <span class="n">hw90_block</span><span class="p">)</span><span class="n">eCheckItem</span><span class="p">,</span>
					 <span class="p">(</span><span class="k">enum</span> <span class="n">rf90_radio_path</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rtStatus</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_ERR</span> <span class="o">|</span> <span class="n">COMP_PHY</span><span class="p">),</span> <span class="s">&quot;PHY_RF8256_Config():&quot;</span>
				 <span class="s">&quot;Check PHY%d Fail!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">eCheckItem</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFMOD</span><span class="p">,</span> <span class="n">bCCKEn</span><span class="o">|</span><span class="n">bOFDMEn</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_phyConfigBB</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BaseBand_Config_PHY_REG</span><span class="p">);</span>

	<span class="n">dwRegValue</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="p">(</span><span class="n">dwRegValue</span><span class="o">|</span><span class="n">CPU_GEN_BB_RST</span><span class="p">));</span>

	<span class="n">rtl8192_phyConfigBB</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BaseBand_Config_AGC_TAB</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span>  <span class="o">&gt;</span> <span class="n">VERSION_8190_BD</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span>
			<span class="n">dwRegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span> <span class="o">|</span>
				      <span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span> <span class="o">|</span>
				      <span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">else</span>
			<span class="n">dwRegValue</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">,</span>
			<span class="p">(</span><span class="n">bXBTxAGC</span><span class="o">|</span><span class="n">bXCTxAGC</span><span class="o">|</span><span class="n">bXDTxAGC</span><span class="p">),</span> <span class="n">dwRegValue</span><span class="p">);</span>


		<span class="n">dwRegValue</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CrystalCap</span><span class="p">;</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="n">bXtalCap92x</span><span class="p">,</span>
				 <span class="n">dwRegValue</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">bool</span> <span class="nf">rtl8192_BBConfig</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">rtl8192_InitBBRFRegDef</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">rtStatus</span> <span class="o">=</span> <span class="n">rtl8192_BB_Config_ParaFile</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_phy_getTxPower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Rate18_06</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Rate54_24</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Mcs03_Mcs00</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Mcs07_Mcs04</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Mcs11_Mcs08</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MCSTxPowerLevelOriginalOffset</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rTxAGC_Mcs15_Mcs12</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Default initial gain (c50=0x%x, c58=0x%x, &quot;</span>
		<span class="s">&quot;c60=0x%x, c68=0x%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">DefaultInitialGain</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector3</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesyncC34</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_RxDetector2</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Default framesync (0x%x) = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">rOFDM0_RxDetector3</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">framesync</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SifsTime</span> <span class="o">=</span> <span class="n">read_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SIFS</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_phy_setTxPower</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span>	<span class="n">powerlevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">ant_pwr_diff</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">u4RegValue</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">==</span> <span class="n">EEPROM_93C46</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">powerlevel</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">==</span> <span class="n">EEPROM_93C56</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">powerlevel</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_C</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">powerlevel</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_A</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>

			<span class="n">ant_pwr_diff</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
				       <span class="o">-</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>

			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RF_C_TxPwDiff</span> <span class="o">=</span> <span class="n">ant_pwr_diff</span><span class="p">;</span>

			<span class="n">ant_pwr_diff</span> <span class="o">&amp;=</span> <span class="mh">0xf</span><span class="p">;</span>

			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">ant_pwr_diff</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="n">u4RegValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span> <span class="o">|</span>
				      <span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">4</span> <span class="o">|</span>
				      <span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_TxGainStage</span><span class="p">,</span>
			<span class="p">(</span><span class="n">bXBTxAGC</span><span class="o">|</span><span class="n">bXCTxAGC</span><span class="o">|</span><span class="n">bXDTxAGC</span><span class="p">),</span> <span class="n">u4RegValue</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF_8225</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF_8256</span>:
		<span class="n">PHY_SetRF8256CCKTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">powerlevel</span><span class="p">);</span>
		<span class="n">PHY_SetRF8256OFDMTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">powerlevelOFDM24G</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF_8258</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;unknown rf chip in function %s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">__func__</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_phy_RFConfig</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">bool</span> <span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF_8225</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF_8256</span>:
		<span class="n">rtStatus</span> <span class="o">=</span> <span class="n">PHY_RF8256_Config</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_8258</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF_PSEUDO_11N</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;error chip id</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_phy_updateInitGain</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">rtl8192_phy_ConfigRFWithHeaderFile</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				      <span class="k">enum</span> <span class="n">rf90_radio_path</span> <span class="n">eRFPath</span><span class="p">)</span>
<span class="p">{</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">eRFPath</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF90_PATH_A</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RadioA_ArrayLength</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">Rtl819XRadioA_Array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioA_Array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">bMask12Bits</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioA_Array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF90_PATH_B</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RadioB_ArrayLength</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">Rtl819XRadioB_Array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioB_Array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">bMask12Bits</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioB_Array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF90_PATH_C</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RadioC_ArrayLength</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">Rtl819XRadioC_Array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioC_Array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">bMask12Bits</span><span class="p">,</span>
					     <span class="n">Rtl819XRadioC_Array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">RF90_PATH_D</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RadioD_ArrayLength</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">Rtl819XRadioD_Array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
					<span class="k">continue</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPath</span><span class="p">,</span>
					 <span class="n">Rtl819XRadioD_Array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bMask12Bits</span><span class="p">,</span>
					 <span class="n">Rtl819XRadioD_Array</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_SetTxPowerLevel</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span>	<span class="n">powerlevel</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">powerlevelOFDM24G</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">channel</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF_8225</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_8256</span>:
		<span class="n">PHY_SetRF8256CCKTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">powerlevel</span><span class="p">);</span>
		<span class="n">PHY_SetRF8256OFDMTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">powerlevelOFDM24G</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_8258</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;unknown rf chip ID in rtl8192_SetTxPower&quot;</span>
			 <span class="s">&quot;Level()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="k">struct</span> <span class="n">sw_chnl_cmd</span> <span class="o">*</span><span class="n">CmdTable</span><span class="p">,</span>
					<span class="n">u32</span> <span class="n">CmdTableIdx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">CmdTableSz</span><span class="p">,</span>
					<span class="k">enum</span> <span class="n">sw_chnl_cmd_id</span> <span class="n">CmdID</span><span class="p">,</span>
					<span class="n">u32</span> <span class="n">Para1</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Para2</span><span class="p">,</span> <span class="n">u32</span> <span class="n">msDelay</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sw_chnl_cmd</span> <span class="o">*</span><span class="n">pCmd</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CmdTable</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;phy_SetSwChnlCmdArray(): CmdTable cannot &quot;</span>
			 <span class="s">&quot;be NULL.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CmdTableIdx</span> <span class="o">&gt;=</span> <span class="n">CmdTableSz</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;phy_SetSwChnlCmdArray(): Access invalid&quot;</span>
			 <span class="s">&quot; index, please check size of the table, CmdTableIdx:&quot;</span>
			 <span class="s">&quot;%d, CmdTableSz:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">CmdTableIdx</span><span class="p">,</span> <span class="n">CmdTableSz</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pCmd</span> <span class="o">=</span> <span class="n">CmdTable</span> <span class="o">+</span> <span class="n">CmdTableIdx</span><span class="p">;</span>
	<span class="n">pCmd</span><span class="o">-&gt;</span><span class="n">CmdID</span> <span class="o">=</span> <span class="n">CmdID</span><span class="p">;</span>
	<span class="n">pCmd</span><span class="o">-&gt;</span><span class="n">Para1</span> <span class="o">=</span> <span class="n">Para1</span><span class="p">;</span>
	<span class="n">pCmd</span><span class="o">-&gt;</span><span class="n">Para2</span> <span class="o">=</span> <span class="n">Para2</span><span class="p">;</span>
	<span class="n">pCmd</span><span class="o">-&gt;</span><span class="n">msDelay</span> <span class="o">=</span> <span class="n">msDelay</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">rtl8192_phy_SwChnlStepByStep</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">,</span>
				       <span class="n">u8</span> <span class="o">*</span><span class="n">stage</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">step</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">delay</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">;</span>
	<span class="n">u32</span>					<span class="n">PreCommonCmdCnt</span><span class="p">;</span>
	<span class="n">u32</span>					<span class="n">PostCommonCmdCnt</span><span class="p">;</span>
	<span class="n">u32</span>					<span class="n">RfDependCmdCnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sw_chnl_cmd</span> <span class="o">*</span><span class="n">CurrentCmd</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">eRFPath</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TRACE</span><span class="p">,</span> <span class="s">&quot;====&gt;%s()====stage:%d, step:%d, channel:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		  <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">stage</span><span class="p">,</span> <span class="o">*</span><span class="n">step</span><span class="p">,</span> <span class="n">channel</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtllib_legal_channel</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">,</span> <span class="n">channel</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;=============&gt;set to illegal channel:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">channel</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="p">{</span>
		<span class="n">PreCommonCmdCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">PreCommonCmd</span><span class="p">,</span>
					<span class="n">PreCommonCmdCnt</span><span class="o">++</span><span class="p">,</span>
					<span class="n">MAX_PRECMD_CNT</span><span class="p">,</span> <span class="n">CmdID_SetTxPowerLevel</span><span class="p">,</span>
					<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">PreCommonCmd</span><span class="p">,</span>
					<span class="n">PreCommonCmdCnt</span><span class="o">++</span><span class="p">,</span>
					<span class="n">MAX_PRECMD_CNT</span><span class="p">,</span> <span class="n">CmdID_End</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">PostCommonCmdCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">PostCommonCmd</span><span class="p">,</span>
					<span class="n">PostCommonCmdCnt</span><span class="o">++</span><span class="p">,</span>
					<span class="n">MAX_POSTCMD_CNT</span><span class="p">,</span> <span class="n">CmdID_End</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">RfDependCmdCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">RF_8225</span>:
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;illegal channel for Zebra &quot;</span>
					 <span class="s">&quot;8225: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="p">);</span>
				<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RfDependCmd</span><span class="p">,</span>
				<span class="n">RfDependCmdCnt</span><span class="o">++</span><span class="p">,</span> <span class="n">MAX_RFDEPENDCMD_CNT</span><span class="p">,</span>
				<span class="n">CmdID_RF_WriteReg</span><span class="p">,</span> <span class="n">rZebra1_Channel</span><span class="p">,</span>
				<span class="n">RF_CHANNEL_TABLE_ZEBRA</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="mi">10</span><span class="p">);</span>
			<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RfDependCmd</span><span class="p">,</span>
				<span class="n">RfDependCmdCnt</span><span class="o">++</span><span class="p">,</span> <span class="n">MAX_RFDEPENDCMD_CNT</span><span class="p">,</span>
				<span class="n">CmdID_End</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">RF_8256</span>:
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;illegal channel for Zebra&quot;</span>
					 <span class="s">&quot; 8256: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="p">);</span>
				<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RfDependCmd</span><span class="p">,</span>
				 <span class="n">RfDependCmdCnt</span><span class="o">++</span><span class="p">,</span> <span class="n">MAX_RFDEPENDCMD_CNT</span><span class="p">,</span>
				<span class="n">CmdID_RF_WriteReg</span><span class="p">,</span> <span class="n">rZebra1_Channel</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span>
				 <span class="mi">10</span><span class="p">);</span>
			<span class="n">rtl8192_phy_SetSwChnlCmdArray</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RfDependCmd</span><span class="p">,</span>

						      <span class="n">RfDependCmdCnt</span><span class="o">++</span><span class="p">,</span>
						      <span class="n">MAX_RFDEPENDCMD_CNT</span><span class="p">,</span>
			<span class="n">CmdID_End</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">RF_8258</span>:
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;Unknown RFChipID: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>


		<span class="k">do</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">stage</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">0</span>:
				<span class="n">CurrentCmd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">PreCommonCmd</span><span class="p">[</span><span class="o">*</span><span class="n">step</span><span class="p">];</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">1</span>:
				<span class="n">CurrentCmd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RfDependCmd</span><span class="p">[</span><span class="o">*</span><span class="n">step</span><span class="p">];</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">2</span>:
				<span class="n">CurrentCmd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">PostCommonCmd</span><span class="p">[</span><span class="o">*</span><span class="n">step</span><span class="p">];</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">CurrentCmd</span> <span class="o">&amp;&amp;</span> <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">CmdID</span> <span class="o">==</span> <span class="n">CmdID_End</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">stage</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="p">(</span><span class="o">*</span><span class="n">stage</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
					<span class="p">(</span><span class="o">*</span><span class="n">step</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CurrentCmd</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">CmdID</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">CmdID_SetTxPowerLevel</span>:
				<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">VERSION_8190_BD</span><span class="p">)</span>
					<span class="n">rtl8192_SetTxPowerLevel</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">channel</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">CmdID_WritePortUlong</span>:
				<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para1</span><span class="p">,</span>
						<span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para2</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">CmdID_WritePortUshort</span>:
				<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para1</span><span class="p">,</span>
					       <span class="p">(</span><span class="n">u16</span><span class="p">)</span><span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para2</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">CmdID_WritePortUchar</span>:
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para1</span><span class="p">,</span>
					       <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para2</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">CmdID_RF_WriteReg</span>:
				<span class="k">for</span> <span class="p">(</span><span class="n">eRFPath</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">eRFPath</span> <span class="o">&lt;</span>
				     <span class="n">priv</span><span class="o">-&gt;</span><span class="n">NumTotalRFPath</span><span class="p">;</span> <span class="n">eRFPath</span><span class="o">++</span><span class="p">)</span>
					<span class="n">rtl8192_phy_SetRFReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						 <span class="p">(</span><span class="k">enum</span> <span class="n">rf90_radio_path</span><span class="p">)</span><span class="n">eRFPath</span><span class="p">,</span>
						 <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para1</span><span class="p">,</span> <span class="n">bMask12Bits</span><span class="p">,</span>
						 <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">Para2</span><span class="o">&lt;&lt;</span><span class="mi">7</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span> <span class="cm">/*for (Number of RF paths)*/</span>

	<span class="p">(</span><span class="o">*</span><span class="n">delay</span><span class="p">)</span> <span class="o">=</span> <span class="n">CurrentCmd</span><span class="o">-&gt;</span><span class="n">msDelay</span><span class="p">;</span>
	<span class="p">(</span><span class="o">*</span><span class="n">step</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_phy_FinishSwChnlNow</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">rtl8192_phy_SwChnlStepByStep</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlStage</span><span class="p">,</span>
	      <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlStep</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">delay</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">msleep</span><span class="p">(</span><span class="n">delay</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">IS_NIC_DOWN</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">rtl8192_SwChnl_WorkItem</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TRACE</span><span class="p">,</span> <span class="s">&quot;==&gt; SwChnlCallback819xUsbWorkItem()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TRACE</span><span class="p">,</span> <span class="s">&quot;=====&gt;--%s(), set chan:%d, priv:%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">chan</span><span class="p">,</span> <span class="n">priv</span><span class="p">);</span>

	<span class="n">rtl8192_phy_FinishSwChnlNow</span><span class="p">(</span><span class="n">dev</span> <span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">chan</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TRACE</span><span class="p">,</span> <span class="s">&quot;&lt;== SwChnlCallback819xUsbWorkItem()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">rtl8192_phy_SwChnl</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PHY</span><span class="p">,</span> <span class="s">&quot;=====&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_NIC_DOWN</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;%s(): ERR !! driver is not up</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlInProgress</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>


	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_A</span>:
	<span class="k">case</span> <span class="n">WIRELESS_MODE_N_5G</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;WIRELESS_MODE_A but channel&lt;=14&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_B</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;WIRELESS_MODE_B but channel&gt;14&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_G</span>:
	<span class="k">case</span> <span class="n">WIRELESS_MODE_N_24G</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;WIRELESS_MODE_G but channel&gt;14&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlInProgress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">channel</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">chan</span> <span class="o">=</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlStage</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlStep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_NIC_DOWN</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="n">rtl8192_SwChnl_WorkItem</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SwChnlInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">CCK_Tx_Power_Track_BW_Switch_TSSI</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_20Mdefault</span> <span class="o">+</span>
			    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_difference</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">&gt;</span>
		    <span class="p">(</span><span class="n">CCKTxBBGainTableLength</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span>
					 <span class="n">CCKTxBBGainTableLength</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;20M, priv-&gt;CCKPresent&quot;</span>
			 <span class="s">&quot;Attentuation = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span>
		    <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span>
			   <span class="mi">14</span> <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_40Mdefault</span> <span class="o">+</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_difference</span><span class="p">;</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;40M, priv-&gt;CCKPresent&quot;</span>
			 <span class="s">&quot;Attentuation = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">&gt;</span>
		    <span class="p">(</span><span class="n">CCKTxBBGainTableLength</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span>
					 <span class="n">CCKTxBBGainTableLength</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span>
		    <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span> <span class="mi">14</span>
			   <span class="o">&amp;&amp;</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">CCK_Tx_Power_Track_BW_Switch_ThermalMeter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span> <span class="mi">14</span> <span class="o">&amp;&amp;</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">Record_CCK_20Mindex</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">Record_CCK_20Mindex</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">Record_CCK_20Mindex</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;20MHz, CCK_Tx_Power_Track_BW_&quot;</span>
			 <span class="s">&quot;Switch_ThermalMeter(),CCK_index = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">Record_CCK_40Mindex</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;40MHz, CCK_Tx_Power_Track_BW_&quot;</span>
			 <span class="s">&quot;Switch_ThermalMeter(), CCK_index = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCK_index</span><span class="p">);</span>
	<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dm_cck_txpower_adjust</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcck_in_ch14</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">CCK_Tx_Power_Track_BW_Switch</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">&gt;=</span> <span class="n">IC_VersionCut_D</span><span class="p">)</span>
		<span class="n">CCK_Tx_Power_Track_BW_Switch_TSSI</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">CCK_Tx_Power_Track_BW_Switch_ThermalMeter</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_SetBWModeWorkItem</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">regBwOpMode</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SWBW</span><span class="p">,</span> <span class="s">&quot;==&gt;rtl8192_SetBWModeWorkItem()  Switch to %s &quot;</span>
		 <span class="s">&quot;bandwidth</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20</span> <span class="o">?</span>
		 <span class="s">&quot;20MHz&quot;</span> <span class="o">:</span> <span class="s">&quot;40MHz&quot;</span><span class="p">)</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">==</span> <span class="n">RF_PSEUDO_11N</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetBWModeInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_NIC_DOWN</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;%s(): ERR!! driver is not up</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BW_OPMODE</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20</span>:
		<span class="n">regBwOpMode</span> <span class="o">|=</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BW_OPMODE</span><span class="p">,</span> <span class="n">regBwOpMode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span>:
		<span class="n">regBwOpMode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BW_OPMODE</span><span class="p">,</span> <span class="n">regBwOpMode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;SetChannelBandwidth819xUsb(): unknown &quot;</span>
			 <span class="s">&quot;Bandwidth: %#X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20</span>:
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFMOD</span><span class="p">,</span> <span class="n">bRFMOD</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA1_RFMOD</span><span class="p">,</span> <span class="n">bRFMOD</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="mh">0x1a1b0000</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="mh">0x090e1317</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="mh">0x00000204</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">CCK_Tx_Power_Track_BW_Switch</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="mh">0x00100000</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span>:
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFMOD</span><span class="p">,</span> <span class="n">bRFMOD</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA1_RFMOD</span><span class="p">,</span> <span class="n">bRFMOD</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="mh">0x35360000</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_TxFilter2</span><span class="p">,</span> <span class="mh">0x121c252e</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_DebugPort</span><span class="p">,</span> <span class="mh">0x00000409</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">CCK_Tx_Power_Track_BW_Switch</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_System</span><span class="p">,</span> <span class="n">bCCKSideBand</span><span class="p">,</span>
				 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">));</span>
		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM1_LSTF</span><span class="p">,</span> <span class="mh">0xC00</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span><span class="p">);</span>

		<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="mh">0x00100000</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;SetChannelBandwidth819xUsb(): unknown &quot;</span>
			 <span class="s">&quot;Bandwidth: %#X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF_8225</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_8256</span>:
		<span class="n">PHY_SetRF8256Bandwidth</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_8258</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">RF_PSEUDO_11N</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;Unknown RFChipID: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">atomic_dec</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">atm_swbw</span><span class="p">));</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetBWModeInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SWBW</span><span class="p">,</span> <span class="s">&quot;&lt;==SetBWMode819xUsb()&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_SetBWMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ht_channel_width</span> <span class="n">Bandwidth</span><span class="p">,</span>
		       <span class="k">enum</span> <span class="n">ht_extchnl_offset</span> <span class="n">Offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetBWModeInProgress</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">atomic_inc</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">atm_swbw</span><span class="p">));</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetBWModeInProgress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">=</span> <span class="n">Bandwidth</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span> <span class="o">=</span> <span class="n">HAL_PRIME_CHNL_OFFSET_UPPER</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_UPPER</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span> <span class="o">=</span> <span class="n">HAL_PRIME_CHNL_OFFSET_LOWER</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span> <span class="o">=</span> <span class="n">HAL_PRIME_CHNL_OFFSET_DONT_CARE</span><span class="p">;</span>

	<span class="n">rtl8192_SetBWModeWorkItem</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">InitialGain819xPci</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">Operation</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define SCAN_RX_INITIAL_GAIN	0x17</span>
<span class="cp">#define POWER_DETECTION_TH	0x08</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">BitMask</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">initial_gain</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">IS_NIC_DOWN</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">Operation</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">IG_Backup</span>:
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;IG_Backup, backup the initial&quot;</span>
				 <span class="s">&quot; gain.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">initial_gain</span> <span class="o">=</span> <span class="n">SCAN_RX_INITIAL_GAIN</span><span class="p">;</span>
			<span class="n">BitMask</span> <span class="o">=</span> <span class="n">bMaskByte0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span>
			    <span class="n">DIG_ALGO_BY_FALSE_ALARM</span><span class="p">)</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span> <span class="o">=</span>
				 <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span>
				 <span class="n">BitMask</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span> <span class="o">=</span>
				 <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span>
				 <span class="n">BitMask</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span> <span class="o">=</span>
				 <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span>
				 <span class="n">BitMask</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span> <span class="o">=</span>
				 <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span>
				 <span class="n">BitMask</span><span class="p">);</span>
			<span class="n">BitMask</span> <span class="o">=</span> <span class="n">bMaskByte2</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						    <span class="n">rCCK0_CCA</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">);</span>

			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan InitialGainBackup 0xc50 is&quot;</span>
				 <span class="s">&quot; %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan InitialGainBackup 0xc58 is&quot;</span>
				 <span class="s">&quot; %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan InitialGainBackup 0xc60 is&quot;</span>
				 <span class="s">&quot; %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan InitialGainBackup 0xc68 is&quot;</span>
				 <span class="s">&quot; %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan InitialGainBackup 0xa0a is&quot;</span>
				 <span class="s">&quot; %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span>

			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Write scan initial gain = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="n">initial_gain</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Write scan 0xa0a = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">POWER_DETECTION_TH</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0a</span><span class="p">,</span> <span class="n">POWER_DETECTION_TH</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">IG_Restore</span>:
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;IG_Restore, restore the initial &quot;</span>
				 <span class="s">&quot;gain.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">BitMask</span> <span class="o">=</span> <span class="mh">0x7f</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span>
			    <span class="n">DIG_ALGO_BY_FALSE_ALARM</span><span class="p">)</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>

			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XAAGCCore1</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XBAGCCore1</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XCAGCCore1</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_XDAGCCore1</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
			<span class="n">BitMask</span>  <span class="o">=</span> <span class="n">bMaskByte2</span><span class="p">;</span>
			<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rCCK0_CCA</span><span class="p">,</span> <span class="n">BitMask</span><span class="p">,</span>
					 <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span>

			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan BBInitialGainRestore 0xc50&quot;</span>
				 <span class="s">&quot; is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xaagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan BBInitialGainRestore 0xc58&quot;</span>
				 <span class="s">&quot; is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xbagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan BBInitialGainRestore 0xc60&quot;</span>
				 <span class="s">&quot; is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xcagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan BBInitialGainRestore 0xc68&quot;</span>
				 <span class="s">&quot; is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">xdagccore1</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Scan BBInitialGainRestore 0xa0a&quot;</span>
				 <span class="s">&quot; is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">initgain_backup</span><span class="p">.</span><span class="n">cca</span><span class="p">);</span>

			<span class="n">rtl8192_phy_setTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">dm_digtable</span><span class="p">.</span><span class="n">dig_algorithm</span> <span class="o">==</span>
			    <span class="n">DIG_ALGO_BY_FALSE_ALARM</span><span class="p">)</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="n">bMaskByte1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Unknown IG Operation.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PHY_SetRtl8192eRfOff</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_XA_RFInterfaceOE</span><span class="p">,</span> <span class="n">BIT4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span> <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_TRxPathEnable</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM1_TRxPathEnable</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ANAPAR_FOR_8192PciE</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">SetRFPowerState8190</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">rt_rf_power_state</span> <span class="n">eRFPowerState</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rt_pwr_save_ctrl</span> <span class="o">*</span><span class="n">pPSC</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rt_pwr_save_ctrl</span> <span class="o">*</span><span class="p">)</span>
					<span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">PowerSaveControl</span><span class="p">));</span>
	<span class="n">bool</span> <span class="n">bResult</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">QueueID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl8192_tx_ring</span>  <span class="o">*</span><span class="n">ring</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetRFPowerStateInProgress</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;===========&gt; SetRFPowerState8190()!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetRFPowerStateInProgress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RF_8256</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">eRFPowerState</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">eRfOn</span>:
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;SetRFPowerState8190() eRfOn!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">==</span> <span class="n">eRfOff</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
			     <span class="n">RT_IN_PS_LEVEL</span><span class="p">(</span><span class="n">pPSC</span><span class="p">,</span> <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">bool</span> <span class="n">rtstatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
				<span class="n">u32</span> <span class="n">InitilizeCount</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
				<span class="k">do</span> <span class="p">{</span>
					<span class="n">InitilizeCount</span><span class="o">--</span><span class="p">;</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegRfOff</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
					<span class="n">rtstatus</span> <span class="o">=</span> <span class="n">NicIFEnableNIC</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">rtstatus</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					 <span class="p">(</span><span class="n">InitilizeCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">rtstatus</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;%s():Initialize Ada&quot;</span>
						 <span class="s">&quot;pter fail,return</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						 <span class="n">__func__</span><span class="p">);</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetRFPowerStateInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
					<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="n">RT_CLEAR_PS_LEVEL</span><span class="p">(</span><span class="n">pPSC</span><span class="p">,</span>
						  <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ANAPAR</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">);</span>
				<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span>
						 <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRfOffAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_XA_RFInterfaceOE</span><span class="p">,</span>
						 <span class="n">BIT4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter4</span><span class="p">,</span>
						 <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span>
						 <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM0_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
						 <span class="mh">0x3</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rOFDM1_TRxPathEnable</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span>
						 <span class="mh">0x3</span><span class="p">);</span>
				<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_AnalogParameter1</span><span class="p">,</span>
						 <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>

			<span class="p">}</span>

			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">eRfSleep</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">==</span> <span class="n">eRfOff</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>


			<span class="k">for</span> <span class="p">(</span><span class="n">QueueID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">QueueID</span> <span class="o">&lt;</span> <span class="n">MAX_TX_QUEUE</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="n">ring</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">[</span><span class="n">QueueID</span><span class="p">];</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">QueueID</span><span class="o">++</span><span class="p">;</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_POWER</span><span class="o">|</span><span class="n">COMP_RF</span><span class="p">),</span> <span class="s">&quot;eRf Off&quot;</span>
						 <span class="s">&quot;/Sleep: %d times TcbBusyQueue&quot;</span>
						 <span class="s">&quot;[%d] !=0 before doze!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						 <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">QueueID</span><span class="p">);</span>
					<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
					<span class="n">i</span><span class="o">++</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_DOZE_WAITING_TIMES_9x</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s"> TimeOut!! &quot;</span>
						 <span class="s">&quot;SetRFPowerState8190(): eRfOff&quot;</span>
						 <span class="s">&quot;: %d times TcbBusyQueue[%d] &quot;</span>
						 <span class="s">&quot;!= 0 !!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						 <span class="n">MAX_DOZE_WAITING_TIMES_9x</span><span class="p">,</span>
						 <span class="n">QueueID</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="n">PHY_SetRtl8192eRfOff</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">eRfOff</span>:
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;SetRFPowerState8190() eRfOff/&quot;</span>
				 <span class="s">&quot;Sleep !</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">QueueID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">QueueID</span> <span class="o">&lt;</span> <span class="n">MAX_TX_QUEUE</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
				<span class="n">ring</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">[</span><span class="n">QueueID</span><span class="p">];</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">QueueID</span><span class="o">++</span><span class="p">;</span>
					<span class="k">continue</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER</span><span class="p">,</span> <span class="s">&quot;eRf Off/Sleep: %d&quot;</span>
						 <span class="s">&quot; times TcbBusyQueue[%d] !=0 b&quot;</span>
						 <span class="s">&quot;efore doze!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
						 <span class="n">QueueID</span><span class="p">);</span>
					<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
					<span class="n">i</span><span class="o">++</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">MAX_DOZE_WAITING_TIMES_9x</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n\n</span><span class="s"> SetZebra: &quot;</span>
						 <span class="s">&quot;RFPowerState8185B(): eRfOff:&quot;</span>
						 <span class="s">&quot; %d times TcbBusyQueue[%d] &quot;</span>
						 <span class="s">&quot;!= 0 !!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						 <span class="n">MAX_DOZE_WAITING_TIMES_9x</span><span class="p">,</span>
						 <span class="n">QueueID</span><span class="p">);</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">pPSC</span><span class="o">-&gt;</span><span class="n">RegRfPsLevel</span> <span class="o">&amp;</span> <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span> <span class="o">&amp;&amp;</span>
			    <span class="o">!</span><span class="n">RT_IN_PS_LEVEL</span><span class="p">(</span><span class="n">pPSC</span><span class="p">,</span> <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">NicIFDisableNIC</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
				<span class="n">RT_SET_PS_LEVEL</span><span class="p">(</span><span class="n">pPSC</span><span class="p">,</span> <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">pPSC</span><span class="o">-&gt;</span><span class="n">RegRfPsLevel</span> <span class="o">&amp;</span>
				   <span class="n">RT_RF_OFF_LEVL_HALT_NIC</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">PHY_SetRtl8192eRfOff</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">bResult</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;SetRFPowerState8190(): unknow state&quot;</span>
				 <span class="s">&quot; to set: 0x%X!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">eRFPowerState</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;SetRFPowerState8190(): Unknown RF type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bResult</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">=</span> <span class="n">eRFPowerState</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">RF_8256</span>:
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;SetRFPowerState8190(): Unknown &quot;</span>
				 <span class="s">&quot;RF type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SetRFPowerStateInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;&lt;=========== SetRFPowerState8190() bResult = %d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">bResult</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">bResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">SetRFPowerState</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		     <span class="k">enum</span> <span class="n">rt_rf_power_state</span> <span class="n">eRFPowerState</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">bool</span> <span class="n">bResult</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;---------&gt; SetRFPowerState(): eRFPowerState(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">eRFPowerState</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eRFPowerState</span> <span class="o">==</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">&amp;&amp;</span>
	    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRfOffAction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;&lt;--------- SetRFPowerState(): discard the &quot;</span>
			 <span class="s">&quot;request for eRFPowerState(%d) is the same.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">eRFPowerState</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">bResult</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">bResult</span> <span class="o">=</span> <span class="n">SetRFPowerState8190</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRFPowerState</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_PS</span><span class="p">,</span> <span class="s">&quot;&lt;--------- SetRFPowerState(): bResult(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">bResult</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">bResult</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">PHY_ScanOperationBackup8192</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">Operation</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">Operation</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SCAN_OPT_BACKUP</span>:
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">InitialGainHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">IG_Backup</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">SCAN_OPT_RESTORE</span>:
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">InitialGainHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">IG_Restore</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_SCAN</span><span class="p">,</span> <span class="s">&quot;Unknown Scan Backup Operation.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
