<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8192e › rtl8192e › r8192E_dev.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>r8192E_dev.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> * Copyright(c) 2008 - 2010 Realtek Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the r8180 driver, which is:</span>
<span class="cm"> * Copyright 2004-2005 Andrea Merello &lt;andreamrl@tiscali.it&gt;, et al.</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * wlanfae &lt;wlanfae@realtek.com&gt;</span>
<span class="cm">******************************************************************************/</span>
<span class="cp">#include &quot;rtl_core.h&quot;</span>
<span class="cp">#include &quot;r8192E_phy.h&quot;</span>
<span class="cp">#include &quot;r8192E_phyreg.h&quot;</span>
<span class="cp">#include &quot;r8190P_rtl8256.h&quot;</span>
<span class="cp">#include &quot;r8192E_cmdpkt.h&quot;</span>
<span class="cp">#include &quot;rtl_dm.h&quot;</span>
<span class="cp">#include &quot;rtl_wx.h&quot;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">WDCAPARA_ADD</span><span class="p">[];</span>

<span class="kt">void</span> <span class="nf">rtl8192e_start_beacon</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">BcnTimeCfg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">BcnCW</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">BcnIFS</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="n">DMESG</span><span class="p">(</span><span class="s">&quot;Enabling beacon TX&quot;</span><span class="p">);</span>
	<span class="n">rtl8192_irq_disable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ATIMWND</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_INTERVAL</span><span class="p">,</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">beacon_interval</span><span class="p">);</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_DRV_EARLY_INT</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_DMATIME</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_ERR_THRESH</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

	<span class="n">BcnTimeCfg</span> <span class="o">|=</span> <span class="n">BcnCW</span><span class="o">&lt;&lt;</span><span class="n">BCN_TCFG_CW_SHIFT</span><span class="p">;</span>
	<span class="n">BcnTimeCfg</span> <span class="o">|=</span> <span class="n">BcnIFS</span><span class="o">&lt;&lt;</span><span class="n">BCN_TCFG_IFS</span><span class="p">;</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_TCFG</span><span class="p">,</span> <span class="n">BcnTimeCfg</span><span class="p">);</span>
	<span class="n">rtl8192_irq_enable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192e_update_msr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">msr</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">led_ctl_mode</span> <span class="n">LedAction</span> <span class="o">=</span> <span class="n">LED_CTL_NO_LINK</span><span class="p">;</span>
	<span class="n">msr</span>  <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MSR</span><span class="p">);</span>
	<span class="n">msr</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MSR_LINK_MASK</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">iw_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IW_MODE_INFRA</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">RTLLIB_LINKED</span><span class="p">)</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_MANAGED</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_NONE</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="n">LedAction</span> <span class="o">=</span> <span class="n">LED_CTL_LINK</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IW_MODE_ADHOC</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">RTLLIB_LINKED</span><span class="p">)</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_ADHOC</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_NONE</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IW_MODE_MASTER</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">RTLLIB_LINKED</span><span class="p">)</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_MASTER</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">msr</span> <span class="o">|=</span> <span class="p">(</span><span class="n">MSR_LINK_NONE</span> <span class="o">&lt;&lt;</span> <span class="n">MSR_LINK_SHIFT</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MSR</span><span class="p">,</span> <span class="n">msr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">LedControlHandler</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">LedControlHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">LedAction</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192e_SetHwReg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">variable</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">variable</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HW_VAR_BSSID</span>:
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BSSIDR</span><span class="p">,</span> <span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">val</span><span class="p">))[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BSSIDR</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="n">val</span><span class="o">+</span><span class="mi">2</span><span class="p">))[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_MEDIA_STATUS</span>:
	<span class="p">{</span>
		<span class="k">enum</span> <span class="n">rt_op_mode</span> <span class="n">OpMode</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="k">enum</span> <span class="n">rt_op_mode</span> <span class="o">*</span><span class="p">)(</span><span class="n">val</span><span class="p">));</span>
		<span class="k">enum</span> <span class="n">led_ctl_mode</span> <span class="n">LedAction</span> <span class="o">=</span> <span class="n">LED_CTL_NO_LINK</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">btMsr</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MSR</span><span class="p">);</span>

		<span class="n">btMsr</span> <span class="o">&amp;=</span> <span class="mh">0xfc</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">OpMode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">RT_OP_MODE_INFRASTRUCTURE</span>:
			<span class="n">btMsr</span> <span class="o">|=</span> <span class="n">MSR_INFRA</span><span class="p">;</span>
			<span class="n">LedAction</span> <span class="o">=</span> <span class="n">LED_CTL_LINK</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">RT_OP_MODE_IBSS</span>:
			<span class="n">btMsr</span> <span class="o">|=</span> <span class="n">MSR_ADHOC</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">RT_OP_MODE_AP</span>:
			<span class="n">btMsr</span> <span class="o">|=</span> <span class="n">MSR_AP</span><span class="p">;</span>
			<span class="n">LedAction</span> <span class="o">=</span> <span class="n">LED_CTL_LINK</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">btMsr</span> <span class="o">|=</span> <span class="n">MSR_NOLINK</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MSR</span><span class="p">,</span> <span class="n">btMsr</span><span class="p">);</span>

	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_CECHK_BSSID</span>:
	<span class="p">{</span>
		<span class="n">u32</span>	<span class="n">RegRCR</span><span class="p">,</span> <span class="n">Type</span><span class="p">;</span>

		<span class="n">Type</span> <span class="o">=</span> <span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)(</span><span class="n">val</span><span class="p">))[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">RegRCR</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">=</span> <span class="n">RegRCR</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">Type</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
			<span class="n">RegRCR</span> <span class="o">|=</span> <span class="p">(</span><span class="n">RCR_CBSSID</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">Type</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
			<span class="n">RegRCR</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">RCR_CBSSID</span><span class="p">);</span>

		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">,</span> <span class="n">RegRCR</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">=</span> <span class="n">RegRCR</span><span class="p">;</span>

	<span class="p">}</span>
	<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_SLOT_TIME</span>:

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">slot_time</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SLOT_TIME</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_ACK_PREAMBLE</span>:
	<span class="p">{</span>
		<span class="n">u32</span> <span class="n">regTmp</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">short_preamble</span> <span class="o">=</span> <span class="p">(</span><span class="n">bool</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
		<span class="n">regTmp</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">basic_rate</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">short_preamble</span><span class="p">)</span>
			<span class="n">regTmp</span> <span class="o">|=</span> <span class="n">BRSR_AckShortPmb</span><span class="p">;</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RRSR</span><span class="p">,</span> <span class="n">regTmp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="n">HW_VAR_CPU_RST</span>:
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)(</span><span class="n">val</span><span class="p">))[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_AC_PARAM</span>:
	<span class="p">{</span>
		<span class="n">u8</span>	<span class="n">pAcParam</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
		<span class="n">u32</span>	<span class="n">eACI</span> <span class="o">=</span> <span class="n">pAcParam</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">u1bAIFS</span><span class="p">;</span>
		<span class="n">u32</span>		<span class="n">u4bAcParam</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">rtllib_qos_parameters</span> <span class="o">*</span><span class="n">qos_parameters</span> <span class="o">=</span>
			 <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">qos_data</span><span class="p">.</span><span class="n">parameters</span><span class="p">;</span>

		<span class="n">u1bAIFS</span> <span class="o">=</span> <span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">aifs</span><span class="p">[</span><span class="n">pAcParam</span><span class="p">]</span> <span class="o">*</span>
			  <span class="p">((</span><span class="n">mode</span><span class="o">&amp;</span><span class="p">(</span><span class="n">IEEE_G</span><span class="o">|</span><span class="n">IEEE_N_24G</span><span class="p">))</span> <span class="o">?</span> <span class="mi">9</span> <span class="o">:</span> <span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="n">aSifsTime</span><span class="p">;</span>

		<span class="n">dm_init_edca_turbo</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

		<span class="n">u4bAcParam</span> <span class="o">=</span> <span class="p">((((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">tx_op_limit</span><span class="p">[</span><span class="n">pAcParam</span><span class="p">]))</span> <span class="o">&lt;&lt;</span>
			     <span class="n">AC_PARAM_TXOP_LIMIT_OFFSET</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">cw_max</span><span class="p">[</span><span class="n">pAcParam</span><span class="p">]))</span> <span class="o">&lt;&lt;</span>
			     <span class="n">AC_PARAM_ECW_MAX_OFFSET</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(((</span><span class="n">u32</span><span class="p">)(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">cw_min</span><span class="p">[</span><span class="n">pAcParam</span><span class="p">]))</span> <span class="o">&lt;&lt;</span>
			     <span class="n">AC_PARAM_ECW_MIN_OFFSET</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(((</span><span class="n">u32</span><span class="p">)</span><span class="n">u1bAIFS</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">AC_PARAM_AIFS_OFFSET</span><span class="p">));</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;%s():HW_VAR_AC_PARAM eACI:%x:%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">__func__</span><span class="p">,</span> <span class="n">eACI</span><span class="p">,</span> <span class="n">u4bAcParam</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">eACI</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AC1_BK</span>:
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_BK</span><span class="p">,</span> <span class="n">u4bAcParam</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">AC0_BE</span>:
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_BE</span><span class="p">,</span> <span class="n">u4bAcParam</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">AC2_VI</span>:
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_VI</span><span class="p">,</span> <span class="n">u4bAcParam</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="n">AC3_VO</span>:
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EDCAPARA_VO</span><span class="p">,</span> <span class="n">u4bAcParam</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;SetHwReg8185(): invalid ACI: %d !</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">eACI</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">SetHwRegHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">HW_VAR_ACM_CTRL</span><span class="p">,</span>
					      <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">pAcParam</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="n">HW_VAR_ACM_CTRL</span>:
	<span class="p">{</span>
		<span class="k">struct</span> <span class="n">rtllib_qos_parameters</span> <span class="o">*</span><span class="n">qos_parameters</span> <span class="o">=</span>
			 <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">qos_data</span><span class="p">.</span><span class="n">parameters</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">pAcParam</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
		<span class="n">u32</span> <span class="n">eACI</span> <span class="o">=</span> <span class="n">pAcParam</span><span class="p">;</span>
		<span class="k">union</span> <span class="n">aci_aifsn</span> <span class="o">*</span><span class="n">pAciAifsn</span> <span class="o">=</span> <span class="p">(</span><span class="k">union</span> <span class="n">aci_aifsn</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span>
					      <span class="p">(</span><span class="n">qos_parameters</span><span class="o">-&gt;</span><span class="n">aifs</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">u8</span> <span class="n">acm</span> <span class="o">=</span> <span class="n">pAciAifsn</span><span class="o">-&gt;</span><span class="n">f</span><span class="p">.</span><span class="n">acm</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">AcmCtrl</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">AcmHwCtrl</span><span class="p">);</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;===========&gt;%s():HW_VAR_ACM_CTRL:%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">__func__</span><span class="p">,</span> <span class="n">eACI</span><span class="p">);</span>
		<span class="n">AcmCtrl</span> <span class="o">=</span> <span class="n">AcmCtrl</span> <span class="o">|</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AcmMethod</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x0</span> <span class="o">:</span> <span class="mh">0x1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">acm</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">eACI</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">AC0_BE</span>:
				<span class="n">AcmCtrl</span> <span class="o">|=</span> <span class="n">AcmHw_BeqEn</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">AC2_VI</span>:
				<span class="n">AcmCtrl</span> <span class="o">|=</span> <span class="n">AcmHw_ViqEn</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">AC3_VO</span>:
				<span class="n">AcmCtrl</span> <span class="o">|=</span> <span class="n">AcmHw_VoqEn</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_QOS</span><span class="p">,</span> <span class="s">&quot;SetHwReg8185(): [HW_VAR_&quot;</span>
					 <span class="s">&quot;ACM_CTRL] acm set failed: eACI is &quot;</span>
					 <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">eACI</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">eACI</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">AC0_BE</span>:
				<span class="n">AcmCtrl</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">AcmHw_BeqEn</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">AC2_VI</span>:
				<span class="n">AcmCtrl</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">AcmHw_ViqEn</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="k">case</span> <span class="n">AC3_VO</span>:
				<span class="n">AcmCtrl</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">AcmHw_BeqEn</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>

			<span class="nl">default:</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_QOS</span><span class="p">,</span> <span class="s">&quot;SetHwReg8190pci(): [HW_VAR_ACM_CTRL] Write&quot;</span>
			 <span class="s">&quot; 0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">AcmCtrl</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">AcmHwCtrl</span><span class="p">,</span> <span class="n">AcmCtrl</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="n">HW_VAR_SIFS</span>:
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SIFS</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SIFS</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HW_VAR_RF_TIMING</span>:
	<span class="p">{</span>
		<span class="n">u8</span> <span class="n">Rf_Timing</span> <span class="o">=</span> <span class="o">*</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">val</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFTiming1</span><span class="p">,</span> <span class="n">Rf_Timing</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_read_eeprom_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">u8</span> <span class="n">tempval</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ICVer8192</span><span class="p">,</span> <span class="n">ICVer8256</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">i</span><span class="p">,</span> <span class="n">usValue</span><span class="p">,</span> <span class="n">IC_Version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">EEPROMId</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bMac_Tmp_Addr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">};</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;====&gt; rtl8192_read_eeprom_info</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">EEPROMId</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">EEPROMId</span> <span class="o">!=</span> <span class="n">RTL8190_EEPROM_ID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;EEPROM ID is invalid:%x, %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">EEPROMId</span><span class="p">,</span> <span class="n">RTL8190_EEPROM_ID</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_vid</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">EEPROM_VID</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_did</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">EEPROM_DID</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>

		<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)(</span><span class="n">EEPROM_Customer_ID</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_CustomerID</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">usValue</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
		<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">EEPROM_ICVersion_ChannelPlan</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">));</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_ChannelPlan</span> <span class="o">=</span> <span class="n">usValue</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">;</span>
		<span class="n">IC_Version</span> <span class="o">=</span> <span class="p">((</span><span class="n">usValue</span><span class="o">&amp;</span><span class="mh">0xff00</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>

		<span class="n">ICVer8192</span> <span class="o">=</span> <span class="p">(</span><span class="n">IC_Version</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">);</span>
		<span class="n">ICVer8256</span> <span class="o">=</span> <span class="p">((</span><span class="n">IC_Version</span><span class="o">&amp;</span><span class="mh">0xf0</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">ICVer8192 = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ICVer8192</span><span class="p">);</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">ICVer8256 = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ICVer8256</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ICVer8192</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ICVer8256</span> <span class="o">==</span> <span class="mh">0x5</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">=</span> <span class="n">VERSION_8190_BE</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">VERSION_8190_BD</span>:
		<span class="k">case</span> <span class="n">VERSION_8190_BE</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">=</span> <span class="n">VERSION_8190_BD</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">IC Version = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">=</span> <span class="n">VERSION_8190_BD</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_vid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_did</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_CustomerID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_ChannelPlan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">IC Version = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROM VID = 0x%4x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_vid</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROM DID = 0x%4x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_did</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROM Customer ID: 0x%2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_CustomerID</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				 <span class="p">(</span><span class="n">u16</span><span class="p">)((</span><span class="n">EEPROM_NODE_ADDRESS_BYTE_0</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>
			<span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="n">usValue</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">,</span> <span class="n">bMac_Tmp_Addr</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Permanent Address = %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">&gt;</span> <span class="n">VERSION_8190_BD</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bTXPowerDataReadFromEEPORM</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bTXPowerDataReadFromEEPORM</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">=</span> <span class="n">RTL819X_DEFAULT_RF_TYPE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">&gt;</span> <span class="n">VERSION_8190_BD</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tempval</span> <span class="o">=</span> <span class="p">(</span><span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">EEPROM_RFInd_PowerDiff</span> <span class="o">&gt;&gt;</span>
					      <span class="mi">1</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMLegacyHTTxPowerDiff</span> <span class="o">=</span> <span class="n">tempval</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">tempval</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">=</span> <span class="n">RF_1T2R</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">=</span> <span class="n">RF_2T4R</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMLegacyHTTxPowerDiff</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROMLegacyHTTxPowerDiff = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMLegacyHTTxPowerDiff</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(((</span><span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						   <span class="p">(</span><span class="n">EEPROM_ThermalMeter</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)))</span> <span class="o">&amp;</span>
						   <span class="mh">0xff00</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">=</span> <span class="n">EEPROM_Default_ThermalMeter</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;ThermalMeter = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TSSI_13dBm</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">==</span> <span class="n">EEPROM_93C46</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
					  <span class="p">(</span><span class="n">EEPROM_TxPwDiff_CrystalCap</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">usValue</span><span class="o">&amp;</span><span class="mh">0x0fff</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMCrystalCap</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)((</span><span class="n">usValue</span> <span class="o">&amp;</span> <span class="mh">0xf000</span><span class="p">)</span>
							 <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span> <span class="o">=</span>
					 <span class="n">EEPROM_Default_AntTxPowerDiff</span><span class="p">;</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMCrystalCap</span> <span class="o">=</span>
					 <span class="n">EEPROM_Default_TxPwDiff_CrystalCap</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROMAntPwDiff = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;EEPROMCrystalCap = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMCrystalCap</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span>
					<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						  <span class="p">(</span><span class="n">u16</span><span class="p">)((</span><span class="n">EEPROM_TxPwIndex_CCK</span> <span class="o">+</span>
						  <span class="n">i</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>
				<span class="k">else</span>
					<span class="n">usValue</span> <span class="o">=</span> <span class="n">EEPROM_Default_TxPower</span><span class="p">;</span>
				<span class="o">*</span><span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelCCK</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">=</span>
								 <span class="n">usValue</span><span class="p">;</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;CCK Tx Power Level, Index&quot;</span>
					 <span class="s">&quot; %d = 0x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelCCK</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;CCK Tx Power Level, Index&quot;</span>
					 <span class="s">&quot; %d = 0x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelCCK</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">AutoloadFailFlag</span><span class="p">)</span>
					<span class="n">usValue</span> <span class="o">=</span> <span class="n">eprom_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
						<span class="p">(</span><span class="n">u16</span><span class="p">)((</span><span class="n">EEPROM_TxPwIndex_OFDM_24G</span>
						<span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">));</span>
				<span class="k">else</span>
					<span class="n">usValue</span> <span class="o">=</span> <span class="n">EEPROM_Default_TxPower</span><span class="p">;</span>
				<span class="o">*</span><span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
							 <span class="o">=</span> <span class="n">usValue</span><span class="p">;</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;OFDM 2.4G Tx Power Level,&quot;</span>
					 <span class="s">&quot; Index %d = 0x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;OFDM 2.4G Tx Power Level,&quot;</span>
					 <span class="s">&quot; Index %d = 0x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">==</span> <span class="n">EEPROM_93C46</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelCCK</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMTxPowerLevelOFDM24G</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">LegacyHTTxPowerDiff</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMLegacyHTTxPowerDiff</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span> <span class="o">&amp;</span>
						    <span class="mh">0xf</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span> <span class="o">&amp;</span>
						    <span class="mh">0xf0</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMAntPwDiff</span> <span class="o">&amp;</span>
						    <span class="mh">0xf00</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CrystalCap</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMCrystalCap</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">&amp;</span>
						 <span class="mh">0xf</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">&amp;</span>
						 <span class="mh">0xf0</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">==</span> <span class="n">EEPROM_93C56</span><span class="p">)</span> <span class="p">{</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfACCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfAOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCCCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfACCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfAOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCCCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfACCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfAOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCCCKChnl1TxPwLevel</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMRfCOfdmChnlTxPwLevel</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;priv-&gt;TxPowerLevelCCK_A&quot;</span>
					 <span class="s">&quot;[%d] = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_A</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;priv-&gt;TxPowerLevelOFDM&quot;</span>
					 <span class="s">&quot;24G_A[%d] = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_A</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;priv-&gt;TxPowerLevelCCK_C&quot;</span>
					 <span class="s">&quot;[%d] = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelCCK_C</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;priv-&gt;TxPowerLevelOFDM&quot;</span>
					 <span class="s">&quot;24G_C[%d] = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxPowerLevelOFDM24G_C</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">LegacyHTTxPowerDiff</span> <span class="o">=</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMLegacyHTTxPowerDiff</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">AntennaTxPwDiff</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CrystalCap</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMCrystalCap</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">&amp;</span>
						 <span class="mh">0xf</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ThermalMeter</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">EEPROMThermalMeter</span> <span class="o">&amp;</span>
						 <span class="mh">0xf0</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* no matter what checkpatch says, the braces are needed */</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">1T2R config</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_2T4R</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">2T4R config</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">init_rate_adaptive</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_chip</span> <span class="o">=</span> <span class="n">RF_8256</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegChannelPlan</span> <span class="o">==</span> <span class="mh">0xf</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_ChannelPlan</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegChannelPlan</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_vid</span> <span class="o">==</span> <span class="mh">0x1186</span> <span class="o">&amp;&amp;</span>  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_did</span> <span class="o">==</span> <span class="mh">0x3304</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span>  <span class="n">RT_CID_DLINK</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_CustomerID</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_DEFAULT</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_DEFAULT</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_CAMEO</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_819x_CAMEO</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span>  <span class="n">EEPROM_CID_RUNTOP</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_819x_RUNTOP</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_NetCore</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_819x_Netcore</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_TOSHIBA</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_TOSHIBA</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_ChannelPlan</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_ChannelPlan</span><span class="o">&amp;</span><span class="mh">0x7f</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Toshiba ChannelPlan = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_Nettronix</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ScanDelay</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_Nettronix</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_Pronet</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_PRONET</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EEPROM_CID_DLINK</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CustomerID</span> <span class="o">=</span> <span class="n">RT_CID_DLINK</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">EEPROM_CID_WHQL</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">&gt;</span> <span class="n">CHANNEL_PLAN_LEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span> <span class="o">=</span> <span class="n">COUNTRY_CODE_WORLD_WIDE_13</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_vid</span> <span class="o">==</span> <span class="mh">0x1186</span> <span class="o">&amp;&amp;</span>  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom_did</span> <span class="o">==</span> <span class="mh">0x3304</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;RegChannelPlan(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegChannelPlan</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;ChannelPlan = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ChannelPlan</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_TRACE</span><span class="p">,</span> <span class="s">&quot;&lt;==== ReadAdapterInfo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_get_eeprom_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">curCR</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;===========&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="n">curCR</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">EPROM_CMD</span><span class="p">);</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;read from Reg Cmd9346CR(%x):%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">EPROM_CMD</span><span class="p">,</span>
		 <span class="n">curCR</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">curCR</span> <span class="o">&amp;</span> <span class="n">EPROM_CMD_9356SEL</span><span class="p">)</span> <span class="o">?</span> <span class="n">EEPROM_93C56</span> <span class="o">:</span>
			  <span class="n">EEPROM_93C46</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;&lt;===========%s(), epromtype:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">epromtype</span><span class="p">);</span>
	<span class="n">rtl8192_read_eeprom_info</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_hwconfig</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">regRATR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">regRRSR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regBwOpMode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">regTmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_B</span>:
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span><span class="p">;</span>
		<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_A</span>:
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_5G</span> <span class="o">|</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_G</span>:
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_AUTO</span>:
	<span class="k">case</span> <span class="n">WIRELESS_MODE_N_24G</span>:
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
			<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span> <span class="o">|</span>
				  <span class="n">RATE_ALL_OFDM_1SS</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_2SS</span><span class="p">;</span>
			<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">WIRELESS_MODE_N_5G</span>:
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_5G</span><span class="p">;</span>
		<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_OFDM_AG</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_1SS</span> <span class="o">|</span>
			  <span class="n">RATE_ALL_OFDM_2SS</span><span class="p">;</span>
		<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">regBwOpMode</span> <span class="o">=</span> <span class="n">BW_OPMODE_20MHZ</span><span class="p">;</span>
		<span class="n">regRATR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="n">regRRSR</span> <span class="o">=</span> <span class="n">RATE_ALL_CCK</span> <span class="o">|</span> <span class="n">RATE_ALL_OFDM_AG</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BW_OPMODE</span><span class="p">,</span> <span class="n">regBwOpMode</span><span class="p">);</span>
	<span class="p">{</span>
		<span class="n">u32</span> <span class="n">ratr_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ratr_value</span> <span class="o">=</span> <span class="n">regRATR</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span>
			<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">RATE_ALL_OFDM_2SS</span><span class="p">);</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="p">,</span> <span class="n">ratr_value</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">regTmp</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x313</span><span class="p">);</span>
	<span class="n">regRRSR</span> <span class="o">=</span> <span class="p">((</span><span class="n">regTmp</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">regRRSR</span> <span class="o">&amp;</span> <span class="mh">0x00ffffff</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RRSR</span><span class="p">,</span> <span class="n">regRRSR</span><span class="p">);</span>

	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RETRY_LIMIT</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ShortRetryLimit</span> <span class="o">&lt;&lt;</span> <span class="n">RETRY_LIMIT_SHORT_SHIFT</span> <span class="o">|</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">LongRetryLimit</span> <span class="o">&lt;&lt;</span> <span class="n">RETRY_LIMIT_LONG_SHIFT</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_adapter_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">ulRegRead</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tmpvalue</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ICVersion</span><span class="p">,</span> <span class="n">SwitchingRegulatorOutput</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bfirmwareok</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tmpRegA</span><span class="p">,</span> <span class="n">tmpRegC</span><span class="p">,</span> <span class="n">TempCCk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">retry_times</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;====&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">being_init_adapter</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

<span class="nl">start:</span>
	<span class="n">rtl8192_pci_resetdescring</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">Rf_Mode</span> <span class="o">=</span> <span class="n">RF_OP_By_SW_3wire</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ResetProgress</span> <span class="o">==</span> <span class="n">RESET_TYPE_NORESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ANAPAR</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">);</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">pFirmware</span><span class="o">-&gt;</span><span class="n">firmware_status</span> <span class="o">=</span> <span class="n">FW_STATUS_0_INIT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegRfOff</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">=</span> <span class="n">eRfOff</span><span class="p">;</span>

	<span class="n">ulRegRead</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pFirmware</span><span class="o">-&gt;</span><span class="n">firmware_status</span> <span class="o">==</span> <span class="n">FW_STATUS_0_INIT</span><span class="p">)</span>
		<span class="n">ulRegRead</span> <span class="o">|=</span> <span class="n">CPU_GEN_SYSTEM_RESET</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pFirmware</span><span class="o">-&gt;</span><span class="n">firmware_status</span> <span class="o">==</span> <span class="n">FW_STATUS_5_READY</span><span class="p">)</span>
		<span class="n">ulRegRead</span> <span class="o">|=</span> <span class="n">CPU_GEN_FIRMWARE_RESET</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;ERROR in %s(): undefined firmware state(%d)&quot;</span>
			 <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>   <span class="n">priv</span><span class="o">-&gt;</span><span class="n">pFirmware</span><span class="o">-&gt;</span><span class="n">firmware_status</span><span class="p">);</span>

	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="n">ulRegRead</span><span class="p">);</span>

	<span class="n">ICVersion</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">IC_VERRSION</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ICVersion</span> <span class="o">&gt;=</span> <span class="mh">0x4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">SwitchingRegulatorOutput</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SWREGULATOR</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">SwitchingRegulatorOutput</span>  <span class="o">!=</span> <span class="mh">0xb8</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SWREGULATOR</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">);</span>
			<span class="n">mdelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SWREGULATOR</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;BB Config Start!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">rtStatus</span> <span class="o">=</span> <span class="n">rtl8192_BBConfig</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rtStatus</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;BB Config failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;BB Config Finished!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">LoopbackMode</span> <span class="o">=</span> <span class="n">RTL819X_NO_LOOPBACK</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ResetProgress</span> <span class="o">==</span> <span class="n">RESET_TYPE_NORESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ulRegRead</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">LoopbackMode</span> <span class="o">==</span> <span class="n">RTL819X_NO_LOOPBACK</span><span class="p">)</span>
			<span class="n">ulRegRead</span> <span class="o">=</span> <span class="p">((</span><span class="n">ulRegRead</span> <span class="o">&amp;</span> <span class="n">CPU_GEN_NO_LOOPBACK_MSK</span><span class="p">)</span> <span class="o">|</span>
				     <span class="n">CPU_GEN_NO_LOOPBACK_SET</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">LoopbackMode</span> <span class="o">==</span> <span class="n">RTL819X_MAC_LOOPBACK</span><span class="p">)</span>
			<span class="n">ulRegRead</span> <span class="o">|=</span> <span class="n">CPU_CCK_LOOPBACK</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;Serious error: wrong loopback&quot;</span>
				 <span class="s">&quot; mode setting</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="n">ulRegRead</span><span class="p">);</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">rtl8192_hwconfig</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CMDR</span><span class="p">,</span> <span class="n">CR_RE</span> <span class="o">|</span> <span class="n">CR_TE</span><span class="p">);</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">PCIF</span><span class="p">,</span> <span class="p">((</span><span class="n">MXDMA2_NoLimit</span><span class="o">&lt;&lt;</span><span class="n">MXDMA2_RX_SHIFT</span><span class="p">)</span> <span class="o">|</span>
		       <span class="p">(</span><span class="n">MXDMA2_NoLimit</span><span class="o">&lt;&lt;</span><span class="n">MXDMA2_TX_SHIFT</span><span class="p">)));</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MAC0</span><span class="p">,</span> <span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MAC4</span><span class="p">,</span> <span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span><span class="p">);</span>

	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RQPN1</span><span class="p">,</span>  <span class="n">NUM_OF_PAGE_IN_FW_QUEUE_BK</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_BK_SHIFT</span> <span class="o">|</span>
			<span class="n">NUM_OF_PAGE_IN_FW_QUEUE_BE</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_BE_SHIFT</span> <span class="o">|</span>
			<span class="n">NUM_OF_PAGE_IN_FW_QUEUE_VI</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_VI_SHIFT</span> <span class="o">|</span>
			<span class="n">NUM_OF_PAGE_IN_FW_QUEUE_VO</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_VO_SHIFT</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RQPN2</span><span class="p">,</span> <span class="n">NUM_OF_PAGE_IN_FW_QUEUE_MGNT</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_MGNT_SHIFT</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RQPN3</span><span class="p">,</span> <span class="n">APPLIED_RESERVED_QUEUE_IN_FW</span> <span class="o">|</span>
			<span class="n">NUM_OF_PAGE_IN_FW_QUEUE_BCN</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_BCN_SHIFT</span><span class="o">|</span>
			<span class="n">NUM_OF_PAGE_IN_FW_QUEUE_PUB</span> <span class="o">&lt;&lt;</span>
			<span class="n">RSVD_FW_QUEUE_PAGE_PUB_SHIFT</span><span class="p">);</span>

	<span class="n">rtl8192_tx_enable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">rtl8192_rx_enable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">ulRegRead</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0xFFF00000</span> <span class="o">&amp;</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RRSR</span><span class="p">))</span>  <span class="o">|</span>
		     <span class="n">RATE_ALL_OFDM_AG</span> <span class="o">|</span> <span class="n">RATE_ALL_CCK</span><span class="p">;</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RRSR</span><span class="p">,</span> <span class="n">ulRegRead</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="n">RATE_ALL_OFDM_AG</span> <span class="o">|</span> <span class="n">RATE_ALL_CCK</span><span class="p">));</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ACK_TIMEOUT</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ResetProgress</span> <span class="o">==</span> <span class="n">RESET_TYPE_NORESET</span><span class="p">)</span>
		<span class="n">rtl8192_SetWirelessMode</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">);</span>
	<span class="n">CamResetAllEntry</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="p">{</span>
		<span class="n">u8</span> <span class="n">SECR_value</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
		<span class="n">SECR_value</span> <span class="o">|=</span> <span class="n">SCR_TxEncEnable</span><span class="p">;</span>
		<span class="n">SECR_value</span> <span class="o">|=</span> <span class="n">SCR_RxDecEnable</span><span class="p">;</span>
		<span class="n">SECR_value</span> <span class="o">|=</span> <span class="n">SCR_NoSKMC</span><span class="p">;</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">SECR</span><span class="p">,</span> <span class="n">SECR_value</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ATIMWND</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_INTERVAL</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
	<span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">QOS_QUEUE_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WDCAPARA_ADD</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mh">0x005e4332</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">);</span>

	<span class="n">rtl8192_phy_configmac</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">card_8192_version</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">VERSION_8190_BD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8192_phy_getTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="n">rtl8192_phy_setTxPower</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">chan</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">tmpvalue</span> <span class="o">=</span> <span class="n">read_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">IC_VERRSION</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">=</span> <span class="n">tmpvalue</span><span class="p">;</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;priv-&gt;IC_Cut= 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">&gt;=</span> <span class="n">IC_VersionCut_D</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">==</span> <span class="n">IC_VersionCut_D</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* no matter what checkpatch says, braces are needed */</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;D-cut</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">==</span> <span class="n">IC_VersionCut_E</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;E-cut</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Before C-cut</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Load Firmware!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">bfirmwareok</span> <span class="o">=</span> <span class="n">init_firmware</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bfirmwareok</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">retry_times</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">retry_times</span><span class="o">++</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">start</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rtStatus</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">end</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;Load Firmware finished!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ResetProgress</span> <span class="o">==</span> <span class="n">RESET_TYPE_NORESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;RF Config Started!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rtStatus</span> <span class="o">=</span> <span class="n">rtl8192_phy_RFConfig</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rtStatus</span> <span class="o">!=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;RF Config failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_INIT</span><span class="p">,</span> <span class="s">&quot;RF Config Finished!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">rtl8192_phy_updateInitGain</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFMOD</span><span class="p">,</span> <span class="n">bCCKEn</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
	<span class="n">rtl8192_setBBreg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">rFPGA0_RFMOD</span><span class="p">,</span> <span class="n">bOFDMEn</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RegRfOff</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_INIT</span> <span class="o">|</span> <span class="n">COMP_RF</span> <span class="o">|</span> <span class="n">COMP_POWER</span><span class="p">),</span>
			  <span class="s">&quot;%s(): Turn off RF for RegRfOff ----------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			  <span class="n">__func__</span><span class="p">);</span>
		<span class="n">MgntActSet_RF_State</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRfOff</span><span class="p">,</span> <span class="n">RF_CHANGE_BY_SW</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span> <span class="o">&gt;</span> <span class="n">RF_CHANGE_BY_PS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_INIT</span><span class="o">|</span><span class="n">COMP_RF</span><span class="o">|</span><span class="n">COMP_POWER</span><span class="p">),</span> <span class="s">&quot;%s(): Turn off RF for&quot;</span>
			 <span class="s">&quot; RfOffReason(%d) ----------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span><span class="p">);</span>
		<span class="n">MgntActSet_RF_State</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRfOff</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span><span class="p">,</span>
				    <span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span> <span class="o">&gt;=</span> <span class="n">RF_CHANGE_BY_IPS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_INIT</span><span class="o">|</span><span class="n">COMP_RF</span><span class="o">|</span><span class="n">COMP_POWER</span><span class="p">),</span> <span class="s">&quot;%s(): Turn off RF for&quot;</span>
			 <span class="s">&quot; RfOffReason(%d) ----------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span><span class="p">);</span>
		<span class="n">MgntActSet_RF_State</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">eRfOff</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span><span class="p">,</span>
				    <span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">((</span><span class="n">COMP_INIT</span><span class="o">|</span><span class="n">COMP_RF</span><span class="o">|</span><span class="n">COMP_POWER</span><span class="p">),</span> <span class="s">&quot;%s(): RF-ON</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			  <span class="n">__func__</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">eRFPowerState</span> <span class="o">=</span> <span class="n">eRfOn</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">RfOffReason</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">FwRWRF</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">Rf_Mode</span> <span class="o">=</span> <span class="n">RF_OP_By_FW</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">Rf_Mode</span> <span class="o">=</span> <span class="n">RF_OP_By_SW_3wire</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ResetProgress</span> <span class="o">==</span> <span class="n">RESET_TYPE_NORESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dm_initialize_txpower_tracking</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">IC_Cut</span> <span class="o">&gt;=</span> <span class="n">IC_VersionCut_D</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tmpRegA</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				  <span class="n">rOFDM0_XATxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">);</span>
			<span class="n">tmpRegC</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				  <span class="n">rOFDM0_XCTxIQImbalance</span><span class="p">,</span> <span class="n">bMaskDWord</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TxBBGainTableLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tmpRegA</span> <span class="o">==</span>
				    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txbbgain_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">txbbgain_value</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span> <span class="o">=</span>
						 <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertracking_default</span> <span class="o">=</span>
						 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="n">TempCCk</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span>
				  <span class="n">rCCK0_TxFilter1</span><span class="p">,</span> <span class="n">bMaskByte2</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">CCKTxBBGainTableLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">TempCCk</span> <span class="o">==</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cck_txbbgain_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ccktxbb_valuearray</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_20Mdefault</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">i</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_40Mdefault</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_difference</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span> <span class="o">=</span>
				  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_20Mdefault</span><span class="p">;</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpower&quot;</span>
				 <span class="s">&quot;trackingindex_initial = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;rfa_txpower&quot;</span>
				 <span class="s">&quot;trackingindex_real__initial = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rfa_txpowertrackingindex_real</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;CCKPresent&quot;</span>
				 <span class="s">&quot;Attentuation_difference_initial = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation_difference</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_POWER_TRACKING</span><span class="p">,</span> <span class="s">&quot;priv-&gt;CCKPresent&quot;</span>
				 <span class="s">&quot;Attentuation_initial = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">CCKPresentAttentuation</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">btxpower_tracking</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">rtl8192_irq_enable</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="nl">end:</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">being_init_adapter</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">rtStatus</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_net_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">net</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">BcnTimeCfg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BcnCW</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">BcnIFS</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rate_config</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>
	<span class="n">rtl8192_config_rate</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rate_config</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dot11CurrentPreambleMode</span> <span class="o">=</span> <span class="n">PREAMBLE_AUTO</span><span class="p">;</span>
	 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">basic_rate</span> <span class="o">=</span> <span class="n">rate_config</span> <span class="o">&amp;=</span> <span class="mh">0x15f</span><span class="p">;</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BSSIDR</span><span class="p">,</span> <span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BSSIDR</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="p">((</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">)[</span><span class="mi">2</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_ADHOC</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ATIMWND</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_DMATIME</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_INTERVAL</span><span class="p">,</span> <span class="n">net</span><span class="o">-&gt;</span><span class="n">beacon_interval</span><span class="p">);</span>
		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_DRV_EARLY_INT</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_ERR_THRESH</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

		<span class="n">BcnTimeCfg</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BcnCW</span><span class="o">&lt;&lt;</span><span class="n">BCN_TCFG_CW_SHIFT</span><span class="p">);</span>
		<span class="n">BcnTimeCfg</span> <span class="o">|=</span> <span class="n">BcnIFS</span><span class="o">&lt;&lt;</span><span class="n">BCN_TCFG_IFS</span><span class="p">;</span>

		<span class="n">write_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BCN_TCFG</span><span class="p">,</span> <span class="n">BcnTimeCfg</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_link_change</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">up</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">RTLLIB_LINKED</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8192_net_update</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">update_ratr_table</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">KEY_TYPE_WEP40</span> <span class="o">==</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">KEY_TYPE_WEP104</span> <span class="o">==</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span><span class="p">))</span>
			<span class="n">EnableHWSecurityConfig8192</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x173</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">rtl8192e_update_msr</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_INFRA</span> <span class="o">||</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_ADHOC</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">reg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">==</span> <span class="n">RTLLIB_LINKED</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">IntelPromiscuousModeInfo</span><span class="p">.</span><span class="n">bPromiscuousOn</span><span class="p">)</span>
				<span class="p">;</span>
			<span class="k">else</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">|=</span> <span class="n">RCR_CBSSID</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">=</span> <span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RCR_CBSSID</span><span class="p">;</span>

		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_AllowAllDestAddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="n">bool</span> <span class="n">bAllowAllDA</span><span class="p">,</span> <span class="n">bool</span> <span class="n">WriteIntoReg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bAllowAllDA</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">|=</span> <span class="n">RCR_AAP</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">RCR_AAP</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">WriteIntoReg</span><span class="p">)</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RCR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">MRateToHwRate8190Pci</span><span class="p">(</span><span class="n">u8</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>  <span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE1M</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">MGN_1M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE1M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_2M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE2M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_5_5M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE5_5M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_11M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE11M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_6M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE6M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_9M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE9M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_12M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE12M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_18M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE18M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_24M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE24M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_36M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE36M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_48M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE48M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_54M</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATE54M</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS0</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS1</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS2</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS3</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS4</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS4</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS5</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS5</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS6</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS6</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS7</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS7</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS8</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS9</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS9</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS10</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS10</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS11</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS11</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS12</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS12</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS13</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS13</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS14</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS14</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS15</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS15</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="p">(</span><span class="mh">0x80</span><span class="o">|</span><span class="mh">0x20</span><span class="p">)</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">DESC90_RATEMCS32</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">rtl8192_MapHwQueueToFirmwareQueue</span><span class="p">(</span><span class="n">u8</span> <span class="n">QueueID</span><span class="p">,</span> <span class="n">u8</span> <span class="n">priority</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">QueueSelect</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">QueueID</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BE_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_BE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">BK_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_BK</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">VO_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_VO</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">VI_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_VI</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGNT_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_MGNT</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BEACON_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_BEACON</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TXCMD_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_CMD</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HIGH_QUEUE</span>:
		<span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_HIGH</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_ERR</span><span class="p">,</span> <span class="s">&quot;TransmitTCB(): Impossible Queue Selection:&quot;</span>
			 <span class="s">&quot; %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">QueueID</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">QueueSelect</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>  <span class="nf">rtl8192_tx_fill_desc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">tx_desc</span> <span class="o">*</span><span class="n">pdesc</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">cb_desc</span> <span class="o">*</span><span class="n">cb_desc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dma_addr_t</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">pci_map_single</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span>
			 <span class="n">PCI_DMA_TODEVICE</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span> <span class="o">*</span><span class="n">pTxFwInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span> <span class="o">*</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pTxFwInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">));</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxHT</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">data_rate</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxRate</span> <span class="o">=</span> <span class="n">MRateToHwRate8190Pci</span><span class="p">((</span><span class="n">u8</span><span class="p">)</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">data_rate</span><span class="p">);</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">EnableCPUDur</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bTxEnableFwCalcDur</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">Short</span> <span class="o">=</span> <span class="n">rtl8192_QueryIsShort</span><span class="p">(</span><span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxHT</span><span class="p">,</span>
						<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxRate</span><span class="p">,</span>
						<span class="n">cb_desc</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">AllowAggregation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RxMF</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">ampdu_factor</span><span class="p">;</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RxAMD</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">ampdu_density</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">AllowAggregation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RxMF</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RxAMD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsEnable</span> <span class="o">=</span>	<span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bRTSEnable</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">CtsEnable</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bCTSEnable</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsSTBC</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bRTSSTBC</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsHT</span> <span class="o">=</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">rts_rate</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsRate</span> <span class="o">=</span> <span class="n">MRateToHwRate8190Pci</span><span class="p">((</span><span class="n">u8</span><span class="p">)</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">rts_rate</span><span class="p">);</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsBandwidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsSubcarrier</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">RTSSC</span><span class="p">;</span>
	<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsShort</span> <span class="o">=</span> <span class="p">(</span><span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">RtsHT</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span>
			  <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bRTSUseShortPreamble</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span>
			  <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bRTSUseShortGI</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bPacketBW</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxBandwidth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxSubCarrier</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxBandwidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxSubCarrier</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">nCur40MhzPrimeSC</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxBandwidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pTxFwInfo</span><span class="o">-&gt;</span><span class="n">TxSubCarrier</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">pdesc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">LINIP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">CmdInit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">PktSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="o">-</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">);</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecCAMID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">RATid</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">RATRIndex</span><span class="p">;</span>


	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">NoEnc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecType</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bHwSec</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">static</span> <span class="n">u8</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tmp</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;==&gt;================hw sec</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">tmp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">KEY_TYPE_WEP40</span>:
		<span class="k">case</span> <span class="n">KEY_TYPE_WEP104</span>:
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecType</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">NoEnc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_TYPE_TKIP</span>:
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecType</span> <span class="o">=</span> <span class="mh">0x2</span><span class="p">;</span>
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">NoEnc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_TYPE_CCMP</span>:
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecType</span> <span class="o">=</span> <span class="mh">0x3</span><span class="p">;</span>
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">NoEnc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">KEY_TYPE_NA</span>:
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SecType</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
			<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">NoEnc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">PktId</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">rtl8192_MapHwQueueToFirmwareQueue</span><span class="p">(</span>
						<span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">queue_index</span><span class="p">,</span>
						<span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">priority</span><span class="p">);</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">TxFWInfoSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">);</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">DISFB</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bTxDisableRateFallBack</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">USERATE</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bTxUseDriverAssingedRate</span><span class="p">;</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">FirstSeg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">LastSeg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">TxBufferSize</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

	<span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">TxBuffAddr</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">(</span><span class="n">mapping</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>  <span class="nf">rtl8192_tx_fill_cmd_desc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">tx_desc_cmd</span> <span class="o">*</span><span class="n">entry</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">cb_desc</span> <span class="o">*</span><span class="n">cb_desc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span><span class="o">*</span> <span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">dma_addr_t</span> <span class="n">mapping</span> <span class="o">=</span> <span class="n">pci_map_single</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span>
			 <span class="n">PCI_DMA_TODEVICE</span><span class="p">);</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">LINIP</span> <span class="o">=</span> <span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bLastIniPkt</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">FirstSeg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">LastSeg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">bCmdOrInit</span> <span class="o">==</span> <span class="n">DESC_PACKET_TYPE_INIT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">entry</span><span class="o">-&gt;</span><span class="n">CmdInit</span> <span class="o">=</span> <span class="n">DESC_PACKET_TYPE_INIT</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">tx_desc</span> <span class="o">*</span> <span class="n">entry_tmp</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">tx_desc</span> <span class="o">*</span><span class="p">)</span><span class="n">entry</span><span class="p">;</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">CmdInit</span> <span class="o">=</span> <span class="n">DESC_PACKET_TYPE_NORMAL</span><span class="p">;</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">Offset</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">PktSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)(</span><span class="n">cb_desc</span><span class="o">-&gt;</span><span class="n">pkt_size</span> <span class="o">+</span>
				      <span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">Offset</span><span class="p">);</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">QueueSelect</span> <span class="o">=</span> <span class="n">QSLT_CMD</span><span class="p">;</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">TxFWInfoSize</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
		<span class="n">entry_tmp</span><span class="o">-&gt;</span><span class="n">RATid</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">DESC_PACKET_TYPE_INIT</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">TxBufferSize</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">TxBuffAddr</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">(</span><span class="n">mapping</span><span class="p">);</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">OWN</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HwRateToMRate90</span><span class="p">(</span><span class="n">bool</span> <span class="n">bIsHT</span><span class="p">,</span> <span class="n">u8</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>  <span class="n">ret_rate</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bIsHT</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">DESC90_RATE1M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_1M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE2M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_2M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE5_5M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_5_5M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE11M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_11M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE6M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_6M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE9M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_9M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE12M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_12M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE18M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_18M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE24M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_24M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE36M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_36M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE48M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_48M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATE54M</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_54M</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RECV</span><span class="p">,</span> <span class="s">&quot;HwRateToMRate90(): Non supported&quot;</span>
				 <span class="s">&quot;Rate [%x], bIsHT = %d!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">bIsHT</span><span class="p">);</span>
						  <span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS0</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS1</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS2</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS3</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS3</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS4</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS4</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS5</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS5</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS6</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS6</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS7</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS7</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS8</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS8</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS9</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS9</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS10</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS10</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS11</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS11</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS12</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS12</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS13</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS13</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS14</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS14</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS15</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="n">MGN_MCS15</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DESC90_RATEMCS32</span>:
			<span class="n">ret_rate</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x80</span><span class="o">|</span><span class="mh">0x20</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RECV</span><span class="p">,</span> <span class="s">&quot;HwRateToMRate90(): Non supported &quot;</span>
				 <span class="s">&quot;Rate [%x], bIsHT = %d!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rate</span><span class="p">,</span> <span class="n">bIsHT</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret_rate</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">long</span> <span class="nf">rtl8192_signal_scale_mapping</span><span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">long</span> <span class="n">currsig</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">long</span> <span class="n">retsig</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">&gt;=</span> <span class="mi">61</span> <span class="o">&amp;&amp;</span> <span class="n">currsig</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">+</span> <span class="p">((</span><span class="n">currsig</span> <span class="o">-</span> <span class="mi">60</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">&gt;=</span> <span class="mi">41</span> <span class="o">&amp;&amp;</span> <span class="n">currsig</span> <span class="o">&lt;=</span> <span class="mi">60</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">78</span> <span class="o">+</span> <span class="p">((</span><span class="n">currsig</span> <span class="o">-</span> <span class="mi">40</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">&gt;=</span> <span class="mi">31</span> <span class="o">&amp;&amp;</span> <span class="n">currsig</span> <span class="o">&lt;=</span> <span class="mi">40</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">66</span> <span class="o">+</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">-</span> <span class="mi">30</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">&gt;=</span> <span class="mi">21</span> <span class="o">&amp;&amp;</span> <span class="n">currsig</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">54</span> <span class="o">+</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">-</span> <span class="mi">20</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="o">&amp;&amp;</span> <span class="n">currsig</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">42</span> <span class="o">+</span> <span class="p">(((</span><span class="n">currsig</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">currsig</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">retsig</span> <span class="o">=</span> <span class="n">currsig</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retsig</span><span class="p">;</span>
<span class="p">}</span>


<span class="cp">#define	 rx_hal_is_cck_rate(_pdrvinfo)\</span>
<span class="cp">			((_pdrvinfo-&gt;RxRate == DESC90_RATE1M ||\</span>
<span class="cp">			_pdrvinfo-&gt;RxRate == DESC90_RATE2M ||\</span>
<span class="cp">			_pdrvinfo-&gt;RxRate == DESC90_RATE5_5M ||\</span>
<span class="cp">			_pdrvinfo-&gt;RxRate == DESC90_RATE11M) &amp;&amp;\</span>
<span class="cp">			!_pdrvinfo-&gt;RxHT)</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_query_rxphystatus</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">pstats</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">rx_desc</span>  <span class="o">*</span><span class="n">pdesc</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">rx_fwinfo</span>   <span class="o">*</span><span class="n">pdrvinfo</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">precord_stats</span><span class="p">,</span>
	<span class="n">bool</span> <span class="n">bpacket_match_bssid</span><span class="p">,</span>
	<span class="n">bool</span> <span class="n">bpacket_toself</span><span class="p">,</span>
	<span class="n">bool</span> <span class="n">bPacketBeacon</span><span class="p">,</span>
	<span class="n">bool</span> <span class="n">bToSelfBA</span>
	<span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phy_sts_ofdm_819xpci</span> <span class="o">*</span><span class="n">pofdm_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phy_sts_cck_819xpci</span> <span class="o">*</span><span class="n">pcck_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phy_ofdm_rx_status_rxsc_sgien_exintfflag</span> <span class="o">*</span><span class="n">prxsc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">prxpkt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">,</span> <span class="n">max_spatial_stream</span><span class="p">,</span> <span class="n">tmp_rxsnr</span><span class="p">,</span> <span class="n">tmp_rxevm</span><span class="p">,</span> <span class="n">rxsc_sgien_exflg</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">rx_pwr</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">rx_snrX</span><span class="p">,</span> <span class="n">rx_evmX</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">evm</span><span class="p">,</span> <span class="n">pwdb_all</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">RSSI</span><span class="p">,</span> <span class="n">total_rssi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_cck_rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rf_rx_num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span>	<span class="n">u8</span> <span class="n">check_reg824</span><span class="p">;</span>
	<span class="k">static</span>	<span class="n">u32</span> <span class="n">reg824_bit9</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">numqry_phystatus</span><span class="o">++</span><span class="p">;</span>

	<span class="n">is_cck_rate</span> <span class="o">=</span> <span class="n">rx_hal_is_cck_rate</span><span class="p">(</span><span class="n">pdrvinfo</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">precord_stats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_rx_stats</span><span class="p">));</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bPacketMatchBSSID</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">bPacketMatchBSSID</span> <span class="o">=</span>
				    <span class="n">bpacket_match_bssid</span><span class="p">;</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span> <span class="o">=</span> <span class="n">bpacket_toself</span><span class="p">;</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bIsCCK</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">bIsCCK</span> <span class="o">=</span> <span class="n">is_cck_rate</span><span class="p">;</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span> <span class="o">=</span> <span class="n">bPacketBeacon</span><span class="p">;</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span> <span class="o">=</span> <span class="n">bToSelfBA</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">check_reg824</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg824_bit9</span> <span class="o">=</span> <span class="n">rtl8192_QueryBBReg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			      <span class="n">rFPGA0_XA_HSSIParameter2</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">);</span>
		<span class="n">check_reg824</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="n">prxpkt</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">pdrvinfo</span><span class="p">;</span>

	<span class="n">prxpkt</span> <span class="o">+=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rx_fwinfo</span><span class="p">);</span>

	<span class="n">pcck_buf</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">phy_sts_cck_819xpci</span> <span class="o">*</span><span class="p">)</span><span class="n">prxpkt</span><span class="p">;</span>
	<span class="n">pofdm_buf</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">phy_sts_ofdm_819xpci</span> <span class="o">*</span><span class="p">)</span><span class="n">prxpkt</span><span class="p">;</span>

	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_cck_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">report</span><span class="p">;</span>

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">numqry_phystatusCCK</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reg824_bit9</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">report</span> <span class="o">=</span> <span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">;</span>
			<span class="n">report</span> <span class="o">=</span> <span class="n">report</span><span class="o">&gt;&gt;</span><span class="mi">6</span><span class="p">;</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x3</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">35</span> <span class="o">-</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					     <span class="mh">0x3e</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x2</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">23</span> <span class="o">-</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					     <span class="mh">0x3e</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x1</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span> <span class="o">-</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					     <span class="mh">0x3e</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x0</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span> <span class="mh">0x3e</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">report</span> <span class="o">=</span> <span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span> <span class="mh">0x60</span><span class="p">;</span>
			<span class="n">report</span> <span class="o">=</span> <span class="n">report</span><span class="o">&gt;&gt;</span><span class="mi">5</span><span class="p">;</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x3</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">35</span> <span class="o">-</span>
					<span class="p">((</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					<span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x2</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">23</span> <span class="o">-</span>
					<span class="p">((</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					 <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x1</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span> <span class="o">-</span>
					 <span class="p">((</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					 <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x0</span>:
				<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="o">-</span><span class="mi">8</span> <span class="o">-</span>
					 <span class="p">((</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">cck_agc_rpt</span> <span class="o">&amp;</span>
					 <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">pwdb_all</span> <span class="o">=</span> <span class="n">rtl819x_query_rxpwrpercentage</span><span class="p">(</span><span class="n">rx_pwr_all</span><span class="p">);</span>
		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">=</span> <span class="n">pwdb_all</span><span class="p">;</span>
		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RecvSignalPower</span> <span class="o">=</span> <span class="n">rx_pwr_all</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">bpacket_match_bssid</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">u8</span>	<span class="n">sq</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">sq</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">sq</span> <span class="o">=</span> <span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">sq_rpt</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">sq_rpt</span> <span class="o">&gt;</span> <span class="mi">64</span><span class="p">)</span>
					<span class="n">sq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pcck_buf</span><span class="o">-&gt;</span><span class="n">sq_rpt</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">)</span>
					<span class="n">sq</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
				<span class="k">else</span>
					<span class="n">sq</span> <span class="o">=</span> <span class="p">((</span><span class="mi">64</span><span class="o">-</span><span class="n">sq</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">44</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">SignalQuality</span> <span class="o">=</span> <span class="n">sq</span><span class="p">;</span>
			<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">SignalQuality</span> <span class="o">=</span> <span class="n">sq</span><span class="p">;</span>
			<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sq</span><span class="p">;</span>
			<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sq</span><span class="p">;</span>
			<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">numqry_phystatusHT</span><span class="o">++</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">RF90_PATH_A</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">RF90_PATH_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">rf_rx_num</span><span class="o">++</span><span class="p">;</span>

			<span class="n">rx_pwr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">pofdm_buf</span><span class="o">-&gt;</span><span class="n">trsw_gain_X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)</span> <span class="o">*</span>
				     <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">110</span><span class="p">;</span>

			<span class="n">tmp_rxsnr</span> <span class="o">=</span> <span class="n">pofdm_buf</span><span class="o">-&gt;</span><span class="n">rxsnr_X</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">rx_snrX</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">tmp_rxsnr</span><span class="p">);</span>
			<span class="n">rx_snrX</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxSNRdB</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">rx_snrX</span><span class="p">;</span>

			<span class="n">RSSI</span> <span class="o">=</span> <span class="n">rtl819x_query_rxpwrpercentage</span><span class="p">(</span><span class="n">rx_pwr</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">brfpath_rxenable</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">total_rssi</span> <span class="o">+=</span> <span class="n">RSSI</span><span class="p">;</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">bpacket_match_bssid</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">RSSI</span><span class="p">;</span>
				<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
								<span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">RSSI</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>


		<span class="n">rx_pwr_all</span> <span class="o">=</span> <span class="p">(((</span><span class="n">pofdm_buf</span><span class="o">-&gt;</span><span class="n">pwdb_all</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span> <span class="o">-</span> <span class="mi">106</span><span class="p">;</span>
		<span class="n">pwdb_all</span> <span class="o">=</span> <span class="n">rtl819x_query_rxpwrpercentage</span><span class="p">(</span><span class="n">rx_pwr_all</span><span class="p">);</span>

		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">=</span> <span class="n">pwdb_all</span><span class="p">;</span>
		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxPower</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxPower</span> <span class="o">=</span>	<span class="n">rx_pwr_all</span><span class="p">;</span>
		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RecvSignalPower</span> <span class="o">=</span> <span class="n">rx_pwr_all</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pdrvinfo</span><span class="o">-&gt;</span><span class="n">RxHT</span> <span class="o">&amp;&amp;</span> <span class="n">pdrvinfo</span><span class="o">-&gt;</span><span class="n">RxRate</span> <span class="o">&gt;=</span> <span class="n">DESC90_RATEMCS8</span> <span class="o">&amp;&amp;</span>
		    <span class="n">pdrvinfo</span><span class="o">-&gt;</span><span class="n">RxRate</span> <span class="o">&lt;=</span> <span class="n">DESC90_RATEMCS15</span><span class="p">)</span>
			<span class="n">max_spatial_stream</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">max_spatial_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max_spatial_stream</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tmp_rxevm</span> <span class="o">=</span> <span class="n">pofdm_buf</span><span class="o">-&gt;</span><span class="n">rxevm_X</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">rx_evmX</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)(</span><span class="n">tmp_rxevm</span><span class="p">);</span>

			<span class="n">rx_evmX</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>

			<span class="n">evm</span> <span class="o">=</span> <span class="n">rtl819x_evm_dbtopercentage</span><span class="p">(</span><span class="n">rx_evmX</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">bpacket_match_bssid</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">SignalQuality</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">evm</span> <span class="o">&amp;</span>
								 <span class="mh">0xff</span><span class="p">);</span>
					<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">SignalQuality</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">evm</span>
									<span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">evm</span> <span class="o">&amp;</span>
								 <span class="mh">0xff</span><span class="p">);</span>
				<span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">evm</span>
									<span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>


		<span class="n">rxsc_sgien_exflg</span> <span class="o">=</span> <span class="n">pofdm_buf</span><span class="o">-&gt;</span><span class="n">rxsc_sgien_exflg</span><span class="p">;</span>
		<span class="n">prxsc</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">phy_ofdm_rx_status_rxsc_sgien_exintfflag</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">rxsc_sgien_exflg</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pdrvinfo</span><span class="o">-&gt;</span><span class="n">BW</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_bwtype</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">prxsc</span><span class="o">-&gt;</span><span class="n">rxsc</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_bwtype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_cck_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">SignalStrength</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">SignalStrength</span> <span class="o">=</span>
					 <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">rtl8192_signal_scale_mapping</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span>
					 <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">pwdb_all</span><span class="p">));</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rf_rx_num</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pstats</span><span class="o">-&gt;</span><span class="n">SignalStrength</span> <span class="o">=</span> <span class="n">precord_stats</span><span class="o">-&gt;</span><span class="n">SignalStrength</span> <span class="o">=</span>
					 <span class="p">(</span><span class="n">u8</span><span class="p">)(</span><span class="n">rtl8192_signal_scale_mapping</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span>
					 <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">total_rssi</span> <span class="o">/=</span> <span class="n">rf_rx_num</span><span class="p">)));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_process_phyinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">prev_st</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">curr_st</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">bcheck</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rfpath</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ij</span><span class="p">,</span> <span class="n">tmp_val</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">slide_rssi_index</span><span class="p">,</span> <span class="n">slide_rssi_statistics</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">slide_evm_index</span><span class="p">,</span> <span class="n">slide_evm_statistics</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">last_rssi</span><span class="p">,</span> <span class="n">last_evm</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">slide_beacon_adc_pwdb_index</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">slide_beacon_adc_pwdb_statistics</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u32</span> <span class="n">last_beacon_adc_pwdb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtllib_hdr_3addr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">frag</span><span class="p">,</span> <span class="n">seq</span><span class="p">;</span>

	<span class="n">hdr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_hdr_3addr</span> <span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">;</span>
	<span class="n">sc</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">seq_ctl</span><span class="p">);</span>
	<span class="n">frag</span> <span class="o">=</span> <span class="n">WLAN_GET_SEQ_FRAG</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">seq</span> <span class="o">=</span> <span class="n">WLAN_GET_SEQ_SEQ</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">curr_st</span><span class="o">-&gt;</span><span class="n">Seq_Num</span> <span class="o">=</span> <span class="n">seq</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bIsAMPDU</span><span class="p">)</span>
		<span class="n">bcheck</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">slide_rssi_statistics</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">slide_rssi_statistics</span> <span class="o">=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">;</span>
		<span class="n">last_rssi</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_signal_strength</span><span class="p">[</span><span class="n">slide_rssi_index</span><span class="p">];</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_rssi_total</span> <span class="o">-=</span> <span class="n">last_rssi</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_rssi_total</span> <span class="o">+=</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">SignalStrength</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_signal_strength</span><span class="p">[</span><span class="n">slide_rssi_index</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">SignalStrength</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">slide_rssi_index</span> <span class="o">&gt;=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">)</span>
		<span class="n">slide_rssi_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">tmp_val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_rssi_total</span><span class="o">/</span><span class="n">slide_rssi_statistics</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">signal_strength</span> <span class="o">=</span> <span class="n">rtl819x_translate_todbm</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span>
				      <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">tmp_val</span><span class="p">);</span>
	<span class="n">curr_st</span><span class="o">-&gt;</span><span class="n">rssi</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">signal_strength</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketMatchBSSID</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bcheck</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">rtl819x_process_cck_rxpathsel</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">prev_st</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">num_process_phyinfo</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bIsCCK</span> <span class="o">&amp;&amp;</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">rfpath</span> <span class="o">=</span> <span class="n">RF90_PATH_A</span><span class="p">;</span> <span class="n">rfpath</span> <span class="o">&lt;</span> <span class="n">RF90_PATH_C</span><span class="p">;</span> <span class="n">rfpath</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtl8192_phy_CheckIsLegalRFPath</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			    <span class="n">rfpath</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;Jacken -&gt; pPreviousstats-&gt;RxMIMO&quot;</span>
				 <span class="s">&quot;SignalStrength[rfpath]  = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">rfpath</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span>  <span class="o">&gt;</span>
			    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">])</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">=</span>
					<span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span>
					<span class="o">*</span> <span class="p">(</span><span class="n">RX_SMOOTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span>
					<span class="p">[</span><span class="n">rfpath</span><span class="p">]))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="p">);</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span>
					 <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">=</span>
				   <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]</span> <span class="o">*</span>
				   <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
				   <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalStrength</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]))</span> <span class="o">/</span>
				   <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_DBG</span><span class="p">,</span> <span class="s">&quot;Jacken -&gt; priv-&gt;RxStats.RxRSSI&quot;</span>
				 <span class="s">&quot;Percentage[rfPath]  = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_rssi_percentage</span><span class="p">[</span><span class="n">rfpath</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">slide_beacon_adc_pwdb_statistics</span><span class="o">++</span> <span class="o">&gt;=</span>
		    <span class="n">PHY_Beacon_RSSI_SLID_WIN_MAX</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">slide_beacon_adc_pwdb_statistics</span> <span class="o">=</span>
					 <span class="n">PHY_Beacon_RSSI_SLID_WIN_MAX</span><span class="p">;</span>
			<span class="n">last_beacon_adc_pwdb</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">Slide_Beacon_pwdb</span>
					       <span class="p">[</span><span class="n">slide_beacon_adc_pwdb_index</span><span class="p">];</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">Slide_Beacon_Total</span> <span class="o">-=</span> <span class="n">last_beacon_adc_pwdb</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">Slide_Beacon_Total</span> <span class="o">+=</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">Slide_Beacon_pwdb</span><span class="p">[</span><span class="n">slide_beacon_adc_pwdb_index</span><span class="p">]</span> <span class="o">=</span>
							 <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">;</span>
		<span class="n">slide_beacon_adc_pwdb_index</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">slide_beacon_adc_pwdb_index</span> <span class="o">&gt;=</span> <span class="n">PHY_Beacon_RSSI_SLID_WIN_MAX</span><span class="p">)</span>
			<span class="n">slide_beacon_adc_pwdb_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">Slide_Beacon_Total</span> <span class="o">/</span>
				     <span class="n">slide_beacon_adc_pwdb_statistics</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
			<span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">-=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RXDESC</span><span class="p">,</span> <span class="s">&quot;Smooth %s PWDB = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bIsCCK</span> <span class="o">?</span> <span class="s">&quot;CCK&quot;</span> <span class="o">:</span> <span class="s">&quot;OFDM&quot;</span><span class="p">,</span>
				<span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span> <span class="o">||</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span> <span class="o">||</span>
	    <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">=</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">=</span>
					<span class="p">(((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">)</span> <span class="o">*</span>
					<span class="p">(</span><span class="n">RX_SMOOTH</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">=</span>
					<span class="p">(((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span><span class="p">)</span> <span class="o">*</span>
					<span class="p">(</span><span class="n">RX_SMOOTH</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
					<span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxPWDBAll</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">rtl819x_update_rxsignalstatistics8190pci</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">prev_st</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">SignalQuality</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span> <span class="o">||</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span> <span class="o">||</span>
		    <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">slide_evm_statistics</span><span class="o">++</span> <span class="o">&gt;=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">slide_evm_statistics</span> <span class="o">=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">;</span>
				<span class="n">last_evm</span> <span class="o">=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_evm</span><span class="p">[</span><span class="n">slide_evm_index</span><span class="p">];</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_evm_total</span> <span class="o">-=</span> <span class="n">last_evm</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_evm_total</span> <span class="o">+=</span> <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">SignalQuality</span><span class="p">;</span>

			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_evm</span><span class="p">[</span><span class="n">slide_evm_index</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
						 <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">SignalQuality</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">slide_evm_index</span> <span class="o">&gt;=</span> <span class="n">PHY_RSSI_SLID_WIN_MAX</span><span class="p">)</span>
				<span class="n">slide_evm_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="n">tmp_val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">slide_evm_total</span> <span class="o">/</span>
				  <span class="n">slide_evm_statistics</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">signal_quality</span> <span class="o">=</span> <span class="n">tmp_val</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">last_signal_strength_inpercent</span> <span class="o">=</span> <span class="n">tmp_val</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketToSelf</span> <span class="o">||</span>
		    <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bPacketBeacon</span> <span class="o">||</span>
		    <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">bToSelfBA</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">ij</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ij</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">ij</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_evm_percentage</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
						<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_evm_percentage</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span>
						   <span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="n">ij</span><span class="p">];</span>
					<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_evm_percentage</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span>
					  <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_evm_percentage</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">*</span>
					  <span class="p">(</span><span class="n">RX_SMOOTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span>
					  <span class="p">(</span><span class="n">prev_st</span><span class="o">-&gt;</span><span class="n">RxMIMOSignalQuality</span><span class="p">[</span><span class="n">ij</span><span class="p">]))</span> <span class="o">/</span>
					  <span class="p">(</span><span class="n">RX_SMOOTH</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_TranslateRxSignalStuff</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">pstats</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">rx_desc</span> <span class="o">*</span><span class="n">pdesc</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">rx_fwinfo</span> <span class="o">*</span><span class="n">pdrvinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">bool</span> <span class="n">bpacket_match_bssid</span><span class="p">,</span> <span class="n">bpacket_toself</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bPacketBeacon</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtllib_hdr_3addr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bToSelfBA</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">struct</span> <span class="n">rtllib_rx_stats</span>  <span class="n">previous_stats</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fc</span><span class="p">,</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">tmp_buf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">praddr</span><span class="p">;</span>

	<span class="n">tmp_buf</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxDrvInfoSize</span> <span class="o">+</span> <span class="n">pstats</span><span class="o">-&gt;</span><span class="n">RxBufShift</span><span class="p">;</span>

	<span class="n">hdr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_hdr_3addr</span> <span class="o">*</span><span class="p">)</span><span class="n">tmp_buf</span><span class="p">;</span>
	<span class="n">fc</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">frame_ctl</span><span class="p">);</span>
	<span class="n">type</span> <span class="o">=</span> <span class="n">WLAN_FC_GET_TYPE</span><span class="p">(</span><span class="n">fc</span><span class="p">);</span>
	<span class="n">praddr</span> <span class="o">=</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">addr1</span><span class="p">;</span>

	<span class="n">bpacket_match_bssid</span> <span class="o">=</span> <span class="p">((</span><span class="n">RTLLIB_FTYPE_CTL</span> <span class="o">!=</span> <span class="n">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="o">!</span><span class="n">compare_ether_addr</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span>
			<span class="n">current_network</span><span class="p">.</span><span class="n">bssid</span><span class="p">,</span>
			   <span class="p">(</span><span class="n">fc</span> <span class="o">&amp;</span> <span class="n">RTLLIB_FCTL_TODS</span><span class="p">)</span> <span class="o">?</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">addr1</span> <span class="o">:</span>
			   <span class="p">(</span><span class="n">fc</span> <span class="o">&amp;</span> <span class="n">RTLLIB_FCTL_FROMDS</span><span class="p">)</span> <span class="o">?</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">addr2</span> <span class="o">:</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">addr3</span><span class="p">))</span>
		<span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bHwError</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bCRC</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bICV</span><span class="p">));</span>
	<span class="n">bpacket_toself</span> <span class="o">=</span>  <span class="n">bpacket_match_bssid</span> <span class="o">&amp;&amp;</span>	<span class="cm">/* check this */</span>
			  <span class="p">(</span><span class="o">!</span><span class="n">compare_ether_addr</span><span class="p">(</span><span class="n">praddr</span><span class="p">,</span>
			  <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">WLAN_FC_GET_FRAMETYPE</span><span class="p">(</span><span class="n">fc</span><span class="p">)</span> <span class="o">==</span> <span class="n">RTLLIB_STYPE_BEACON</span><span class="p">)</span>
		<span class="n">bPacketBeacon</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bpacket_match_bssid</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">numpacket_matchbssid</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bpacket_toself</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">numpacket_toself</span><span class="o">++</span><span class="p">;</span>
	<span class="n">rtl8192_process_phyinfo</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">tmp_buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">previous_stats</span><span class="p">,</span> <span class="n">pstats</span><span class="p">);</span>
	<span class="n">rtl8192_query_rxphystatus</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">pstats</span><span class="p">,</span> <span class="n">pdesc</span><span class="p">,</span> <span class="n">pdrvinfo</span><span class="p">,</span>
				  <span class="o">&amp;</span><span class="n">previous_stats</span><span class="p">,</span> <span class="n">bpacket_match_bssid</span><span class="p">,</span>
				  <span class="n">bpacket_toself</span><span class="p">,</span> <span class="n">bPacketBeacon</span><span class="p">,</span> <span class="n">bToSelfBA</span><span class="p">);</span>
	<span class="n">rtl8192_record_rxdesc_forlateruse</span><span class="p">(</span><span class="n">pstats</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">previous_stats</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8192_UpdateReceivedRateHistogramStatistics</span><span class="p">(</span>
					   <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">pstats</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">rcvType</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rateIndex</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">preamble_guardinterval</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bCRC</span><span class="p">)</span>
		<span class="n">rcvType</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bICV</span><span class="p">)</span>
		<span class="n">rcvType</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">bShortPreamble</span><span class="p">)</span>
		<span class="n">preamble_guardinterval</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">preamble_guardinterval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">pstats</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">MGN_1M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_2M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		 <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_5_5M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_11M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_6M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_9M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_12M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_18M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		 <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_24M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_36M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_48M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_54M</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS0</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS1</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS2</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS3</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS4</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS5</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS6</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS7</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS8</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS9</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS10</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">22</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS11</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS12</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">24</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS13</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS14</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">26</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">MGN_MCS15</span>:
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">27</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">rateIndex</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_preamble_GI</span><span class="p">[</span><span class="n">preamble_guardinterval</span><span class="p">][</span><span class="n">rateIndex</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_rate_histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">rateIndex</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">received_rate_histogram</span><span class="p">[</span><span class="n">rcvType</span><span class="p">][</span><span class="n">rateIndex</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_rx_query_status_desc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">rtllib_rx_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">rx_desc</span> <span class="o">*</span><span class="n">pdesc</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bICV</span> <span class="o">=</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">ICV</span><span class="p">;</span>
	<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bCRC</span> <span class="o">=</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">CRC32</span><span class="p">;</span>
	<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bHwError</span> <span class="o">=</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">CRC32</span> <span class="o">|</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">ICV</span><span class="p">;</span>

	<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Length</span> <span class="o">=</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">Length</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="o">-&gt;</span><span class="n">Length</span> <span class="o">&lt;</span> <span class="mi">24</span><span class="p">)</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bHwError</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="o">-&gt;</span><span class="n">bHwError</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bShift</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">CRC32</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">Length</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxcrcerrmin</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">Length</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxcrcerrmax</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">stats</span><span class="p">.</span><span class="n">rxcrcerrmid</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">rx_fwinfo</span> <span class="o">*</span><span class="n">pDrvInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxDrvInfoSize</span> <span class="o">=</span> <span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">RxDrvInfoSize</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxBufShift</span> <span class="o">=</span> <span class="p">((</span><span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">Shift</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0x03</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">Decrypted</span> <span class="o">=</span> <span class="o">!</span><span class="n">pdesc</span><span class="o">-&gt;</span><span class="n">SWDec</span><span class="p">;</span>

		<span class="n">pDrvInfo</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rx_fwinfo</span> <span class="o">*</span><span class="p">)(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">+</span> <span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxBufShift</span><span class="p">);</span>

		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">HwRateToMRate90</span><span class="p">((</span><span class="n">bool</span><span class="p">)</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">RxHT</span><span class="p">,</span>
					     <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">RxRate</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bShortPreamble</span> <span class="o">=</span> <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">SPLCP</span><span class="p">;</span>

		<span class="n">rtl8192_UpdateReceivedRateHistogramStatistics</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>

		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bIsAMPDU</span> <span class="o">=</span> <span class="p">(</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">PartAggr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bFirstMPDU</span> <span class="o">=</span> <span class="p">(</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">PartAggr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				    <span class="p">(</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">FirstAGGR</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">TimeStampLow</span> <span class="o">=</span> <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">TSFL</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">TimeStampHigh</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">TSFR</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>

		<span class="n">rtl819x_UpdateRxPktTimeStamp</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">stats</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxBufShift</span> <span class="o">+</span> <span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxDrvInfoSize</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">stats</span><span class="o">-&gt;</span><span class="n">bShift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">RxIs40MHzPacket</span> <span class="o">=</span> <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">BW</span><span class="p">;</span>

		<span class="n">rtl8192_TranslateRxSignalStuff</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">skb</span><span class="p">,</span> <span class="n">stats</span><span class="p">,</span> <span class="n">pdesc</span><span class="p">,</span>
					       <span class="n">pDrvInfo</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">FirstAGGR</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">PartAggr</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RXDESC</span><span class="p">,</span> <span class="s">&quot;pDrvInfo-&gt;FirstAGGR = %d,&quot;</span>
				 <span class="s">&quot; pDrvInfo-&gt;PartAggr = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">FirstAGGR</span><span class="p">,</span> <span class="n">pDrvInfo</span><span class="o">-&gt;</span><span class="n">PartAggr</span><span class="p">);</span>
		<span class="n">skb_trim</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="mi">4</span><span class="cm">/*sCrcLng*/</span><span class="p">);</span>


		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">packetlength</span> <span class="o">=</span> <span class="n">stats</span><span class="o">-&gt;</span><span class="n">Length</span><span class="o">-</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">fraglength</span> <span class="o">=</span> <span class="n">stats</span><span class="o">-&gt;</span><span class="n">packetlength</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">fragoffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">ntotalfrag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_halt_adapter</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">reset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">OpMode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">u1bTmp</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">ulRegRead</span><span class="p">;</span>

	<span class="n">OpMode</span> <span class="o">=</span> <span class="n">RT_OP_MODE_NO_LINK</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">SetHwRegHandler</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">HW_VAR_MEDIA_STATUS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">OpMode</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u1bTmp</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>
		<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CMDR</span><span class="p">,</span> <span class="n">u1bTmp</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mdelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reset</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mdelay</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bHwRfOffAction</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PHY_SetRtl8192eRfOff</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
			<span class="n">ulRegRead</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">);</span>
			<span class="n">ulRegRead</span> <span class="o">|=</span> <span class="n">CPU_GEN_SYSTEM_RESET</span><span class="p">;</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">CPU_GEN</span><span class="p">,</span> <span class="n">ulRegRead</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WFCRC0</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WFCRC1</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>
			<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">WFCRC2</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">);</span>


			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">PMR</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">);</span>
			<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">MacBlkCtrl</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_QUEUE_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">skb_queue_purge</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">skb_waitQ</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_QUEUE_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">skb_queue_purge</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">skb_aggQ</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">skb_queue_purge</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">skb_queue</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_update_ratr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">pMcsRate</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ratr_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rate_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">rtl8192_config_rate</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">ratr_value</span><span class="p">));</span>
	<span class="n">ratr_value</span> <span class="o">|=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)(</span><span class="n">pMcsRate</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IEEE_A</span>:
		<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x00000FF0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IEEE_B</span>:
		<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x0000000F</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IEEE_G</span>:
	<span class="k">case</span> <span class="n">IEEE_G</span><span class="o">|</span><span class="n">IEEE_B</span>:
		<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x00000FF7</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IEEE_N_24G</span>:
	<span class="k">case</span> <span class="n">IEEE_N_5G</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerMimoPs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x0007F007</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_type</span> <span class="o">==</span> <span class="n">RF_1T2R</span><span class="p">)</span>
				<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x000FF007</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x0F81F007</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ratr_value</span> <span class="o">&amp;=</span> <span class="mh">0x0FFFFFFF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">&amp;&amp;</span>
	    <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="p">)</span>
		<span class="n">ratr_value</span> <span class="o">|=</span> <span class="mh">0x80000000</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">&amp;&amp;</span>
		  <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="p">)</span>
		<span class="n">ratr_value</span> <span class="o">|=</span> <span class="mh">0x80000000</span><span class="p">;</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RATR0</span><span class="o">+</span><span class="n">rate_index</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">ratr_value</span><span class="p">);</span>
	<span class="n">write_nic_byte</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">UFWP</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">rtl8192_InitializeVariables</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span>  <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">strcpy</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">nick</span><span class="p">,</span> <span class="s">&quot;rtl8192E&quot;</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">softmac_features</span>  <span class="o">=</span> <span class="n">IEEE_SOFTMAC_SCAN</span> <span class="o">|</span>
		<span class="n">IEEE_SOFTMAC_ASSOCIATE</span> <span class="o">|</span> <span class="n">IEEE_SOFTMAC_PROBERQ</span> <span class="o">|</span>
		<span class="n">IEEE_SOFTMAC_PROBERS</span> <span class="o">|</span> <span class="n">IEEE_SOFTMAC_TX_QUEUE</span> <span class="cm">/* |</span>
<span class="cm">		IEEE_SOFTMAC_BEACONS*/</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="o">-&gt;</span><span class="n">tx_headroom</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tx_fwinfo_8190pci</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ShortRetryLimit</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">LongRetryLimit</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">EarlyRxThreshold</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">pwrGroupCnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bIgnoreSilentReset</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">enable_gpio0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TransmitConfig</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">ReceiveConfig</span> <span class="o">=</span> <span class="n">RCR_ADD3</span>	<span class="o">|</span>
		<span class="n">RCR_AMF</span> <span class="o">|</span> <span class="n">RCR_ADF</span> <span class="o">|</span>
		<span class="n">RCR_AICV</span> <span class="o">|</span>
		<span class="n">RCR_AB</span> <span class="o">|</span> <span class="n">RCR_AM</span> <span class="o">|</span> <span class="n">RCR_APM</span> <span class="o">|</span>
		<span class="n">RCR_AAP</span> <span class="o">|</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="mi">7</span><span class="o">&lt;&lt;</span><span class="n">RCR_MXDMA_OFFSET</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">((</span><span class="n">u32</span><span class="p">)</span><span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="n">RCR_FIFO_OFFSET</span><span class="p">)</span> <span class="o">|</span> <span class="n">RCR_ONLYERLPKT</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)(</span><span class="n">IMR_ROK</span> <span class="o">|</span> <span class="n">IMR_VODOK</span> <span class="o">|</span> <span class="n">IMR_VIDOK</span> <span class="o">|</span>
			    <span class="n">IMR_BEDOK</span> <span class="o">|</span> <span class="n">IMR_BKDOK</span> <span class="o">|</span> <span class="n">IMR_HCCADOK</span> <span class="o">|</span>
			    <span class="n">IMR_MGNTDOK</span> <span class="o">|</span> <span class="n">IMR_COMDOK</span> <span class="o">|</span> <span class="n">IMR_HIGHDOK</span> <span class="o">|</span>
			    <span class="n">IMR_BDOK</span> <span class="o">|</span> <span class="n">IMR_RXCMDOK</span> <span class="o">|</span> <span class="n">IMR_TIMEOUT0</span> <span class="o">|</span>
			    <span class="n">IMR_RDU</span> <span class="o">|</span> <span class="n">IMR_RXFOVW</span> <span class="o">|</span> <span class="n">IMR_TXFOVW</span> <span class="o">|</span>
			    <span class="n">IMR_BcnInt</span> <span class="o">|</span> <span class="n">IMR_TBDOK</span> <span class="o">|</span> <span class="n">IMR_TBDER</span><span class="p">);</span>


	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MidHighPwrTHR_L1</span> <span class="o">=</span> <span class="mh">0x3B</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">MidHighPwrTHR_L2</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">PwrDomainProtect</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bfirst_after_down</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_EnableInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">irq_enabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">INTA_MASK</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_DisableInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">INTA_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">irq_enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl8192_ClearInterrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ISR</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ISR</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">rtl8192_enable_rx</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">RDQDA</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rx_ring_dma</span><span class="p">[</span><span class="n">RX_MPDU_QUEUE</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">TX_DESC_BASE</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BKQDA</span><span class="p">,</span> <span class="n">BEQDA</span><span class="p">,</span> <span class="n">VIQDA</span><span class="p">,</span> <span class="n">VOQDA</span><span class="p">,</span> <span class="n">HCCAQDA</span><span class="p">,</span> <span class="n">CQDA</span><span class="p">,</span> <span class="n">MQDA</span><span class="p">,</span> <span class="n">HQDA</span><span class="p">,</span> <span class="n">BQDA</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">rtl8192_enable_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_TX_QUEUE_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">TX_DESC_BASE</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dma</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">rtl8192_interrupt_recognized</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">p_inta</span><span class="p">,</span>
				  <span class="n">u32</span> <span class="o">*</span><span class="n">p_intb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">p_inta</span> <span class="o">=</span> <span class="n">read_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ISR</span><span class="p">);</span>
	<span class="n">write_nic_dword</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">ISR</span><span class="p">,</span> <span class="o">*</span><span class="n">p_inta</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_HalRxCheckStuck</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u16</span>		  <span class="n">RegRxCounter</span> <span class="o">=</span> <span class="n">read_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x130</span><span class="p">);</span>
	<span class="n">bool</span>		  <span class="n">bStuck</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">static</span> <span class="n">u8</span>	  <span class="n">rx_chk_cnt</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">SlotIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TotalRxStuckCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">SilentResetRxSoltNum</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RESET</span><span class="p">,</span> <span class="s">&quot;%s(): RegRxCounter is %d, RxCounter is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">__func__</span><span class="p">,</span> <span class="n">RegRxCounter</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">RxCounter</span><span class="p">);</span>

	<span class="n">rx_chk_cnt</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">RateAdaptiveTH_High</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">rx_chk_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">RateAdaptiveTH_High</span> <span class="o">+</span> <span class="mi">5</span><span class="p">))</span>
	  <span class="o">&amp;&amp;</span> <span class="p">(((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">RateAdaptiveTH_Low_40M</span><span class="p">))</span>
	  <span class="o">||</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	  <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">RateAdaptiveTH_Low_20M</span><span class="p">))))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rx_chk_cnt</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">bStuck</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rx_chk_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">!=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">RateAdaptiveTH_Low_40M</span><span class="p">))</span> <span class="o">||</span>
		<span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">CurrentChannelBW</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&lt;</span> <span class="n">RateAdaptiveTH_Low_20M</span><span class="p">)))</span> <span class="o">&amp;&amp;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">undecorated_smoothed_pwdb</span> <span class="o">&gt;=</span> <span class="n">VeryLowRSSI</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rx_chk_cnt</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">bStuck</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rx_chk_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rx_chk_cnt</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">bStuck</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">rx_chk_cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="n">SlotIndex</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">SilentResetRxSlotIndex</span><span class="o">++</span><span class="p">)</span><span class="o">%</span><span class="n">SilentResetRxSoltNum</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">RxCounter</span> <span class="o">==</span> <span class="n">RegRxCounter</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SilentResetRxStuckEvent</span><span class="p">[</span><span class="n">SlotIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SilentResetRxSoltNum</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">TotalRxStuckCount</span> <span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">SilentResetRxStuckEvent</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">TotalRxStuckCount</span> <span class="o">==</span> <span class="n">SilentResetRxSoltNum</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">bStuck</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">SilentResetRxSoltNum</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">TotalRxStuckCount</span> <span class="o">+=</span>
					 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">SilentResetRxStuckEvent</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>


	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">SilentResetRxStuckEvent</span><span class="p">[</span><span class="n">SlotIndex</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">RxCounter</span> <span class="o">=</span> <span class="n">RegRxCounter</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">bStuck</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_HalTxCheckStuck</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">bool</span>	<span class="n">bStuck</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">RegTxCounter</span> <span class="o">=</span> <span class="n">read_nic_word</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x128</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">COMP_RESET</span><span class="p">,</span> <span class="s">&quot;%s():RegTxCounter is %d,TxCounter is %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">__func__</span><span class="p">,</span> <span class="n">RegTxCounter</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxCounter</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxCounter</span> <span class="o">==</span> <span class="n">RegTxCounter</span><span class="p">)</span>
		<span class="n">bStuck</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">TxCounter</span> <span class="o">=</span> <span class="n">RegTxCounter</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">bStuck</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_GetNmodeSupportBySecCfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">rtllib_ap_sec_type</span> <span class="o">&amp;&amp;</span>
	   <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">rtllib_ap_sec_type</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">SEC_ALG_WEP</span> <span class="o">|</span>
				     <span class="n">SEC_ALG_TKIP</span><span class="p">)))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">rtl8192_GetHalfNmodeSupportByAPs</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">Reval</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">r8192_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">rtllib_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">rtllib</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bHalfWirelessN24GMode</span> <span class="o">==</span> <span class="nb">true</span><span class="p">)</span>
		<span class="n">Reval</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">Reval</span> <span class="o">=</span>  <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">Reval</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">rtl8192_QueryIsShort</span><span class="p">(</span><span class="n">u8</span> <span class="n">TxHT</span><span class="p">,</span> <span class="n">u8</span> <span class="n">TxRate</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cb_desc</span> <span class="o">*</span><span class="n">tcb_desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>   <span class="n">tmp_Short</span><span class="p">;</span>

	<span class="n">tmp_Short</span> <span class="o">=</span> <span class="p">(</span><span class="n">TxHT</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="p">((</span><span class="n">tcb_desc</span><span class="o">-&gt;</span><span class="n">bUseShortGI</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span>
			<span class="p">((</span><span class="n">tcb_desc</span><span class="o">-&gt;</span><span class="n">bUseShortPreamble</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">TxHT</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">TxRate</span> <span class="o">!=</span> <span class="n">DESC90_RATEMCS15</span><span class="p">)</span>
		<span class="n">tmp_Short</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">tmp_Short</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ActUpdateChannelAccessSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">enum</span> <span class="n">wireless_mode</span> <span class="n">WirelessMode</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">channel_access_setting</span> <span class="o">*</span><span class="n">ChnlAccessSetting</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
