<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › rtl8192e › rtl819x_HTProc.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>rtl819x_HTProc.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> * Copyright(c) 2008 - 2010 Realtek Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * wlanfae &lt;wlanfae@realtek.com&gt;</span>
<span class="cm">******************************************************************************/</span>
<span class="cp">#include &quot;rtllib.h&quot;</span>
<span class="cp">#include &quot;rtl819x_HT.h&quot;</span>
<span class="n">u8</span> <span class="n">MCS_FILTER_ALL</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span>
	<span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="n">u8</span> <span class="n">MCS_FILTER_1SS</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">;</span>

<span class="n">u16</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">77</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span>
	 <span class="mi">260</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">416</span><span class="p">,</span>
	 <span class="mi">468</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span>
	 <span class="mi">182</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">156</span><span class="p">,</span>
	 <span class="mi">181</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">208</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">286</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span>
	 <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">312</span><span class="p">,</span> <span class="mi">351</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">429</span><span class="p">}</span> <span class="p">,</span>
	<span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span>
	 <span class="mi">43</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">462</span><span class="p">,</span> <span class="mi">520</span><span class="p">,</span>
	 <span class="mi">578</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span>
	 <span class="mi">173</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span>
	 <span class="mi">231</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">318</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">303</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">347</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span>
	 <span class="mi">433</span><span class="p">,</span> <span class="mi">433</span><span class="p">,</span> <span class="mi">477</span><span class="p">}</span> <span class="p">}</span> <span class="p">,</span>
	<span class="p">{{</span><span class="mi">27</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span>
	 <span class="mi">540</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">729</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span>
	 <span class="mi">864</span><span class="p">,</span> <span class="mi">972</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">162</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span>
	 <span class="mi">378</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span> <span class="mi">378</span><span class="p">,</span> <span class="mi">324</span><span class="p">,</span>
	 <span class="mi">378</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">432</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">594</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">486</span><span class="p">,</span> <span class="mi">567</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span>
	 <span class="mi">729</span><span class="p">,</span> <span class="mi">648</span><span class="p">,</span> <span class="mi">729</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">891</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span>
	 <span class="mi">600</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span>
	 <span class="mi">960</span><span class="p">,</span> <span class="mi">1080</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">270</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span>
	 <span class="mi">420</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span>
	 <span class="mi">420</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">660</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">630</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span>
	 <span class="mi">810</span><span class="p">,</span> <span class="mi">720</span><span class="p">,</span> <span class="mi">810</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">990</span><span class="p">}</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">PCI_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">EDIMAX_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">AIRLINK_RALINK</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">DLINK_ATHEROS_1</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">DLINK_ATHEROS_2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">CISCO_BROADCOM</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">};</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">LINKSYS_MARVELL_4400N</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">};</span>

<span class="kt">void</span> <span class="nf">HTUpdateDefaultSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAcceptAddbaReq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span> <span class="o">=</span> <span class="mi">7935UL</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bTxDisableRateFallBack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bTxUseDriverAssingedRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bTxEnableFwCalcDur</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRxReorderEnable</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RxReorderWinSize</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RxReorderPendingTime</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTDebugHTCapability</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">CapIE</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">TitleString</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">static</span> <span class="n">u8</span>	<span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="n">pCapELE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">CapIE</span><span class="p">,</span> <span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;EWC IE in %s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">CapIE</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">CapIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;&lt;Log HT Capability&gt;. Called by %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">TitleString</span><span class="p">);</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Supported Channel Width = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;20MHz&quot;</span> <span class="o">:</span> <span class="s">&quot;20/40MHz&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support Short GI for 20M = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;YES&quot;</span> <span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support Short GI for 40M = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;YES&quot;</span> <span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support TX STBC = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxSTBC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;YES&quot;</span> <span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Max AMSDU Size = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;3839&quot;</span> <span class="o">:</span> <span class="s">&quot;7935&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Support CCK in 20/40 mode = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;YES&quot;</span> <span class="o">:</span> <span class="s">&quot;NO&quot;</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">Max AMPDU Factor = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">MPDU Density = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span>  <span class="s">&quot;</span><span class="se">\t</span><span class="s">MCS Rate Set = [%x][%x][%x][%x][%x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
		     <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTDebugHTInfo</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">InfoIE</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">TitleString</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">static</span> <span class="n">u8</span>	<span class="n">EWC11NHTInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="n">pHTInfoEle</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">InfoIE</span><span class="p">,</span> <span class="n">EWC11NHTInfo</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTInfo</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;EWC IE in %s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">InfoIE</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">InfoIE</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>


	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;&lt;Log HT Information Element&gt;. &quot;</span>
		     <span class="s">&quot;Called by %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TitleString</span><span class="p">);</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Primary channel = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ControlChl</span><span class="p">);</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Senondary channel =&quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;Not Present</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;Upper channel</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;Reserved. Eooro!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;Lower Channel</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Recommended channel width = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;20Mhz&quot;</span> <span class="o">:</span> <span class="s">&quot;40Mhz&quot;</span><span class="p">);</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Operation mode for protection = &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;No Protection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT non-member protection mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;Suggest to open protection</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT mixed mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Basic MCS Rate Set = [%x][%x][%x][%x]&quot;</span>
		     <span class="s">&quot;[%x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
		     <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
		     <span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">IsHTHalfNmode40Bandwidth</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(((</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">IsHTHalfNmodeSGI</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">bool</span> <span class="n">is40MHz</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">is40MHz</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(((</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)</span>
		    <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span><span class="p">)</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(((</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)</span>
		   <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span><span class="p">)</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u16</span> <span class="nf">HTHalfMcsToDataRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="n">nMcsRate</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u8</span>	<span class="n">is40MHz</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span><span class="p">;</span>

	<span class="n">is40MHz</span>  <span class="o">=</span>  <span class="p">(</span><span class="n">IsHTHalfNmode40Bandwidth</span><span class="p">(</span><span class="n">ieee</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">isShortGI</span> <span class="o">=</span> <span class="p">(</span><span class="n">IsHTHalfNmodeSGI</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">is40MHz</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][(</span><span class="n">nMcsRate</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)];</span>
<span class="p">}</span>


<span class="n">u16</span> <span class="nf">HTMcsToDataRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="n">nMcsRate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">u8</span>	<span class="n">is40MHz</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span> <span class="o">?</span>
			    <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span>
			    <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][(</span><span class="n">nMcsRate</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)];</span>
<span class="p">}</span>

<span class="n">u16</span>  <span class="nf">TxCountToDataRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="n">nDataRate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span>	<span class="n">CCKOFDMRate</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
				   <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">};</span>
	<span class="n">u8</span>	<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="n">CCKOFDMRate</span><span class="p">[</span><span class="n">nDataRate</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x10</span> <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x20</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x2f</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x30</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x3f</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nDataRate</span> <span class="o">&gt;=</span> <span class="mh">0x40</span>  <span class="o">&amp;&amp;</span> <span class="n">nDataRate</span> <span class="o">&lt;=</span> <span class="mh">0x4f</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">is40MHz</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">isShortGI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">MCS_DATA_RATE</span><span class="p">[</span><span class="n">is40MHz</span><span class="p">][</span><span class="n">isShortGI</span><span class="p">][</span><span class="n">nDataRate</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">IsHTHalfNmodeAPs</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span>			<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">PCI_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">EDIMAX_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">AIRLINK_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">ralink_cap_exist</span><span class="p">))</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span>
		<span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span>
		<span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">broadcom_cap_exist</span><span class="p">))</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">HTIOTPeerDetermine</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">net</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_REALTEK</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">RT2RT_HT_Mode</span> <span class="o">&amp;</span> <span class="n">RT_HT_CAP_USE_92SE</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_REALTEK_92SE</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">RT2RT_HT_Mode</span> <span class="o">&amp;</span> <span class="n">RT_HT_CAP_USE_SOFTAP</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_92U_SOFTAP</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">broadcom_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">UNKNOWN_BORADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span>
		 <span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT330_LINKSYSWRT300_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span>
		 <span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYSWRT350_LINKSYSWRT150_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D8233V1_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">BELKINF5D82334V3_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">PCI_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">EDIMAX_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">AIRLINK_RALINK</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		  <span class="n">net</span><span class="o">-&gt;</span><span class="n">ralink_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_RALINK</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">atheros_cap_exist</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">DLINK_ATHEROS_1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">DLINK_ATHEROS_2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_ATHEROS</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">CISCO_BROADCOM</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		  <span class="n">net</span><span class="o">-&gt;</span><span class="n">cisco_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_CISCO</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">memcmp</span><span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">LINKSYS_MARVELL_4400N</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span>
		  <span class="n">net</span><span class="o">-&gt;</span><span class="n">marvell_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_MARVELL</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">airgo_cap_exist</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_AIRGO</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_UNKNOWN</span><span class="p">;</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_IOT</span><span class="p">,</span> <span class="s">&quot;Joseph debug!! IOTPEER: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		     <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HTIOTActIsDisableMCS14</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="n">bool</span> <span class="nf">HTIOTActIsDisableMCS15</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">retValue</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">HTIOTActIsDisableMCSTwoSpatialStream</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HTIOTActIsDisableEDCATurbo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">PeerMacAddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HTIOTActIsMgntUseCCK6M</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">network</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">retValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HTIOTActIsCCDFsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>	<span class="n">retValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_BROADCOM</span><span class="p">)</span>
		<span class="n">retValue</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">retValue</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">HTIOTActDetermineRaFunc</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bPeerRx2ss</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">&amp;=</span> <span class="n">HT_IOT_RAFUNC_DISABLE_ALL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_RALINK</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">bPeerRx2ss</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">|=</span> <span class="n">HT_IOT_RAFUNC_PEER_1R</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_AMSDU_ENABLE</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">|=</span> <span class="n">HT_IOT_RAFUNC_TX_AMSDU</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTResetIOTSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="n">HT_IOT_PEER_UNKNOWN</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTConstructCapabilityElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">posHTCap</span><span class="p">,</span>
				  <span class="n">u8</span> <span class="o">*</span><span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">IsEncrypt</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bAssoc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHT</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="n">pCapELE</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">posHTCap</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pHT</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posHTCap or pHTInfo can&#39;t be &quot;</span>
			     <span class="s">&quot;null in HTConstructCapabilityElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">bAssoc</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">==</span> <span class="n">HT_SPEC_VER_EWC</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u8</span>	<span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">,</span> <span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">));</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">posHTCap</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pCapELE</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)</span><span class="n">posHTCap</span><span class="p">;</span>
		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">26</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">AdvCoding</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span> <span class="o">=</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MimoPwrSave</span>		<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">SelfMimoPs</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">GreenField</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxSTBC</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">RxSTBC</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DelayBA</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">MAX_RECEIVE_BUFFER_SIZE</span> <span class="o">&gt;=</span> <span class="mi">7935</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span> <span class="o">=</span> <span class="p">((</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">PSMP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">LSigTxopProtect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>


	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;TX HT cap/info ele BW=%d MaxAMSDUSize:%d &quot;</span>
		     <span class="s">&quot;DssCCk:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">,</span> <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span><span class="p">,</span>
		     <span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">DssCCk</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IsEncrypt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span>	<span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11HTOperationalRateSet</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ExtHTCapInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">TxBFCap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ASCap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bAssoc</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_MCS15</span><span class="p">)</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x7f</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_MCS14</span><span class="p">)</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0xbf</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_ALL_2SS</span><span class="p">)</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="mh">0x00</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_DISABLE_RX_40MHZ_SHORT_GI</span><span class="p">)</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">ChlWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">pCapELE</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTConstructInfoElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">posHTInfo</span><span class="p">,</span>
			    <span class="n">u8</span> <span class="o">*</span><span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">IsEncrypt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHT</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="n">pHTInfoEle</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)</span><span class="n">posHTInfo</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">posHTInfo</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">pHTInfoEle</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posHTInfo or pHTInfoEle can&#39;t be &quot;</span>
			     <span class="s">&quot;null in HTConstructInfoElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">posHTInfo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_ADHOC</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_MASTER</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ControlChl</span>	<span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span> <span class="o">=</span> <span class="p">((</span><span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="o">?</span>
					    <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span> <span class="o">:</span>
					    <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)</span>
					    <span class="o">?</span> <span class="n">HT_EXTCHNL_OFFSET_UPPER</span> <span class="o">:</span>
					    <span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">);</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span>	<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">RIFS</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PSMPAccessOnly</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">SrvIntGranularity</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">OptMode</span>			<span class="o">=</span> <span class="n">pHT</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">NonGFDevPresent</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">DualBeacon</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">SecondaryBeacon</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">LSigTxopProtectFull</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PcoActive</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">PcoPhase</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">memset</span><span class="p">(</span><span class="n">pHTInfoEle</span><span class="o">-&gt;</span><span class="n">BasicMSC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>


		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">22</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTConstructRT2RTAggElement</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">posRT2RTAgg</span><span class="p">,</span>
				<span class="n">u8</span> <span class="o">*</span><span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">posRT2RTAgg</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;posRT2RTAgg can&#39;t be null in &quot;</span>
			     <span class="s">&quot;HTConstructRT2RTAggElement()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">posRT2RTAgg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0xe0</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x4c</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	<span class="o">*</span><span class="n">posRT2RTAgg</span><span class="o">++</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>

	<span class="o">*</span><span class="n">posRT2RTAgg</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">bSupportRemoteWakeUp</span><span class="p">)</span>
		<span class="o">*</span><span class="n">posRT2RTAgg</span> <span class="o">|=</span> <span class="n">RT_HT_CAP_USE_WOW</span><span class="p">;</span>

	<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">HT_PickMCSRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pOperateMCS</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pOperateMCS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;pOperateMCS can&#39;t be null&quot;</span>
			     <span class="s">&quot; in HT_PickMCSRate()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IEEE_A</span>:
	<span class="k">case</span> <span class="n">IEEE_B</span>:
	<span class="k">case</span> <span class="n">IEEE_G</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IEEE_N_24G</span>:
	<span class="k">case</span> <span class="n">IEEE_N_5G</span>:
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">RATE_ADPT_1SS_MASK</span><span class="p">;</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">RATE_ADPT_2SS_MASK</span><span class="p">;</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">RATE_ADPT_MCS32_MASK</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">HTGetHighestMCSRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pMCSRateSet</span><span class="p">,</span>
		       <span class="n">u8</span> <span class="o">*</span><span class="n">pMCSFilter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span>		<span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">bitMap</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">mcsRate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">availableMcsRate</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pMCSRateSet</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">pMCSFilter</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;pMCSRateSet or pMCSFilter can&#39;t &quot;</span>
			     <span class="s">&quot;be null in HTGetHighestMCSRate()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pMCSRateSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">pMCSFilter</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">bitMap</span> <span class="o">=</span> <span class="n">availableMcsRate</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">((</span><span class="n">bitMap</span><span class="o">%</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">HTMcsToDataRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">))</span> <span class="o">&gt;</span>
					    <span class="n">HTMcsToDataRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">mcsRate</span><span class="p">))</span>
						<span class="n">mcsRate</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">bitMap</span> <span class="o">=</span> <span class="n">bitMap</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">mcsRate</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">HTFilterMCSRate</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pSupportMCS</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pOperateMCS</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11TxHTOperationalRateSet</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span>
				 <span class="n">pSupportMCS</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="n">HT_PickMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pOperateMCS</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">pOperateMCS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">HTSetConnectBwMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			<span class="k">enum</span> <span class="n">ht_channel_width</span> <span class="n">Bandwidth</span><span class="p">,</span>
			<span class="k">enum</span> <span class="n">ht_extchnl_offset</span> <span class="n">Offset</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">HTOnAssocRsp</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">nMaxAMSDUSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">pMcsFilter</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">static</span> <span class="n">u8</span> <span class="n">EWC11NHTCap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">};</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">EWC11NHTInfo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_ERR</span><span class="p">,</span> <span class="s">&quot;&lt;=== HTOnAssocRsp(): &quot;</span>
			     <span class="s">&quot;HT_DISABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;===&gt; HTOnAssocRsp_wq(): HT_ENABLE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">,</span> <span class="n">EWC11NHTCap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTCap</span><span class="p">)))</span>
		<span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">pPeerHTCap</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span> <span class="o">*</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">,</span> <span class="n">EWC11NHTInfo</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">EWC11NHTInfo</span><span class="p">)))</span>
		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)</span>
			     <span class="p">(</span><span class="o">&amp;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">pPeerHTInfo</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">);</span>

	<span class="n">RTLLIB_DEBUG_DATA</span><span class="p">(</span><span class="n">RTLLIB_DL_DATA</span> <span class="o">|</span> <span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="n">pPeerHTCap</span><span class="p">,</span>
			  <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ht_capab_ele</span><span class="p">));</span>
	<span class="n">HTSetConnectBwMode</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="p">(</span><span class="k">enum</span> <span class="n">ht_channel_width</span><span class="p">)(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ChlWidth</span><span class="p">),</span>
			  <span class="p">(</span><span class="k">enum</span> <span class="n">ht_extchnl_offset</span><span class="p">)(</span><span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">ExtChlOffset</span><span class="p">));</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">=</span> <span class="p">((</span><span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">RecommemdedTxWidth</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span>
				 <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">);</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span> <span class="o">=</span> <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span><span class="p">)</span> <span class="o">?</span>
				    <span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ShortGI20Mhz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span>
				    <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">)</span> <span class="o">:</span> <span class="nb">false</span><span class="p">);</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span> <span class="o">=</span> <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span><span class="p">)</span> <span class="o">?</span>
				     <span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">ShortGI40Mhz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span>
				     <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">)</span> <span class="o">:</span> <span class="nb">false</span><span class="p">);</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span> <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span><span class="p">)</span> <span class="o">?</span>
			       <span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">DssCCk</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span>
			       <span class="nb">false</span><span class="p">)</span> <span class="o">:</span> <span class="nb">false</span><span class="p">);</span>


	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span><span class="p">;</span>

	<span class="n">nMaxAMSDUSize</span> <span class="o">=</span> <span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxAMSDUSize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">3839</span> <span class="o">:</span> <span class="mi">7935</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span> <span class="o">&gt;</span> <span class="n">nMaxAMSDUSize</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">nMaxAMSDUSize</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">rtllib_ap_sec_type</span> <span class="o">&amp;&amp;</span>
	   <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">rtllib_ap_sec_type</span><span class="p">(</span><span class="n">ieee</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">SEC_ALG_WEP</span><span class="o">|</span><span class="n">SEC_ALG_TKIP</span><span class="p">)))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_ATHEROS</span><span class="p">)</span> <span class="o">||</span>
				<span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">==</span> <span class="n">HT_IOT_PEER_UNKNOWN</span><span class="p">))</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span> <span class="o">&gt;</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span>
						 <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pairwise_key_type</span> <span class="o">!=</span> <span class="n">KEY_TYPE_NA</span><span class="p">)</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span>
						 <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">HT_AGG_SIZE_64K</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span> <span class="o">&lt;</span> <span class="n">HT_AGG_SIZE_32K</span><span class="p">)</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span>
						 <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MaxRxAMPDUFactor</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">HT_AGG_SIZE_32K</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span> <span class="o">&gt;</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">)</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MPDUDensity</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">&amp;</span> <span class="n">HT_IOT_ACT_TX_USE_AMSDU_8K</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ForcedAMSDUMode</span> <span class="o">=</span> <span class="n">HT_AGG_FORCE_ENABLE</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ForcedAMSDUMaxSize</span> <span class="o">=</span> <span class="mi">7935</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurRxReorderEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRxReorderEnable</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>

	<span class="n">HTIOTActDetermineRaFunc</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="p">((</span><span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">));</span>

	<span class="n">HTFilterMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MCS</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">);</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerMimoPs</span> <span class="o">=</span> <span class="n">pPeerHTCap</span><span class="o">-&gt;</span><span class="n">MimoPwrSave</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerMimoPs</span> <span class="o">==</span> <span class="n">MIMO_PS_STATIC</span><span class="p">)</span>
		<span class="n">pMcsFilter</span> <span class="o">=</span> <span class="n">MCS_FILTER_1SS</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pMcsFilter</span> <span class="o">=</span> <span class="n">MCS_FILTER_ALL</span><span class="p">;</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span> <span class="o">=</span> <span class="n">HTGetHighestMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span>
				   <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">,</span> <span class="n">pMcsFilter</span><span class="p">);</span>
	<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTCurrentOperaRate</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span> <span class="o">=</span> <span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTInitializeHTInfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;===========&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurTxBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bForcedShortGI</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">MPDU_Density</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTCap</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTCap</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTInfo</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">SelfHTInfo</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">));</span>
	<span class="n">memset</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">));</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ChnlOp</span> <span class="o">=</span> <span class="n">CHNLOP_NONE</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">=</span> <span class="n">HT_SPEC_VER_IEEE</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RT2RT_HT_Mode</span> <span class="o">=</span> <span class="p">(</span><span class="k">enum</span> <span class="n">rt_ht_capability</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTPeer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">{</span>
		<span class="n">u8</span> <span class="o">*</span><span class="n">RegHTSuppRateSets</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">RegHTSuppRateSet</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
		<span class="n">RegHTSuppRateSets</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTInitializeBssDesc</span><span class="p">(</span><span class="k">struct</span> <span class="n">bss_ht</span> <span class="o">*</span><span class="n">pBssHT</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdSupportHT</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapBuf</span><span class="p">));</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTCapLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoBuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoBuf</span><span class="p">));</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTInfoLen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdHTSpecVer</span> <span class="o">=</span> <span class="n">HT_SPEC_VER_IEEE</span><span class="p">;</span>

	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">bdRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">pBssHT</span><span class="o">-&gt;</span><span class="n">RT2RT_HT_Mode</span> <span class="o">=</span> <span class="p">(</span><span class="k">enum</span> <span class="n">rt_ht_capability</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTResetSelfAndSavePeerSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">pNetwork</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">bIOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;==============&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="cm">/* unmark bEnableHT flag here is the same reason why unmarked in</span>
<span class="cm">	 * function rtllib_softmac_new_net. WB 2008.09.10*/</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdSupportHT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">ePeerHTSpecVer</span> <span class="o">=</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTSpecVer</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span> <span class="o">&lt;=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">))</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTCapBuf</span><span class="p">,</span>
			       <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapBuf</span><span class="p">,</span>
			       <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTCapLen</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">&lt;=</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">))</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">PeerHTInfoBuf</span><span class="p">,</span>
			       <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoBuf</span><span class="p">,</span>
			       <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegRT2RTAggregation</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span>
				 <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTAggregation</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span>
				 <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdRT2RTLongSlotTime</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RT2RT_HT_Mode</span> <span class="o">=</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">RT2RT_HT_Mode</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RT2RT_HT_Mode</span> <span class="o">=</span> <span class="p">(</span><span class="k">enum</span> <span class="n">rt_ht_capability</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">HTIOTPeerDetermine</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCS14</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_MCS14</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCS15</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_MCS15</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableMCSTwoSpatialStream</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_ALL_2SS</span><span class="p">;</span>


		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsDisableEDCATurbo</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_DISABLE_EDCA_TURBO</span><span class="p">;</span>

		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsMgntUseCCK6M</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">pNetwork</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_MGNT_USE_CCK_6M</span><span class="p">;</span>
		<span class="n">bIOTAction</span> <span class="o">=</span> <span class="n">HTIOTActIsCCDFsync</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bIOTAction</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">|=</span> <span class="n">HT_IOT_ACT_CDD_FSYNC</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTAggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentRT2RTLongSlotTime</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">RT2RT_HT_Mode</span> <span class="o">=</span> <span class="p">(</span><span class="k">enum</span> <span class="n">rt_ht_capability</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTAction</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">IOTRaFunc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HT_update_self_and_peer_setting</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">rtllib_network</span> <span class="o">*</span><span class="n">pNetwork</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="n">pPeerHTInfo</span> <span class="o">=</span>
		 <span class="p">(</span><span class="k">struct</span> <span class="n">ht_info_ele</span> <span class="o">*</span><span class="p">)</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoBuf</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pNetwork</span><span class="o">-&gt;</span><span class="n">bssht</span><span class="p">.</span><span class="n">bdHTInfoLen</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentOpMode</span> <span class="o">=</span> <span class="n">pPeerHTInfo</span><span class="o">-&gt;</span><span class="n">OptMode</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">HT_update_self_and_peer_setting</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">HTUseDefaultSetting</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bEnableHT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurSuppCCK</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegSuppCCK</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI20MHz</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI20MHz</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurShortGI40MHz</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegShortGI40MHz</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">iw_mode</span> <span class="o">==</span> <span class="n">IW_MODE_ADHOC</span><span class="p">)</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">qos_data</span><span class="p">.</span><span class="n">active</span> <span class="o">=</span>
				 <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">qos_data</span><span class="p">.</span><span class="n">supported</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrent_AMSDU_Support</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMSDU_Support</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nCurrent_AMSDU_MaxSize</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">nAMSDU_MaxSize</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentAMPDUEnable</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bAMPDUEnable</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentAMPDUFactor</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">AMPDU_Factor</span><span class="p">;</span>

		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span> <span class="o">=</span> <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurrentMPDUDensity</span><span class="p">;</span>

		<span class="n">HTFilterMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">Regdot11TxHTOperationalRateSet</span><span class="p">,</span>
				<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">);</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span> <span class="o">=</span> <span class="n">HTGetHighestMCSRate</span><span class="p">(</span><span class="n">ieee</span><span class="p">,</span>
					   <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dot11HTOperationalRateSet</span><span class="p">,</span>
					   <span class="n">MCS_FILTER_ALL</span><span class="p">);</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTCurrentOperaRate</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">HTHighestOperaRate</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u8</span> <span class="nf">HTCCheck</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pFrame</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurrentHTSupport</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">IsQoSDataFrame</span><span class="p">(</span><span class="n">pFrame</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">Frame_Order</span><span class="p">(</span><span class="n">pFrame</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;HT CONTROL FILED &quot;</span>
				     <span class="s">&quot;EXIST!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">HTSetConnectBwModeCallback</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="n">RTLLIB_DEBUG</span><span class="p">(</span><span class="n">RTLLIB_DL_HT</span><span class="p">,</span> <span class="s">&quot;======&gt;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_UPPER</span><span class="p">)</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				       <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">==</span>
			 <span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				       <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				       <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>

		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">SetBWModeHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span><span class="p">,</span>
				       <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">set_chan</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span><span class="p">);</span>
		<span class="n">ieee</span><span class="o">-&gt;</span><span class="n">SetBWModeHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">,</span>
				       <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HTSetConnectBwMode</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtllib_device</span> <span class="o">*</span><span class="n">ieee</span><span class="p">,</span>
			<span class="k">enum</span> <span class="n">ht_channel_width</span> <span class="n">Bandwidth</span><span class="p">,</span>
			<span class="k">enum</span> <span class="n">ht_extchnl_offset</span> <span class="n">Offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt_hi_throughput</span> <span class="o">*</span><span class="n">pHTInfo</span> <span class="o">=</span> <span class="n">ieee</span><span class="o">-&gt;</span><span class="n">pHTInfo</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bRegBW40MHz</span> <span class="o">==</span> <span class="nb">false</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">GetHalfNmodeSupportByAPsHandler</span><span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span>
		<span class="n">Bandwidth</span> <span class="o">=</span> <span class="n">HT_CHANNEL_WIDTH_20</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: bSwBwInProgress!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">Bandwidth</span> <span class="o">==</span> <span class="n">HT_CHANNEL_WIDTH_20_40</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ieee</span><span class="o">-&gt;</span><span class="n">current_network</span><span class="p">.</span><span class="n">channel</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span>
		    <span class="n">Offset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span>
			<span class="n">Offset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">Offset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_UPPER</span> <span class="o">||</span>
		    <span class="n">Offset</span> <span class="o">==</span> <span class="n">HT_EXTCHNL_OFFSET_LOWER</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">Offset</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">CurSTAExtChnlOffset</span> <span class="o">=</span> <span class="n">HT_EXTCHNL_OFFSET_NO_EXT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s():pHTInfo-&gt;bCurBW40MHz:%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
	       <span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bCurBW40MHz</span><span class="p">);</span>

	<span class="n">pHTInfo</span><span class="o">-&gt;</span><span class="n">bSwBwInProgress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">HTSetConnectBwModeCallback</span><span class="p">(</span><span class="n">ieee</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
