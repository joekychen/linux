<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › bcm › Debug.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>Debug.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Debug.h</span>
<span class="cm"> *</span>
<span class="cm"> * Dynamic (runtime) debug framework implementation.</span>
<span class="cm"> * -kaiwan.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _DEBUG_H</span>
<span class="cp">#define _DEBUG_H</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#define NONE 0xFFFF</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><hr /></td><td class="code"><div class="highlight"><pre><span class="cm">/* TYPE and SUBTYPE</span>
<span class="cm"> * Define valid TYPE (or category or code-path, however you like to think of it)</span>
<span class="cm"> * and SUBTYPE s.</span>
<span class="cm"> * Type and SubType are treated as bitmasks.</span>
<span class="cm"> */</span>
<span class="cm">/*-----------------BEGIN TYPEs------------------------------------------*/</span>
<span class="cp">#define DBG_TYPE_INITEXIT		(1 &lt;&lt; 0)	</span><span class="c1">// 1</span>
<span class="cp">#define DBG_TYPE_TX				(1 &lt;&lt; 1)	</span><span class="c1">// 2</span>
<span class="cp">#define DBG_TYPE_RX				(1 &lt;&lt; 2)	</span><span class="c1">// 4</span>
<span class="cp">#define DBG_TYPE_OTHERS			(1 &lt;&lt; 3)	</span><span class="c1">// 8</span>
<span class="cm">/*-----------------END TYPEs------------------------------------------*/</span>
<span class="cp">#define NUMTYPES			4		</span><span class="c1">// careful!</span>

<span class="cm">/*-----------------BEGIN SUBTYPEs---------------------------------------*/</span>

<span class="cm">/*-SUBTYPEs for TX :  TYPE is DBG_TYPE_TX -----//</span>
<span class="cm"> Transmit.c ,Arp.c, LeakyBucket.c, And Qos.c</span>
<span class="cm"> total 17 macros */</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Transmit.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define TX 			1</span>
<span class="cp">#define MP_SEND  	(TX&lt;&lt;0)</span>
<span class="cp">#define NEXT_SEND   (TX&lt;&lt;1)</span>
<span class="cp">#define TX_FIFO  	(TX&lt;&lt;2)</span>
<span class="cp">#define TX_CONTROL 	(TX&lt;&lt;3)</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Arp.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define IP_ADDR  	(TX&lt;&lt;4)</span>
<span class="cp">#define ARP_REQ  	(TX&lt;&lt;5)</span>
<span class="cp">#define ARP_RESP 	(TX&lt;&lt;6)</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>dhcp.c</p>

<h1>define DHCP TX</h1>

<h1>define DHCP_REQ (DHCP&lt;&lt;7)</h1></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Leakybucket.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define TOKEN_COUNTS (TX&lt;&lt;8)</span>
<span class="cp">#define CHECK_TOKENS (TX&lt;&lt;9)</span>
<span class="cp">#define TX_PACKETS   (TX&lt;&lt;10)</span>
<span class="cp">#define TIMER  		 (TX&lt;&lt;11)</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Qos.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define QOS TX</span>
<span class="cp">#define QUEUE_INDEX (QOS&lt;&lt;12)</span>
<span class="cp">#define IPV4_DBG 	(QOS&lt;&lt;13)</span>
<span class="cp">#define IPV6_DBG 	(QOS&lt;&lt;14)</span>
<span class="cp">#define PRUNE_QUEUE (QOS&lt;&lt;15)</span>
<span class="cp">#define SEND_QUEUE 	(QOS&lt;&lt;16)</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>TX_Misc</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define TX_OSAL_DBG (TX&lt;&lt;17)</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>--SUBTYPEs for ------INIT &amp; EXIT---------------------</p></td><td class="code"><div class="highlight"><pre><span class="cm">/*------------ TYPE is DBG_TYPE_INITEXIT -----//</span>
<span class="cm">DriverEntry.c, bcmfwup.c, ChipDetectTask.c, HaltnReset.c, InterfaceDDR.c */</span>
<span class="cp">#define MP 1</span>
<span class="cp">#define DRV_ENTRY 	(MP&lt;&lt;0)</span>
<span class="cp">#define MP_INIT  	(MP&lt;&lt;1)</span>
<span class="cp">#define READ_REG 	(MP&lt;&lt;3)</span>
<span class="cp">#define DISPATCH 	(MP&lt;&lt;2)</span>
<span class="cp">#define CLAIM_ADAP 	(MP&lt;&lt;4)</span>
<span class="cp">#define REG_IO_PORT (MP&lt;&lt;5)</span>
<span class="cp">#define INIT_DISP 	(MP&lt;&lt;6)</span>
<span class="cp">#define RX_INIT  	(MP&lt;&lt;7)</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>-SUBTYPEs for --RX----------------------------------
------------RX  :  TYPE is DBG<em>TYPE</em>RX -----//
Receive.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define RX 1</span>
<span class="cp">#define RX_DPC  	(RX&lt;&lt;0)</span>
<span class="cp">#define RX_CTRL 	(RX&lt;&lt;3)</span>
<span class="cp">#define RX_DATA 	(RX&lt;&lt;4)</span>
<span class="cp">#define MP_RETURN 	(RX&lt;&lt;1)</span>
<span class="cp">#define LINK_MSG 	(RX&lt;&lt;2)</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>-SUBTYPEs for ----OTHER ROUTINES------------------
------------OTHERS  :  TYPE is DBG<em>TYPE</em>OTHER -----//
HaltnReset,CheckForHang,PnP,Misc,CmHost
total 12 macros</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define OTHERS 1</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>??ISR.C</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define ISR OTHERS</span>
<span class="cp">#define MP_DPC  (ISR&lt;&lt;0)</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>HaltnReset.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define HALT OTHERS</span>
<span class="cp">#define MP_HALT  		(HALT&lt;&lt;1)</span>
<span class="cp">#define CHECK_HANG 		(HALT&lt;&lt;2)</span>
<span class="cp">#define MP_RESET 		(HALT&lt;&lt;3)</span>
<span class="cp">#define MP_SHUTDOWN 	(HALT&lt;&lt;4)</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>pnp.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define PNP OTHERS</span>
<span class="cp">#define MP_PNP  		(PNP&lt;&lt;5)</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Misc.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define MISC OTHERS</span>
<span class="cp">#define DUMP_INFO 		(MISC&lt;&lt;6)</span>
<span class="cp">#define CLASSIFY 		(MISC&lt;&lt;7)</span>
<span class="cp">#define LINK_UP_MSG 	(MISC&lt;&lt;8)</span>
<span class="cp">#define CP_CTRL_PKT 	(MISC&lt;&lt;9)</span>
<span class="cp">#define DUMP_CONTROL 	(MISC&lt;&lt;10)</span>
<span class="cp">#define LED_DUMP_INFO 	(MISC&lt;&lt;11)</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>CmHost.c</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define CMHOST OTHERS</span>


<span class="cp">#define SERIAL  		(OTHERS&lt;&lt;12)</span>
<span class="cp">#define IDLE_MODE 		(OTHERS&lt;&lt;13)</span>

<span class="cp">#define WRM   			(OTHERS&lt;&lt;14)</span>
<span class="cp">#define RDM   			(OTHERS&lt;&lt;15)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>TODO - put PHS<em>SEND in Tx PHS</em>RECEIVE in Rx path ?</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define PHS_SEND    	(OTHERS&lt;&lt;16)</span>
<span class="cp">#define PHS_RECEIVE 	(OTHERS&lt;&lt;17)</span>
<span class="cp">#define PHS_MODULE 	    (OTHERS&lt;&lt;18)</span>

<span class="cp">#define INTF_INIT    	(OTHERS&lt;&lt;19)</span>
<span class="cp">#define INTF_ERR     	(OTHERS&lt;&lt;20)</span>
<span class="cp">#define INTF_WARN    	(OTHERS&lt;&lt;21)</span>
<span class="cp">#define INTF_NORM 		(OTHERS&lt;&lt;22)</span>

<span class="cp">#define IRP_COMPLETION 	(OTHERS&lt;&lt;23)</span>
<span class="cp">#define SF_DESCRIPTOR_CNTS (OTHERS&lt;&lt;24)</span>
<span class="cp">#define PHS_DISPATCH 	(OTHERS &lt;&lt; 25)</span>
<span class="cp">#define OSAL_DBG 		(OTHERS &lt;&lt; 26)</span>
<span class="cp">#define NVM_RW      	(OTHERS &lt;&lt; 27)</span>

<span class="cp">#define HOST_MIBS   	(OTHERS &lt;&lt; 28)</span>
<span class="cp">#define CONN_MSG    	(CMHOST &lt;&lt; 29)</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><h1>define OTHERS_MISC        (OTHERS &lt;&lt; 29)  // ProcSupport.c</h1></td><td class="code"><div class="highlight"><pre><span class="cm">/*-----------------END SUBTYPEs------------------------------------------*/</span>


<span class="cm">/* Debug level</span>
<span class="cm"> * We have 8 debug levels, in (numerical) increasing order of verbosity.</span>
<span class="cm"> * IMP: Currently implementing ONLY DBG_LVL_ALL , i.e. , all debug prints will</span>
<span class="cm"> * appear (of course, iff global debug flag is ON and we match the Type and SubType).</span>
<span class="cm"> * Finer granularity debug levels are currently not in use, although the feature exists.</span>
<span class="cm"> *</span>
<span class="cm"> * Another way to say this:</span>
<span class="cm"> * All the debug prints currently have &#39;debug_level&#39; set to DBG_LVL_ALL .</span>
<span class="cm"> * You can compile-time change that to any of the below, if you wish to. However, as of now, there&#39;s</span>
<span class="cm"> * no dynamic facility to have the userspace &#39;TestApp&#39; set debug_level. Slated for future expansion.</span>
<span class="cm"> */</span>
<span class="cp">#define BCM_ALL			7</span>
<span class="cp">#define	BCM_LOW			6</span>
<span class="cp">#define	BCM_PRINT		5</span>
<span class="cp">#define	BCM_NORMAL		4</span>
<span class="cp">#define	BCM_MEDIUM		3</span>
<span class="cp">#define	BCM_SCREAM		2</span>
<span class="cp">#define	BCM_ERR			1</span>
<span class="cm">/* Not meant for developer in debug prints.</span>
<span class="cm"> * To be used to disable all prints by setting the DBG_LVL_CURR to this value */</span>
<span class="cp">#define	BCM_NONE		0</span>

<span class="cm">/* The current driver logging level.</span>
<span class="cm"> * Everything at this level and (numerically) lower (meaning higher prio)</span>
<span class="cm"> * is logged.</span>
<span class="cm">* Replace &#39;BCM_ALL&#39; in the DBG_LVL_CURR macro with the logging level desired.</span>
<span class="cm"> * For eg. to set the logging level to &#39;errors only&#39; use:</span>
<span class="cm"> *	 #define DBG_LVL_CURR	(BCM_ERR)</span>
<span class="cm"> */</span>

<span class="cp">#define DBG_LVL_CURR	(BCM_ALL)</span>
<span class="cp">#define DBG_LVL_ALL		BCM_ALL</span>

<span class="cm">/*---Userspace mapping of Debug State.</span>
<span class="cm"> * Delibrately matches that of the Windows driver..</span>
<span class="cm"> * The TestApp&#39;s ioctl passes this struct to us.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">Subtype</span><span class="p">,</span> <span class="n">Type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">OnOff</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>unsigned int debug_level;     /* future expansion */</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">USER_BCM_DBG_STATE</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>---Kernel-space mapping of Debug State</p></td><td class="code"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_S_BCM_DEBUG_STATE</span> <span class="p">{</span>
	<span class="n">UINT</span> <span class="n">type</span><span class="p">;</span>
	<span class="cm">/* A bitmap of 32 bits for Subtype per Type.</span>
<span class="cm">	 * Valid indexes in &#39;subtype&#39; array are *only* 1,2,4 and 8,</span>
<span class="cm">	 * corresponding to valid Type values. Hence we use the &#39;Type&#39; field</span>
<span class="cm">	 * as the index value, ignoring the array entries 0,3,5,6,7 !</span>
<span class="cm">	 */</span>
	<span class="n">UINT</span> <span class="n">subtype</span><span class="p">[(</span><span class="n">NUMTYPES</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">UINT</span> <span class="n">debug_level</span><span class="p">;</span>
<span class="p">}</span> <span class="n">S_BCM_DEBUG_STATE</span><span class="p">;</span>
<span class="cm">/* Instantiated in the Adapter structure */</span>
<span class="cm">/* We&#39;ll reuse the debug level parameter to include a bit (the MSB) to indicate whether or not</span>
<span class="cm"> * we want the function&#39;s name printed.  */</span>
<span class="cp">#define DBG_NO_FUNC_PRINT	1 &lt;&lt; 31</span>
<span class="cp">#define DBG_LVL_BITMASK		0xFF</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>--- Only for direct printk's; "hidden" to API.</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define DBG_TYPE_PRINTK		3</span>

<span class="cp">#define BCM_DEBUG_PRINT(Adapter, Type, SubType, dbg_level, string, args...) \</span>
<span class="cp">	do {								\</span>
<span class="cp">		if (DBG_TYPE_PRINTK == Type)				\</span>
<span class="cp">			pr_info(&quot;%s:&quot; string, __func__, ##args);	\</span>
<span class="cp">		else if (Adapter &amp;&amp;					\</span>
<span class="cp">			 (dbg_level &amp; DBG_LVL_BITMASK) &lt;= Adapter-&gt;stDebugState.debug_level &amp;&amp; \</span>
<span class="cp">			 (Type &amp; Adapter-&gt;stDebugState.type) &amp;&amp;		\</span>
<span class="cp">			 (SubType &amp; Adapter-&gt;stDebugState.subtype[Type])) { \</span>
<span class="cp">			if (dbg_level &amp; DBG_NO_FUNC_PRINT)		\</span>
<span class="cp">				printk(KERN_DEBUG string, ##args);	\</span>
<span class="cp">			else						\</span>
<span class="cp">				printk(KERN_DEBUG &quot;%s:&quot; string, __func__, ##args);	\</span>
<span class="cp">		}							\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define BCM_DEBUG_PRINT_BUFFER(Adapter, Type, SubType, dbg_level,  buffer, bufferlen) do { \</span>
<span class="cp">	if (DBG_TYPE_PRINTK == Type ||					\</span>
<span class="cp">	    (Adapter &amp;&amp;							\</span>
<span class="cp">	     (dbg_level &amp; DBG_LVL_BITMASK) &lt;= Adapter-&gt;stDebugState.debug_level  &amp;&amp; \</span>
<span class="cp">	     (Type &amp; Adapter-&gt;stDebugState.type) &amp;&amp;			\</span>
<span class="cp">	     (SubType &amp; Adapter-&gt;stDebugState.subtype[Type]))) {	\</span>
<span class="cp">		printk(KERN_DEBUG &quot;%s:\n&quot;, __func__);			\</span>
<span class="cp">		print_hex_dump(KERN_DEBUG, &quot; &quot;, DUMP_PREFIX_OFFSET,	\</span>
<span class="cp">			       16, 1, buffer, bufferlen, false);	\</span>
<span class="cp">	}								\</span>
<span class="cp">} while(0)</span>


<span class="cp">#define BCM_SHOW_DEBUG_BITMAP(Adapter)	do { \</span>
<span class="cp">	int i;									\</span>
<span class="cp">	for (i=0; i&lt;(NUMTYPES*2)+1; i++) {		\</span>
<span class="cp">		if ((i == 1) || (i == 2) || (i == 4) || (i == 8)) {		\</span>
<span class="cp">		</span><span class="cm">/* CAUTION! Forcefully turn on ALL debug paths and subpaths!	\</span>
<span class="cm">		Adapter-&gt;stDebugState.subtype[i] = 0xffffffff;	*/</span><span class="cp"> \</span>
<span class="cp">		BCM_DEBUG_PRINT (Adapter, DBG_TYPE_PRINTK, 0, 0, &quot;subtype[%d] = 0x%08x\n&quot;, 	\</span>
<span class="cp">		i, Adapter-&gt;stDebugState.subtype[i]);	\</span>
<span class="cp">		}	\</span>
<span class="cp">	}		\</span>
<span class="cp">} while (0)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
