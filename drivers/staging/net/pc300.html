<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › staging › net › pc300.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>pc300.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * pc300.h	Cyclades-PC300(tm) Kernel API Definitions.</span>
<span class="cm"> *</span>
<span class="cm"> * Author:	Ivan Passos &lt;ivan@cyclades.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright:	(c) 1999-2002 Cyclades Corp.</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or</span>
<span class="cm"> *	modify it under the terms of the GNU General Public License</span>
<span class="cm"> *	as published by the Free Software Foundation; either version</span>
<span class="cm"> *	2 of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * $Log: pc300.h,v $</span>
<span class="cm"> * Revision 3.12  2002/03/07 14:17:09  henrique</span>
<span class="cm"> * License data fixed</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.11  2002/01/28 21:09:39  daniela</span>
<span class="cm"> * Included &#39;;&#39; after pc300hw.bus.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.10  2002/01/17 17:58:52  ivan</span>
<span class="cm"> * Support for PC300-TE/M (PMC).</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.9  2001/09/28 13:30:53  daniela</span>
<span class="cm"> * Renamed dma_start routine to rx_dma_start.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.8  2001/09/24 13:03:45  daniela</span>
<span class="cm"> * Fixed BOF interrupt treatment. Created dma_start routine.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.7  2001/08/10 17:19:58  daniela</span>
<span class="cm"> * Fixed IOCTLs defines.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.6  2001/07/18 19:24:42  daniela</span>
<span class="cm"> * Included kernel version.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.5  2001/07/05 18:38:08  daniela</span>
<span class="cm"> * DMA transmission bug fix.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.4  2001/06/26 17:10:40  daniela</span>
<span class="cm"> * New configuration parameters (line code, CRC calculation and clock).</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.3  2001/06/22 13:13:02  regina</span>
<span class="cm"> * MLPPP implementation</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.2  2001/06/18 17:56:09  daniela</span>
<span class="cm"> * Increased DEF_MTU and TX_QUEUE_LEN.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 3.1  2001/06/15 12:41:10  regina</span>
<span class="cm"> * upping major version number</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 1.1.1.1  2001/06/13 20:25:06  daniela</span>
<span class="cm"> * PC300 initial CVS version (3.4.0-pre1)</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 2.3 2001/03/05 daniela</span>
<span class="cm"> * Created struct pc300conf, to provide the hardware information to pc300util.</span>
<span class="cm"> * Inclusion of &#39;alloc_ramsize&#39; field on structure &#39;pc300hw&#39;.</span>
<span class="cm"> * </span>
<span class="cm"> * Revision 2.2 2000/12/22 daniela</span>
<span class="cm"> * Structures and defines to support pc300util: statistics, status, </span>
<span class="cm"> * loopback tests, trace.</span>
<span class="cm"> * </span>
<span class="cm"> * Revision 2.1 2000/09/28 ivan</span>
<span class="cm"> * Inclusion of &#39;iophys&#39; and &#39;iosize&#39; fields on structure &#39;pc300hw&#39;, to </span>
<span class="cm"> * allow release of I/O region at module unload.</span>
<span class="cm"> * Changed location of include files.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 2.0 2000/03/27 ivan</span>
<span class="cm"> * Added support for the PC300/TE cards.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 1.1 2000/01/31 ivan</span>
<span class="cm"> * Replaced &#39;pc300[drv|sca].h&#39; former PC300 driver include files.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 1.0 1999/12/16 ivan</span>
<span class="cm"> * First official release.</span>
<span class="cm"> * Inclusion of &#39;nchan&#39; field on structure &#39;pc300hw&#39;, to allow variable </span>
<span class="cm"> * number of ports per card.</span>
<span class="cm"> * Inclusion of &#39;if_ptr&#39; field on structure &#39;pc300dev&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.6 1999/11/17 ivan</span>
<span class="cm"> * Changed X.25-specific function names to comply with adopted convention.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.5 1999/11/16 Daniela Squassoni</span>
<span class="cm"> * X.25 support.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.4 1999/11/15 ivan</span>
<span class="cm"> * Inclusion of &#39;clock&#39; field on structure &#39;pc300hw&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.3 1999/11/10 ivan</span>
<span class="cm"> * IOCTL name changing.</span>
<span class="cm"> * Inclusion of driver function prototypes.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.2 1999/11/03 ivan</span>
<span class="cm"> * Inclusion of &#39;tx_skb&#39; and union &#39;ifu&#39; on structure &#39;pc300dev&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * Revision 0.1 1999/01/15 ivan</span>
<span class="cm"> * Initial version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef	_PC300_H</span>
<span class="cp">#define	_PC300_H</span>

<span class="cp">#include &lt;linux/hdlc.h&gt;</span>
<span class="cp">#include &quot;hd64572.h&quot;</span>
<span class="cp">#include &quot;pc300-falc-lh.h&quot;</span>

<span class="cp">#define PC300_PROTO_MLPPP 1</span>

<span class="cp">#define	PC300_MAXCHAN	2	</span><span class="cm">/* Number of channels per card */</span><span class="cp"></span>

<span class="cp">#define	PC300_RAMSIZE	0x40000 </span><span class="cm">/* RAM window size (256Kb) */</span><span class="cp"></span>
<span class="cp">#define	PC300_FALCSIZE	0x400	</span><span class="cm">/* FALC window size (1Kb) */</span><span class="cp"></span>

<span class="cp">#define PC300_OSC_CLOCK	24576000</span>
<span class="cp">#define PC300_PCI_CLOCK	33000000</span>

<span class="cp">#define BD_DEF_LEN	0x0800	</span><span class="cm">/* DMA buffer length (2KB) */</span><span class="cp"></span>
<span class="cp">#define DMA_TX_MEMSZ	0x8000	</span><span class="cm">/* Total DMA Tx memory size (32KB/ch) */</span><span class="cp"></span>
<span class="cp">#define DMA_RX_MEMSZ	0x10000	</span><span class="cm">/* Total DMA Rx memory size (64KB/ch) */</span><span class="cp"></span>

<span class="cp">#define N_DMA_TX_BUF	(DMA_TX_MEMSZ / BD_DEF_LEN)	</span><span class="cm">/* DMA Tx buffers */</span><span class="cp"></span>
<span class="cp">#define N_DMA_RX_BUF	(DMA_RX_MEMSZ / BD_DEF_LEN)	</span><span class="cm">/* DMA Rx buffers */</span><span class="cp"></span>

<span class="cm">/* DMA Buffer Offsets */</span>
<span class="cp">#define DMA_TX_BASE	((N_DMA_TX_BUF + N_DMA_RX_BUF) *	\</span>
<span class="cp">			 PC300_MAXCHAN * sizeof(pcsca_bd_t))</span>
<span class="cp">#define DMA_RX_BASE	(DMA_TX_BASE + PC300_MAXCHAN*DMA_TX_MEMSZ)</span>

<span class="cm">/* DMA Descriptor Offsets */</span>
<span class="cp">#define DMA_TX_BD_BASE	0x0000</span>
<span class="cp">#define DMA_RX_BD_BASE	(DMA_TX_BD_BASE + ((PC300_MAXCHAN*DMA_TX_MEMSZ / \</span>
<span class="cp">				BD_DEF_LEN) * sizeof(pcsca_bd_t)))</span>

<span class="cm">/* DMA Descriptor Macros */</span>
<span class="cp">#define TX_BD_ADDR(chan, n)	(DMA_TX_BD_BASE + \</span>
<span class="cp">				 ((N_DMA_TX_BUF*chan) + n) * sizeof(pcsca_bd_t))</span>
<span class="cp">#define RX_BD_ADDR(chan, n)	(DMA_RX_BD_BASE + \</span>
<span class="cp">				 ((N_DMA_RX_BUF*chan) + n) * sizeof(pcsca_bd_t))</span>

<span class="cm">/* Macro to access the FALC registers (TE only) */</span>
<span class="cp">#define F_REG(reg, chan)	(0x200*(chan) + ((reg)&lt;&lt;2))</span>

<span class="cm">/***************************************</span>
<span class="cm"> * Memory access functions/macros      *</span>
<span class="cm"> * (required to support Alpha systems) *</span>
<span class="cm"> ***************************************/</span>
<span class="cp">#define cpc_writeb(port,val)	{writeb((u8)(val),(port)); mb();}</span>
<span class="cp">#define cpc_writew(port,val)	{writew((ushort)(val),(port)); mb();}</span>
<span class="cp">#define cpc_writel(port,val)	{writel((u32)(val),(port)); mb();}</span>

<span class="cp">#define cpc_readb(port)		readb(port)</span>
<span class="cp">#define cpc_readw(port)		readw(port)</span>
<span class="cp">#define cpc_readl(port)		readl(port)</span>

<span class="cm">/****** Data Structures *****************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *      RUNTIME_9050 - PLX PCI9050-1 local configuration and shared runtime</span>
<span class="cm"> *      registers. This structure can be used to access the 9050 registers</span>
<span class="cm"> *      (memory mapped).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">RUNTIME_9050</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">loc_addr_range</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 00-0Ch : Local Address Ranges */</span>
	<span class="n">u32</span> <span class="n">loc_rom_range</span><span class="p">;</span>	<span class="cm">/* 10h : Local ROM Range */</span>
	<span class="n">u32</span> <span class="n">loc_addr_base</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 14-20h : Local Address Base Addrs */</span>
	<span class="n">u32</span> <span class="n">loc_rom_base</span><span class="p">;</span>	<span class="cm">/* 24h : Local ROM Base */</span>
	<span class="n">u32</span> <span class="n">loc_bus_descr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 28-34h : Local Bus Descriptors */</span>
	<span class="n">u32</span> <span class="n">rom_bus_descr</span><span class="p">;</span>	<span class="cm">/* 38h : ROM Bus Descriptor */</span>
	<span class="n">u32</span> <span class="n">cs_base</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* 3C-48h : Chip Select Base Addrs */</span>
	<span class="n">u32</span> <span class="n">intr_ctrl_stat</span><span class="p">;</span>	<span class="cm">/* 4Ch : Interrupt Control/Status */</span>
	<span class="n">u32</span> <span class="n">init_ctrl</span><span class="p">;</span>		<span class="cm">/* 50h : EEPROM ctrl, Init Ctrl, etc */</span>
<span class="p">};</span>

<span class="cp">#define PLX_9050_LINT1_ENABLE	0x01</span>
<span class="cp">#define PLX_9050_LINT1_POL	0x02</span>
<span class="cp">#define PLX_9050_LINT1_STATUS	0x04</span>
<span class="cp">#define PLX_9050_LINT2_ENABLE	0x08</span>
<span class="cp">#define PLX_9050_LINT2_POL	0x10</span>
<span class="cp">#define PLX_9050_LINT2_STATUS	0x20</span>
<span class="cp">#define PLX_9050_INTR_ENABLE	0x40</span>
<span class="cp">#define PLX_9050_SW_INTR	0x80</span>

<span class="cm">/* Masks to access the init_ctrl PLX register */</span>
<span class="cp">#define	PC300_CLKSEL_MASK		(0x00000004UL)</span>
<span class="cp">#define	PC300_CHMEDIA_MASK(chan)	(0x00000020UL&lt;&lt;(chan*3))</span>
<span class="cp">#define	PC300_CTYPE_MASK		(0x00000800UL)</span>

<span class="cm">/* CPLD Registers (base addr = falcbase, TE only) */</span>
<span class="cm">/* CPLD v. 0 */</span>
<span class="cp">#define CPLD_REG1	0x140	</span><span class="cm">/* Chip resets, DCD/CTS status */</span><span class="cp"></span>
<span class="cp">#define CPLD_REG2	0x144	</span><span class="cm">/* Clock enable , LED control */</span><span class="cp"></span>
<span class="cm">/* CPLD v. 2 or higher */</span>
<span class="cp">#define CPLD_V2_REG1	0x100	</span><span class="cm">/* Chip resets, DCD/CTS status */</span><span class="cp"></span>
<span class="cp">#define CPLD_V2_REG2	0x104	</span><span class="cm">/* Clock enable , LED control */</span><span class="cp"></span>
<span class="cp">#define CPLD_ID_REG	0x108	</span><span class="cm">/* CPLD version */</span><span class="cp"></span>

<span class="cm">/* CPLD Register bit description: for the FALC bits, they should always be </span>
<span class="cm">   set based on the channel (use (bit&lt;&lt;(2*ch)) to access the correct bit for </span>
<span class="cm">   that channel) */</span>
<span class="cp">#define CPLD_REG1_FALC_RESET	0x01</span>
<span class="cp">#define CPLD_REG1_SCA_RESET	0x02</span>
<span class="cp">#define CPLD_REG1_GLOBAL_CLK	0x08</span>
<span class="cp">#define CPLD_REG1_FALC_DCD	0x10</span>
<span class="cp">#define CPLD_REG1_FALC_CTS	0x20</span>

<span class="cp">#define CPLD_REG2_FALC_TX_CLK	0x01</span>
<span class="cp">#define CPLD_REG2_FALC_RX_CLK	0x02</span>
<span class="cp">#define CPLD_REG2_FALC_LED1	0x10</span>
<span class="cp">#define CPLD_REG2_FALC_LED2	0x20</span>

<span class="cm">/* Structure with FALC-related fields (TE only) */</span>
<span class="cp">#define PC300_FALC_MAXLOOP	0x0000ffff	</span><span class="cm">/* for falc_issue_cmd() */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">falc</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">sync</span><span class="p">;</span>	<span class="cm">/* If true FALC is synchronized */</span>
	<span class="n">u8</span> <span class="n">active</span><span class="p">;</span>	<span class="cm">/* if TRUE then already active */</span>
	<span class="n">u8</span> <span class="n">loop_active</span><span class="p">;</span>	<span class="cm">/* if TRUE a line loopback UP was received */</span>
	<span class="n">u8</span> <span class="n">loop_gen</span><span class="p">;</span>	<span class="cm">/* if TRUE a line loopback UP was issued */</span>

	<span class="n">u8</span> <span class="n">num_channels</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">offset</span><span class="p">;</span>	<span class="cm">/* 1 for T1, 0 for E1 */</span>
	<span class="n">u8</span> <span class="n">full_bandwidth</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">xmb_cause</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">multiframe_mode</span><span class="p">;</span>

	<span class="cm">/* Statistics */</span>
	<span class="n">u16</span> <span class="n">pden</span><span class="p">;</span>	<span class="cm">/* Pulse Density violation count */</span>
	<span class="n">u16</span> <span class="n">los</span><span class="p">;</span>	<span class="cm">/* Loss of Signal count */</span>
	<span class="n">u16</span> <span class="n">losr</span><span class="p">;</span>	<span class="cm">/* Loss of Signal recovery count */</span>
	<span class="n">u16</span> <span class="n">lfa</span><span class="p">;</span>	<span class="cm">/* Loss of frame alignment count */</span>
	<span class="n">u16</span> <span class="n">farec</span><span class="p">;</span>	<span class="cm">/* Frame Alignment Recovery count */</span>
	<span class="n">u16</span> <span class="n">lmfa</span><span class="p">;</span>	<span class="cm">/* Loss of multiframe alignment count */</span>
	<span class="n">u16</span> <span class="n">ais</span><span class="p">;</span>	<span class="cm">/* Remote Alarm indication Signal count */</span>
	<span class="n">u16</span> <span class="n">sec</span><span class="p">;</span>	<span class="cm">/* One-second timer */</span>
	<span class="n">u16</span> <span class="n">es</span><span class="p">;</span>		<span class="cm">/* Errored second */</span>
	<span class="n">u16</span> <span class="n">rai</span><span class="p">;</span>	<span class="cm">/* remote alarm received */</span>
	<span class="n">u16</span> <span class="n">bec</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fec</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cvc</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cec</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ebc</span><span class="p">;</span>

	<span class="cm">/* Status */</span>
	<span class="n">u8</span> <span class="n">red_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">blue_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loss_fa</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">yellow_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loss_mfa</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">prbs</span><span class="p">;</span>
<span class="p">}</span> <span class="n">falc_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">falc_status</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">sync</span><span class="p">;</span>	<span class="cm">/* If true FALC is synchronized */</span>
	<span class="n">u8</span> <span class="n">red_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">blue_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loss_fa</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">yellow_alarm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loss_mfa</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">prbs</span><span class="p">;</span>
<span class="p">}</span> <span class="n">falc_status_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">rsv_x21_status</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">dcd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dsr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cts</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rts</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dtr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">rsv_x21_status_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300stats</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">hw_type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">line_on</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">line_off</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">gen_stats</span><span class="p">;</span>
	<span class="n">falc_t</span> <span class="n">te_stats</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300stats_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300status</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">hw_type</span><span class="p">;</span>
	<span class="n">rsv_x21_status_t</span> <span class="n">gen_status</span><span class="p">;</span>
	<span class="n">falc_status_t</span> <span class="n">te_status</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300status_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300loopback</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">loop_type</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">loop_on</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300loopback_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300patterntst</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">patrntst_on</span><span class="p">;</span>       <span class="cm">/* 0 - off; 1 - on; 2 - read num_errors */</span>
	<span class="n">u16</span> <span class="n">num_errors</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300patterntst_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pc300ch</span> <span class="o">*</span><span class="n">chan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">trace_on</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">line_on</span><span class="p">;</span>		<span class="cm">/* DCD(X.21, RSV) / sync(TE) change counters */</span>
	<span class="n">u32</span> <span class="n">line_off</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_PC300_MLPPP</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">cpc_tty</span><span class="p">;</span>	<span class="cm">/* information to PC300 TTY driver */</span>
<span class="cp">#endif</span>
<span class="p">}</span><span class="n">pc300dev_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300hw</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>		<span class="cm">/* RSV, X21, etc. */</span>
	<span class="kt">int</span> <span class="n">bus</span><span class="p">;</span>		<span class="cm">/* Bus (PCI, PMC, etc.) */</span>
	<span class="kt">int</span> <span class="n">nchan</span><span class="p">;</span>		<span class="cm">/* number of channels */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>		<span class="cm">/* interrupt request level */</span>
	<span class="n">u32</span> <span class="n">clock</span><span class="p">;</span>		<span class="cm">/* Board clock */</span>
	<span class="n">u8</span> <span class="n">cpld_id</span><span class="p">;</span>		<span class="cm">/* CPLD ID (TE only) */</span>
	<span class="n">u16</span> <span class="n">cpld_reg1</span><span class="p">;</span>		<span class="cm">/* CPLD reg 1 (TE only) */</span>
	<span class="n">u16</span> <span class="n">cpld_reg2</span><span class="p">;</span>		<span class="cm">/* CPLD reg 2 (TE only) */</span>
	<span class="n">u16</span> <span class="n">gpioc_reg</span><span class="p">;</span>		<span class="cm">/* PLX GPIOC reg */</span>
	<span class="n">u16</span> <span class="n">intctl_reg</span><span class="p">;</span>		<span class="cm">/* PLX Int Ctrl/Status reg */</span>
	<span class="n">u32</span> <span class="n">iophys</span><span class="p">;</span>		<span class="cm">/* PLX registers I/O base */</span>
	<span class="n">u32</span> <span class="n">iosize</span><span class="p">;</span>		<span class="cm">/* PLX registers I/O size */</span>
	<span class="n">u32</span> <span class="n">plxphys</span><span class="p">;</span>		<span class="cm">/* PLX registers MMIO base (physical) */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">plxbase</span><span class="p">;</span>	<span class="cm">/* PLX registers MMIO base (virtual) */</span>
	<span class="n">u32</span> <span class="n">plxsize</span><span class="p">;</span>		<span class="cm">/* PLX registers MMIO size */</span>
	<span class="n">u32</span> <span class="n">scaphys</span><span class="p">;</span>		<span class="cm">/* SCA registers MMIO base (physical) */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">scabase</span><span class="p">;</span>	<span class="cm">/* SCA registers MMIO base (virtual) */</span>
	<span class="n">u32</span> <span class="n">scasize</span><span class="p">;</span>		<span class="cm">/* SCA registers MMIO size */</span>
	<span class="n">u32</span> <span class="n">ramphys</span><span class="p">;</span>		<span class="cm">/* On-board RAM MMIO base (physical) */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">rambase</span><span class="p">;</span>	<span class="cm">/* On-board RAM MMIO base (virtual) */</span>
	<span class="n">u32</span> <span class="n">alloc_ramsize</span><span class="p">;</span>	<span class="cm">/* RAM MMIO size allocated by the PCI bridge */</span>
	<span class="n">u32</span> <span class="n">ramsize</span><span class="p">;</span>		<span class="cm">/* On-board RAM MMIO size */</span>
	<span class="n">u32</span> <span class="n">falcphys</span><span class="p">;</span>		<span class="cm">/* FALC registers MMIO base (physical) */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">falcbase</span><span class="p">;</span><span class="cm">/* FALC registers MMIO base (virtual) */</span>
	<span class="n">u32</span> <span class="n">falcsize</span><span class="p">;</span>		<span class="cm">/* FALC registers MMIO size */</span>
<span class="p">}</span> <span class="n">pc300hw_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300chconf</span> <span class="p">{</span>
	<span class="n">sync_serial_settings</span>	<span class="n">phys_settings</span><span class="p">;</span>	<span class="cm">/* Clock type/rate (in bps),</span>
<span class="cm">						   loopback mode */</span>
	<span class="n">raw_hdlc_proto</span>		<span class="n">proto_settings</span><span class="p">;</span>	<span class="cm">/* Encoding, parity (CRC) */</span>
	<span class="n">u32</span> <span class="n">media</span><span class="p">;</span>		<span class="cm">/* HW media (RS232, V.35, etc.) */</span>
	<span class="n">u32</span> <span class="n">proto</span><span class="p">;</span>		<span class="cm">/* Protocol (PPP, X.25, etc.) */</span>

	<span class="cm">/* TE-specific parameters */</span>
	<span class="n">u8</span> <span class="n">lcode</span><span class="p">;</span>		<span class="cm">/* Line Code (AMI, B8ZS, etc.) */</span>
	<span class="n">u8</span> <span class="n">fr_mode</span><span class="p">;</span>		<span class="cm">/* Frame Mode (ESF, D4, etc.) */</span>
	<span class="n">u8</span> <span class="n">lbo</span><span class="p">;</span>			<span class="cm">/* Line Build Out */</span>
	<span class="n">u8</span> <span class="n">rx_sens</span><span class="p">;</span>		<span class="cm">/* Rx Sensitivity (long- or short-haul) */</span>
	<span class="n">u32</span> <span class="n">tslot_bitmap</span><span class="p">;</span>	<span class="cm">/* bit[i]=1  =&gt;  timeslot _i_ is active */</span>
<span class="p">}</span> <span class="n">pc300chconf_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300ch</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pc300</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>
	<span class="n">pc300dev_t</span> <span class="n">d</span><span class="p">;</span>
	<span class="n">pc300chconf_t</span> <span class="n">conf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tx_first_bd</span><span class="p">;</span>	<span class="cm">/* First TX DMA block descr. w/ data */</span>
	<span class="n">u8</span> <span class="n">tx_next_bd</span><span class="p">;</span>	<span class="cm">/* Next free TX DMA block descriptor */</span>
	<span class="n">u8</span> <span class="n">rx_first_bd</span><span class="p">;</span>	<span class="cm">/* First free RX DMA block descriptor */</span>
	<span class="n">u8</span> <span class="n">rx_last_bd</span><span class="p">;</span>	<span class="cm">/* Last free RX DMA block descriptor */</span>
	<span class="n">u8</span> <span class="n">nfree_tx_bd</span><span class="p">;</span>	<span class="cm">/* Number of free TX DMA block descriptors */</span>
	<span class="n">falc_t</span> <span class="n">falc</span><span class="p">;</span>	<span class="cm">/* FALC structure (TE only) */</span>
<span class="p">}</span> <span class="n">pc300ch_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300</span> <span class="p">{</span>
	<span class="n">pc300hw_t</span> <span class="n">hw</span><span class="p">;</span>			<span class="cm">/* hardware config. */</span>
	<span class="n">pc300ch_t</span> <span class="n">chan</span><span class="p">[</span><span class="n">PC300_MAXCHAN</span><span class="p">];</span>
	<span class="n">spinlock_t</span> <span class="n">card_lock</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pc300conf</span> <span class="p">{</span>
	<span class="n">pc300hw_t</span> <span class="n">hw</span><span class="p">;</span>
	<span class="n">pc300chconf_t</span> <span class="n">conf</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pc300conf_t</span><span class="p">;</span>

<span class="cm">/* DEV ioctl() commands */</span>
<span class="cp">#define	N_SPPP_IOCTLS	2</span>

<span class="k">enum</span> <span class="n">pc300_ioctl_cmds</span> <span class="p">{</span>
	<span class="n">SIOCCPCRESERVED</span> <span class="o">=</span> <span class="p">(</span><span class="n">SIOCDEVPRIVATE</span> <span class="o">+</span> <span class="n">N_SPPP_IOCTLS</span><span class="p">),</span>
	<span class="n">SIOCGPC300CONF</span><span class="p">,</span>
	<span class="n">SIOCSPC300CONF</span><span class="p">,</span>
	<span class="n">SIOCGPC300STATUS</span><span class="p">,</span>
	<span class="n">SIOCGPC300FALCSTATUS</span><span class="p">,</span>
	<span class="n">SIOCGPC300UTILSTATS</span><span class="p">,</span>
	<span class="n">SIOCGPC300UTILSTATUS</span><span class="p">,</span>
	<span class="n">SIOCSPC300TRACE</span><span class="p">,</span>
	<span class="n">SIOCSPC300LOOPBACK</span><span class="p">,</span>
	<span class="n">SIOCSPC300PATTERNTEST</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Loopback types - PC300/TE boards */</span>
<span class="k">enum</span> <span class="n">pc300_loopback_cmds</span> <span class="p">{</span>
	<span class="n">PC300LOCLOOP</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PC300REMLOOP</span><span class="p">,</span>
	<span class="n">PC300PAYLOADLOOP</span><span class="p">,</span>
	<span class="n">PC300GENLOOPUP</span><span class="p">,</span>
	<span class="n">PC300GENLOOPDOWN</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Control Constant Definitions */</span>
<span class="cp">#define	PC300_RSV	0x01</span>
<span class="cp">#define	PC300_X21	0x02</span>
<span class="cp">#define	PC300_TE	0x03</span>

<span class="cp">#define	PC300_PCI	0x00</span>
<span class="cp">#define	PC300_PMC	0x01</span>

<span class="cp">#define PC300_LC_AMI	0x01</span>
<span class="cp">#define PC300_LC_B8ZS	0x02</span>
<span class="cp">#define PC300_LC_NRZ	0x03</span>
<span class="cp">#define PC300_LC_HDB3	0x04</span>

<span class="cm">/* Framing (T1) */</span>
<span class="cp">#define PC300_FR_ESF		0x01</span>
<span class="cp">#define PC300_FR_D4		0x02</span>
<span class="cp">#define PC300_FR_ESF_JAPAN	0x03</span>

<span class="cm">/* Framing (E1) */</span>
<span class="cp">#define PC300_FR_MF_CRC4	0x04</span>
<span class="cp">#define PC300_FR_MF_NON_CRC4	0x05</span>
<span class="cp">#define PC300_FR_UNFRAMED	0x06</span>

<span class="cp">#define PC300_LBO_0_DB		0x00</span>
<span class="cp">#define PC300_LBO_7_5_DB	0x01</span>
<span class="cp">#define PC300_LBO_15_DB		0x02</span>
<span class="cp">#define PC300_LBO_22_5_DB	0x03</span>

<span class="cp">#define PC300_RX_SENS_SH	0x01</span>
<span class="cp">#define PC300_RX_SENS_LH	0x02</span>

<span class="cp">#define PC300_TX_TIMEOUT	(2*HZ)</span>
<span class="cp">#define PC300_TX_QUEUE_LEN	100</span>
<span class="cp">#define	PC300_DEF_MTU		1600</span>

<span class="cm">/* Function Prototypes */</span>
<span class="kt">int</span> <span class="n">cpc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* _PC300_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
