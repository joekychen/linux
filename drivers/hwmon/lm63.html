<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › hwmon › lm63.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>lm63.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * lm63.c - driver for the National Semiconductor LM63 temperature sensor</span>
<span class="cm"> *          with integrated fan control</span>
<span class="cm"> * Copyright (C) 2004-2008  Jean Delvare &lt;khali@linux-fr.org&gt;</span>
<span class="cm"> * Based on the lm90 driver.</span>
<span class="cm"> *</span>
<span class="cm"> * The LM63 is a sensor chip made by National Semiconductor. It measures</span>
<span class="cm"> * two temperatures (its own and one external one) and the speed of one</span>
<span class="cm"> * fan, those speed it can additionally control. Complete datasheet can be</span>
<span class="cm"> * obtained from National&#39;s website at:</span>
<span class="cm"> *   http://www.national.com/pf/LM/LM63.html</span>
<span class="cm"> *</span>
<span class="cm"> * The LM63 is basically an LM86 with fan speed monitoring and control</span>
<span class="cm"> * capabilities added. It misses some of the LM86 features though:</span>
<span class="cm"> *  - No low limit for local temperature.</span>
<span class="cm"> *  - No critical limit for local temperature.</span>
<span class="cm"> *  - Critical limit for remote temperature can be changed only once. We</span>
<span class="cm"> *    will consider that the critical limit is read-only.</span>
<span class="cm"> *</span>
<span class="cm"> * The datasheet isn&#39;t very clear about what the tachometer reading is.</span>
<span class="cm"> * I had a explanation from National Semiconductor though. The two lower</span>
<span class="cm"> * bits of the read value have to be masked out. The value is still 16 bit</span>
<span class="cm"> * in width.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/jiffies.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/hwmon-sysfs.h&gt;</span>
<span class="cp">#include &lt;linux/hwmon.h&gt;</span>
<span class="cp">#include &lt;linux/err.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/sysfs.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Addresses to scan</span>
<span class="cm"> * Address is fully defined internally and cannot be changed except for</span>
<span class="cm"> * LM64 which has one pin dedicated to address selection.</span>
<span class="cm"> * LM63 and LM96163 have address 0x4c.</span>
<span class="cm"> * LM64 can have address 0x18 or 0x4e.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">normal_i2c</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="n">I2C_CLIENT_END</span> <span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The LM63 registers</span>
<span class="cm"> */</span>

<span class="cp">#define LM63_REG_CONFIG1		0x03</span>
<span class="cp">#define LM63_REG_CONVRATE		0x04</span>
<span class="cp">#define LM63_REG_CONFIG2		0xBF</span>
<span class="cp">#define LM63_REG_CONFIG_FAN		0x4A</span>

<span class="cp">#define LM63_REG_TACH_COUNT_MSB		0x47</span>
<span class="cp">#define LM63_REG_TACH_COUNT_LSB		0x46</span>
<span class="cp">#define LM63_REG_TACH_LIMIT_MSB		0x49</span>
<span class="cp">#define LM63_REG_TACH_LIMIT_LSB		0x48</span>

<span class="cp">#define LM63_REG_PWM_VALUE		0x4C</span>
<span class="cp">#define LM63_REG_PWM_FREQ		0x4D</span>
<span class="cp">#define LM63_REG_LUT_TEMP_HYST		0x4F</span>
<span class="cp">#define LM63_REG_LUT_TEMP(nr)		(0x50 + 2 * (nr))</span>
<span class="cp">#define LM63_REG_LUT_PWM(nr)		(0x51 + 2 * (nr))</span>

<span class="cp">#define LM63_REG_LOCAL_TEMP		0x00</span>
<span class="cp">#define LM63_REG_LOCAL_HIGH		0x05</span>

<span class="cp">#define LM63_REG_REMOTE_TEMP_MSB	0x01</span>
<span class="cp">#define LM63_REG_REMOTE_TEMP_LSB	0x10</span>
<span class="cp">#define LM63_REG_REMOTE_OFFSET_MSB	0x11</span>
<span class="cp">#define LM63_REG_REMOTE_OFFSET_LSB	0x12</span>
<span class="cp">#define LM63_REG_REMOTE_HIGH_MSB	0x07</span>
<span class="cp">#define LM63_REG_REMOTE_HIGH_LSB	0x13</span>
<span class="cp">#define LM63_REG_REMOTE_LOW_MSB		0x08</span>
<span class="cp">#define LM63_REG_REMOTE_LOW_LSB		0x14</span>
<span class="cp">#define LM63_REG_REMOTE_TCRIT		0x19</span>
<span class="cp">#define LM63_REG_REMOTE_TCRIT_HYST	0x21</span>

<span class="cp">#define LM63_REG_ALERT_STATUS		0x02</span>
<span class="cp">#define LM63_REG_ALERT_MASK		0x16</span>

<span class="cp">#define LM63_REG_MAN_ID			0xFE</span>
<span class="cp">#define LM63_REG_CHIP_ID		0xFF</span>

<span class="cp">#define LM96163_REG_TRUTHERM		0x30</span>
<span class="cp">#define LM96163_REG_REMOTE_TEMP_U_MSB	0x31</span>
<span class="cp">#define LM96163_REG_REMOTE_TEMP_U_LSB	0x32</span>
<span class="cp">#define LM96163_REG_CONFIG_ENHANCED	0x45</span>

<span class="cp">#define LM63_MAX_CONVRATE		9</span>

<span class="cp">#define LM63_MAX_CONVRATE_HZ		32</span>
<span class="cp">#define LM96163_MAX_CONVRATE_HZ		26</span>

<span class="cm">/*</span>
<span class="cm"> * Conversions and various macros</span>
<span class="cm"> * For tachometer counts, the LM63 uses 16-bit values.</span>
<span class="cm"> * For local temperature and high limit, remote critical limit and hysteresis</span>
<span class="cm"> * value, it uses signed 8-bit values with LSB = 1 degree Celsius.</span>
<span class="cm"> * For remote temperature, low and high limits, it uses signed 11-bit values</span>
<span class="cm"> * with LSB = 0.125 degree Celsius, left-justified in 16-bit registers.</span>
<span class="cm"> * For LM64 the actual remote diode temperature is 16 degree Celsius higher</span>
<span class="cm"> * than the register reading. Remote temperature setpoints have to be</span>
<span class="cm"> * adapted accordingly.</span>
<span class="cm"> */</span>

<span class="cp">#define FAN_FROM_REG(reg)	((reg) == 0xFFFC || (reg) == 0 ? 0 : \</span>
<span class="cp">				 5400000 / (reg))</span>
<span class="cp">#define FAN_TO_REG(val)		((val) &lt;= 82 ? 0xFFFC : \</span>
<span class="cp">				 (5400000 / (val)) &amp; 0xFFFC)</span>
<span class="cp">#define TEMP8_FROM_REG(reg)	((reg) * 1000)</span>
<span class="cp">#define TEMP8_TO_REG(val)	((val) &lt;= -128000 ? -128 : \</span>
<span class="cp">				 (val) &gt;= 127000 ? 127 : \</span>
<span class="cp">				 (val) &lt; 0 ? ((val) - 500) / 1000 : \</span>
<span class="cp">				 ((val) + 500) / 1000)</span>
<span class="cp">#define TEMP8U_TO_REG(val)	((val) &lt;= 0 ? 0 : \</span>
<span class="cp">				 (val) &gt;= 255000 ? 255 : \</span>
<span class="cp">				 ((val) + 500) / 1000)</span>
<span class="cp">#define TEMP11_FROM_REG(reg)	((reg) / 32 * 125)</span>
<span class="cp">#define TEMP11_TO_REG(val)	((val) &lt;= -128000 ? 0x8000 : \</span>
<span class="cp">				 (val) &gt;= 127875 ? 0x7FE0 : \</span>
<span class="cp">				 (val) &lt; 0 ? ((val) - 62) / 125 * 32 : \</span>
<span class="cp">				 ((val) + 62) / 125 * 32)</span>
<span class="cp">#define TEMP11U_TO_REG(val)	((val) &lt;= 0 ? 0 : \</span>
<span class="cp">				 (val) &gt;= 255875 ? 0xFFE0 : \</span>
<span class="cp">				 ((val) + 62) / 125 * 32)</span>
<span class="cp">#define HYST_TO_REG(val)	((val) &lt;= 0 ? 0 : \</span>
<span class="cp">				 (val) &gt;= 127000 ? 127 : \</span>
<span class="cp">				 ((val) + 500) / 1000)</span>

<span class="cp">#define UPDATE_INTERVAL(max, rate) \</span>
<span class="cp">			((1000 &lt;&lt; (LM63_MAX_CONVRATE - (rate))) / (max))</span>

<span class="k">enum</span> <span class="n">chips</span> <span class="p">{</span> <span class="n">lm63</span><span class="p">,</span> <span class="n">lm64</span><span class="p">,</span> <span class="n">lm96163</span> <span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Client data (each client gets its own)</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">lm63_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">hwmon_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">update_lock</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">valid</span><span class="p">;</span> <span class="cm">/* zero until following fields are valid */</span>
	<span class="kt">char</span> <span class="n">lut_valid</span><span class="p">;</span> <span class="cm">/* zero until lut fields are valid */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_updated</span><span class="p">;</span> <span class="cm">/* in jiffies */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lut_last_updated</span><span class="p">;</span> <span class="cm">/* in jiffies */</span>
	<span class="k">enum</span> <span class="n">chips</span> <span class="n">kind</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">temp2_offset</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">update_interval</span><span class="p">;</span>	<span class="cm">/* in milliseconds */</span>
	<span class="kt">int</span> <span class="n">max_convrate_hz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">lut_size</span><span class="p">;</span>		<span class="cm">/* 8 or 12 */</span>

	<span class="cm">/* registers values */</span>
	<span class="n">u8</span> <span class="n">config</span><span class="p">,</span> <span class="n">config_fan</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fan</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* 0: input</span>
<span class="cm">			   1: low limit */</span>
	<span class="n">u8</span> <span class="n">pwm1_freq</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pwm1</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>	<span class="cm">/* 0: current output</span>
<span class="cm">			   1-12: lookup table */</span>
	<span class="n">s8</span> <span class="n">temp8</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>	<span class="cm">/* 0: local input</span>
<span class="cm">			   1: local high limit</span>
<span class="cm">			   2: remote critical limit</span>
<span class="cm">			   3-14: lookup table */</span>
	<span class="n">s16</span> <span class="n">temp11</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 0: remote input</span>
<span class="cm">			   1: remote low limit</span>
<span class="cm">			   2: remote high limit</span>
<span class="cm">			   3: remote offset */</span>
	<span class="n">u16</span> <span class="n">temp11u</span><span class="p">;</span>	<span class="cm">/* remote input (unsigned) */</span>
	<span class="n">u8</span> <span class="n">temp2_crit_hyst</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">lut_temp_hyst</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">alarms</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">pwm_highres</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">lut_temp_highres</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">remote_unsigned</span><span class="p">;</span> <span class="cm">/* true if unsigned remote upper limits */</span>
	<span class="n">bool</span> <span class="n">trutherm</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">temp8_from_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">remote_unsigned</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">TEMP8_FROM_REG</span><span class="p">((</span><span class="n">u8</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">TEMP8_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">lut_temp_from_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_temp_highres</span> <span class="o">?</span> <span class="mi">500</span> <span class="o">:</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">lut_temp_to_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">val</span> <span class="o">-=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_temp_highres</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_CLOSEST</span><span class="p">(</span><span class="n">SENSORS_LIMIT</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">127500</span><span class="p">),</span> <span class="mi">500</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">DIV_ROUND_CLOSEST</span><span class="p">(</span><span class="n">SENSORS_LIMIT</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">127000</span><span class="p">),</span> <span class="mi">1000</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Update the lookup table register cache.</span>
<span class="cm"> * client-&gt;update_lock must be held when calling this function.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">lm63_update_lut</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_last_updated</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">HZ</span><span class="p">)</span> <span class="o">||</span>
	    <span class="o">!</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					    <span class="n">LM63_REG_LUT_PWM</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					     <span class="n">LM63_REG_LUT_TEMP</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_temp_hyst</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				      <span class="n">LM63_REG_LUT_TEMP_HYST</span><span class="p">);</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_last_updated</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="nf">lm63_update_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">next_update</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="n">next_update</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">last_updated</span>
	  <span class="o">+</span> <span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_interval</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">next_update</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* tachometer enabled  */</span>
			<span class="cm">/* order matters for fan1_input */</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				       <span class="n">LM63_REG_TACH_COUNT_LSB</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFC</span><span class="p">;</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM63_REG_TACH_COUNT_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM63_REG_TACH_LIMIT_LSB</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFC</span><span class="p">)</span>
				     <span class="o">|</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM63_REG_TACH_LIMIT_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_PWM_FREQ</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				<span class="n">LM63_REG_PWM_VALUE</span><span class="p">);</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				 <span class="n">LM63_REG_LOCAL_TEMP</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				 <span class="n">LM63_REG_LOCAL_HIGH</span><span class="p">);</span>

		<span class="cm">/* order matters for temp2_input */</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_TEMP_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				   <span class="n">LM63_REG_REMOTE_TEMP_LSB</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_LOW_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_LOW_LSB</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_HIGH_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_HIGH_LSB</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_OFFSET_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
				<span class="o">|</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				  <span class="n">LM63_REG_REMOTE_OFFSET_LSB</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span><span class="p">)</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11u</span> <span class="o">=</span> <span class="p">(</span><span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM96163_REG_REMOTE_TEMP_U_MSB</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
				      <span class="o">|</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM96163_REG_REMOTE_TEMP_U_LSB</span><span class="p">);</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
				 <span class="n">LM63_REG_REMOTE_TCRIT</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_crit_hyst</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					<span class="n">LM63_REG_REMOTE_TCRIT_HYST</span><span class="p">);</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">alarms</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
			       <span class="n">LM63_REG_ALERT_STATUS</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">;</span>

		<span class="n">data</span><span class="o">-&gt;</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">lm63_update_lut</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Trip points in the lookup table should be in ascending order for both</span>
<span class="cm"> * temperatures and PWM output values.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lm63_lut_looks_bad</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">lm63_update_lut</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span>
		 <span class="o">||</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">dev_warn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				 <span class="s">&quot;Lookup table doesn&#39;t look sane (check entries %d and %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">i</span> <span class="o">==</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_size</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Sysfs callback functions and files</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_fan</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">FAN_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">]));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_fan</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span>
		       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">FAN_TO_REG</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_TACH_LIMIT_LSB</span><span class="p">,</span>
				  <span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_TACH_LIMIT_MSB</span><span class="p">,</span>
				  <span class="n">data</span><span class="o">-&gt;</span><span class="n">fan</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_pwm1</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			 <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pwm</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm_highres</span><span class="p">)</span>
		<span class="n">pwm</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="n">nr</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="n">pwm</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">?</span>
		       <span class="mi">255</span> <span class="o">:</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">*</span> <span class="mi">255</span> <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span><span class="p">)</span> <span class="o">/</span>
		       <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">pwm</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_pwm1</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">))</span> <span class="cm">/* register is read-only */</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">nr</span> <span class="o">?</span> <span class="n">LM63_REG_LUT_PWM</span><span class="p">(</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">LM63_REG_PWM_VALUE</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">SENSORS_LIMIT</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm_highres</span> <span class="o">?</span> <span class="n">val</span> <span class="o">:</span>
			<span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">127</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">;</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_pwm1_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x20</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_pwm1_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span>
			       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Only let the user switch to automatic mode if the lookup table</span>
<span class="cm">	 * looks sane.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">lm63_lut_looks_bad</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
						    <span class="n">LM63_REG_CONFIG_FAN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">|=</span> <span class="mh">0x20</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x20</span><span class="p">;</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONFIG_FAN</span><span class="p">,</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * There are 8bit registers for both local(temp1) and remote(temp2) sensor.</span>
<span class="cm"> * For remote sensor registers temp2_offset has to be considered,</span>
<span class="cm"> * for local sensor it must not.</span>
<span class="cm"> * So we need separate 8bit accessors for local and remote sensor.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_local_temp8</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
				<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TEMP8_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">]));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_remote_temp8</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
				 <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">temp8_from_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span>
		       <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_lut_temp</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			      <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lut_temp_from_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span>
		       <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_temp8</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			 <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtol</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">nr</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">reg</span> <span class="o">=</span> <span class="n">LM63_REG_REMOTE_TCRIT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">remote_unsigned</span><span class="p">)</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP8U_TO_REG</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP8_TO_REG</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">reg</span> <span class="o">=</span> <span class="n">LM63_REG_LOCAL_HIGH</span><span class="p">;</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP8_TO_REG</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>	<span class="cm">/* lookup table */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">LM63_REG_LUT_TEMP</span><span class="p">(</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">lut_temp_to_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp8</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_temp11</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			   <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">temp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">nr</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Use unsigned temperature unless its value is zero.</span>
<span class="cm">		 * If it is zero, use signed temperature.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11u</span><span class="p">)</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP11_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11u</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP11_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">remote_unsigned</span> <span class="o">&amp;&amp;</span> <span class="n">nr</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP11_FROM_REG</span><span class="p">((</span><span class="n">u16</span><span class="p">)</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
		<span class="k">else</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">TEMP11_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">temp</span> <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_temp11</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">LM63_REG_REMOTE_LOW_MSB</span><span class="p">,</span>
		<span class="n">LM63_REG_REMOTE_LOW_LSB</span><span class="p">,</span>
		<span class="n">LM63_REG_REMOTE_HIGH_MSB</span><span class="p">,</span>
		<span class="n">LM63_REG_REMOTE_HIGH_LSB</span><span class="p">,</span>
		<span class="n">LM63_REG_REMOTE_OFFSET_MSB</span><span class="p">,</span>
		<span class="n">LM63_REG_REMOTE_OFFSET_LSB</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtol</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">remote_unsigned</span> <span class="o">&amp;&amp;</span> <span class="n">nr</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEMP11U_TO_REG</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">=</span> <span class="n">TEMP11_TO_REG</span><span class="p">(</span><span class="n">val</span> <span class="o">-</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span><span class="p">);</span>

	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reg</span><span class="p">[(</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">],</span>
				  <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reg</span><span class="p">[(</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
				  <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp11</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Hysteresis register holds a relative value, while we want to present</span>
<span class="cm"> * an absolute to user-space</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_temp2_crit_hyst</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">temp8_from_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
		       <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span>
		       <span class="o">-</span> <span class="n">TEMP8_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_crit_hyst</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_lut_temp_hyst</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lut_temp_from_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span>
		       <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span>
		       <span class="o">-</span> <span class="n">TEMP8_FROM_REG</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_temp_hyst</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * And now the other way around, user-space provides an absolute</span>
<span class="cm"> * hysteresis value and we have to store a relative one</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_temp2_crit_hyst</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span>
				   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">hyst</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtol</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">hyst</span> <span class="o">=</span> <span class="n">temp8_from_reg</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span> <span class="o">-</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_REMOTE_TCRIT_HYST</span><span class="p">,</span>
				  <span class="n">HYST_TO_REG</span><span class="p">(</span><span class="n">hyst</span><span class="p">));</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Set conversion rate.</span>
<span class="cm"> * client-&gt;update_lock must be held when calling this function.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">lm63_set_convrate</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span> <span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">interval</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">update_interval</span><span class="p">;</span>

	<span class="cm">/* Shift calculations to avoid rounding errors */</span>
	<span class="n">interval</span> <span class="o">&lt;&lt;=</span> <span class="mi">6</span><span class="p">;</span>

	<span class="cm">/* find the nearest update rate */</span>
	<span class="n">update_interval</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">LM63_MAX_CONVRATE</span> <span class="o">+</span> <span class="mi">6</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>
	  <span class="o">/</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">max_convrate_hz</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">LM63_MAX_CONVRATE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">update_interval</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">interval</span> <span class="o">&gt;=</span> <span class="n">update_interval</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONVRATE</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">update_interval</span> <span class="o">=</span> <span class="n">UPDATE_INTERVAL</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">max_convrate_hz</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_update_interval</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">update_interval</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_update_interval</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
				   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">kstrtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">lm63_set_convrate</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">SENSORS_LIMIT</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100000</span><span class="p">));</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
			 <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">trutherm</span> <span class="o">?</span> <span class="s">&quot;1</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">:</span> <span class="s">&quot;2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">set_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">kstrtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">val</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">trutherm</span> <span class="o">=</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM96163_REG_TRUTHERM</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x02</span><span class="p">;</span>
	<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM96163_REG_TRUTHERM</span><span class="p">,</span>
				  <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">trutherm</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">));</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_alarms</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">dummy</span><span class="p">,</span>
			   <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">alarms</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">show_alarm</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">devattr</span><span class="p">,</span>
			  <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sensor_device_attribute</span> <span class="o">*</span><span class="n">attr</span> <span class="o">=</span> <span class="n">to_sensor_dev_attr</span><span class="p">(</span><span class="n">devattr</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">lm63_update_device</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">bitnr</span> <span class="o">=</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">alarms</span> <span class="o">&gt;&gt;</span> <span class="n">bitnr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">fan1_input</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_fan</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">fan1_min</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_fan</span><span class="p">,</span>
	<span class="n">set_fan</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_enable</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1_enable</span><span class="p">,</span> <span class="n">set_pwm1_enable</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point1_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point1_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point1_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point2_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point2_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point2_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point3_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point3_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point3_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point4_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point4_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point4_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point5_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point5_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point5_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point6_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point6_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point6_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point7_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point7_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point7_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point8_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point8_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point8_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point9_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point9_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point9_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point10_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point10_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point10_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point11_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point11_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point11_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">13</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point12_pwm</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_pwm1</span><span class="p">,</span> <span class="n">set_pwm1</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point12_temp</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp</span><span class="p">,</span> <span class="n">set_temp8</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">pwm1_auto_point12_temp_hyst</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span>
	<span class="n">show_lut_temp_hyst</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">14</span><span class="p">);</span>

<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp1_input</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_local_temp8</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp1_max</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_local_temp8</span><span class="p">,</span>
	<span class="n">set_temp8</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_input</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_temp11</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_min</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_temp11</span><span class="p">,</span>
	<span class="n">set_temp11</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_max</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_temp11</span><span class="p">,</span>
	<span class="n">set_temp11</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_offset</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_temp11</span><span class="p">,</span>
	<span class="n">set_temp11</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_crit</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_remote_temp8</span><span class="p">,</span>
	<span class="n">set_temp8</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">static</span> <span class="n">DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_crit_hyst</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_temp2_crit_hyst</span><span class="p">,</span>
	<span class="n">set_temp2_crit_hyst</span><span class="p">);</span>

<span class="k">static</span> <span class="n">DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_type</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_type</span><span class="p">,</span> <span class="n">set_type</span><span class="p">);</span>

<span class="cm">/* Individual alarm files */</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">fan1_min_alarm</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_crit_alarm</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_fault</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_min_alarm</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp2_max_alarm</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">static</span> <span class="n">SENSOR_DEVICE_ATTR</span><span class="p">(</span><span class="n">temp1_max_alarm</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarm</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="cm">/* Raw alarm file for compatibility */</span>
<span class="k">static</span> <span class="n">DEVICE_ATTR</span><span class="p">(</span><span class="n">alarms</span><span class="p">,</span> <span class="n">S_IRUGO</span><span class="p">,</span> <span class="n">show_alarms</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

<span class="k">static</span> <span class="n">DEVICE_ATTR</span><span class="p">(</span><span class="n">update_interval</span><span class="p">,</span> <span class="n">S_IRUGO</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="n">show_update_interval</span><span class="p">,</span>
		   <span class="n">set_update_interval</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">attribute</span> <span class="o">*</span><span class="n">lm63_attributes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dev_attr_pwm1_enable</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point1_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point1_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point1_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point2_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point2_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point2_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point3_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point3_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point3_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point4_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point4_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point4_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point5_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point5_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point5_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point6_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point6_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point6_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point7_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point7_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point7_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point8_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point8_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point8_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>

	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp1_input</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_input</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_min</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp1_max</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_max</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_offset</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_crit</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dev_attr_temp2_crit_hyst</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>

	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_crit_alarm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_fault</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_min_alarm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_max_alarm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_temp1_max_alarm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dev_attr_alarms</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">dev_attr_update_interval</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">attribute</span> <span class="o">*</span><span class="n">lm63_attributes_extra_lut</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point9_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point9_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point9_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point10_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point10_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point10_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point11_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point11_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point11_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point12_pwm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point12_temp</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_pwm1_auto_point12_temp_hyst</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">attribute_group</span> <span class="n">lm63_group_extra_lut</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">lm63_attributes_extra_lut</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * On LM63, temp2_crit can be set only once, which should be job</span>
<span class="cm"> * of the bootloader.</span>
<span class="cm"> * On LM64, temp2_crit can always be set.</span>
<span class="cm"> * On LM96163, temp2_crit can be set if bit 1 of the configuration</span>
<span class="cm"> * register is true.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">umode_t</span> <span class="nf">lm63_attribute_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">kobject</span> <span class="o">*</span><span class="n">kobj</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">kobj</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device</span><span class="p">,</span> <span class="n">kobj</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">sensor_dev_attr_temp2_crit</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span>
	    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm64</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">))))</span>
		<span class="k">return</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">attr</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">attribute_group</span> <span class="n">lm63_group</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">is_visible</span> <span class="o">=</span> <span class="n">lm63_attribute_mode</span><span class="p">,</span>
	<span class="p">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">lm63_attributes</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">attribute</span> <span class="o">*</span><span class="n">lm63_attributes_fan1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_fan1_input</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">sensor_dev_attr_fan1_min</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>

	<span class="o">&amp;</span><span class="n">sensor_dev_attr_fan1_min_alarm</span><span class="p">.</span><span class="n">dev_attr</span><span class="p">.</span><span class="n">attr</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">attribute_group</span> <span class="n">lm63_group_fan1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">lm63_attributes_fan1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Real code</span>
<span class="cm"> */</span>

<span class="cm">/* Return 0 if detection is successful, -ENODEV otherwise */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lm63_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">client</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">man_id</span><span class="p">,</span> <span class="n">chip_id</span><span class="p">,</span> <span class="n">reg_config1</span><span class="p">,</span> <span class="n">reg_config2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_alert_status</span><span class="p">,</span> <span class="n">reg_alert_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">address</span> <span class="o">=</span> <span class="n">client</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">i2c_check_functionality</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">I2C_FUNC_SMBUS_BYTE_DATA</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">man_id</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_MAN_ID</span><span class="p">);</span>
	<span class="n">chip_id</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CHIP_ID</span><span class="p">);</span>

	<span class="n">reg_config1</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONFIG1</span><span class="p">);</span>
	<span class="n">reg_config2</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONFIG2</span><span class="p">);</span>
	<span class="n">reg_alert_status</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
			   <span class="n">LM63_REG_ALERT_STATUS</span><span class="p">);</span>
	<span class="n">reg_alert_mask</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_ALERT_MASK</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">man_id</span> <span class="o">!=</span> <span class="mh">0x01</span> <span class="cm">/* National Semiconductor */</span>
	 <span class="o">||</span> <span class="p">(</span><span class="n">reg_config1</span> <span class="o">&amp;</span> <span class="mh">0x18</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x00</span>
	 <span class="o">||</span> <span class="p">(</span><span class="n">reg_config2</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x00</span>
	 <span class="o">||</span> <span class="p">(</span><span class="n">reg_alert_status</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x00</span>
	 <span class="o">||</span> <span class="p">(</span><span class="n">reg_alert_mask</span> <span class="o">&amp;</span> <span class="mh">0xA4</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0xA4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;Unsupported chip (man_id=0x%02X, chip_id=0x%02X)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">man_id</span><span class="p">,</span> <span class="n">chip_id</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">chip_id</span> <span class="o">==</span> <span class="mh">0x41</span> <span class="o">&amp;&amp;</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x4c</span><span class="p">)</span>
		<span class="n">strlcpy</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;lm63&quot;</span><span class="p">,</span> <span class="n">I2C_NAME_SIZE</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">chip_id</span> <span class="o">==</span> <span class="mh">0x51</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">address</span> <span class="o">==</span> <span class="mh">0x18</span> <span class="o">||</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x4e</span><span class="p">))</span>
		<span class="n">strlcpy</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;lm64&quot;</span><span class="p">,</span> <span class="n">I2C_NAME_SIZE</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">chip_id</span> <span class="o">==</span> <span class="mh">0x49</span> <span class="o">&amp;&amp;</span> <span class="n">address</span> <span class="o">==</span> <span class="mh">0x4c</span><span class="p">)</span>
		<span class="n">strlcpy</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span> <span class="s">&quot;lm96163&quot;</span><span class="p">,</span> <span class="n">I2C_NAME_SIZE</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Ideally we shouldn&#39;t have to initialize anything, since the BIOS</span>
<span class="cm"> * should have taken care of everything</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">lm63_init_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">convrate</span><span class="p">;</span>

	<span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONFIG1</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
						    <span class="n">LM63_REG_CONFIG_FAN</span><span class="p">);</span>

	<span class="cm">/* Start converting if needed */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* standby */</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Switching to operational mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;=</span> <span class="mh">0xA7</span><span class="p">;</span>
		<span class="n">i2c_smbus_write_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONFIG1</span><span class="p">,</span>
					  <span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* Tachometer is always enabled on LM64 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm64</span><span class="p">)</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>

	<span class="cm">/* We may need pwm1_freq before ever updating the client data */</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_PWM_FREQ</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">lm63</span>:
	<span class="k">case</span> <span class="n">lm64</span>:
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">max_convrate_hz</span> <span class="o">=</span> <span class="n">LM63_MAX_CONVRATE_HZ</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">lm96163</span>:
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">max_convrate_hz</span> <span class="o">=</span> <span class="n">LM96163_MAX_CONVRATE_HZ</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">trutherm</span>
		  <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					     <span class="n">LM96163_REG_TRUTHERM</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">convrate</span> <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">LM63_REG_CONVRATE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">convrate</span> <span class="o">&gt;</span> <span class="n">LM63_MAX_CONVRATE</span><span class="p">))</span>
		<span class="n">convrate</span> <span class="o">=</span> <span class="n">LM63_MAX_CONVRATE</span><span class="p">;</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">update_interval</span> <span class="o">=</span> <span class="n">UPDATE_INTERVAL</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">max_convrate_hz</span><span class="p">,</span>
						<span class="n">convrate</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * For LM96163, check if high resolution PWM</span>
<span class="cm">	 * and unsigned temperature format is enabled.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">config_enhanced</span>
		  <span class="o">=</span> <span class="n">i2c_smbus_read_byte_data</span><span class="p">(</span><span class="n">client</span><span class="p">,</span>
					     <span class="n">LM96163_REG_CONFIG_ENHANCED</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">config_enhanced</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">lut_temp_highres</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">config_enhanced</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span>
		    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm_highres</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">config_enhanced</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">remote_unsigned</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Show some debug info about the LM63 configuration */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm63</span><span class="p">)</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Alert/tach pin configured for %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;tachometer input&quot;</span> <span class="o">:</span>
			<span class="s">&quot;alert output&quot;</span><span class="p">);</span>
	<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;PWM clock %s kHz, output frequency %u Hz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;1.4&quot;</span> <span class="o">:</span> <span class="s">&quot;360&quot;</span><span class="p">,</span>
		<span class="p">((</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">?</span> <span class="mi">700</span> <span class="o">:</span> <span class="mi">180000</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">pwm1_freq</span><span class="p">);</span>
	<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;PWM output active %s, %s mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;low&quot;</span> <span class="o">:</span> <span class="s">&quot;high&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config_fan</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;manual&quot;</span> <span class="o">:</span> <span class="s">&quot;auto&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lm63_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
		      <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">lm63_data</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">exit</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">i2c_set_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">update_lock</span><span class="p">);</span>

	<span class="cm">/* Set the device type */</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_data</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm64</span><span class="p">)</span>
		<span class="n">data</span><span class="o">-&gt;</span><span class="n">temp2_offset</span> <span class="o">=</span> <span class="mi">16000</span><span class="p">;</span>

	<span class="cm">/* Initialize chip */</span>
	<span class="n">lm63_init_client</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="cm">/* Register sysfs hooks */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">sysfs_create_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">exit_free</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* tachometer enabled */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">sysfs_create_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group_fan1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">exit_remove_files</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">device_create_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_attr_temp2_type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">exit_remove_files</span><span class="p">;</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">sysfs_create_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">lm63_group_extra_lut</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">exit_remove_files</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">data</span><span class="o">-&gt;</span><span class="n">hwmon_dev</span> <span class="o">=</span> <span class="n">hwmon_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">hwmon_dev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">PTR_ERR</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">hwmon_dev</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">exit_remove_files</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">exit_remove_files:</span>
	<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group</span><span class="p">);</span>
	<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group_fan1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">device_remove_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_attr_temp2_type</span><span class="p">);</span>
		<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group_extra_lut</span><span class="p">);</span>
	<span class="p">}</span>
<span class="nl">exit_free:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="nl">exit:</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lm63_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lm63_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>

	<span class="n">hwmon_device_unregister</span><span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">hwmon_dev</span><span class="p">);</span>
	<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group</span><span class="p">);</span>
	<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group_fan1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">kind</span> <span class="o">==</span> <span class="n">lm96163</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">device_remove_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_attr_temp2_type</span><span class="p">);</span>
		<span class="n">sysfs_remove_group</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">kobj</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lm63_group_extra_lut</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Driver data (common to all clients)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="n">lm63_id</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;lm63&quot;</span><span class="p">,</span> <span class="n">lm63</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;lm64&quot;</span><span class="p">,</span> <span class="n">lm64</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;lm96163&quot;</span><span class="p">,</span> <span class="n">lm96163</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">lm63_id</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_driver</span> <span class="n">lm63_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">class</span>		<span class="o">=</span> <span class="n">I2C_CLASS_HWMON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;lm63&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">lm63_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">lm63_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span>	<span class="o">=</span> <span class="n">lm63_id</span><span class="p">,</span>
	<span class="p">.</span><span class="n">detect</span>		<span class="o">=</span> <span class="n">lm63_detect</span><span class="p">,</span>
	<span class="p">.</span><span class="n">address_list</span>	<span class="o">=</span> <span class="n">normal_i2c</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_i2c_driver</span><span class="p">(</span><span class="n">lm63_driver</span><span class="p">);</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Jean Delvare &lt;khali@linux-fr.org&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;LM63 driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
