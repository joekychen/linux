f | cs5535-clockevt.c | s | 5.9K | 161 | Jens Rottmann | JRottmann@LiPPERTEmbedded.de | 1331039865 |  | cs5535-clockevt: Allow the MFGPT IRQ to be shared  Shared timer IRQs are not a good solution, however the Geode platform has no APIC, IRQs are a scarce resource and there is no technical reason to forbid it rightaway.  Increased latencies and overhead due to sharing are still better than a driver refusing to load.  Signed-off-by: Jens Rottmann <JRottmann@LiPPERTEmbedded.de> Acked-by: Andres Salomon <dilinger@queued.net> Cc: John Stultz <john.stultz@linaro.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | Makefile | g | 570B |  | Magnus Damm | magnus.damm@gmail.com | 1337938326 |  | clocksource: em_sti: Emma Mobile STI driver  The STI hardware is based on a single 48-bit 32kHz counter that together with two individual compare registers can generate interrupts. There are no timer operating modes selectable which means that the timer can not clear on match.  This driver is providing clocksource support for the 48-bit counter. Clockevents are also supported using the same timer in oneshot mode.  Signed-off-by: Magnus Damm <damm@opensource.se> Cc: horms@verge.net.au Cc: arnd@arndb.de Cc: johnstul@us.ibm.com Cc: rjw@sisk.pl Cc: lethal@linux-sh.org Cc: gregkh@linuxfoundation.org Cc: olof@lixom.net Link: http://lkml.kernel.org/r/20120525070344.23443.69756.sendpatchset@w520 Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | scx200_hrt.c | s | 2.8K | 76 | Ingo Molnar | mingo@elte.hu | 1329913516 |  | clocksource: scx200_hrt: Fix the build  This commit:    12d6d41276de: clocksource: scx200_hrt: Convert scx200 to use clocksource_register_hz  Breaks the build on x86-32:    drivers/clocksource/scx200_hrt.c: In function ‘init_hrt_clocksource’:   drivers/clocksource/scx200_hrt.c:95:0: error: unterminated argument list invoking macro "pr_info"   drivers/clocksource/scx200_hrt.c:84:2: error: ‘pr_info’ undeclared (first use in this function)  It could not possibly have been build tested, because it had this mismerge:  	pr_info("enabling scx200 high-res timer (%s MHz +%d ppm)\n", 	printk(KERN_INFO "enabling scx200 high-res timer (%s MHz +%d ppm)\n", 		mhz27 ? "27":"1", ppm);  Cc: Jim Cromie <jim.cromie@gmail.com> Cc: John Stultz <john.stultz@linaro.org> Link: http://lkml.kernel.org/n/tip-jceb26fns5w7tv8edlivhxpa@git.kernel.org Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | mmio.c | s | 1.9K | 62 | Russell King | rmk+kernel@arm.linux.org.uk | 1306170291 |  | clocksource: add common mmio clocksource  Add a generic mmio clocksource, covering both 32-bit and 16-bit register access sizes, for up or down counters.  This can be used to easily create clocksources for simple counter-based implementations.  Cc: Alessandro Rubini <rubini@unipv.it> Cc: Colin Cross <ccross@android.com> Cc: Eric Miao <eric.y.miao@gmail.com> Cc: Erik Gilling <konkers@android.com> Acked-by: "Hans J. Koch" <hjk@hansjkoch.de> Cc: Imre Kaloz <kaloz@openwrt.org> Cc: Krzysztof Halasa <khc@pm.waw.pl> Cc: Kukjin Kim <kgene.kim@samsung.com> Cc: Lennert Buytenhek <kernel@wantstofly.org> Cc: Linus Walleij <linus.walleij@stericsson.com> Cc: linux-omap@vger.kernel.org Acked-by: Nicolas Pitre <nico@fluxnic.net> Cc: Olof Johansson <olof@lixom.net> Tested-by: Sascha Hauer <s.hauer@pengutronix.de> Reviewed-by: Thomas Gleixner <tglx@linutronix.de> Tested-by: Tony Lindgren <tony@atomide.com> Reviewed-by: Viresh Kumar <viresh.kumar@st.com> Cc: Wan ZongShun <mcuos.com@gmail.com> Signed-off-by: Russell King <rmk+kernel@arm.linux.org.uk>
f | acpi_pm.c | s | 6.5K | 218 | Thomas Gleixner | tglx@linutronix.de | 1334181905 |  | Revert "clocksource: Load the ACPI PM clocksource asynchronously"  This reverts commit b519508298e0292e1771eecf14aaf67755adc39d.  The reason for this revert is that making the frequency verification preemptible and interruptible is not working reliably. Michaels machine failed to use PM-timer with the message:    PM-Timer running at invalid rate: 113% of normal - aborting.  That's not a surprise as the frequency verification does rely on interrupts being disabled. With a async scheduled thread there is no guarantee to achieve the same result. Also some driver might fiddle with the CTC channel 2 during the verification period, which makes the result even more random and unpredictable.  This can be solved by using the same mechanism as we use in the deferred TSC validation code, but that only will work if we verified a working HPET _BEFORE_ trying to do the PM-Timer lazy validation.  So for now reverting is the safe option.  Bisected-by: Michael Witten <mfwitten@gmail.com> Cc: Arjan van de Ven <arjanvandeven@gmail.com> Cc: Arjan van de Ven <arjan@infradead.org> Cc: John Stultz <johnstul@us.ibm.com> Cc: Len Brown <lenb@kernel.org> LKML-Reference: <alpine.LFD.2.02.1204112303270.2542@ionos> Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | tcb_clksrc.c | s | 9.4K | 276 | Nicolas Ferre | nicolas.ferre@atmel.com | 1330605529 |  | ARM: at91/tc/clocksource: Add 32 bit variant to Timer Counter  Some SoC have a 32 bit variant of Timer Counter Blocks. We do not need the chaining of two 16 bit counters anymore for them.  The SoC nature is deduced from the device tree "compatible" string. For non-device-tree configurations, backward compatibility is maintained by using the default 16 bit counter configuration.  This patch addresses both the atmel_tclib and its user: tcb_clksrc clocksource.  Signed-off-by: Nicolas Ferre <nicolas.ferre@atmel.com> Acked-by: Jean-Christophe PLAGNIOL-VILLARD <plagnioj@jcrosoft.com> Acked-by: Grant Likely <grant.likely@secretlab.ca>
f | i8253.c | s | 4.8K | 165 | Deepak Saxena | dsaxena@linaro.org | 1321930859 |  | time: x86: Replace LATCH with PIT_LATCH in i8253 clocksource driver  The i8253 clockevent & clocksource driver uses PIT_LATCH except for two cases where it uses LATCH:  1) 	/* VIA686a test code... reset the latch if count > max + 1 */ 	if (count > LATCH) {  LATCH is based on CLOCK_TICK_RATE which is defined as PIT_TICK_RATE on x86 so this should just be the later.  2) 	... 	switch (mode) { 	case CLOCK_EVT_MODE_PERIODIC: 		/* binary, mode 2, LSB/MSB, ch 0 */ 		outb_p(0x34, PIT_MODE); 		outb_p(LATCH & 0xff , PIT_CH0);	/* LSB */ 		outb_p(LATCH >> 8 , PIT_CH0);		/* MSB */ 	...  MIPS and ARM are the only other arches that use this driver. In the MIPS case CLOCK_TICK_RATE is defined as the same value as PIT_TICK_RATE. For ARM, the only machine that uses it is Footbridge which has a totally bogus CLOCK_TICK_RATE according to the comments. Furthermore, the clockevent_i8253_init() initializes the clockevent with PIT_TIC_RATE, so there's no reason to use the generic LATCH.  This is part of work to remove and depecrate the global CLOCK_TICK_RATE symbol.  Signed-off-by: Deepak Saxena <dsaxena@linaro.org> Signed-off-by: John Stultz <john.stultz@linaro.org>
f | dw_apb_timer.c | s | 11K | 348 | Jamie Iles | jamie@jamieiles.com | 1317758898 |  | dw_apb_timer: constify clocksource name  The clocksource name should be const for correctness.  Cc: John Stultz <johnstul@us.ibm.com> Signed-off-by: Jamie Iles <jamie@jamieiles.com> Signed-off-by: John Stultz <john.stultz@linaro.org>
f | Kconfig | g | 575B |  | Linus Walleij | linus.walleij@linaro.org | 1335911983 |  | ARM: ux500: delete U5500 support  This platform has been obsoleted and was only available inside of ST-Ericsson, no users of this code are left in the world. This deletes the core U5500 support entirely in the same manner as the obsoleted U8500 silicon was previously deleted.  The cpu_is_u5500() macros that can read out the CPU ID is left until the next kernel cycle, this makes it possible to merge deletion of dependent drivers without breakage.  This also has the upside of removing the mailbox driver which was our only driver that was outside the drivers/* hiearchy, now the machine directory only handles machines and nothing else.  Cc: Srinidhi Kasagar <srinidhi.kasagar@stericsson.com> Cc: Rabin Vincent <rabin.vincent@stericsson.com> Cc: Jonas Aberg <jonas.aberg@stericsson.com> Cc: Per Forlin <per.forlin@stericsson.com> Cc: Ulf Hansson <ulf.hansson@stericsson.com> Signed-off-by: Linus Walleij <linus.walleij@linaro.org>
f | sh_cmt.c | s | 17K | 609 | Paul Mundt | lethal@linux-sh.org | 1339398098 |  | clocksource: sh_cmt: Convert timer lock to raw spinlock.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | sh_mtu2.c | s | 8.3K | 300 | Paul Mundt | lethal@linux-sh.org | 1339398102 |  | clocksource: sh_mtu2: Convert timer lock to raw spinlock.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | cyclone.c | s | 2.9K | 95 | Julia Lawall | Julia.Lawall@lip6.fr | 1327635040 |  | clocksource: cyclone: Add missing iounmap  Add missing iounmap in error handling code, in a case where the function already preforms iounmap on some other execution path.  A simplified version of the semantic match that finds this problem is as follows: (http://coccinelle.lip6.fr/)  // <smpl> @@ expression e; statement S,S1; int ret; @@ e = \(ioremap\||ioremap_nocache\)(...) ... when != iounmap(e) if (<+...e...+>) S ... when any     when != iounmap(e) *if (...)    { ... when != iounmap(e)      return ...; } ... when any iounmap(e); // </smpl>  Signed-off-by: Julia Lawall <Julia.Lawall@lip6.fr> [fixed up subject -jstultz] Signed-off-by: John Stultz <john.stultz@linaro.org>
f | em_sti.c | s | 9.5K | 335 | Magnus Damm | magnus.damm@gmail.com | 1337938326 |  | clocksource: em_sti: Add DT support  Update the em-sti driver to support DT.  Signed-off-by: Magnus Damm <damm@opensource.se> Cc: arnd@arndb.de Cc: horms@verge.net.au Cc: johnstul@us.ibm.com Cc: rjw@sisk.pl Cc: lethal@linux-sh.org Cc: gregkh@linuxfoundation.org Cc: olof@lixom.net Link: http://lkml.kernel.org/r/20120509143950.27521.7949.sendpatchset@w520 Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
f | sh_tmu.c | s | 10K | 376 | Paul Mundt | lethal@linux-sh.org | 1339402216 |  | clocksource: sh_tmu: Use clockevents_config_and_register().  This switches over to the now exported clockevents_config() and clockevents_config_and_register() helpers. This knocks off a long-standing TMU TODO item.  Signed-off-by: Paul Mundt <lethal@linux-sh.org>
f | clksrc-dbx500-prcmu.c | s | 2.4K | 76 | Yong Zhang | yong.zhang0@gmail.com | 1328150257 |  | clocksource: dbx500: convert to clocksource_register_hz()  Convert clocksource_dbx500_prcmu to use clocksource_register_hz.  Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Mattias Wallin <mattias.wallin@stericsson.com> Acked-by: Linus Walleij <linus.walleij@linaro.org> Signed-off-by: Yong Zhang <yong.zhang0@gmail.com> Signed-off-by: John Stultz <john.stultz@linaro.org>
