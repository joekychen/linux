f | device.c | s | 20K | 659 | Bart Van Assche | bvanassche@acm.org | 1311032670 |  | RDMA: Allow for NULL .modify_device() and .modify_port() methods  These methods don't make sense for iWARP devices, so rather than forcing them to implement stubs, just return -ENOSYS in the core if the hardware driver doesn't set .modify_device and/or .modify_port.  Signed-off-by: Roland Dreier <roland@purestorage.com>
f | mad_rmpp.c | s | 26K | 804 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | Makefile | g | 800B |  | Roland Dreier | roland@purestorage.com | 1305917171 |  | RDMA: Add netlink infrastructure  Add basic RDMA netlink infrastructure that allows for registration of RDMA clients for which data is to be exported and supplies message construction callbacks.  Signed-off-by: Nir Muchtar <nirm@voltaire.com>  [ Reorganize a few things, add CONFIG_NET dependency.  - Roland ]  Signed-off-by: Roland Dreier <roland@purestorage.com>
f | mad_rmpp.h | s | 2.1K | 49 | Roland Dreier | rolandd@cisco.com | 1216104524 |  | RDMA: Remove subversion $Id tags  They don't get updated by git and so they're worse than useless.  Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | ucm.c | s | 33K | 1143 | Sean Hefty | sean.hefty@intel.com | 1325697465 |  | rdma/core: Fix sparse warnings  Clean up sparse warnings in the rdma core layer.  Signed-off-by: Sean Hefty <sean.hefty@intel.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | sa_query.c | s | 29K | 969 | Tejun Heo | tj@kernel.org | 1296261548 |  | RDMA: Update missed conversion of flush_scheduled_work()  Commit f06267104dd9 ("RDMA: Update workqueue usage") introduced ib_wq and removed the use of flush_scheduled_work(); however, during the merge process one chunk was lost in ib_sa_remove_one().  Fix it.  Signed-off-by: Tejun Heo <tj@kernel.org> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | uverbs_marshall.c | s | 5.2K | 134 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103895 |  | infiniband: add in export.h for files using EXPORT_SYMBOL/THIS_MODULE  These were getting it implicitly via device.h --> module.h but we are going to stop that when we clean up the headers.  Fix these in advance so the tree remains biscect-clean.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | smi.c | s | 7.5K | 216 | Roland Dreier | rolandd@cisco.com | 1252207450 |  | IB/mad: Check hop count field in directed route MAD to avoid array overflow  The hop count field in a directed route MAD is only allowed to be in the range 0 to 63 (by spec).  Check that this really is the case to avoid accessing outside the bounds of the hop array.  Reported-by: Roel Kluin <roel.kluin@gmail.com> Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | uverbs_main.c | s | 24K | 741 | Al Viro | viro@zeniv.linux.org.uk | 1325649295 |  | switch device_get_devnode() and ->devnode() to umode_t *  both callers of device_get_devnode() are only interested in lower 16bits and nobody tries to return anything wider than 16bit anyway.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | iwcm.c | s | 28K | 919 | Steve Wise | swise@opengridcomputing.com | 1331162093 |  | RDMA/iwcm: Reject connect requests if cmid is not in LISTEN state  When destroying a listening cmid, the iwcm first marks the state of the cmid as DESTROYING, then releases the lock and calls into the iWARP provider to destroy the endpoint.  Since the cmid is not locked, its possible for the iWARP provider to pass a connection request event to the iwcm, which will be silently dropped by the iwcm.  This causes the iWARP provider to never free up the resources from this connection because the assumption is the iwcm will accept or reject this connection.  The solution is to reject these connection requests.  Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | addr.c | s | 11K | 397 | David Miller | davem@davemloft.net | 1327545036 |  | infiniband: Convert dst_fetch_ha() over to dst_neigh_lookup().  Now we must provide the IP destination address, and a reference has to be dropped when we're done with the entry.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | sa.h | s | 2.3K | 59 | Roland Dreier | rolandd@cisco.com | 1184023052 |  | IB: Remove garbage non-ASCII characters from comments  A few files had 0xa0 characters in comments.  Remove them so that the files are clean ASCII text.  Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | umem.c | s | 7.8K | 248 | Yishai Hadas | yishaih@mellanox.com | 1336761502 |  | IB/core: Fix mismatch between locked and pinned pages  Commit bc3e53f682d9 ("mm: distinguish between mlocked and pinned pages") introduced a separate counter for pinned pages and used it in the IB stack.  However, in ib_umem_get() the pinned counter is incremented, but ib_umem_release() wrongly decrements the locked counter.  Fix this.  Signed-off-by: Yishai Hadas <yishaih@mellanox.com> Reviewed-by: Christoph Lameter <cl@linux.com> Cc: <stable@vger.kernel.org> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | cm.c | s | 107K | 3411 | Al Viro | viro@zeniv.linux.org.uk | 1325649295 |  | switch device_get_devnode() and ->devnode() to umode_t *  both callers of device_get_devnode() are only interested in lower 16bits and nobody tries to return anything wider than 16bit anyway.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | packer.c | s | 6.3K | 186 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103895 |  | infiniband: add in export.h for files using EXPORT_SYMBOL/THIS_MODULE  These were getting it implicitly via device.h --> module.h but we are going to stop that when we clean up the headers.  Fix these in advance so the tree remains biscect-clean.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | fmr_pool.c | s | 14K | 453 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103895 |  | infiniband: add in export.h for files using EXPORT_SYMBOL/THIS_MODULE  These were getting it implicitly via device.h --> module.h but we are going to stop that when we clean up the headers.  Fix these in advance so the tree remains biscect-clean.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cm_msgs.h | s | 21K | 706 | Eli Cohen | eli@dev.mellanox.co.il | 1325653458 |  | IB/cm: Fix layout of APR message  Add a missing 16-bit reserved field between ap_status and info fields.  Signed-off-by: Eli Cohen <eli@mellanox.com> Acked-by: Sean Hefty <sean.hefty@intel.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | agent.c | s | 6.2K | 188 | Michael Heinz | mheinz@qlogic.com | 1300466540 |  | IB/mad: Improve an error message so error code is included  Signed-off-by: Michael Heinz <michael.heinz@qlogic.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | core_priv.h | s | 1.9K | 45 | Ralph Campbell | ralph.campbell@qlogic.com | 1274463284 |  | IB/core: Allow device-specific per-port sysfs files  Add a new parameter to ib_register_device() so that low-level device drivers can pass in a pointer to a callback function that will be called for each port that is registered in sysfs.  This allows low-level device drivers to create files in      /sys/class/infiniband/<hca>/ports/<N>/  without having to poke through the internals of the RDMA sysfs handling.  There is no need for an unregister function since the kobject reference will go to zero when ib_unregister_device() is called.  Signed-off-by: Ralph Campbell <ralph.campbell@qlogic.com> Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | iwcm.h | s | 2.3K | 58 | Tom Tucker | tom@opengridcomputing.com | 1158963766 |  | RDMA: iWARP Connection Manager.  Add an iWARP Connection Manager (CM), which abstracts connection management for iWARP devices (RNICs).  It is a logical instance of the xx_cm where xx is the transport type (ib or iw).  The symbols exported are used by the transport independent rdma_cm module, and are available also for transport dependent ULPs.  Signed-off-by: Tom Tucker <tom@opengridcomputing.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | netlink.c | s | 4.9K | 165 | David S. Miller | davem@davemloft.net | 1333355622 |  | infiniband: Stop using NLA_PUT*().  These macros contain a hidden goto, and are thus extremely error prone and make code hard to audit.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | uverbs.h | s | 7.0K | 195 | Sean Hefty | sean.hefty@intel.com | 1318524656 |  | RDMA/uverbs: Export ib_open_qp() capability to user space  Allow processes that share the same XRC domain to open an existing shareable QP.  This permits those processes to receive events on the shared QP and transfer ownership, so that any process may modify the QP.  The latter allows the creating process to exit, while a remaining process can still transition it for path migration purposes.  Signed-off-by: Sean Hefty <sean.hefty@intel.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | cache.c | s | 10K | 322 | Or Gerlitz | ogerlitz@mellanox.com | 1311048270 |  | IB/core: Add GID change event  Add IB GID change event type.  This is needed for IBoE when the HW driver updates the GID (e.g when new VLANs are added/deleted) table and the change should be reflected to the IB core cache.  Signed-off-by: Eli Cohen <eli@mellanox.co.il> Signed-off-by: Or Gerlitz <ogerlitz@mellanox.co.il> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | ud_header.c | s | 11K | 380 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103895 |  | infiniband: add in export.h for files using EXPORT_SYMBOL/THIS_MODULE  These were getting it implicitly via device.h --> module.h but we are going to stop that when we clean up the headers.  Fix these in advance so the tree remains biscect-clean.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | uverbs_cmd.c | s | 66K | 2237 | Roland Dreier | roland@purestorage.com | 1337616047 |  | Merge branches 'core', 'cxgb4', 'ipath', 'iser', 'lockdep', 'mlx4', 'nes', 'ocrdma', 'qib' and 'raw-qp' into for-linus
f | sysfs.c | s | 23K | 764 | Roland Dreier | roland@purestorage.com | 1333389451 |  | IB/core: Don't return EINVAL from sysfs rate attribute for invalid speeds  Commit e9319b0cb00d ("IB/core: Fix SDR rates in sysfs") changed our sysfs rate attribute to return EINVAL to userspace if the underlying device driver returns an invalid rate.  Apparently some drivers do this when the link is down and some userspace pukes if it gets an error when reading this attribute, so avoid a regression by not return an error to match the old code.  Signed-off-by: Roland Dreier <roland@purestorage.com>
f | user_mad.c | s | 29K | 1003 | Al Viro | viro@zeniv.linux.org.uk | 1325649295 |  | switch device_get_devnode() and ->devnode() to umode_t *  both callers of device_get_devnode() are only interested in lower 16bits and nobody tries to return anything wider than 16bit anyway.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | multicast.c | s | 22K | 778 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103895 |  | infiniband: add in export.h for files using EXPORT_SYMBOL/THIS_MODULE  These were getting it implicitly via device.h --> module.h but we are going to stop that when we clean up the headers.  Fix these in advance so the tree remains biscect-clean.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | verbs.c | s | 29K | 1085 | Roland Dreier | roland@purestorage.com | 1337616047 |  | Merge branches 'core', 'cxgb4', 'ipath', 'iser', 'lockdep', 'mlx4', 'nes', 'ocrdma', 'qib' and 'raw-qp' into for-linus
f | cma.c | s | 87K | 3012 | Sean Hefty | sean.hefty@intel.com | 1340161444 |  | RDMA/cma: QP type check on received REQs should be AND not OR  Change |||| check to the intended && when checking the QP type in a received connection request against the listening endpoint.  Signed-off-by: Sean Hefty <sean.hefty@intel.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | ucma.c | s | 32K | 1188 | Eric W. Biederman | ebiederm@xmission.com | 1334971350 |  | net: Convert all sysctl registrations to register_net_sysctl  This results in code with less boiler plate that is a bit easier to read.  Additionally stops us from using compatibility code in the sysctl core, hastening the day when the compatibility code can be removed.  Signed-off-by: Eric W. Biederman <ebiederm@xmission.com> Acked-by: Pavel Emelyanov <xemul@parallels.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | mad_priv.h | s | 6.1K | 196 | Hal Rosenstock | hnrose@comcast.net | 1252337328 |  | IB/mad: Allow tuning of QP0 and QP1 sizes  MADs are UD and can be dropped if there are no receives posted, so allow receive queue size to be set with a module parameter in case the queue needs to be lengthened.  Send side tuning is done for symmetry with receive.  Signed-off-by: Hal Rosenstock <hal.rosenstock@gmail.com> Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | mad.c | s | 85K | 2717 | Jack Morgenstein | jackm@dev.mellanox.co.il | 1335308937 |  | IB/mad: Don't send response for failed MADs  Commit 0b307043049f ("IB/mad: Return error response for unsupported MADs") does not failed MADs (eg those that return IB_MAD_RESULT_FAILURE) properly -- these MADs should be silently discarded. (We should not force the lower-layer drivers to return SUCCESS || CONSUMED in this case, since the MAD is NOT successful). Unsupported MADs are not failures -- they return SUCCESS, but with an "unsupported error" status value inside the response MAD.  Reviewed-by: Hal Rosenstock <hal@mellanox.com> Signed-off-by: Jack Morgenstein <jackm@dev.mellanox.co.il> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | agent.h | s | 2.1K | 45 | Roland Dreier | rolandd@cisco.com | 1216104524 |  | RDMA: Remove subversion $Id tags  They don't get updated by git and so they're worse than useless.  Signed-off-by: Roland Dreier <rolandd@cisco.com>
f | smi.h | s | 3.3K | 82 | Steve Welch | swelch@systemfabricworks.com | 1201299325 |  | IB/mad: Enable loopback of DR SMP responses from userspace  The local loopback of an outgoing DR SMP response is limited to those that originate at the driver specific SMA implementation during the driver specific process_mad() function.  This patch enables a returning DR SMP originating in userspace (or elsewhere) to be delivered to the local managment stack.  In this specific case the driver process_mad() function does not consume or process the MAD, so a reponse mad has not be created and the original MAD must manually be copied to the MAD buffer that is to be handed off to the local agent.  Signed-off-by: Steve Welch <swelch@systemfabricworks.com> Acked-by: Hal Rosenstock <hal@xsigo.com> Signed-off-by: Roland Dreier <rolandd@cisco.com>
