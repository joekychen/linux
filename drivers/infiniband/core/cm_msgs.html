<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › infiniband › core › cm_msgs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>cm_msgs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004, 2011 Intel Corporation.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2004 Topspin Corporation.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2004 Voltaire Corporation.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING the madirectory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use source and binary forms, with or</span>
<span class="cm"> *     withmodification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retathe above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHWARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>
<span class="cp">#if !defined(CM_MSGS_H)</span>
<span class="cp">#define CM_MSGS_H</span>

<span class="cp">#include &lt;rdma/ib_mad.h&gt;</span>
<span class="cp">#include &lt;rdma/ib_cm.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Parameters to routines below should be in network-byte order, and values</span>
<span class="cm"> * are returned in network-byte order.</span>
<span class="cm"> */</span>

<span class="cp">#define IB_CM_CLASS_VERSION	2 </span><span class="cm">/* IB specification 1.2 */</span><span class="cp"></span>

<span class="cp">#define CM_REQ_ATTR_ID		cpu_to_be16(0x0010)</span>
<span class="cp">#define CM_MRA_ATTR_ID		cpu_to_be16(0x0011)</span>
<span class="cp">#define CM_REJ_ATTR_ID		cpu_to_be16(0x0012)</span>
<span class="cp">#define CM_REP_ATTR_ID		cpu_to_be16(0x0013)</span>
<span class="cp">#define CM_RTU_ATTR_ID		cpu_to_be16(0x0014)</span>
<span class="cp">#define CM_DREQ_ATTR_ID		cpu_to_be16(0x0015)</span>
<span class="cp">#define CM_DREP_ATTR_ID		cpu_to_be16(0x0016)</span>
<span class="cp">#define CM_SIDR_REQ_ATTR_ID	cpu_to_be16(0x0017)</span>
<span class="cp">#define CM_SIDR_REP_ATTR_ID	cpu_to_be16(0x0018)</span>
<span class="cp">#define CM_LAP_ATTR_ID		cpu_to_be16(0x0019)</span>
<span class="cp">#define CM_APR_ATTR_ID		cpu_to_be16(0x001A)</span>

<span class="k">enum</span> <span class="n">cm_msg_sequence</span> <span class="p">{</span>
	<span class="n">CM_MSG_SEQUENCE_REQ</span><span class="p">,</span>
	<span class="n">CM_MSG_SEQUENCE_LAP</span><span class="p">,</span>
	<span class="n">CM_MSG_SEQUENCE_DREQ</span><span class="p">,</span>
	<span class="n">CM_MSG_SEQUENCE_SIDR</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">rsvd4</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">service_id</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">local_ca_guid</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">rsvd24</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">local_qkey</span><span class="p">;</span>
	<span class="cm">/* local QPN:24, responder resources:8 */</span>
	<span class="n">__be32</span> <span class="n">offset32</span><span class="p">;</span>
	<span class="cm">/* local EECN:24, initiator depth:8 */</span>
	<span class="n">__be32</span> <span class="n">offset36</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * remote EECN:24, remote CM response timeout:5,</span>
<span class="cm">	 * transport service type:2, end-to-end flow control:1</span>
<span class="cm">	 */</span>
	<span class="n">__be32</span> <span class="n">offset40</span><span class="p">;</span>
	<span class="cm">/* starting PSN:24, local CM response timeout:5, retry count:3 */</span>
	<span class="n">__be32</span> <span class="n">offset44</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">pkey</span><span class="p">;</span>
	<span class="cm">/* path MTU:4, RDC exists:1, RNR retry count:3. */</span>
	<span class="n">u8</span> <span class="n">offset50</span><span class="p">;</span>
	<span class="cm">/* max CM Retries:4, SRQ:1, extended transport type:3 */</span>
	<span class="n">u8</span> <span class="n">offset51</span><span class="p">;</span>

	<span class="n">__be16</span> <span class="n">primary_local_lid</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">primary_remote_lid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">primary_local_gid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">primary_remote_gid</span><span class="p">;</span>
	<span class="cm">/* flow label:20, rsvd:6, packet rate:6 */</span>
	<span class="n">__be32</span> <span class="n">primary_offset88</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">primary_traffic_class</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">primary_hop_limit</span><span class="p">;</span>
	<span class="cm">/* SL:4, subnet local:1, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">primary_offset94</span><span class="p">;</span>
	<span class="cm">/* local ACK timeout:5, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">primary_offset95</span><span class="p">;</span>

	<span class="n">__be16</span> <span class="n">alt_local_lid</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">alt_remote_lid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">alt_local_gid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">alt_remote_gid</span><span class="p">;</span>
	<span class="cm">/* flow label:20, rsvd:6, packet rate:6 */</span>
	<span class="n">__be32</span> <span class="n">alt_offset132</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">alt_traffic_class</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">alt_hop_limit</span><span class="p">;</span>
	<span class="cm">/* SL:4, subnet local:1, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">alt_offset138</span><span class="p">;</span>
	<span class="cm">/* local ACK timeout:5, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">alt_offset139</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_REQ_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_req_get_local_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_local_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">qpn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_resp_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_resp_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">resp_res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">resp_res</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset32</span><span class="p">)</span> <span class="o">&amp;</span>
					 <span class="mh">0xFFFFFF00</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_init_depth</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset36</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_init_depth</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					 <span class="n">u8</span> <span class="n">init_depth</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset36</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">init_depth</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset36</span><span class="p">)</span> <span class="o">&amp;</span>
					 <span class="mh">0xFFFFFF00</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_remote_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_remote_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						  <span class="n">u8</span> <span class="n">resp_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">resp_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0xFFFFFF07</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">enum</span> <span class="n">ib_qp_type</span> <span class="nf">cm_req_get_qp_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">transport_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x06</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">transport_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>: <span class="k">return</span> <span class="n">IB_QPT_RC</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>: <span class="k">return</span> <span class="n">IB_QPT_UC</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="k">return</span> <span class="n">IB_QPT_XRC_TGT</span><span class="p">;</span>
		<span class="nl">default:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="nl">default:</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_qp_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
				      <span class="k">enum</span> <span class="n">ib_qp_type</span> <span class="n">qp_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">qp_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IB_QPT_UC</span>:
		<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span>
						  <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span>
						   <span class="mh">0xFFFFFFF9</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IB_QPT_XRC_INI</span>:
		<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span>
						 <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span>
						   <span class="mh">0xFFFFFFF9</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x6</span><span class="p">);</span>
		<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">=</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span>
						 <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span>
						  <span class="mh">0xFFFFFFF9</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_flow_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_flow_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					<span class="n">u8</span> <span class="n">flow_ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">flow_ctrl</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset40</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0xFFFFFFFE</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_req_get_starting_psn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_starting_psn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					   <span class="n">__be32</span> <span class="n">starting_psn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">starting_psn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_local_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_local_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						 <span class="n">u8</span> <span class="n">resp_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">resp_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFF07</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					  <span class="n">u8</span> <span class="n">retry_count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">retry_count</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset44</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFF8</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_path_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_path_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">path_mtu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">path_mtu</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_rnr_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_rnr_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					      <span class="n">u8</span> <span class="n">rnr_retry_count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset50</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">rnr_retry_count</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_max_cm_retries</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_max_cm_retries</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					     <span class="n">u8</span> <span class="n">retries</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">retries</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">srq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">offset51</span> <span class="o">&amp;</span> <span class="mh">0xF7</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">((</span><span class="n">srq</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_req_get_primary_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_primary_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						 <span class="n">__be32</span> <span class="n">flow_label</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span>
				    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span><span class="p">)</span> <span class="o">&amp;</span>
				     <span class="mh">0x00000FFF</span><span class="p">)</span> <span class="o">|</span>
				     <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">flow_label</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_primary_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_primary_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						  <span class="n">u8</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span>
				    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset88</span><span class="p">)</span> <span class="o">&amp;</span>
				     <span class="mh">0xFFFFFFC0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_primary_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_primary_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">sl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="n">sl</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_primary_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_primary_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						   <span class="n">u8</span> <span class="n">subnet_local</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset94</span> <span class="o">&amp;</span> <span class="mh">0xF7</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">((</span><span class="n">subnet_local</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_primary_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset95</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_primary_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
							<span class="n">u8</span> <span class="n">local_ack_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset95</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">primary_offset95</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="n">local_ack_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_req_get_alt_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_alt_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					     <span class="n">__be32</span> <span class="n">flow_label</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span>
				 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span><span class="p">)</span> <span class="o">&amp;</span>
				  <span class="mh">0x00000FFF</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">flow_label</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_alt_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_alt_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					      <span class="n">u8</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span>
				 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset132</span><span class="p">)</span> <span class="o">&amp;</span>
				  <span class="mh">0xFFFFFFC0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_alt_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_alt_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">sl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span>
				       <span class="p">(</span><span class="n">sl</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_alt_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_alt_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
					       <span class="n">u8</span> <span class="n">subnet_local</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset138</span> <span class="o">&amp;</span> <span class="mh">0xF7</span><span class="p">)</span> <span class="o">|</span>
				       <span class="p">((</span><span class="n">subnet_local</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_req_get_alt_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset139</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_req_set_alt_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_req_msg</span> <span class="o">*</span><span class="n">req_msg</span><span class="p">,</span>
						    <span class="n">u8</span> <span class="n">local_ack_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset139</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">req_msg</span><span class="o">-&gt;</span><span class="n">alt_offset139</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">|</span>
				       <span class="p">(</span><span class="n">local_ack_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* Message REJected or MRAed */</span>
<span class="k">enum</span> <span class="n">cm_msg_response</span> <span class="p">{</span>
	<span class="n">CM_MSG_RESPONSE_REQ</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">CM_MSG_RESPONSE_REP</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">,</span>
	<span class="n">CM_MSG_RESPONSE_OTHER</span> <span class="o">=</span> <span class="mh">0x2</span>
<span class="p">};</span>

 <span class="k">struct</span> <span class="n">cm_mra_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>
	<span class="cm">/* message MRAed:2, rsvd:6 */</span>
	<span class="n">u8</span> <span class="n">offset8</span><span class="p">;</span>
	<span class="cm">/* service timeout:5, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">offset9</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_MRA_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_mra_get_msg_mraed</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_mra_msg</span> <span class="o">*</span><span class="n">mra_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_mra_set_msg_mraed</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_mra_msg</span> <span class="o">*</span><span class="n">mra_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_mra_get_service_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_mra_msg</span> <span class="o">*</span><span class="n">mra_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_mra_set_service_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_mra_msg</span> <span class="o">*</span><span class="n">mra_msg</span><span class="p">,</span>
					      <span class="n">u8</span> <span class="n">service_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">mra_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">|</span>
				 <span class="p">(</span><span class="n">service_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">cm_rej_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>
	<span class="cm">/* message REJected:2, rsvd:6 */</span>
	<span class="n">u8</span> <span class="n">offset8</span><span class="p">;</span>
	<span class="cm">/* reject info length:7, rsvd:1. */</span>
	<span class="n">u8</span> <span class="n">offset9</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">reason</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ari</span><span class="p">[</span><span class="n">IB_CM_REJ_ARI_LENGTH</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_REJ_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rej_get_msg_rejected</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rej_msg</span> <span class="o">*</span><span class="n">rej_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rej_set_msg_rejected</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rej_msg</span> <span class="o">*</span><span class="n">rej_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">msg</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rej_get_reject_info_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rej_msg</span> <span class="o">*</span><span class="n">rej_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rej_set_reject_info_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rej_msg</span> <span class="o">*</span><span class="n">rej_msg</span><span class="p">,</span>
					      <span class="n">u8</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rej_msg</span><span class="o">-&gt;</span><span class="n">offset9</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">local_qkey</span><span class="p">;</span>
	<span class="cm">/* local QPN:24, rsvd:8 */</span>
	<span class="n">__be32</span> <span class="n">offset12</span><span class="p">;</span>
	<span class="cm">/* local EECN:24, rsvd:8 */</span>
	<span class="n">__be32</span> <span class="n">offset16</span><span class="p">;</span>
	<span class="cm">/* starting PSN:24 rsvd:8 */</span>
	<span class="n">__be32</span> <span class="n">offset20</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">resp_resources</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">initiator_depth</span><span class="p">;</span>
	<span class="cm">/* target ACK delay:5, failover accepted:2, end-to-end flow control:1 */</span>
	<span class="n">u8</span> <span class="n">offset26</span><span class="p">;</span>
	<span class="cm">/* RNR retry count:3, SRQ:1, rsvd:5 */</span>
	<span class="n">u8</span> <span class="n">offset27</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">local_ca_guid</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_REP_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_rep_get_local_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_local_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset12</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">qpn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_rep_get_local_eecn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset16</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_local_eecn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">eecn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset16</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">eecn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_rep_get_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ib_qp_type</span> <span class="n">qp_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">qp_type</span> <span class="o">==</span> <span class="n">IB_QPT_XRC_INI</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">cm_rep_get_local_eecn</span><span class="p">(</span><span class="n">rep_msg</span><span class="p">)</span> <span class="o">:</span> <span class="n">cm_rep_get_local_qpn</span><span class="p">(</span><span class="n">rep_msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_rep_get_starting_psn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset20</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_starting_psn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span>
					   <span class="n">__be32</span> <span class="n">starting_psn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset20</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">starting_psn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rep_get_target_ack_delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_target_ack_delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span>
					       <span class="n">u8</span> <span class="n">target_ack_delay</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">target_ack_delay</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rep_get_failover</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&amp;</span> <span class="mh">0x06</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_failover</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">failover</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&amp;</span> <span class="mh">0xF9</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">((</span><span class="n">failover</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rep_get_flow_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_flow_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span>
					    <span class="n">u8</span> <span class="n">flow_ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset26</span> <span class="o">&amp;</span> <span class="mh">0xFE</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">flow_ctrl</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rep_get_rnr_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_rnr_retry_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span>
					      <span class="n">u8</span> <span class="n">rnr_retry_count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">&amp;</span> <span class="mh">0x1F</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">rnr_retry_count</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_rep_get_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_rep_set_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_rep_msg</span> <span class="o">*</span><span class="n">rep_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">srq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">rep_msg</span><span class="o">-&gt;</span><span class="n">offset27</span> <span class="o">&amp;</span> <span class="mh">0xEF</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">((</span><span class="n">srq</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">cm_rtu_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_RTU_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">cm_dreq_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>
	<span class="cm">/* remote QPN/EECN:24, rsvd:8 */</span>
	<span class="n">__be32</span> <span class="n">offset8</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_DREQ_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_dreq_get_remote_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_dreq_msg</span> <span class="o">*</span><span class="n">dreq_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">dreq_msg</span><span class="o">-&gt;</span><span class="n">offset8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_dreq_set_remote_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_dreq_msg</span> <span class="o">*</span><span class="n">dreq_msg</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dreq_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">qpn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">dreq_msg</span><span class="o">-&gt;</span><span class="n">offset8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">cm_drep_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_DREP_PRIVATE_DATA_SIZE</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">rsvd8</span><span class="p">;</span>
	<span class="cm">/* remote QPN/EECN:24, remote CM response timeout:5, rsvd:3 */</span>
	<span class="n">__be32</span> <span class="n">offset12</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">rsvd16</span><span class="p">;</span>

	<span class="n">__be16</span> <span class="n">alt_local_lid</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">alt_remote_lid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">alt_local_gid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">alt_remote_gid</span><span class="p">;</span>
	<span class="cm">/* flow label:20, rsvd:4, traffic class:8 */</span>
	<span class="n">__be32</span> <span class="n">offset56</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">alt_hop_limit</span><span class="p">;</span>
	<span class="cm">/* rsvd:2, packet rate:6 */</span>
	<span class="n">u8</span> <span class="n">offset61</span><span class="p">;</span>
	<span class="cm">/* SL:4, subnet local:1, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">offset62</span><span class="p">;</span>
	<span class="cm">/* local ACK timeout:5, rsvd:3 */</span>
	<span class="n">u8</span> <span class="n">offset63</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_LAP_PRIVATE_DATA_SIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span>  <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_lap_get_remote_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_remote_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">qpn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_remote_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_remote_resp_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
						  <span class="n">u8</span> <span class="n">resp_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">resp_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset12</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0xFFFFFF07</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_lap_get_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_flow_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
					 <span class="n">__be32</span> <span class="n">flow_label</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span>
				 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x00000FFF</span><span class="p">)</span> <span class="o">|</span>
				 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">flow_label</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_traffic_class</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_traffic_class</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
					    <span class="n">u8</span> <span class="n">traffic_class</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">traffic_class</span> <span class="o">|</span>
					 <span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset56</span><span class="p">)</span> <span class="o">&amp;</span>
					  <span class="mh">0xFFFFFF00</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset61</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_packet_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
					  <span class="n">u8</span> <span class="n">packet_rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset61</span> <span class="o">=</span> <span class="p">(</span><span class="n">packet_rate</span> <span class="o">&amp;</span> <span class="mh">0x3F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset61</span> <span class="o">&amp;</span> <span class="mh">0xC0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset62</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_sl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">sl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset62</span> <span class="o">=</span> <span class="p">(</span><span class="n">sl</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset62</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset62</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_subnet_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
					   <span class="n">u8</span> <span class="n">subnet_local</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset62</span> <span class="o">=</span> <span class="p">((</span><span class="n">subnet_local</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
			     <span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset61</span> <span class="o">&amp;</span> <span class="mh">0xF7</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">cm_lap_get_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset63</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_lap_set_local_ack_timeout</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_lap_msg</span> <span class="o">*</span><span class="n">lap_msg</span><span class="p">,</span>
						<span class="n">u8</span> <span class="n">local_ack_timeout</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset63</span> <span class="o">=</span> <span class="p">(</span><span class="n">local_ack_timeout</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="n">lap_msg</span><span class="o">-&gt;</span><span class="n">offset63</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">cm_apr_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">local_comm_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">remote_comm_id</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">info_length</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ap_status</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">rsvd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">info</span><span class="p">[</span><span class="n">IB_CM_APR_INFO_LENGTH</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_APR_PRIVATE_DATA_SIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">cm_sidr_req_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">request_id</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">pkey</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">rsvd</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">service_id</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_SIDR_REQ_PRIVATE_DATA_SIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">cm_sidr_rep_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">request_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">info_length</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">rsvd</span><span class="p">;</span>
	<span class="cm">/* QPN:24, rsvd:8 */</span>
	<span class="n">__be32</span> <span class="n">offset8</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">service_id</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">qkey</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">info</span><span class="p">[</span><span class="n">IB_CM_SIDR_REP_INFO_LENGTH</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">private_data</span><span class="p">[</span><span class="n">IB_CM_SIDR_REP_PRIVATE_DATA_SIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="nf">cm_sidr_rep_get_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_sidr_rep_msg</span> <span class="o">*</span><span class="n">sidr_rep_msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">sidr_rep_msg</span><span class="o">-&gt;</span><span class="n">offset8</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cm_sidr_rep_set_qpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">cm_sidr_rep_msg</span> <span class="o">*</span><span class="n">sidr_rep_msg</span><span class="p">,</span>
				       <span class="n">__be32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">sidr_rep_msg</span><span class="o">-&gt;</span><span class="n">offset8</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">((</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">qpn</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">sidr_rep_msg</span><span class="o">-&gt;</span><span class="n">offset8</span><span class="p">)</span> <span class="o">&amp;</span>
					 <span class="mh">0x000000FF</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CM_MSGS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
