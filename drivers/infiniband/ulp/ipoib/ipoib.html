<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › infiniband › ulp › ipoib › ipoib.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ipoib.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Sun Microsystems, Inc. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2004 Voltaire, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _IPOIB_H</span>
<span class="cp">#define _IPOIB_H</span>

<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/kref.h&gt;</span>
<span class="cp">#include &lt;linux/if_infiniband.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#include &lt;net/neighbour.h&gt;</span>
<span class="cp">#include &lt;net/sch_generic.h&gt;</span>

<span class="cp">#include &lt;linux/atomic.h&gt;</span>

<span class="cp">#include &lt;rdma/ib_verbs.h&gt;</span>
<span class="cp">#include &lt;rdma/ib_pack.h&gt;</span>
<span class="cp">#include &lt;rdma/ib_sa.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>

<span class="cm">/* constants */</span>

<span class="k">enum</span> <span class="n">ipoib_flush_level</span> <span class="p">{</span>
	<span class="n">IPOIB_FLUSH_LIGHT</span><span class="p">,</span>
	<span class="n">IPOIB_FLUSH_NORMAL</span><span class="p">,</span>
	<span class="n">IPOIB_FLUSH_HEAVY</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPOIB_ENCAP_LEN</span>		  <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

	<span class="n">IPOIB_UD_HEAD_SIZE</span>	  <span class="o">=</span> <span class="n">IB_GRH_BYTES</span> <span class="o">+</span> <span class="n">IPOIB_ENCAP_LEN</span><span class="p">,</span>
	<span class="n">IPOIB_UD_RX_SG</span>		  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="cm">/* max buffer needed for 4K mtu */</span>

	<span class="n">IPOIB_CM_MTU</span>		  <span class="o">=</span> <span class="mh">0x10000</span> <span class="o">-</span> <span class="mh">0x10</span><span class="p">,</span> <span class="cm">/* padding to align header to 16 */</span>
	<span class="n">IPOIB_CM_BUF_SIZE</span>	  <span class="o">=</span> <span class="n">IPOIB_CM_MTU</span>  <span class="o">+</span> <span class="n">IPOIB_ENCAP_LEN</span><span class="p">,</span>
	<span class="n">IPOIB_CM_HEAD_SIZE</span>	  <span class="o">=</span> <span class="n">IPOIB_CM_BUF_SIZE</span> <span class="o">%</span> <span class="n">PAGE_SIZE</span><span class="p">,</span>
	<span class="n">IPOIB_CM_RX_SG</span>		  <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">IPOIB_CM_BUF_SIZE</span><span class="p">,</span> <span class="n">PAGE_SIZE</span><span class="p">)</span> <span class="o">/</span> <span class="n">PAGE_SIZE</span><span class="p">,</span>
	<span class="n">IPOIB_RX_RING_SIZE</span>	  <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
	<span class="n">IPOIB_TX_RING_SIZE</span>	  <span class="o">=</span> <span class="mi">128</span><span class="p">,</span>
	<span class="n">IPOIB_MAX_QUEUE_SIZE</span>	  <span class="o">=</span> <span class="mi">8192</span><span class="p">,</span>
	<span class="n">IPOIB_MIN_QUEUE_SIZE</span>	  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">IPOIB_CM_MAX_CONN_QP</span>	  <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>

	<span class="n">IPOIB_NUM_WC</span>		  <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>

	<span class="n">IPOIB_MAX_PATH_REC_QUEUE</span>  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">IPOIB_MAX_MCAST_QUEUE</span>	  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

	<span class="n">IPOIB_FLAG_OPER_UP</span>	  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPOIB_FLAG_INITIALIZED</span>	  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">IPOIB_FLAG_ADMIN_UP</span>	  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">IPOIB_PKEY_ASSIGNED</span>	  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">IPOIB_PKEY_STOP</span>		  <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">IPOIB_FLAG_SUBINTERFACE</span>	  <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">IPOIB_MCAST_RUN</span>		  <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">IPOIB_STOP_REAPER</span>	  <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">IPOIB_FLAG_ADMIN_CM</span>	  <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">IPOIB_FLAG_UMCAST</span>	  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

	<span class="n">IPOIB_MAX_BACKOFF_SECONDS</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

	<span class="n">IPOIB_MCAST_FLAG_FOUND</span>	  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* used in set_multicast_list */</span>
	<span class="n">IPOIB_MCAST_FLAG_SENDONLY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">IPOIB_MCAST_FLAG_BUSY</span>	  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* joining or already joined */</span>
	<span class="n">IPOIB_MCAST_FLAG_ATTACHED</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>

	<span class="n">MAX_SEND_CQE</span>		  <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">IPOIB_CM_COPYBREAK</span>	  <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define	IPOIB_OP_RECV   (1ul &lt;&lt; 31)</span>
<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_CM</span>
<span class="cp">#define	IPOIB_OP_CM     (1ul &lt;&lt; 30)</span>
<span class="cp">#else</span>
<span class="cp">#define	IPOIB_OP_CM     (0)</span>
<span class="cp">#endif</span>

<span class="cm">/* structs */</span>

<span class="k">struct</span> <span class="n">ipoib_header</span> <span class="p">{</span>
	<span class="n">__be16</span>	<span class="n">proto</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cb</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">qdisc_skb_cb</span>	<span class="n">qdisc_cb</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">hwaddr</span><span class="p">[</span><span class="n">INFINIBAND_ALEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Used for all multicast joins (broadcast, IPv4 mcast and IPv6 mcast) */</span>
<span class="k">struct</span> <span class="n">ipoib_mcast</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="n">mcmember</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_sa_multicast</span>	 <span class="o">*</span><span class="n">mc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_ah</span>		 <span class="o">*</span><span class="n">ah</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rb_node</span>    <span class="n">rb_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>  <span class="n">list</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">created</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">backoff</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">logcount</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>  <span class="n">neigh_list</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">pkt_queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_rx_buf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u64</span>		<span class="n">mapping</span><span class="p">[</span><span class="n">IPOIB_UD_RX_SG</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_tx_buf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u64</span>		<span class="n">mapping</span><span class="p">[</span><span class="n">MAX_SKB_FRAGS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cm_tx_buf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u64</span>		<span class="n">mapping</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ib_cm_id</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ipoib_cm_data</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">qpn</span><span class="p">;</span> <span class="cm">/* High byte MUST be ignored on receive */</span>
	<span class="n">__be32</span> <span class="n">mtu</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Quoting 10.3.1 Queue Pair and EE Context States:</span>
<span class="cm"> *</span>
<span class="cm"> * Note, for QPs that are associated with an SRQ, the Consumer should take the</span>
<span class="cm"> * QP through the Error State before invoking a Destroy QP or a Modify QP to the</span>
<span class="cm"> * Reset State.  The Consumer may invoke the Destroy QP without first performing</span>
<span class="cm"> * a Modify QP to the Error State and waiting for the Affiliated Asynchronous</span>
<span class="cm"> * Last WQE Reached Event. However, if the Consumer does not wait for the</span>
<span class="cm"> * Affiliated Asynchronous Last WQE Reached Event, then WQE and Data Segment</span>
<span class="cm"> * leakage may occur. Therefore, it is good programming practice to tear down a</span>
<span class="cm"> * QP that is associated with an SRQ by using the following process:</span>
<span class="cm"> *</span>
<span class="cm"> * - Put the QP in the Error State</span>
<span class="cm"> * - Wait for the Affiliated Asynchronous Last WQE Reached Event;</span>
<span class="cm"> * - either:</span>
<span class="cm"> *       drain the CQ by invoking the Poll CQ verb and either wait for CQ</span>
<span class="cm"> *       to be empty or the number of Poll CQ operations has exceeded</span>
<span class="cm"> *       CQ capacity size;</span>
<span class="cm"> * - or</span>
<span class="cm"> *       post another WR that completes on the same CQ and wait for this</span>
<span class="cm"> *       WR to return as a WC;</span>
<span class="cm"> * - and then invoke a Destroy QP or Reset QP.</span>
<span class="cm"> *</span>
<span class="cm"> * We use the second option and wait for a completion on the</span>
<span class="cm"> * same CQ before destroying QPs attached to our SRQ.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">ipoib_cm_state</span> <span class="p">{</span>
	<span class="n">IPOIB_CM_RX_LIVE</span><span class="p">,</span>
	<span class="n">IPOIB_CM_RX_ERROR</span><span class="p">,</span> <span class="cm">/* Ignored by stale task */</span>
	<span class="n">IPOIB_CM_RX_FLUSH</span>  <span class="cm">/* Last WQE Reached event observed */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cm_rx</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_cm_id</span>	       <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_qp</span>	       <span class="o">*</span><span class="n">qp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_cm_rx_buf</span> <span class="o">*</span><span class="n">rx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">jiffies</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">ipoib_cm_state</span>	<span class="n">state</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">recv_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_cm_id</span>	    <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_qp</span>	    <span class="o">*</span><span class="n">qp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>     <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>   <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_neigh</span>  <span class="o">*</span><span class="n">neigh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_path</span>   <span class="o">*</span><span class="n">path</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_cm_tx_buf</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="kt">unsigned</span>	     <span class="n">tx_head</span><span class="p">;</span>
	<span class="kt">unsigned</span>	     <span class="n">tx_tail</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	     <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span>		     <span class="n">mtu</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cm_rx_buf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mapping</span><span class="p">[</span><span class="n">IPOIB_CM_RX_SG</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_cm_dev_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_srq</span>	       <span class="o">*</span><span class="n">srq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_cm_rx_buf</span> <span class="o">*</span><span class="n">srq_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_cm_id</span>	       <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">passive_ids</span><span class="p">;</span>   <span class="cm">/* state: LIVE */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">rx_error_list</span><span class="p">;</span> <span class="cm">/* state: ERROR */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">rx_flush_list</span><span class="p">;</span> <span class="cm">/* state: FLUSH, drain not started */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">rx_drain_list</span><span class="p">;</span> <span class="cm">/* state: FLUSH, drain started */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">rx_reap_list</span><span class="p">;</span>  <span class="cm">/* state: FLUSH, drain done */</span>
	<span class="k">struct</span> <span class="n">work_struct</span>      <span class="n">start_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>      <span class="n">reap_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>      <span class="n">skb_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>      <span class="n">rx_reap_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span>     <span class="n">stale_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span>     <span class="n">skb_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">start_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">reap_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_wc</span>		<span class="n">ibwc</span><span class="p">[</span><span class="n">IPOIB_NUM_WC</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ib_sge</span>		<span class="n">rx_sge</span><span class="p">[</span><span class="n">IPOIB_CM_RX_SG</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ib_recv_wr</span>       <span class="n">rx_wr</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">nonsrq_conn_qp</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">max_cm_mtu</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_frags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_ethtool_st</span> <span class="p">{</span>
	<span class="n">u16</span>     <span class="n">coalesce_usecs</span><span class="p">;</span>
	<span class="n">u16</span>     <span class="n">max_coalesced_frames</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Device private locking: network stack tx_lock protects members used</span>
<span class="cm"> * in TX fast path, lock protects everything else.  lock nests inside</span>
<span class="cm"> * of tx_lock (ie tx_lock must be acquired first if needed).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="p">{</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">napi_struct</span> <span class="n">napi</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">vlan_mutex</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rb_root</span>  <span class="n">path_tree</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">path_list</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ipoib_mcast</span> <span class="o">*</span><span class="n">broadcast</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">multicast_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rb_root</span> <span class="n">multicast_tree</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">pkey_poll_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">mcast_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">carrier_on_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">flush_light</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">flush_normal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">flush_heavy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">restart_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">ah_reap_task</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ca</span><span class="p">;</span>
	<span class="n">u8</span>		  <span class="n">port</span><span class="p">;</span>
	<span class="n">u16</span>		  <span class="n">pkey</span><span class="p">;</span>
	<span class="n">u16</span>		  <span class="n">pkey_index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_pd</span>	 <span class="o">*</span><span class="n">pd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_mr</span>	 <span class="o">*</span><span class="n">mr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_cq</span>	 <span class="o">*</span><span class="n">recv_cq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_cq</span>	 <span class="o">*</span><span class="n">send_cq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_qp</span>	 <span class="o">*</span><span class="n">qp</span><span class="p">;</span>
	<span class="n">u32</span>		  <span class="n">qkey</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">local_gid</span><span class="p">;</span>
	<span class="n">u16</span>	     <span class="n">local_lid</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">admin_mtu</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mcast_mtu</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_ib_mtu</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ipoib_rx_buf</span> <span class="o">*</span><span class="n">rx_ring</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ipoib_tx_buf</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="kt">unsigned</span>	     <span class="n">tx_head</span><span class="p">;</span>
	<span class="kt">unsigned</span>	     <span class="n">tx_tail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_sge</span>	     <span class="n">tx_sge</span><span class="p">[</span><span class="n">MAX_SKB_FRAGS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ib_send_wr</span>    <span class="n">tx_wr</span><span class="p">;</span>
	<span class="kt">unsigned</span>	     <span class="n">tx_outstanding</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_wc</span>	     <span class="n">send_wc</span><span class="p">[</span><span class="n">MAX_SEND_CQE</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">ib_recv_wr</span>    <span class="n">rx_wr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_sge</span>	     <span class="n">rx_sge</span><span class="p">[</span><span class="n">IPOIB_UD_RX_SG</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">ib_wc</span> <span class="n">ibwc</span><span class="p">[</span><span class="n">IPOIB_NUM_WC</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">dead_ahs</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ib_event_handler</span> <span class="n">event_handler</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">parent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">child_intfs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_CM</span>
	<span class="k">struct</span> <span class="n">ipoib_cm_dev_priv</span> <span class="n">cm</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">fs_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">mcg_dentry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">path_dentry</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="kt">int</span>	<span class="n">hca_caps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_ethtool_st</span> <span class="n">ethtool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">poll_timer</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_ah</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_ah</span>	  <span class="o">*</span><span class="n">ah</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>   <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span>	   <span class="n">ref</span><span class="p">;</span>
	<span class="kt">unsigned</span>	   <span class="n">last_send</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_path</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span>    <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="n">pathrec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ipoib_ah</span>      <span class="o">*</span><span class="n">ah</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span>   <span class="n">queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>      <span class="n">neigh_list</span><span class="p">;</span>

	<span class="kt">int</span>		      <span class="n">query_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ib_sa_query</span>   <span class="o">*</span><span class="n">query</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>     <span class="n">done</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rb_node</span>	      <span class="n">rb_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>      <span class="n">list</span><span class="p">;</span>
	<span class="kt">int</span>  		      <span class="n">valid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ipoib_ah</span>    <span class="o">*</span><span class="n">ah</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_CM</span>
	<span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">cm</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">union</span> <span class="n">ib_gid</span>	    <span class="n">dgid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">neighbour</span>   <span class="o">*</span><span class="n">neighbour</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>    <span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IPOIB_UD_MTU(ib_mtu)		(ib_mtu - IPOIB_ENCAP_LEN)</span>
<span class="cp">#define IPOIB_UD_BUF_SIZE(ib_mtu)	(ib_mtu + IB_GRH_BYTES)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_ud_need_sg</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ib_mtu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IPOIB_UD_BUF_SIZE</span><span class="p">(</span><span class="n">ib_mtu</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">PAGE_SIZE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * We stash a pointer to our private neighbour information after our</span>
<span class="cm"> * hardware address in neigh-&gt;ha.  The ALIGN() expression here makes</span>
<span class="cm"> * sure that this pointer is stored aligned so that an unaligned</span>
<span class="cm"> * load is not needed to dereference it.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">**</span><span class="nf">to_ipoib_neigh</span><span class="p">(</span><span class="k">struct</span> <span class="n">neighbour</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span> <span class="n">neigh</span> <span class="o">+</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">offsetof</span><span class="p">(</span><span class="k">struct</span> <span class="n">neighbour</span><span class="p">,</span> <span class="n">ha</span><span class="p">)</span> <span class="o">+</span>
				     <span class="n">INFINIBAND_ALEN</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">ipoib_neigh_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">neighbour</span> <span class="o">*</span><span class="n">neigh</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_neigh_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">ipoib_workqueue</span><span class="p">;</span>

<span class="cm">/* functions */</span>

<span class="kt">int</span> <span class="n">ipoib_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">napi_struct</span> <span class="o">*</span><span class="n">napi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">budget</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_ib_completion</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_ptr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_send_comp_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_ptr</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ipoib_ah</span> <span class="o">*</span><span class="n">ipoib_create_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">ib_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_ah_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_free_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">kref</span> <span class="o">*</span><span class="n">kref</span><span class="p">);</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_put_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_ah</span> <span class="o">*</span><span class="n">ah</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kref_put</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">ref</span><span class="p">,</span> <span class="n">ipoib_free_ah</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">ipoib_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_add_pkey_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_add_umcast_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ipoib_ah</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="n">u32</span> <span class="n">qpn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_reap_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_mark_paths_invalid</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_flush_paths</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">ipoib_intf_alloc</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ipoib_ib_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ca</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_ib_dev_flush_light</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_ib_dev_flush_normal</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_ib_dev_flush_heavy</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_pkey_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_ib_dev_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ipoib_ib_dev_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_ib_dev_up</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_ib_dev_down</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flush</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_ib_dev_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flush</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ipoib_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ca</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_dev_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_mcast_join_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_mcast_carrier_on_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_mcast_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">mgid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_mcast_restart_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_mcast_start_thread</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_mcast_stop_thread</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flush</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_mcast_dev_down</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_mcast_dev_flush</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG</span>
<span class="k">struct</span> <span class="n">ipoib_mcast_iter</span> <span class="o">*</span><span class="n">ipoib_mcast_iter_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_mcast_iter_next</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_mcast_iter</span> <span class="o">*</span><span class="n">iter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_mcast_iter_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_mcast_iter</span> <span class="o">*</span><span class="n">iter</span><span class="p">,</span>
				  <span class="k">union</span> <span class="n">ib_gid</span> <span class="o">*</span><span class="n">gid</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">created</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">queuelen</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">complete</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">send_only</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ipoib_path_iter</span> <span class="o">*</span><span class="n">ipoib_path_iter_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_path_iter_next</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_path_iter</span> <span class="o">*</span><span class="n">iter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_path_iter_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_path_iter</span> <span class="o">*</span><span class="n">iter</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ipoib_path</span> <span class="o">*</span><span class="n">path</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="n">ipoib_mcast_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">mlid</span><span class="p">,</span>
		       <span class="k">union</span> <span class="n">ib_gid</span> <span class="o">*</span><span class="n">mgid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">set_qkey</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ipoib_init_qp</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_transport_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ca</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_transport_dev_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_event_handler</span> <span class="o">*</span><span class="n">handler</span><span class="p">,</span>
		 <span class="k">struct</span> <span class="n">ib_event</span> <span class="o">*</span><span class="n">record</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ipoib_vlan_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">pkey</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_vlan_delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">pkey</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_pkey_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_pkey_dev_delay_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_drain_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">ipoib_set_ethtool_ops</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_set_dev_features</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">hca</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_CM</span>

<span class="cp">#define IPOIB_FLAGS_RC		0x80</span>
<span class="cp">#define IPOIB_FLAGS_UC		0x40</span>

<span class="cm">/* We don&#39;t support UC connections at the moment */</span>
<span class="cp">#define IPOIB_CM_SUPPORTED(ha)   (ha[0] &amp; (IPOIB_FLAGS_RC))</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ipoib_max_conn_qp</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_admin_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">IPOIB_CM_SUPPORTED</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">IPOIB_FLAG_ADMIN_CM</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">neighbour</span> <span class="o">*</span><span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">IPOIB_CM_SUPPORTED</span><span class="p">(</span><span class="n">n</span><span class="o">-&gt;</span><span class="n">ha</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">IPOIB_FLAG_ADMIN_CM</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_up</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>

<span class="p">{</span>
	<span class="k">return</span> <span class="n">test_bit</span><span class="p">(</span><span class="n">IPOIB_FLAG_OPER_UP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">neigh</span><span class="o">-&gt;</span><span class="n">cm</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="nf">ipoib_cm_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">neigh</span><span class="o">-&gt;</span><span class="n">cm</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_cm_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">neigh</span><span class="o">-&gt;</span><span class="n">cm</span> <span class="o">=</span> <span class="n">tx</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_has_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cm</span><span class="p">.</span><span class="n">srq</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ipoib_cm_max_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ipoib_dev_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cm</span><span class="p">.</span><span class="n">max_cm_mtu</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ipoib_cm_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_cm_dev_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_dev_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_cm_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_cm_add_mode_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_dev_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">ipoib_cm_create_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_path</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_destroy_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_skb_too_long</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mtu</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_handle_rx_wc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">wc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_cm_handle_tx_wc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">wc</span><span class="p">);</span>
<span class="cp">#else</span>

<span class="k">struct</span> <span class="n">ipoib_cm_tx</span><span class="p">;</span>

<span class="cp">#define ipoib_max_conn_qp 0</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_admin_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">neighbour</span> <span class="o">*</span><span class="n">n</span><span class="p">)</span>

<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_up</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>

<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="nf">ipoib_cm_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_cm_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_cm_has_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ipoib_cm_max_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">ipoib_cm_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ipoib_cm_dev_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">ipoib_cm_dev_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ipoib_cm_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">ipoib_cm_dev_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="nf">ipoib_cm_create_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ipoib_path</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">ipoib_neigh</span> <span class="o">*</span><span class="n">neigh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">ipoib_cm_destroy_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ipoib_cm_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ipoib_cm_add_mode_attr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_cm_skb_too_long</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mtu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev_kfree_skb_any</span><span class="p">(</span><span class="n">skb</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_cm_handle_rx_wc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">wc</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_cm_handle_tx_wc</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">wc</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG</span>
<span class="kt">void</span> <span class="n">ipoib_create_debug_files</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_delete_debug_files</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ipoib_register_debugfs</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ipoib_unregister_debugfs</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_create_debug_files</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_delete_debug_files</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ipoib_register_debugfs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ipoib_unregister_debugfs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#define ipoib_printk(level, priv, format, arg...)	\</span>
<span class="cp">	printk(level &quot;%s: &quot; format, ((struct ipoib_dev_priv *) priv)-&gt;dev-&gt;name , ## arg)</span>
<span class="cp">#define ipoib_warn(priv, format, arg...)		\</span>
<span class="cp">	ipoib_printk(KERN_WARNING, priv, format , ## arg)</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ipoib_sendq_size</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ipoib_recvq_size</span><span class="p">;</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="n">ipoib_sa_client</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ipoib_debug_level</span><span class="p">;</span>

<span class="cp">#define ipoib_dbg(priv, format, arg...)			\</span>
<span class="cp">	do {						\</span>
<span class="cp">		if (ipoib_debug_level &gt; 0)			\</span>
<span class="cp">			ipoib_printk(KERN_DEBUG, priv, format , ## arg); \</span>
<span class="cp">	} while (0)</span>
<span class="cp">#define ipoib_dbg_mcast(priv, format, arg...)		\</span>
<span class="cp">	do {						\</span>
<span class="cp">		if (mcast_debug_level &gt; 0)		\</span>
<span class="cp">			ipoib_printk(KERN_DEBUG, priv, format , ## arg); \</span>
<span class="cp">	} while (0)</span>
<span class="cp">#else </span><span class="cm">/* CONFIG_INFINIBAND_IPOIB_DEBUG */</span><span class="cp"></span>
<span class="cp">#define ipoib_dbg(priv, format, arg...)			\</span>
<span class="cp">	do { (void) (priv); } while (0)</span>
<span class="cp">#define ipoib_dbg_mcast(priv, format, arg...)		\</span>
<span class="cp">	do { (void) (priv); } while (0)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_INFINIBAND_IPOIB_DEBUG */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_INFINIBAND_IPOIB_DEBUG_DATA</span>
<span class="cp">#define ipoib_dbg_data(priv, format, arg...)		\</span>
<span class="cp">	do {						\</span>
<span class="cp">		if (data_debug_level &gt; 0)		\</span>
<span class="cp">			ipoib_printk(KERN_DEBUG, priv, format , ## arg); \</span>
<span class="cp">	} while (0)</span>
<span class="cp">#else </span><span class="cm">/* CONFIG_INFINIBAND_IPOIB_DEBUG_DATA */</span><span class="cp"></span>
<span class="cp">#define ipoib_dbg_data(priv, format, arg...)		\</span>
<span class="cp">	do { (void) (priv); } while (0)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_INFINIBAND_IPOIB_DEBUG_DATA */</span><span class="cp"></span>

<span class="cp">#define IPOIB_QPN(ha) (be32_to_cpup((__be32 *) ha) &amp; 0xffffff)</span>

<span class="cp">#endif </span><span class="cm">/* _IPOIB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
