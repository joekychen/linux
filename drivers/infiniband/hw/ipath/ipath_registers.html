<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › infiniband › hw › ipath › ipath_registers.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ipath_registers.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2006, 2007 QLogic Corporation. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2003, 2004, 2005, 2006 PathScale, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _IPATH_REGISTERS_H</span>
<span class="cp">#define _IPATH_REGISTERS_H</span>

<span class="cm">/*</span>
<span class="cm"> * This file should only be included by kernel source, and by the diags.  It</span>
<span class="cm"> * defines the registers, and their contents, for InfiniPath chips.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * These are the InfiniPath register and buffer bit definitions,</span>
<span class="cm"> * that are visible to software, and needed only by the kernel</span>
<span class="cm"> * and diag code.  A few, that are visible to protocol and user</span>
<span class="cm"> * code are in ipath_common.h.  Some bits are specific</span>
<span class="cm"> * to a given chip implementation, and have been moved to the</span>
<span class="cm"> * chip-specific source file</span>
<span class="cm"> */</span>

<span class="cm">/* kr_revision bits */</span>
<span class="cp">#define INFINIPATH_R_CHIPREVMINOR_MASK 0xFF</span>
<span class="cp">#define INFINIPATH_R_CHIPREVMINOR_SHIFT 0</span>
<span class="cp">#define INFINIPATH_R_CHIPREVMAJOR_MASK 0xFF</span>
<span class="cp">#define INFINIPATH_R_CHIPREVMAJOR_SHIFT 8</span>
<span class="cp">#define INFINIPATH_R_ARCH_MASK 0xFF</span>
<span class="cp">#define INFINIPATH_R_ARCH_SHIFT 16</span>
<span class="cp">#define INFINIPATH_R_SOFTWARE_MASK 0xFF</span>
<span class="cp">#define INFINIPATH_R_SOFTWARE_SHIFT 24</span>
<span class="cp">#define INFINIPATH_R_BOARDID_MASK 0xFF</span>
<span class="cp">#define INFINIPATH_R_BOARDID_SHIFT 32</span>

<span class="cm">/* kr_control bits */</span>
<span class="cp">#define INFINIPATH_C_FREEZEMODE 0x00000002</span>
<span class="cp">#define INFINIPATH_C_LINKENABLE 0x00000004</span>

<span class="cm">/* kr_sendctrl bits */</span>
<span class="cp">#define INFINIPATH_S_DISARMPIOBUF_SHIFT 16</span>
<span class="cp">#define INFINIPATH_S_UPDTHRESH_SHIFT 24</span>
<span class="cp">#define INFINIPATH_S_UPDTHRESH_MASK 0x1f</span>

<span class="cp">#define IPATH_S_ABORT		0</span>
<span class="cp">#define IPATH_S_PIOINTBUFAVAIL	1</span>
<span class="cp">#define IPATH_S_PIOBUFAVAILUPD	2</span>
<span class="cp">#define IPATH_S_PIOENABLE	3</span>
<span class="cp">#define IPATH_S_SDMAINTENABLE	9</span>
<span class="cp">#define IPATH_S_SDMASINGLEDESCRIPTOR	10</span>
<span class="cp">#define IPATH_S_SDMAENABLE	11</span>
<span class="cp">#define IPATH_S_SDMAHALT	12</span>
<span class="cp">#define IPATH_S_DISARM		31</span>

<span class="cp">#define INFINIPATH_S_ABORT		(1U &lt;&lt; IPATH_S_ABORT)</span>
<span class="cp">#define INFINIPATH_S_PIOINTBUFAVAIL	(1U &lt;&lt; IPATH_S_PIOINTBUFAVAIL)</span>
<span class="cp">#define INFINIPATH_S_PIOBUFAVAILUPD	(1U &lt;&lt; IPATH_S_PIOBUFAVAILUPD)</span>
<span class="cp">#define INFINIPATH_S_PIOENABLE		(1U &lt;&lt; IPATH_S_PIOENABLE)</span>
<span class="cp">#define INFINIPATH_S_SDMAINTENABLE	(1U &lt;&lt; IPATH_S_SDMAINTENABLE)</span>
<span class="cp">#define INFINIPATH_S_SDMASINGLEDESCRIPTOR \</span>
<span class="cp">					(1U &lt;&lt; IPATH_S_SDMASINGLEDESCRIPTOR)</span>
<span class="cp">#define INFINIPATH_S_SDMAENABLE		(1U &lt;&lt; IPATH_S_SDMAENABLE)</span>
<span class="cp">#define INFINIPATH_S_SDMAHALT		(1U &lt;&lt; IPATH_S_SDMAHALT)</span>
<span class="cp">#define INFINIPATH_S_DISARM		(1U &lt;&lt; IPATH_S_DISARM)</span>

<span class="cm">/* kr_rcvctrl bits that are the same on multiple chips */</span>
<span class="cp">#define INFINIPATH_R_PORTENABLE_SHIFT 0</span>
<span class="cp">#define INFINIPATH_R_QPMAP_ENABLE (1ULL &lt;&lt; 38)</span>

<span class="cm">/* kr_intstatus, kr_intclear, kr_intmask bits */</span>
<span class="cp">#define INFINIPATH_I_SDMAINT		0x8000000000000000ULL</span>
<span class="cp">#define INFINIPATH_I_SDMADISABLED	0x4000000000000000ULL</span>
<span class="cp">#define INFINIPATH_I_ERROR		0x0000000080000000ULL</span>
<span class="cp">#define INFINIPATH_I_SPIOSENT		0x0000000040000000ULL</span>
<span class="cp">#define INFINIPATH_I_SPIOBUFAVAIL	0x0000000020000000ULL</span>
<span class="cp">#define INFINIPATH_I_GPIO		0x0000000010000000ULL</span>
<span class="cp">#define INFINIPATH_I_JINT		0x0000000004000000ULL</span>

<span class="cm">/* kr_errorstatus, kr_errorclear, kr_errormask bits */</span>
<span class="cp">#define INFINIPATH_E_RFORMATERR			0x0000000000000001ULL</span>
<span class="cp">#define INFINIPATH_E_RVCRC			0x0000000000000002ULL</span>
<span class="cp">#define INFINIPATH_E_RICRC			0x0000000000000004ULL</span>
<span class="cp">#define INFINIPATH_E_RMINPKTLEN			0x0000000000000008ULL</span>
<span class="cp">#define INFINIPATH_E_RMAXPKTLEN			0x0000000000000010ULL</span>
<span class="cp">#define INFINIPATH_E_RLONGPKTLEN		0x0000000000000020ULL</span>
<span class="cp">#define INFINIPATH_E_RSHORTPKTLEN		0x0000000000000040ULL</span>
<span class="cp">#define INFINIPATH_E_RUNEXPCHAR			0x0000000000000080ULL</span>
<span class="cp">#define INFINIPATH_E_RUNSUPVL			0x0000000000000100ULL</span>
<span class="cp">#define INFINIPATH_E_REBP			0x0000000000000200ULL</span>
<span class="cp">#define INFINIPATH_E_RIBFLOW			0x0000000000000400ULL</span>
<span class="cp">#define INFINIPATH_E_RBADVERSION		0x0000000000000800ULL</span>
<span class="cp">#define INFINIPATH_E_RRCVEGRFULL		0x0000000000001000ULL</span>
<span class="cp">#define INFINIPATH_E_RRCVHDRFULL		0x0000000000002000ULL</span>
<span class="cp">#define INFINIPATH_E_RBADTID			0x0000000000004000ULL</span>
<span class="cp">#define INFINIPATH_E_RHDRLEN			0x0000000000008000ULL</span>
<span class="cp">#define INFINIPATH_E_RHDR			0x0000000000010000ULL</span>
<span class="cp">#define INFINIPATH_E_RIBLOSTLINK		0x0000000000020000ULL</span>
<span class="cp">#define INFINIPATH_E_SENDSPECIALTRIGGER		0x0000000008000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMADISABLED		0x0000000010000000ULL</span>
<span class="cp">#define INFINIPATH_E_SMINPKTLEN			0x0000000020000000ULL</span>
<span class="cp">#define INFINIPATH_E_SMAXPKTLEN			0x0000000040000000ULL</span>
<span class="cp">#define INFINIPATH_E_SUNDERRUN			0x0000000080000000ULL</span>
<span class="cp">#define INFINIPATH_E_SPKTLEN			0x0000000100000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDROPPEDSMPPKT		0x0000000200000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDROPPEDDATAPKT		0x0000000400000000ULL</span>
<span class="cp">#define INFINIPATH_E_SPIOARMLAUNCH		0x0000000800000000ULL</span>
<span class="cp">#define INFINIPATH_E_SUNEXPERRPKTNUM		0x0000001000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SUNSUPVL			0x0000002000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SENDBUFMISUSE		0x0000004000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMAGENMISMATCH		0x0000008000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMAOUTOFBOUND		0x0000010000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMATAILOUTOFBOUND		0x0000020000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMABASE			0x0000040000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMA1STDESC		0x0000080000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMARPYTAG			0x0000100000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMADWEN			0x0000200000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMAMISSINGDW		0x0000400000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMAUNEXPDATA		0x0000800000000000ULL</span>
<span class="cp">#define INFINIPATH_E_IBSTATUSCHANGED		0x0001000000000000ULL</span>
<span class="cp">#define INFINIPATH_E_INVALIDADDR		0x0002000000000000ULL</span>
<span class="cp">#define INFINIPATH_E_RESET			0x0004000000000000ULL</span>
<span class="cp">#define INFINIPATH_E_HARDWARE			0x0008000000000000ULL</span>
<span class="cp">#define INFINIPATH_E_SDMADESCADDRMISALIGN	0x0010000000000000ULL</span>
<span class="cp">#define INFINIPATH_E_INVALIDEEPCMD		0x0020000000000000ULL</span>

<span class="cm">/*</span>
<span class="cm"> * this is used to print &quot;common&quot; packet errors only when the</span>
<span class="cm"> * __IPATH_ERRPKTDBG bit is set in ipath_debug.</span>
<span class="cm"> */</span>
<span class="cp">#define INFINIPATH_E_PKTERRS ( INFINIPATH_E_SPKTLEN \</span>
<span class="cp">		| INFINIPATH_E_SDROPPEDDATAPKT | INFINIPATH_E_RVCRC \</span>
<span class="cp">		| INFINIPATH_E_RICRC | INFINIPATH_E_RSHORTPKTLEN \</span>
<span class="cp">		| INFINIPATH_E_REBP )</span>

<span class="cm">/* Convenience for decoding Send DMA errors */</span>
<span class="cp">#define INFINIPATH_E_SDMAERRS ( \</span>
<span class="cp">	INFINIPATH_E_SDMAGENMISMATCH | INFINIPATH_E_SDMAOUTOFBOUND | \</span>
<span class="cp">	INFINIPATH_E_SDMATAILOUTOFBOUND | INFINIPATH_E_SDMABASE | \</span>
<span class="cp">	INFINIPATH_E_SDMA1STDESC | INFINIPATH_E_SDMARPYTAG | \</span>
<span class="cp">	INFINIPATH_E_SDMADWEN | INFINIPATH_E_SDMAMISSINGDW | \</span>
<span class="cp">	INFINIPATH_E_SDMAUNEXPDATA | \</span>
<span class="cp">	INFINIPATH_E_SDMADESCADDRMISALIGN | \</span>
<span class="cp">	INFINIPATH_E_SDMADISABLED | \</span>
<span class="cp">	INFINIPATH_E_SENDBUFMISUSE)</span>

<span class="cm">/* kr_hwerrclear, kr_hwerrmask, kr_hwerrstatus, bits */</span>
<span class="cm">/* TXEMEMPARITYERR bit 0: PIObuf, 1: PIOpbc, 2: launchfifo</span>
<span class="cm"> * RXEMEMPARITYERR bit 0: rcvbuf, 1: lookupq, 2:  expTID, 3: eagerTID</span>
<span class="cm"> * 		bit 4: flag buffer, 5: datainfo, 6: header info */</span>
<span class="cp">#define INFINIPATH_HWE_TXEMEMPARITYERR_MASK 0xFULL</span>
<span class="cp">#define INFINIPATH_HWE_TXEMEMPARITYERR_SHIFT 40</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_MASK 0x7FULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_SHIFT 44</span>
<span class="cp">#define INFINIPATH_HWE_IBCBUSTOSPCPARITYERR 0x4000000000000000ULL</span>
<span class="cp">#define INFINIPATH_HWE_IBCBUSFRSPCPARITYERR 0x8000000000000000ULL</span>
<span class="cm">/* txe mem parity errors (shift by INFINIPATH_HWE_TXEMEMPARITYERR_SHIFT) */</span>
<span class="cp">#define INFINIPATH_HWE_TXEMEMPARITYERR_PIOBUF	0x1ULL</span>
<span class="cp">#define INFINIPATH_HWE_TXEMEMPARITYERR_PIOPBC	0x2ULL</span>
<span class="cp">#define INFINIPATH_HWE_TXEMEMPARITYERR_PIOLAUNCHFIFO 0x4ULL</span>
<span class="cm">/* rxe mem parity errors (shift by INFINIPATH_HWE_RXEMEMPARITYERR_SHIFT) */</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_RCVBUF   0x01ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_LOOKUPQ  0x02ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_EXPTID   0x04ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_EAGERTID 0x08ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_FLAGBUF  0x10ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_DATAINFO 0x20ULL</span>
<span class="cp">#define INFINIPATH_HWE_RXEMEMPARITYERR_HDRINFO  0x40ULL</span>
<span class="cm">/* waldo specific -- find the rest in ipath_6110.c */</span>
<span class="cp">#define INFINIPATH_HWE_RXDSYNCMEMPARITYERR  0x0000000400000000ULL</span>
<span class="cm">/* 6120/7220 specific -- find the rest in ipath_6120.c and ipath_7220.c */</span>
<span class="cp">#define INFINIPATH_HWE_MEMBISTFAILED	0x0040000000000000ULL</span>

<span class="cm">/* kr_hwdiagctrl bits */</span>
<span class="cp">#define INFINIPATH_DC_FORCETXEMEMPARITYERR_MASK 0xFULL</span>
<span class="cp">#define INFINIPATH_DC_FORCETXEMEMPARITYERR_SHIFT 40</span>
<span class="cp">#define INFINIPATH_DC_FORCERXEMEMPARITYERR_MASK 0x7FULL</span>
<span class="cp">#define INFINIPATH_DC_FORCERXEMEMPARITYERR_SHIFT 44</span>
<span class="cp">#define INFINIPATH_DC_FORCERXDSYNCMEMPARITYERR  0x0000000400000000ULL</span>
<span class="cp">#define INFINIPATH_DC_COUNTERDISABLE            0x1000000000000000ULL</span>
<span class="cp">#define INFINIPATH_DC_COUNTERWREN               0x2000000000000000ULL</span>
<span class="cp">#define INFINIPATH_DC_FORCEIBCBUSTOSPCPARITYERR 0x4000000000000000ULL</span>
<span class="cp">#define INFINIPATH_DC_FORCEIBCBUSFRSPCPARITYERR 0x8000000000000000ULL</span>

<span class="cm">/* kr_ibcctrl bits */</span>
<span class="cp">#define INFINIPATH_IBCC_FLOWCTRLPERIOD_MASK 0xFFULL</span>
<span class="cp">#define INFINIPATH_IBCC_FLOWCTRLPERIOD_SHIFT 0</span>
<span class="cp">#define INFINIPATH_IBCC_FLOWCTRLWATERMARK_MASK 0xFFULL</span>
<span class="cp">#define INFINIPATH_IBCC_FLOWCTRLWATERMARK_SHIFT 8</span>
<span class="cp">#define INFINIPATH_IBCC_LINKINITCMD_MASK 0x3ULL</span>
<span class="cp">#define INFINIPATH_IBCC_LINKINITCMD_DISABLE 1</span>
<span class="cm">/* cycle through TS1/TS2 till OK */</span>
<span class="cp">#define INFINIPATH_IBCC_LINKINITCMD_POLL 2</span>
<span class="cm">/* wait for TS1, then go on */</span>
<span class="cp">#define INFINIPATH_IBCC_LINKINITCMD_SLEEP 3</span>
<span class="cp">#define INFINIPATH_IBCC_LINKINITCMD_SHIFT 16</span>
<span class="cp">#define INFINIPATH_IBCC_LINKCMD_MASK 0x3ULL</span>
<span class="cp">#define INFINIPATH_IBCC_LINKCMD_DOWN 1		</span><span class="cm">/* move to 0x11 */</span><span class="cp"></span>
<span class="cp">#define INFINIPATH_IBCC_LINKCMD_ARMED 2		</span><span class="cm">/* move to 0x21 */</span><span class="cp"></span>
<span class="cp">#define INFINIPATH_IBCC_LINKCMD_ACTIVE 3	</span><span class="cm">/* move to 0x31 */</span><span class="cp"></span>
<span class="cp">#define INFINIPATH_IBCC_LINKCMD_SHIFT 18</span>
<span class="cp">#define INFINIPATH_IBCC_MAXPKTLEN_MASK 0x7FFULL</span>
<span class="cp">#define INFINIPATH_IBCC_MAXPKTLEN_SHIFT 20</span>
<span class="cp">#define INFINIPATH_IBCC_PHYERRTHRESHOLD_MASK 0xFULL</span>
<span class="cp">#define INFINIPATH_IBCC_PHYERRTHRESHOLD_SHIFT 32</span>
<span class="cp">#define INFINIPATH_IBCC_OVERRUNTHRESHOLD_MASK 0xFULL</span>
<span class="cp">#define INFINIPATH_IBCC_OVERRUNTHRESHOLD_SHIFT 36</span>
<span class="cp">#define INFINIPATH_IBCC_CREDITSCALE_MASK 0x7ULL</span>
<span class="cp">#define INFINIPATH_IBCC_CREDITSCALE_SHIFT 40</span>
<span class="cp">#define INFINIPATH_IBCC_LOOPBACK             0x8000000000000000ULL</span>
<span class="cp">#define INFINIPATH_IBCC_LINKDOWNDEFAULTSTATE 0x4000000000000000ULL</span>

<span class="cm">/* kr_ibcstatus bits */</span>
<span class="cp">#define INFINIPATH_IBCS_LINKTRAININGSTATE_SHIFT 0</span>
<span class="cp">#define INFINIPATH_IBCS_LINKSTATE_MASK 0x7</span>

<span class="cp">#define INFINIPATH_IBCS_TXREADY       0x40000000</span>
<span class="cp">#define INFINIPATH_IBCS_TXCREDITOK    0x80000000</span>
<span class="cm">/* link training states (shift by</span>
<span class="cm">   INFINIPATH_IBCS_LINKTRAININGSTATE_SHIFT) */</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_DISABLED	0x00</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_LINKUP		0x01</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_POLLACTIVE	0x02</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_POLLQUIET	0x03</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_SLEEPDELAY	0x04</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_SLEEPQUIET	0x05</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_CFGDEBOUNCE	0x08</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_CFGRCVFCFG	0x09</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_CFGWAITRMT	0x0a</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_CFGIDLE	0x0b</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_RECOVERRETRAIN	0x0c</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_RECOVERWAITRMT	0x0e</span>
<span class="cp">#define INFINIPATH_IBCS_LT_STATE_RECOVERIDLE	0x0f</span>
<span class="cm">/* link state machine states (shift by ibcs_ls_shift) */</span>
<span class="cp">#define INFINIPATH_IBCS_L_STATE_DOWN		0x0</span>
<span class="cp">#define INFINIPATH_IBCS_L_STATE_INIT		0x1</span>
<span class="cp">#define INFINIPATH_IBCS_L_STATE_ARM		0x2</span>
<span class="cp">#define INFINIPATH_IBCS_L_STATE_ACTIVE		0x3</span>
<span class="cp">#define INFINIPATH_IBCS_L_STATE_ACT_DEFER	0x4</span>


<span class="cm">/* kr_extstatus bits */</span>
<span class="cp">#define INFINIPATH_EXTS_SERDESPLLLOCK 0x1</span>
<span class="cp">#define INFINIPATH_EXTS_GPIOIN_MASK 0xFFFFULL</span>
<span class="cp">#define INFINIPATH_EXTS_GPIOIN_SHIFT 48</span>

<span class="cm">/* kr_extctrl bits */</span>
<span class="cp">#define INFINIPATH_EXTC_GPIOINVERT_MASK 0xFFFFULL</span>
<span class="cp">#define INFINIPATH_EXTC_GPIOINVERT_SHIFT 32</span>
<span class="cp">#define INFINIPATH_EXTC_GPIOOE_MASK 0xFFFFULL</span>
<span class="cp">#define INFINIPATH_EXTC_GPIOOE_SHIFT 48</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESENABLE         0x80000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESCONNECT        0x40000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESENTRUNKING     0x20000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESDISRXFIFO      0x10000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESENPLPBK1       0x08000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESENPLPBK2       0x04000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_SERDESENENCDEC       0x02000000ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LED1SECPORT_ON       0x00000020ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LED2SECPORT_ON       0x00000010ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LED1PRIPORT_ON       0x00000008ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LED2PRIPORT_ON       0x00000004ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LEDGBLOK_ON          0x00000002ULL</span>
<span class="cp">#define INFINIPATH_EXTC_LEDGBLERR_OFF        0x00000001ULL</span>

<span class="cm">/* kr_partitionkey bits */</span>
<span class="cp">#define INFINIPATH_PKEY_SIZE 16</span>
<span class="cp">#define INFINIPATH_PKEY_MASK 0xFFFF</span>
<span class="cp">#define INFINIPATH_PKEY_DEFAULT_PKEY 0xFFFF</span>

<span class="cm">/* kr_serdesconfig0 bits */</span>
<span class="cp">#define INFINIPATH_SERDC0_RESET_MASK  0xfULL	</span><span class="cm">/* overal reset bits */</span><span class="cp"></span>
<span class="cp">#define INFINIPATH_SERDC0_RESET_PLL   0x10000000ULL	</span><span class="cm">/* pll reset */</span><span class="cp"></span>
<span class="cm">/* tx idle enables (per lane) */</span>
<span class="cp">#define INFINIPATH_SERDC0_TXIDLE      0xF000ULL</span>
<span class="cm">/* rx detect enables (per lane) */</span>
<span class="cp">#define INFINIPATH_SERDC0_RXDETECT_EN 0xF0000ULL</span>
<span class="cm">/* L1 Power down; use with RXDETECT, Otherwise not used on IB side */</span>
<span class="cp">#define INFINIPATH_SERDC0_L1PWR_DN	 0xF0ULL</span>

<span class="cm">/* common kr_xgxsconfig bits (or safe in all, even if not implemented) */</span>
<span class="cp">#define INFINIPATH_XGXS_RX_POL_SHIFT 19</span>
<span class="cp">#define INFINIPATH_XGXS_RX_POL_MASK 0xfULL</span>


<span class="cm">/*</span>
<span class="cm"> * IPATH_PIO_MAXIBHDR is the max IB header size allowed for in our</span>
<span class="cm"> * PIO send buffers.  This is well beyond anything currently</span>
<span class="cm"> * defined in the InfiniBand spec.</span>
<span class="cm"> */</span>
<span class="cp">#define IPATH_PIO_MAXIBHDR 128</span>

<span class="k">typedef</span> <span class="n">u64</span> <span class="n">ipath_err_t</span><span class="p">;</span>

<span class="cm">/* The following change with the type of device, so</span>
<span class="cm"> * need to be part of the ipath_devdata struct, or</span>
<span class="cm"> * we could have problems plugging in devices of</span>
<span class="cm"> * different types (e.g. one HT, one PCIE)</span>
<span class="cm"> * in one system, to be managed by one driver.</span>
<span class="cm"> * On the other hand, this file is may also be included</span>
<span class="cm"> * by other code, so leave the declarations here</span>
<span class="cm"> * temporarily. Minor footprint issue if common-model</span>
<span class="cm"> * linker used, none if C89+ linker used.</span>
<span class="cm"> */</span>

<span class="cm">/* mask of defined bits for various registers */</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">infinipath_i_bitsextant</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">ipath_err_t</span> <span class="n">infinipath_e_bitsextant</span><span class="p">,</span> <span class="n">infinipath_hwe_bitsextant</span><span class="p">;</span>

<span class="cm">/* masks that are different in various chips, or only exist in some chips */</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">infinipath_i_rcvavail_mask</span><span class="p">,</span> <span class="n">infinipath_i_rcvurg_mask</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * These are the infinipath general register numbers (not offsets).</span>
<span class="cm"> * The kernel registers are used directly, those beyond the kernel</span>
<span class="cm"> * registers are calculated from one of the base registers.  The use of</span>
<span class="cm"> * an integer type doesn&#39;t allow type-checking as thorough as, say,</span>
<span class="cm"> * an enum but allows for better hiding of chip differences.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">ipath_kreg</span><span class="p">,</span>	<span class="cm">/* infinipath general registers */</span>
 <span class="n">ipath_creg</span><span class="p">,</span>			<span class="cm">/* infinipath counter registers */</span>
 <span class="n">ipath_sreg</span><span class="p">;</span>			<span class="cm">/* kernel-only, infinipath send registers */</span>

<span class="cm">/*</span>
<span class="cm"> * These are the chip registers common to all infinipath chips, and</span>
<span class="cm"> * used both by the kernel and the diagnostics or other user code.</span>
<span class="cm"> * They are all implemented such that 64 bit accesses work.</span>
<span class="cm"> * Some implement no more than 32 bits.  Because 64 bit reads</span>
<span class="cm"> * require 2 HT cmds on opteron, we access those with 32 bit</span>
<span class="cm"> * reads for efficiency (they are written as 64 bits, since</span>
<span class="cm"> * the extra 32 bits are nearly free on writes, and it slightly reduces</span>
<span class="cm"> * complexity).  The rest are all accessed as 64 bits.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ipath_kregs</span> <span class="p">{</span>
	<span class="cm">/* These are the 32 bit group */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_control</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_counterregbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_intmask</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_intstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pagealign</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_portcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvtidbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvtidcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvegrbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvegrcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_scratch</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendpiobufbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendpiobufcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendpiosize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendregbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_userregbase</span><span class="p">;</span>
	<span class="cm">/* These are the 64 bit group */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_debugport</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_debugportselect</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_errorclear</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_errormask</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_errorstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_extctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_extstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_gpio_clear</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_gpio_mask</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_gpio_out</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_gpio_status</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_hwdiagctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_hwerrclear</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_hwerrmask</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_hwerrstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibcctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibcstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_intblocked</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_intclear</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_interruptconfig</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_mdio</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_partitionkey</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvbthqp</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvbufbase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvbufsize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvhdrcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvhdrentsize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvhdrsize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvintmembase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvintmemsize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_revision</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendbuffererror</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_sendpioavailaddr</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_serdesconfig0</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_serdesconfig1</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_serdesstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_txintmembase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_txintmemsize</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_xgxsconfig</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibpllcfg</span><span class="p">;</span>
	<span class="cm">/* use these two (and the following N ports) only with</span>
<span class="cm">	 * ipath_k*_kreg64_port(); not *kreg64() */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvhdraddr</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvhdrtailaddr</span><span class="p">;</span>

	<span class="cm">/* remaining registers are not present on all types of infinipath</span>
<span class="cm">	   chips  */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_rcvpktledcnt</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcierbuftestreg0</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcierbuftestreg1</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq0serdesconfig0</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq0serdesconfig1</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq0serdesstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq1serdesconfig0</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq1serdesconfig1</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcieq1serdesstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_hrtbt_guid</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibcddrctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibcddrstatus</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_jintreload</span><span class="p">;</span>

	<span class="cm">/* send dma related regs */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmabase</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmalengen</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmatail</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmahead</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmaheadaddr</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmabufmask0</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmabufmask1</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmabufmask2</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_senddmastatus</span><span class="p">;</span>

	<span class="cm">/* SerDes related regs (IBA7220-only) */</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ibserdesctrl</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ib_epbacc</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ib_epbtrans</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcie_epbacc</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_pcie_epbtrans</span><span class="p">;</span>
	<span class="n">ipath_kreg</span> <span class="n">kr_ib_ddsrxeq</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ipath_cregs</span> <span class="p">{</span>
	<span class="n">ipath_creg</span> <span class="n">cr_badformatcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_erricrccnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errlinkcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errlpcrccnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errpkey</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errrcvflowctrlcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_err_rlencnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errslencnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errtidfull</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errtidvalid</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_errvcrccnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_ibstatuschange</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_intcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_invalidrlencnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_invalidslencnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_lbflowstallcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_iblinkdowncnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_iblinkerrrecovcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_ibsymbolerrcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_pktrcvcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_pktrcvflowctrlcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_pktsendcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_pktsendflowcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_portovflcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rcvebpcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rcvovflcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rxdroppktcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_senddropped</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_sendstallcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_sendunderruncnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_unsupvlcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_wordrcvcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_wordsendcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_vl15droppedpktcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rxotherlocalphyerrcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_excessbufferovflcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_locallinkintegrityerrcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rxvlerrcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_rxdlidfltrcnt</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psstat</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psstart</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psinterval</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psrcvdatacount</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psrcvpktscount</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psxmitdatacount</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psxmitpktscount</span><span class="p">;</span>
	<span class="n">ipath_creg</span> <span class="n">cr_psxmitwaitcount</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif				</span><span class="cm">/* _IPATH_REGISTERS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
