<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › infiniband › hw › mthca › mthca_dev.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mthca_dev.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Sun Microsystems, Inc. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005, 2006 Cisco Systems.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Mellanox Technologies. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2004 Voltaire, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef MTHCA_DEV_H</span>
<span class="cp">#define MTHCA_DEV_H</span>

<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/semaphore.h&gt;</span>

<span class="cp">#include &quot;mthca_provider.h&quot;</span>
<span class="cp">#include &quot;mthca_doorbell.h&quot;</span>

<span class="cp">#define DRV_NAME	&quot;ib_mthca&quot;</span>
<span class="cp">#define PFX		DRV_NAME &quot;: &quot;</span>
<span class="cp">#define DRV_VERSION	&quot;1.0&quot;</span>
<span class="cp">#define DRV_RELDATE	&quot;April 4, 2008&quot;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_FLAG_DDR_HIDDEN</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_SRQ</span>        <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_MSI_X</span>      <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_NO_LAM</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_FMR</span>        <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_MEMFREE</span>    <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_PCIE</span>       <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">MTHCA_FLAG_SINAI_OPT</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_MAX_PORTS</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_BOARD_ID_LEN</span> <span class="o">=</span> <span class="mi">64</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_EQ_CONTEXT_SIZE</span> <span class="o">=</span>  <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">MTHCA_CQ_CONTEXT_SIZE</span> <span class="o">=</span>  <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">MTHCA_QP_CONTEXT_SIZE</span> <span class="o">=</span> <span class="mh">0x200</span><span class="p">,</span>
	<span class="n">MTHCA_RDB_ENTRY_SIZE</span>  <span class="o">=</span>  <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">MTHCA_AV_SIZE</span>         <span class="o">=</span>  <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">MTHCA_MGM_ENTRY_SIZE</span>  <span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>

	<span class="cm">/* Arbel FW gives us these, but we need them for Tavor */</span>
	<span class="n">MTHCA_MPT_ENTRY_SIZE</span>  <span class="o">=</span>  <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">MTHCA_MTT_SEG_SIZE</span>    <span class="o">=</span>  <span class="mh">0x40</span><span class="p">,</span>

	<span class="n">MTHCA_QP_PER_MGM</span>      <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">MTHCA_MGM_ENTRY_SIZE</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_EQ_CMD</span><span class="p">,</span>
	<span class="n">MTHCA_EQ_ASYNC</span><span class="p">,</span>
	<span class="n">MTHCA_EQ_COMP</span><span class="p">,</span>
	<span class="n">MTHCA_NUM_EQ</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_OPCODE_NOP</span>            <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_RDMA_WRITE</span>     <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_RDMA_WRITE_IMM</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_SEND</span>           <span class="o">=</span> <span class="mh">0x0a</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_SEND_IMM</span>       <span class="o">=</span> <span class="mh">0x0b</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_RDMA_READ</span>      <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_ATOMIC_CS</span>      <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_ATOMIC_FA</span>      <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_BIND_MW</span>        <span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="n">MTHCA_OPCODE_INVALID</span>        <span class="o">=</span> <span class="mh">0xff</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_CMD_USE_EVENTS</span>         <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MTHCA_CMD_POST_DOORBELLS</span>     <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MTHCA_CMD_NUM_DBELL_DWORDS</span> <span class="o">=</span> <span class="mi">8</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_cmd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_pool</span>          <span class="o">*</span><span class="n">pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>              <span class="n">hcr_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span> 	  <span class="n">poll_sem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span> 	  <span class="n">event_sem</span><span class="p">;</span>
	<span class="kt">int</span>              	  <span class="n">max_cmds</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                <span class="n">context_lock</span><span class="p">;</span>
	<span class="kt">int</span>                       <span class="n">free_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_cmd_context</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="n">u16</span>                       <span class="n">token_mask</span><span class="p">;</span>
	<span class="n">u32</span>                       <span class="n">flags</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>             <span class="o">*</span><span class="n">dbell_map</span><span class="p">;</span>
	<span class="n">u16</span>                       <span class="n">dbell_offsets</span><span class="p">[</span><span class="n">MTHCA_CMD_NUM_DBELL_DWORDS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_limits</span> <span class="p">{</span>
	<span class="kt">int</span>      <span class="n">num_ports</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">vl_cap</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">mtu_cap</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">gid_table_len</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">pkey_table_len</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">local_ca_ack_delay</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_uars</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">max_sg</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_qps</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">max_wqes</span><span class="p">;</span>
	<span class="kt">int</span>	 <span class="n">max_desc_sz</span><span class="p">;</span>
	<span class="kt">int</span>	 <span class="n">max_qp_init_rdma</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_qps</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_srqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">max_srq_wqes</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">max_srq_sge</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_srqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_eecs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_eecs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_cqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">max_cqes</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_cqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_eqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_eqs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_mpts</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_mtt_segs</span><span class="p">;</span>
	<span class="kt">int</span>	 <span class="n">mtt_seg_size</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">fmr_reserved_mtts</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_mtts</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_mrws</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_uars</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_mgms</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_amgms</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_mcgs</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">num_pds</span><span class="p">;</span>
	<span class="kt">int</span>      <span class="n">reserved_pds</span><span class="p">;</span>
	<span class="n">u32</span>      <span class="n">page_size_cap</span><span class="p">;</span>
	<span class="n">u32</span>      <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span>      <span class="n">stat_rate_support</span><span class="p">;</span>
	<span class="n">u8</span>       <span class="n">port_width_cap</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="p">{</span>
	<span class="n">u32</span>            <span class="n">last</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">top</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">max</span><span class="p">;</span>
	<span class="n">u32</span>            <span class="n">mask</span><span class="p">;</span>
	<span class="n">spinlock_t</span>     <span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_array</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">void</span>    <span class="o">**</span><span class="n">page</span><span class="p">;</span>
		<span class="kt">int</span>       <span class="n">used</span><span class="p">;</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">page_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_uar_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="n">alloc</span><span class="p">;</span>
	<span class="n">u64</span>                <span class="n">uarc_base</span><span class="p">;</span>
	<span class="kt">int</span>                <span class="n">uarc_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_pd_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="n">alloc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_buddy</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bits</span><span class="p">;</span>
	<span class="kt">int</span>	       <span class="o">*</span><span class="n">num_free</span><span class="p">;</span>
	<span class="kt">int</span>             <span class="n">max_order</span><span class="p">;</span>
	<span class="n">spinlock_t</span>      <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_mr_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span>      <span class="n">mpt_alloc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_buddy</span>      <span class="n">mtt_buddy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_buddy</span>     <span class="o">*</span><span class="n">fmr_mtt_buddy</span><span class="p">;</span>
	<span class="n">u64</span>                     <span class="n">mtt_base</span><span class="p">;</span>
	<span class="n">u64</span>                     <span class="n">mpt_base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">mtt_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">mpt_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="n">__iomem</span>   <span class="o">*</span><span class="n">mpt_base</span><span class="p">;</span>
		<span class="kt">void</span> <span class="n">__iomem</span>   <span class="o">*</span><span class="n">mtt_base</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">mthca_buddy</span> <span class="n">mtt_buddy</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">tavor_fmr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_eq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="n">alloc</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>      <span class="o">*</span><span class="n">clr_int</span><span class="p">;</span>
	<span class="n">u32</span>                <span class="n">clr_mask</span><span class="p">;</span>
	<span class="n">u32</span>                <span class="n">arm_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_eq</span>    <span class="n">eq</span><span class="p">[</span><span class="n">MTHCA_NUM_EQ</span><span class="p">];</span>
	<span class="n">u64</span>                <span class="n">icm_virt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span>       <span class="o">*</span><span class="n">icm_page</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>         <span class="n">icm_dma</span><span class="p">;</span>
	<span class="kt">int</span>                <span class="n">have_irq</span><span class="p">;</span>
	<span class="n">u8</span>                 <span class="n">inta_pin</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_cq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> 	<span class="n">alloc</span><span class="p">;</span>
	<span class="n">spinlock_t</span>         	<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_array</span>      <span class="n">cq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_srq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> 	<span class="n">alloc</span><span class="p">;</span>
	<span class="n">spinlock_t</span>         	<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_array</span>      <span class="n">srq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_qp_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span>     	<span class="n">alloc</span><span class="p">;</span>
	<span class="n">u32</span>                    	<span class="n">rdb_base</span><span class="p">;</span>
	<span class="kt">int</span>                    	<span class="n">rdb_shift</span><span class="p">;</span>
	<span class="kt">int</span>                    	<span class="n">sqp_start</span><span class="p">;</span>
	<span class="n">spinlock_t</span>             	<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_array</span>     	<span class="n">qp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">qp_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">eqp_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">rdb_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_av_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_pool</span>   <span class="o">*</span><span class="n">pool</span><span class="p">;</span>
	<span class="kt">int</span>                <span class="n">num_ddr_avs</span><span class="p">;</span>
	<span class="n">u64</span>                <span class="n">ddr_av_base</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>      <span class="o">*</span><span class="n">av_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="n">alloc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_mcg_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_alloc</span> 	<span class="n">alloc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_icm_table</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mthca_catas_err</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">map</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">mutex</span> <span class="n">mthca_device_mutex</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">mthca_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_device</span>  <span class="n">ib_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>   <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>

	<span class="kt">int</span>          	 <span class="n">hca_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	 <span class="n">mthca_flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">device_cap_flags</span><span class="p">;</span>

	<span class="n">u32</span>              <span class="n">rev_id</span><span class="p">;</span>
	<span class="kt">char</span>             <span class="n">board_id</span><span class="p">[</span><span class="n">MTHCA_BOARD_ID_LEN</span><span class="p">];</span>

	<span class="cm">/* firmware info */</span>
	<span class="n">u64</span>              <span class="n">fw_ver</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">fw_start</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">fw_end</span><span class="p">;</span>
		<span class="p">}</span>        <span class="n">tavor</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">clr_int_base</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">eq_arm_base</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">eq_set_ci_base</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">mthca_icm</span> <span class="o">*</span><span class="n">fw_icm</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">mthca_icm</span> <span class="o">*</span><span class="n">aux_icm</span><span class="p">;</span>
			<span class="n">u16</span> <span class="n">fw_pages</span><span class="p">;</span>
		<span class="p">}</span>        <span class="n">arbel</span><span class="p">;</span>
	<span class="p">}</span>                <span class="n">fw</span><span class="p">;</span>

	<span class="n">u64</span>              <span class="n">ddr_start</span><span class="p">;</span>
	<span class="n">u64</span>              <span class="n">ddr_end</span><span class="p">;</span>

	<span class="n">MTHCA_DECLARE_DOORBELL_LOCK</span><span class="p">(</span><span class="n">doorbell_lock</span><span class="p">)</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">cap_mask_mutex</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span>    <span class="o">*</span><span class="n">hcr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>    <span class="o">*</span><span class="n">kar</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>    <span class="o">*</span><span class="n">clr_base</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ecr_base</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">tavor</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">eq_arm</span><span class="p">;</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">eq_set_ci_base</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">arbel</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">eq_regs</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mthca_cmd</span>    <span class="n">cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_limits</span> <span class="n">limits</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mthca_uar_table</span> <span class="n">uar_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_pd_table</span>  <span class="n">pd_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_mr_table</span>  <span class="n">mr_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_eq_table</span>  <span class="n">eq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_cq_table</span>  <span class="n">cq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_srq_table</span> <span class="n">srq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_qp_table</span>  <span class="n">qp_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_av_table</span>  <span class="n">av_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_mcg_table</span> <span class="n">mcg_table</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mthca_catas_err</span> <span class="n">catas_err</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mthca_uar</span>       <span class="n">driver_uar</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_db_table</span> <span class="o">*</span><span class="n">db_tab</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_pd</span>        <span class="n">driver_pd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mthca_mr</span>        <span class="n">driver_mr</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ib_mad_agent</span>  <span class="o">*</span><span class="n">send_agent</span><span class="p">[</span><span class="n">MTHCA_MAX_PORTS</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ib_ah</span>         <span class="o">*</span><span class="n">sm_ah</span><span class="p">[</span><span class="n">MTHCA_MAX_PORTS</span><span class="p">];</span>
	<span class="n">spinlock_t</span>            <span class="n">sm_lock</span><span class="p">;</span>
	<span class="n">u8</span>                    <span class="n">rate</span><span class="p">[</span><span class="n">MTHCA_MAX_PORTS</span><span class="p">];</span>
	<span class="n">bool</span>		      <span class="n">active</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_INFINIBAND_MTHCA_DEBUG</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mthca_debug_level</span><span class="p">;</span>

<span class="cp">#define mthca_dbg(mdev, format, arg...)					\</span>
<span class="cp">	do {								\</span>
<span class="cp">		if (mthca_debug_level)					\</span>
<span class="cp">			dev_printk(KERN_DEBUG, &amp;mdev-&gt;pdev-&gt;dev, format, ## arg); \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#else </span><span class="cm">/* CONFIG_INFINIBAND_MTHCA_DEBUG */</span><span class="cp"></span>

<span class="cp">#define mthca_dbg(mdev, format, arg...) do { (void) mdev; } while (0)</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_INFINIBAND_MTHCA_DEBUG */</span><span class="cp"></span>

<span class="cp">#define mthca_err(mdev, format, arg...) \</span>
<span class="cp">	dev_err(&amp;mdev-&gt;pdev-&gt;dev, format, ## arg)</span>
<span class="cp">#define mthca_info(mdev, format, arg...) \</span>
<span class="cp">	dev_info(&amp;mdev-&gt;pdev-&gt;dev, format, ## arg)</span>
<span class="cp">#define mthca_warn(mdev, format, arg...) \</span>
<span class="cp">	dev_warn(&amp;mdev-&gt;pdev-&gt;dev, format, ## arg)</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__buggy_use_of_MTHCA_GET</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__buggy_use_of_MTHCA_PUT</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define MTHCA_GET(dest, source, offset)                               \</span>
<span class="cp">	do {                                                          \</span>
<span class="cp">		void *__p = (char *) (source) + (offset);             \</span>
<span class="cp">		switch (sizeof (dest)) {                              \</span>
<span class="cp">		case 1: (dest) = *(u8 *) __p;       break;	      \</span>
<span class="cp">		case 2: (dest) = be16_to_cpup(__p); break;	      \</span>
<span class="cp">		case 4: (dest) = be32_to_cpup(__p); break;	      \</span>
<span class="cp">		case 8: (dest) = be64_to_cpup(__p); break;	      \</span>
<span class="cp">		default: __buggy_use_of_MTHCA_GET();		      \</span>
<span class="cp">		}                                                     \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define MTHCA_PUT(dest, source, offset)                               \</span>
<span class="cp">	do {                                                          \</span>
<span class="cp">		void *__d = ((char *) (dest) + (offset));	      \</span>
<span class="cp">		switch (sizeof(source)) {                             \</span>
<span class="cp">		case 1: *(u8 *) __d = (source);                break; \</span>
<span class="cp">		case 2:	*(__be16 *) __d = cpu_to_be16(source); break; \</span>
<span class="cp">		case 4:	*(__be32 *) __d = cpu_to_be32(source); break; \</span>
<span class="cp">		case 8:	*(__be64 *) __d = cpu_to_be64(source); break; \</span>
<span class="cp">		default: __buggy_use_of_MTHCA_PUT();		      \</span>
<span class="cp">		}                                                     \</span>
<span class="cp">	} while (0)</span>

<span class="kt">int</span> <span class="n">mthca_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">mdev</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">mthca_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="o">*</span><span class="n">alloc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="o">*</span><span class="n">alloc</span><span class="p">,</span> <span class="n">u32</span> <span class="n">obj</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_alloc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="o">*</span><span class="n">alloc</span><span class="p">,</span> <span class="n">u32</span> <span class="n">num</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
		     <span class="n">u32</span> <span class="n">reserved</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_alloc_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_alloc</span> <span class="o">*</span><span class="n">alloc</span><span class="p">);</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">mthca_array_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_array</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_array_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_array</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_array_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_array</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_array_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_array</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nent</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_array_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_array</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nent</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_buf_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_direct</span><span class="p">,</span>
		    <span class="k">union</span> <span class="n">mthca_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">is_direct</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">hca_write</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_buf_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="k">union</span> <span class="n">mthca_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">is_direct</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_init_uar_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_pd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_mr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_cq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_srq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_qp_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_av_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_mcg_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mthca_cleanup_uar_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_pd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_mr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_cq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_srq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_qp_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_av_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cleanup_mcg_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_register_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_unregister_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mthca_start_catas_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_stop_catas_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mthca_restart_one</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_catas_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_catas_cleanup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_uar_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_uar</span> <span class="o">*</span><span class="n">uar</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_uar_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_uar</span> <span class="o">*</span><span class="n">uar</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_pd_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">privileged</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_pd_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_write_mtt_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">mthca_mtt</span> <span class="o">*</span><span class="n">mthca_alloc_mtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_mtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mtt</span> <span class="o">*</span><span class="n">mtt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_write_mtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mtt</span> <span class="o">*</span><span class="n">mtt</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">start_index</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">buffer_list</span><span class="p">,</span> <span class="kt">int</span> <span class="n">list_len</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_mr_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buffer_size_shift</span><span class="p">,</span>
		   <span class="n">u64</span> <span class="n">iova</span><span class="p">,</span> <span class="n">u64</span> <span class="n">total_size</span><span class="p">,</span> <span class="n">u32</span> <span class="n">access</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_mr_alloc_notrans</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pd</span><span class="p">,</span>
			   <span class="n">u32</span> <span class="n">access</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_mr_alloc_phys</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pd</span><span class="p">,</span>
			<span class="n">u64</span> <span class="o">*</span><span class="n">buffer_list</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buffer_size_shift</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">list_len</span><span class="p">,</span> <span class="n">u64</span> <span class="n">iova</span><span class="p">,</span> <span class="n">u64</span> <span class="n">total_size</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">access</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_mr</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>  <span class="k">struct</span> <span class="n">mthca_mr</span> <span class="o">*</span><span class="n">mr</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_fmr_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pd</span><span class="p">,</span>
		    <span class="n">u32</span> <span class="n">access</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_fmr</span> <span class="o">*</span><span class="n">fmr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_tavor_map_phys_fmr</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_fmr</span> <span class="o">*</span><span class="n">ibfmr</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">page_list</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">list_len</span><span class="p">,</span> <span class="n">u64</span> <span class="n">iova</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_tavor_fmr_unmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_fmr</span> <span class="o">*</span><span class="n">fmr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_arbel_map_phys_fmr</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_fmr</span> <span class="o">*</span><span class="n">ibfmr</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">page_list</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">list_len</span><span class="p">,</span> <span class="n">u64</span> <span class="n">iova</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_arbel_fmr_unmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_fmr</span> <span class="o">*</span><span class="n">fmr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_free_fmr</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>  <span class="k">struct</span> <span class="n">mthca_fmr</span> <span class="o">*</span><span class="n">fmr</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_map_eq_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u64</span> <span class="n">icm_virt</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_unmap_eq_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_poll_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_cq</span> <span class="o">*</span><span class="n">ibcq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_entries</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">entry</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_tavor_arm_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ib_cq_notify_flags</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_arbel_arm_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ib_cq_notify_flags</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_init_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nent</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">mthca_ucontext</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pdn</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cq_completion</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cqn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cq_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cqn</span><span class="p">,</span>
		    <span class="k">enum</span> <span class="n">ib_event_type</span> <span class="n">event_type</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cq_clean</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span> <span class="n">u32</span> <span class="n">qpn</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_cq_resize_copy_cqes</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_alloc_cq_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_cq_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nent</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_cq_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_cq_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cqe</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_alloc_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">ib_srq_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_modify_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_srq</span> <span class="o">*</span><span class="n">ibsrq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_srq_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
		     <span class="k">enum</span> <span class="n">ib_srq_attr_mask</span> <span class="n">attr_mask</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_udata</span> <span class="o">*</span><span class="n">udata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_query_srq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_srq_attr</span> <span class="o">*</span><span class="n">srq_attr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_max_srq_sge</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_srq_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">srqn</span><span class="p">,</span>
		     <span class="k">enum</span> <span class="n">ib_event_type</span> <span class="n">event_type</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_srq_wqe</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">,</span> <span class="n">u32</span> <span class="n">wqe_addr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_tavor_post_srq_recv</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_arbel_post_srq_recv</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_srq</span> <span class="o">*</span><span class="n">srq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mthca_qp_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">qpn</span><span class="p">,</span>
		    <span class="k">enum</span> <span class="n">ib_event_type</span> <span class="n">event_type</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_query_qp</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_qp_attr</span> <span class="o">*</span><span class="n">qp_attr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qp_attr_mask</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">ib_qp_init_attr</span> <span class="o">*</span><span class="n">qp_init_attr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_modify_qp</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_qp_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">attr_mask</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">ib_udata</span> <span class="o">*</span><span class="n">udata</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_tavor_post_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_send_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ib_send_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_tavor_post_receive</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_arbel_post_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_send_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">ib_send_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_arbel_post_receive</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">*</span><span class="n">wr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ib_recv_wr</span> <span class="o">**</span><span class="n">bad_wr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_err_wqe</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_send</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dbd</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">new_wqe</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_alloc_qp</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">send_cq</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">recv_cq</span><span class="p">,</span>
		   <span class="k">enum</span> <span class="n">ib_qp_type</span> <span class="n">type</span><span class="p">,</span>
		   <span class="k">enum</span> <span class="n">ib_sig_type</span> <span class="n">send_policy</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">ib_qp_cap</span> <span class="o">*</span><span class="n">cap</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mthca_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_alloc_sqp</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">send_cq</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_cq</span> <span class="o">*</span><span class="n">recv_cq</span><span class="p">,</span>
		    <span class="k">enum</span> <span class="n">ib_sig_type</span> <span class="n">send_policy</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">ib_qp_cap</span> <span class="o">*</span><span class="n">cap</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">qpn</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_sqp</span> <span class="o">*</span><span class="n">sqp</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_qp</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_create_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_pd</span> <span class="o">*</span><span class="n">pd</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">ib_ah_attr</span> <span class="o">*</span><span class="n">ah_attr</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">mthca_ah</span> <span class="o">*</span><span class="n">ah</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_destroy_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_ah</span> <span class="o">*</span><span class="n">ah</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_read_ah</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_ah</span> <span class="o">*</span><span class="n">ah</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">ib_ud_header</span> <span class="o">*</span><span class="n">header</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_ah_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_ah</span> <span class="o">*</span><span class="n">ibah</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_ah_attr</span> <span class="o">*</span><span class="n">attr</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_ah_grh_present</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_ah</span> <span class="o">*</span><span class="n">ah</span><span class="p">);</span>
<span class="n">u8</span> <span class="n">mthca_get_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">static_rate</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">);</span>
<span class="k">enum</span> <span class="n">ib_rate</span> <span class="n">mthca_rate_to_ib</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mthca_rate</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_multicast_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">union</span> <span class="n">ib_gid</span> <span class="o">*</span><span class="n">gid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">lid</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_multicast_detach</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_qp</span> <span class="o">*</span><span class="n">ibqp</span><span class="p">,</span> <span class="k">union</span> <span class="n">ib_gid</span> <span class="o">*</span><span class="n">gid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">lid</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mthca_process_mad</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ibdev</span><span class="p">,</span>
		      <span class="kt">int</span> <span class="n">mad_flags</span><span class="p">,</span>
		      <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">ib_wc</span> <span class="o">*</span><span class="n">in_wc</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">ib_grh</span> <span class="o">*</span><span class="n">in_grh</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">ib_mad</span> <span class="o">*</span><span class="n">in_mad</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">ib_mad</span> <span class="o">*</span><span class="n">out_mad</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mthca_create_agents</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mthca_free_agents</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="nf">to_mdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">ibdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">ibdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mthca_dev</span><span class="p">,</span> <span class="n">ib_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mthca_is_memfree</span><span class="p">(</span><span class="k">struct</span> <span class="n">mthca_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mthca_flags</span> <span class="o">&amp;</span> <span class="n">MTHCA_FLAG_MEMFREE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* MTHCA_DEV_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
