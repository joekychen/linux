<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › crypto › ux500 › hash › hash_alg.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>hash_alg.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) ST-Ericsson SA 2010</span>
<span class="cm"> * Author: Shujuan Chen (shujuan.chen@stericsson.com)</span>
<span class="cm"> * Author: Joakim Bech (joakim.xx.bech@stericsson.com)</span>
<span class="cm"> * Author: Berne Hebark (berne.hebark@stericsson.com))</span>
<span class="cm"> * License terms: GNU General Public License (GPL) version 2</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _HASH_ALG_H</span>
<span class="cp">#define _HASH_ALG_H</span>

<span class="cp">#include &lt;linux/bitops.h&gt;</span>

<span class="cp">#define HASH_BLOCK_SIZE			64</span>
<span class="cp">#define HASH_DMA_ALIGN_SIZE		4</span>
<span class="cp">#define HASH_DMA_PERFORMANCE_MIN_SIZE	1024</span>
<span class="cp">#define HASH_BYTES_PER_WORD		4</span>

<span class="cm">/* Maximum value of the length&#39;s high word */</span>
<span class="cp">#define HASH_HIGH_WORD_MAX_VAL		0xFFFFFFFFUL</span>

<span class="cm">/* Power on Reset values HASH registers */</span>
<span class="cp">#define HASH_RESET_CR_VALUE		0x0</span>
<span class="cp">#define HASH_RESET_STR_VALUE		0x0</span>

<span class="cm">/* Number of context swap registers */</span>
<span class="cp">#define HASH_CSR_COUNT			52</span>

<span class="cp">#define HASH_RESET_CSRX_REG_VALUE	0x0</span>
<span class="cp">#define HASH_RESET_CSFULL_REG_VALUE	0x0</span>
<span class="cp">#define HASH_RESET_CSDATAIN_REG_VALUE	0x0</span>

<span class="cp">#define HASH_RESET_INDEX_VAL		0x0</span>
<span class="cp">#define HASH_RESET_BIT_INDEX_VAL	0x0</span>
<span class="cp">#define HASH_RESET_BUFFER_VAL		0x0</span>
<span class="cp">#define HASH_RESET_LEN_HIGH_VAL		0x0</span>
<span class="cp">#define HASH_RESET_LEN_LOW_VAL		0x0</span>

<span class="cm">/* Control register bitfields */</span>
<span class="cp">#define HASH_CR_RESUME_MASK	0x11FCF</span>

<span class="cp">#define HASH_CR_SWITCHON_POS	31</span>
<span class="cp">#define HASH_CR_SWITCHON_MASK	BIT(31)</span>

<span class="cp">#define HASH_CR_EMPTYMSG_POS	20</span>
<span class="cp">#define HASH_CR_EMPTYMSG_MASK	BIT(20)</span>

<span class="cp">#define HASH_CR_DINF_POS	12</span>
<span class="cp">#define HASH_CR_DINF_MASK	BIT(12)</span>

<span class="cp">#define HASH_CR_NBW_POS		8</span>
<span class="cp">#define HASH_CR_NBW_MASK	0x00000F00UL</span>

<span class="cp">#define HASH_CR_LKEY_POS	16</span>
<span class="cp">#define HASH_CR_LKEY_MASK	BIT(16)</span>

<span class="cp">#define HASH_CR_ALGO_POS	7</span>
<span class="cp">#define HASH_CR_ALGO_MASK	BIT(7)</span>

<span class="cp">#define HASH_CR_MODE_POS	6</span>
<span class="cp">#define HASH_CR_MODE_MASK	BIT(6)</span>

<span class="cp">#define HASH_CR_DATAFORM_POS	4</span>
<span class="cp">#define HASH_CR_DATAFORM_MASK	(BIT(4) | BIT(5))</span>

<span class="cp">#define HASH_CR_DMAE_POS	3</span>
<span class="cp">#define HASH_CR_DMAE_MASK	BIT(3)</span>

<span class="cp">#define HASH_CR_INIT_POS	2</span>
<span class="cp">#define HASH_CR_INIT_MASK	BIT(2)</span>

<span class="cp">#define HASH_CR_PRIVN_POS	1</span>
<span class="cp">#define HASH_CR_PRIVN_MASK	BIT(1)</span>

<span class="cp">#define HASH_CR_SECN_POS	0</span>
<span class="cp">#define HASH_CR_SECN_MASK	BIT(0)</span>

<span class="cm">/* Start register bitfields */</span>
<span class="cp">#define HASH_STR_DCAL_POS	8</span>
<span class="cp">#define HASH_STR_DCAL_MASK	BIT(8)</span>
<span class="cp">#define HASH_STR_DEFAULT	0x0</span>

<span class="cp">#define HASH_STR_NBLW_POS	0</span>
<span class="cp">#define HASH_STR_NBLW_MASK	0x0000001FUL</span>

<span class="cp">#define HASH_NBLW_MAX_VAL	0x1F</span>

<span class="cm">/* PrimeCell IDs */</span>
<span class="cp">#define HASH_P_ID0		0xE0</span>
<span class="cp">#define HASH_P_ID1		0x05</span>
<span class="cp">#define HASH_P_ID2		0x38</span>
<span class="cp">#define HASH_P_ID3		0x00</span>
<span class="cp">#define HASH_CELL_ID0		0x0D</span>
<span class="cp">#define HASH_CELL_ID1		0xF0</span>
<span class="cp">#define HASH_CELL_ID2		0x05</span>
<span class="cp">#define HASH_CELL_ID3		0xB1</span>

<span class="cp">#define HASH_SET_BITS(reg_name, mask)	\</span>
<span class="cp">	writel_relaxed((readl_relaxed(reg_name) | mask), reg_name)</span>

<span class="cp">#define HASH_CLEAR_BITS(reg_name, mask)	\</span>
<span class="cp">	writel_relaxed((readl_relaxed(reg_name) &amp; ~mask), reg_name)</span>

<span class="cp">#define HASH_PUT_BITS(reg, val, shift, mask)	\</span>
<span class="cp">	writel_relaxed(((readl(reg) &amp; ~(mask)) |	\</span>
<span class="cp">		(((u32)val &lt;&lt; shift) &amp; (mask))), reg)</span>

<span class="cp">#define HASH_SET_DIN(val, len)	writesl(&amp;device_data-&gt;base-&gt;din, (val), (len))</span>

<span class="cp">#define HASH_INITIALIZE			\</span>
<span class="cp">	HASH_PUT_BITS(			\</span>
<span class="cp">		&amp;device_data-&gt;base-&gt;cr,	\</span>
<span class="cp">		0x01, HASH_CR_INIT_POS,	\</span>
<span class="cp">		HASH_CR_INIT_MASK)</span>

<span class="cp">#define HASH_SET_DATA_FORMAT(data_format)				\</span>
<span class="cp">		HASH_PUT_BITS(						\</span>
<span class="cp">			&amp;device_data-&gt;base-&gt;cr,				\</span>
<span class="cp">			(u32) (data_format), HASH_CR_DATAFORM_POS,	\</span>
<span class="cp">			HASH_CR_DATAFORM_MASK)</span>
<span class="cp">#define HASH_SET_NBLW(val)					\</span>
<span class="cp">		HASH_PUT_BITS(					\</span>
<span class="cp">			&amp;device_data-&gt;base-&gt;str,		\</span>
<span class="cp">			(u32) (val), HASH_STR_NBLW_POS,		\</span>
<span class="cp">			HASH_STR_NBLW_MASK)</span>
<span class="cp">#define HASH_SET_DCAL					\</span>
<span class="cp">		HASH_PUT_BITS(				\</span>
<span class="cp">			&amp;device_data-&gt;base-&gt;str,	\</span>
<span class="cp">			0x01, HASH_STR_DCAL_POS,	\</span>
<span class="cp">			HASH_STR_DCAL_MASK)</span>

<span class="cm">/* Hardware access method */</span>
<span class="k">enum</span> <span class="n">hash_mode</span> <span class="p">{</span>
	<span class="n">HASH_MODE_CPU</span><span class="p">,</span>
	<span class="n">HASH_MODE_DMA</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct uint64 - Structure to handle 64 bits integers.</span>
<span class="cm"> * @high_word:	Most significant bits.</span>
<span class="cm"> * @low_word:	Least significant bits.</span>
<span class="cm"> *</span>
<span class="cm"> * Used to handle 64 bits integers.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">uint64</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">high_word</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">low_word</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_register - Contains all registers in ux500 hash hardware.</span>
<span class="cm"> * @cr:		HASH control register (0x000).</span>
<span class="cm"> * @din:	HASH data input register (0x004).</span>
<span class="cm"> * @str:	HASH start register (0x008).</span>
<span class="cm"> * @hx:		HASH digest register 0..7 (0x00c-0x01C).</span>
<span class="cm"> * @padding0:	Reserved (0x02C).</span>
<span class="cm"> * @itcr:	Integration test control register (0x080).</span>
<span class="cm"> * @itip:	Integration test input register (0x084).</span>
<span class="cm"> * @itop:	Integration test output register (0x088).</span>
<span class="cm"> * @padding1:	Reserved (0x08C).</span>
<span class="cm"> * @csfull:	HASH context full register (0x0F8).</span>
<span class="cm"> * @csdatain:	HASH context swap data input register (0x0FC).</span>
<span class="cm"> * @csrx:	HASH context swap register 0..51 (0x100-0x1CC).</span>
<span class="cm"> * @padding2:	Reserved (0x1D0).</span>
<span class="cm"> * @periphid0:	HASH peripheral identification register 0 (0xFE0).</span>
<span class="cm"> * @periphid1:	HASH peripheral identification register 1 (0xFE4).</span>
<span class="cm"> * @periphid2:	HASH peripheral identification register 2 (0xFE8).</span>
<span class="cm"> * @periphid3:	HASH peripheral identification register 3 (0xFEC).</span>
<span class="cm"> * @cellid0:	HASH PCell identification register 0 (0xFF0).</span>
<span class="cm"> * @cellid1:	HASH PCell identification register 1 (0xFF4).</span>
<span class="cm"> * @cellid2:	HASH PCell identification register 2 (0xFF8).</span>
<span class="cm"> * @cellid3:	HASH PCell identification register 3 (0xFFC).</span>
<span class="cm"> *</span>
<span class="cm"> * The device communicates to the HASH via 32-bit-wide control registers</span>
<span class="cm"> * accessible via the 32-bit width AMBA rev. 2.0 AHB Bus. Below is a structure</span>
<span class="cm"> * with the registers used.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_register</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">cr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">din</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">str</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hx</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="n">u32</span> <span class="n">padding0</span><span class="p">[(</span><span class="mh">0x080</span> <span class="o">-</span> <span class="mh">0x02C</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)];</span>

	<span class="n">u32</span> <span class="n">itcr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">itip</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">itop</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">padding1</span><span class="p">[(</span><span class="mh">0x0F8</span> <span class="o">-</span> <span class="mh">0x08C</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)];</span>

	<span class="n">u32</span> <span class="n">csfull</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">csdatain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">csrx</span><span class="p">[</span><span class="n">HASH_CSR_COUNT</span><span class="p">];</span>

	<span class="n">u32</span> <span class="n">padding2</span><span class="p">[(</span><span class="mh">0xFE0</span> <span class="o">-</span> <span class="mh">0x1D0</span><span class="p">)</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)];</span>

	<span class="n">u32</span> <span class="n">periphid0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">periphid1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">periphid2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">periphid3</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">cellid0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cellid1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cellid2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cellid3</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_state - Hash context state.</span>
<span class="cm"> * @temp_cr:	Temporary HASH Control Register.</span>
<span class="cm"> * @str_reg:	HASH Start Register.</span>
<span class="cm"> * @din_reg:	HASH Data Input Register.</span>
<span class="cm"> * @csr[52]:	HASH Context Swap Registers 0-39.</span>
<span class="cm"> * @csfull:	HASH Context Swap Registers 40 ie Status flags.</span>
<span class="cm"> * @csdatain:	HASH Context Swap Registers 41 ie Input data.</span>
<span class="cm"> * @buffer:	Working buffer for messages going to the hardware.</span>
<span class="cm"> * @length:	Length of the part of message hashed so far (floor(N/64) * 64).</span>
<span class="cm"> * @index:	Valid number of bytes in buffer (N % 64).</span>
<span class="cm"> * @bit_index:	Valid number of bits in buffer (N % 8).</span>
<span class="cm"> *</span>
<span class="cm"> * This structure is used between context switches, i.e. when ongoing jobs are</span>
<span class="cm"> * interupted with new jobs. When this happens we need to store intermediate</span>
<span class="cm"> * results in software.</span>
<span class="cm"> *</span>
<span class="cm"> * WARNING: &quot;index&quot; is the  member of the structure, to be sure  that &quot;buffer&quot;</span>
<span class="cm"> * is aligned on a 4-bytes boundary. This is highly implementation dependent</span>
<span class="cm"> * and MUST be checked whenever this code is ported on new platforms.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_state</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">temp_cr</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">str_reg</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">din_reg</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">csr</span><span class="p">[</span><span class="mi">52</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">csfull</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">csdatain</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">buffer</span><span class="p">[</span><span class="n">HASH_BLOCK_SIZE</span> <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)];</span>
	<span class="k">struct</span> <span class="n">uint64</span>	<span class="n">length</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">index</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">bit_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum hash_device_id - HASH device ID.</span>
<span class="cm"> * @HASH_DEVICE_ID_0: Hash hardware with ID 0</span>
<span class="cm"> * @HASH_DEVICE_ID_1: Hash hardware with ID 1</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">hash_device_id</span> <span class="p">{</span>
	<span class="n">HASH_DEVICE_ID_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">HASH_DEVICE_ID_1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum hash_data_format - HASH data format.</span>
<span class="cm"> * @HASH_DATA_32_BITS:	32 bits data format</span>
<span class="cm"> * @HASH_DATA_16_BITS:	16 bits data format</span>
<span class="cm"> * @HASH_DATA_8_BITS:	8 bits data format.</span>
<span class="cm"> * @HASH_DATA_1_BITS:	1 bit data format.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">hash_data_format</span> <span class="p">{</span>
	<span class="n">HASH_DATA_32_BITS</span>	<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">HASH_DATA_16_BITS</span>	<span class="o">=</span> <span class="mh">0x1</span><span class="p">,</span>
	<span class="n">HASH_DATA_8_BITS</span>	<span class="o">=</span> <span class="mh">0x2</span><span class="p">,</span>
	<span class="n">HASH_DATA_1_BIT</span>		<span class="o">=</span> <span class="mh">0x3</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum hash_algo - Enumeration for selecting between SHA1 or SHA2 algorithm.</span>
<span class="cm"> * @HASH_ALGO_SHA1: Indicates that SHA1 is used.</span>
<span class="cm"> * @HASH_ALGO_SHA2: Indicates that SHA2 (SHA256) is used.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">hash_algo</span> <span class="p">{</span>
	<span class="n">HASH_ALGO_SHA1</span>		<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">HASH_ALGO_SHA256</span>	<span class="o">=</span> <span class="mh">0x1</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum hash_op - Enumeration for selecting between HASH or HMAC mode.</span>
<span class="cm"> * @HASH_OPER_MODE_HASH: Indicates usage of normal HASH mode.</span>
<span class="cm"> * @HASH_OPER_MODE_HMAC: Indicates usage of HMAC.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">hash_op</span> <span class="p">{</span>
	<span class="n">HASH_OPER_MODE_HASH</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">HASH_OPER_MODE_HMAC</span> <span class="o">=</span> <span class="mh">0x1</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_config - Configuration data for the hardware.</span>
<span class="cm"> * @data_format:	Format of data entered into the hash data in register.</span>
<span class="cm"> * @algorithm:		Algorithm selection bit.</span>
<span class="cm"> * @oper_mode:		Operating mode selection bit.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_config</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">data_format</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">algorithm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">oper_mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_dma - Structure used for dma.</span>
<span class="cm"> * @mask:		DMA capabilities bitmap mask.</span>
<span class="cm"> * @complete:		Used to maintain state for a &quot;completion&quot;.</span>
<span class="cm"> * @chan_mem2hash:	DMA channel.</span>
<span class="cm"> * @cfg_mem2hash:	DMA channel configuration.</span>
<span class="cm"> * @sg_len:		Scatterlist length.</span>
<span class="cm"> * @sg:			Scatterlist.</span>
<span class="cm"> * @nents:		Number of sg entries.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_dma</span> <span class="p">{</span>
	<span class="n">dma_cap_mask_t</span>		<span class="n">mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">complete</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_chan</span>		<span class="o">*</span><span class="n">chan_mem2hash</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">cfg_mem2hash</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">sg_len</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scatterlist</span>	<span class="o">*</span><span class="n">sg</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">nents</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_ctx - The context used for hash calculations.</span>
<span class="cm"> * @key:	The key used in the operation.</span>
<span class="cm"> * @keylen:	The length of the key.</span>
<span class="cm"> * @state:	The state of the current calculations.</span>
<span class="cm"> * @config:	The current configuration.</span>
<span class="cm"> * @digestsize:	The size of current digest.</span>
<span class="cm"> * @device:	Pointer to the device structure.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_ctx</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="o">*</span><span class="n">key</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">keylen</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hash_config</span>	<span class="n">config</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">digestsize</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hash_device_data</span>	<span class="o">*</span><span class="n">device</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_ctx - The request context used for hash calculations.</span>
<span class="cm"> * @state:	The state of the current calculations.</span>
<span class="cm"> * @dma_mode:	Used in special cases (workaround), e.g. need to change to</span>
<span class="cm"> *		cpu mode, if not supported/working in dma mode.</span>
<span class="cm"> * @updated:	Indicates if hardware is initialized for new operations.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_req_ctx</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hash_state</span>	<span class="n">state</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">dma_mode</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">updated</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hash_device_data - structure for a hash device.</span>
<span class="cm"> * @base:		Pointer to the hardware base address.</span>
<span class="cm"> * @list_node:		For inclusion in klist.</span>
<span class="cm"> * @dev:		Pointer to the device dev structure.</span>
<span class="cm"> * @ctx_lock:		Spinlock for current_ctx.</span>
<span class="cm"> * @current_ctx:	Pointer to the currently allocated context.</span>
<span class="cm"> * @power_state:	TRUE = power state on, FALSE = power state off.</span>
<span class="cm"> * @power_state_lock:	Spinlock for power_state.</span>
<span class="cm"> * @regulator:		Pointer to the device&#39;s power control.</span>
<span class="cm"> * @clk:		Pointer to the device&#39;s clock control.</span>
<span class="cm"> * @restore_dev_state:	TRUE = saved state, FALSE = no saved state.</span>
<span class="cm"> * @dma:		Structure used for dma.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hash_device_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hash_register</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">klist_node</span>	<span class="n">list_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span>		<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spinlock</span>		<span class="n">ctx_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hash_ctx</span>		<span class="o">*</span><span class="n">current_ctx</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">power_state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">spinlock</span>		<span class="n">power_state_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator</span>	<span class="o">*</span><span class="n">regulator</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span>		<span class="o">*</span><span class="n">clk</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">restore_dev_state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hash_state</span>	<span class="n">state</span><span class="p">;</span> <span class="cm">/* Used for saving and resuming state */</span>
	<span class="k">struct</span> <span class="n">hash_dma</span>		<span class="n">dma</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">hash_check_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">hash_setconfiguration</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hash_config</span> <span class="o">*</span><span class="n">config</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">hash_begin</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hash_ctx</span> <span class="o">*</span><span class="n">ctx</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">hash_get_digest</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">,</span>
		<span class="n">u8</span> <span class="o">*</span><span class="n">digest</span><span class="p">,</span> <span class="kt">int</span> <span class="n">algorithm</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">hash_hw_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">ahash_request</span> <span class="o">*</span><span class="n">req</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">hash_save_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hash_state</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">hash_resume_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">hash_device_data</span> <span class="o">*</span><span class="n">device_data</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">hash_state</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
