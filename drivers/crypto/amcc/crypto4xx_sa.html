<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › crypto › amcc › crypto4xx_sa.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>crypto4xx_sa.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * AMCC SoC PPC4xx Crypto Driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2008 Applied Micro Circuits Corporation.</span>
<span class="cm"> * All rights reserved. James Hsiao &lt;jhsiao@amcc.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * This file defines the security context</span>
<span class="cm"> * associate format.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __CRYPTO4XX_SA_H__</span>
<span class="cp">#define __CRYPTO4XX_SA_H__</span>

<span class="cp">#define AES_IV_SIZE				16</span>

<span class="cm">/**</span>
<span class="cm"> * Contents of Dynamic Security Association (SA) with all possible fields</span>
<span class="cm"> */</span>
<span class="k">union</span> <span class="n">dynamic_sa_contents</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">arc4_state_ptr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">arc4_ij_ptr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">state_ptr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">iv3</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">iv2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">iv1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">iv0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num_mask3</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num_mask2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num_mask1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num_mask0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num0</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">spi</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">outer_size</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">inner_size</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">key_size</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cmd_size</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">bf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define DIR_OUTBOUND				0</span>
<span class="cp">#define DIR_INBOUND				1</span>
<span class="cp">#define SA_OP_GROUP_BASIC			0</span>
<span class="cp">#define SA_OPCODE_ENCRYPT			0</span>
<span class="cp">#define SA_OPCODE_DECRYPT			0</span>
<span class="cp">#define SA_OPCODE_HASH				3</span>
<span class="cp">#define SA_CIPHER_ALG_DES			0</span>
<span class="cp">#define SA_CIPHER_ALG_3DES			1</span>
<span class="cp">#define SA_CIPHER_ALG_ARC4			2</span>
<span class="cp">#define SA_CIPHER_ALG_AES			3</span>
<span class="cp">#define SA_CIPHER_ALG_KASUMI			4</span>
<span class="cp">#define SA_CIPHER_ALG_NULL			15</span>

<span class="cp">#define SA_HASH_ALG_MD5				0</span>
<span class="cp">#define SA_HASH_ALG_SHA1			1</span>
<span class="cp">#define SA_HASH_ALG_NULL			15</span>
<span class="cp">#define SA_HASH_ALG_SHA1_DIGEST_SIZE		20</span>

<span class="cp">#define SA_LOAD_HASH_FROM_SA			0</span>
<span class="cp">#define SA_LOAD_HASH_FROM_STATE			2</span>
<span class="cp">#define SA_NOT_LOAD_HASH			3</span>
<span class="cp">#define SA_LOAD_IV_FROM_SA			0</span>
<span class="cp">#define SA_LOAD_IV_FROM_INPUT			1</span>
<span class="cp">#define SA_LOAD_IV_FROM_STATE			2</span>
<span class="cp">#define SA_LOAD_IV_GEN_IV			3</span>

<span class="cp">#define SA_PAD_TYPE_CONSTANT			2</span>
<span class="cp">#define SA_PAD_TYPE_ZERO			3</span>
<span class="cp">#define SA_PAD_TYPE_TLS				5</span>
<span class="cp">#define SA_PAD_TYPE_DTLS			5</span>
<span class="cp">#define SA_NOT_SAVE_HASH			0</span>
<span class="cp">#define SA_SAVE_HASH				1</span>
<span class="cp">#define SA_NOT_SAVE_IV				0</span>
<span class="cp">#define SA_SAVE_IV				1</span>
<span class="cp">#define SA_HEADER_PROC				1</span>
<span class="cp">#define SA_NO_HEADER_PROC			0</span>

<span class="k">union</span> <span class="n">sa_command_0</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">scatter</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">gather</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">save_hash_state</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">save_iv</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">load_hash_state</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">load_iv</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">digest_len</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hdr_proc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">extend_pad</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">stream_cipher_pad</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">rsv</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hash_alg</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cipher_alg</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">pad_type</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">op_group</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">dir</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">opcode</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">bf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define CRYPTO_MODE_ECB				0</span>
<span class="cp">#define CRYPTO_MODE_CBC				1</span>

<span class="cp">#define CRYPTO_FEEDBACK_MODE_NO_FB		0</span>
<span class="cp">#define CRYPTO_FEEDBACK_MODE_64BIT_OFB		0</span>
<span class="cp">#define CRYPTO_FEEDBACK_MODE_8BIT_CFB		1</span>
<span class="cp">#define CRYPTO_FEEDBACK_MODE_1BIT_CFB		2</span>
<span class="cp">#define CRYPTO_FEEDBACK_MODE_128BIT_CFB		3</span>

<span class="cp">#define SA_AES_KEY_LEN_128			2</span>
<span class="cp">#define SA_AES_KEY_LEN_192			3</span>
<span class="cp">#define SA_AES_KEY_LEN_256			4</span>

<span class="cp">#define SA_REV2					1</span>
<span class="cm">/**</span>
<span class="cm"> * The follow defines bits sa_command_1</span>
<span class="cm"> * In Basic hash mode  this bit define simple hash or hmac.</span>
<span class="cm"> * In IPsec mode, this bit define muting control.</span>
<span class="cm"> */</span>
<span class="cp">#define SA_HASH_MODE_HASH			0</span>
<span class="cp">#define SA_HASH_MODE_HMAC			1</span>
<span class="cp">#define SA_MC_ENABLE				0</span>
<span class="cp">#define SA_MC_DISABLE				1</span>
<span class="cp">#define SA_NOT_COPY_HDR				0</span>
<span class="cp">#define SA_COPY_HDR				1</span>
<span class="cp">#define SA_NOT_COPY_PAD				0</span>
<span class="cp">#define SA_COPY_PAD				1</span>
<span class="cp">#define SA_NOT_COPY_PAYLOAD			0</span>
<span class="cp">#define SA_COPY_PAYLOAD				1</span>
<span class="cp">#define SA_EXTENDED_SN_OFF			0</span>
<span class="cp">#define SA_EXTENDED_SN_ON			1</span>
<span class="cp">#define SA_SEQ_MASK_OFF				0</span>
<span class="cp">#define SA_SEQ_MASK_ON				1</span>

<span class="k">union</span> <span class="n">sa_command_1</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">crypto_mode31</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">save_arc4_state</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">arc4_stateful</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">key_len</span><span class="o">:</span><span class="mi">5</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hash_crypto_offset</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">sa_rev</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">byte_offset</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">hmac_muting</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">feedback_mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">crypto_mode9_8</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">extended_seq_num</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">seq_num_mask</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">mutable_bit_proc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">ip_version</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">copy_pad</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">copy_payload</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">copy_hdr</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">rsv1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">bf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">dynamic_sa_ctl</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">sa_contents</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">sa_command_0</span> <span class="n">sa_command_0</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">sa_command_1</span> <span class="n">sa_command_1</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/**</span>
<span class="cm"> * State Record for Security Association (SA)</span>
<span class="cm"> */</span>
<span class="k">struct</span>  <span class="n">sa_state_record</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">save_iv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">save_hash_byte_cnt</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">save_digest</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/**</span>
<span class="cm"> * Security Association (SA) for AES128</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dynamic_sa_aes128</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dynamic_sa_ctl</span>	<span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">iv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="cm">/* for CBC, OFC, and CFB mode */</span>
	<span class="n">u32</span> <span class="n">state_ptr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define SA_AES128_LEN		(sizeof(struct dynamic_sa_aes128)/4)</span>
<span class="cp">#define SA_AES128_CONTENTS	0x3e000042</span>

<span class="cm">/*</span>
<span class="cm"> * Security Association (SA) for AES192</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dynamic_sa_aes192</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dynamic_sa_ctl</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">key</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">iv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="cm">/* for CBC, OFC, and CFB mode */</span>
	<span class="n">u32</span> <span class="n">state_ptr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define SA_AES192_LEN		(sizeof(struct dynamic_sa_aes192)/4)</span>
<span class="cp">#define SA_AES192_CONTENTS	0x3e000062</span>

<span class="cm">/**</span>
<span class="cm"> * Security Association (SA) for AES256</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dynamic_sa_aes256</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dynamic_sa_ctl</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">key</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">iv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span> <span class="cm">/* for CBC, OFC, and CFB mode */</span>
	<span class="n">u32</span> <span class="n">state_ptr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define SA_AES256_LEN		(sizeof(struct dynamic_sa_aes256)/4)</span>
<span class="cp">#define SA_AES256_CONTENTS	0x3e000082</span>
<span class="cp">#define SA_AES_CONTENTS		0x3e000002</span>

<span class="cm">/**</span>
<span class="cm"> * Security Association (SA) for HASH160: HMAC-SHA1</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dynamic_sa_hash160</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dynamic_sa_ctl</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">inner_digest</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">outer_digest</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">state_ptr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>
<span class="cp">#define SA_HASH160_LEN		(sizeof(struct dynamic_sa_hash160)/4)</span>
<span class="cp">#define SA_HASH160_CONTENTS     0x2000a502</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
