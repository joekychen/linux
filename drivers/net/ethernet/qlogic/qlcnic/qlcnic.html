<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › qlogic › qlcnic › qlcnic.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>qlcnic.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * QLogic qlcnic NIC Driver</span>
<span class="cm"> * Copyright (c)  2009-2010 QLogic Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * See LICENSE.qlcnic for copyright and licensing details.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _QLCNIC_H_</span>
<span class="cp">#define _QLCNIC_H_</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/etherdevice.h&gt;</span>
<span class="cp">#include &lt;linux/ip.h&gt;</span>
<span class="cp">#include &lt;linux/in.h&gt;</span>
<span class="cp">#include &lt;linux/tcp.h&gt;</span>
<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/firmware.h&gt;</span>

<span class="cp">#include &lt;linux/ethtool.h&gt;</span>
<span class="cp">#include &lt;linux/mii.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>

<span class="cp">#include &lt;linux/vmalloc.h&gt;</span>

<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>
<span class="cp">#include &lt;linux/if_vlan.h&gt;</span>

<span class="cp">#include &quot;qlcnic_hdr.h&quot;</span>

<span class="cp">#define _QLCNIC_LINUX_MAJOR 5</span>
<span class="cp">#define _QLCNIC_LINUX_MINOR 0</span>
<span class="cp">#define _QLCNIC_LINUX_SUBVERSION 28</span>
<span class="cp">#define QLCNIC_LINUX_VERSIONID  &quot;5.0.28&quot;</span>
<span class="cp">#define QLCNIC_DRV_IDC_VER  0x01</span>
<span class="cp">#define QLCNIC_DRIVER_VERSION  ((_QLCNIC_LINUX_MAJOR &lt;&lt; 16) |\</span>
<span class="cp">		 (_QLCNIC_LINUX_MINOR &lt;&lt; 8) | (_QLCNIC_LINUX_SUBVERSION))</span>

<span class="cp">#define QLCNIC_VERSION_CODE(a, b, c)	(((a) &lt;&lt; 24) + ((b) &lt;&lt; 16) + (c))</span>
<span class="cp">#define _major(v)	(((v) &gt;&gt; 24) &amp; 0xff)</span>
<span class="cp">#define _minor(v)	(((v) &gt;&gt; 16) &amp; 0xff)</span>
<span class="cp">#define _build(v)	((v) &amp; 0xffff)</span>

<span class="cm">/* version in image has weird encoding:</span>
<span class="cm"> *  7:0  - major</span>
<span class="cm"> * 15:8  - minor</span>
<span class="cm"> * 31:16 - build (little endian)</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_DECODE_VERSION(v) \</span>
<span class="cp">	QLCNIC_VERSION_CODE(((v) &amp; 0xff), (((v) &gt;&gt; 8) &amp; 0xff), ((v) &gt;&gt; 16))</span>

<span class="cp">#define QLCNIC_MIN_FW_VERSION     QLCNIC_VERSION_CODE(4, 4, 2)</span>
<span class="cp">#define QLCNIC_NUM_FLASH_SECTORS (64)</span>
<span class="cp">#define QLCNIC_FLASH_SECTOR_SIZE (64 * 1024)</span>
<span class="cp">#define QLCNIC_FLASH_TOTAL_SIZE  (QLCNIC_NUM_FLASH_SECTORS \</span>
<span class="cp">					* QLCNIC_FLASH_SECTOR_SIZE)</span>

<span class="cp">#define RCV_DESC_RINGSIZE(rds_ring)	\</span>
<span class="cp">	(sizeof(struct rcv_desc) * (rds_ring)-&gt;num_desc)</span>
<span class="cp">#define RCV_BUFF_RINGSIZE(rds_ring)	\</span>
<span class="cp">	(sizeof(struct qlcnic_rx_buffer) * rds_ring-&gt;num_desc)</span>
<span class="cp">#define STATUS_DESC_RINGSIZE(sds_ring)	\</span>
<span class="cp">	(sizeof(struct status_desc) * (sds_ring)-&gt;num_desc)</span>
<span class="cp">#define TX_BUFF_RINGSIZE(tx_ring)	\</span>
<span class="cp">	(sizeof(struct qlcnic_cmd_buffer) * tx_ring-&gt;num_desc)</span>
<span class="cp">#define TX_DESC_RINGSIZE(tx_ring)	\</span>
<span class="cp">	(sizeof(struct cmd_desc_type0) * tx_ring-&gt;num_desc)</span>

<span class="cp">#define QLCNIC_P3P_A0		0x50</span>
<span class="cp">#define QLCNIC_P3P_C0		0x58</span>

<span class="cp">#define QLCNIC_IS_REVISION_P3P(REVISION)     (REVISION &gt;= QLCNIC_P3P_A0)</span>

<span class="cp">#define FIRST_PAGE_GROUP_START	0</span>
<span class="cp">#define FIRST_PAGE_GROUP_END	0x100000</span>

<span class="cp">#define P3P_MAX_MTU                     (9600)</span>
<span class="cp">#define P3P_MIN_MTU                     (68)</span>
<span class="cp">#define QLCNIC_MAX_ETHERHDR                32 </span><span class="cm">/* This contains some padding */</span><span class="cp"></span>

<span class="cp">#define QLCNIC_P3P_RX_BUF_MAX_LEN         (QLCNIC_MAX_ETHERHDR + ETH_DATA_LEN)</span>
<span class="cp">#define QLCNIC_P3P_RX_JUMBO_BUF_MAX_LEN   (QLCNIC_MAX_ETHERHDR + P3P_MAX_MTU)</span>
<span class="cp">#define QLCNIC_CT_DEFAULT_RX_BUF_LEN	2048</span>
<span class="cp">#define QLCNIC_LRO_BUFFER_EXTRA		2048</span>

<span class="cm">/* Opcodes to be used with the commands */</span>
<span class="cp">#define TX_ETHER_PKT	0x01</span>
<span class="cp">#define TX_TCP_PKT	0x02</span>
<span class="cp">#define TX_UDP_PKT	0x03</span>
<span class="cp">#define TX_IP_PKT	0x04</span>
<span class="cp">#define TX_TCP_LSO	0x05</span>
<span class="cp">#define TX_TCP_LSO6	0x06</span>
<span class="cp">#define TX_TCPV6_PKT	0x0b</span>
<span class="cp">#define TX_UDPV6_PKT	0x0c</span>

<span class="cm">/* Tx defines */</span>
<span class="cp">#define QLCNIC_MAX_FRAGS_PER_TX	14</span>
<span class="cp">#define MAX_TSO_HEADER_DESC	2</span>
<span class="cp">#define MGMT_CMD_DESC_RESV	4</span>
<span class="cp">#define TX_STOP_THRESH		((MAX_SKB_FRAGS &gt;&gt; 2) + MAX_TSO_HEADER_DESC \</span>
<span class="cp">							+ MGMT_CMD_DESC_RESV)</span>
<span class="cp">#define QLCNIC_MAX_TX_TIMEOUTS	2</span>

<span class="cm">/*</span>
<span class="cm"> * Following are the states of the Phantom. Phantom will set them and</span>
<span class="cm"> * Host will read to check if the fields are correct.</span>
<span class="cm"> */</span>
<span class="cp">#define PHAN_INITIALIZE_FAILED		0xffff</span>
<span class="cp">#define PHAN_INITIALIZE_COMPLETE	0xff01</span>

<span class="cm">/* Host writes the following to notify that it has done the init-handshake */</span>
<span class="cp">#define PHAN_INITIALIZE_ACK		0xf00f</span>
<span class="cp">#define PHAN_PEG_RCV_INITIALIZED	0xff01</span>

<span class="cp">#define NUM_RCV_DESC_RINGS	3</span>

<span class="cp">#define RCV_RING_NORMAL 0</span>
<span class="cp">#define RCV_RING_JUMBO	1</span>

<span class="cp">#define MIN_CMD_DESCRIPTORS		64</span>
<span class="cp">#define MIN_RCV_DESCRIPTORS		64</span>
<span class="cp">#define MIN_JUMBO_DESCRIPTORS		32</span>

<span class="cp">#define MAX_CMD_DESCRIPTORS		1024</span>
<span class="cp">#define MAX_RCV_DESCRIPTORS_1G		4096</span>
<span class="cp">#define MAX_RCV_DESCRIPTORS_10G 	8192</span>
<span class="cp">#define MAX_RCV_DESCRIPTORS_VF		2048</span>
<span class="cp">#define MAX_JUMBO_RCV_DESCRIPTORS_1G	512</span>
<span class="cp">#define MAX_JUMBO_RCV_DESCRIPTORS_10G	1024</span>

<span class="cp">#define DEFAULT_RCV_DESCRIPTORS_1G	2048</span>
<span class="cp">#define DEFAULT_RCV_DESCRIPTORS_10G	4096</span>
<span class="cp">#define DEFAULT_RCV_DESCRIPTORS_VF	1024</span>
<span class="cp">#define MAX_RDS_RINGS                   2</span>

<span class="cp">#define get_next_index(index, length)	\</span>
<span class="cp">	(((index) + 1) &amp; ((length) - 1))</span>

<span class="cm">/*</span>
<span class="cm"> * Following data structures describe the descriptors that will be used.</span>
<span class="cm"> * Added fileds of tcpHdrSize and ipHdrSize, The driver needs to do it only when</span>
<span class="cm"> * we are doing LSO (above the 1500 size packet) only.</span>
<span class="cm"> */</span>

<span class="cp">#define FLAGS_VLAN_TAGGED	0x10</span>
<span class="cp">#define FLAGS_VLAN_OOB		0x40</span>

<span class="cp">#define qlcnic_set_tx_vlan_tci(cmd_desc, v)	\</span>
<span class="cp">	(cmd_desc)-&gt;vlan_TCI = cpu_to_le16(v);</span>
<span class="cp">#define qlcnic_set_cmd_desc_port(cmd_desc, var)	\</span>
<span class="cp">	((cmd_desc)-&gt;port_ctxid |= ((var) &amp; 0x0F))</span>
<span class="cp">#define qlcnic_set_cmd_desc_ctxid(cmd_desc, var)	\</span>
<span class="cp">	((cmd_desc)-&gt;port_ctxid |= ((var) &lt;&lt; 4 &amp; 0xF0))</span>

<span class="cp">#define qlcnic_set_tx_port(_desc, _port) \</span>
<span class="cp">	((_desc)-&gt;port_ctxid = ((_port) &amp; 0xf) | (((_port) &lt;&lt; 4) &amp; 0xf0))</span>

<span class="cp">#define qlcnic_set_tx_flags_opcode(_desc, _flags, _opcode) \</span>
<span class="cp">	((_desc)-&gt;flags_opcode |= \</span>
<span class="cp">	cpu_to_le16(((_flags) &amp; 0x7f) | (((_opcode) &amp; 0x3f) &lt;&lt; 7)))</span>

<span class="cp">#define qlcnic_set_tx_frags_len(_desc, _frags, _len) \</span>
<span class="cp">	((_desc)-&gt;nfrags__length = \</span>
<span class="cp">	cpu_to_le32(((_frags) &amp; 0xff) | (((_len) &amp; 0xffffff) &lt;&lt; 8)))</span>

<span class="k">struct</span> <span class="n">cmd_desc_type0</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">tcp_hdr_offset</span><span class="p">;</span>	<span class="cm">/* For LSO only */</span>
	<span class="n">u8</span> <span class="n">ip_hdr_offset</span><span class="p">;</span>	<span class="cm">/* For LSO only */</span>
	<span class="n">__le16</span> <span class="n">flags_opcode</span><span class="p">;</span>	<span class="cm">/* 15:13 unused, 12:7 opcode, 6:0 flags */</span>
	<span class="n">__le32</span> <span class="n">nfrags__length</span><span class="p">;</span>	<span class="cm">/* 31:8 total len, 7:0 frag count */</span>

	<span class="n">__le64</span> <span class="n">addr_buffer2</span><span class="p">;</span>

	<span class="n">__le16</span> <span class="n">reference_handle</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">mss</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">port_ctxid</span><span class="p">;</span>		<span class="cm">/* 7:4 ctxid 3:0 port */</span>
	<span class="n">u8</span> <span class="n">total_hdr_length</span><span class="p">;</span>	<span class="cm">/* LSO only : MAC+IP+TCP Hdr size */</span>
	<span class="n">__le16</span> <span class="n">conn_id</span><span class="p">;</span>		<span class="cm">/* IPSec offoad only */</span>

	<span class="n">__le64</span> <span class="n">addr_buffer3</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">addr_buffer1</span><span class="p">;</span>

	<span class="n">__le16</span> <span class="n">buffer_length</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="n">__le64</span> <span class="n">addr_buffer4</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">eth_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">__le16</span> <span class="n">vlan_TCI</span><span class="p">;</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">64</span><span class="p">)));</span>

<span class="cm">/* Note: sizeof(rcv_desc) should always be a mutliple of 2 */</span>
<span class="k">struct</span> <span class="n">rcv_desc</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">reference_handle</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">buffer_length</span><span class="p">;</span>	<span class="cm">/* allocated buffer length (usually 2K) */</span>
	<span class="n">__le64</span> <span class="n">addr_buffer</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* opcode field in status_desc */</span>
<span class="cp">#define QLCNIC_SYN_OFFLOAD	0x03</span>
<span class="cp">#define QLCNIC_RXPKT_DESC  	0x04</span>
<span class="cp">#define QLCNIC_OLD_RXPKT_DESC	0x3f</span>
<span class="cp">#define QLCNIC_RESPONSE_DESC	0x05</span>
<span class="cp">#define QLCNIC_LRO_DESC  	0x12</span>

<span class="cm">/* for status field in status_desc */</span>
<span class="cp">#define STATUS_CKSUM_LOOP	0</span>
<span class="cp">#define STATUS_CKSUM_OK		2</span>

<span class="cm">/* owner bits of status_desc */</span>
<span class="cp">#define STATUS_OWNER_HOST	(0x1ULL &lt;&lt; 56)</span>
<span class="cp">#define STATUS_OWNER_PHANTOM	(0x2ULL &lt;&lt; 56)</span>

<span class="cm">/* Status descriptor:</span>
<span class="cm">   0-3 port, 4-7 status, 8-11 type, 12-27 total_length</span>
<span class="cm">   28-43 reference_handle, 44-47 protocol, 48-52 pkt_offset</span>
<span class="cm">   53-55 desc_cnt, 56-57 owner, 58-63 opcode</span>
<span class="cm"> */</span>
<span class="cp">#define qlcnic_get_sts_port(sts_data)	\</span>
<span class="cp">	((sts_data) &amp; 0x0F)</span>
<span class="cp">#define qlcnic_get_sts_status(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 4) &amp; 0x0F)</span>
<span class="cp">#define qlcnic_get_sts_type(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 8) &amp; 0x0F)</span>
<span class="cp">#define qlcnic_get_sts_totallength(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 12) &amp; 0xFFFF)</span>
<span class="cp">#define qlcnic_get_sts_refhandle(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 28) &amp; 0xFFFF)</span>
<span class="cp">#define qlcnic_get_sts_prot(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 44) &amp; 0x0F)</span>
<span class="cp">#define qlcnic_get_sts_pkt_offset(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 48) &amp; 0x1F)</span>
<span class="cp">#define qlcnic_get_sts_desc_cnt(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 53) &amp; 0x7)</span>
<span class="cp">#define qlcnic_get_sts_opcode(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 58) &amp; 0x03F)</span>

<span class="cp">#define qlcnic_get_lro_sts_refhandle(sts_data) 	\</span>
<span class="cp">	((sts_data) &amp; 0x0FFFF)</span>
<span class="cp">#define qlcnic_get_lro_sts_length(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 16) &amp; 0x0FFFF)</span>
<span class="cp">#define qlcnic_get_lro_sts_l2_hdr_offset(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 32) &amp; 0x0FF)</span>
<span class="cp">#define qlcnic_get_lro_sts_l4_hdr_offset(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 40) &amp; 0x0FF)</span>
<span class="cp">#define qlcnic_get_lro_sts_timestamp(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 48) &amp; 0x1)</span>
<span class="cp">#define qlcnic_get_lro_sts_type(sts_data)	\</span>
<span class="cp">	(((sts_data) &gt;&gt; 49) &amp; 0x7)</span>
<span class="cp">#define qlcnic_get_lro_sts_push_flag(sts_data)		\</span>
<span class="cp">	(((sts_data) &gt;&gt; 52) &amp; 0x1)</span>
<span class="cp">#define qlcnic_get_lro_sts_seq_number(sts_data)		\</span>
<span class="cp">	((sts_data) &amp; 0x0FFFFFFFF)</span>


<span class="k">struct</span> <span class="n">status_desc</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">status_desc_data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16</span><span class="p">)));</span>

<span class="cm">/* UNIFIED ROMIMAGE */</span>
<span class="cp">#define QLCNIC_UNI_FW_MIN_SIZE		0xc8000</span>
<span class="cp">#define QLCNIC_UNI_DIR_SECT_PRODUCT_TBL	0x0</span>
<span class="cp">#define QLCNIC_UNI_DIR_SECT_BOOTLD	0x6</span>
<span class="cp">#define QLCNIC_UNI_DIR_SECT_FW		0x7</span>

<span class="cm">/*Offsets */</span>
<span class="cp">#define QLCNIC_UNI_CHIP_REV_OFF		10</span>
<span class="cp">#define QLCNIC_UNI_FLAGS_OFF		11</span>
<span class="cp">#define QLCNIC_UNI_BIOS_VERSION_OFF 	12</span>
<span class="cp">#define QLCNIC_UNI_BOOTLD_IDX_OFF	27</span>
<span class="cp">#define QLCNIC_UNI_FIRMWARE_IDX_OFF 	29</span>

<span class="k">struct</span> <span class="n">uni_table_desc</span><span class="p">{</span>
	<span class="n">u32</span>	<span class="n">findex</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">num_entries</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">entry_size</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">uni_data_desc</span><span class="p">{</span>
	<span class="n">u32</span>	<span class="n">findex</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Flash Defines and Structures */</span>
<span class="cp">#define QLCNIC_FLT_LOCATION	0x3F1000</span>
<span class="cp">#define QLCNIC_B0_FW_IMAGE_REGION 0x74</span>
<span class="cp">#define QLCNIC_C0_FW_IMAGE_REGION 0x97</span>
<span class="cp">#define QLCNIC_BOOTLD_REGION    0X72</span>
<span class="k">struct</span> <span class="n">qlcnic_flt_header</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">checksum</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_flt_entry</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">region</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">attrib</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">start_addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">end_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Magic number to let user know flash is programmed */</span>
<span class="cp">#define	QLCNIC_BDINFO_MAGIC 0x12345678</span>

<span class="cp">#define QLCNIC_BRDTYPE_P3P_REF_QG	0x0021</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_HMEZ		0x0022</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_CX4_LP	0x0023</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_4_GB		0x0024</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_IMEZ		0x0025</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_SFP_PLUS	0x0026</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10000_BASE_T	0x0027</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_XG_LOM	0x0028</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_4_GB_MM	0x0029</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_SFP_CT	0x002a</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_SFP_QT	0x002b</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_CX4	0x0031</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_XFP	0x0032</span>
<span class="cp">#define QLCNIC_BRDTYPE_P3P_10G_TP	0x0080</span>

<span class="cp">#define QLCNIC_MSIX_TABLE_OFFSET	0x44</span>

<span class="cm">/* Flash memory map */</span>
<span class="cp">#define QLCNIC_BRDCFG_START	0x4000		</span><span class="cm">/* board config */</span><span class="cp"></span>
<span class="cp">#define QLCNIC_BOOTLD_START	0x10000		</span><span class="cm">/* bootld */</span><span class="cp"></span>
<span class="cp">#define QLCNIC_IMAGE_START	0x43000		</span><span class="cm">/* compressed image */</span><span class="cp"></span>
<span class="cp">#define QLCNIC_USER_START	0x3E8000	</span><span class="cm">/* Firmare info */</span><span class="cp"></span>

<span class="cp">#define QLCNIC_FW_VERSION_OFFSET	(QLCNIC_USER_START+0x408)</span>
<span class="cp">#define QLCNIC_FW_SIZE_OFFSET		(QLCNIC_USER_START+0x40c)</span>
<span class="cp">#define QLCNIC_FW_SERIAL_NUM_OFFSET	(QLCNIC_USER_START+0x81c)</span>
<span class="cp">#define QLCNIC_BIOS_VERSION_OFFSET	(QLCNIC_USER_START+0x83c)</span>

<span class="cp">#define QLCNIC_BRDTYPE_OFFSET		(QLCNIC_BRDCFG_START+0x8)</span>
<span class="cp">#define QLCNIC_FW_MAGIC_OFFSET		(QLCNIC_BRDCFG_START+0x128)</span>

<span class="cp">#define QLCNIC_FW_MIN_SIZE		(0x3fffff)</span>
<span class="cp">#define QLCNIC_UNIFIED_ROMIMAGE  	0</span>
<span class="cp">#define QLCNIC_FLASH_ROMIMAGE		1</span>
<span class="cp">#define QLCNIC_UNKNOWN_ROMIMAGE		0xff</span>

<span class="cp">#define QLCNIC_UNIFIED_ROMIMAGE_NAME	&quot;phanfw.bin&quot;</span>
<span class="cp">#define QLCNIC_FLASH_ROMIMAGE_NAME	&quot;flash&quot;</span>

<span class="k">extern</span> <span class="kt">char</span> <span class="n">qlcnic_driver_name</span><span class="p">[];</span>

<span class="cm">/* Number of status descriptors to handle per interrupt */</span>
<span class="cp">#define MAX_STATUS_HANDLE	(64)</span>

<span class="cm">/*</span>
<span class="cm"> * qlcnic_skb_frag{} is to contain mapping info for each SG list. This</span>
<span class="cm"> * has to be freed when DMA is complete. This is part of qlcnic_tx_buffer{}.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qlcnic_skb_frag</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">dma</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">length</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*    Following defines are for the state of the buffers    */</span>
<span class="cp">#define	QLCNIC_BUFFER_FREE	0</span>
<span class="cp">#define	QLCNIC_BUFFER_BUSY	1</span>

<span class="cm">/*</span>
<span class="cm"> * There will be one qlcnic_buffer per skb packet.    These will be</span>
<span class="cm"> * used to save the dma info for pci_unmap_page()</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qlcnic_cmd_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_skb_frag</span> <span class="n">frag_array</span><span class="p">[</span><span class="n">MAX_SKB_FRAGS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">frag_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* In rx_buffer, we do not need multiple fragments as is a single buffer */</span>
<span class="k">struct</span> <span class="n">qlcnic_rx_buffer</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">ref_handle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">dma</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Board types */</span>
<span class="cp">#define	QLCNIC_GBE	0x01</span>
<span class="cp">#define	QLCNIC_XGBE	0x02</span>

<span class="cm">/*</span>
<span class="cm"> * Interrupt coalescing defaults. The defaults are for 1500 MTU. It is</span>
<span class="cm"> * adjusted based on configured MTU.</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_DEFAULT_INTR_COALESCE_RX_TIME_US	3</span>
<span class="cp">#define QLCNIC_DEFAULT_INTR_COALESCE_RX_PACKETS	256</span>

<span class="cp">#define QLCNIC_INTR_DEFAULT			0x04</span>
<span class="cp">#define QLCNIC_CONFIG_INTR_COALESCE		3</span>

<span class="k">struct</span> <span class="n">qlcnic_nic_intr_coalesce</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">sts_ring_mask</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">rx_packets</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">rx_time_us</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">flag</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">timer_out</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_dump_template_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">offset</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">cap_mask</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">num_entries</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">version</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">timestamp</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">checksum</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">drv_cap_mask</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">sys_info</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">saved_state</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">cap_sizes</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_fw_dump</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">clr</span><span class="p">;</span>	<span class="cm">/* flag to indicate if dump is cleared */</span>
	<span class="n">u8</span>	<span class="n">enable</span><span class="p">;</span> <span class="cm">/* enable/disable dump */</span>
	<span class="n">u32</span>	<span class="n">size</span><span class="p">;</span>	<span class="cm">/* total size of the dump */</span>
	<span class="kt">void</span>	<span class="o">*</span><span class="n">data</span><span class="p">;</span>	<span class="cm">/* dump data area */</span>
	<span class="k">struct</span>	<span class="n">qlcnic_dump_template_hdr</span> <span class="o">*</span><span class="n">tmpl_hdr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * One hardware_context{} per adapter</span>
<span class="cm"> * contains interrupt info as well shared hardware info.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qlcnic_hardware_context</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">pci_base0</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ocm_win_crb</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pci_len0</span><span class="p">;</span>

	<span class="n">rwlock_t</span> <span class="n">crb_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mem_lock</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">revision_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pci_func</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">linkup</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">loopback_state</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">port_type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">board_type</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">beacon_state</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qlcnic_nic_intr_coalesce</span> <span class="n">coal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_fw_dump</span> <span class="n">fw_dump</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_adapter_stats</span> <span class="p">{</span>
	<span class="n">u64</span>  <span class="n">xmitcalled</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">xmitfinished</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">rxdropped</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">txdropped</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">csummed</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">rx_pkts</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">lro_pkts</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">rxbytes</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">txbytes</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">lrobytes</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">lso_frames</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">xmit_on</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">xmit_off</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">skb_alloc_failure</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">null_rxbuf</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">rx_dma_map_error</span><span class="p">;</span>
	<span class="n">u64</span>  <span class="n">tx_dma_map_error</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Rcv Descriptor Context. One such per Rcv Descriptor. There may</span>
<span class="cm"> * be one Rcv Descriptor for normal packets, one for jumbo and may be others.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qlcnic_host_rds_ring</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">crb_rcv_producer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rcv_desc</span> <span class="o">*</span><span class="n">desc_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_rx_buffer</span> <span class="o">*</span><span class="n">rx_buf_arr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_desc</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">producer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">skb_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">phys_addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">____cacheline_internodealigned_in_smp</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_host_sds_ring</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">consumer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_desc</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">crb_sts_consumer</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">status_desc</span> <span class="o">*</span><span class="n">desc_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">napi_struct</span> <span class="n">napi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free_list</span><span class="p">[</span><span class="n">NUM_RCV_DESC_RINGS</span><span class="p">];</span>

	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">crb_intr_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="n">dma_addr_t</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="o">+</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">____cacheline_internodealigned_in_smp</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_host_tx_ring</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">producer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sw_consumer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_desc</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">crb_cmd_producer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cmd_desc_type0</span> <span class="o">*</span><span class="n">desc_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_cmd_buffer</span> <span class="o">*</span><span class="n">cmd_buf_arr</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="o">*</span><span class="n">hw_consumer</span><span class="p">;</span>

	<span class="n">dma_addr_t</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">hw_cons_phys_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">netdev_queue</span> <span class="o">*</span><span class="n">txq</span><span class="p">;</span>
<span class="p">}</span> <span class="n">____cacheline_internodealigned_in_smp</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Receive context. There is one such structure per instance of the</span>
<span class="cm"> * receive processing. Any state information that is relevant to</span>
<span class="cm"> * the receive, and is must be in this structure. The global data may be</span>
<span class="cm"> * present elsewhere.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qlcnic_recv_context</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">qlcnic_host_rds_ring</span> <span class="o">*</span><span class="n">rds_rings</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_host_sds_ring</span> <span class="o">*</span><span class="n">sds_rings</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">state</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">context_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">virt_port</span><span class="p">;</span>

<span class="p">};</span>

<span class="cm">/* HW context creation */</span>

<span class="cp">#define QLCNIC_OS_CRB_RETRY_COUNT	4000</span>
<span class="cp">#define QLCNIC_CDRP_SIGNATURE_MAKE(pcifn, version) \</span>
<span class="cp">	(((pcifn) &amp; 0xff) | (((version) &amp; 0xff) &lt;&lt; 8) | (0xcafe &lt;&lt; 16))</span>

<span class="cp">#define QLCNIC_CDRP_CMD_BIT		0x80000000</span>

<span class="cm">/*</span>
<span class="cm"> * All responses must have the QLCNIC_CDRP_CMD_BIT cleared</span>
<span class="cm"> * in the crb QLCNIC_CDRP_CRB_OFFSET.</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_CDRP_FORM_RSP(rsp)	(rsp)</span>
<span class="cp">#define QLCNIC_CDRP_IS_RSP(rsp)	(((rsp) &amp; QLCNIC_CDRP_CMD_BIT) == 0)</span>

<span class="cp">#define QLCNIC_CDRP_RSP_OK		0x00000001</span>
<span class="cp">#define QLCNIC_CDRP_RSP_FAIL		0x00000002</span>
<span class="cp">#define QLCNIC_CDRP_RSP_TIMEOUT 	0x00000003</span>

<span class="cm">/*</span>
<span class="cm"> * All commands must have the QLCNIC_CDRP_CMD_BIT set in</span>
<span class="cm"> * the crb QLCNIC_CDRP_CRB_OFFSET.</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_CDRP_FORM_CMD(cmd)	(QLCNIC_CDRP_CMD_BIT | (cmd))</span>
<span class="cp">#define QLCNIC_CDRP_IS_CMD(cmd)	(((cmd) &amp; QLCNIC_CDRP_CMD_BIT) != 0)</span>

<span class="cp">#define QLCNIC_CDRP_CMD_SUBMIT_CAPABILITIES     0x00000001</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_RDS_PER_CTX    0x00000002</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_SDS_PER_CTX    0x00000003</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_RULES_PER_CTX  0x00000004</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_RX_CTX         0x00000005</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_TX_CTX         0x00000006</span>
<span class="cp">#define QLCNIC_CDRP_CMD_CREATE_RX_CTX           0x00000007</span>
<span class="cp">#define QLCNIC_CDRP_CMD_DESTROY_RX_CTX          0x00000008</span>
<span class="cp">#define QLCNIC_CDRP_CMD_CREATE_TX_CTX           0x00000009</span>
<span class="cp">#define QLCNIC_CDRP_CMD_DESTROY_TX_CTX          0x0000000a</span>
<span class="cp">#define QLCNIC_CDRP_CMD_INTRPT_TEST		0x00000011</span>
<span class="cp">#define QLCNIC_CDRP_CMD_SET_MTU                 0x00000012</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_PHY		0x00000013</span>
<span class="cp">#define QLCNIC_CDRP_CMD_WRITE_PHY		0x00000014</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_HW_REG		0x00000015</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_FLOW_CTL		0x00000016</span>
<span class="cp">#define QLCNIC_CDRP_CMD_SET_FLOW_CTL		0x00000017</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_MTU		0x00000018</span>
<span class="cp">#define QLCNIC_CDRP_CMD_READ_MAX_LRO		0x00000019</span>
<span class="cp">#define QLCNIC_CDRP_CMD_MAC_ADDRESS		0x0000001f</span>

<span class="cp">#define QLCNIC_CDRP_CMD_GET_PCI_INFO		0x00000020</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_NIC_INFO		0x00000021</span>
<span class="cp">#define QLCNIC_CDRP_CMD_SET_NIC_INFO		0x00000022</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_ESWITCH_CAPABILITY	0x00000024</span>
<span class="cp">#define QLCNIC_CDRP_CMD_TOGGLE_ESWITCH		0x00000025</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_ESWITCH_STATUS	0x00000026</span>
<span class="cp">#define QLCNIC_CDRP_CMD_SET_PORTMIRRORING	0x00000027</span>
<span class="cp">#define QLCNIC_CDRP_CMD_CONFIGURE_ESWITCH	0x00000028</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_ESWITCH_PORT_CONFIG	0x00000029</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_ESWITCH_STATS	0x0000002a</span>
<span class="cp">#define QLCNIC_CDRP_CMD_CONFIG_PORT		0x0000002E</span>
<span class="cp">#define QLCNIC_CDRP_CMD_TEMP_SIZE		0x0000002f</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_TEMP_HDR		0x00000030</span>
<span class="cp">#define QLCNIC_CDRP_CMD_GET_MAC_STATS		0x00000037</span>

<span class="cp">#define QLCNIC_RCODE_SUCCESS		0</span>
<span class="cp">#define QLCNIC_RCODE_NOT_SUPPORTED	9</span>
<span class="cp">#define QLCNIC_RCODE_TIMEOUT		17</span>
<span class="cp">#define QLCNIC_DESTROY_CTX_RESET	0</span>

<span class="cm">/*</span>
<span class="cm"> * Capabilities Announced</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_CAP0_LEGACY_CONTEXT	(1)</span>
<span class="cp">#define QLCNIC_CAP0_LEGACY_MN		(1 &lt;&lt; 2)</span>
<span class="cp">#define QLCNIC_CAP0_LSO 		(1 &lt;&lt; 6)</span>
<span class="cp">#define QLCNIC_CAP0_JUMBO_CONTIGUOUS	(1 &lt;&lt; 7)</span>
<span class="cp">#define QLCNIC_CAP0_LRO_CONTIGUOUS	(1 &lt;&lt; 8)</span>
<span class="cp">#define QLCNIC_CAP0_VALIDOFF		(1 &lt;&lt; 11)</span>

<span class="cm">/*</span>
<span class="cm"> * Context state</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_HOST_CTX_STATE_FREED	0</span>
<span class="cp">#define QLCNIC_HOST_CTX_STATE_ACTIVE	2</span>

<span class="cm">/*</span>
<span class="cm"> * Rx context</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">qlcnic_hostrq_sds_ring</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">host_phys_addr</span><span class="p">;</span>	<span class="cm">/* Ring base addr */</span>
	<span class="n">__le32</span> <span class="n">ring_size</span><span class="p">;</span>		<span class="cm">/* Ring entries */</span>
	<span class="n">__le16</span> <span class="n">msi_index</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">rsvd</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_hostrq_rds_ring</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">host_phys_addr</span><span class="p">;</span>	<span class="cm">/* Ring base addr */</span>
	<span class="n">__le64</span> <span class="n">buff_size</span><span class="p">;</span>		<span class="cm">/* Packet buffer size */</span>
	<span class="n">__le32</span> <span class="n">ring_size</span><span class="p">;</span>		<span class="cm">/* Ring entries */</span>
	<span class="n">__le32</span> <span class="n">ring_kind</span><span class="p">;</span>		<span class="cm">/* Class of ring */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_hostrq_rx_ctx</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">host_rsp_dma_addr</span><span class="p">;</span>	<span class="cm">/* Response dma&#39;d here */</span>
	<span class="n">__le32</span> <span class="n">capabilities</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Flag bit vector */</span>
	<span class="n">__le32</span> <span class="n">host_int_crb_mode</span><span class="p">;</span>	<span class="cm">/* Interrupt crb usage */</span>
	<span class="n">__le32</span> <span class="n">host_rds_crb_mode</span><span class="p">;</span>	<span class="cm">/* RDS crb usage */</span>
	<span class="cm">/* These ring offsets are relative to data[0] below */</span>
	<span class="n">__le32</span> <span class="n">rds_ring_offset</span><span class="p">;</span>	<span class="cm">/* Offset to RDS config */</span>
	<span class="n">__le32</span> <span class="n">sds_ring_offset</span><span class="p">;</span>	<span class="cm">/* Offset to SDS config */</span>
	<span class="n">__le16</span> <span class="n">num_rds_rings</span><span class="p">;</span>	<span class="cm">/* Count of RDS rings */</span>
	<span class="n">__le16</span> <span class="n">num_sds_rings</span><span class="p">;</span>	<span class="cm">/* Count of SDS rings */</span>
	<span class="n">__le16</span> <span class="n">valid_field_offset</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">txrx_sds_binding</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">msix_handler</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>      <span class="cm">/* reserve space for future expansion*/</span>
	<span class="cm">/* MUST BE 64-bit aligned.</span>
<span class="cm">	   The following is packed:</span>
<span class="cm">	   - N hostrq_rds_rings</span>
<span class="cm">	   - N hostrq_sds_rings */</span>
	<span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_cardrsp_rds_ring</span><span class="p">{</span>
	<span class="n">__le32</span> <span class="n">host_producer_crb</span><span class="p">;</span>	<span class="cm">/* Crb to use */</span>
	<span class="n">__le32</span> <span class="n">rsvd1</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_cardrsp_sds_ring</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">host_consumer_crb</span><span class="p">;</span>	<span class="cm">/* Crb to use */</span>
	<span class="n">__le32</span> <span class="n">interrupt_crb</span><span class="p">;</span>	<span class="cm">/* Crb to use */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_cardrsp_rx_ctx</span> <span class="p">{</span>
	<span class="cm">/* These ring offsets are relative to data[0] below */</span>
	<span class="n">__le32</span> <span class="n">rds_ring_offset</span><span class="p">;</span>	<span class="cm">/* Offset to RDS config */</span>
	<span class="n">__le32</span> <span class="n">sds_ring_offset</span><span class="p">;</span>	<span class="cm">/* Offset to SDS config */</span>
	<span class="n">__le32</span> <span class="n">host_ctx_state</span><span class="p">;</span>	<span class="cm">/* Starting State */</span>
	<span class="n">__le32</span> <span class="n">num_fn_per_port</span><span class="p">;</span>	<span class="cm">/* How many PCI fn share the port */</span>
	<span class="n">__le16</span> <span class="n">num_rds_rings</span><span class="p">;</span>	<span class="cm">/* Count of RDS rings */</span>
	<span class="n">__le16</span> <span class="n">num_sds_rings</span><span class="p">;</span>	<span class="cm">/* Count of SDS rings */</span>
	<span class="n">__le16</span> <span class="n">context_id</span><span class="p">;</span>		<span class="cm">/* Handle for context */</span>
	<span class="n">u8</span>  <span class="n">phys_port</span><span class="p">;</span>		<span class="cm">/* Physical id of port */</span>
	<span class="n">u8</span>  <span class="n">virt_port</span><span class="p">;</span>		<span class="cm">/* Virtual/Logical id of port */</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* save space for future expansion */</span>
	<span class="cm">/*  MUST BE 64-bit aligned.</span>
<span class="cm">	   The following is packed:</span>
<span class="cm">	   - N cardrsp_rds_rings</span>
<span class="cm">	   - N cardrs_sds_rings */</span>
	<span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define SIZEOF_HOSTRQ_RX(HOSTRQ_RX, rds_rings, sds_rings)	\</span>
<span class="cp">	(sizeof(HOSTRQ_RX) + 					\</span>
<span class="cp">	(rds_rings)*(sizeof(struct qlcnic_hostrq_rds_ring)) +		\</span>
<span class="cp">	(sds_rings)*(sizeof(struct qlcnic_hostrq_sds_ring)))</span>

<span class="cp">#define SIZEOF_CARDRSP_RX(CARDRSP_RX, rds_rings, sds_rings) 	\</span>
<span class="cp">	(sizeof(CARDRSP_RX) + 					\</span>
<span class="cp">	(rds_rings)*(sizeof(struct qlcnic_cardrsp_rds_ring)) + 		\</span>
<span class="cp">	(sds_rings)*(sizeof(struct qlcnic_cardrsp_sds_ring)))</span>

<span class="cm">/*</span>
<span class="cm"> * Tx context</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">qlcnic_hostrq_cds_ring</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">host_phys_addr</span><span class="p">;</span>	<span class="cm">/* Ring base addr */</span>
	<span class="n">__le32</span> <span class="n">ring_size</span><span class="p">;</span>		<span class="cm">/* Ring entries */</span>
	<span class="n">__le32</span> <span class="n">rsvd</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_hostrq_tx_ctx</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">host_rsp_dma_addr</span><span class="p">;</span>	<span class="cm">/* Response dma&#39;d here */</span>
	<span class="n">__le64</span> <span class="n">cmd_cons_dma_addr</span><span class="p">;</span>	<span class="cm">/*  */</span>
	<span class="n">__le64</span> <span class="n">dummy_dma_addr</span><span class="p">;</span>	<span class="cm">/*  */</span>
	<span class="n">__le32</span> <span class="n">capabilities</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Flag bit vector */</span>
	<span class="n">__le32</span> <span class="n">host_int_crb_mode</span><span class="p">;</span>	<span class="cm">/* Interrupt crb usage */</span>
	<span class="n">__le32</span> <span class="n">rsvd1</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
	<span class="n">__le16</span> <span class="n">rsvd2</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
	<span class="n">__le16</span> <span class="n">interrupt_ctl</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">msi_index</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">rsvd3</span><span class="p">;</span>		<span class="cm">/* Padding */</span>
	<span class="k">struct</span> <span class="n">qlcnic_hostrq_cds_ring</span> <span class="n">cds_ring</span><span class="p">;</span>	<span class="cm">/* Desc of cds ring */</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* future expansion */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_cardrsp_cds_ring</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">host_producer_crb</span><span class="p">;</span>	<span class="cm">/* Crb to use */</span>
	<span class="n">__le32</span> <span class="n">interrupt_crb</span><span class="p">;</span>	<span class="cm">/* Crb to use */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_cardrsp_tx_ctx</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">host_ctx_state</span><span class="p">;</span>	<span class="cm">/* Starting state */</span>
	<span class="n">__le16</span> <span class="n">context_id</span><span class="p">;</span>		<span class="cm">/* Handle for context */</span>
	<span class="n">u8</span>  <span class="n">phys_port</span><span class="p">;</span>		<span class="cm">/* Physical id of port */</span>
	<span class="n">u8</span>  <span class="n">virt_port</span><span class="p">;</span>		<span class="cm">/* Virtual/Logical id of port */</span>
	<span class="k">struct</span> <span class="n">qlcnic_cardrsp_cds_ring</span> <span class="n">cds_ring</span><span class="p">;</span>	<span class="cm">/* Card cds settings */</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* future expansion */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define SIZEOF_HOSTRQ_TX(HOSTRQ_TX)	(sizeof(HOSTRQ_TX))</span>
<span class="cp">#define SIZEOF_CARDRSP_TX(CARDRSP_TX)	(sizeof(CARDRSP_TX))</span>

<span class="cm">/* CRB */</span>

<span class="cp">#define QLCNIC_HOST_RDS_CRB_MODE_UNIQUE	0</span>
<span class="cp">#define QLCNIC_HOST_RDS_CRB_MODE_SHARED	1</span>
<span class="cp">#define QLCNIC_HOST_RDS_CRB_MODE_CUSTOM	2</span>
<span class="cp">#define QLCNIC_HOST_RDS_CRB_MODE_MAX	3</span>

<span class="cp">#define QLCNIC_HOST_INT_CRB_MODE_UNIQUE	0</span>
<span class="cp">#define QLCNIC_HOST_INT_CRB_MODE_SHARED	1</span>
<span class="cp">#define QLCNIC_HOST_INT_CRB_MODE_NORX	2</span>
<span class="cp">#define QLCNIC_HOST_INT_CRB_MODE_NOTX	3</span>
<span class="cp">#define QLCNIC_HOST_INT_CRB_MODE_NORXTX	4</span>


<span class="cm">/* MAC */</span>

<span class="cp">#define MC_COUNT_P3P	38</span>

<span class="cp">#define QLCNIC_MAC_NOOP	0</span>
<span class="cp">#define QLCNIC_MAC_ADD	1</span>
<span class="cp">#define QLCNIC_MAC_DEL	2</span>
<span class="cp">#define QLCNIC_MAC_VLAN_ADD	3</span>
<span class="cp">#define QLCNIC_MAC_VLAN_DEL	4</span>

<span class="k">struct</span> <span class="n">qlcnic_mac_list_s</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="o">+</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define QLCNIC_HOST_REQUEST	0x13</span>
<span class="cp">#define QLCNIC_REQUEST		0x14</span>

<span class="cp">#define QLCNIC_MAC_EVENT	0x1</span>

<span class="cp">#define QLCNIC_IP_UP		2</span>
<span class="cp">#define QLCNIC_IP_DOWN		3</span>

<span class="cp">#define QLCNIC_ILB_MODE		0x1</span>
<span class="cp">#define QLCNIC_ELB_MODE		0x2</span>

<span class="cp">#define QLCNIC_LINKEVENT	0x1</span>
<span class="cp">#define QLCNIC_LB_RESPONSE	0x2</span>
<span class="cp">#define QLCNIC_IS_LB_CONFIGURED(VAL)	\</span>
<span class="cp">		(VAL == (QLCNIC_LINKEVENT | QLCNIC_LB_RESPONSE))</span>

<span class="cm">/*</span>
<span class="cm"> * Driver --&gt; Firmware</span>
<span class="cm"> */</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_RSS			0x1</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_INTR_COALESCE		0x3</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_LED			0x4</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_LRO_REQUEST			0x7</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_SET_MAC_RECEIVE_MODE		0xc</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_IPADDR		0x12</span>

<span class="cp">#define QLCNIC_H2C_OPCODE_GET_LINKEVENT		0x15</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_BRIDGING		0x17</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_HW_LRO		0x18</span>
<span class="cp">#define QLCNIC_H2C_OPCODE_CONFIG_LOOPBACK		0x13</span>

<span class="cm">/*</span>
<span class="cm"> * Firmware --&gt; Driver</span>
<span class="cm"> */</span>

<span class="cp">#define QLCNIC_C2H_OPCODE_CONFIG_LOOPBACK		0x8f</span>
<span class="cp">#define QLCNIC_C2H_OPCODE_GET_LINKEVENT_RESPONSE	141</span>

<span class="cp">#define VPORT_MISS_MODE_DROP		0 </span><span class="cm">/* drop all unmatched */</span><span class="cp"></span>
<span class="cp">#define VPORT_MISS_MODE_ACCEPT_ALL	1 </span><span class="cm">/* accept all packets */</span><span class="cp"></span>
<span class="cp">#define VPORT_MISS_MODE_ACCEPT_MULTI	2 </span><span class="cm">/* accept unmatched multicast */</span><span class="cp"></span>

<span class="cp">#define QLCNIC_LRO_REQUEST_CLEANUP	4</span>

<span class="cm">/* Capabilites received */</span>
<span class="cp">#define QLCNIC_FW_CAPABILITY_TSO		BIT_1</span>
<span class="cp">#define QLCNIC_FW_CAPABILITY_BDG		BIT_8</span>
<span class="cp">#define QLCNIC_FW_CAPABILITY_FVLANTX		BIT_9</span>
<span class="cp">#define QLCNIC_FW_CAPABILITY_HW_LRO		BIT_10</span>
<span class="cp">#define QLCNIC_FW_CAPABILITY_MULTI_LOOPBACK	BIT_27</span>

<span class="cm">/* module types */</span>
<span class="cp">#define LINKEVENT_MODULE_NOT_PRESENT			1</span>
<span class="cp">#define LINKEVENT_MODULE_OPTICAL_UNKNOWN		2</span>
<span class="cp">#define LINKEVENT_MODULE_OPTICAL_SRLR			3</span>
<span class="cp">#define LINKEVENT_MODULE_OPTICAL_LRM			4</span>
<span class="cp">#define LINKEVENT_MODULE_OPTICAL_SFP_1G 		5</span>
<span class="cp">#define LINKEVENT_MODULE_TWINAX_UNSUPPORTED_CABLE	6</span>
<span class="cp">#define LINKEVENT_MODULE_TWINAX_UNSUPPORTED_CABLELEN	7</span>
<span class="cp">#define LINKEVENT_MODULE_TWINAX 			8</span>

<span class="cp">#define LINKSPEED_10GBPS	10000</span>
<span class="cp">#define LINKSPEED_1GBPS 	1000</span>
<span class="cp">#define LINKSPEED_100MBPS	100</span>
<span class="cp">#define LINKSPEED_10MBPS	10</span>

<span class="cp">#define LINKSPEED_ENCODED_10MBPS	0</span>
<span class="cp">#define LINKSPEED_ENCODED_100MBPS	1</span>
<span class="cp">#define LINKSPEED_ENCODED_1GBPS 	2</span>

<span class="cp">#define LINKEVENT_AUTONEG_DISABLED	0</span>
<span class="cp">#define LINKEVENT_AUTONEG_ENABLED	1</span>

<span class="cp">#define LINKEVENT_HALF_DUPLEX		0</span>
<span class="cp">#define LINKEVENT_FULL_DUPLEX		1</span>

<span class="cp">#define LINKEVENT_LINKSPEED_MBPS	0</span>
<span class="cp">#define LINKEVENT_LINKSPEED_ENCODED	1</span>

<span class="cm">/* firmware response header:</span>
<span class="cm"> *	63:58 - message type</span>
<span class="cm"> *	57:56 - owner</span>
<span class="cm"> *	55:53 - desc count</span>
<span class="cm"> *	52:48 - reserved</span>
<span class="cm"> *	47:40 - completion id</span>
<span class="cm"> *	39:32 - opcode</span>
<span class="cm"> *	31:16 - error code</span>
<span class="cm"> *	15:00 - reserved</span>
<span class="cm"> */</span>
<span class="cp">#define qlcnic_get_nic_msg_opcode(msg_hdr)	\</span>
<span class="cp">	((msg_hdr &gt;&gt; 32) &amp; 0xFF)</span>

<span class="k">struct</span> <span class="n">qlcnic_fw_msg</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u64</span> <span class="n">hdr</span><span class="p">;</span>
			<span class="n">u64</span> <span class="n">body</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
		<span class="p">};</span>
		<span class="n">u64</span> <span class="n">words</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_nic_req</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">qhdr</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">req_hdr</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">words</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_mac_req</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">op</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tag</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mac_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_vlan_req</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">vlan_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">rsvd</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_ipaddr</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">ipv4</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">ipv6</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define QLCNIC_MSI_ENABLED		0x02</span>
<span class="cp">#define QLCNIC_MSIX_ENABLED		0x04</span>
<span class="cp">#define QLCNIC_LRO_ENABLED		0x08</span>
<span class="cp">#define QLCNIC_LRO_DISABLED		0x00</span>
<span class="cp">#define QLCNIC_BRIDGE_ENABLED       	0X10</span>
<span class="cp">#define QLCNIC_DIAG_ENABLED		0x20</span>
<span class="cp">#define QLCNIC_ESWITCH_ENABLED		0x40</span>
<span class="cp">#define QLCNIC_ADAPTER_INITIALIZED	0x80</span>
<span class="cp">#define QLCNIC_TAGGING_ENABLED		0x100</span>
<span class="cp">#define QLCNIC_MACSPOOF			0x200</span>
<span class="cp">#define QLCNIC_MAC_OVERRIDE_DISABLED	0x400</span>
<span class="cp">#define QLCNIC_PROMISC_DISABLED		0x800</span>
<span class="cp">#define QLCNIC_NEED_FLR			0x1000</span>
<span class="cp">#define QLCNIC_FW_RESET_OWNER		0x2000</span>
<span class="cp">#define QLCNIC_FW_HANG			0x4000</span>
<span class="cp">#define QLCNIC_IS_MSI_FAMILY(adapter) \</span>
<span class="cp">	((adapter)-&gt;flags &amp; (QLCNIC_MSI_ENABLED | QLCNIC_MSIX_ENABLED))</span>

<span class="cp">#define QLCNIC_DEF_NUM_STS_DESC_RINGS	4</span>
<span class="cp">#define QLCNIC_MSIX_TBL_SPACE		8192</span>
<span class="cp">#define QLCNIC_PCI_REG_MSIX_TBL 	0x44</span>
<span class="cp">#define QLCNIC_MSIX_TBL_PGSIZE		4096</span>

<span class="cp">#define QLCNIC_NETDEV_WEIGHT	128</span>
<span class="cp">#define QLCNIC_ADAPTER_UP_MAGIC 777</span>

<span class="cp">#define __QLCNIC_FW_ATTACHED		0</span>
<span class="cp">#define __QLCNIC_DEV_UP 		1</span>
<span class="cp">#define __QLCNIC_RESETTING		2</span>
<span class="cp">#define __QLCNIC_START_FW 		4</span>
<span class="cp">#define __QLCNIC_AER			5</span>
<span class="cp">#define __QLCNIC_DIAG_RES_ALLOC		6</span>
<span class="cp">#define __QLCNIC_LED_ENABLE		7</span>

<span class="cp">#define QLCNIC_INTERRUPT_TEST		1</span>
<span class="cp">#define QLCNIC_LOOPBACK_TEST		2</span>
<span class="cp">#define QLCNIC_LED_TEST		3</span>

<span class="cp">#define QLCNIC_FILTER_AGE	80</span>
<span class="cp">#define QLCNIC_READD_AGE	20</span>
<span class="cp">#define QLCNIC_LB_MAX_FILTERS	64</span>

<span class="cm">/* QLCNIC Driver Error Code */</span>
<span class="cp">#define QLCNIC_FW_NOT_RESPOND		51</span>
<span class="cp">#define QLCNIC_TEST_IN_PROGRESS		52</span>
<span class="cp">#define QLCNIC_UNDEFINED_ERROR		53</span>
<span class="cp">#define QLCNIC_LB_CABLE_NOT_CONN	54</span>

<span class="k">struct</span> <span class="n">qlcnic_filter</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hlist_node</span> <span class="n">fnode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">faddr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">__le16</span> <span class="n">vlan_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ftime</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_filter_hash</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hlist_head</span> <span class="o">*</span><span class="n">fhead</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fnum</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fmax</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">qlcnic_hardware_context</span> <span class="o">*</span><span class="n">ahw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_recv_context</span> <span class="o">*</span><span class="n">recv_ctx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_host_tx_ring</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">state</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">num_txd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">num_rxd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">num_jumbo_rxd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_rxd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_jumbo_rxd</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">max_rds_rings</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_sds_rings</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">msix_supported</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">portnum</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">physical_port</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reset_context</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">mc_enabled</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_mc_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fw_wait_cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fw_fail_cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tx_timeo_cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">need_fw_reset</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">has_link_events</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fw_type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_context_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">is_up</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">link_speed</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">link_duplex</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">link_autoneg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">module_type</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">op_mode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">switch_mode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_tx_ques</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_rx_ques</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_mtu</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pvid</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">fw_hal_version</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">capabilities</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">irq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">int_vec_bit</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">heartbeat</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">max_mac_filters</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dev_state</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">diag_test</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">diag_cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reset_ack_timeo</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dev_init_timeo</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">msg_enable</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>

	<span class="n">u64</span> <span class="n">dev_rst_time</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mac_learn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vlans</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">VLAN_N_VID</span><span class="p">)];</span>

	<span class="k">struct</span> <span class="n">qlcnic_npar_info</span> <span class="o">*</span><span class="n">npars</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_eswitch</span> <span class="o">*</span><span class="n">eswitch</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qlcnic_nic_template</span> <span class="o">*</span><span class="n">nic_ops</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">qlcnic_adapter_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">mac_list</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">tgt_mask_reg</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">tgt_status_reg</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">crb_int_state_reg</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">isr_int_vec</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">msix_entry</span> <span class="o">*</span><span class="n">msix_entries</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">fw_work</span><span class="p">;</span>


	<span class="k">struct</span> <span class="n">qlcnic_filter_hash</span> <span class="n">fhash</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">tx_clean_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">mac_learn_lock</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">file_prd_off</span><span class="p">;</span>	<span class="cm">/*File fw product offset*/</span>
	<span class="n">u32</span> <span class="n">fw_version</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_info</span> <span class="p">{</span>
	<span class="n">__le16</span>	<span class="n">pci_func</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">op_mode</span><span class="p">;</span> <span class="cm">/* 1 = Priv, 2 = NP, 3 = NP passthru */</span>
	<span class="n">__le16</span>	<span class="n">phys_port</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">switch_mode</span><span class="p">;</span> <span class="cm">/* 0 = disabled, 1 = int, 2 = ext */</span>

	<span class="n">__le32</span>	<span class="n">capabilities</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">max_mac_filters</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">max_mtu</span><span class="p">;</span>

	<span class="n">__le16</span>	<span class="n">max_tx_ques</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">max_rx_ques</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">min_tx_bw</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">max_tx_bw</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">104</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_pci_info</span> <span class="p">{</span>
	<span class="n">__le16</span>	<span class="n">id</span><span class="p">;</span> <span class="cm">/* pci function id */</span>
	<span class="n">__le16</span>	<span class="n">active</span><span class="p">;</span> <span class="cm">/* 1 = Enabled */</span>
	<span class="n">__le16</span>	<span class="n">type</span><span class="p">;</span> <span class="cm">/* 1 = NIC, 2 = FCoE, 3 = iSCSI */</span>
	<span class="n">__le16</span>	<span class="n">default_port</span><span class="p">;</span> <span class="cm">/* default port number */</span>

	<span class="n">__le16</span>	<span class="n">tx_min_bw</span><span class="p">;</span> <span class="cm">/* Multiple of 100mbpc */</span>
	<span class="n">__le16</span>	<span class="n">tx_max_bw</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">u8</span>	<span class="n">mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">106</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_npar_info</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">pvid</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">min_bw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">max_bw</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">phy_port</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">active</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">enable_pm</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">dest_npar</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">discard_tagged</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">mac_override</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">mac_anti_spoof</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">promisc_mode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">offload_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_eswitch</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">port</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">active_vports</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">active_vlans</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">active_ucast_filters</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">max_ucast_filters</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">max_active_vlans</span><span class="p">;</span>

	<span class="n">u32</span>	<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define QLCNIC_SWITCH_ENABLE		BIT_1</span>
<span class="cp">#define QLCNIC_SWITCH_VLAN_FILTERING	BIT_2</span>
<span class="cp">#define QLCNIC_SWITCH_PROMISC_MODE	BIT_3</span>
<span class="cp">#define QLCNIC_SWITCH_PORT_MIRRORING	BIT_4</span>
<span class="p">};</span>


<span class="cm">/* Return codes for Error handling */</span>
<span class="cp">#define QL_STATUS_INVALID_PARAM	-1</span>

<span class="cp">#define MAX_BW			100	</span><span class="cm">/* % of link speed */</span><span class="cp"></span>
<span class="cp">#define MAX_VLAN_ID		4095</span>
<span class="cp">#define MIN_VLAN_ID		2</span>
<span class="cp">#define DEFAULT_MAC_LEARN	1</span>

<span class="cp">#define IS_VALID_VLAN(vlan)	(vlan &gt;= MIN_VLAN_ID &amp;&amp; vlan &lt; MAX_VLAN_ID)</span>
<span class="cp">#define IS_VALID_BW(bw)		(bw &lt;= MAX_BW)</span>

<span class="k">struct</span> <span class="n">qlcnic_pci_func_cfg</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">func_type</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">min_bw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">max_bw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">port_num</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">pci_func</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">func_state</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">def_mac_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_npar_func_cfg</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">fw_capab</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">port_num</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">min_bw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">max_bw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">max_tx_queues</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">max_rx_queues</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">pci_func</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">op_mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_pm_func_cfg</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">pci_func</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">action</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">dest_npar</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_esw_func_cfg</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">vlan_id</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">op_mode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">op_type</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">pci_func</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">host_vlan_tag</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">promisc_mode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">discard_tagged</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">mac_override</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">mac_anti_spoof</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">offload_flags</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define QLCNIC_STATS_VERSION		1</span>
<span class="cp">#define QLCNIC_STATS_PORT		1</span>
<span class="cp">#define QLCNIC_STATS_ESWITCH		2</span>
<span class="cp">#define QLCNIC_QUERY_RX_COUNTER		0</span>
<span class="cp">#define QLCNIC_QUERY_TX_COUNTER		1</span>
<span class="cp">#define QLCNIC_STATS_NOT_AVAIL	0xffffffffffffffffULL</span>
<span class="cp">#define QLCNIC_FILL_STATS(VAL1) \</span>
<span class="cp">	(((VAL1) == QLCNIC_STATS_NOT_AVAIL) ? 0 : VAL1)</span>
<span class="cp">#define QLCNIC_MAC_STATS 1</span>
<span class="cp">#define QLCNIC_ESW_STATS 2</span>

<span class="cp">#define QLCNIC_ADD_ESW_STATS(VAL1, VAL2)\</span>
<span class="cp">do {	\</span>
<span class="cp">	if (((VAL1) == QLCNIC_STATS_NOT_AVAIL) &amp;&amp; \</span>
<span class="cp">	    ((VAL2) != QLCNIC_STATS_NOT_AVAIL)) \</span>
<span class="cp">		(VAL1) = (VAL2); \</span>
<span class="cp">	else if (((VAL1) != QLCNIC_STATS_NOT_AVAIL) &amp;&amp; \</span>
<span class="cp">		 ((VAL2) != QLCNIC_STATS_NOT_AVAIL)) \</span>
<span class="cp">			(VAL1) += (VAL2); \</span>
<span class="cp">} while (0)</span>

<span class="k">struct</span> <span class="n">qlcnic_mac_statistics</span><span class="p">{</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_frames</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_bytes</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_mcast_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_bcast_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_pause_cnt</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_ctrl_pkt</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_64b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_127b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_255b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_511b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_1023b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_lt_1518b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_tx_gt_1518b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">rsvd1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="n">__le64</span>	<span class="n">mac_rx_frames</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_bytes</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_mcast_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_bcast_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_pause_cnt</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_ctrl_pkt</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_64b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_127b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_255b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_511b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_1023b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_lt_1518b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_gt_1518b_pkts</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">rsvd2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="n">__le64</span>	<span class="n">mac_rx_length_error</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_length_small</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_length_large</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_jabber</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_dropped</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_rx_crc_error</span><span class="p">;</span>
	<span class="n">__le64</span>	<span class="n">mac_align_error</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__qlcnic_esw_statistics</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">context_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">unused</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">unicast_frames</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">multicast_frames</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">broadcast_frames</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">dropped_frames</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">errors</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">local_frames</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">numbytes</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">rsvd</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_esw_statistics</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">__qlcnic_esw_statistics</span> <span class="n">rx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">__qlcnic_esw_statistics</span> <span class="n">tx</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_common_entry_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">type</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">offset</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">cap_size</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">mask</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__crb</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">data_size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">rsvd2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__ctrl</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">index_a</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">timeout</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">data_size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">opcode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">index_v</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">shl_val</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">shr_val</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">val1</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">val2</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">val3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__cache</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">init_tag_val</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">ctrl_addr</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">ctrl_val</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">read_addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">read_addr_stride</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">read_addr_num</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__ocm</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd1</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">read_addr</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">read_addr_stride</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__mem</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__mux</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">val</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">val_stride</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">read_addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">__queue</span> <span class="p">{</span>
	<span class="n">__le32</span>	<span class="n">sel_addr</span><span class="p">;</span>
	<span class="n">__le16</span>	<span class="n">stride</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>
	<span class="n">__le32</span>	<span class="n">no_ops</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd2</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__le32</span>	<span class="n">read_addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">read_addr_stride</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">read_addr_cnt</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">rsvd3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_dump_entry</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">qlcnic_common_entry_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">__crb</span>	<span class="n">crb</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__cache</span>	<span class="n">cache</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__ocm</span>	<span class="n">ocm</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__mem</span>	<span class="n">mem</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__mux</span>	<span class="n">mux</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__queue</span>	<span class="n">que</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">__ctrl</span>	<span class="n">ctrl</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">region</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">op_codes</span> <span class="p">{</span>
	<span class="n">QLCNIC_DUMP_NOP</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_CRB</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_MUX</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_QUEUE</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_BRD_CONFIG</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_OCM</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_PEG_REG</span>	<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L1_DTAG</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L1_ITAG</span>	<span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L1_DATA</span>	<span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L1_INST</span>	<span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L2_DTAG</span>	<span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L2_ITAG</span>	<span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L2_DATA</span>	<span class="o">=</span> <span class="mi">23</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_L2_INST</span>	<span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_ROM</span>	<span class="o">=</span> <span class="mi">71</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_MEM</span>	<span class="o">=</span> <span class="mi">72</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_READ_CTRL</span>	<span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_TLHDR</span>	<span class="o">=</span> <span class="mi">99</span><span class="p">,</span>
	<span class="n">QLCNIC_DUMP_RDEND</span>	<span class="o">=</span> <span class="mi">255</span>
<span class="p">};</span>

<span class="cp">#define QLCNIC_DUMP_WCRB	BIT_0</span>
<span class="cp">#define QLCNIC_DUMP_RWCRB	BIT_1</span>
<span class="cp">#define QLCNIC_DUMP_ANDCRB	BIT_2</span>
<span class="cp">#define QLCNIC_DUMP_ORCRB	BIT_3</span>
<span class="cp">#define QLCNIC_DUMP_POLLCRB	BIT_4</span>
<span class="cp">#define QLCNIC_DUMP_RD_SAVE	BIT_5</span>
<span class="cp">#define QLCNIC_DUMP_WRT_SAVED	BIT_6</span>
<span class="cp">#define QLCNIC_DUMP_MOD_SAVE_ST	BIT_7</span>
<span class="cp">#define QLCNIC_DUMP_SKIP	BIT_7</span>

<span class="cp">#define QLCNIC_DUMP_MASK_MIN		3</span>
<span class="cp">#define QLCNIC_DUMP_MASK_DEF		0x1f</span>
<span class="cp">#define QLCNIC_DUMP_MASK_MAX		0xff</span>
<span class="cp">#define QLCNIC_FORCE_FW_DUMP_KEY	0xdeadfeed</span>
<span class="cp">#define QLCNIC_ENABLE_FW_DUMP		0xaddfeed</span>
<span class="cp">#define QLCNIC_DISABLE_FW_DUMP		0xbadfeed</span>
<span class="cp">#define QLCNIC_FORCE_FW_RESET		0xdeaddead</span>
<span class="cp">#define QLCNIC_SET_QUIESCENT		0xadd00010</span>
<span class="cp">#define QLCNIC_RESET_QUIESCENT		0xadd00020</span>

<span class="k">struct</span> <span class="n">qlcnic_dump_operations</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">op_codes</span> <span class="n">opcode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">handler</span><span class="p">)(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">qlcnic_dump_entry</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">_cdrp_cmd</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">arg1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">arg2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">arg3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">qlcnic_cmd_args</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">_cdrp_cmd</span> <span class="n">req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">_cdrp_cmd</span> <span class="n">rsp</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">qlcnic_fw_cmd_get_minidump_temp</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_fw_cmd_set_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">config</span><span class="p">);</span>

<span class="n">u32</span> <span class="n">qlcnic_hw_read_wx_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">ulong</span> <span class="n">off</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_hw_write_wx_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">ulong</span> <span class="n">off</span><span class="p">,</span> <span class="n">u32</span> <span class="n">data</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_pci_mem_write_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span> <span class="n">off</span><span class="p">,</span> <span class="n">u64</span> <span class="n">data</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_pci_mem_read_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span> <span class="n">off</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_pci_camqm_read_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_pci_camqm_write_2M</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>

<span class="cp">#define ADDR_IN_RANGE(addr, low, high)	\</span>
<span class="cp">	(((addr) &lt; (high)) &amp;&amp; ((addr) &gt;= (low)))</span>

<span class="cp">#define QLCRD32(adapter, off) \</span>
<span class="cp">	(qlcnic_hw_read_wx_2M(adapter, off))</span>
<span class="cp">#define QLCWR32(adapter, off, val) \</span>
<span class="cp">	(qlcnic_hw_write_wx_2M(adapter, off, val))</span>

<span class="kt">int</span> <span class="n">qlcnic_pcie_sem_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_pcie_sem_unlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="cp">#define qlcnic_rom_lock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_lock((a), 2, QLCNIC_ROM_LOCK_ID)</span>
<span class="cp">#define qlcnic_rom_unlock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_unlock((a), 2)</span>
<span class="cp">#define qlcnic_phy_lock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_lock((a), 3, QLCNIC_PHY_LOCK_ID)</span>
<span class="cp">#define qlcnic_phy_unlock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_unlock((a), 3)</span>
<span class="cp">#define qlcnic_api_lock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_lock((a), 5, 0)</span>
<span class="cp">#define qlcnic_api_unlock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_unlock((a), 5)</span>
<span class="cp">#define qlcnic_sw_lock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_lock((a), 6, 0)</span>
<span class="cp">#define qlcnic_sw_unlock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_unlock((a), 6)</span>
<span class="cp">#define crb_win_lock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_lock((a), 7, QLCNIC_CRB_WIN_LOCK_ID)</span>
<span class="cp">#define crb_win_unlock(a)	\</span>
<span class="cp">	qlcnic_pcie_sem_unlock((a), 7)</span>

<span class="cp">#define __QLCNIC_MAX_LED_RATE	0xf</span>
<span class="cp">#define __QLCNIC_MAX_LED_STATE	0x2</span>

<span class="kt">int</span> <span class="n">qlcnic_get_board_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_wol_supported</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_led</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">state</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rate</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_prune_lb_filters</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_delete_lb_filters</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_dump_fw</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* Functions from qlcnic_init.c */</span>
<span class="kt">int</span> <span class="n">qlcnic_load_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_need_fw_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_request_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_release_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_pinit_from_rom</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_setup_idc_param</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_check_flash_fw_ver</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">qlcnic_rom_fast_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">valp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_rom_fast_read_words</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span>
				<span class="n">u8</span> <span class="o">*</span><span class="n">bytes</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_alloc_sw_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_free_sw_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">qlcnic_get_ioaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">qlcnic_alloc_hw_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_free_hw_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">qlcnic_fw_create_ctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_fw_destroy_ctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">qlcnic_reset_rx_buffers_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_release_rx_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_release_tx_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">qlcnic_check_fw_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_watchdog_task</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_post_rx_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">qlcnic_host_rds_ring</span> <span class="o">*</span><span class="n">rds_ring</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_process_rcv_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_host_sds_ring</span> <span class="o">*</span><span class="n">sds_ring</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_set_multi</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_free_mac_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_nic_set_promisc</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_intr_coalesce</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_rss</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_ipaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">ip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_linkevent_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_advert_link_change</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">linkup</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">qlcnic_fw_cmd_set_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mtu</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_change_mtu</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">new_mtu</span><span class="p">);</span>
<span class="n">netdev_features_t</span> <span class="n">qlcnic_fix_features</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
	<span class="n">netdev_features_t</span> <span class="n">features</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_set_features</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="n">netdev_features_t</span> <span class="n">features</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_hw_lro</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_bridged_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">enable</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_send_lro_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_update_cmd_producer</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">qlcnic_host_tx_ring</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_fetch_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_process_rcv_ring_diag</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_host_sds_ring</span> <span class="o">*</span><span class="n">sds_ring</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_clear_lb_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_set_lb_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">);</span>

<span class="cm">/* Functions from qlcnic_ethtool.c */</span>
<span class="kt">int</span> <span class="n">qlcnic_check_loopback_buff</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mac</span><span class="p">[]);</span>

<span class="cm">/* Functions from qlcnic_main.c */</span>
<span class="kt">int</span> <span class="n">qlcnic_reset_context</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_issue_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qlcnic_cmd_args</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_diag_free_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_sds_rings</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_diag_alloc_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">test</span><span class="p">);</span>
<span class="n">netdev_tx_t</span> <span class="n">qlcnic_xmit_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_validate_max_rss</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">max_hw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_set_max_rss</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_dev_request_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">qlcnic_alloc_lb_filters_mem</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="cm">/* Management functions */</span>
<span class="kt">int</span> <span class="n">qlcnic_get_mac_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span><span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_nic_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qlcnic_info</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_set_nic_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qlcnic_info</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_pci_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qlcnic_pci_info</span><span class="o">*</span><span class="p">);</span>

<span class="cm">/*  eSwitch management functions */</span>
<span class="kt">int</span> <span class="n">qlcnic_config_switch_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">qlcnic_esw_func_cfg</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_eswitch_port_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">qlcnic_esw_func_cfg</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_config_port_mirroring</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_port_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">__qlcnic_esw_statistics</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_eswitch_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">__qlcnic_esw_statistics</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_clear_esw_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">qlcnic_get_mac_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qlcnic_mac_statistics</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qlcnic_config_tso</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * QLOGIC Board information</span>
<span class="cm"> */</span>

<span class="cp">#define QLCNIC_MAX_BOARD_NAME_LEN 100</span>
<span class="k">struct</span> <span class="n">qlcnic_brdinfo</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">vendor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">device</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">sub_vendor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">sub_device</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">short_name</span><span class="p">[</span><span class="n">QLCNIC_MAX_BOARD_NAME_LEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qlcnic_brdinfo</span> <span class="n">qlcnic_boards</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x203</span><span class="p">,</span>
		<span class="s">&quot;8200 Series Single Port 10GbE Converged Network Adapter &quot;</span>
		<span class="s">&quot;(TCP/IP Networking)&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x207</span><span class="p">,</span>
		<span class="s">&quot;8200 Series Dual Port 10GbE Converged Network Adapter &quot;</span>
		<span class="s">&quot;(TCP/IP Networking)&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x20b</span><span class="p">,</span>
		<span class="s">&quot;3200 Series Dual Port 10Gb Intelligent Ethernet Adapter&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x20c</span><span class="p">,</span>
		<span class="s">&quot;3200 Series Quad Port 1Gb Intelligent Ethernet Adapter&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x20f</span><span class="p">,</span>
		<span class="s">&quot;3200 Series Single Port 10Gb Intelligent Ethernet Adapter&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x3733</span><span class="p">,</span>
		<span class="s">&quot;NC523SFP 10Gb 2-port Server Adapter&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x3346</span><span class="p">,</span>
		<span class="s">&quot;CN1000Q Dual Port Converged Network Adapter&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x210</span><span class="p">,</span>
		<span class="s">&quot;QME8242-k 10GbE Dual Port Mezzanine Card&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1077</span><span class="p">,</span> <span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="s">&quot;cLOM8214 1/10GbE Controller&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define NUM_SUPPORTED_BOARDS ARRAY_SIZE(qlcnic_boards)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">qlcnic_tx_avail</span><span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_host_tx_ring</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">producer</span> <span class="o">&lt;</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">sw_consumer</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">sw_consumer</span> <span class="o">-</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">producer</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">sw_consumer</span> <span class="o">+</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">num_desc</span> <span class="o">-</span>
				<span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">producer</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ethtool_ops</span> <span class="n">qlcnic_ethtool_ops</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ethtool_ops</span> <span class="n">qlcnic_ethtool_failed_ops</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">qlcnic_nic_template</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">config_bridged_mode</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">config_led</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">start_firmware</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">qlcnic_adapter</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define QLCDB(adapter, lvl, _fmt, _args...) do {	\</span>
<span class="cp">	if (NETIF_MSG_##lvl &amp; adapter-&gt;msg_enable)	\</span>
<span class="cp">		printk(KERN_INFO &quot;%s: %s: &quot; _fmt,	\</span>
<span class="cp">			 dev_name(&amp;adapter-&gt;pdev-&gt;dev),	\</span>
<span class="cp">			__func__, ##_args);		\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#endif				</span><span class="cm">/* __QLCNIC_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
