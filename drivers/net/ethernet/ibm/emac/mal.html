<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › ibm › emac › mal.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>mal.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * drivers/net/ethernet/ibm/emac/mal.h</span>
<span class="cm"> *</span>
<span class="cm"> * Memory Access Layer (MAL) support</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2007 Benjamin Herrenschmidt, IBM Corp.</span>
<span class="cm"> *                &lt;benh@kernel.crashing.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the arch/ppc version of the driver:</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2004, 2005 Zultys Technologies.</span>
<span class="cm"> * Eugene Surovegin &lt;eugene.surovegin@zultys.com&gt; or &lt;ebs@ebshome.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on original work by</span>
<span class="cm"> *      Armin Kuster &lt;akuster@mvista.com&gt;</span>
<span class="cm"> *      Copyright 2002 MontaVista Softare Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> * under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> * Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> * option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __IBM_NEWEMAC_MAL_H</span>
<span class="cp">#define __IBM_NEWEMAC_MAL_H</span>

<span class="cm">/*</span>
<span class="cm"> * There are some variations on the MAL, we express them in this driver as</span>
<span class="cm"> * MAL Version 1 and 2 though that doesn&#39;t match any IBM terminology.</span>
<span class="cm"> *</span>
<span class="cm"> * We call MAL 1 the version in 405GP, 405GPR, 405EP, 440EP, 440GR and</span>
<span class="cm"> * NP405H.</span>
<span class="cm"> *</span>
<span class="cm"> * We call MAL 2 the version in 440GP, 440GX, 440SP, 440SPE and Axon</span>
<span class="cm"> *</span>
<span class="cm"> * The driver expects a &quot;version&quot; property in the emac node containing</span>
<span class="cm"> * a number 1 or 2. New device-trees for EMAC capable platforms are thus</span>
<span class="cm"> * required to include that when porting to arch/powerpc.</span>
<span class="cm"> */</span>

<span class="cm">/* MALx DCR registers */</span>
<span class="cp">#define	MAL_CFG			0x00</span>
<span class="cp">#define	  MAL_CFG_SR		0x80000000</span>
<span class="cp">#define   MAL_CFG_PLBB		0x00004000</span>
<span class="cp">#define   MAL_CFG_OPBBL		0x00000080</span>
<span class="cp">#define   MAL_CFG_EOPIE		0x00000004</span>
<span class="cp">#define   MAL_CFG_LEA		0x00000002</span>
<span class="cp">#define   MAL_CFG_SD		0x00000001</span>

<span class="cm">/* MAL V1 CFG bits */</span>
<span class="cp">#define   MAL1_CFG_PLBP_MASK	0x00c00000</span>
<span class="cp">#define   MAL1_CFG_PLBP_10	0x00800000</span>
<span class="cp">#define   MAL1_CFG_GA		0x00200000</span>
<span class="cp">#define   MAL1_CFG_OA		0x00100000</span>
<span class="cp">#define   MAL1_CFG_PLBLE	0x00080000</span>
<span class="cp">#define   MAL1_CFG_PLBT_MASK	0x00078000</span>
<span class="cp">#define   MAL1_CFG_DEFAULT	(MAL1_CFG_PLBP_10 | MAL1_CFG_PLBT_MASK)</span>

<span class="cm">/* MAL V2 CFG bits */</span>
<span class="cp">#define   MAL2_CFG_RPP_MASK	0x00c00000</span>
<span class="cp">#define   MAL2_CFG_RPP_10	0x00800000</span>
<span class="cp">#define   MAL2_CFG_RMBS_MASK	0x00300000</span>
<span class="cp">#define   MAL2_CFG_WPP_MASK	0x000c0000</span>
<span class="cp">#define   MAL2_CFG_WPP_10	0x00080000</span>
<span class="cp">#define   MAL2_CFG_WMBS_MASK	0x00030000</span>
<span class="cp">#define   MAL2_CFG_PLBLE	0x00008000</span>
<span class="cp">#define   MAL2_CFG_DEFAULT	(MAL2_CFG_RMBS_MASK | MAL2_CFG_WMBS_MASK | \</span>
<span class="cp">				 MAL2_CFG_RPP_10 | MAL2_CFG_WPP_10)</span>

<span class="cp">#define MAL_ESR			0x01</span>
<span class="cp">#define   MAL_ESR_EVB		0x80000000</span>
<span class="cp">#define   MAL_ESR_CIDT		0x40000000</span>
<span class="cp">#define   MAL_ESR_CID_MASK	0x3e000000</span>
<span class="cp">#define   MAL_ESR_CID_SHIFT	25</span>
<span class="cp">#define   MAL_ESR_DE		0x00100000</span>
<span class="cp">#define   MAL_ESR_OTE		0x00040000</span>
<span class="cp">#define   MAL_ESR_OSE		0x00020000</span>
<span class="cp">#define   MAL_ESR_PEIN		0x00010000</span>
<span class="cp">#define   MAL_ESR_DEI		0x00000010</span>
<span class="cp">#define   MAL_ESR_OTEI		0x00000004</span>
<span class="cp">#define   MAL_ESR_OSEI		0x00000002</span>
<span class="cp">#define   MAL_ESR_PBEI		0x00000001</span>

<span class="cm">/* MAL V1 ESR bits */</span>
<span class="cp">#define   MAL1_ESR_ONE		0x00080000</span>
<span class="cp">#define   MAL1_ESR_ONEI		0x00000008</span>

<span class="cm">/* MAL V2 ESR bits */</span>
<span class="cp">#define   MAL2_ESR_PTE		0x00800000</span>
<span class="cp">#define   MAL2_ESR_PRE		0x00400000</span>
<span class="cp">#define   MAL2_ESR_PWE		0x00200000</span>
<span class="cp">#define   MAL2_ESR_PTEI		0x00000080</span>
<span class="cp">#define   MAL2_ESR_PREI		0x00000040</span>
<span class="cp">#define   MAL2_ESR_PWEI		0x00000020</span>


<span class="cp">#define MAL_IER			0x02</span>
<span class="cp">#define   MAL_IER_DE		0x00000010</span>
<span class="cp">#define   MAL_IER_OTE		0x00000004</span>
<span class="cp">#define   MAL_IER_OE		0x00000002</span>
<span class="cp">#define   MAL_IER_PE		0x00000001</span>
<span class="cm">/* MAL V1 IER bits */</span>
<span class="cp">#define   MAL1_IER_NWE		0x00000008</span>
<span class="cp">#define   MAL1_IER_SOC_EVENTS	MAL1_IER_NWE</span>
<span class="cp">#define   MAL1_IER_EVENTS	(MAL1_IER_SOC_EVENTS | MAL_IER_DE | \</span>
<span class="cp">				 MAL_IER_OTE | MAL_IER_OE | MAL_IER_PE)</span>

<span class="cm">/* MAL V2 IER bits */</span>
<span class="cp">#define   MAL2_IER_PT		0x00000080</span>
<span class="cp">#define   MAL2_IER_PRE		0x00000040</span>
<span class="cp">#define   MAL2_IER_PWE		0x00000020</span>
<span class="cp">#define   MAL2_IER_SOC_EVENTS	(MAL2_IER_PT | MAL2_IER_PRE | MAL2_IER_PWE)</span>
<span class="cp">#define   MAL2_IER_EVENTS	(MAL2_IER_SOC_EVENTS | MAL_IER_DE | \</span>
<span class="cp">				 MAL_IER_OTE | MAL_IER_OE | MAL_IER_PE)</span>


<span class="cp">#define MAL_TXCASR		0x04</span>
<span class="cp">#define MAL_TXCARR		0x05</span>
<span class="cp">#define MAL_TXEOBISR		0x06</span>
<span class="cp">#define MAL_TXDEIR		0x07</span>
<span class="cp">#define MAL_RXCASR		0x10</span>
<span class="cp">#define MAL_RXCARR		0x11</span>
<span class="cp">#define MAL_RXEOBISR		0x12</span>
<span class="cp">#define MAL_RXDEIR		0x13</span>
<span class="cp">#define MAL_TXCTPR(n)		((n) + 0x20)</span>
<span class="cp">#define MAL_RXCTPR(n)		((n) + 0x40)</span>
<span class="cp">#define MAL_RCBS(n)		((n) + 0x60)</span>

<span class="cm">/* In reality MAL can handle TX buffers up to 4095 bytes long,</span>
<span class="cm"> * but this isn&#39;t a good round number :) 		 --ebs</span>
<span class="cm"> */</span>
<span class="cp">#define MAL_MAX_TX_SIZE		4080</span>
<span class="cp">#define MAL_MAX_RX_SIZE		4080</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mal_rx_size</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0xf</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">len</span> <span class="o">&gt;</span> <span class="n">MAL_MAX_RX_SIZE</span> <span class="o">?</span> <span class="n">MAL_MAX_RX_SIZE</span> <span class="o">:</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mal_tx_chunks</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">len</span> <span class="o">+</span> <span class="n">MAL_MAX_TX_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">MAL_MAX_TX_SIZE</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define MAL_CHAN_MASK(n)	(0x80000000 &gt;&gt; (n))</span>

<span class="cm">/* MAL Buffer Descriptor structure */</span>
<span class="k">struct</span> <span class="n">mal_descriptor</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">ctrl</span><span class="p">;</span>		<span class="cm">/* MAL / Commac status control bits */</span>
	<span class="n">u16</span> <span class="n">data_len</span><span class="p">;</span>		<span class="cm">/* Max length is 4K-1 (12 bits)     */</span>
	<span class="n">u32</span> <span class="n">data_ptr</span><span class="p">;</span>		<span class="cm">/* pointer to actual data buffer    */</span>
<span class="p">};</span>

<span class="cm">/* the following defines are for the MadMAL status and control registers. */</span>
<span class="cm">/* MADMAL transmit and receive status/control bits  */</span>
<span class="cp">#define MAL_RX_CTRL_EMPTY	0x8000</span>
<span class="cp">#define MAL_RX_CTRL_WRAP	0x4000</span>
<span class="cp">#define MAL_RX_CTRL_CM		0x2000</span>
<span class="cp">#define MAL_RX_CTRL_LAST	0x1000</span>
<span class="cp">#define MAL_RX_CTRL_FIRST	0x0800</span>
<span class="cp">#define MAL_RX_CTRL_INTR	0x0400</span>
<span class="cp">#define MAL_RX_CTRL_SINGLE	(MAL_RX_CTRL_LAST | MAL_RX_CTRL_FIRST)</span>
<span class="cp">#define MAL_IS_SINGLE_RX(ctrl)	(((ctrl) &amp; MAL_RX_CTRL_SINGLE) == MAL_RX_CTRL_SINGLE)</span>

<span class="cp">#define MAL_TX_CTRL_READY	0x8000</span>
<span class="cp">#define MAL_TX_CTRL_WRAP	0x4000</span>
<span class="cp">#define MAL_TX_CTRL_CM		0x2000</span>
<span class="cp">#define MAL_TX_CTRL_LAST	0x1000</span>
<span class="cp">#define MAL_TX_CTRL_INTR	0x0400</span>

<span class="k">struct</span> <span class="n">mal_commac_ops</span> <span class="p">{</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span><span class="n">poll_tx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">poll_rx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">budget</span><span class="p">);</span>
	<span class="kt">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">peek_rx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span><span class="n">rxde</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mal_commac</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mal_commac_ops</span>	<span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">poll_list</span><span class="p">;</span>
	<span class="kt">long</span>       		<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define MAL_COMMAC_RX_STOPPED		0</span>
<span class="cp">#define MAL_COMMAC_POLL_DISABLED	1</span>
	<span class="n">u32</span>			<span class="n">tx_chan_mask</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">rx_chan_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mal_instance</span> <span class="p">{</span>
	<span class="kt">int</span>			<span class="n">version</span><span class="p">;</span>
	<span class="n">dcr_host_t</span>		<span class="n">dcr_host</span><span class="p">;</span>

	<span class="kt">int</span>			<span class="n">num_tx_chans</span><span class="p">;</span>	<span class="cm">/* Number of TX channels */</span>
	<span class="kt">int</span>			<span class="n">num_rx_chans</span><span class="p">;</span>	<span class="cm">/* Number of RX channels */</span>
	<span class="kt">int</span> 			<span class="n">txeob_irq</span><span class="p">;</span>	<span class="cm">/* TX End Of Buffer IRQ  */</span>
	<span class="kt">int</span> 			<span class="n">rxeob_irq</span><span class="p">;</span>	<span class="cm">/* RX End Of Buffer IRQ  */</span>
	<span class="kt">int</span>			<span class="n">txde_irq</span><span class="p">;</span>	<span class="cm">/* TX Descriptor Error IRQ */</span>
	<span class="kt">int</span>			<span class="n">rxde_irq</span><span class="p">;</span>	<span class="cm">/* RX Descriptor Error IRQ */</span>
	<span class="kt">int</span>			<span class="n">serr_irq</span><span class="p">;</span>	<span class="cm">/* MAL System Error IRQ    */</span>

	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">poll_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">napi_struct</span>	<span class="n">napi</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">tx_chan_mask</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">rx_chan_mask</span><span class="p">;</span>

	<span class="n">dma_addr_t</span>		<span class="n">bd_dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mal_descriptor</span>	<span class="o">*</span><span class="n">bd_virt</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">platform_device</span>	<span class="o">*</span><span class="n">ofdev</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">index</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">net_device</span>	<span class="n">dummy_dev</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">features</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">get_mal_dcrn</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dcr_read</span><span class="p">(</span><span class="n">mal</span><span class="o">-&gt;</span><span class="n">dcr_host</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_mal_dcrn</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dcr_write</span><span class="p">(</span><span class="n">mal</span><span class="o">-&gt;</span><span class="n">dcr_host</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Features of various MAL implementations */</span>

<span class="cm">/* Set if you have interrupt coalescing and you have to clear the SDR</span>
<span class="cm"> * register for TXEOB and RXEOB interrupts to work</span>
<span class="cm"> */</span>
<span class="cp">#define MAL_FTR_CLEAR_ICINTSTAT	0x00000001</span>

<span class="cm">/* Set if your MAL has SERR, TXDE, and RXDE OR&#39;d into a single UIC</span>
<span class="cm"> * interrupt</span>
<span class="cm"> */</span>
<span class="cp">#define MAL_FTR_COMMON_ERR_INT	0x00000002</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MAL_FTRS_ALWAYS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="n">MAL_FTRS_POSSIBLE</span> <span class="o">=</span>
<span class="cp">#ifdef CONFIG_IBM_EMAC_MAL_CLR_ICINTSTAT</span>
		<span class="n">MAL_FTR_CLEAR_ICINTSTAT</span> <span class="o">|</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_IBM_EMAC_MAL_COMMON_ERR</span>
		<span class="n">MAL_FTR_COMMON_ERR_INT</span> <span class="o">|</span>
<span class="cp">#endif</span>
		<span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mal_has_feature</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">feature</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">MAL_FTRS_ALWAYS</span> <span class="o">&amp;</span> <span class="n">feature</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">MAL_FTRS_POSSIBLE</span> <span class="o">&amp;</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">features</span> <span class="o">&amp;</span> <span class="n">feature</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Register MAL devices */</span>
<span class="kt">int</span> <span class="n">mal_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mal_register_commac</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_unregister_commac</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mal_set_rcbs</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>

<span class="cm">/* Returns BD ring offset for a particular channel</span>
<span class="cm">   (in &#39;struct mal_descriptor&#39; elements)</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="n">mal_tx_bd_offset</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mal_rx_bd_offset</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mal_enable_tx_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_disable_tx_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_enable_rx_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_disable_rx_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mal_poll_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_poll_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>

<span class="cm">/* Add/remove EMAC to/from MAL polling list */</span>
<span class="kt">void</span> <span class="n">mal_poll_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mal_poll_del</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mal_commac</span> <span class="o">*</span><span class="n">commac</span><span class="p">);</span>

<span class="cm">/* Ethtool MAL registers */</span>
<span class="k">struct</span> <span class="n">mal_regs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">tx_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_count</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">cfg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">esr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ier</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_casr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_carr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_eobisr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_deir</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_casr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_carr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_eobisr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_deir</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_ctpr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">rx_ctpr</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">rcbs</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">mal_get_regs_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">);</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">mal_dump_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">mal_instance</span> <span class="o">*</span><span class="n">mal</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __IBM_NEWEMAC_MAL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
