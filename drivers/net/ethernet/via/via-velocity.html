<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › via › via-velocity.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>via-velocity.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 1996, 2003 VIA Networking Technologies, Inc.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be redistributed and/or modified under</span>
<span class="cm"> * the terms of the GNU General Public License as published by the Free</span>
<span class="cm"> * Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</span>
<span class="cm"> * or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * File: via-velocity.h</span>
<span class="cm"> *</span>
<span class="cm"> * Purpose: Header file to define driver&#39;s private structures.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Chuang Liang-Shing, AJ Jiang</span>
<span class="cm"> *</span>
<span class="cm"> * Date: Jan 24, 2003</span>
<span class="cm"> */</span>


<span class="cp">#ifndef VELOCITY_H</span>
<span class="cp">#define VELOCITY_H</span>

<span class="cp">#define VELOCITY_TX_CSUM_SUPPORT</span>

<span class="cp">#define VELOCITY_NAME          &quot;via-velocity&quot;</span>
<span class="cp">#define VELOCITY_FULL_DRV_NAM  &quot;VIA Networking Velocity Family Gigabit Ethernet Adapter Driver&quot;</span>
<span class="cp">#define VELOCITY_VERSION       &quot;1.15&quot;</span>

<span class="cp">#define VELOCITY_IO_SIZE	256</span>
<span class="cp">#define VELOCITY_NAPI_WEIGHT	64</span>

<span class="cp">#define PKT_BUF_SZ          1540</span>

<span class="cp">#define MAX_UNITS           8</span>
<span class="cp">#define OPTION_DEFAULT      { [0 ... MAX_UNITS-1] = -1}</span>

<span class="cp">#define REV_ID_VT6110       (0)</span>

<span class="cp">#define BYTE_REG_BITS_ON(x,p)       do { writeb(readb((p))|(x),(p));} while (0)</span>
<span class="cp">#define WORD_REG_BITS_ON(x,p)       do { writew(readw((p))|(x),(p));} while (0)</span>
<span class="cp">#define DWORD_REG_BITS_ON(x,p)      do { writel(readl((p))|(x),(p));} while (0)</span>

<span class="cp">#define BYTE_REG_BITS_IS_ON(x,p)    (readb((p)) &amp; (x))</span>
<span class="cp">#define WORD_REG_BITS_IS_ON(x,p)    (readw((p)) &amp; (x))</span>
<span class="cp">#define DWORD_REG_BITS_IS_ON(x,p)   (readl((p)) &amp; (x))</span>

<span class="cp">#define BYTE_REG_BITS_OFF(x,p)      do { writeb(readb((p)) &amp; (~(x)),(p));} while (0)</span>
<span class="cp">#define WORD_REG_BITS_OFF(x,p)      do { writew(readw((p)) &amp; (~(x)),(p));} while (0)</span>
<span class="cp">#define DWORD_REG_BITS_OFF(x,p)     do { writel(readl((p)) &amp; (~(x)),(p));} while (0)</span>

<span class="cp">#define BYTE_REG_BITS_SET(x,m,p)    do { writeb( (readb((p)) &amp; (~(m))) |(x),(p));} while (0)</span>
<span class="cp">#define WORD_REG_BITS_SET(x,m,p)    do { writew( (readw((p)) &amp; (~(m))) |(x),(p));} while (0)</span>
<span class="cp">#define DWORD_REG_BITS_SET(x,m,p)   do { writel( (readl((p)) &amp; (~(m)))|(x),(p));}  while (0)</span>

<span class="cp">#define VAR_USED(p)     do {(p)=(p);} while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * Purpose: Structures for MAX RX/TX descriptors.</span>
<span class="cm"> */</span>


<span class="cp">#define B_OWNED_BY_CHIP     1</span>
<span class="cp">#define B_OWNED_BY_HOST     0</span>

<span class="cm">/*</span>
<span class="cm"> * Bits in the RSR0 register</span>
<span class="cm"> */</span>

<span class="cp">#define RSR_DETAG	cpu_to_le16(0x0080)</span>
<span class="cp">#define RSR_SNTAG	cpu_to_le16(0x0040)</span>
<span class="cp">#define RSR_RXER	cpu_to_le16(0x0020)</span>
<span class="cp">#define RSR_RL		cpu_to_le16(0x0010)</span>
<span class="cp">#define RSR_CE		cpu_to_le16(0x0008)</span>
<span class="cp">#define RSR_FAE		cpu_to_le16(0x0004)</span>
<span class="cp">#define RSR_CRC		cpu_to_le16(0x0002)</span>
<span class="cp">#define RSR_VIDM	cpu_to_le16(0x0001)</span>

<span class="cm">/*</span>
<span class="cm"> * Bits in the RSR1 register</span>
<span class="cm"> */</span>

<span class="cp">#define RSR_RXOK	cpu_to_le16(0x8000) </span><span class="c1">// rx OK</span>
<span class="cp">#define RSR_PFT		cpu_to_le16(0x4000) </span><span class="c1">// Perfect filtering address match</span>
<span class="cp">#define RSR_MAR		cpu_to_le16(0x2000) </span><span class="c1">// MAC accept multicast address packet</span>
<span class="cp">#define RSR_BAR		cpu_to_le16(0x1000) </span><span class="c1">// MAC accept broadcast address packet</span>
<span class="cp">#define RSR_PHY		cpu_to_le16(0x0800) </span><span class="c1">// MAC accept physical address packet</span>
<span class="cp">#define RSR_VTAG	cpu_to_le16(0x0400) </span><span class="c1">// 802.1p/1q tagging packet indicator</span>
<span class="cp">#define RSR_STP		cpu_to_le16(0x0200) </span><span class="c1">// start of packet</span>
<span class="cp">#define RSR_EDP		cpu_to_le16(0x0100) </span><span class="c1">// end of packet</span>

<span class="cm">/*</span>
<span class="cm"> * Bits in the CSM register</span>
<span class="cm"> */</span>

<span class="cp">#define CSM_IPOK            0x40	</span><span class="c1">//IP Checksum validation ok</span>
<span class="cp">#define CSM_TUPOK           0x20	</span><span class="c1">//TCP/UDP Checksum validation ok</span>
<span class="cp">#define CSM_FRAG            0x10	</span><span class="c1">//Fragment IP datagram</span>
<span class="cp">#define CSM_IPKT            0x04	</span><span class="c1">//Received an IP packet</span>
<span class="cp">#define CSM_TCPKT           0x02	</span><span class="c1">//Received a TCP packet</span>
<span class="cp">#define CSM_UDPKT           0x01	</span><span class="c1">//Received a UDP packet</span>

<span class="cm">/*</span>
<span class="cm"> * Bits in the TSR0 register</span>
<span class="cm"> */</span>

<span class="cp">#define TSR0_ABT	cpu_to_le16(0x0080) </span><span class="c1">// Tx abort because of excessive collision</span>
<span class="cp">#define TSR0_OWT	cpu_to_le16(0x0040) </span><span class="c1">// Jumbo frame Tx abort</span>
<span class="cp">#define TSR0_OWC	cpu_to_le16(0x0020) </span><span class="c1">// Out of window collision</span>
<span class="cp">#define TSR0_COLS	cpu_to_le16(0x0010) </span><span class="c1">// experience collision in this transmit event</span>
<span class="cp">#define TSR0_NCR3	cpu_to_le16(0x0008) </span><span class="c1">// collision retry counter[3]</span>
<span class="cp">#define TSR0_NCR2	cpu_to_le16(0x0004) </span><span class="c1">// collision retry counter[2]</span>
<span class="cp">#define TSR0_NCR1	cpu_to_le16(0x0002) </span><span class="c1">// collision retry counter[1]</span>
<span class="cp">#define TSR0_NCR0	cpu_to_le16(0x0001) </span><span class="c1">// collision retry counter[0]</span>
<span class="cp">#define TSR0_TERR	cpu_to_le16(0x8000) </span><span class="c1">//</span>
<span class="cp">#define TSR0_FDX	cpu_to_le16(0x4000) </span><span class="c1">// current transaction is serviced by full duplex mode</span>
<span class="cp">#define TSR0_GMII	cpu_to_le16(0x2000) </span><span class="c1">// current transaction is serviced by GMII mode</span>
<span class="cp">#define TSR0_LNKFL	cpu_to_le16(0x1000) </span><span class="c1">// packet serviced during link down</span>
<span class="cp">#define TSR0_SHDN	cpu_to_le16(0x0400) </span><span class="c1">// shutdown case</span>
<span class="cp">#define TSR0_CRS	cpu_to_le16(0x0200) </span><span class="c1">// carrier sense lost</span>
<span class="cp">#define TSR0_CDH	cpu_to_le16(0x0100) </span><span class="c1">// AQE test fail (CD heartbeat)</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Bits in the TCR0 register</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define TCR0_TIC            0x80	</span><span class="c1">// assert interrupt immediately while descriptor has been send complete</span>
<span class="cp">#define TCR0_PIC            0x40	</span><span class="c1">// priority interrupt request, INA# is issued over adaptive interrupt scheme</span>
<span class="cp">#define TCR0_VETAG          0x20	</span><span class="c1">// enable VLAN tag</span>
<span class="cp">#define TCR0_IPCK           0x10	</span><span class="c1">// request IP  checksum calculation.</span>
<span class="cp">#define TCR0_UDPCK          0x08	</span><span class="c1">// request UDP checksum calculation.</span>
<span class="cp">#define TCR0_TCPCK          0x04	</span><span class="c1">// request TCP checksum calculation.</span>
<span class="cp">#define TCR0_JMBO           0x02	</span><span class="c1">// indicate a jumbo packet in GMAC side</span>
<span class="cp">#define TCR0_CRC            0x01	</span><span class="c1">// disable CRC generation</span>

<span class="cp">#define TCPLS_NORMAL        3</span>
<span class="cp">#define TCPLS_START         2</span>
<span class="cp">#define TCPLS_END           1</span>
<span class="cp">#define TCPLS_MED           0</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>max transmit or receive buffer size</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define CB_RX_BUF_SIZE     2048UL	</span><span class="c1">// max buffer size</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>NOTE: must be multiple of 4</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define CB_MAX_RD_NUM       512	</span><span class="c1">// MAX # of RD</span>
<span class="cp">#define CB_MAX_TD_NUM       256	</span><span class="c1">// MAX # of TD</span>

<span class="cp">#define CB_INIT_RD_NUM_3119 128	</span><span class="c1">// init # of RD, for setup VT3119</span>
<span class="cp">#define CB_INIT_TD_NUM_3119 64	</span><span class="c1">// init # of TD, for setup VT3119</span>

<span class="cp">#define CB_INIT_RD_NUM      128	</span><span class="c1">// init # of RD, for setup default</span>
<span class="cp">#define CB_INIT_TD_NUM      64	</span><span class="c1">// init # of TD, for setup default</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>for 3119</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define CB_TD_RING_NUM      4	</span><span class="c1">// # of TD rings.</span>
<span class="cp">#define CB_MAX_SEG_PER_PKT  7	</span><span class="c1">// max data seg per packet (Tx)</span>


<span class="cm">/*</span>
<span class="cm"> *	If collisions excess 15 times , tx will abort, and</span>
<span class="cm"> *	if tx fifo underflow, tx will fail</span>
<span class="cm"> *	we should try to resend it</span>
<span class="cm"> */</span>

<span class="cp">#define CB_MAX_TX_ABORT_RETRY   3</span>

<span class="cm">/*</span>
<span class="cm"> *	Receive descriptor</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">rdesc0</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">RSR</span><span class="p">;</span>		<span class="cm">/* Receive status */</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>		<span class="cm">/* bits 0--13; bit 15 - owner */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rdesc1</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">PQTAG</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">CSM</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">IPKT</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">RX_INTEN</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="mh">0x8000</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rx_desc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">rdesc0</span> <span class="n">rdesc0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rdesc1</span> <span class="n">rdesc1</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">pa_low</span><span class="p">;</span>		<span class="cm">/* Low 32 bit PCI address */</span>
	<span class="n">__le16</span> <span class="n">pa_high</span><span class="p">;</span>		<span class="cm">/* Next 16 bit PCI address (48 total) */</span>
	<span class="n">__le16</span> <span class="n">size</span><span class="p">;</span>		<span class="cm">/* bits 0--14 - frame size, bit 15 - enable int. */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Transmit descriptor</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">tdesc0</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">TSR</span><span class="p">;</span>		<span class="cm">/* Transmit status register */</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>		<span class="cm">/* bits 0--13 - size of frame, bit 15 - owner */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tdesc1</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">vlan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">TCR</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cmd</span><span class="p">;</span>			<span class="cm">/* bits 0--1 - TCPLS, bits 4--7 - CMDZ */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TD_QUEUE</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="mh">0x8000</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">td_buf</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">pa_low</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">pa_high</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">size</span><span class="p">;</span>		<span class="cm">/* bits 0--13 - size, bit 15 - queue */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">tx_desc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">tdesc0</span> <span class="n">tdesc0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tdesc1</span> <span class="n">tdesc1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">td_buf</span> <span class="n">td_buf</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">velocity_rd_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">skb_dma</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Used to track transmit side buffers.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">velocity_td_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nskb_dma</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">skb_dma</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">enum</span>  <span class="n">velocity_owner</span> <span class="p">{</span>
	<span class="n">OWNED_BY_HOST</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">OWNED_BY_NIC</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="mh">0x8000</span><span class="p">)</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> *	MAC registers and macros.</span>
<span class="cm"> */</span>


<span class="cp">#define MCAM_SIZE           64</span>
<span class="cp">#define VCAM_SIZE           64</span>
<span class="cp">#define TX_QUEUE_NO         4</span>

<span class="cp">#define MAX_HW_MIB_COUNTER  32</span>
<span class="cp">#define VELOCITY_MIN_MTU    (64)</span>
<span class="cp">#define VELOCITY_MAX_MTU    (9000)</span>

<span class="cm">/*</span>
<span class="cm"> *	Registers in the MAC</span>
<span class="cm"> */</span>

<span class="cp">#define MAC_REG_PAR         0x00	</span><span class="c1">// physical address</span>
<span class="cp">#define MAC_REG_RCR         0x06</span>
<span class="cp">#define MAC_REG_TCR         0x07</span>
<span class="cp">#define MAC_REG_CR0_SET     0x08</span>
<span class="cp">#define MAC_REG_CR1_SET     0x09</span>
<span class="cp">#define MAC_REG_CR2_SET     0x0A</span>
<span class="cp">#define MAC_REG_CR3_SET     0x0B</span>
<span class="cp">#define MAC_REG_CR0_CLR     0x0C</span>
<span class="cp">#define MAC_REG_CR1_CLR     0x0D</span>
<span class="cp">#define MAC_REG_CR2_CLR     0x0E</span>
<span class="cp">#define MAC_REG_CR3_CLR     0x0F</span>
<span class="cp">#define MAC_REG_MAR         0x10</span>
<span class="cp">#define MAC_REG_CAM         0x10</span>
<span class="cp">#define MAC_REG_DEC_BASE_HI 0x18</span>
<span class="cp">#define MAC_REG_DBF_BASE_HI 0x1C</span>
<span class="cp">#define MAC_REG_ISR_CTL     0x20</span>
<span class="cp">#define MAC_REG_ISR_HOTMR   0x20</span>
<span class="cp">#define MAC_REG_ISR_TSUPTHR 0x20</span>
<span class="cp">#define MAC_REG_ISR_RSUPTHR 0x20</span>
<span class="cp">#define MAC_REG_ISR_CTL1    0x21</span>
<span class="cp">#define MAC_REG_TXE_SR      0x22</span>
<span class="cp">#define MAC_REG_RXE_SR      0x23</span>
<span class="cp">#define MAC_REG_ISR         0x24</span>
<span class="cp">#define MAC_REG_ISR0        0x24</span>
<span class="cp">#define MAC_REG_ISR1        0x25</span>
<span class="cp">#define MAC_REG_ISR2        0x26</span>
<span class="cp">#define MAC_REG_ISR3        0x27</span>
<span class="cp">#define MAC_REG_IMR         0x28</span>
<span class="cp">#define MAC_REG_IMR0        0x28</span>
<span class="cp">#define MAC_REG_IMR1        0x29</span>
<span class="cp">#define MAC_REG_IMR2        0x2A</span>
<span class="cp">#define MAC_REG_IMR3        0x2B</span>
<span class="cp">#define MAC_REG_TDCSR_SET   0x30</span>
<span class="cp">#define MAC_REG_RDCSR_SET   0x32</span>
<span class="cp">#define MAC_REG_TDCSR_CLR   0x34</span>
<span class="cp">#define MAC_REG_RDCSR_CLR   0x36</span>
<span class="cp">#define MAC_REG_RDBASE_LO   0x38</span>
<span class="cp">#define MAC_REG_RDINDX      0x3C</span>
<span class="cp">#define MAC_REG_TDBASE_LO   0x40</span>
<span class="cp">#define MAC_REG_RDCSIZE     0x50</span>
<span class="cp">#define MAC_REG_TDCSIZE     0x52</span>
<span class="cp">#define MAC_REG_TDINDX      0x54</span>
<span class="cp">#define MAC_REG_TDIDX0      0x54</span>
<span class="cp">#define MAC_REG_TDIDX1      0x56</span>
<span class="cp">#define MAC_REG_TDIDX2      0x58</span>
<span class="cp">#define MAC_REG_TDIDX3      0x5A</span>
<span class="cp">#define MAC_REG_PAUSE_TIMER 0x5C</span>
<span class="cp">#define MAC_REG_RBRDU       0x5E</span>
<span class="cp">#define MAC_REG_FIFO_TEST0  0x60</span>
<span class="cp">#define MAC_REG_FIFO_TEST1  0x64</span>
<span class="cp">#define MAC_REG_CAMADDR     0x68</span>
<span class="cp">#define MAC_REG_CAMCR       0x69</span>
<span class="cp">#define MAC_REG_GFTEST      0x6A</span>
<span class="cp">#define MAC_REG_FTSTCMD     0x6B</span>
<span class="cp">#define MAC_REG_MIICFG      0x6C</span>
<span class="cp">#define MAC_REG_MIISR       0x6D</span>
<span class="cp">#define MAC_REG_PHYSR0      0x6E</span>
<span class="cp">#define MAC_REG_PHYSR1      0x6F</span>
<span class="cp">#define MAC_REG_MIICR       0x70</span>
<span class="cp">#define MAC_REG_MIIADR      0x71</span>
<span class="cp">#define MAC_REG_MIIDATA     0x72</span>
<span class="cp">#define MAC_REG_SOFT_TIMER0 0x74</span>
<span class="cp">#define MAC_REG_SOFT_TIMER1 0x76</span>
<span class="cp">#define MAC_REG_CFGA        0x78</span>
<span class="cp">#define MAC_REG_CFGB        0x79</span>
<span class="cp">#define MAC_REG_CFGC        0x7A</span>
<span class="cp">#define MAC_REG_CFGD        0x7B</span>
<span class="cp">#define MAC_REG_DCFG0       0x7C</span>
<span class="cp">#define MAC_REG_DCFG1       0x7D</span>
<span class="cp">#define MAC_REG_MCFG0       0x7E</span>
<span class="cp">#define MAC_REG_MCFG1       0x7F</span>

<span class="cp">#define MAC_REG_TBIST       0x80</span>
<span class="cp">#define MAC_REG_RBIST       0x81</span>
<span class="cp">#define MAC_REG_PMCC        0x82</span>
<span class="cp">#define MAC_REG_STICKHW     0x83</span>
<span class="cp">#define MAC_REG_MIBCR       0x84</span>
<span class="cp">#define MAC_REG_EERSV       0x85</span>
<span class="cp">#define MAC_REG_REVID       0x86</span>
<span class="cp">#define MAC_REG_MIBREAD     0x88</span>
<span class="cp">#define MAC_REG_BPMA        0x8C</span>
<span class="cp">#define MAC_REG_EEWR_DATA   0x8C</span>
<span class="cp">#define MAC_REG_BPMD_WR     0x8F</span>
<span class="cp">#define MAC_REG_BPCMD       0x90</span>
<span class="cp">#define MAC_REG_BPMD_RD     0x91</span>
<span class="cp">#define MAC_REG_EECHKSUM    0x92</span>
<span class="cp">#define MAC_REG_EECSR       0x93</span>
<span class="cp">#define MAC_REG_EERD_DATA   0x94</span>
<span class="cp">#define MAC_REG_EADDR       0x96</span>
<span class="cp">#define MAC_REG_EMBCMD      0x97</span>
<span class="cp">#define MAC_REG_JMPSR0      0x98</span>
<span class="cp">#define MAC_REG_JMPSR1      0x99</span>
<span class="cp">#define MAC_REG_JMPSR2      0x9A</span>
<span class="cp">#define MAC_REG_JMPSR3      0x9B</span>
<span class="cp">#define MAC_REG_CHIPGSR     0x9C</span>
<span class="cp">#define MAC_REG_TESTCFG     0x9D</span>
<span class="cp">#define MAC_REG_DEBUG       0x9E</span>
<span class="cp">#define MAC_REG_CHIPGCR     0x9F	</span><span class="cm">/* Chip Operation and Diagnostic Control */</span><span class="cp"></span>
<span class="cp">#define MAC_REG_WOLCR0_SET  0xA0</span>
<span class="cp">#define MAC_REG_WOLCR1_SET  0xA1</span>
<span class="cp">#define MAC_REG_PWCFG_SET   0xA2</span>
<span class="cp">#define MAC_REG_WOLCFG_SET  0xA3</span>
<span class="cp">#define MAC_REG_WOLCR0_CLR  0xA4</span>
<span class="cp">#define MAC_REG_WOLCR1_CLR  0xA5</span>
<span class="cp">#define MAC_REG_PWCFG_CLR   0xA6</span>
<span class="cp">#define MAC_REG_WOLCFG_CLR  0xA7</span>
<span class="cp">#define MAC_REG_WOLSR0_SET  0xA8</span>
<span class="cp">#define MAC_REG_WOLSR1_SET  0xA9</span>
<span class="cp">#define MAC_REG_WOLSR0_CLR  0xAC</span>
<span class="cp">#define MAC_REG_WOLSR1_CLR  0xAD</span>
<span class="cp">#define MAC_REG_PATRN_CRC0  0xB0</span>
<span class="cp">#define MAC_REG_PATRN_CRC1  0xB2</span>
<span class="cp">#define MAC_REG_PATRN_CRC2  0xB4</span>
<span class="cp">#define MAC_REG_PATRN_CRC3  0xB6</span>
<span class="cp">#define MAC_REG_PATRN_CRC4  0xB8</span>
<span class="cp">#define MAC_REG_PATRN_CRC5  0xBA</span>
<span class="cp">#define MAC_REG_PATRN_CRC6  0xBC</span>
<span class="cp">#define MAC_REG_PATRN_CRC7  0xBE</span>
<span class="cp">#define MAC_REG_BYTEMSK0_0  0xC0</span>
<span class="cp">#define MAC_REG_BYTEMSK0_1  0xC4</span>
<span class="cp">#define MAC_REG_BYTEMSK0_2  0xC8</span>
<span class="cp">#define MAC_REG_BYTEMSK0_3  0xCC</span>
<span class="cp">#define MAC_REG_BYTEMSK1_0  0xD0</span>
<span class="cp">#define MAC_REG_BYTEMSK1_1  0xD4</span>
<span class="cp">#define MAC_REG_BYTEMSK1_2  0xD8</span>
<span class="cp">#define MAC_REG_BYTEMSK1_3  0xDC</span>
<span class="cp">#define MAC_REG_BYTEMSK2_0  0xE0</span>
<span class="cp">#define MAC_REG_BYTEMSK2_1  0xE4</span>
<span class="cp">#define MAC_REG_BYTEMSK2_2  0xE8</span>
<span class="cp">#define MAC_REG_BYTEMSK2_3  0xEC</span>
<span class="cp">#define MAC_REG_BYTEMSK3_0  0xF0</span>
<span class="cp">#define MAC_REG_BYTEMSK3_1  0xF4</span>
<span class="cp">#define MAC_REG_BYTEMSK3_2  0xF8</span>
<span class="cp">#define MAC_REG_BYTEMSK3_3  0xFC</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the RCR register</span>
<span class="cm"> */</span>

<span class="cp">#define RCR_AS              0x80</span>
<span class="cp">#define RCR_AP              0x40</span>
<span class="cp">#define RCR_AL              0x20</span>
<span class="cp">#define RCR_PROM            0x10</span>
<span class="cp">#define RCR_AB              0x08</span>
<span class="cp">#define RCR_AM              0x04</span>
<span class="cp">#define RCR_AR              0x02</span>
<span class="cp">#define RCR_SEP             0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the TCR register</span>
<span class="cm"> */</span>

<span class="cp">#define TCR_TB2BDIS         0x80</span>
<span class="cp">#define TCR_COLTMC1         0x08</span>
<span class="cp">#define TCR_COLTMC0         0x04</span>
<span class="cp">#define TCR_LB1             0x02	</span><span class="cm">/* loopback[1] */</span><span class="cp"></span>
<span class="cp">#define TCR_LB0             0x01	</span><span class="cm">/* loopback[0] */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CR0 register</span>
<span class="cm"> */</span>

<span class="cp">#define CR0_TXON            0x00000008UL</span>
<span class="cp">#define CR0_RXON            0x00000004UL</span>
<span class="cp">#define CR0_STOP            0x00000002UL	</span><span class="cm">/* stop MAC, default = 1 */</span><span class="cp"></span>
<span class="cp">#define CR0_STRT            0x00000001UL	</span><span class="cm">/* start MAC */</span><span class="cp"></span>
<span class="cp">#define CR0_SFRST           0x00008000UL	</span><span class="cm">/* software reset */</span><span class="cp"></span>
<span class="cp">#define CR0_TM1EN           0x00004000UL</span>
<span class="cp">#define CR0_TM0EN           0x00002000UL</span>
<span class="cp">#define CR0_DPOLL           0x00000800UL	</span><span class="cm">/* disable rx/tx auto polling */</span><span class="cp"></span>
<span class="cp">#define CR0_DISAU           0x00000100UL</span>
<span class="cp">#define CR0_XONEN           0x00800000UL</span>
<span class="cp">#define CR0_FDXTFCEN        0x00400000UL	</span><span class="cm">/* full-duplex TX flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR0_FDXRFCEN        0x00200000UL	</span><span class="cm">/* full-duplex RX flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR0_HDXFCEN         0x00100000UL	</span><span class="cm">/* half-duplex flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR0_XHITH1          0x00080000UL	</span><span class="cm">/* TX XON high threshold 1 */</span><span class="cp"></span>
<span class="cp">#define CR0_XHITH0          0x00040000UL	</span><span class="cm">/* TX XON high threshold 0 */</span><span class="cp"></span>
<span class="cp">#define CR0_XLTH1           0x00020000UL	</span><span class="cm">/* TX pause frame low threshold 1 */</span><span class="cp"></span>
<span class="cp">#define CR0_XLTH0           0x00010000UL	</span><span class="cm">/* TX pause frame low threshold 0 */</span><span class="cp"></span>
<span class="cp">#define CR0_GSPRST          0x80000000UL</span>
<span class="cp">#define CR0_FORSRST         0x40000000UL</span>
<span class="cp">#define CR0_FPHYRST         0x20000000UL</span>
<span class="cp">#define CR0_DIAG            0x10000000UL</span>
<span class="cp">#define CR0_INTPCTL         0x04000000UL</span>
<span class="cp">#define CR0_GINTMSK1        0x02000000UL</span>
<span class="cp">#define CR0_GINTMSK0        0x01000000UL</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CR1 register</span>
<span class="cm"> */</span>

<span class="cp">#define CR1_SFRST           0x80	</span><span class="cm">/* software reset */</span><span class="cp"></span>
<span class="cp">#define CR1_TM1EN           0x40</span>
<span class="cp">#define CR1_TM0EN           0x20</span>
<span class="cp">#define CR1_DPOLL           0x08	</span><span class="cm">/* disable rx/tx auto polling */</span><span class="cp"></span>
<span class="cp">#define CR1_DISAU           0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CR2 register</span>
<span class="cm"> */</span>

<span class="cp">#define CR2_XONEN           0x80</span>
<span class="cp">#define CR2_FDXTFCEN        0x40	</span><span class="cm">/* full-duplex TX flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR2_FDXRFCEN        0x20	</span><span class="cm">/* full-duplex RX flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR2_HDXFCEN         0x10	</span><span class="cm">/* half-duplex flow control enable */</span><span class="cp"></span>
<span class="cp">#define CR2_XHITH1          0x08	</span><span class="cm">/* TX XON high threshold 1 */</span><span class="cp"></span>
<span class="cp">#define CR2_XHITH0          0x04	</span><span class="cm">/* TX XON high threshold 0 */</span><span class="cp"></span>
<span class="cp">#define CR2_XLTH1           0x02	</span><span class="cm">/* TX pause frame low threshold 1 */</span><span class="cp"></span>
<span class="cp">#define CR2_XLTH0           0x01	</span><span class="cm">/* TX pause frame low threshold 0 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CR3 register</span>
<span class="cm"> */</span>

<span class="cp">#define CR3_GSPRST          0x80</span>
<span class="cp">#define CR3_FORSRST         0x40</span>
<span class="cp">#define CR3_FPHYRST         0x20</span>
<span class="cp">#define CR3_DIAG            0x10</span>
<span class="cp">#define CR3_INTPCTL         0x04</span>
<span class="cp">#define CR3_GINTMSK1        0x02</span>
<span class="cp">#define CR3_GINTMSK0        0x01</span>

<span class="cp">#define ISRCTL_UDPINT       0x8000</span>
<span class="cp">#define ISRCTL_TSUPDIS      0x4000</span>
<span class="cp">#define ISRCTL_RSUPDIS      0x2000</span>
<span class="cp">#define ISRCTL_PMSK1        0x1000</span>
<span class="cp">#define ISRCTL_PMSK0        0x0800</span>
<span class="cp">#define ISRCTL_INTPD        0x0400</span>
<span class="cp">#define ISRCTL_HCRLD        0x0200</span>
<span class="cp">#define ISRCTL_SCRLD        0x0100</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the ISR_CTL1 register</span>
<span class="cm"> */</span>

<span class="cp">#define ISRCTL1_UDPINT      0x80</span>
<span class="cp">#define ISRCTL1_TSUPDIS     0x40</span>
<span class="cp">#define ISRCTL1_RSUPDIS     0x20</span>
<span class="cp">#define ISRCTL1_PMSK1       0x10</span>
<span class="cp">#define ISRCTL1_PMSK0       0x08</span>
<span class="cp">#define ISRCTL1_INTPD       0x04</span>
<span class="cp">#define ISRCTL1_HCRLD       0x02</span>
<span class="cp">#define ISRCTL1_SCRLD       0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the TXE_SR register</span>
<span class="cm"> */</span>

<span class="cp">#define TXESR_TFDBS         0x08</span>
<span class="cp">#define TXESR_TDWBS         0x04</span>
<span class="cp">#define TXESR_TDRBS         0x02</span>
<span class="cp">#define TXESR_TDSTR         0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the RXE_SR register</span>
<span class="cm"> */</span>

<span class="cp">#define RXESR_RFDBS         0x08</span>
<span class="cp">#define RXESR_RDWBS         0x04</span>
<span class="cp">#define RXESR_RDRBS         0x02</span>
<span class="cp">#define RXESR_RDSTR         0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the ISR register</span>
<span class="cm"> */</span>

<span class="cp">#define ISR_ISR3            0x80000000UL</span>
<span class="cp">#define ISR_ISR2            0x40000000UL</span>
<span class="cp">#define ISR_ISR1            0x20000000UL</span>
<span class="cp">#define ISR_ISR0            0x10000000UL</span>
<span class="cp">#define ISR_TXSTLI          0x02000000UL</span>
<span class="cp">#define ISR_RXSTLI          0x01000000UL</span>
<span class="cp">#define ISR_HFLD            0x00800000UL</span>
<span class="cp">#define ISR_UDPI            0x00400000UL</span>
<span class="cp">#define ISR_MIBFI           0x00200000UL</span>
<span class="cp">#define ISR_SHDNI           0x00100000UL</span>
<span class="cp">#define ISR_PHYI            0x00080000UL</span>
<span class="cp">#define ISR_PWEI            0x00040000UL</span>
<span class="cp">#define ISR_TMR1I           0x00020000UL</span>
<span class="cp">#define ISR_TMR0I           0x00010000UL</span>
<span class="cp">#define ISR_SRCI            0x00008000UL</span>
<span class="cp">#define ISR_LSTPEI          0x00004000UL</span>
<span class="cp">#define ISR_LSTEI           0x00002000UL</span>
<span class="cp">#define ISR_OVFI            0x00001000UL</span>
<span class="cp">#define ISR_FLONI           0x00000800UL</span>
<span class="cp">#define ISR_RACEI           0x00000400UL</span>
<span class="cp">#define ISR_TXWB1I          0x00000200UL</span>
<span class="cp">#define ISR_TXWB0I          0x00000100UL</span>
<span class="cp">#define ISR_PTX3I           0x00000080UL</span>
<span class="cp">#define ISR_PTX2I           0x00000040UL</span>
<span class="cp">#define ISR_PTX1I           0x00000020UL</span>
<span class="cp">#define ISR_PTX0I           0x00000010UL</span>
<span class="cp">#define ISR_PTXI            0x00000008UL</span>
<span class="cp">#define ISR_PRXI            0x00000004UL</span>
<span class="cp">#define ISR_PPTXI           0x00000002UL</span>
<span class="cp">#define ISR_PPRXI           0x00000001UL</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the IMR register</span>
<span class="cm"> */</span>

<span class="cp">#define IMR_TXSTLM          0x02000000UL</span>
<span class="cp">#define IMR_UDPIM           0x00400000UL</span>
<span class="cp">#define IMR_MIBFIM          0x00200000UL</span>
<span class="cp">#define IMR_SHDNIM          0x00100000UL</span>
<span class="cp">#define IMR_PHYIM           0x00080000UL</span>
<span class="cp">#define IMR_PWEIM           0x00040000UL</span>
<span class="cp">#define IMR_TMR1IM          0x00020000UL</span>
<span class="cp">#define IMR_TMR0IM          0x00010000UL</span>

<span class="cp">#define IMR_SRCIM           0x00008000UL</span>
<span class="cp">#define IMR_LSTPEIM         0x00004000UL</span>
<span class="cp">#define IMR_LSTEIM          0x00002000UL</span>
<span class="cp">#define IMR_OVFIM           0x00001000UL</span>
<span class="cp">#define IMR_FLONIM          0x00000800UL</span>
<span class="cp">#define IMR_RACEIM          0x00000400UL</span>
<span class="cp">#define IMR_TXWB1IM         0x00000200UL</span>
<span class="cp">#define IMR_TXWB0IM         0x00000100UL</span>

<span class="cp">#define IMR_PTX3IM          0x00000080UL</span>
<span class="cp">#define IMR_PTX2IM          0x00000040UL</span>
<span class="cp">#define IMR_PTX1IM          0x00000020UL</span>
<span class="cp">#define IMR_PTX0IM          0x00000010UL</span>
<span class="cp">#define IMR_PTXIM           0x00000008UL</span>
<span class="cp">#define IMR_PRXIM           0x00000004UL</span>
<span class="cp">#define IMR_PPTXIM          0x00000002UL</span>
<span class="cp">#define IMR_PPRXIM          0x00000001UL</span>

<span class="cm">/* 0x0013FB0FUL  =  initial value of IMR */</span>

<span class="cp">#define INT_MASK_DEF        (IMR_PPTXIM|IMR_PPRXIM|IMR_PTXIM|IMR_PRXIM|\</span>
<span class="cp">                            IMR_PWEIM|IMR_TXWB0IM|IMR_TXWB1IM|IMR_FLONIM|\</span>
<span class="cp">                            IMR_OVFIM|IMR_LSTEIM|IMR_LSTPEIM|IMR_SRCIM|IMR_MIBFIM|\</span>
<span class="cp">                            IMR_SHDNIM|IMR_TMR1IM|IMR_TMR0IM|IMR_TXSTLM)</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the TDCSR0/1, RDCSR0 register</span>
<span class="cm"> */</span>

<span class="cp">#define TRDCSR_DEAD         0x0008</span>
<span class="cp">#define TRDCSR_WAK          0x0004</span>
<span class="cp">#define TRDCSR_ACT          0x0002</span>
<span class="cp">#define TRDCSR_RUN	    0x0001</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CAMADDR register</span>
<span class="cm"> */</span>

<span class="cp">#define CAMADDR_CAMEN       0x80</span>
<span class="cp">#define CAMADDR_VCAMSL      0x40</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CAMCR register</span>
<span class="cm"> */</span>

<span class="cp">#define CAMCR_PS1           0x80</span>
<span class="cp">#define CAMCR_PS0           0x40</span>
<span class="cp">#define CAMCR_AITRPKT       0x20</span>
<span class="cp">#define CAMCR_AITR16        0x10</span>
<span class="cp">#define CAMCR_CAMRD         0x08</span>
<span class="cp">#define CAMCR_CAMWR         0x04</span>
<span class="cp">#define CAMCR_PS_CAM_MASK   0x40</span>
<span class="cp">#define CAMCR_PS_CAM_DATA   0x80</span>
<span class="cp">#define CAMCR_PS_MAR        0x00</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MIICFG register</span>
<span class="cm"> */</span>

<span class="cp">#define MIICFG_MPO1         0x80</span>
<span class="cp">#define MIICFG_MPO0         0x40</span>
<span class="cp">#define MIICFG_MFDC         0x20</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MIISR register</span>
<span class="cm"> */</span>

<span class="cp">#define MIISR_MIDLE         0x80</span>

<span class="cm">/*</span>
<span class="cm"> *	 Bits in the PHYSR0 register</span>
<span class="cm"> */</span>

<span class="cp">#define PHYSR0_PHYRST       0x80</span>
<span class="cp">#define PHYSR0_LINKGD       0x40</span>
<span class="cp">#define PHYSR0_FDPX         0x10</span>
<span class="cp">#define PHYSR0_SPDG         0x08</span>
<span class="cp">#define PHYSR0_SPD10        0x04</span>
<span class="cp">#define PHYSR0_RXFLC        0x02</span>
<span class="cp">#define PHYSR0_TXFLC        0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the PHYSR1 register</span>
<span class="cm"> */</span>

<span class="cp">#define PHYSR1_PHYTBI       0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MIICR register</span>
<span class="cm"> */</span>

<span class="cp">#define MIICR_MAUTO         0x80</span>
<span class="cp">#define MIICR_RCMD          0x40</span>
<span class="cp">#define MIICR_WCMD          0x20</span>
<span class="cp">#define MIICR_MDPM          0x10</span>
<span class="cp">#define MIICR_MOUT          0x08</span>
<span class="cp">#define MIICR_MDO           0x04</span>
<span class="cp">#define MIICR_MDI           0x02</span>
<span class="cp">#define MIICR_MDC           0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MIIADR register</span>
<span class="cm"> */</span>

<span class="cp">#define MIIADR_SWMPL        0x80</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CFGA register</span>
<span class="cm"> */</span>

<span class="cp">#define CFGA_PMHCTG         0x08</span>
<span class="cp">#define CFGA_GPIO1PD        0x04</span>
<span class="cp">#define CFGA_ABSHDN         0x02</span>
<span class="cp">#define CFGA_PACPI          0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CFGB register</span>
<span class="cm"> */</span>

<span class="cp">#define CFGB_GTCKOPT        0x80</span>
<span class="cp">#define CFGB_MIIOPT         0x40</span>
<span class="cp">#define CFGB_CRSEOPT        0x20</span>
<span class="cp">#define CFGB_OFSET          0x10</span>
<span class="cp">#define CFGB_CRANDOM        0x08</span>
<span class="cp">#define CFGB_CAP            0x04</span>
<span class="cp">#define CFGB_MBA            0x02</span>
<span class="cp">#define CFGB_BAKOPT         0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the CFGC register</span>
<span class="cm"> */</span>

<span class="cp">#define CFGC_EELOAD         0x80</span>
<span class="cp">#define CFGC_BROPT          0x40</span>
<span class="cp">#define CFGC_DLYEN          0x20</span>
<span class="cp">#define CFGC_DTSEL          0x10</span>
<span class="cp">#define CFGC_BTSEL          0x08</span>
<span class="cp">#define CFGC_BPS2           0x04	</span><span class="cm">/* bootrom select[2] */</span><span class="cp"></span>
<span class="cp">#define CFGC_BPS1           0x02	</span><span class="cm">/* bootrom select[1] */</span><span class="cp"></span>
<span class="cp">#define CFGC_BPS0           0x01	</span><span class="cm">/* bootrom select[0] */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Bits in the CFGD register</span>
<span class="cm"> */</span>

<span class="cp">#define CFGD_IODIS          0x80</span>
<span class="cp">#define CFGD_MSLVDACEN      0x40</span>
<span class="cp">#define CFGD_CFGDACEN       0x20</span>
<span class="cp">#define CFGD_PCI64EN        0x10</span>
<span class="cp">#define CFGD_HTMRL4         0x08</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the DCFG1 register</span>
<span class="cm"> */</span>

<span class="cp">#define DCFG_XMWI           0x8000</span>
<span class="cp">#define DCFG_XMRM           0x4000</span>
<span class="cp">#define DCFG_XMRL           0x2000</span>
<span class="cp">#define DCFG_PERDIS         0x1000</span>
<span class="cp">#define DCFG_MRWAIT         0x0400</span>
<span class="cp">#define DCFG_MWWAIT         0x0200</span>
<span class="cp">#define DCFG_LATMEN         0x0100</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MCFG0 register</span>
<span class="cm"> */</span>

<span class="cp">#define MCFG_RXARB          0x0080</span>
<span class="cp">#define MCFG_RFT1           0x0020</span>
<span class="cp">#define MCFG_RFT0           0x0010</span>
<span class="cp">#define MCFG_LOWTHOPT       0x0008</span>
<span class="cp">#define MCFG_PQEN           0x0004</span>
<span class="cp">#define MCFG_RTGOPT         0x0002</span>
<span class="cp">#define MCFG_VIDFR          0x0001</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MCFG1 register</span>
<span class="cm"> */</span>

<span class="cp">#define MCFG_TXARB          0x8000</span>
<span class="cp">#define MCFG_TXQBK1         0x0800</span>
<span class="cp">#define MCFG_TXQBK0         0x0400</span>
<span class="cp">#define MCFG_TXQNOBK        0x0200</span>
<span class="cp">#define MCFG_SNAPOPT        0x0100</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the PMCC  register</span>
<span class="cm"> */</span>

<span class="cp">#define PMCC_DSI            0x80</span>
<span class="cp">#define PMCC_D2_DIS         0x40</span>
<span class="cp">#define PMCC_D1_DIS         0x20</span>
<span class="cp">#define PMCC_D3C_EN         0x10</span>
<span class="cp">#define PMCC_D3H_EN         0x08</span>
<span class="cp">#define PMCC_D2_EN          0x04</span>
<span class="cp">#define PMCC_D1_EN          0x02</span>
<span class="cp">#define PMCC_D0_EN          0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in STICKHW</span>
<span class="cm"> */</span>

<span class="cp">#define STICKHW_SWPTAG      0x10</span>
<span class="cp">#define STICKHW_WOLSR       0x08</span>
<span class="cp">#define STICKHW_WOLEN       0x04</span>
<span class="cp">#define STICKHW_DS1         0x02	</span><span class="cm">/* R/W by software/cfg cycle */</span><span class="cp"></span>
<span class="cp">#define STICKHW_DS0         0x01	</span><span class="cm">/* suspend well DS write port */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the MIBCR register</span>
<span class="cm"> */</span>

<span class="cp">#define MIBCR_MIBISTOK      0x80</span>
<span class="cp">#define MIBCR_MIBISTGO      0x40</span>
<span class="cp">#define MIBCR_MIBINC        0x20</span>
<span class="cp">#define MIBCR_MIBHI         0x10</span>
<span class="cp">#define MIBCR_MIBFRZ        0x08</span>
<span class="cp">#define MIBCR_MIBFLSH       0x04</span>
<span class="cp">#define MIBCR_MPTRINI       0x02</span>
<span class="cp">#define MIBCR_MIBCLR        0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the EERSV register</span>
<span class="cm"> */</span>

<span class="cp">#define EERSV_BOOT_RPL      ((u8) 0x01)	 </span><span class="cm">/* Boot method selection for VT6110 */</span><span class="cp"></span>

<span class="cp">#define EERSV_BOOT_MASK     ((u8) 0x06)</span>
<span class="cp">#define EERSV_BOOT_INT19    ((u8) 0x00)</span>
<span class="cp">#define EERSV_BOOT_INT18    ((u8) 0x02)</span>
<span class="cp">#define EERSV_BOOT_LOCAL    ((u8) 0x04)</span>
<span class="cp">#define EERSV_BOOT_BEV      ((u8) 0x06)</span>


<span class="cm">/*</span>
<span class="cm"> *	Bits in BPCMD</span>
<span class="cm"> */</span>

<span class="cp">#define BPCMD_BPDNE         0x80</span>
<span class="cp">#define BPCMD_EBPWR         0x02</span>
<span class="cp">#define BPCMD_EBPRD         0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the EECSR register</span>
<span class="cm"> */</span>

<span class="cp">#define EECSR_EMBP          0x40	</span><span class="cm">/* eeprom embedded programming */</span><span class="cp"></span>
<span class="cp">#define EECSR_RELOAD        0x20	</span><span class="cm">/* eeprom content reload */</span><span class="cp"></span>
<span class="cp">#define EECSR_DPM           0x10	</span><span class="cm">/* eeprom direct programming */</span><span class="cp"></span>
<span class="cp">#define EECSR_ECS           0x08	</span><span class="cm">/* eeprom CS pin */</span><span class="cp"></span>
<span class="cp">#define EECSR_ECK           0x04	</span><span class="cm">/* eeprom CK pin */</span><span class="cp"></span>
<span class="cp">#define EECSR_EDI           0x02	</span><span class="cm">/* eeprom DI pin */</span><span class="cp"></span>
<span class="cp">#define EECSR_EDO           0x01	</span><span class="cm">/* eeprom DO pin */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in the EMBCMD register</span>
<span class="cm"> */</span>

<span class="cp">#define EMBCMD_EDONE        0x80</span>
<span class="cp">#define EMBCMD_EWDIS        0x08</span>
<span class="cp">#define EMBCMD_EWEN         0x04</span>
<span class="cp">#define EMBCMD_EWR          0x02</span>
<span class="cp">#define EMBCMD_ERD          0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in TESTCFG register</span>
<span class="cm"> */</span>

<span class="cp">#define TESTCFG_HBDIS       0x80</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in CHIPGCR register</span>
<span class="cm"> */</span>

<span class="cp">#define CHIPGCR_FCGMII      0x80	</span><span class="cm">/* force GMII (else MII only) */</span><span class="cp"></span>
<span class="cp">#define CHIPGCR_FCFDX       0x40	</span><span class="cm">/* force full duplex */</span><span class="cp"></span>
<span class="cp">#define CHIPGCR_FCRESV      0x20</span>
<span class="cp">#define CHIPGCR_FCMODE      0x10	</span><span class="cm">/* enable MAC forced mode */</span><span class="cp"></span>
<span class="cp">#define CHIPGCR_LPSOPT      0x08</span>
<span class="cp">#define CHIPGCR_TM1US       0x04</span>
<span class="cp">#define CHIPGCR_TM0US       0x02</span>
<span class="cp">#define CHIPGCR_PHYINTEN    0x01</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in WOLCR0</span>
<span class="cm"> */</span>

<span class="cp">#define WOLCR_MSWOLEN7      0x0080	</span><span class="cm">/* enable pattern match filtering */</span><span class="cp"></span>
<span class="cp">#define WOLCR_MSWOLEN6      0x0040</span>
<span class="cp">#define WOLCR_MSWOLEN5      0x0020</span>
<span class="cp">#define WOLCR_MSWOLEN4      0x0010</span>
<span class="cp">#define WOLCR_MSWOLEN3      0x0008</span>
<span class="cp">#define WOLCR_MSWOLEN2      0x0004</span>
<span class="cp">#define WOLCR_MSWOLEN1      0x0002</span>
<span class="cp">#define WOLCR_MSWOLEN0      0x0001</span>
<span class="cp">#define WOLCR_ARP_EN        0x0001</span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in WOLCR1</span>
<span class="cm"> */</span>

<span class="cp">#define WOLCR_LINKOFF_EN      0x0800	</span><span class="cm">/* link off detected enable */</span><span class="cp"></span>
<span class="cp">#define WOLCR_LINKON_EN       0x0400	</span><span class="cm">/* link on detected enable */</span><span class="cp"></span>
<span class="cp">#define WOLCR_MAGIC_EN        0x0200	</span><span class="cm">/* magic packet filter enable */</span><span class="cp"></span>
<span class="cp">#define WOLCR_UNICAST_EN      0x0100	</span><span class="cm">/* unicast filter enable */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> *	Bits in PWCFG</span>
<span class="cm"> */</span>

<span class="cp">#define PWCFG_PHYPWOPT          0x80	</span><span class="cm">/* internal MII I/F timing */</span><span class="cp"></span>
<span class="cp">#define PWCFG_PCISTICK          0x40	</span><span class="cm">/* PCI sticky R/W enable */</span><span class="cp"></span>
<span class="cp">#define PWCFG_WOLTYPE           0x20	</span><span class="cm">/* pulse(1) or button (0) */</span><span class="cp"></span>
<span class="cp">#define PWCFG_LEGCY_WOL         0x10</span>
<span class="cp">#define PWCFG_PMCSR_PME_SR      0x08</span>
<span class="cp">#define PWCFG_PMCSR_PME_EN      0x04	</span><span class="cm">/* control by PCISTICK */</span><span class="cp"></span>
<span class="cp">#define PWCFG_LEGACY_WOLSR      0x02	</span><span class="cm">/* Legacy WOL_SR shadow */</span><span class="cp"></span>
<span class="cp">#define PWCFG_LEGACY_WOLEN      0x01	</span><span class="cm">/* Legacy WOL_EN shadow */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Bits in WOLCFG</span>
<span class="cm"> */</span>

<span class="cp">#define WOLCFG_PMEOVR           0x80	</span><span class="cm">/* for legacy use, force PMEEN always */</span><span class="cp"></span>
<span class="cp">#define WOLCFG_SAM              0x20	</span><span class="cm">/* accept multicast case reset, default=0 */</span><span class="cp"></span>
<span class="cp">#define WOLCFG_SAB              0x10	</span><span class="cm">/* accept broadcast case reset, default=0 */</span><span class="cp"></span>
<span class="cp">#define WOLCFG_SMIIACC          0x08	</span><span class="cm">/* ?? */</span><span class="cp"></span>
<span class="cp">#define WOLCFG_SGENWH           0x02</span>
<span class="cp">#define WOLCFG_PHYINTEN         0x01	</span><span class="cm">/* 0:PHYINT trigger enable, 1:use internal MII</span>
<span class="cm">					  to report status change */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> *	Bits in WOLSR1</span>
<span class="cm"> */</span>

<span class="cp">#define WOLSR_LINKOFF_INT      0x0800</span>
<span class="cp">#define WOLSR_LINKON_INT       0x0400</span>
<span class="cp">#define WOLSR_MAGIC_INT        0x0200</span>
<span class="cp">#define WOLSR_UNICAST_INT      0x0100</span>

<span class="cm">/*</span>
<span class="cm"> *	Ethernet address filter type</span>
<span class="cm"> */</span>

<span class="cp">#define PKT_TYPE_NONE               0x0000	</span><span class="cm">/* Turn off receiver */</span><span class="cp"></span>
<span class="cp">#define PKT_TYPE_DIRECTED           0x0001	</span><span class="cm">/* obselete, directed address is always accepted */</span><span class="cp"></span>
<span class="cp">#define PKT_TYPE_MULTICAST          0x0002</span>
<span class="cp">#define PKT_TYPE_ALL_MULTICAST      0x0004</span>
<span class="cp">#define PKT_TYPE_BROADCAST          0x0008</span>
<span class="cp">#define PKT_TYPE_PROMISCUOUS        0x0020</span>
<span class="cp">#define PKT_TYPE_LONG               0x2000	</span><span class="cm">/* NOTE.... the definition of LONG is &gt;2048 bytes in our chip */</span><span class="cp"></span>
<span class="cp">#define PKT_TYPE_RUNT               0x4000</span>
<span class="cp">#define PKT_TYPE_ERROR              0x8000	</span><span class="cm">/* Accept error packets, e.g. CRC error */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	Loopback mode</span>
<span class="cm"> */</span>

<span class="cp">#define MAC_LB_NONE         0x00</span>
<span class="cp">#define MAC_LB_INTERNAL     0x01</span>
<span class="cp">#define MAC_LB_EXTERNAL     0x02</span>

<span class="cm">/*</span>
<span class="cm"> *	Enabled mask value of irq</span>
<span class="cm"> */</span>

<span class="cp">#if defined(_SIM)</span>
<span class="cp">#define IMR_MASK_VALUE      0x0033FF0FUL	</span><span class="cm">/* initial value of IMR</span>
<span class="cm">						   set IMR0 to 0x0F according to spec */</span><span class="cp"></span>

<span class="cp">#else</span>
<span class="cp">#define IMR_MASK_VALUE      0x0013FB0FUL	</span><span class="cm">/* initial value of IMR</span>
<span class="cm">						   ignore MIBFI,RACEI to</span>
<span class="cm">						   reduce intr. frequency</span>
<span class="cm">						   NOTE.... do not enable NoBuf int mask at driver driver</span>
<span class="cm">						      when (1) NoBuf -&gt; RxThreshold = SF</span>
<span class="cm">							   (2) OK    -&gt; RxThreshold = original value</span>
<span class="cm">						 */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> *	Revision id</span>
<span class="cm"> */</span>

<span class="cp">#define REV_ID_VT3119_A0	0x00</span>
<span class="cp">#define REV_ID_VT3119_A1	0x01</span>
<span class="cp">#define REV_ID_VT3216_A0	0x10</span>

<span class="cm">/*</span>
<span class="cm"> *	Max time out delay time</span>
<span class="cm"> */</span>

<span class="cp">#define W_MAX_TIMEOUT       0x0FFFU</span>


<span class="cm">/*</span>
<span class="cm"> *	MAC registers as a structure. Cannot be directly accessed this</span>
<span class="cm"> *	way but generates offsets for readl/writel() calls</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">mac_regs</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PAR</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>		<span class="cm">/* 0x00 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RCR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">TCR</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">CR0Set</span><span class="p">;</span>		<span class="cm">/* 0x08 */</span>
	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">CR0Clr</span><span class="p">;</span>		<span class="cm">/* 0x0C */</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MARCAM</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>		<span class="cm">/* 0x10 */</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">DecBaseHi</span><span class="p">;</span>	<span class="cm">/* 0x18 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">DbfBaseHi</span><span class="p">;</span>	<span class="cm">/* 0x1C */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">reserved_1E</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">ISRCTL</span><span class="p">;</span>		<span class="cm">/* 0x20 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">TXESR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RXESR</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">ISR</span><span class="p">;</span>		<span class="cm">/* 0x24 */</span>
	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">IMR</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">TDStatusPort</span><span class="p">;</span>	<span class="cm">/* 0x2C */</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">TDCSRSet</span><span class="p">;</span>	<span class="cm">/* 0x30 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RDCSRSet</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">reserved_33</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">TDCSRClr</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RDCSRClr</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">reserved_37</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">RDBaseLo</span><span class="p">;</span>	<span class="cm">/* 0x38 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">RDIdx</span><span class="p">;</span>		<span class="cm">/* 0x3C */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">TQETMR</span><span class="p">;</span>		<span class="cm">/* 0x3E, VT3216 and above only */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RQETMR</span><span class="p">;</span>		<span class="cm">/* 0x3F, VT3216 and above only */</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">TDBaseLo</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 0x40 */</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">RDCSize</span><span class="p">;</span>	<span class="cm">/* 0x50 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">TDCSize</span><span class="p">;</span>	<span class="cm">/* 0x52 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">TDIdx</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 0x54 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">tx_pause_timer</span><span class="p">;</span>	<span class="cm">/* 0x5C */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">RBRDU</span><span class="p">;</span>		<span class="cm">/* 0x5E */</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">FIFOTest0</span><span class="p">;</span>	<span class="cm">/* 0x60 */</span>
	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">FIFOTest1</span><span class="p">;</span>	<span class="cm">/* 0x64 */</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CAMADDR</span><span class="p">;</span>		<span class="cm">/* 0x68 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CAMCR</span><span class="p">;</span>		<span class="cm">/* 0x69 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">GFTEST</span><span class="p">;</span>		<span class="cm">/* 0x6A */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">FTSTCMD</span><span class="p">;</span>		<span class="cm">/* 0x6B */</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MIICFG</span><span class="p">;</span>		<span class="cm">/* 0x6C */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MIISR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PHYSR0</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PHYSR1</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MIICR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MIIADR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">MIIDATA</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">SoftTimer0</span><span class="p">;</span>	<span class="cm">/* 0x74 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">SoftTimer1</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CFGA</span><span class="p">;</span>		<span class="cm">/* 0x78 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CFGB</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CFGC</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CFGD</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">DCFG</span><span class="p">;</span>		<span class="cm">/* 0x7C */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">MCFG</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">TBIST</span><span class="p">;</span>		<span class="cm">/* 0x80 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">RBIST</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PMCPORT</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">STICKHW</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">MIBCR</span><span class="p">;</span>		<span class="cm">/* 0x84 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">reserved_85</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">rev_id</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PORSTS</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">MIBData</span><span class="p">;</span>	<span class="cm">/* 0x88 */</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">EEWrData</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">reserved_8E</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">BPMDWr</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">BPCMD</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">BPMDRd</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">EECHKSUM</span><span class="p">;</span>		<span class="cm">/* 0x92 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">EECSR</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">EERdData</span><span class="p">;</span>	<span class="cm">/* 0x94 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">EADDR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">EMBCMD</span><span class="p">;</span>


	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">JMPSR0</span><span class="p">;</span>		<span class="cm">/* 0x98 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">JMPSR1</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">JMPSR2</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">JMPSR3</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CHIPGSR</span><span class="p">;</span>		<span class="cm">/* 0x9C */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">TESTCFG</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">DEBUG</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">CHIPGCR</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">WOLCRSet</span><span class="p">;</span>	<span class="cm">/* 0xA0 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PWCFGSet</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">WOLCFGSet</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">WOLCRClr</span><span class="p">;</span>	<span class="cm">/* 0xA4 */</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">PWCFGCLR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u8</span> <span class="n">WOLCFGClr</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">WOLSRSet</span><span class="p">;</span>	<span class="cm">/* 0xA8 */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">reserved_AA</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">WOLSRClr</span><span class="p">;</span>	<span class="cm">/* 0xAC */</span>
	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">reserved_AE</span><span class="p">;</span>

	<span class="k">volatile</span> <span class="n">__le16</span> <span class="n">PatternCRC</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* 0xB0 */</span>
	<span class="k">volatile</span> <span class="n">__le32</span> <span class="n">ByteMask</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 0xC0 */</span>
<span class="p">};</span>


<span class="k">enum</span> <span class="n">hw_mib</span> <span class="p">{</span>
	<span class="n">HW_MIB_ifRxAllPkts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxOkPkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTxOkPkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxErrorPkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxRuntOkPkt</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxRuntErrPkt</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx64Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx64Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx65To127Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx65To127Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx128To255Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx128To255Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx256To511Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx256To511Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx512To1023Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx512To1023Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRx1024To1518Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTx1024To1518Pkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTxEtherCollisions</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxPktCRCE</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxJumboPkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTxJumboPkts</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxMacControlFrames</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTxMacControlFrames</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxPktFAE</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxLongOkPkt</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxLongPktErrPkt</span><span class="p">,</span>
	<span class="n">HW_MIB_ifTXSQEErrors</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxNobuf</span><span class="p">,</span>
	<span class="n">HW_MIB_ifRxSymbolErrors</span><span class="p">,</span>
	<span class="n">HW_MIB_ifInRangeLengthErrors</span><span class="p">,</span>
	<span class="n">HW_MIB_ifLateCollisions</span><span class="p">,</span>
	<span class="n">HW_MIB_SIZE</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">chip_type</span> <span class="p">{</span>
	<span class="n">CHIP_TYPE_VT6110</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">velocity_info_tbl</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">chip_type</span> <span class="n">chip_id</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">txqueue</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define mac_hw_mibs_init(regs) {\</span>
<span class="cp">	BYTE_REG_BITS_ON(MIBCR_MIBFRZ,&amp;((regs)-&gt;MIBCR));\</span>
<span class="cp">	BYTE_REG_BITS_ON(MIBCR_MIBCLR,&amp;((regs)-&gt;MIBCR));\</span>
<span class="cp">	do {}\</span>
<span class="cp">		while (BYTE_REG_BITS_IS_ON(MIBCR_MIBCLR,&amp;((regs)-&gt;MIBCR)));\</span>
<span class="cp">	BYTE_REG_BITS_OFF(MIBCR_MIBFRZ,&amp;((regs)-&gt;MIBCR));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_read_isr(regs)  		readl(&amp;((regs)-&gt;ISR))</span>
<span class="cp">#define mac_write_isr(regs, x)  	writel((x),&amp;((regs)-&gt;ISR))</span>
<span class="cp">#define mac_clear_isr(regs) 		writel(0xffffffffL,&amp;((regs)-&gt;ISR))</span>

<span class="cp">#define mac_write_int_mask(mask, regs) 	writel((mask),&amp;((regs)-&gt;IMR));</span>
<span class="cp">#define mac_disable_int(regs)       	writel(CR0_GINTMSK1,&amp;((regs)-&gt;CR0Clr))</span>
<span class="cp">#define mac_enable_int(regs)    	writel(CR0_GINTMSK1,&amp;((regs)-&gt;CR0Set))</span>

<span class="cp">#define mac_set_dma_length(regs, n) {\</span>
<span class="cp">	BYTE_REG_BITS_SET((n),0x07,&amp;((regs)-&gt;DCFG));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_set_rx_thresh(regs, n) {\</span>
<span class="cp">	BYTE_REG_BITS_SET((n),(MCFG_RFT0|MCFG_RFT1),&amp;((regs)-&gt;MCFG));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_rx_queue_run(regs) {\</span>
<span class="cp">	writeb(TRDCSR_RUN, &amp;((regs)-&gt;RDCSRSet));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_rx_queue_wake(regs) {\</span>
<span class="cp">	writeb(TRDCSR_WAK, &amp;((regs)-&gt;RDCSRSet));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_tx_queue_run(regs, n) {\</span>
<span class="cp">	writew(TRDCSR_RUN&lt;&lt;((n)*4),&amp;((regs)-&gt;TDCSRSet));\</span>
<span class="cp">}</span>

<span class="cp">#define mac_tx_queue_wake(regs, n) {\</span>
<span class="cp">	writew(TRDCSR_WAK&lt;&lt;(n*4),&amp;((regs)-&gt;TDCSRSet));\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mac_eeprom_reload</span><span class="p">(</span><span class="k">struct</span> <span class="n">mac_regs</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">regs</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

	<span class="n">BYTE_REG_BITS_ON</span><span class="p">(</span><span class="n">EECSR_RELOAD</span><span class="p">,</span><span class="o">&amp;</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">EECSR</span><span class="p">));</span>
	<span class="k">do</span> <span class="p">{</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">++&gt;</span><span class="mh">0x1000</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">BYTE_REG_BITS_IS_ON</span><span class="p">(</span><span class="n">EECSR_RELOAD</span><span class="p">,</span><span class="o">&amp;</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">EECSR</span><span class="p">)));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Header for WOL definitions. Used to compute hashes</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="n">u8</span> <span class="n">MCAM_ADDR</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">arp_packet</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">dest_mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">src_mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">__be16</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">ar_hrd</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">ar_pro</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ar_hln</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ar_pln</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">ar_op</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ar_sha</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">ar_sip</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">ar_tha</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">ar_tip</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">_magic_packet</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">dest_mac</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">src_mac</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">__be16</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">MAC</span><span class="p">[</span><span class="mi">16</span><span class="p">][</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">password</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Store for chip context when saving and restoring status. Not</span>
<span class="cm"> *	all fields are saved/restored currently.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">velocity_context</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">mac_reg</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="n">MCAM_ADDR</span> <span class="n">cam_addr</span><span class="p">[</span><span class="n">MCAM_SIZE</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">vcam</span><span class="p">[</span><span class="n">VCAM_SIZE</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">cammask</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">patcrc</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Registers in the MII (offset unit is WORD)</span>
<span class="cm"> */</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Marvell 88E1000/88E1000S</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define MII_REG_PSCR        0x10	</span><span class="c1">// PHY specific control register</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>Bits in the Silicon revision register</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define TCSR_ECHODIS        0x2000	</span><span class="c1">//</span>
<span class="cp">#define AUXCR_MDPPS         0x0004	</span><span class="c1">//</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Bits in the PLED register</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define PLED_LALBE			0x0004	</span><span class="c1">//</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Marvell 88E1000/88E1000S Bits in the PHY specific control register (10h)</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define PSCR_ACRSTX         0x0800	</span><span class="c1">// Assert CRS on Transmit</span>

<span class="cp">#define PHYID_CICADA_CS8201 0x000FC410UL</span>
<span class="cp">#define PHYID_VT3216_32BIT  0x000FC610UL</span>
<span class="cp">#define PHYID_VT3216_64BIT  0x000FC600UL</span>
<span class="cp">#define PHYID_MARVELL_1000  0x01410C50UL</span>
<span class="cp">#define PHYID_MARVELL_1000S 0x01410C40UL</span>

<span class="cp">#define PHYID_REV_ID_MASK   0x0000000FUL</span>

<span class="cp">#define PHYID_GET_PHY_ID(i)         ((i) &amp; ~PHYID_REV_ID_MASK)</span>

<span class="cp">#define MII_REG_BITS_ON(x,i,p) do {\</span>
<span class="cp">    u16 w;\</span>
<span class="cp">    velocity_mii_read((p),(i),&amp;(w));\</span>
<span class="cp">    (w)|=(x);\</span>
<span class="cp">    velocity_mii_write((p),(i),(w));\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define MII_REG_BITS_OFF(x,i,p) do {\</span>
<span class="cp">    u16 w;\</span>
<span class="cp">    velocity_mii_read((p),(i),&amp;(w));\</span>
<span class="cp">    (w)&amp;=(~(x));\</span>
<span class="cp">    velocity_mii_write((p),(i),(w));\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define MII_REG_BITS_IS_ON(x,i,p) ({\</span>
<span class="cp">    u16 w;\</span>
<span class="cp">    velocity_mii_read((p),(i),&amp;(w));\</span>
<span class="cp">    ((int) ((w) &amp; (x)));})</span>

<span class="cp">#define MII_GET_PHY_ID(p) ({\</span>
<span class="cp">    u32 id;\</span>
<span class="cp">    velocity_mii_read((p),MII_PHYSID2,(u16 *) &amp;id);\</span>
<span class="cp">    velocity_mii_read((p),MII_PHYSID1,((u16 *) &amp;id)+1);\</span>
<span class="cp">    (id);})</span>

<span class="cm">/*</span>
<span class="cm"> * Inline debug routine</span>
<span class="cm"> */</span>


<span class="k">enum</span> <span class="n">velocity_msg_level</span> <span class="p">{</span>
	<span class="n">MSG_LEVEL_ERR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="c1">//Errors that will cause abnormal operation.</span>
	<span class="n">MSG_LEVEL_NOTICE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="c1">//Some errors need users to be notified.</span>
	<span class="n">MSG_LEVEL_INFO</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="c1">//Normal message.</span>
	<span class="n">MSG_LEVEL_VERBOSE</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>	<span class="c1">//Will report all trival errors.</span>
	<span class="n">MSG_LEVEL_DEBUG</span> <span class="o">=</span> <span class="mi">4</span>	<span class="c1">//Only for debug purpose.</span>
<span class="p">};</span>

<span class="cp">#ifdef VELOCITY_DEBUG</span>
<span class="cp">#define ASSERT(x) { \</span>
<span class="cp">	if (!(x)) { \</span>
<span class="cp">		printk(KERN_ERR &quot;assertion %s failed: file %s line %d\n&quot;, #x,\</span>
<span class="cp">			__func__, __LINE__);\</span>
<span class="cp">		BUG(); \</span>
<span class="cp">	}\</span>
<span class="cp">}</span>
<span class="cp">#define VELOCITY_DBG(p,args...) printk(p, ##args)</span>
<span class="cp">#else</span>
<span class="cp">#define ASSERT(x)</span>
<span class="cp">#define VELOCITY_DBG(x)</span>
<span class="cp">#endif</span>

<span class="cp">#define VELOCITY_PRT(l, p, args...) do {if (l&lt;=msglevel) printk( p ,##args);} while (0)</span>

<span class="cp">#define VELOCITY_PRT_CAMMASK(p,t) {\</span>
<span class="cp">	int i;\</span>
<span class="cp">	if ((t)==VELOCITY_MULTICAST_CAM) {\</span>
<span class="cp">        	for (i=0;i&lt;(MCAM_SIZE/8);i++)\</span>
<span class="cp">			printk(&quot;%02X&quot;,(p)-&gt;mCAMmask[i]);\</span>
<span class="cp">	}\</span>
<span class="cp">	else {\</span>
<span class="cp">		for (i=0;i&lt;(VCAM_SIZE/8);i++)\</span>
<span class="cp">			printk(&quot;%02X&quot;,(p)-&gt;vCAMmask[i]);\</span>
<span class="cp">	}\</span>
<span class="cp">	printk(&quot;\n&quot;);\</span>
<span class="cp">}</span>



<span class="cp">#define     VELOCITY_WOL_MAGIC             0x00000000UL</span>
<span class="cp">#define     VELOCITY_WOL_PHY               0x00000001UL</span>
<span class="cp">#define     VELOCITY_WOL_ARP               0x00000002UL</span>
<span class="cp">#define     VELOCITY_WOL_UCAST             0x00000004UL</span>
<span class="cp">#define     VELOCITY_WOL_BCAST             0x00000010UL</span>
<span class="cp">#define     VELOCITY_WOL_MCAST             0x00000020UL</span>
<span class="cp">#define     VELOCITY_WOL_MAGIC_SEC         0x00000040UL</span>

<span class="cm">/*</span>
<span class="cm"> *	Flags for options</span>
<span class="cm"> */</span>

<span class="cp">#define     VELOCITY_FLAGS_TAGGING         0x00000001UL</span>
<span class="cp">#define     VELOCITY_FLAGS_RX_CSUM         0x00000004UL</span>
<span class="cp">#define     VELOCITY_FLAGS_IP_ALIGN        0x00000008UL</span>
<span class="cp">#define     VELOCITY_FLAGS_VAL_PKT_LEN     0x00000010UL</span>

<span class="cp">#define     VELOCITY_FLAGS_FLOW_CTRL       0x01000000UL</span>

<span class="cm">/*</span>
<span class="cm"> *	Flags for driver status</span>
<span class="cm"> */</span>

<span class="cp">#define     VELOCITY_FLAGS_OPENED          0x00010000UL</span>
<span class="cp">#define     VELOCITY_FLAGS_VMNS_CONNECTED  0x00020000UL</span>
<span class="cp">#define     VELOCITY_FLAGS_VMNS_COMMITTED  0x00040000UL</span>
<span class="cp">#define     VELOCITY_FLAGS_WOL_ENABLED     0x00080000UL</span>

<span class="cm">/*</span>
<span class="cm"> *	Flags for MII status</span>
<span class="cm"> */</span>

<span class="cp">#define     VELOCITY_LINK_FAIL             0x00000001UL</span>
<span class="cp">#define     VELOCITY_SPEED_10              0x00000002UL</span>
<span class="cp">#define     VELOCITY_SPEED_100             0x00000004UL</span>
<span class="cp">#define     VELOCITY_SPEED_1000            0x00000008UL</span>
<span class="cp">#define     VELOCITY_DUPLEX_FULL           0x00000010UL</span>
<span class="cp">#define     VELOCITY_AUTONEG_ENABLE        0x00000020UL</span>
<span class="cp">#define     VELOCITY_FORCED_BY_EEPROM      0x00000040UL</span>

<span class="cm">/*</span>
<span class="cm"> *	For velocity_set_media_duplex</span>
<span class="cm"> */</span>

<span class="cp">#define     VELOCITY_LINK_CHANGE           0x00000001UL</span>

<span class="k">enum</span> <span class="n">speed_opt</span> <span class="p">{</span>
	<span class="n">SPD_DPX_AUTO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SPD_DPX_100_HALF</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SPD_DPX_100_FULL</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">SPD_DPX_10_HALF</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">SPD_DPX_10_FULL</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">SPD_DPX_1000_FULL</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">velocity_init_type</span> <span class="p">{</span>
	<span class="n">VELOCITY_INIT_COLD</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">VELOCITY_INIT_RESET</span><span class="p">,</span>
	<span class="n">VELOCITY_INIT_WOL</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">velocity_flow_cntl_type</span> <span class="p">{</span>
	<span class="n">FLOW_CNTL_DEFAULT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">FLOW_CNTL_TX</span><span class="p">,</span>
	<span class="n">FLOW_CNTL_RX</span><span class="p">,</span>
	<span class="n">FLOW_CNTL_TX_RX</span><span class="p">,</span>
	<span class="n">FLOW_CNTL_DISABLE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">velocity_opt</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">numrx</span><span class="p">;</span>			<span class="cm">/* Number of RX descriptors */</span>
	<span class="kt">int</span> <span class="n">numtx</span><span class="p">;</span>			<span class="cm">/* Number of TX descriptors */</span>
	<span class="k">enum</span> <span class="n">speed_opt</span> <span class="n">spd_dpx</span><span class="p">;</span>		<span class="cm">/* Media link mode */</span>

	<span class="kt">int</span> <span class="n">DMA_length</span><span class="p">;</span>			<span class="cm">/* DMA length */</span>
	<span class="kt">int</span> <span class="n">rx_thresh</span><span class="p">;</span>			<span class="cm">/* RX_THRESH */</span>
	<span class="kt">int</span> <span class="n">flow_cntl</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">wol_opts</span><span class="p">;</span>			<span class="cm">/* Wake on lan options */</span>
	<span class="kt">int</span> <span class="n">td_int_count</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">int_works</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_bandwidth_hi</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_bandwidth_lo</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_bandwidth_en</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rxqueue_timer</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">txqueue_timer</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_intsup</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_intsup</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define AVAIL_TD(p,q)   ((p)-&gt;options.numtx-((p)-&gt;tx.used[(q)]))</span>

<span class="cp">#define GET_RD_BY_IDX(vptr, idx)   (vptr-&gt;rd_ring[idx])</span>

<span class="k">struct</span> <span class="n">velocity_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">active_vlans</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">VLAN_N_VID</span><span class="p">)];</span>
	<span class="n">u8</span> <span class="n">ip_addr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">enum</span> <span class="n">chip_type</span> <span class="n">chip_id</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mac_regs</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">mac_regs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">memaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ioaddr</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">tx_info</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">numq</span><span class="p">;</span>

		<span class="cm">/* FIXME: the locality of the data seems rather poor. */</span>
		<span class="kt">int</span> <span class="n">used</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">curr</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">tail</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">tx_desc</span> <span class="o">*</span><span class="n">rings</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">velocity_td_info</span> <span class="o">*</span><span class="n">infos</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
		<span class="n">dma_addr_t</span> <span class="n">pool_dma</span><span class="p">[</span><span class="n">TX_QUEUE_NO</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">tx</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rx_info</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">buf_sz</span><span class="p">;</span>

		<span class="kt">int</span> <span class="n">dirty</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">curr</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">filled</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">rx_desc</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">velocity_rd_info</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>	<span class="cm">/* It&#39;s an array */</span>
		<span class="n">dma_addr_t</span> <span class="n">pool_dma</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rx</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">mib_counter</span><span class="p">[</span><span class="n">MAX_HW_MIB_COUNTER</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">velocity_opt</span> <span class="n">options</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">int_mask</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">mii_status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">phy_id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">multicast_limit</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">vCAMmask</span><span class="p">[(</span><span class="n">VCAM_SIZE</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)];</span>
	<span class="n">u8</span> <span class="n">mCAMmask</span><span class="p">[(</span><span class="n">MCAM_SIZE</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)];</span>

	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">wol_opts</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wol_passwd</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">velocity_context</span> <span class="n">context</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">ticks</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">rev_id</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">napi_struct</span> <span class="n">napi</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> *	velocity_get_ip		-	find an IP address for the device</span>
<span class="cm"> *	@vptr: Velocity to query</span>
<span class="cm"> *</span>
<span class="cm"> *	Dig out an IP address for this interface so that we can</span>
<span class="cm"> *	configure wakeup with WOL for ARP. If there are multiple IP</span>
<span class="cm"> *	addresses on this chain then we use the first - multi-IP WOL is not</span>
<span class="cm"> *	supported.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">velocity_get_ip</span><span class="p">(</span><span class="k">struct</span> <span class="n">velocity_info</span> <span class="o">*</span><span class="n">vptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">in_device</span> <span class="o">*</span><span class="n">in_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">in_ifaddr</span> <span class="o">*</span><span class="n">ifa</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOENT</span><span class="p">;</span>

	<span class="n">rcu_read_lock</span><span class="p">();</span>
	<span class="n">in_dev</span> <span class="o">=</span> <span class="n">__in_dev_get_rcu</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">in_dev</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ifa</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">in_ifaddr</span> <span class="o">*</span><span class="p">)</span> <span class="n">in_dev</span><span class="o">-&gt;</span><span class="n">ifa_list</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ifa</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">ip_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ifa</span><span class="o">-&gt;</span><span class="n">ifa_address</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">rcu_read_unlock</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	velocity_update_hw_mibs	-	fetch MIB counters from chip</span>
<span class="cm"> *	@vptr: velocity to update</span>
<span class="cm"> *</span>
<span class="cm"> *	The velocity hardware keeps certain counters in the hardware</span>
<span class="cm"> * 	side. We need to read these when the user asks for statistics</span>
<span class="cm"> *	or when they overflow (causing an interrupt). The read of the</span>
<span class="cm"> *	statistic clears it, so we keep running master counters in user</span>
<span class="cm"> *	space.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">velocity_update_hw_mibs</span><span class="p">(</span><span class="k">struct</span> <span class="n">velocity_info</span> <span class="o">*</span><span class="n">vptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">BYTE_REG_BITS_ON</span><span class="p">(</span><span class="n">MIBCR_MIBFLSH</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mac_regs</span><span class="o">-&gt;</span><span class="n">MIBCR</span><span class="p">));</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">BYTE_REG_BITS_IS_ON</span><span class="p">(</span><span class="n">MIBCR_MIBFLSH</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mac_regs</span><span class="o">-&gt;</span><span class="n">MIBCR</span><span class="p">)));</span>

	<span class="n">BYTE_REG_BITS_ON</span><span class="p">(</span><span class="n">MIBCR_MPTRINI</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mac_regs</span><span class="o">-&gt;</span><span class="n">MIBCR</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">HW_MIB_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">readl</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mac_regs</span><span class="o">-&gt;</span><span class="n">MIBData</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0x00FFFFFFUL</span><span class="p">;</span>
		<span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mib_counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> *	init_flow_control_register 	-	set up flow control</span>
<span class="cm"> *	@vptr: velocity to configure</span>
<span class="cm"> *</span>
<span class="cm"> *	Configure the flow control registers for this velocity device.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">init_flow_control_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">velocity_info</span> <span class="o">*</span><span class="n">vptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mac_regs</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">regs</span> <span class="o">=</span> <span class="n">vptr</span><span class="o">-&gt;</span><span class="n">mac_regs</span><span class="p">;</span>

	<span class="cm">/* Set {XHITH1, XHITH0, XLTH1, XLTH0} in FlowCR1 to {1, 0, 1, 1}</span>
<span class="cm">	   depend on RD=64, and Turn on XNOEN in FlowCR1 */</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">CR0_XONEN</span> <span class="o">|</span> <span class="n">CR0_XHITH1</span> <span class="o">|</span> <span class="n">CR0_XLTH1</span> <span class="o">|</span> <span class="n">CR0_XLTH0</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">CR0Set</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">CR0_FDXTFCEN</span> <span class="o">|</span> <span class="n">CR0_FDXRFCEN</span> <span class="o">|</span> <span class="n">CR0_HDXFCEN</span> <span class="o">|</span> <span class="n">CR0_XHITH0</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">CR0Clr</span><span class="p">);</span>

	<span class="cm">/* Set TxPauseTimer to 0xFFFF */</span>
	<span class="n">writew</span><span class="p">(</span><span class="mh">0xFFFF</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">tx_pause_timer</span><span class="p">);</span>

	<span class="cm">/* Initialize RBRDU to Rx buffer count. */</span>
	<span class="n">writew</span><span class="p">(</span><span class="n">vptr</span><span class="o">-&gt;</span><span class="n">options</span><span class="p">.</span><span class="n">numrx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">RBRDU</span><span class="p">);</span>
<span class="p">}</span>


<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
