<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › freescale › fs_enet › fs_enet.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>fs_enet.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef FS_ENET_H</span>
<span class="cp">#define FS_ENET_H</span>

<span class="cp">#include &lt;linux/mii.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/phy.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>

<span class="cp">#include &lt;linux/fs_enet_pd.h&gt;</span>
<span class="cp">#include &lt;asm/fs_pd.h&gt;</span>

<span class="cp">#ifdef CONFIG_CPM1</span>
<span class="cp">#include &lt;asm/cpm1.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_FS_ENET_HAS_FEC)</span>
<span class="cp">#include &lt;asm/cpm.h&gt;</span>

<span class="cp">#if defined(CONFIG_FS_ENET_MPC5121_FEC)</span>
<span class="cm">/* MPC5121 FEC has different register layout */</span>
<span class="k">struct</span> <span class="n">fec</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">fec_reserved0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fec_ievent</span><span class="p">;</span>			<span class="cm">/* Interrupt event reg */</span>
	<span class="n">u32</span> <span class="n">fec_imask</span><span class="p">;</span>			<span class="cm">/* Interrupt mask reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fec_r_des_active</span><span class="p">;</span>		<span class="cm">/* Receive descriptor reg */</span>
	<span class="n">u32</span> <span class="n">fec_x_des_active</span><span class="p">;</span>		<span class="cm">/* Transmit descriptor reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_ecntrl</span><span class="p">;</span>			<span class="cm">/* Ethernet control reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved3</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_mii_data</span><span class="p">;</span>		<span class="cm">/* MII manage frame reg */</span>
	<span class="n">u32</span> <span class="n">fec_mii_speed</span><span class="p">;</span>		<span class="cm">/* MII speed control reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved4</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_mib_ctrlstat</span><span class="p">;</span>		<span class="cm">/* MIB control/status reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved5</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_r_cntrl</span><span class="p">;</span>		<span class="cm">/* Receive control reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved6</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_x_cntrl</span><span class="p">;</span>		<span class="cm">/* Transmit Control reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved7</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_addr_low</span><span class="p">;</span>		<span class="cm">/* Low 32bits MAC address */</span>
	<span class="n">u32</span> <span class="n">fec_addr_high</span><span class="p">;</span>		<span class="cm">/* High 16bits MAC address */</span>
	<span class="n">u32</span> <span class="n">fec_opd</span><span class="p">;</span>			<span class="cm">/* Opcode + Pause duration */</span>
	<span class="n">u32</span> <span class="n">fec_reserved8</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_hash_table_high</span><span class="p">;</span>	<span class="cm">/* High 32bits hash table */</span>
	<span class="n">u32</span> <span class="n">fec_hash_table_low</span><span class="p">;</span>		<span class="cm">/* Low 32bits hash table */</span>
	<span class="n">u32</span> <span class="n">fec_grp_hash_table_high</span><span class="p">;</span>	<span class="cm">/* High 32bits hash table */</span>
	<span class="n">u32</span> <span class="n">fec_grp_hash_table_low</span><span class="p">;</span>	<span class="cm">/* Low 32bits hash table */</span>
	<span class="n">u32</span> <span class="n">fec_reserved9</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_x_wmrk</span><span class="p">;</span>			<span class="cm">/* FIFO transmit water mark */</span>
	<span class="n">u32</span> <span class="n">fec_reserved10</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fec_r_bound</span><span class="p">;</span>		<span class="cm">/* FIFO receive bound reg */</span>
	<span class="n">u32</span> <span class="n">fec_r_fstart</span><span class="p">;</span>		<span class="cm">/* FIFO receive start reg */</span>
	<span class="n">u32</span> <span class="n">fec_reserved11</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_r_des_start</span><span class="p">;</span>		<span class="cm">/* Receive descriptor ring */</span>
	<span class="n">u32</span> <span class="n">fec_x_des_start</span><span class="p">;</span>		<span class="cm">/* Transmit descriptor ring */</span>
	<span class="n">u32</span> <span class="n">fec_r_buff_size</span><span class="p">;</span>		<span class="cm">/* Maximum receive buff size */</span>
	<span class="n">u32</span> <span class="n">fec_reserved12</span><span class="p">[</span><span class="mi">26</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">fec_dma_control</span><span class="p">;</span>		<span class="cm">/* DMA Endian and other ctrl */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">fec_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fec</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fecp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mii_speed</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_CPM2</span>
<span class="cp">#include &lt;asm/cpm2.h&gt;</span>
<span class="cp">#endif</span>

<span class="cm">/* hw driver ops */</span>
<span class="k">struct</span> <span class="n">fs_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setup_data</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">allocate_bd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">free_bd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cleanup_data</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_multicast_list</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">adjust_link</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">restart</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">napi_clear_rx_event</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">napi_enable_rx</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">napi_disable_rx</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rx_bd_done</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_kickstart</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">get_int_events</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_int_events</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">int_events</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">ev_error</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">int_events</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_regs</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">sizep</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_regs_len</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_restart</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">phy_info</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">startup</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">shutdown</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">ack_int</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span> <span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* The FEC stores dest/src/type, data, and checksum for receive packets.</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_MTU 1508		</span><span class="cm">/* Allow fullsized pppoe packets over VLAN */</span><span class="cp"></span>
<span class="cp">#define MIN_MTU 46		</span><span class="cm">/* this is data size */</span><span class="cp"></span>
<span class="cp">#define CRC_LEN 4</span>

<span class="cp">#define PKT_MAXBUF_SIZE		(MAX_MTU+ETH_HLEN+CRC_LEN)</span>
<span class="cp">#define PKT_MINBUF_SIZE		(MIN_MTU+ETH_HLEN+CRC_LEN)</span>

<span class="cm">/* Must be a multiple of 32 (to cover both FEC &amp; FCC) */</span>
<span class="cp">#define PKT_MAXBLR_SIZE		((PKT_MAXBUF_SIZE + 31) &amp; ~31)</span>
<span class="cm">/* This is needed so that invalidate_xxx wont invalidate too much */</span>
<span class="cp">#define ENET_RX_ALIGN  16</span>
<span class="cp">#define ENET_RX_FRSIZE L1_CACHE_ALIGN(PKT_MAXBUF_SIZE + ENET_RX_ALIGN - 1)</span>

<span class="k">struct</span> <span class="n">fs_enet_private</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">napi_struct</span> <span class="n">napi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>	<span class="cm">/* pointer back to the device (must be initialized first) */</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">ndev</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>	<span class="cm">/* during all ops except TX pckt processing */</span>
	<span class="n">spinlock_t</span> <span class="n">tx_lock</span><span class="p">;</span>	<span class="cm">/* during fs_start_xmit and fs_tx         */</span>
	<span class="k">struct</span> <span class="n">fs_platform_info</span> <span class="o">*</span><span class="n">fpi</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">fs_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_ring</span><span class="p">,</span> <span class="n">tx_ring</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">ring_mem_addr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ring_base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">rx_skbuff</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">tx_skbuff</span><span class="p">;</span>
	<span class="n">cbd_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">rx_bd_base</span><span class="p">;</span>	<span class="cm">/* Address of Rx and Tx buffers.    */</span>
	<span class="n">cbd_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">tx_bd_base</span><span class="p">;</span>
	<span class="n">cbd_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dirty_tx</span><span class="p">;</span>	<span class="cm">/* ring entries to be free()ed.     */</span>
	<span class="n">cbd_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">cur_rx</span><span class="p">;</span>
	<span class="n">cbd_t</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">cur_tx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_free</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">phy_timer_list</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">phy_info</span> <span class="o">*</span><span class="n">phy</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msg_enable</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mii_if_info</span> <span class="n">mii_if</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_mii_status</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">interrupt</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">oldduplex</span><span class="p">,</span> <span class="n">oldspeed</span><span class="p">,</span> <span class="n">oldlink</span><span class="p">;</span>	<span class="cm">/* current settings */</span>

	<span class="cm">/* event masks */</span>
	<span class="n">u32</span> <span class="n">ev_napi_rx</span><span class="p">;</span>		<span class="cm">/* mask of NAPI rx events */</span>
	<span class="n">u32</span> <span class="n">ev_rx</span><span class="p">;</span>		<span class="cm">/* rx event mask          */</span>
	<span class="n">u32</span> <span class="n">ev_tx</span><span class="p">;</span>		<span class="cm">/* tx event mask          */</span>
	<span class="n">u32</span> <span class="n">ev_err</span><span class="p">;</span>		<span class="cm">/* error event mask       */</span>

	<span class="n">u16</span> <span class="n">bd_rx_empty</span><span class="p">;</span>	<span class="cm">/* mask of BD rx empty	  */</span>
	<span class="n">u16</span> <span class="n">bd_rx_err</span><span class="p">;</span>		<span class="cm">/* mask of BD rx errors   */</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>		<span class="cm">/* FEC1 = 0, FEC2 = 1  */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fecp</span><span class="p">;</span>	<span class="cm">/* hw registers        */</span>
			<span class="n">u32</span> <span class="n">hthi</span><span class="p">,</span> <span class="n">htlo</span><span class="p">;</span>		<span class="cm">/* state for multicast */</span>
		<span class="p">}</span> <span class="n">fec</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>		<span class="cm">/* FCC1-3 = 0-2	       */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fccp</span><span class="p">;</span>	<span class="cm">/* hw registers	       */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ep</span><span class="p">;</span>	<span class="cm">/* parameter ram       */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">fcccp</span><span class="p">;</span>	<span class="cm">/* hw registers cont.  */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">mem</span><span class="p">;</span>	<span class="cm">/* FCC DPRAM */</span>
			<span class="n">u32</span> <span class="n">gaddrh</span><span class="p">,</span> <span class="n">gaddrl</span><span class="p">;</span>	<span class="cm">/* group address       */</span>
		<span class="p">}</span> <span class="n">fcc</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>		<span class="cm">/* FEC1 = 0, FEC2 = 1  */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">sccp</span><span class="p">;</span>	<span class="cm">/* hw registers        */</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ep</span><span class="p">;</span>	<span class="cm">/* parameter ram       */</span>
			<span class="n">u32</span> <span class="n">hthi</span><span class="p">,</span> <span class="n">htlo</span><span class="p">;</span>		<span class="cm">/* state for multicast */</span>
		<span class="p">}</span> <span class="n">scc</span><span class="p">;</span>

	<span class="p">};</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************/</span>

<span class="kt">void</span> <span class="n">fs_init_bds</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">fs_cleanup_bds</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/***************************************************************************/</span>

<span class="cp">#define DRV_MODULE_NAME		&quot;fs_enet&quot;</span>
<span class="cp">#define PFX DRV_MODULE_NAME	&quot;: &quot;</span>
<span class="cp">#define DRV_MODULE_VERSION	&quot;1.0&quot;</span>
<span class="cp">#define DRV_MODULE_RELDATE	&quot;Aug 8, 2005&quot;</span>

<span class="cm">/***************************************************************************/</span>

<span class="kt">int</span> <span class="n">fs_enet_platform_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">fs_enet_platform_cleanup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/***************************************************************************/</span>
<span class="cm">/* buffer descriptor access macros */</span>

<span class="cm">/* access macros */</span>
<span class="cp">#if defined(CONFIG_CPM1)</span>
<span class="cm">/* for a a CPM1 __raw_xxx&#39;s are sufficient */</span>
<span class="cp">#define __cbd_out32(addr, x)	__raw_writel(x, addr)</span>
<span class="cp">#define __cbd_out16(addr, x)	__raw_writew(x, addr)</span>
<span class="cp">#define __cbd_in32(addr)	__raw_readl(addr)</span>
<span class="cp">#define __cbd_in16(addr)	__raw_readw(addr)</span>
<span class="cp">#else</span>
<span class="cm">/* for others play it safe */</span>
<span class="cp">#define __cbd_out32(addr, x)	out_be32(addr, x)</span>
<span class="cp">#define __cbd_out16(addr, x)	out_be16(addr, x)</span>
<span class="cp">#define __cbd_in32(addr)	in_be32(addr)</span>
<span class="cp">#define __cbd_in16(addr)	in_be16(addr)</span>
<span class="cp">#endif</span>

<span class="cm">/* write */</span>
<span class="cp">#define CBDW_SC(_cbd, _sc) 		__cbd_out16(&amp;(_cbd)-&gt;cbd_sc, (_sc))</span>
<span class="cp">#define CBDW_DATLEN(_cbd, _datlen)	__cbd_out16(&amp;(_cbd)-&gt;cbd_datlen, (_datlen))</span>
<span class="cp">#define CBDW_BUFADDR(_cbd, _bufaddr)	__cbd_out32(&amp;(_cbd)-&gt;cbd_bufaddr, (_bufaddr))</span>

<span class="cm">/* read */</span>
<span class="cp">#define CBDR_SC(_cbd) 			__cbd_in16(&amp;(_cbd)-&gt;cbd_sc)</span>
<span class="cp">#define CBDR_DATLEN(_cbd)		__cbd_in16(&amp;(_cbd)-&gt;cbd_datlen)</span>
<span class="cp">#define CBDR_BUFADDR(_cbd)		__cbd_in32(&amp;(_cbd)-&gt;cbd_bufaddr)</span>

<span class="cm">/* set bits */</span>
<span class="cp">#define CBDS_SC(_cbd, _sc) 		CBDW_SC(_cbd, CBDR_SC(_cbd) | (_sc))</span>

<span class="cm">/* clear bits */</span>
<span class="cp">#define CBDC_SC(_cbd, _sc) 		CBDW_SC(_cbd, CBDR_SC(_cbd) &amp; ~(_sc))</span>

<span class="cm">/*******************************************************************/</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fs_ops</span> <span class="n">fs_fec_ops</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fs_ops</span> <span class="n">fs_fcc_ops</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fs_ops</span> <span class="n">fs_scc_ops</span><span class="p">;</span>

<span class="cm">/*******************************************************************/</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
