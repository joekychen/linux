<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › sun › sunbmac.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sunbmac.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: sunbmac.h,v 1.7 2000/07/11 22:35:22 davem Exp $</span>
<span class="cm"> * sunbmac.h: Defines for the Sun &quot;Big MAC&quot; 100baseT ethernet cards.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1997 David S. Miller (davem@caip.rutgers.edu)</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SUNBMAC_H</span>
<span class="cp">#define _SUNBMAC_H</span>

<span class="cm">/* QEC global registers. */</span>
<span class="cp">#define GLOB_CTRL	0x00UL	</span><span class="cm">/* Control                  */</span><span class="cp"></span>
<span class="cp">#define GLOB_STAT	0x04UL	</span><span class="cm">/* Status                   */</span><span class="cp"></span>
<span class="cp">#define GLOB_PSIZE	0x08UL	</span><span class="cm">/* Packet Size              */</span><span class="cp"></span>
<span class="cp">#define GLOB_MSIZE	0x0cUL	</span><span class="cm">/* Local-mem size (64K)     */</span><span class="cp"></span>
<span class="cp">#define GLOB_RSIZE	0x10UL	</span><span class="cm">/* Receive partition size   */</span><span class="cp"></span>
<span class="cp">#define GLOB_TSIZE	0x14UL	</span><span class="cm">/* Transmit partition size  */</span><span class="cp"></span>
<span class="cp">#define GLOB_REG_SIZE	0x18UL</span>

<span class="cp">#define GLOB_CTRL_MMODE       0x40000000 </span><span class="cm">/* MACE qec mode            */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_BMODE       0x10000000 </span><span class="cm">/* BigMAC qec mode          */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_EPAR        0x00000020 </span><span class="cm">/* Enable parity            */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_ACNTRL      0x00000018 </span><span class="cm">/* SBUS arbitration control */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_B64         0x00000004 </span><span class="cm">/* 64 byte dvma bursts      */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_B32         0x00000002 </span><span class="cm">/* 32 byte dvma bursts      */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_B16         0x00000000 </span><span class="cm">/* 16 byte dvma bursts      */</span><span class="cp"></span>
<span class="cp">#define GLOB_CTRL_RESET       0x00000001 </span><span class="cm">/* Reset the QEC            */</span><span class="cp"></span>

<span class="cp">#define GLOB_STAT_TX          0x00000008 </span><span class="cm">/* BigMAC Transmit IRQ      */</span><span class="cp"></span>
<span class="cp">#define GLOB_STAT_RX          0x00000004 </span><span class="cm">/* BigMAC Receive IRQ       */</span><span class="cp"></span>
<span class="cp">#define GLOB_STAT_BM          0x00000002 </span><span class="cm">/* BigMAC Global IRQ        */</span><span class="cp"></span>
<span class="cp">#define GLOB_STAT_ER          0x00000001 </span><span class="cm">/* BigMAC Error IRQ         */</span><span class="cp"></span>

<span class="cp">#define GLOB_PSIZE_2048       0x00       </span><span class="cm">/* 2k packet size           */</span><span class="cp"></span>
<span class="cp">#define GLOB_PSIZE_4096       0x01       </span><span class="cm">/* 4k packet size           */</span><span class="cp"></span>
<span class="cp">#define GLOB_PSIZE_6144       0x10       </span><span class="cm">/* 6k packet size           */</span><span class="cp"></span>
<span class="cp">#define GLOB_PSIZE_8192       0x11       </span><span class="cm">/* 8k packet size           */</span><span class="cp"></span>

<span class="cm">/* QEC BigMAC channel registers. */</span>
<span class="cp">#define CREG_CTRL	0x00UL	</span><span class="cm">/* Control                   */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT	0x04UL	</span><span class="cm">/* Status                    */</span><span class="cp"></span>
<span class="cp">#define CREG_RXDS	0x08UL	</span><span class="cm">/* RX descriptor ring ptr    */</span><span class="cp"></span>
<span class="cp">#define CREG_TXDS	0x0cUL	</span><span class="cm">/* TX descriptor ring ptr    */</span><span class="cp"></span>
<span class="cp">#define CREG_RIMASK	0x10UL	</span><span class="cm">/* RX Interrupt Mask         */</span><span class="cp"></span>
<span class="cp">#define CREG_TIMASK	0x14UL	</span><span class="cm">/* TX Interrupt Mask         */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK	0x18UL	</span><span class="cm">/* QEC Error Interrupt Mask  */</span><span class="cp"></span>
<span class="cp">#define CREG_BMASK	0x1cUL	</span><span class="cm">/* BigMAC Error Interrupt Mask*/</span><span class="cp"></span>
<span class="cp">#define CREG_RXWBUFPTR	0x20UL	</span><span class="cm">/* Local memory rx write ptr */</span><span class="cp"></span>
<span class="cp">#define CREG_RXRBUFPTR	0x24UL	</span><span class="cm">/* Local memory rx read ptr  */</span><span class="cp"></span>
<span class="cp">#define CREG_TXWBUFPTR	0x28UL	</span><span class="cm">/* Local memory tx write ptr */</span><span class="cp"></span>
<span class="cp">#define CREG_TXRBUFPTR	0x2cUL	</span><span class="cm">/* Local memory tx read ptr  */</span><span class="cp"></span>
<span class="cp">#define CREG_CCNT	0x30UL	</span><span class="cm">/* Collision Counter         */</span><span class="cp"></span>
<span class="cp">#define CREG_REG_SIZE	0x34UL</span>

<span class="cp">#define CREG_CTRL_TWAKEUP     0x00000001  </span><span class="cm">/* Transmitter Wakeup, &#39;go&#39;. */</span><span class="cp"></span>

<span class="cp">#define CREG_STAT_BERROR      0x80000000  </span><span class="cm">/* BigMAC error              */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_TXIRQ       0x00200000  </span><span class="cm">/* Transmit Interrupt        */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_TXDERROR    0x00080000  </span><span class="cm">/* TX Descriptor is bogus    */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_TXLERR      0x00040000  </span><span class="cm">/* Late Transmit Error       */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_TXPERR      0x00020000  </span><span class="cm">/* Transmit Parity Error     */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_TXSERR      0x00010000  </span><span class="cm">/* Transmit SBUS error ack   */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXIRQ       0x00000020  </span><span class="cm">/* Receive Interrupt         */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXDROP      0x00000010  </span><span class="cm">/* Dropped a RX&#39;d packet     */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXSMALL     0x00000008  </span><span class="cm">/* Receive buffer too small  */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXLERR      0x00000004  </span><span class="cm">/* Receive Late Error        */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXPERR      0x00000002  </span><span class="cm">/* Receive Parity Error      */</span><span class="cp"></span>
<span class="cp">#define CREG_STAT_RXSERR      0x00000001  </span><span class="cm">/* Receive SBUS Error ACK    */</span><span class="cp"></span>

<span class="cp">#define CREG_STAT_ERRORS      (CREG_STAT_BERROR|CREG_STAT_TXDERROR|CREG_STAT_TXLERR|   \</span>
<span class="cp">                               CREG_STAT_TXPERR|CREG_STAT_TXSERR|CREG_STAT_RXDROP|     \</span>
<span class="cp">                               CREG_STAT_RXSMALL|CREG_STAT_RXLERR|CREG_STAT_RXPERR|    \</span>
<span class="cp">                               CREG_STAT_RXSERR)</span>

<span class="cp">#define CREG_QMASK_TXDERROR   0x00080000  </span><span class="cm">/* TXD error                 */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_TXLERR     0x00040000  </span><span class="cm">/* TX late error             */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_TXPERR     0x00020000  </span><span class="cm">/* TX parity error           */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_TXSERR     0x00010000  </span><span class="cm">/* TX sbus error ack         */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_RXDROP     0x00000010  </span><span class="cm">/* RX drop                   */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_RXBERROR   0x00000008  </span><span class="cm">/* RX buffer error           */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_RXLEERR    0x00000004  </span><span class="cm">/* RX late error             */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_RXPERR     0x00000002  </span><span class="cm">/* RX parity error           */</span><span class="cp"></span>
<span class="cp">#define CREG_QMASK_RXSERR     0x00000001  </span><span class="cm">/* RX sbus error ack         */</span><span class="cp"></span>

<span class="cm">/* BIGMAC core registers */</span>
<span class="cp">#define BMAC_XIFCFG	0x000UL	</span><span class="cm">/* XIF config register                */</span><span class="cp"></span>
	<span class="cm">/* 0x004--&gt;0x0fc, reserved */</span>
<span class="cp">#define BMAC_STATUS	0x100UL	</span><span class="cm">/* Status register, clear on read     */</span><span class="cp"></span>
<span class="cp">#define BMAC_IMASK	0x104UL	</span><span class="cm">/* Interrupt mask register            */</span><span class="cp"></span>
	<span class="cm">/* 0x108--&gt;0x204, reserved */</span>
<span class="cp">#define BMAC_TXSWRESET	0x208UL	</span><span class="cm">/* Transmitter software reset         */</span><span class="cp"></span>
<span class="cp">#define BMAC_TXCFG	0x20cUL	</span><span class="cm">/* Transmitter config register        */</span><span class="cp"></span>
<span class="cp">#define BMAC_IGAP1	0x210UL	</span><span class="cm">/* Inter-packet gap 1                 */</span><span class="cp"></span>
<span class="cp">#define BMAC_IGAP2	0x214UL	</span><span class="cm">/* Inter-packet gap 2                 */</span><span class="cp"></span>
<span class="cp">#define BMAC_ALIMIT	0x218UL	</span><span class="cm">/* Transmit attempt limit             */</span><span class="cp"></span>
<span class="cp">#define BMAC_STIME	0x21cUL	</span><span class="cm">/* Transmit slot time                 */</span><span class="cp"></span>
<span class="cp">#define BMAC_PLEN	0x220UL	</span><span class="cm">/* Size of transmit preamble          */</span><span class="cp"></span>
<span class="cp">#define BMAC_PPAT	0x224UL	</span><span class="cm">/* Pattern for transmit preamble      */</span><span class="cp"></span>
<span class="cp">#define BMAC_TXDELIM	0x228UL	</span><span class="cm">/* Transmit delimiter                 */</span><span class="cp"></span>
<span class="cp">#define BMAC_JSIZE	0x22cUL	</span><span class="cm">/* Toe jam...                         */</span><span class="cp"></span>
<span class="cp">#define BMAC_TXPMAX	0x230UL	</span><span class="cm">/* Transmit max pkt size              */</span><span class="cp"></span>
<span class="cp">#define BMAC_TXPMIN	0x234UL	</span><span class="cm">/* Transmit min pkt size              */</span><span class="cp"></span>
<span class="cp">#define BMAC_PATTEMPT	0x238UL	</span><span class="cm">/* Count of transmit peak attempts    */</span><span class="cp"></span>
<span class="cp">#define BMAC_DTCTR	0x23cUL	</span><span class="cm">/* Transmit defer timer               */</span><span class="cp"></span>
<span class="cp">#define BMAC_NCCTR	0x240UL	</span><span class="cm">/* Transmit normal-collision counter  */</span><span class="cp"></span>
<span class="cp">#define BMAC_FCCTR	0x244UL	</span><span class="cm">/* Transmit first-collision counter   */</span><span class="cp"></span>
<span class="cp">#define BMAC_EXCTR	0x248UL	</span><span class="cm">/* Transmit excess-collision counter  */</span><span class="cp"></span>
<span class="cp">#define BMAC_LTCTR	0x24cUL	</span><span class="cm">/* Transmit late-collision counter    */</span><span class="cp"></span>
<span class="cp">#define BMAC_RSEED	0x250UL	</span><span class="cm">/* Transmit random number seed        */</span><span class="cp"></span>
<span class="cp">#define BMAC_TXSMACHINE	0x254UL </span><span class="cm">/* Transmit state machine             */</span><span class="cp"></span>
	<span class="cm">/* 0x258--&gt;0x304, reserved */</span>
<span class="cp">#define BMAC_RXSWRESET	0x308UL	</span><span class="cm">/* Receiver software reset            */</span><span class="cp"></span>
<span class="cp">#define BMAC_RXCFG	0x30cUL	</span><span class="cm">/* Receiver config register           */</span><span class="cp"></span>
<span class="cp">#define BMAC_RXPMAX	0x310UL	</span><span class="cm">/* Receive max pkt size               */</span><span class="cp"></span>
<span class="cp">#define BMAC_RXPMIN	0x314UL	</span><span class="cm">/* Receive min pkt size               */</span><span class="cp"></span>
<span class="cp">#define BMAC_MACADDR2	0x318UL	</span><span class="cm">/* Ether address register 2           */</span><span class="cp"></span>
<span class="cp">#define BMAC_MACADDR1	0x31cUL	</span><span class="cm">/* Ether address register 1           */</span><span class="cp"></span>
<span class="cp">#define BMAC_MACADDR0	0x320UL	</span><span class="cm">/* Ether address register 0           */</span><span class="cp"></span>
<span class="cp">#define BMAC_FRCTR	0x324UL	</span><span class="cm">/* Receive frame receive counter      */</span><span class="cp"></span>
<span class="cp">#define BMAC_GLECTR	0x328UL	</span><span class="cm">/* Receive giant-length error counter */</span><span class="cp"></span>
<span class="cp">#define BMAC_UNALECTR	0x32cUL	</span><span class="cm">/* Receive unaligned error counter    */</span><span class="cp"></span>
<span class="cp">#define BMAC_RCRCECTR	0x330UL	</span><span class="cm">/* Receive CRC error counter          */</span><span class="cp"></span>
<span class="cp">#define BMAC_RXSMACHINE	0x334UL	</span><span class="cm">/* Receiver state machine             */</span><span class="cp"></span>
<span class="cp">#define BMAC_RXCVALID	0x338UL	</span><span class="cm">/* Receiver code violation            */</span><span class="cp"></span>
	<span class="cm">/* 0x33c, reserved */</span>
<span class="cp">#define BMAC_HTABLE3	0x340UL	</span><span class="cm">/* Hash table 3                       */</span><span class="cp"></span>
<span class="cp">#define BMAC_HTABLE2	0x344UL	</span><span class="cm">/* Hash table 2                       */</span><span class="cp"></span>
<span class="cp">#define BMAC_HTABLE1	0x348UL	</span><span class="cm">/* Hash table 1                       */</span><span class="cp"></span>
<span class="cp">#define BMAC_HTABLE0	0x34cUL	</span><span class="cm">/* Hash table 0                       */</span><span class="cp"></span>
<span class="cp">#define BMAC_AFILTER2	0x350UL	</span><span class="cm">/* Address filter 2                   */</span><span class="cp"></span>
<span class="cp">#define BMAC_AFILTER1	0x354UL	</span><span class="cm">/* Address filter 1                   */</span><span class="cp"></span>
<span class="cp">#define BMAC_AFILTER0	0x358UL	</span><span class="cm">/* Address filter 0                   */</span><span class="cp"></span>
<span class="cp">#define BMAC_AFMASK	0x35cUL	</span><span class="cm">/* Address filter mask                */</span><span class="cp"></span>
<span class="cp">#define BMAC_REG_SIZE	0x360UL</span>

<span class="cm">/* BigMac XIF config register. */</span>
<span class="cp">#define BIGMAC_XCFG_ODENABLE   0x00000001 </span><span class="cm">/* Output driver enable                     */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_XCFG_RESV       0x00000002 </span><span class="cm">/* Reserved, write always as 1              */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_XCFG_MLBACK     0x00000004 </span><span class="cm">/* Loopback-mode MII enable                 */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_XCFG_SMODE      0x00000008 </span><span class="cm">/* Enable serial mode                       */</span><span class="cp"></span>

<span class="cm">/* BigMAC status register. */</span>
<span class="cp">#define BIGMAC_STAT_GOTFRAME   0x00000001 </span><span class="cm">/* Received a frame                         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_RCNTEXP    0x00000002 </span><span class="cm">/* Receive frame counter expired            */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_ACNTEXP    0x00000004 </span><span class="cm">/* Align-error counter expired              */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_CCNTEXP    0x00000008 </span><span class="cm">/* CRC-error counter expired                */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_LCNTEXP    0x00000010 </span><span class="cm">/* Length-error counter expired             */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_RFIFOVF    0x00000020 </span><span class="cm">/* Receive FIFO overflow                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_CVCNTEXP   0x00000040 </span><span class="cm">/* Code-violation counter expired           */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_SENTFRAME  0x00000100 </span><span class="cm">/* Transmitted a frame                      */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_TFIFO_UND  0x00000200 </span><span class="cm">/* Transmit FIFO underrun                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_MAXPKTERR  0x00000400 </span><span class="cm">/* Max-packet size error                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_NCNTEXP    0x00000800 </span><span class="cm">/* Normal-collision counter expired         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_ECNTEXP    0x00001000 </span><span class="cm">/* Excess-collision counter expired         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_LCCNTEXP   0x00002000 </span><span class="cm">/* Late-collision counter expired           */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_FCNTEXP    0x00004000 </span><span class="cm">/* First-collision counter expired          */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_STAT_DTIMEXP    0x00008000 </span><span class="cm">/* Defer-timer expired                      */</span><span class="cp"></span>

<span class="cm">/* BigMAC interrupt mask register. */</span>
<span class="cp">#define BIGMAC_IMASK_GOTFRAME  0x00000001 </span><span class="cm">/* Received a frame                         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_RCNTEXP   0x00000002 </span><span class="cm">/* Receive frame counter expired            */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_ACNTEXP   0x00000004 </span><span class="cm">/* Align-error counter expired              */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_CCNTEXP   0x00000008 </span><span class="cm">/* CRC-error counter expired                */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_LCNTEXP   0x00000010 </span><span class="cm">/* Length-error counter expired             */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_RFIFOVF   0x00000020 </span><span class="cm">/* Receive FIFO overflow                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_CVCNTEXP  0x00000040 </span><span class="cm">/* Code-violation counter expired           */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_SENTFRAME 0x00000100 </span><span class="cm">/* Transmitted a frame                      */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_TFIFO_UND 0x00000200 </span><span class="cm">/* Transmit FIFO underrun                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_MAXPKTERR 0x00000400 </span><span class="cm">/* Max-packet size error                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_NCNTEXP   0x00000800 </span><span class="cm">/* Normal-collision counter expired         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_ECNTEXP   0x00001000 </span><span class="cm">/* Excess-collision counter expired         */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_LCCNTEXP  0x00002000 </span><span class="cm">/* Late-collision counter expired           */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_FCNTEXP   0x00004000 </span><span class="cm">/* First-collision counter expired          */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_IMASK_DTIMEXP   0x00008000 </span><span class="cm">/* Defer-timer expired                      */</span><span class="cp"></span>

<span class="cm">/* BigMac transmit config register. */</span>
<span class="cp">#define BIGMAC_TXCFG_ENABLE    0x00000001 </span><span class="cm">/* Enable the transmitter                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_FIFO      0x00000010 </span><span class="cm">/* Default tx fthresh...                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_SMODE     0x00000020 </span><span class="cm">/* Enable slow transmit mode                */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_CIGN      0x00000040 </span><span class="cm">/* Ignore transmit collisions               */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_FCSOFF    0x00000080 </span><span class="cm">/* Do not emit FCS                          */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_DBACKOFF  0x00000100 </span><span class="cm">/* Disable backoff                          */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_TXCFG_FULLDPLX  0x00000200 </span><span class="cm">/* Enable full-duplex                       */</span><span class="cp"></span>

<span class="cm">/* BigMac receive config register. */</span>
<span class="cp">#define BIGMAC_RXCFG_ENABLE    0x00000001 </span><span class="cm">/* Enable the receiver                      */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_FIFO      0x0000000e </span><span class="cm">/* Default rx fthresh...                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_PSTRIP    0x00000020 </span><span class="cm">/* Pad byte strip enable                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_PMISC     0x00000040 </span><span class="cm">/* Enable promiscuous mode                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_DERR      0x00000080 </span><span class="cm">/* Disable error checking                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_DCRCS     0x00000100 </span><span class="cm">/* Disable CRC stripping                    */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_ME        0x00000200 </span><span class="cm">/* Receive packets addressed to me          */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_PGRP      0x00000400 </span><span class="cm">/* Enable promisc group mode                */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_HENABLE   0x00000800 </span><span class="cm">/* Enable the hash filter                   */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_RXCFG_AENABLE   0x00001000 </span><span class="cm">/* Enable the address filter                */</span><span class="cp"></span>

<span class="cm">/* The BigMAC PHY transceiver.  Not nearly as sophisticated as the happy meal</span>
<span class="cm"> * one.  But it does have the &quot;bit banger&quot;, oh baby.</span>
<span class="cm"> */</span>
<span class="cp">#define TCVR_TPAL	0x00UL</span>
<span class="cp">#define TCVR_MPAL	0x04UL</span>
<span class="cp">#define TCVR_REG_SIZE	0x08UL</span>

<span class="cm">/* Frame commands. */</span>
<span class="cp">#define FRAME_WRITE           0x50020000</span>
<span class="cp">#define FRAME_READ            0x60020000</span>

<span class="cm">/* Tranceiver registers. */</span>
<span class="cp">#define TCVR_PAL_SERIAL       0x00000001 </span><span class="cm">/* Enable serial mode              */</span><span class="cp"></span>
<span class="cp">#define TCVR_PAL_EXTLBACK     0x00000002 </span><span class="cm">/* Enable external loopback        */</span><span class="cp"></span>
<span class="cp">#define TCVR_PAL_MSENSE       0x00000004 </span><span class="cm">/* Media sense                     */</span><span class="cp"></span>
<span class="cp">#define TCVR_PAL_LTENABLE     0x00000008 </span><span class="cm">/* Link test enable                */</span><span class="cp"></span>
<span class="cp">#define TCVR_PAL_LTSTATUS     0x00000010 </span><span class="cm">/* Link test status  (P1 only)     */</span><span class="cp"></span>

<span class="cm">/* Management PAL. */</span>
<span class="cp">#define MGMT_PAL_DCLOCK       0x00000001 </span><span class="cm">/* Data clock                      */</span><span class="cp"></span>
<span class="cp">#define MGMT_PAL_OENAB        0x00000002 </span><span class="cm">/* Output enabler                  */</span><span class="cp"></span>
<span class="cp">#define MGMT_PAL_MDIO         0x00000004 </span><span class="cm">/* MDIO Data/attached              */</span><span class="cp"></span>
<span class="cp">#define MGMT_PAL_TIMEO        0x00000008 </span><span class="cm">/* Transmit enable timeout error   */</span><span class="cp"></span>
<span class="cp">#define MGMT_PAL_EXT_MDIO     MGMT_PAL_MDIO</span>
<span class="cp">#define MGMT_PAL_INT_MDIO     MGMT_PAL_TIMEO</span>

<span class="cm">/* Here are some PHY addresses. */</span>
<span class="cp">#define BIGMAC_PHY_EXTERNAL   0 </span><span class="cm">/* External transceiver */</span><span class="cp"></span>
<span class="cp">#define BIGMAC_PHY_INTERNAL   1 </span><span class="cm">/* Internal transceiver */</span><span class="cp"></span>

<span class="cm">/* Ring descriptors and such, same as Quad Ethernet. */</span>
<span class="k">struct</span> <span class="n">be_rxd</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">rx_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RXD_OWN      0x80000000 </span><span class="cm">/* Ownership.      */</span><span class="cp"></span>
<span class="cp">#define RXD_UPDATE   0x10000000 </span><span class="cm">/* Being Updated?  */</span><span class="cp"></span>
<span class="cp">#define RXD_LENGTH   0x000007ff </span><span class="cm">/* Packet Length.  */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">be_txd</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">tx_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define TXD_OWN      0x80000000 </span><span class="cm">/* Ownership.      */</span><span class="cp"></span>
<span class="cp">#define TXD_SOP      0x40000000 </span><span class="cm">/* Start Of Packet */</span><span class="cp"></span>
<span class="cp">#define TXD_EOP      0x20000000 </span><span class="cm">/* End Of Packet   */</span><span class="cp"></span>
<span class="cp">#define TXD_UPDATE   0x10000000 </span><span class="cm">/* Being Updated?  */</span><span class="cp"></span>
<span class="cp">#define TXD_LENGTH   0x000007ff </span><span class="cm">/* Packet Length.  */</span><span class="cp"></span>

<span class="cp">#define TX_RING_MAXSIZE   256</span>
<span class="cp">#define RX_RING_MAXSIZE   256</span>

<span class="cp">#define TX_RING_SIZE      256</span>
<span class="cp">#define RX_RING_SIZE      256</span>

<span class="cp">#define NEXT_RX(num)       (((num) + 1) &amp; (RX_RING_SIZE - 1))</span>
<span class="cp">#define NEXT_TX(num)       (((num) + 1) &amp; (TX_RING_SIZE - 1))</span>
<span class="cp">#define PREV_RX(num)       (((num) - 1) &amp; (RX_RING_SIZE - 1))</span>
<span class="cp">#define PREV_TX(num)       (((num) - 1) &amp; (TX_RING_SIZE - 1))</span>

<span class="cp">#define TX_BUFFS_AVAIL(bp)                                    \</span>
<span class="cp">        (((bp)-&gt;tx_old &lt;= (bp)-&gt;tx_new) ?                     \</span>
<span class="cp">	  (bp)-&gt;tx_old + (TX_RING_SIZE - 1) - (bp)-&gt;tx_new :  \</span>
<span class="cp">			    (bp)-&gt;tx_old - (bp)-&gt;tx_new - 1)</span>


<span class="cp">#define RX_COPY_THRESHOLD  256</span>
<span class="cp">#define RX_BUF_ALLOC_SIZE  (ETH_FRAME_LEN + (64 * 3))</span>

<span class="k">struct</span> <span class="n">bmac_init_block</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">be_rxd</span> <span class="n">be_rxd</span><span class="p">[</span><span class="n">RX_RING_MAXSIZE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">be_txd</span> <span class="n">be_txd</span><span class="p">[</span><span class="n">TX_RING_MAXSIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define bib_offset(mem, elem) \</span>
<span class="cp">((__u32)((unsigned long)(&amp;(((struct bmac_init_block *)0)-&gt;mem[elem]))))</span>

<span class="cm">/* Now software state stuff. */</span>
<span class="k">enum</span> <span class="n">bigmac_transceiver</span> <span class="p">{</span>
	<span class="n">external</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">internal</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">none</span>     <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Timer state engine. */</span>
<span class="k">enum</span> <span class="n">bigmac_timer_state</span> <span class="p">{</span>
	<span class="n">ltrywait</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>  <span class="cm">/* Forcing try of all modes, from fastest to slowest. */</span>
	<span class="n">asleep</span>   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>  <span class="cm">/* Timer inactive.                                    */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bigmac</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">gregs</span><span class="p">;</span>	<span class="cm">/* QEC Global Registers               */</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">creg</span><span class="p">;</span>	<span class="cm">/* QEC BigMAC Channel Registers       */</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">bregs</span><span class="p">;</span>	<span class="cm">/* BigMAC Registers                   */</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">tregs</span><span class="p">;</span>	<span class="cm">/* BigMAC Transceiver                 */</span>
	<span class="k">struct</span> <span class="n">bmac_init_block</span>	<span class="o">*</span><span class="n">bmac_block</span><span class="p">;</span>	<span class="cm">/* RX and TX descriptors */</span>
	<span class="n">__u32</span>			 <span class="n">bblock_dvma</span><span class="p">;</span>	<span class="cm">/* RX and TX descriptors */</span>

	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sk_buff</span>		<span class="o">*</span><span class="n">rx_skbs</span><span class="p">[</span><span class="n">RX_RING_SIZE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">sk_buff</span>		<span class="o">*</span><span class="n">tx_skbs</span><span class="p">[</span><span class="n">TX_RING_SIZE</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">rx_new</span><span class="p">,</span> <span class="n">tx_new</span><span class="p">,</span> <span class="n">rx_old</span><span class="p">,</span> <span class="n">tx_old</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">board_rev</span><span class="p">;</span>				<span class="cm">/* BigMAC board revision.             */</span>

	<span class="k">enum</span> <span class="n">bigmac_transceiver</span>	<span class="n">tcvr_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">bigmac_bursts</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">paddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">sw_bmsr</span><span class="p">;</span>         <span class="cm">/* SW copy of PHY BMSR               */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">sw_bmcr</span><span class="p">;</span>         <span class="cm">/* SW copy of PHY BMCR               */</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">bigmac_timer</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">bigmac_timer_state</span>	<span class="n">timer_state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">timer_ticks</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">net_device_stats</span>	<span class="n">enet_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">platform_device</span>	<span class="o">*</span><span class="n">qec_op</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">platform_device</span>	<span class="o">*</span><span class="n">bigmac_op</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>	<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* We use this to acquire receive skb&#39;s that we can DMA directly into. */</span>
<span class="cp">#define ALIGNED_RX_SKB_ADDR(addr) \</span>
<span class="cp">        ((((unsigned long)(addr) + (64 - 1)) &amp; ~(64 - 1)) - (unsigned long)(addr))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="nf">big_mac_alloc_skb</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>

	<span class="n">skb</span> <span class="o">=</span> <span class="n">alloc_skb</span><span class="p">(</span><span class="n">length</span> <span class="o">+</span> <span class="mi">64</span><span class="p">,</span> <span class="n">gfp_flags</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">ALIGNED_RX_SKB_ADDR</span><span class="p">(</span><span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>

		<span class="k">if</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span>
			<span class="n">skb_reserve</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">skb</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* !(_SUNBMAC_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
