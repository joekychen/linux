<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › mellanox › mlx4 › mlx4_en.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>mlx4_en.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2007 Mellanox Technologies. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _MLX4_EN_H_</span>
<span class="cp">#define _MLX4_EN_H_</span>

<span class="cp">#include &lt;linux/bitops.h&gt;</span>
<span class="cp">#include &lt;linux/compiler.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/if_vlan.h&gt;</span>
<span class="cp">#ifdef CONFIG_MLX4_EN_DCB</span>
<span class="cp">#include &lt;linux/dcbnl.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &lt;linux/mlx4/device.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/qp.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/cq.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/srq.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/doorbell.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/cmd.h&gt;</span>

<span class="cp">#include &quot;en_port.h&quot;</span>

<span class="cp">#define DRV_NAME	&quot;mlx4_en&quot;</span>
<span class="cp">#define DRV_VERSION	&quot;2.0&quot;</span>
<span class="cp">#define DRV_RELDATE	&quot;Dec 2011&quot;</span>

<span class="cp">#define MLX4_EN_MSG_LEVEL	(NETIF_MSG_LINK | NETIF_MSG_IFDOWN)</span>

<span class="cm">/*</span>
<span class="cm"> * Device constants</span>
<span class="cm"> */</span>


<span class="cp">#define MLX4_EN_PAGE_SHIFT	12</span>
<span class="cp">#define MLX4_EN_PAGE_SIZE	(1 &lt;&lt; MLX4_EN_PAGE_SHIFT)</span>
<span class="cp">#define MAX_RX_RINGS		16</span>
<span class="cp">#define MIN_RX_RINGS		4</span>
<span class="cp">#define TXBB_SIZE		64</span>
<span class="cp">#define HEADROOM		(2048 / TXBB_SIZE + 1)</span>
<span class="cp">#define STAMP_STRIDE		64</span>
<span class="cp">#define STAMP_DWORDS		(STAMP_STRIDE / 4)</span>
<span class="cp">#define STAMP_SHIFT		31</span>
<span class="cp">#define STAMP_VAL		0x7fffffff</span>
<span class="cp">#define STATS_DELAY		(HZ / 4)</span>

<span class="cm">/* Typical TSO descriptor with 16 gather entries is 352 bytes... */</span>
<span class="cp">#define MAX_DESC_SIZE		512</span>
<span class="cp">#define MAX_DESC_TXBBS		(MAX_DESC_SIZE / TXBB_SIZE)</span>

<span class="cm">/*</span>
<span class="cm"> * OS related constants and tunables</span>
<span class="cm"> */</span>

<span class="cp">#define MLX4_EN_WATCHDOG_TIMEOUT	(15 * HZ)</span>

<span class="cm">/* Use the maximum between 16384 and a single page */</span>
<span class="cp">#define MLX4_EN_ALLOC_SIZE	PAGE_ALIGN(16384)</span>
<span class="cp">#define MLX4_EN_ALLOC_ORDER	get_order(MLX4_EN_ALLOC_SIZE)</span>

<span class="cp">#define MLX4_EN_MAX_LRO_DESCRIPTORS	32</span>

<span class="cm">/* Receive fragment sizes; we use at most 4 fragments (for 9600 byte MTU</span>
<span class="cm"> * and 4K allocations) */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">FRAG_SZ0</span> <span class="o">=</span> <span class="mi">512</span> <span class="o">-</span> <span class="n">NET_IP_ALIGN</span><span class="p">,</span>
	<span class="n">FRAG_SZ1</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
	<span class="n">FRAG_SZ2</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
	<span class="n">FRAG_SZ3</span> <span class="o">=</span> <span class="n">MLX4_EN_ALLOC_SIZE</span>
<span class="p">};</span>
<span class="cp">#define MLX4_EN_MAX_RX_FRAGS	4</span>

<span class="cm">/* Maximum ring sizes */</span>
<span class="cp">#define MLX4_EN_MAX_TX_SIZE	8192</span>
<span class="cp">#define MLX4_EN_MAX_RX_SIZE	8192</span>

<span class="cm">/* Minimum ring size for our page-allocation sceme to work */</span>
<span class="cp">#define MLX4_EN_MIN_RX_SIZE	(MLX4_EN_ALLOC_SIZE / SMP_CACHE_BYTES)</span>
<span class="cp">#define MLX4_EN_MIN_TX_SIZE	(4096 / TXBB_SIZE)</span>

<span class="cp">#define MLX4_EN_SMALL_PKT_SIZE		64</span>
<span class="cp">#define MLX4_EN_MAX_TX_RING_P_UP	32</span>
<span class="cp">#define MLX4_EN_NUM_UP			8</span>
<span class="cp">#define MLX4_EN_DEF_TX_RING_SIZE	512</span>
<span class="cp">#define MLX4_EN_DEF_RX_RING_SIZE  	1024</span>

<span class="cm">/* Target number of packets to coalesce with interrupt moderation */</span>
<span class="cp">#define MLX4_EN_RX_COAL_TARGET	44</span>
<span class="cp">#define MLX4_EN_RX_COAL_TIME	0x10</span>

<span class="cp">#define MLX4_EN_TX_COAL_PKTS	16</span>
<span class="cp">#define MLX4_EN_TX_COAL_TIME	0x80</span>

<span class="cp">#define MLX4_EN_RX_RATE_LOW		400000</span>
<span class="cp">#define MLX4_EN_RX_COAL_TIME_LOW	0</span>
<span class="cp">#define MLX4_EN_RX_RATE_HIGH		450000</span>
<span class="cp">#define MLX4_EN_RX_COAL_TIME_HIGH	128</span>
<span class="cp">#define MLX4_EN_RX_SIZE_THRESH		1024</span>
<span class="cp">#define MLX4_EN_RX_RATE_THRESH		(1000000 / MLX4_EN_RX_COAL_TIME_HIGH)</span>
<span class="cp">#define MLX4_EN_SAMPLE_INTERVAL		0</span>
<span class="cp">#define MLX4_EN_AVG_PKT_SMALL		256</span>

<span class="cp">#define MLX4_EN_AUTO_CONF	0xffff</span>

<span class="cp">#define MLX4_EN_DEF_RX_PAUSE	1</span>
<span class="cp">#define MLX4_EN_DEF_TX_PAUSE	1</span>

<span class="cm">/* Interval between successive polls in the Tx routine when polling is used</span>
<span class="cm">   instead of interrupts (in per-core Tx rings) - should be power of 2 */</span>
<span class="cp">#define MLX4_EN_TX_POLL_MODER	16</span>
<span class="cp">#define MLX4_EN_TX_POLL_TIMEOUT	(HZ / 4)</span>

<span class="cp">#define ETH_LLC_SNAP_SIZE	8</span>

<span class="cp">#define SMALL_PACKET_SIZE      (256 - NET_IP_ALIGN)</span>
<span class="cp">#define HEADER_COPY_SIZE       (128 - NET_IP_ALIGN)</span>
<span class="cp">#define MLX4_LOOPBACK_TEST_PAYLOAD (HEADER_COPY_SIZE - ETH_HLEN)</span>

<span class="cp">#define MLX4_EN_MIN_MTU		46</span>
<span class="cp">#define ETH_BCAST		0xffffffffffffULL</span>

<span class="cp">#define MLX4_EN_LOOPBACK_RETRIES	5</span>
<span class="cp">#define MLX4_EN_LOOPBACK_TIMEOUT	100</span>

<span class="cp">#ifdef MLX4_EN_PERF_STAT</span>
<span class="cm">/* Number of samples to &#39;average&#39; */</span>
<span class="cp">#define AVG_SIZE			128</span>
<span class="cp">#define AVG_FACTOR			1024</span>
<span class="cp">#define NUM_PERF_STATS			NUM_PERF_COUNTERS</span>

<span class="cp">#define INC_PERF_COUNTER(cnt)		(++(cnt))</span>
<span class="cp">#define ADD_PERF_COUNTER(cnt, add)	((cnt) += (add))</span>
<span class="cp">#define AVG_PERF_COUNTER(cnt, sample) \</span>
<span class="cp">	((cnt) = ((cnt) * (AVG_SIZE - 1) + (sample) * AVG_FACTOR) / AVG_SIZE)</span>
<span class="cp">#define GET_PERF_COUNTER(cnt)		(cnt)</span>
<span class="cp">#define GET_AVG_PERF_COUNTER(cnt)	((cnt) / AVG_FACTOR)</span>

<span class="cp">#else</span>

<span class="cp">#define NUM_PERF_STATS			0</span>
<span class="cp">#define INC_PERF_COUNTER(cnt)		do {} while (0)</span>
<span class="cp">#define ADD_PERF_COUNTER(cnt, add)	do {} while (0)</span>
<span class="cp">#define AVG_PERF_COUNTER(cnt, sample)	do {} while (0)</span>
<span class="cp">#define GET_PERF_COUNTER(cnt)		(0)</span>
<span class="cp">#define GET_AVG_PERF_COUNTER(cnt)	(0)</span>
<span class="cp">#endif </span><span class="cm">/* MLX4_EN_PERF_STAT */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Configurables</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">cq_type</span> <span class="p">{</span>
	<span class="n">RX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * Useful macros</span>
<span class="cm"> */</span>
<span class="cp">#define ROUNDUP_LOG2(x)		ilog2(roundup_pow_of_two(x))</span>
<span class="cp">#define XNOR(x, y)		(!(x) == !(y))</span>
<span class="cp">#define ILLEGAL_MAC(addr)	(addr == 0xffffffffffffULL || addr == 0x0)</span>


<span class="k">struct</span> <span class="n">mlx4_en_tx_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nr_txbb</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nr_bytes</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">linear</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">data_offset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">inl</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#define MLX4_EN_BIT_DESC_OWN	0x80000000</span>
<span class="cp">#define CTRL_SIZE	sizeof(struct mlx4_wqe_ctrl_seg)</span>
<span class="cp">#define MLX4_EN_MEMTYPE_PAD	0x100</span>
<span class="cp">#define DS_SIZE		sizeof(struct mlx4_wqe_data_seg)</span>


<span class="k">struct</span> <span class="n">mlx4_en_tx_desc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_wqe_ctrl_seg</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">mlx4_wqe_data_seg</span> <span class="n">data</span><span class="p">;</span> <span class="cm">/* at least one data segment */</span>
		<span class="k">struct</span> <span class="n">mlx4_wqe_lso_seg</span> <span class="n">lso</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">mlx4_wqe_inline_seg</span> <span class="n">inl</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="cp">#define MLX4_EN_USE_SRQ		0x01000000</span>

<span class="cp">#define MLX4_EN_CX3_LOW_ID	0x1000</span>
<span class="cp">#define MLX4_EN_CX3_HIGH_ID	0x1005</span>

<span class="k">struct</span> <span class="n">mlx4_en_rx_alloc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">page</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">offset</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_hwq_resources</span> <span class="n">wqres</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size</span> <span class="p">;</span> <span class="cm">/* number of TXBBs */</span>
	<span class="n">u32</span> <span class="n">size_mask</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">stride</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cqn</span><span class="p">;</span>	<span class="cm">/* index of port CQ associated with this ring */</span>
	<span class="n">u32</span> <span class="n">prod</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cons</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">doorbell_qpn</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">poll_cnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">blocked</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_tx_info</span> <span class="o">*</span><span class="n">tx_info</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">bounce_buf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_nr_txbb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="n">qp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="n">context</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">qpn</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="n">qp_state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_srq</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bytes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">packets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_csum</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_bf</span> <span class="n">bf</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bf_enabled</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">netdev_queue</span> <span class="o">*</span><span class="n">tx_queue</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_rx_desc</span> <span class="p">{</span>
	<span class="cm">/* actual number of entries depends on rx ring stride */</span>
	<span class="k">struct</span> <span class="n">mlx4_wqe_data_seg</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_rx_ring</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_hwq_resources</span> <span class="n">wqres</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_rx_alloc</span> <span class="n">page_alloc</span><span class="p">[</span><span class="n">MLX4_EN_MAX_RX_FRAGS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">size</span> <span class="p">;</span>	<span class="cm">/* number of Rx descs*/</span>
	<span class="n">u32</span> <span class="n">actual_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">size_mask</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">stride</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">log_stride</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cqn</span><span class="p">;</span>	<span class="cm">/* index of port CQ associated with this ring */</span>
	<span class="n">u32</span> <span class="n">prod</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cons</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">fcs_del</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">rx_info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bytes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">packets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">csum_ok</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">csum_none</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mlx4_en_can_lro</span><span class="p">(</span><span class="n">__be16</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">cpu_to_be16</span><span class="p">(</span><span class="n">MLX4_CQE_STATUS_IPV4</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_IPV4F</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_IPV6</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_IPV4OPT</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_TCP</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_UDP</span>	<span class="o">|</span>
				     <span class="n">MLX4_CQE_STATUS_IPOK</span><span class="p">))</span> <span class="o">==</span>
		<span class="n">cpu_to_be16</span><span class="p">(</span><span class="n">MLX4_CQE_STATUS_IPV4</span> <span class="o">|</span>
			    <span class="n">MLX4_CQE_STATUS_IPOK</span> <span class="o">|</span>
			    <span class="n">MLX4_CQE_STATUS_TCP</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_cq</span>          <span class="n">mcq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_hwq_resources</span> <span class="n">wqres</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">ring</span><span class="p">;</span>
	<span class="n">spinlock_t</span>              <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">napi_struct</span>	<span class="n">napi</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">vector</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">cq_type</span> <span class="n">is_tx</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">moder_time</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">moder_cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_cqe</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
<span class="cp">#define MLX4_EN_OPCODE_ERROR	0x1e</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_port_profile</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_ring_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_ring_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_ring_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_ring_size</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rx_pause</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rx_ppp</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tx_pause</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tx_ppp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rss_rings</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_profile</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">rss_xor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">udp_rss</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rss_mask</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">active_ports</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">small_pkt_int</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">no_reset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">num_tx_rings_p_up</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_port_profile</span> <span class="n">prof</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_dev</span>         <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>		<span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">state_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>       <span class="o">*</span><span class="n">pndev</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u32</span>                     <span class="n">port_cnt</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">device_up</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_profile</span>  <span class="n">profile</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">LSO_support</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">workqueue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span>           <span class="o">*</span><span class="n">dma_device</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>            <span class="o">*</span><span class="n">uar_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_uar</span>         <span class="n">priv_uar</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mr</span>		<span class="n">mr</span><span class="p">;</span>
	<span class="n">u32</span>                     <span class="n">priv_pdn</span><span class="p">;</span>
	<span class="n">spinlock_t</span>              <span class="n">uar_lock</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">mac_removed</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">mlx4_en_rss_map</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">base_qpn</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="n">qps</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="n">state</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="n">indir_qp</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="n">indir_state</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_port_state</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">link_state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">link_speed</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">transciver</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_pkt_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">broadcast</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_prio</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_prio</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="cp">#define NUM_PKT_STATS		17</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_port_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tso_packets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">queue_stopped</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">wake_queue</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_timeout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_alloc_failed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_chksum_good</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_chksum_none</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_chksum_offload</span><span class="p">;</span>
<span class="cp">#define NUM_PORT_STATS		8</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_perf_stats</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">tx_poll</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tx_pktsz_avg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">inflight_avg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_coal_avg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rx_coal_avg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">napi_quota</span><span class="p">;</span>
<span class="cp">#define NUM_PERF_COUNTERS		6</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_en_frag_info</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">frag_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">frag_prefix_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">frag_stride</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">frag_align</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">last_offset</span><span class="p">;</span>

<span class="p">};</span>

<span class="cp">#ifdef CONFIG_MLX4_EN_DCB</span>
<span class="cm">/* Minimal TC BW - setting to 0 will block traffic */</span>
<span class="cp">#define MLX4_EN_BW_MIN 1</span>
<span class="cp">#define MLX4_EN_BW_MAX 100 </span><span class="cm">/* Utilize 100% of the line */</span><span class="cp"></span>

<span class="cp">#define MLX4_EN_TC_ETS 7</span>

<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_en_dev</span> <span class="o">*</span><span class="n">mdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_port_profile</span> <span class="o">*</span><span class="n">prof</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">active_vlans</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">VLAN_N_VID</span><span class="p">)];</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">ret_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_port_state</span> <span class="n">port_state</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">stats_lock</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_moder_packets</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_moder_tx_packets</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_moder_bytes</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_moder_jiffies</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">last_moder_time</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">rx_usecs</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rx_frames</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_usecs</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_frames</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pkt_rate_low</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rx_usecs_low</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pkt_rate_high</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rx_usecs_high</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sample_interval</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">adaptive_rx_coal</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msg_enable</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">loopback_ok</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">validate_loopback</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_hwq_resources</span> <span class="n">res</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">link_state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">last_link_state</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">port_up</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">registered</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">allocated</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">stride</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mac</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mac_index</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">max_mtu</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">base_qpn</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_en_rss_map</span> <span class="n">rss_map</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">ctrl_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define MLX4_EN_FLAG_PROMISC	0x1</span>
<span class="cp">#define MLX4_EN_FLAG_MC_PROMISC	0x2</span>
	<span class="n">u32</span> <span class="n">tx_ring_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_ring_num</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_skb_size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_frag_info</span> <span class="n">frag_info</span><span class="p">[</span><span class="n">MLX4_EN_MAX_RX_FRAGS</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">num_frags</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">log_rx_info</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_rx_ring</span> <span class="n">rx_ring</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">tx_cq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="n">rx_cq</span><span class="p">[</span><span class="n">MAX_RX_RINGS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">mcast_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">mac_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">watchdog_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">linkstate_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">stats_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_perf_stats</span> <span class="n">pstats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_pkt_stats</span> <span class="n">pkstats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_port_stats</span> <span class="n">port_stats</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">stats_bitmap</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">mc_addrs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mc_addrs_cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_en_stat_out_mbox</span> <span class="n">hw_stats</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vids</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="n">bool</span> <span class="n">wol</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">ddev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">base_tx_qpn</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_MLX4_EN_DCB</span>
	<span class="k">struct</span> <span class="n">ieee_ets</span> <span class="n">ets</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">maxrate</span><span class="p">[</span><span class="n">IEEE_8021QAZ_MAX_TCS</span><span class="p">];</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">mlx4_en_wol</span> <span class="p">{</span>
	<span class="n">MLX4_EN_WOL_MAGIC</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ULL</span> <span class="o">&lt;&lt;</span> <span class="mi">61</span><span class="p">),</span>
	<span class="n">MLX4_EN_WOL_ENABLED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ULL</span> <span class="o">&lt;&lt;</span> <span class="mi">62</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#define MLX4_EN_WOL_DO_MODIFY (1ULL &lt;&lt; 63)</span>

<span class="kt">void</span> <span class="n">mlx4_en_destroy_netdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_init_netdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_dev</span> <span class="o">*</span><span class="n">mdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_en_port_profile</span> <span class="o">*</span><span class="n">prof</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_en_start_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_stop_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_en_free_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_alloc_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_en_create_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span>
		      <span class="kt">int</span> <span class="n">entries</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ring</span><span class="p">,</span> <span class="k">enum</span> <span class="n">cq_type</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_destroy_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_activate_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">cq_idx</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_deactivate_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_set_cq_moder</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_arm_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_en_tx_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_cq</span> <span class="o">*</span><span class="n">mcq</span><span class="p">);</span>
<span class="n">u16</span> <span class="n">mlx4_en_select_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
<span class="n">netdev_tx_t</span> <span class="n">mlx4_en_xmit</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_en_create_tx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="n">qpn</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">,</span> <span class="n">u16</span> <span class="n">stride</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_destroy_tx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_activate_tx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">cq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user_prio</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_deactivate_tx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_en_create_rx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_en_rx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
			   <span class="n">u32</span> <span class="n">size</span><span class="p">,</span> <span class="n">u16</span> <span class="n">stride</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_destroy_rx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_en_rx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="n">size</span><span class="p">,</span> <span class="n">u16</span> <span class="n">stride</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_activate_rx_rings</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_deactivate_rx_ring</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_en_rx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_process_rx_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_en_cq</span> <span class="o">*</span><span class="n">cq</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="n">budget</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_poll_rx_cq</span><span class="p">(</span><span class="k">struct</span> <span class="n">napi_struct</span> <span class="o">*</span><span class="n">napi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">budget</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_fill_qp_context</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">is_tx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rss</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qpn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cqn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user_prio</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_sqp_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_event</span> <span class="n">event</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_map_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_unmap_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_en_calc_rx_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_config_rss_steer</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_release_rss_steer</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_free_tx_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_en_rx_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_cq</span> <span class="o">*</span><span class="n">mcq</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_SET_MCAST_FLTR</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="n">u64</span> <span class="n">mac</span><span class="p">,</span> <span class="n">u64</span> <span class="n">clear</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SET_VLAN_FLTR</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_en_DUMP_ETH_STATS</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_dev</span> <span class="o">*</span><span class="n">mdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reset</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_en_QUERY_PORT</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_en_dev</span> <span class="o">*</span><span class="n">mdev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_MLX4_EN_DCB</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dcbnl_rtnl_ops</span> <span class="n">mlx4_en_dcbnl_ops</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#define MLX4_EN_NUM_SELF_TEST	5</span>
<span class="kt">void</span> <span class="n">mlx4_en_ex_selftest</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="n">u64</span> <span class="n">mlx4_en_mac_to_u64</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Globals</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ethtool_ops</span> <span class="n">mlx4_en_ethtool_ops</span><span class="p">;</span>



<span class="cm">/*</span>
<span class="cm"> * printk / logging functions</span>
<span class="cm"> */</span>

<span class="n">__printf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">int</span> <span class="n">en_print</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">mlx4_en_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
	     <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">format</span><span class="p">,</span> <span class="p">...);</span>

<span class="cp">#define en_dbg(mlevel, priv, format, arg...)			\</span>
<span class="cp">do {								\</span>
<span class="cp">	if (NETIF_MSG_##mlevel &amp; priv-&gt;msg_enable)		\</span>
<span class="cp">		en_print(KERN_DEBUG, priv, format, ##arg);	\</span>
<span class="cp">} while (0)</span>
<span class="cp">#define en_warn(priv, format, arg...)			\</span>
<span class="cp">	en_print(KERN_WARNING, priv, format, ##arg)</span>
<span class="cp">#define en_err(priv, format, arg...)			\</span>
<span class="cp">	en_print(KERN_ERR, priv, format, ##arg)</span>
<span class="cp">#define en_info(priv, format, arg...)			\</span>
<span class="cp">	en_print(KERN_INFO, priv, format, ## arg)</span>

<span class="cp">#define mlx4_err(mdev, format, arg...)			\</span>
<span class="cp">	pr_err(&quot;%s %s: &quot; format, DRV_NAME,		\</span>
<span class="cp">	       dev_name(&amp;mdev-&gt;pdev-&gt;dev), ##arg)</span>
<span class="cp">#define mlx4_info(mdev, format, arg...)			\</span>
<span class="cp">	pr_info(&quot;%s %s: &quot; format, DRV_NAME,		\</span>
<span class="cp">		dev_name(&amp;mdev-&gt;pdev-&gt;dev), ##arg)</span>
<span class="cp">#define mlx4_warn(mdev, format, arg...)			\</span>
<span class="cp">	pr_warning(&quot;%s %s: &quot; format, DRV_NAME,		\</span>
<span class="cp">		   dev_name(&amp;mdev-&gt;pdev-&gt;dev), ##arg)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
