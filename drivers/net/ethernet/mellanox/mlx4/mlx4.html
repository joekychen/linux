<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › mellanox › mlx4 › mlx4.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>mlx4.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004, 2005 Topspin Communications.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Sun Microsystems, Inc. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005, 2006, 2007 Cisco Systems.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005, 2006, 2007, 2008 Mellanox Technologies. All rights reserved.</span>
<span class="cm"> * Copyright (c) 2004 Voltaire, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef MLX4_H</span>
<span class="cp">#define MLX4_H</span>

<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/radix-tree.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/semaphore.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>

<span class="cp">#include &lt;linux/mlx4/device.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/driver.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/doorbell.h&gt;</span>
<span class="cp">#include &lt;linux/mlx4/cmd.h&gt;</span>

<span class="cp">#define DRV_NAME	&quot;mlx4_core&quot;</span>
<span class="cp">#define PFX		DRV_NAME &quot;: &quot;</span>
<span class="cp">#define DRV_VERSION	&quot;1.1&quot;</span>
<span class="cp">#define DRV_RELDATE	&quot;Dec, 2011&quot;</span>

<span class="cp">#define MLX4_NUM_UP		8</span>
<span class="cp">#define MLX4_NUM_TC		8</span>
<span class="cp">#define MLX4_RATELIMIT_UNITS 3 </span><span class="cm">/* 100 Mbps */</span><span class="cp"></span>
<span class="cp">#define MLX4_RATELIMIT_DEFAULT 0xffff</span>

<span class="k">struct</span> <span class="n">mlx4_set_port_prio2tc_context</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">prio2tc</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_port_scheduler_tc_cfg_be</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">pg</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">bw_precentage</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">max_bw_units</span><span class="p">;</span> <span class="cm">/* 3-100Mbps, 4-1Gbps, other values - reserved */</span>
	<span class="n">__be16</span> <span class="n">max_bw_value</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_set_port_scheduler_context</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_port_scheduler_tc_cfg_be</span> <span class="n">tc</span><span class="p">[</span><span class="n">MLX4_NUM_TC</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_HCR_BASE</span>		<span class="o">=</span> <span class="mh">0x80680</span><span class="p">,</span>
	<span class="n">MLX4_HCR_SIZE</span>		<span class="o">=</span> <span class="mh">0x0001c</span><span class="p">,</span>
	<span class="n">MLX4_CLR_INT_SIZE</span>	<span class="o">=</span> <span class="mh">0x00008</span><span class="p">,</span>
	<span class="n">MLX4_SLAVE_COMM_BASE</span>	<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">MLX4_COMM_PAGESIZE</span>	<span class="o">=</span> <span class="mh">0x1000</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_MAX_MGM_ENTRY_SIZE</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
	<span class="n">MLX4_MAX_QP_PER_MGM</span>	<span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">MLX4_MAX_MGM_ENTRY_SIZE</span> <span class="o">/</span> <span class="mi">16</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">MLX4_MTT_ENTRY_PER_SEG</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_NUM_PDS</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_CMPT_TYPE_QP</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_CMPT_TYPE_SRQ</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_CMPT_TYPE_CQ</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MLX4_CMPT_TYPE_EQ</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MLX4_CMPT_NUM_TYPE</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_CMPT_SHIFT</span>		<span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
	<span class="n">MLX4_NUM_CMPTS</span>		<span class="o">=</span> <span class="n">MLX4_CMPT_NUM_TYPE</span> <span class="o">&lt;&lt;</span> <span class="n">MLX4_CMPT_SHIFT</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">mlx4_mr_state</span> <span class="p">{</span>
	<span class="n">MLX4_MR_DISABLED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_MR_EN_HW</span><span class="p">,</span>
	<span class="n">MLX4_MR_EN_SW</span>
<span class="p">};</span>

<span class="cp">#define MLX4_COMM_TIME		10000</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_COMM_CMD_RESET</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_VHCR0</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_VHCR1</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_VHCR2</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_VHCR_EN</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_VHCR_POST</span><span class="p">,</span>
	<span class="n">MLX4_COMM_CMD_FLR</span> <span class="o">=</span> <span class="mi">254</span>
<span class="p">};</span>

<span class="cm">/*The flag indicates that the slave should delay the RESET cmd*/</span>
<span class="cp">#define MLX4_DELAY_RESET_SLAVE 0xbbbbbbb</span>
<span class="cm">/*indicates how many retries will be done if we are in the middle of FLR*/</span>
<span class="cp">#define NUM_OF_RESET_RETRIES	10</span>
<span class="cp">#define SLEEP_TIME_IN_RESET	(2 * 1000)</span>
<span class="k">enum</span> <span class="n">mlx4_resource</span> <span class="p">{</span>
	<span class="n">RES_QP</span><span class="p">,</span>
	<span class="n">RES_CQ</span><span class="p">,</span>
	<span class="n">RES_SRQ</span><span class="p">,</span>
	<span class="n">RES_XRCD</span><span class="p">,</span>
	<span class="n">RES_MPT</span><span class="p">,</span>
	<span class="n">RES_MTT</span><span class="p">,</span>
	<span class="n">RES_MAC</span><span class="p">,</span>
	<span class="n">RES_VLAN</span><span class="p">,</span>
	<span class="n">RES_EQ</span><span class="p">,</span>
	<span class="n">RES_COUNTER</span><span class="p">,</span>
	<span class="n">MLX4_NUM_OF_RESOURCE_TYPE</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">mlx4_alloc_mode</span> <span class="p">{</span>
	<span class="n">RES_OP_RESERVE</span><span class="p">,</span>
	<span class="n">RES_OP_RESERVE_AND_MAP</span><span class="p">,</span>
	<span class="n">RES_OP_MAP_ICM</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">mlx4_res_tracker_free_type</span> <span class="p">{</span>
	<span class="n">RES_TR_FREE_ALL</span><span class="p">,</span>
	<span class="n">RES_TR_FREE_SLAVES_ONLY</span><span class="p">,</span>
	<span class="n">RES_TR_FREE_STRUCTS_ONLY</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *Virtual HCR structures.</span>
<span class="cm"> * mlx4_vhcr is the sw representation, in machine endianess</span>
<span class="cm"> *</span>
<span class="cm"> * mlx4_vhcr_cmd is the formalized structure, the one that is passed</span>
<span class="cm"> * to FW to go through communication channel.</span>
<span class="cm"> * It is big endian, and has the same structure as the physical HCR</span>
<span class="cm"> * used by command interface</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">in_param</span><span class="p">;</span>
	<span class="n">u64</span>	<span class="n">out_param</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">in_modifier</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">errno</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">op</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">token</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">op_modifier</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">e_bit</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_vhcr_cmd</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">in_param</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">in_modifier</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">out_param</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">token</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">opcode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">opcode</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">has_inbox</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">has_outbox</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">out_is_imm</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">encode_slave_id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">verify</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wrapper</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_MLX4_DEBUG</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mlx4_debug_level</span><span class="p">;</span>
<span class="cp">#else </span><span class="cm">/* CONFIG_MLX4_DEBUG */</span><span class="cp"></span>
<span class="cp">#define mlx4_debug_level	(0)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_MLX4_DEBUG */</span><span class="cp"></span>

<span class="cp">#define mlx4_dbg(mdev, format, arg...)					\</span>
<span class="cp">do {									\</span>
<span class="cp">	if (mlx4_debug_level)						\</span>
<span class="cp">		dev_printk(KERN_DEBUG, &amp;mdev-&gt;pdev-&gt;dev, format, ##arg); \</span>
<span class="cp">} while (0)</span>

<span class="cp">#define mlx4_err(mdev, format, arg...) \</span>
<span class="cp">	dev_err(&amp;mdev-&gt;pdev-&gt;dev, format, ##arg)</span>
<span class="cp">#define mlx4_info(mdev, format, arg...) \</span>
<span class="cp">	dev_info(&amp;mdev-&gt;pdev-&gt;dev, format, ##arg)</span>
<span class="cp">#define mlx4_warn(mdev, format, arg...) \</span>
<span class="cp">	dev_warn(&amp;mdev-&gt;pdev-&gt;dev, format, ##arg)</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">mlx4_log_num_mgm_entry_size</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">log_mtts_per_seg</span><span class="p">;</span>

<span class="cp">#define MLX4_MAX_NUM_SLAVES	(MLX4_MAX_NUM_PF + MLX4_MAX_NUM_VF)</span>
<span class="cp">#define ALL_SLAVES 0xff</span>

<span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">last</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">top</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">max</span><span class="p">;</span>
	<span class="n">u32</span>                     <span class="n">reserved_top</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">mask</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">avail</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	       <span class="o">*</span><span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_buddy</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	      <span class="o">**</span><span class="n">bits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	       <span class="o">*</span><span class="n">num_free</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">max_order</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_icm</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">mlx4_icm_table</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">virt</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_icm</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_obj</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">obj_size</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lowmem</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">coherent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm</span>	      <span class="o">**</span><span class="n">icm</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Must be packed because mtt_seg is 64 bits but only aligned to 32 bits.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mlx4_mpt_entry</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">qpn</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">key</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">pd_flags</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">lkey</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">win_cnt</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">mtt_rep</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">mtt_addr</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">mtt_sz</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">entity_size</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">first_byte_offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Must be packed because start is 64 bits but only aligned to 32 bits.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mlx4_eq_context</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">reserved1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__be16</span>			<span class="n">page_offset</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">log_eq_size</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">eq_period</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved3</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">eq_max_count</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved4</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">intr</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">log_page_size</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved5</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">mtt_base_addr_h</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mtt_base_addr_l</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved6</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">consumer_index</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">producer_index</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved7</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_cq_context</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">reserved1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__be16</span>			<span class="n">page_offset</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">logsize_usrpage</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">cq_period</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">cq_max_count</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">comp_eqn</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">log_page_size</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">mtt_base_addr_h</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mtt_base_addr_l</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">last_notified_index</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">solicit_producer_index</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">consumer_index</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">producer_index</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be64</span>			<span class="n">db_rec_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_srq_context</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">state_logsize_srqn</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">logstride</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">xrcd</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">pg_offset_cqn</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved2</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">log_page_size</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">mtt_base_addr_h</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mtt_base_addr_l</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">pd</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">limit_watermark</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">wqe_cnt</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">reserved4</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">wqe_counter</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved5</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">db_rec_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_eqe</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved2</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">subtype</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u32</span>		<span class="n">raw</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be32</span>	<span class="n">cqn</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">comp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u16</span>	<span class="n">reserved1</span><span class="p">;</span>
			<span class="n">__be16</span>	<span class="n">token</span><span class="p">;</span>
			<span class="n">u32</span>	<span class="n">reserved2</span><span class="p">;</span>
			<span class="n">u8</span>	<span class="n">reserved3</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">u8</span>	<span class="n">status</span><span class="p">;</span>
			<span class="n">__be64</span>	<span class="n">out_param</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">cmd</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be32</span>	<span class="n">qpn</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">qp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be32</span>	<span class="n">srqn</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">srq</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be32</span>	<span class="n">cqn</span><span class="p">;</span>
			<span class="n">u32</span>	<span class="n">reserved1</span><span class="p">;</span>
			<span class="n">u8</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">u8</span>	<span class="n">syndrome</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">cq_err</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">__be32</span>	<span class="n">port</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">port_change</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="cp">#define COMM_CHANNEL_BIT_ARRAY_SIZE	4</span>
			<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">bit_vec</span><span class="p">[</span><span class="n">COMM_CHANNEL_BIT_ARRAY_SIZE</span><span class="p">];</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">comm_channel_arm</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span>	<span class="n">port</span><span class="p">;</span>
			<span class="n">u8</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">__be64</span>	<span class="n">mac</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">mac_update</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span>	<span class="n">port</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">sw_event</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be32</span>	<span class="n">slave_id</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">flr_event</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">__be16</span>  <span class="n">current_temperature</span><span class="p">;</span>
			<span class="n">__be16</span>  <span class="n">warning_threshold</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span> <span class="n">warming</span><span class="p">;</span>
	<span class="p">}</span>			<span class="n">event</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">slave_id</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">owner</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">mlx4_eq</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_dev</span>	       <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">doorbell</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">eqn</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">cons_index</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">irq</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">have_irq</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">nent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_buf_list</span>   <span class="o">*</span><span class="n">page_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mtt</span>		<span class="n">mtt</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_slave_eqe</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">port</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">param</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_slave_event_eq_info</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">eqn</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">token</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_profile</span> <span class="p">{</span>
	<span class="kt">int</span>			<span class="n">num_qp</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">rdmarc_per_qp</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_srq</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_cq</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_mcg</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_mpt</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">num_mtt</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_fw</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">clr_int_base</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">catas_offset</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">comm_base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm</span>	       <span class="o">*</span><span class="n">fw_icm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm</span>	       <span class="o">*</span><span class="n">aux_icm</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">catas_size</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">fw_pages</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">clr_int_bar</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">catas_bar</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">comm_bar</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_comm</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">slave_write</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">slave_read</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_MCAST_CONFIG</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_MCAST_DISABLE</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_MCAST_ENABLE</span>       <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define VLAN_FLTR_SIZE	128</span>

<span class="k">struct</span> <span class="n">mlx4_vlan_fltr</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">entry</span><span class="p">[</span><span class="n">VLAN_FLTR_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mcast_entry</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_promisc_qp</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">qpn</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_steer_index</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">duplicates</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MLX4_EVENT_TYPES_NUM 64</span>

<span class="k">struct</span> <span class="n">mlx4_slave_state</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">comm_toggle</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">last_cmd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">init_port_mask</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">active</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">function</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">vhcr_dma</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">mtu</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="n">ib_cap_mask</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_slave_eqe</span> <span class="n">eq</span><span class="p">[</span><span class="n">MLX4_MFUNC_MAX_EQES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">mcast_filters</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_vlan_fltr</span> <span class="o">*</span><span class="n">vlan_filter</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="cm">/* event type to eq number lookup */</span>
	<span class="k">struct</span> <span class="n">mlx4_slave_event_eq_info</span> <span class="n">event_eq</span><span class="p">[</span><span class="n">MLX4_EVENT_TYPES_NUM</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">eq_pi</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">eq_ci</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="cm">/*initialized via the kzalloc*/</span>
	<span class="n">u8</span> <span class="n">is_slave_going_down</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cookie</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">slave_list</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">res_list</span><span class="p">[</span><span class="n">MLX4_NUM_OF_RESOURCE_TYPE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_resource_tracker</span> <span class="p">{</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="cm">/* tree for each resources */</span>
	<span class="k">struct</span> <span class="n">radix_tree_root</span> <span class="n">res_tree</span><span class="p">[</span><span class="n">MLX4_NUM_OF_RESOURCE_TYPE</span><span class="p">];</span>
	<span class="cm">/* num_of_slave&#39;s lists, one per slave */</span>
	<span class="k">struct</span> <span class="n">slave_list</span> <span class="o">*</span><span class="n">slave_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLAVE_EVENT_EQ_SIZE	128</span>
<span class="k">struct</span> <span class="n">mlx4_slave_event_eq</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">eqn</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cons</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">prod</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_eqe</span> <span class="n">event_eqe</span><span class="p">[</span><span class="n">SLAVE_EVENT_EQ_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_master_qp0_state</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">proxy_qp0_active</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">qp0_active</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">port_active</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mfunc_master_ctx</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_slave_state</span> <span class="o">*</span><span class="n">slave_state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_master_qp0_state</span> <span class="n">qp0_state</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="kt">int</span>			<span class="n">init_port_ref</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u16</span>			<span class="n">max_mtu</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="kt">int</span>			<span class="n">disable_mcast_ref</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_resource_tracker</span> <span class="n">res_tracker</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">comm_wq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">comm_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">slave_event_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">slave_flr_event_work</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">slave_state_lock</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">comm_arm_bit_vector</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_eqe</span>		<span class="n">cmd_eqe</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_slave_event_eq</span> <span class="n">slave_eq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">gen_eqe_mutex</span><span class="p">[</span><span class="n">MLX4_MFUNC_MAX</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mfunc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_comm</span> <span class="n">__iomem</span>       <span class="o">*</span><span class="n">comm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_vhcr_cmd</span>	       <span class="o">*</span><span class="n">vhcr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>			<span class="n">vhcr_dma</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_mfunc_master_ctx</span>	<span class="n">master</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_cmd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_pool</span>	       <span class="o">*</span><span class="n">pool</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">hcr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">hcr_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>	<span class="n">poll_sem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>	<span class="n">event_sem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>	<span class="n">slave_sem</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">max_cmds</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">context_lock</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">free_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_cmd_context</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">token_mask</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">use_events</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">toggle</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">comm_toggle</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_uar_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mr_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">mpt_bitmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_buddy</span>	<span class="n">mtt_buddy</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">mtt_base</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">mpt_base</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">mtt_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">dmpt_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_cq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">radix_tree_root</span>	<span class="n">tree</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">cmpt_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_eq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
	<span class="kt">char</span>		       <span class="o">*</span><span class="n">irq_names</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">clr_int</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	      <span class="o">**</span><span class="n">uar_map</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">clr_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_eq</span>	       <span class="o">*</span><span class="n">eq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">cmpt_table</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">have_irq</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">inta_pin</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_srq_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">radix_tree_root</span>	<span class="n">tree</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">cmpt_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_qp_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">rdmarc_base</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">rdmarc_shift</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">qp_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">auxc_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">altc_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">rdmarc_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">cmpt_table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mcg_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">bitmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_icm_table</span>	<span class="n">table</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_catas_err</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MLX4_MAX_MAC_NUM	128</span>
<span class="cp">#define MLX4_MAC_TABLE_SIZE	(MLX4_MAX_MAC_NUM &lt;&lt; 3)</span>

<span class="k">struct</span> <span class="n">mlx4_mac_table</span> <span class="p">{</span>
	<span class="n">__be64</span>			<span class="n">entries</span><span class="p">[</span><span class="n">MLX4_MAX_MAC_NUM</span><span class="p">];</span>
	<span class="kt">int</span>			<span class="n">refs</span><span class="p">[</span><span class="n">MLX4_MAX_MAC_NUM</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">mutex</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">total</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">max</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MLX4_MAX_VLAN_NUM	128</span>
<span class="cp">#define MLX4_VLAN_TABLE_SIZE	(MLX4_MAX_VLAN_NUM &lt;&lt; 2)</span>

<span class="k">struct</span> <span class="n">mlx4_vlan_table</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">entries</span><span class="p">[</span><span class="n">MLX4_MAX_VLAN_NUM</span><span class="p">];</span>
	<span class="kt">int</span>			<span class="n">refs</span><span class="p">[</span><span class="n">MLX4_MAX_VLAN_NUM</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">mutex</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">total</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">max</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SET_PORT_GEN_ALL_VALID		0x7</span>
<span class="cp">#define SET_PORT_PROMISC_SHIFT		31</span>
<span class="cp">#define SET_PORT_MC_PROMISC_SHIFT	30</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MCAST_DIRECT_ONLY</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MCAST_DIRECT</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MCAST_DEFAULT</span>		<span class="o">=</span> <span class="mi">2</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">mlx4_set_port_general_context</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">mtu</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pptx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pfctx</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pprx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pfcrx</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reserved4</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_set_port_rqp_calc_context</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">base_qpn</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rererved</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">n_mac</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">n_vlan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">n_prio</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">mac_miss</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">intra_no_vlan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">no_vlan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">intra_vlan_miss</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">vlan_miss</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved3</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">no_vlan_prio</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">promisc</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">mcast</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_mac_entry</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">mac</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_port_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_dev</span>	       <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">port</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="n">dev_name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">device_attribute</span> <span class="n">port_attr</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">mlx4_port_type</span>	<span class="n">tmp_type</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="n">dev_mtu_name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">device_attribute</span> <span class="n">port_mtu_attr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mac_table</span>	<span class="n">mac_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">radix_tree_root</span>	<span class="n">mac_tree</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_vlan_table</span>	<span class="n">vlan_table</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">base_qpn</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_sense</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_dev</span>		<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">do_sense_port</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">sense_allowed</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">delayed_work</span>	<span class="n">sense_poll</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_msix_ctl</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">pool_bm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>	<span class="n">pool_lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_steer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">promisc_qps</span><span class="p">[</span><span class="n">MLX4_NUM_STEERS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">steer_entries</span><span class="p">[</span><span class="n">MLX4_NUM_STEERS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mlx4_dev</span>		<span class="n">dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">dev_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ctx_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">ctx_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>        <span class="n">pgdir_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>            <span class="n">pgdir_mutex</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_fw</span>		<span class="n">fw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_cmd</span>		<span class="n">cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mfunc</span>	<span class="n">mfunc</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">pd_bitmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">xrcd_bitmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_uar_table</span>	<span class="n">uar_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mr_table</span>	<span class="n">mr_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_cq_table</span>	<span class="n">cq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_eq_table</span>	<span class="n">eq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_srq_table</span>	<span class="n">srq_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_qp_table</span>	<span class="n">qp_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_mcg_table</span>	<span class="n">mcg_table</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_bitmap</span>	<span class="n">counters_bitmap</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_catas_err</span>	<span class="n">catas_err</span><span class="p">;</span>

	<span class="kt">void</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">clr_base</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mlx4_uar</span>		<span class="n">driver_uar</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	       <span class="o">*</span><span class="n">kar</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_port_info</span>	<span class="n">port</span><span class="p">[</span><span class="n">MLX4_MAX_PORTS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mlx4_sense</span>       <span class="n">sense</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">port_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_msix_ctl</span>	<span class="n">msix_ctl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mlx4_steer</span>	<span class="o">*</span><span class="n">steer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">bf_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">bf_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">io_mapping</span>	<span class="o">*</span><span class="n">bf_mapping</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">reserved_mtts</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mlx4_priv</span> <span class="o">*</span><span class="nf">mlx4_priv</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_priv</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define MLX4_SENSE_RANGE	(HZ * 3)</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">mlx4_wq</span><span class="p">;</span>

<span class="n">u32</span> <span class="n">mlx4_bitmap_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_bitmap_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">u32</span> <span class="n">obj</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">mlx4_bitmap_alloc_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">align</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_bitmap_free_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">u32</span> <span class="n">obj</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">mlx4_bitmap_avail</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_bitmap_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">u32</span> <span class="n">num</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
		     <span class="n">u32</span> <span class="n">reserved_bot</span><span class="p">,</span> <span class="n">u32</span> <span class="n">resetrved_top</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_bitmap_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_bitmap</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_alloc_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_free_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_init_pd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_xrcd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_uar_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_mr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_cq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_qp_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_srq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_mcg_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_cleanup_pd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_xrcd_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_uar_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_mr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_eq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_cq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_qp_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_srq_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cleanup_mcg_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_qp_alloc_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qpn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_qp_free_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qpn</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_cq_alloc_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">cqn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_cq_free_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cqn</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_srq_alloc_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">srqn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_srq_free_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">srqn</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_mr_reserve</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_mr_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">index</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_mr_alloc_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">index</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_mr_free_icm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">index</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">__mlx4_alloc_mtt_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">order</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_free_mtt_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">first_seg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">order</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_WRITE_MTT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SYNC_TPT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SW2HW_MPT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_HW2SW_MPT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_MPT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SW2HW_EQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_DMA_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_qp_reserve_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">align</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="o">*</span><span class="n">base</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_qp_release_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">base_qpn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_register_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="n">u64</span> <span class="n">mac</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_unregister_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="n">u64</span> <span class="n">mac</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_replace_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qpn</span><span class="p">,</span> <span class="n">u64</span> <span class="n">new_mac</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_write_mtt</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_mtt</span> <span class="o">*</span><span class="n">mtt</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">start_index</span><span class="p">,</span> <span class="kt">int</span> <span class="n">npages</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">page_list</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_counter_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">idx</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_counter_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">idx</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__mlx4_xrcd_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">xrcdn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__mlx4_xrcd_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">xrcdn</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_start_catas_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_stop_catas_poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_catas_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_restart_one</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_register_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_unregister_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_dispatch_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_dev_event</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">mlx4_dev_cap</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">mlx4_init_hca_param</span><span class="p">;</span>

<span class="n">u64</span> <span class="n">mlx4_make_profile</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">mlx4_profile</span> <span class="o">*</span><span class="n">request</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">mlx4_dev_cap</span> <span class="o">*</span><span class="n">dev_cap</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">mlx4_init_hca_param</span> <span class="o">*</span><span class="n">init_hca</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_master_comm_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_gen_slave_eqe</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_master_handle_slave_flr</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_ALLOC_RES_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_FREE_RES_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_MAP_EQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_COMM_INT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_HW2SW_EQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_EQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SW2HW_CQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_HW2SW_CQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_CQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_MODIFY_CQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SW2HW_SRQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_HW2SW_SRQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_SRQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_ARM_SRQ_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_GEN_QP_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_RST2INIT_QP_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_INIT2RTR_QP_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_2RST_QP_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_GEN_EQE</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_eqe</span> <span class="o">*</span><span class="n">eqe</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_cmd_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cmd_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_multi_func_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_multi_func_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cmd_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">token</span><span class="p">,</span> <span class="n">u8</span> <span class="n">status</span><span class="p">,</span> <span class="n">u64</span> <span class="n">out_param</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_cmd_use_events</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cmd_use_polling</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_comm_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">param</span><span class="p">,</span>
		  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeout</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_cq_completion</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cqn</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_cq_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cqn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event_type</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_qp_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">qpn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event_type</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_srq_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">srqn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event_type</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_handle_catas_err</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_SENSE_PORT</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
		    <span class="k">enum</span> <span class="n">mlx4_port_type</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_do_sense_ports</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			 <span class="k">enum</span> <span class="n">mlx4_port_type</span> <span class="o">*</span><span class="n">stype</span><span class="p">,</span>
			 <span class="k">enum</span> <span class="n">mlx4_port_type</span> <span class="o">*</span><span class="n">defaults</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_start_sense</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_stop_sense</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_sense_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_check_port_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			   <span class="k">enum</span> <span class="n">mlx4_port_type</span> <span class="o">*</span><span class="n">port_type</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_change_port_types</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			   <span class="k">enum</span> <span class="n">mlx4_port_type</span> <span class="o">*</span><span class="n">port_types</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_init_mac_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_mac_table</span> <span class="o">*</span><span class="n">table</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_init_vlan_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_vlan_table</span> <span class="o">*</span><span class="n">table</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_SET_PORT</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">);</span>
<span class="cm">/* resource tracker functions*/</span>
<span class="kt">int</span> <span class="n">mlx4_get_slave_from_resource_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				    <span class="k">enum</span> <span class="n">mlx4_resource</span> <span class="n">resource_type</span><span class="p">,</span>
				    <span class="kt">int</span> <span class="n">resource_id</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">slave</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mlx4_delete_all_resources_for_slave</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave_id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_init_resource_tracker</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">mlx4_free_resource_tracker</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">mlx4_res_tracker_free_type</span> <span class="n">type</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_QUERY_FW_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SET_PORT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_INIT_PORT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_CLOSE_PORT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_DEV_CAP_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_PORT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_get_port_ib_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">caps</span><span class="p">);</span>


<span class="kt">int</span> <span class="n">mlx4_QP_ATTACH_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_PROMISC_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_qp_detach_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">gid</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
			  <span class="k">enum</span> <span class="n">mlx4_protocol</span> <span class="n">prot</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_steer_type</span> <span class="n">steer</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_qp_attach_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">gid</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span>
			  <span class="kt">int</span> <span class="n">block_mcast_loopback</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_protocol</span> <span class="n">prot</span><span class="p">,</span>
			  <span class="k">enum</span> <span class="n">mlx4_steer_type</span> <span class="n">steer</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SET_MCAST_FLTR_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_SET_VLAN_FLTR_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_common_set_vlan_fltr</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">function</span><span class="p">,</span>
				     <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_common_dump_eth_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span> <span class="n">u32</span> <span class="n">in_mod</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_DUMP_ETH_STATS_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_PKEY_TABLE_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_QUERY_IF_STAT_wrapper</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slave</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_vhcr</span> <span class="o">*</span><span class="n">vhcr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">inbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_mailbox</span> <span class="o">*</span><span class="n">outbox</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mlx4_cmd_info</span> <span class="o">*</span><span class="n">cmd</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_get_mgm_entry_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">mlx4_get_qp_per_mgm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_param_l</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">)</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_param_h</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">arg</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">arg</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">u64</span><span class="p">)</span> <span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">get_param_l</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">arg</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">get_param_h</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u32</span><span class="p">)(</span><span class="o">*</span><span class="n">arg</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">spinlock_t</span> <span class="o">*</span><span class="nf">mlx4_tlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">mlx4_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">mfunc</span><span class="p">.</span><span class="n">master</span><span class="p">.</span><span class="n">res_tracker</span><span class="p">.</span><span class="n">lock</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define NOT_MASKED_PD_BITS 17</span>

<span class="cp">#endif </span><span class="cm">/* MLX4_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
