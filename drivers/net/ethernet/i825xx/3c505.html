<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › i825xx › 3c505.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>3c505.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*****************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> *  defines for 3Com Etherlink Plus adapter</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************/</span>

<span class="cp">#define ELP_DMA       6</span>
<span class="cp">#define ELP_RX_PCBS   4</span>
<span class="cp">#define ELP_MAX_CARDS 4</span>

<span class="cm">/*</span>
<span class="cm"> * I/O register offsets</span>
<span class="cm"> */</span>
<span class="cp">#define	PORT_COMMAND	0x00	</span><span class="cm">/* read/write, 8-bit */</span><span class="cp"></span>
<span class="cp">#define	PORT_STATUS	0x02	</span><span class="cm">/* read only, 8-bit */</span><span class="cp"></span>
<span class="cp">#define	PORT_AUXDMA	0x02	</span><span class="cm">/* write only, 8-bit */</span><span class="cp"></span>
<span class="cp">#define	PORT_DATA	0x04	</span><span class="cm">/* read/write, 16-bit */</span><span class="cp"></span>
<span class="cp">#define	PORT_CONTROL	0x06	</span><span class="cm">/* read/write, 8-bit */</span><span class="cp"></span>

<span class="cp">#define ELP_IO_EXTENT	0x10	</span><span class="cm">/* size of used IO registers */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * host control registers bits</span>
<span class="cm"> */</span>
<span class="cp">#define	ATTN	0x80	</span><span class="cm">/* attention */</span><span class="cp"></span>
<span class="cp">#define	FLSH	0x40	</span><span class="cm">/* flush data register */</span><span class="cp"></span>
<span class="cp">#define DMAE	0x20	</span><span class="cm">/* DMA enable */</span><span class="cp"></span>
<span class="cp">#define DIR	0x10	</span><span class="cm">/* direction */</span><span class="cp"></span>
<span class="cp">#define	TCEN	0x08	</span><span class="cm">/* terminal count interrupt enable */</span><span class="cp"></span>
<span class="cp">#define	CMDE	0x04	</span><span class="cm">/* command register interrupt enable */</span><span class="cp"></span>
<span class="cp">#define	HSF2	0x02	</span><span class="cm">/* host status flag 2 */</span><span class="cp"></span>
<span class="cp">#define	HSF1	0x01	</span><span class="cm">/* host status flag 1 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * combinations of HSF flags used for PCB transmission</span>
<span class="cm"> */</span>
<span class="cp">#define	HSF_PCB_ACK	HSF1</span>
<span class="cp">#define	HSF_PCB_NAK	HSF2</span>
<span class="cp">#define	HSF_PCB_END	(HSF2|HSF1)</span>
<span class="cp">#define	HSF_PCB_MASK	(HSF2|HSF1)</span>

<span class="cm">/*</span>
<span class="cm"> * host status register bits</span>
<span class="cm"> */</span>
<span class="cp">#define	HRDY	0x80	</span><span class="cm">/* data register ready */</span><span class="cp"></span>
<span class="cp">#define	HCRE	0x40	</span><span class="cm">/* command register empty */</span><span class="cp"></span>
<span class="cp">#define	ACRF	0x20	</span><span class="cm">/* adapter command register full */</span><span class="cp"></span>
<span class="cm">/* #define DIR 	0x10	direction - same as in control register */</span>
<span class="cp">#define	DONE	0x08	</span><span class="cm">/* DMA done */</span><span class="cp"></span>
<span class="cp">#define	ASF3	0x04	</span><span class="cm">/* adapter status flag 3 */</span><span class="cp"></span>
<span class="cp">#define	ASF2	0x02	</span><span class="cm">/* adapter status flag 2 */</span><span class="cp"></span>
<span class="cp">#define	ASF1	0x01	</span><span class="cm">/* adapter status flag 1 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * combinations of ASF flags used for PCB reception</span>
<span class="cm"> */</span>
<span class="cp">#define	ASF_PCB_ACK	ASF1</span>
<span class="cp">#define	ASF_PCB_NAK	ASF2</span>
<span class="cp">#define	ASF_PCB_END	(ASF2|ASF1)</span>
<span class="cp">#define	ASF_PCB_MASK	(ASF2|ASF1)</span>

<span class="cm">/*</span>
<span class="cm"> * host aux DMA register bits</span>
<span class="cm"> */</span>
<span class="cp">#define	DMA_BRST	0x01	</span><span class="cm">/* DMA burst */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * maximum amount of data allowed in a PCB</span>
<span class="cm"> */</span>
<span class="cp">#define	MAX_PCB_DATA	62</span>

<span class="cm">/*****************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> *  timeout value</span>
<span class="cm"> *	this is a rough value used for loops to stop them from</span>
<span class="cm"> *	locking up the whole machine in the case of failure or</span>
<span class="cm"> *	error conditions</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************/</span>

<span class="cp">#define	TIMEOUT	300</span>

<span class="cm">/*****************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * PCB commands</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************/</span>

<span class="k">enum</span> <span class="p">{</span>
  <span class="cm">/*</span>
<span class="cm">   * host PCB commands</span>
<span class="cm">   */</span>
  <span class="n">CMD_CONFIGURE_ADAPTER_MEMORY</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
  <span class="n">CMD_CONFIGURE_82586</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
  <span class="n">CMD_STATION_ADDRESS</span>		<span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
  <span class="n">CMD_DMA_DOWNLOAD</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
  <span class="n">CMD_DMA_UPLOAD</span>		<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
  <span class="n">CMD_PIO_DOWNLOAD</span>		<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
  <span class="n">CMD_PIO_UPLOAD</span>		<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
  <span class="n">CMD_RECEIVE_PACKET</span>		<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
  <span class="n">CMD_TRANSMIT_PACKET</span>		<span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
  <span class="n">CMD_NETWORK_STATISTICS</span>	<span class="o">=</span> <span class="mh">0x0a</span><span class="p">,</span>
  <span class="n">CMD_LOAD_MULTICAST_LIST</span>	<span class="o">=</span> <span class="mh">0x0b</span><span class="p">,</span>
  <span class="n">CMD_CLEAR_PROGRAM</span>		<span class="o">=</span> <span class="mh">0x0c</span><span class="p">,</span>
  <span class="n">CMD_DOWNLOAD_PROGRAM</span>		<span class="o">=</span> <span class="mh">0x0d</span><span class="p">,</span>
  <span class="n">CMD_EXECUTE_PROGRAM</span>		<span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
  <span class="n">CMD_SELF_TEST</span>			<span class="o">=</span> <span class="mh">0x0f</span><span class="p">,</span>
  <span class="n">CMD_SET_STATION_ADDRESS</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
  <span class="n">CMD_ADAPTER_INFO</span>		<span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
  <span class="n">NUM_TRANSMIT_CMDS</span><span class="p">,</span>

  <span class="cm">/*</span>
<span class="cm">   * adapter PCB commands</span>
<span class="cm">   */</span>
  <span class="n">CMD_CONFIGURE_ADAPTER_RESPONSE</span>	<span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
  <span class="n">CMD_CONFIGURE_82586_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x32</span><span class="p">,</span>
  <span class="n">CMD_ADDRESS_RESPONSE</span>			<span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>
  <span class="n">CMD_DOWNLOAD_DATA_REQUEST</span>		<span class="o">=</span> <span class="mh">0x34</span><span class="p">,</span>
  <span class="n">CMD_UPLOAD_DATA_REQUEST</span>		<span class="o">=</span> <span class="mh">0x35</span><span class="p">,</span>
  <span class="n">CMD_RECEIVE_PACKET_COMPLETE</span>		<span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>
  <span class="n">CMD_TRANSMIT_PACKET_COMPLETE</span>		<span class="o">=</span> <span class="mh">0x39</span><span class="p">,</span>
  <span class="n">CMD_NETWORK_STATISTICS_RESPONSE</span>	<span class="o">=</span> <span class="mh">0x3a</span><span class="p">,</span>
  <span class="n">CMD_LOAD_MULTICAST_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x3b</span><span class="p">,</span>
  <span class="n">CMD_CLEAR_PROGRAM_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x3c</span><span class="p">,</span>
  <span class="n">CMD_DOWNLOAD_PROGRAM_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x3d</span><span class="p">,</span>
  <span class="n">CMD_EXECUTE_RESPONSE</span>			<span class="o">=</span> <span class="mh">0x3e</span><span class="p">,</span>
  <span class="n">CMD_SELF_TEST_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x3f</span><span class="p">,</span>
  <span class="n">CMD_SET_ADDRESS_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
  <span class="n">CMD_ADAPTER_INFO_RESPONSE</span>		<span class="o">=</span> <span class="mh">0x41</span>
<span class="p">};</span>

<span class="cm">/* Definitions for the PCB data structure */</span>

<span class="cm">/* Data units */</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">byte</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="kt">int</span>    <span class="n">word</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">int</span>     <span class="n">dword</span><span class="p">;</span>

<span class="cm">/* Data structures */</span>
<span class="k">struct</span> <span class="n">Memconf</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">cmd_q</span><span class="p">,</span>
		<span class="n">rcv_q</span><span class="p">,</span>
		<span class="n">mcast</span><span class="p">,</span>
		<span class="n">frame</span><span class="p">,</span>
		<span class="n">rcv_b</span><span class="p">,</span>
		<span class="n">progs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Rcv_pkt</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">buf_ofs</span><span class="p">,</span>
		<span class="n">buf_seg</span><span class="p">,</span>
		<span class="n">buf_len</span><span class="p">,</span>
		<span class="n">timeout</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Xmit_pkt</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">buf_ofs</span><span class="p">,</span>
		<span class="n">buf_seg</span><span class="p">,</span>
		<span class="n">pkt_len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Rcv_resp</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">buf_ofs</span><span class="p">,</span>
		<span class="n">buf_seg</span><span class="p">,</span>
		<span class="n">buf_len</span><span class="p">,</span>
		<span class="n">pkt_len</span><span class="p">,</span>
		<span class="n">timeout</span><span class="p">,</span>
		<span class="n">status</span><span class="p">;</span>
	<span class="n">dword</span>	<span class="n">timetag</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Xmit_resp</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">buf_ofs</span><span class="p">,</span>
		<span class="n">buf_seg</span><span class="p">,</span>
		<span class="n">c_stat</span><span class="p">,</span>
		<span class="n">status</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Netstat</span> <span class="p">{</span>
	<span class="n">dword</span>	<span class="n">tot_recv</span><span class="p">,</span>
		<span class="n">tot_xmit</span><span class="p">;</span>
	<span class="n">word</span>	<span class="n">err_CRC</span><span class="p">,</span>
		<span class="n">err_align</span><span class="p">,</span>
		<span class="n">err_res</span><span class="p">,</span>
		<span class="n">err_ovrrun</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Selftest</span> <span class="p">{</span>
	<span class="n">word</span>	<span class="n">error</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">word</span> <span class="n">ROM_cksum</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">word</span> <span class="n">ofs</span><span class="p">,</span> <span class="n">seg</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">RAM</span><span class="p">;</span>
		<span class="n">word</span> <span class="n">i82586</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">failure</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Info</span> <span class="p">{</span>
	<span class="n">byte</span>	<span class="n">minor_vers</span><span class="p">,</span>
		<span class="n">major_vers</span><span class="p">;</span>
	<span class="n">word</span>	<span class="n">ROM_cksum</span><span class="p">,</span>
		<span class="n">RAM_sz</span><span class="p">,</span>
		<span class="n">free_ofs</span><span class="p">,</span>
		<span class="n">free_seg</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Memdump</span> <span class="p">{</span>
       <span class="n">word</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">off</span><span class="p">,</span>
            <span class="n">seg</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm">Primary Command Block. The most important data structure. All communication</span>
<span class="cm">between the host and the adapter is done with these. (Except for the actual</span>
<span class="cm">Ethernet data, which has different packaging.)</span>
<span class="cm">*/</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">byte</span>	<span class="n">command</span><span class="p">;</span>
	<span class="n">byte</span>	<span class="n">length</span><span class="p">;</span>
	<span class="k">union</span>	<span class="p">{</span>
		<span class="k">struct</span> <span class="n">Memconf</span>		<span class="n">memconf</span><span class="p">;</span>
		<span class="n">word</span>			<span class="n">configure</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Rcv_pkt</span>		<span class="n">rcv_pkt</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Xmit_pkt</span>		<span class="n">xmit_pkt</span><span class="p">;</span>
		<span class="n">byte</span>			<span class="n">multicast</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="mi">6</span><span class="p">];</span>
		<span class="n">byte</span>			<span class="n">eth_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
		<span class="n">byte</span>			<span class="n">failed</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Rcv_resp</span>		<span class="n">rcv_resp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Xmit_resp</span>	<span class="n">xmit_resp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Netstat</span>		<span class="n">netstat</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Selftest</span>		<span class="n">selftest</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Info</span>		<span class="n">info</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">Memdump</span>    	<span class="n">memdump</span><span class="p">;</span>
		<span class="n">byte</span>			<span class="n">raw</span><span class="p">[</span><span class="mi">62</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pcb_struct</span><span class="p">;</span>

<span class="cm">/* These defines for &#39;configure&#39; */</span>
<span class="cp">#define RECV_STATION	0x00</span>
<span class="cp">#define RECV_BROAD	0x01</span>
<span class="cp">#define RECV_MULTI	0x02</span>
<span class="cp">#define RECV_PROMISC	0x04</span>
<span class="cp">#define NO_LOOPBACK	0x00</span>
<span class="cp">#define INT_LOOPBACK	0x08</span>
<span class="cp">#define EXT_LOOPBACK	0x10</span>

<span class="cm">/*****************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> *  structure to hold context information for adapter</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************/</span>

<span class="cp">#define DMA_BUFFER_SIZE  1600</span>
<span class="cp">#define BACKLOG_SIZE      4</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">short</span> <span class="n">got</span><span class="p">[</span><span class="n">NUM_TRANSMIT_CMDS</span><span class="p">];</span>	<span class="cm">/* flags for</span>
<span class="cm">						   command completion */</span>
	<span class="n">pcb_struct</span> <span class="n">tx_pcb</span><span class="p">;</span>	<span class="cm">/* PCB for foreground sending */</span>
	<span class="n">pcb_struct</span> <span class="n">rx_pcb</span><span class="p">;</span>	<span class="cm">/* PCB for foreground receiving */</span>
	<span class="n">pcb_struct</span> <span class="n">itx_pcb</span><span class="p">;</span>	<span class="cm">/* PCB for background sending */</span>
	<span class="n">pcb_struct</span> <span class="n">irx_pcb</span><span class="p">;</span>	<span class="cm">/* PCB for background receiving */</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">dma_buffer</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">[</span><span class="n">BACKLOG_SIZE</span><span class="p">];</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">in</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rx_backlog</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">direction</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	        <span class="kt">void</span> <span class="o">*</span><span class="n">target</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start_time</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">current_dma</span><span class="p">;</span>

	<span class="cm">/* flags */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">send_pcb_semaphore</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dmaing</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">busy</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_active</span><span class="p">;</span>  <span class="cm">/* number of receive PCBs */</span>
        <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hcr_val</span><span class="p">;</span>  <span class="cm">/* what we think the HCR contains */</span>
        <span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>	<span class="cm">/* Interrupt v tx lock */</span>
<span class="p">}</span> <span class="n">elp_device</span><span class="p">;</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
