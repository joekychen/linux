<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › cadence › macb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>macb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Atmel MACB Ethernet Controller driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2004-2006 Atmel Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _MACB_H</span>
<span class="cp">#define _MACB_H</span>

<span class="cm">/* MACB register offsets */</span>
<span class="cp">#define MACB_NCR				0x0000</span>
<span class="cp">#define MACB_NCFGR				0x0004</span>
<span class="cp">#define MACB_NSR				0x0008</span>
<span class="cp">#define MACB_TSR				0x0014</span>
<span class="cp">#define MACB_RBQP				0x0018</span>
<span class="cp">#define MACB_TBQP				0x001c</span>
<span class="cp">#define MACB_RSR				0x0020</span>
<span class="cp">#define MACB_ISR				0x0024</span>
<span class="cp">#define MACB_IER				0x0028</span>
<span class="cp">#define MACB_IDR				0x002c</span>
<span class="cp">#define MACB_IMR				0x0030</span>
<span class="cp">#define MACB_MAN				0x0034</span>
<span class="cp">#define MACB_PTR				0x0038</span>
<span class="cp">#define MACB_PFR				0x003c</span>
<span class="cp">#define MACB_FTO				0x0040</span>
<span class="cp">#define MACB_SCF				0x0044</span>
<span class="cp">#define MACB_MCF				0x0048</span>
<span class="cp">#define MACB_FRO				0x004c</span>
<span class="cp">#define MACB_FCSE				0x0050</span>
<span class="cp">#define MACB_ALE				0x0054</span>
<span class="cp">#define MACB_DTF				0x0058</span>
<span class="cp">#define MACB_LCOL				0x005c</span>
<span class="cp">#define MACB_EXCOL				0x0060</span>
<span class="cp">#define MACB_TUND				0x0064</span>
<span class="cp">#define MACB_CSE				0x0068</span>
<span class="cp">#define MACB_RRE				0x006c</span>
<span class="cp">#define MACB_ROVR				0x0070</span>
<span class="cp">#define MACB_RSE				0x0074</span>
<span class="cp">#define MACB_ELE				0x0078</span>
<span class="cp">#define MACB_RJA				0x007c</span>
<span class="cp">#define MACB_USF				0x0080</span>
<span class="cp">#define MACB_STE				0x0084</span>
<span class="cp">#define MACB_RLE				0x0088</span>
<span class="cp">#define MACB_TPF				0x008c</span>
<span class="cp">#define MACB_HRB				0x0090</span>
<span class="cp">#define MACB_HRT				0x0094</span>
<span class="cp">#define MACB_SA1B				0x0098</span>
<span class="cp">#define MACB_SA1T				0x009c</span>
<span class="cp">#define MACB_SA2B				0x00a0</span>
<span class="cp">#define MACB_SA2T				0x00a4</span>
<span class="cp">#define MACB_SA3B				0x00a8</span>
<span class="cp">#define MACB_SA3T				0x00ac</span>
<span class="cp">#define MACB_SA4B				0x00b0</span>
<span class="cp">#define MACB_SA4T				0x00b4</span>
<span class="cp">#define MACB_TID				0x00b8</span>
<span class="cp">#define MACB_TPQ				0x00bc</span>
<span class="cp">#define MACB_USRIO				0x00c0</span>
<span class="cp">#define MACB_WOL				0x00c4</span>
<span class="cp">#define MACB_MID				0x00fc</span>

<span class="cm">/* GEM register offsets. */</span>
<span class="cp">#define GEM_NCFGR				0x0004</span>
<span class="cp">#define GEM_USRIO				0x000c</span>
<span class="cp">#define GEM_DMACFG				0x0010</span>
<span class="cp">#define GEM_HRB					0x0080</span>
<span class="cp">#define GEM_HRT					0x0084</span>
<span class="cp">#define GEM_SA1B				0x0088</span>
<span class="cp">#define GEM_SA1T				0x008C</span>
<span class="cp">#define GEM_OTX					0x0100</span>
<span class="cp">#define GEM_DCFG1				0x0280</span>
<span class="cp">#define GEM_DCFG2				0x0284</span>
<span class="cp">#define GEM_DCFG3				0x0288</span>
<span class="cp">#define GEM_DCFG4				0x028c</span>
<span class="cp">#define GEM_DCFG5				0x0290</span>
<span class="cp">#define GEM_DCFG6				0x0294</span>
<span class="cp">#define GEM_DCFG7				0x0298</span>

<span class="cm">/* Bitfields in NCR */</span>
<span class="cp">#define MACB_LB_OFFSET				0</span>
<span class="cp">#define MACB_LB_SIZE				1</span>
<span class="cp">#define MACB_LLB_OFFSET				1</span>
<span class="cp">#define MACB_LLB_SIZE				1</span>
<span class="cp">#define MACB_RE_OFFSET				2</span>
<span class="cp">#define MACB_RE_SIZE				1</span>
<span class="cp">#define MACB_TE_OFFSET				3</span>
<span class="cp">#define MACB_TE_SIZE				1</span>
<span class="cp">#define MACB_MPE_OFFSET				4</span>
<span class="cp">#define MACB_MPE_SIZE				1</span>
<span class="cp">#define MACB_CLRSTAT_OFFSET			5</span>
<span class="cp">#define MACB_CLRSTAT_SIZE			1</span>
<span class="cp">#define MACB_INCSTAT_OFFSET			6</span>
<span class="cp">#define MACB_INCSTAT_SIZE			1</span>
<span class="cp">#define MACB_WESTAT_OFFSET			7</span>
<span class="cp">#define MACB_WESTAT_SIZE			1</span>
<span class="cp">#define MACB_BP_OFFSET				8</span>
<span class="cp">#define MACB_BP_SIZE				1</span>
<span class="cp">#define MACB_TSTART_OFFSET			9</span>
<span class="cp">#define MACB_TSTART_SIZE			1</span>
<span class="cp">#define MACB_THALT_OFFSET			10</span>
<span class="cp">#define MACB_THALT_SIZE				1</span>
<span class="cp">#define MACB_NCR_TPF_OFFSET			11</span>
<span class="cp">#define MACB_NCR_TPF_SIZE			1</span>
<span class="cp">#define MACB_TZQ_OFFSET				12</span>
<span class="cp">#define MACB_TZQ_SIZE				1</span>

<span class="cm">/* Bitfields in NCFGR */</span>
<span class="cp">#define MACB_SPD_OFFSET				0</span>
<span class="cp">#define MACB_SPD_SIZE				1</span>
<span class="cp">#define MACB_FD_OFFSET				1</span>
<span class="cp">#define MACB_FD_SIZE				1</span>
<span class="cp">#define MACB_BIT_RATE_OFFSET			2</span>
<span class="cp">#define MACB_BIT_RATE_SIZE			1</span>
<span class="cp">#define MACB_JFRAME_OFFSET			3</span>
<span class="cp">#define MACB_JFRAME_SIZE			1</span>
<span class="cp">#define MACB_CAF_OFFSET				4</span>
<span class="cp">#define MACB_CAF_SIZE				1</span>
<span class="cp">#define MACB_NBC_OFFSET				5</span>
<span class="cp">#define MACB_NBC_SIZE				1</span>
<span class="cp">#define MACB_NCFGR_MTI_OFFSET			6</span>
<span class="cp">#define MACB_NCFGR_MTI_SIZE			1</span>
<span class="cp">#define MACB_UNI_OFFSET				7</span>
<span class="cp">#define MACB_UNI_SIZE				1</span>
<span class="cp">#define MACB_BIG_OFFSET				8</span>
<span class="cp">#define MACB_BIG_SIZE				1</span>
<span class="cp">#define MACB_EAE_OFFSET				9</span>
<span class="cp">#define MACB_EAE_SIZE				1</span>
<span class="cp">#define MACB_CLK_OFFSET				10</span>
<span class="cp">#define MACB_CLK_SIZE				2</span>
<span class="cp">#define MACB_RTY_OFFSET				12</span>
<span class="cp">#define MACB_RTY_SIZE				1</span>
<span class="cp">#define MACB_PAE_OFFSET				13</span>
<span class="cp">#define MACB_PAE_SIZE				1</span>
<span class="cp">#define MACB_RBOF_OFFSET			14</span>
<span class="cp">#define MACB_RBOF_SIZE				2</span>
<span class="cp">#define MACB_RLCE_OFFSET			16</span>
<span class="cp">#define MACB_RLCE_SIZE				1</span>
<span class="cp">#define MACB_DRFCS_OFFSET			17</span>
<span class="cp">#define MACB_DRFCS_SIZE				1</span>
<span class="cp">#define MACB_EFRHD_OFFSET			18</span>
<span class="cp">#define MACB_EFRHD_SIZE				1</span>
<span class="cp">#define MACB_IRXFCS_OFFSET			19</span>
<span class="cp">#define MACB_IRXFCS_SIZE			1</span>

<span class="cm">/* GEM specific NCFGR bitfields. */</span>
<span class="cp">#define GEM_CLK_OFFSET				18</span>
<span class="cp">#define GEM_CLK_SIZE				3</span>
<span class="cp">#define GEM_DBW_OFFSET				21</span>
<span class="cp">#define GEM_DBW_SIZE				2</span>

<span class="cm">/* Constants for data bus width. */</span>
<span class="cp">#define GEM_DBW32				0</span>
<span class="cp">#define GEM_DBW64				1</span>
<span class="cp">#define GEM_DBW128				2</span>

<span class="cm">/* Bitfields in DMACFG. */</span>
<span class="cp">#define GEM_RXBS_OFFSET				16</span>
<span class="cp">#define GEM_RXBS_SIZE				8</span>

<span class="cm">/* Bitfields in NSR */</span>
<span class="cp">#define MACB_NSR_LINK_OFFSET			0</span>
<span class="cp">#define MACB_NSR_LINK_SIZE			1</span>
<span class="cp">#define MACB_MDIO_OFFSET			1</span>
<span class="cp">#define MACB_MDIO_SIZE				1</span>
<span class="cp">#define MACB_IDLE_OFFSET			2</span>
<span class="cp">#define MACB_IDLE_SIZE				1</span>

<span class="cm">/* Bitfields in TSR */</span>
<span class="cp">#define MACB_UBR_OFFSET				0</span>
<span class="cp">#define MACB_UBR_SIZE				1</span>
<span class="cp">#define MACB_COL_OFFSET				1</span>
<span class="cp">#define MACB_COL_SIZE				1</span>
<span class="cp">#define MACB_TSR_RLE_OFFSET			2</span>
<span class="cp">#define MACB_TSR_RLE_SIZE			1</span>
<span class="cp">#define MACB_TGO_OFFSET				3</span>
<span class="cp">#define MACB_TGO_SIZE				1</span>
<span class="cp">#define MACB_BEX_OFFSET				4</span>
<span class="cp">#define MACB_BEX_SIZE				1</span>
<span class="cp">#define MACB_COMP_OFFSET			5</span>
<span class="cp">#define MACB_COMP_SIZE				1</span>
<span class="cp">#define MACB_UND_OFFSET				6</span>
<span class="cp">#define MACB_UND_SIZE				1</span>

<span class="cm">/* Bitfields in RSR */</span>
<span class="cp">#define MACB_BNA_OFFSET				0</span>
<span class="cp">#define MACB_BNA_SIZE				1</span>
<span class="cp">#define MACB_REC_OFFSET				1</span>
<span class="cp">#define MACB_REC_SIZE				1</span>
<span class="cp">#define MACB_OVR_OFFSET				2</span>
<span class="cp">#define MACB_OVR_SIZE				1</span>

<span class="cm">/* Bitfields in ISR/IER/IDR/IMR */</span>
<span class="cp">#define MACB_MFD_OFFSET				0</span>
<span class="cp">#define MACB_MFD_SIZE				1</span>
<span class="cp">#define MACB_RCOMP_OFFSET			1</span>
<span class="cp">#define MACB_RCOMP_SIZE				1</span>
<span class="cp">#define MACB_RXUBR_OFFSET			2</span>
<span class="cp">#define MACB_RXUBR_SIZE				1</span>
<span class="cp">#define MACB_TXUBR_OFFSET			3</span>
<span class="cp">#define MACB_TXUBR_SIZE				1</span>
<span class="cp">#define MACB_ISR_TUND_OFFSET			4</span>
<span class="cp">#define MACB_ISR_TUND_SIZE			1</span>
<span class="cp">#define MACB_ISR_RLE_OFFSET			5</span>
<span class="cp">#define MACB_ISR_RLE_SIZE			1</span>
<span class="cp">#define MACB_TXERR_OFFSET			6</span>
<span class="cp">#define MACB_TXERR_SIZE				1</span>
<span class="cp">#define MACB_TCOMP_OFFSET			7</span>
<span class="cp">#define MACB_TCOMP_SIZE				1</span>
<span class="cp">#define MACB_ISR_LINK_OFFSET			9</span>
<span class="cp">#define MACB_ISR_LINK_SIZE			1</span>
<span class="cp">#define MACB_ISR_ROVR_OFFSET			10</span>
<span class="cp">#define MACB_ISR_ROVR_SIZE			1</span>
<span class="cp">#define MACB_HRESP_OFFSET			11</span>
<span class="cp">#define MACB_HRESP_SIZE				1</span>
<span class="cp">#define MACB_PFR_OFFSET				12</span>
<span class="cp">#define MACB_PFR_SIZE				1</span>
<span class="cp">#define MACB_PTZ_OFFSET				13</span>
<span class="cp">#define MACB_PTZ_SIZE				1</span>

<span class="cm">/* Bitfields in MAN */</span>
<span class="cp">#define MACB_DATA_OFFSET			0</span>
<span class="cp">#define MACB_DATA_SIZE				16</span>
<span class="cp">#define MACB_CODE_OFFSET			16</span>
<span class="cp">#define MACB_CODE_SIZE				2</span>
<span class="cp">#define MACB_REGA_OFFSET			18</span>
<span class="cp">#define MACB_REGA_SIZE				5</span>
<span class="cp">#define MACB_PHYA_OFFSET			23</span>
<span class="cp">#define MACB_PHYA_SIZE				5</span>
<span class="cp">#define MACB_RW_OFFSET				28</span>
<span class="cp">#define MACB_RW_SIZE				2</span>
<span class="cp">#define MACB_SOF_OFFSET				30</span>
<span class="cp">#define MACB_SOF_SIZE				2</span>

<span class="cm">/* Bitfields in USRIO (AVR32) */</span>
<span class="cp">#define MACB_MII_OFFSET				0</span>
<span class="cp">#define MACB_MII_SIZE				1</span>
<span class="cp">#define MACB_EAM_OFFSET				1</span>
<span class="cp">#define MACB_EAM_SIZE				1</span>
<span class="cp">#define MACB_TX_PAUSE_OFFSET			2</span>
<span class="cp">#define MACB_TX_PAUSE_SIZE			1</span>
<span class="cp">#define MACB_TX_PAUSE_ZERO_OFFSET		3</span>
<span class="cp">#define MACB_TX_PAUSE_ZERO_SIZE			1</span>

<span class="cm">/* Bitfields in USRIO (AT91) */</span>
<span class="cp">#define MACB_RMII_OFFSET			0</span>
<span class="cp">#define MACB_RMII_SIZE				1</span>
<span class="cp">#define MACB_CLKEN_OFFSET			1</span>
<span class="cp">#define MACB_CLKEN_SIZE				1</span>

<span class="cm">/* Bitfields in WOL */</span>
<span class="cp">#define MACB_IP_OFFSET				0</span>
<span class="cp">#define MACB_IP_SIZE				16</span>
<span class="cp">#define MACB_MAG_OFFSET				16</span>
<span class="cp">#define MACB_MAG_SIZE				1</span>
<span class="cp">#define MACB_ARP_OFFSET				17</span>
<span class="cp">#define MACB_ARP_SIZE				1</span>
<span class="cp">#define MACB_SA1_OFFSET				18</span>
<span class="cp">#define MACB_SA1_SIZE				1</span>
<span class="cp">#define MACB_WOL_MTI_OFFSET			19</span>
<span class="cp">#define MACB_WOL_MTI_SIZE			1</span>

<span class="cm">/* Bitfields in MID */</span>
<span class="cp">#define MACB_IDNUM_OFFSET			16</span>
<span class="cp">#define MACB_IDNUM_SIZE				16</span>
<span class="cp">#define MACB_REV_OFFSET				0</span>
<span class="cp">#define MACB_REV_SIZE				16</span>

<span class="cm">/* Bitfields in DCFG1. */</span>
<span class="cp">#define GEM_DBWDEF_OFFSET			25</span>
<span class="cp">#define GEM_DBWDEF_SIZE				3</span>

<span class="cm">/* Constants for CLK */</span>
<span class="cp">#define MACB_CLK_DIV8				0</span>
<span class="cp">#define MACB_CLK_DIV16				1</span>
<span class="cp">#define MACB_CLK_DIV32				2</span>
<span class="cp">#define MACB_CLK_DIV64				3</span>

<span class="cm">/* GEM specific constants for CLK. */</span>
<span class="cp">#define GEM_CLK_DIV8				0</span>
<span class="cp">#define GEM_CLK_DIV16				1</span>
<span class="cp">#define GEM_CLK_DIV32				2</span>
<span class="cp">#define GEM_CLK_DIV48				3</span>
<span class="cp">#define GEM_CLK_DIV64				4</span>
<span class="cp">#define GEM_CLK_DIV96				5</span>

<span class="cm">/* Constants for MAN register */</span>
<span class="cp">#define MACB_MAN_SOF				1</span>
<span class="cp">#define MACB_MAN_WRITE				1</span>
<span class="cp">#define MACB_MAN_READ				2</span>
<span class="cp">#define MACB_MAN_CODE				2</span>

<span class="cm">/* Bit manipulation macros */</span>
<span class="cp">#define MACB_BIT(name)					\</span>
<span class="cp">	(1 &lt;&lt; MACB_##name##_OFFSET)</span>
<span class="cp">#define MACB_BF(name,value)				\</span>
<span class="cp">	(((value) &amp; ((1 &lt;&lt; MACB_##name##_SIZE) - 1))	\</span>
<span class="cp">	 &lt;&lt; MACB_##name##_OFFSET)</span>
<span class="cp">#define MACB_BFEXT(name,value)\</span>
<span class="cp">	(((value) &gt;&gt; MACB_##name##_OFFSET)		\</span>
<span class="cp">	 &amp; ((1 &lt;&lt; MACB_##name##_SIZE) - 1))</span>
<span class="cp">#define MACB_BFINS(name,value,old)			\</span>
<span class="cp">	(((old) &amp; ~(((1 &lt;&lt; MACB_##name##_SIZE) - 1)	\</span>
<span class="cp">		    &lt;&lt; MACB_##name##_OFFSET))		\</span>
<span class="cp">	 | MACB_BF(name,value))</span>

<span class="cp">#define GEM_BIT(name)					\</span>
<span class="cp">	(1 &lt;&lt; GEM_##name##_OFFSET)</span>
<span class="cp">#define GEM_BF(name, value)				\</span>
<span class="cp">	(((value) &amp; ((1 &lt;&lt; GEM_##name##_SIZE) - 1))	\</span>
<span class="cp">	 &lt;&lt; GEM_##name##_OFFSET)</span>
<span class="cp">#define GEM_BFEXT(name, value)\</span>
<span class="cp">	(((value) &gt;&gt; GEM_##name##_OFFSET)		\</span>
<span class="cp">	 &amp; ((1 &lt;&lt; GEM_##name##_SIZE) - 1))</span>
<span class="cp">#define GEM_BFINS(name, value, old)			\</span>
<span class="cp">	(((old) &amp; ~(((1 &lt;&lt; GEM_##name##_SIZE) - 1)	\</span>
<span class="cp">		    &lt;&lt; GEM_##name##_OFFSET))		\</span>
<span class="cp">	 | GEM_BF(name, value))</span>

<span class="cm">/* Register access macros */</span>
<span class="cp">#define macb_readl(port,reg)				\</span>
<span class="cp">	__raw_readl((port)-&gt;regs + MACB_##reg)</span>
<span class="cp">#define macb_writel(port,reg,value)			\</span>
<span class="cp">	__raw_writel((value), (port)-&gt;regs + MACB_##reg)</span>
<span class="cp">#define gem_readl(port, reg)				\</span>
<span class="cp">	__raw_readl((port)-&gt;regs + GEM_##reg)</span>
<span class="cp">#define gem_writel(port, reg, value)			\</span>
<span class="cp">	__raw_writel((value), (port)-&gt;regs + GEM_##reg)</span>

<span class="cm">/*</span>
<span class="cm"> * Conditional GEM/MACB macros.  These perform the operation to the correct</span>
<span class="cm"> * register dependent on whether the device is a GEM or a MACB.  For registers</span>
<span class="cm"> * and bitfields that are common across both devices, use macb_{read,write}l</span>
<span class="cm"> * to avoid the cost of the conditional.</span>
<span class="cm"> */</span>
<span class="cp">#define macb_or_gem_writel(__bp, __reg, __value) \</span>
<span class="cp">	({ \</span>
<span class="cp">		if (macb_is_gem((__bp))) \</span>
<span class="cp">			gem_writel((__bp), __reg, __value); \</span>
<span class="cp">		else \</span>
<span class="cp">			macb_writel((__bp), __reg, __value); \</span>
<span class="cp">	})</span>

<span class="cp">#define macb_or_gem_readl(__bp, __reg) \</span>
<span class="cp">	({ \</span>
<span class="cp">		u32 __v; \</span>
<span class="cp">		if (macb_is_gem((__bp))) \</span>
<span class="cp">			__v = gem_readl((__bp), __reg); \</span>
<span class="cp">		else \</span>
<span class="cp">			__v = macb_readl((__bp), __reg); \</span>
<span class="cp">		__v; \</span>
<span class="cp">	})</span>

<span class="k">struct</span> <span class="n">dma_desc</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">ctrl</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* DMA descriptor bitfields */</span>
<span class="cp">#define MACB_RX_USED_OFFSET			0</span>
<span class="cp">#define MACB_RX_USED_SIZE			1</span>
<span class="cp">#define MACB_RX_WRAP_OFFSET			1</span>
<span class="cp">#define MACB_RX_WRAP_SIZE			1</span>
<span class="cp">#define MACB_RX_WADDR_OFFSET			2</span>
<span class="cp">#define MACB_RX_WADDR_SIZE			30</span>

<span class="cp">#define MACB_RX_FRMLEN_OFFSET			0</span>
<span class="cp">#define MACB_RX_FRMLEN_SIZE			12</span>
<span class="cp">#define MACB_RX_OFFSET_OFFSET			12</span>
<span class="cp">#define MACB_RX_OFFSET_SIZE			2</span>
<span class="cp">#define MACB_RX_SOF_OFFSET			14</span>
<span class="cp">#define MACB_RX_SOF_SIZE			1</span>
<span class="cp">#define MACB_RX_EOF_OFFSET			15</span>
<span class="cp">#define MACB_RX_EOF_SIZE			1</span>
<span class="cp">#define MACB_RX_CFI_OFFSET			16</span>
<span class="cp">#define MACB_RX_CFI_SIZE			1</span>
<span class="cp">#define MACB_RX_VLAN_PRI_OFFSET			17</span>
<span class="cp">#define MACB_RX_VLAN_PRI_SIZE			3</span>
<span class="cp">#define MACB_RX_PRI_TAG_OFFSET			20</span>
<span class="cp">#define MACB_RX_PRI_TAG_SIZE			1</span>
<span class="cp">#define MACB_RX_VLAN_TAG_OFFSET			21</span>
<span class="cp">#define MACB_RX_VLAN_TAG_SIZE			1</span>
<span class="cp">#define MACB_RX_TYPEID_MATCH_OFFSET		22</span>
<span class="cp">#define MACB_RX_TYPEID_MATCH_SIZE		1</span>
<span class="cp">#define MACB_RX_SA4_MATCH_OFFSET		23</span>
<span class="cp">#define MACB_RX_SA4_MATCH_SIZE			1</span>
<span class="cp">#define MACB_RX_SA3_MATCH_OFFSET		24</span>
<span class="cp">#define MACB_RX_SA3_MATCH_SIZE			1</span>
<span class="cp">#define MACB_RX_SA2_MATCH_OFFSET		25</span>
<span class="cp">#define MACB_RX_SA2_MATCH_SIZE			1</span>
<span class="cp">#define MACB_RX_SA1_MATCH_OFFSET		26</span>
<span class="cp">#define MACB_RX_SA1_MATCH_SIZE			1</span>
<span class="cp">#define MACB_RX_EXT_MATCH_OFFSET		28</span>
<span class="cp">#define MACB_RX_EXT_MATCH_SIZE			1</span>
<span class="cp">#define MACB_RX_UHASH_MATCH_OFFSET		29</span>
<span class="cp">#define MACB_RX_UHASH_MATCH_SIZE		1</span>
<span class="cp">#define MACB_RX_MHASH_MATCH_OFFSET		30</span>
<span class="cp">#define MACB_RX_MHASH_MATCH_SIZE		1</span>
<span class="cp">#define MACB_RX_BROADCAST_OFFSET		31</span>
<span class="cp">#define MACB_RX_BROADCAST_SIZE			1</span>

<span class="cp">#define MACB_TX_FRMLEN_OFFSET			0</span>
<span class="cp">#define MACB_TX_FRMLEN_SIZE			11</span>
<span class="cp">#define MACB_TX_LAST_OFFSET			15</span>
<span class="cp">#define MACB_TX_LAST_SIZE			1</span>
<span class="cp">#define MACB_TX_NOCRC_OFFSET			16</span>
<span class="cp">#define MACB_TX_NOCRC_SIZE			1</span>
<span class="cp">#define MACB_TX_BUF_EXHAUSTED_OFFSET		27</span>
<span class="cp">#define MACB_TX_BUF_EXHAUSTED_SIZE		1</span>
<span class="cp">#define MACB_TX_UNDERRUN_OFFSET			28</span>
<span class="cp">#define MACB_TX_UNDERRUN_SIZE			1</span>
<span class="cp">#define MACB_TX_ERROR_OFFSET			29</span>
<span class="cp">#define MACB_TX_ERROR_SIZE			1</span>
<span class="cp">#define MACB_TX_WRAP_OFFSET			30</span>
<span class="cp">#define MACB_TX_WRAP_SIZE			1</span>
<span class="cp">#define MACB_TX_USED_OFFSET			31</span>
<span class="cp">#define MACB_TX_USED_SIZE			1</span>

<span class="k">struct</span> <span class="n">ring_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span>		<span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">mapping</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Hardware-collected statistics. Used when updating the network</span>
<span class="cm"> * device stats by a periodic timer.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">macb_stats</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">rx_pause_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_ok</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_single_cols</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_multiple_cols</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_ok</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_fcs_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_align_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_deferred</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_late_cols</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_excessive_cols</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_underruns</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_carrier_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_resource_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_overruns</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_symbol_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_oversize_pkts</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_jabbers</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_undersize_pkts</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">sqe_test_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_length_mismatch</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_pause_frames</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gem_stats</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">tx_octets_31_0</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_octets_47_32</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_broadcast_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_multicast_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_pause_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_64_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_65_127_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_128_255_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_256_511_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_512_1023_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_1024_1518_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_greater_than_1518_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_underrun</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_single_collision_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_multiple_collision_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_excessive_collisions</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_late_collisions</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_deferred_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tx_carrier_sense_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_octets_31_0</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_octets_47_32</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_broadcast_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_multicast_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_pause_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_64_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_65_127_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_128_255_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_256_511_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_512_1023_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_1024_1518_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_greater_than_1518_byte_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_undersized_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_oversize_frames</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_jabbers</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_frame_check_sequence_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_length_field_frame_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_symbol_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_alignment_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_resource_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_overruns</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_ip_header_checksum_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_tcp_checksum_errors</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rx_udp_checksum_errors</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">macb</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span>		<span class="o">*</span><span class="n">regs</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">rx_tail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_desc</span>		<span class="o">*</span><span class="n">rx_ring</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">rx_buffers</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">tx_head</span><span class="p">,</span> <span class="n">tx_tail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dma_desc</span>		<span class="o">*</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ring_info</span>	<span class="o">*</span><span class="n">tx_skb</span><span class="p">;</span>

	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">platform_device</span>	<span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span>		<span class="o">*</span><span class="n">pclk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span>		<span class="o">*</span><span class="n">hclk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>	<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">napi_struct</span>	<span class="n">napi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span>	<span class="n">stats</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">macb_stats</span>	<span class="n">macb</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">gem_stats</span>	<span class="n">gem</span><span class="p">;</span>
	<span class="p">}</span>			<span class="n">hw_stats</span><span class="p">;</span>

	<span class="n">dma_addr_t</span>		<span class="n">rx_ring_dma</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">tx_ring_dma</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">rx_buffers_dma</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">rx_pending</span><span class="p">,</span> <span class="n">tx_pending</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mii_bus</span>		<span class="o">*</span><span class="n">mii_bus</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phy_device</span>	<span class="o">*</span><span class="n">phy_dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">link</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">speed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">duplex</span><span class="p">;</span>

	<span class="n">phy_interface_t</span>		<span class="n">phy_interface</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">macb_is_gem</span><span class="p">(</span><span class="k">struct</span> <span class="n">macb</span> <span class="o">*</span><span class="n">bp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">MACB_BFEXT</span><span class="p">(</span><span class="n">IDNUM</span><span class="p">,</span> <span class="n">macb_readl</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">MID</span><span class="p">))</span> <span class="o">==</span> <span class="mh">0x2</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _MACB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
