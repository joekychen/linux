<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › stmicro › stmmac › common.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>common.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*******************************************************************************</span>
<span class="cm">  STMMAC Common Header File</span>

<span class="cm">  Copyright (C) 2007-2009  STMicroelectronics Ltd</span>

<span class="cm">  This program is free software; you can redistribute it and/or modify it</span>
<span class="cm">  under the terms and conditions of the GNU General Public License,</span>
<span class="cm">  version 2, as published by the Free Software Foundation.</span>

<span class="cm">  This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm">  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm">  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm">  more details.</span>

<span class="cm">  You should have received a copy of the GNU General Public License along with</span>
<span class="cm">  this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm">  51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span class="cm">  The full GNU General Public License is included in this distribution in</span>
<span class="cm">  the file called &quot;COPYING&quot;.</span>

<span class="cm">  Author: Giuseppe Cavallaro &lt;peppe.cavallaro@st.com&gt;</span>
<span class="cm">*******************************************************************************/</span>

<span class="cp">#include &lt;linux/etherdevice.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/phy.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#if defined(CONFIG_VLAN_8021Q) || defined(CONFIG_VLAN_8021Q_MODULE)</span>
<span class="cp">#define STMMAC_VLAN_TAG_USED</span>
<span class="cp">#include &lt;linux/if_vlan.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &quot;descs.h&quot;</span>
<span class="cp">#include &quot;mmc.h&quot;</span>

<span class="cp">#undef CHIP_DEBUG_PRINT</span>
<span class="cm">/* Turn-on extra printk debug for MAC core, dma and descriptors */</span>
<span class="cm">/* #define CHIP_DEBUG_PRINT */</span>

<span class="cp">#ifdef CHIP_DEBUG_PRINT</span>
<span class="cp">#define CHIP_DBG(fmt, args...)  printk(fmt, ## args)</span>
<span class="cp">#else</span>
<span class="cp">#define CHIP_DBG(fmt, args...)  do { } while (0)</span>
<span class="cp">#endif</span>

<span class="cp">#undef FRAME_FILTER_DEBUG</span>
<span class="cm">/* #define FRAME_FILTER_DEBUG */</span>

<span class="k">struct</span> <span class="n">stmmac_extra_stats</span> <span class="p">{</span>
	<span class="cm">/* Transmit errors */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_underflow</span> <span class="n">____cacheline_aligned</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_carrier</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_losscarrier</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vlan_tag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_deferred</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_vlan</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_jabber</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_frame_flushed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_payload_error</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_ip_header_error</span><span class="p">;</span>
	<span class="cm">/* Receive errors */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_desc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sa_filter_fail</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">overflow_error</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ipc_csum_error</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_collision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_crc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dribbling_bit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_length</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_mii</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_multicast</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_gmac_overflow</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_watchdog</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">da_rx_filter_fail</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sa_rx_filter_fail</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_missed_cntr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_overflow_cntr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_vlan</span><span class="p">;</span>
	<span class="cm">/* Tx/Rx IRQ errors */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_undeflow_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_process_stopped_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_jabber_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_overflow_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_buf_unav_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_process_stopped_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_watchdog_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_early_irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fatal_bus_error_irq</span><span class="p">;</span>
	<span class="cm">/* Extra info */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">threshold</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_pkt_n</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_pkt_n</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">poll_n</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sched_timer_n</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">normal_irq_n</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* CSR Frequency Access Defines*/</span>
<span class="cp">#define CSR_F_35M	35000000</span>
<span class="cp">#define CSR_F_60M	60000000</span>
<span class="cp">#define CSR_F_100M	100000000</span>
<span class="cp">#define CSR_F_150M	150000000</span>
<span class="cp">#define CSR_F_250M	250000000</span>
<span class="cp">#define CSR_F_300M	300000000</span>

<span class="cp">#define	MAC_CSR_H_FRQ_MASK	0x20</span>

<span class="cp">#define HASH_TABLE_SIZE 64</span>
<span class="cp">#define PAUSE_TIME 0x200</span>

<span class="cm">/* Flow Control defines */</span>
<span class="cp">#define FLOW_OFF	0</span>
<span class="cp">#define FLOW_RX		1</span>
<span class="cp">#define FLOW_TX		2</span>
<span class="cp">#define FLOW_AUTO	(FLOW_TX | FLOW_RX)</span>

<span class="cp">#define SF_DMA_MODE 1 </span><span class="cm">/* DMA STORE-AND-FORWARD Operation Mode */</span><span class="cp"></span>

<span class="cm">/* DAM HW feature register fields */</span>
<span class="cp">#define DMA_HW_FEAT_MIISEL	0x00000001 </span><span class="cm">/* 10/100 Mbps Support */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_GMIISEL	0x00000002 </span><span class="cm">/* 1000 Mbps Support */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_HDSEL	0x00000004 </span><span class="cm">/* Half-Duplex Support */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_EXTHASHEN	0x00000008 </span><span class="cm">/* Expanded DA Hash Filter */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_HASHSEL	0x00000010 </span><span class="cm">/* HASH Filter */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_ADDMACADRSEL	0x00000020 </span><span class="cm">/* Multiple MAC Addr Reg */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_PCSSEL	0x00000040 </span><span class="cm">/* PCS registers */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_L3L4FLTREN	0x00000080 </span><span class="cm">/* Layer 3 &amp; Layer 4 Feature */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_SMASEL	0x00000100 </span><span class="cm">/* SMA(MDIO) Interface */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_RWKSEL	0x00000200 </span><span class="cm">/* PMT Remote Wakeup */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_MGKSEL	0x00000400 </span><span class="cm">/* PMT Magic Packet */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_MMCSEL	0x00000800 </span><span class="cm">/* RMON Module */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_TSVER1SEL	0x00001000 </span><span class="cm">/* Only IEEE 1588-2002 Timestamp */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_TSVER2SEL	0x00002000 </span><span class="cm">/* IEEE 1588-2008 Adv Timestamp */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_EEESEL	0x00004000 </span><span class="cm">/* Energy Efficient Ethernet */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_AVSEL	0x00008000 </span><span class="cm">/* AV Feature */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_TXCOESEL	0x00010000 </span><span class="cm">/* Checksum Offload in Tx */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_RXTYP1COE	0x00020000 </span><span class="cm">/* IP csum Offload(Type 1) in Rx */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_RXTYP2COE	0x00040000 </span><span class="cm">/* IP csum Offload(Type 2) in Rx */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_RXFIFOSIZE	0x00080000 </span><span class="cm">/* Rx FIFO &gt; 2048 Bytes */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_RXCHCNT	0x00300000 </span><span class="cm">/* No. of additional Rx Channels */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_TXCHCNT	0x00c00000 </span><span class="cm">/* No. of additional Tx Channels */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_ENHDESSEL	0x01000000 </span><span class="cm">/* Alternate (Enhanced Descriptor) */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_INTTSEN	0x02000000 </span><span class="cm">/* Timestamping with Internal</span>
<span class="cm">					      System Time */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_FLEXIPPSEN	0x04000000 </span><span class="cm">/* Flexible PPS Output */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_SAVLANINS	0x08000000 </span><span class="cm">/* Source Addr or VLAN Insertion */</span><span class="cp"></span>
<span class="cp">#define DMA_HW_FEAT_ACTPHYIF	0x70000000 </span><span class="cm">/* Active/selected PHY interface */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_DMA_PBL		8</span>

<span class="k">enum</span> <span class="n">rx_frame_status</span> <span class="p">{</span> <span class="cm">/* IPC status */</span>
	<span class="n">good_frame</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">discard_frame</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">csum_none</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">llc_snap</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">tx_dma_irq_status</span> <span class="p">{</span>
	<span class="n">tx_hard_error</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">tx_hard_error_bump_tc</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">handle_tx_rx</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* DMA HW capabilities */</span>
<span class="k">struct</span> <span class="n">dma_features</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mbps_10_100</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mbps_1000</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">half_duplex</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hash_filter</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">multi_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pcs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sma_mdio</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pmt_remote_wake_up</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pmt_magic_frame</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rmon</span><span class="p">;</span>
	<span class="cm">/* IEEE 1588-2002*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">time_stamp</span><span class="p">;</span>
	<span class="cm">/* IEEE 1588-2008*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">atime_stamp</span><span class="p">;</span>
	<span class="cm">/* 802.3az - Energy-Efficient Ethernet (EEE) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eee</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">av</span><span class="p">;</span>
	<span class="cm">/* TX and RX csum */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_coe</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_coe_type1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_coe_type2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rxfifo_over_2048</span><span class="p">;</span>
	<span class="cm">/* TX and RX number of channels */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">number_rx_channel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">number_tx_channel</span><span class="p">;</span>
	<span class="cm">/* Alternate (enhanced) DESC mode*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">enh_desc</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* GMAC TX FIFO is 8K, Rx FIFO is 16K */</span>
<span class="cp">#define BUF_SIZE_16KiB 16384</span>
<span class="cp">#define BUF_SIZE_8KiB 8192</span>
<span class="cp">#define BUF_SIZE_4KiB 4096</span>
<span class="cp">#define BUF_SIZE_2KiB 2048</span>

<span class="cm">/* Power Down and WOL */</span>
<span class="cp">#define PMT_NOT_SUPPORTED 0</span>
<span class="cp">#define PMT_SUPPORTED 1</span>

<span class="cm">/* Common MAC defines */</span>
<span class="cp">#define MAC_CTRL_REG		0x00000000	</span><span class="cm">/* MAC Control */</span><span class="cp"></span>
<span class="cp">#define MAC_ENABLE_TX		0x00000008	</span><span class="cm">/* Transmitter Enable */</span><span class="cp"></span>
<span class="cp">#define MAC_RNABLE_RX		0x00000004	</span><span class="cm">/* Receiver Enable */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">stmmac_desc_ops</span> <span class="p">{</span>
	<span class="cm">/* DMA RX descriptor ring initialization */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_rx_desc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ring_size</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">disable_rx_ic</span><span class="p">);</span>
	<span class="cm">/* DMA TX descriptor ring initialization */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_tx_desc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ring_size</span><span class="p">);</span>

	<span class="cm">/* Invoked by the xmit function to prepare the tx descriptor */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">prepare_tx_desc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_fs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span>
				 <span class="kt">int</span> <span class="n">csum_flag</span><span class="p">);</span>
	<span class="cm">/* Set/get the owner of the descriptor */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_tx_owner</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_tx_owner</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Invoked by the xmit function to close the tx descriptor */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">close_tx_desc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Clean the tx descriptor as soon as the tx irq is received */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">release_tx_desc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Clear interrupt on tx frame completion. When this bit is</span>
<span class="cm">	 * set an interrupt happens as soon as the frame is transmitted */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_tx_ic</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Last tx segment reports the transmit status */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_tx_ls</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Return the transmit status looking at the TDES1 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_status</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stmmac_extra_stats</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="cm">/* Get the buffer size from the descriptor */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_tx_len</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Handle extra events on specific interrupts hw dependent */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rx_owner</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_rx_owner</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="cm">/* Get the receive frame size */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rx_frame_len</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rx_coe_type</span><span class="p">);</span>
	<span class="cm">/* Return the reception status looking at the RDES1 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">rx_status</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stmmac_extra_stats</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stmmac_dma_ops</span> <span class="p">{</span>
	<span class="cm">/* DMA core initialization */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pbl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mb</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">burst_len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dma_tx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dma_rx</span><span class="p">);</span>
	<span class="cm">/* Dump DMA registers */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dump_regs</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="cm">/* Set tx/rx threshold in the csr6 register</span>
<span class="cm">	 * An invalid value enables the store-and-forward mode */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_mode</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">txmode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rxmode</span><span class="p">);</span>
	<span class="cm">/* To track extra statistic (if supported) */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_diagnostic_fr</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stmmac_extra_stats</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span>
				   <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_dma_transmission</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_dma_irq</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_dma_irq</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">start_tx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop_tx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">start_rx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop_rx</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_interrupt</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">stmmac_extra_stats</span> <span class="o">*</span><span class="n">x</span><span class="p">);</span>
	<span class="cm">/* If supported then get the optional core features */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_hw_feature</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stmmac_ops</span> <span class="p">{</span>
	<span class="cm">/* MAC core initialization */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">core_init</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">)</span> <span class="n">____cacheline_aligned</span><span class="p">;</span>
	<span class="cm">/* Enable and verify that the IPC module is supported */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">rx_ipc</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="cm">/* Dump MAC registers */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dump_regs</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="cm">/* Handle extra events on specific interrupts hw dependent */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">host_irq_status</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
	<span class="cm">/* Multicast filter setting */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_filter</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
	<span class="cm">/* Flow control setting */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">flow_ctrl</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">duplex</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pause_time</span><span class="p">);</span>
	<span class="cm">/* Set power management mode (e.g. magic frame) */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pmt</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mode</span><span class="p">);</span>
	<span class="cm">/* Set/Get Unicast MAC addresses */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_umac_addr</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg_n</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">get_umac_addr</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg_n</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mac_link</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">duplex</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mii_regs</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">;</span>	<span class="cm">/* MII Address */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>	<span class="cm">/* MII Data */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stmmac_ring_mode_ops</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">is_jumbo_frm</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ehn_desc</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">jumbo_frm</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">csum</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">refill_desc3</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">bfsize</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_desc3</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">des3_as_data_buf</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init_dma_chain</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">des</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">phy_addr</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clean_desc3</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dma_desc</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_16kib_bfsize</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">mtu</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mac_device_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">stmmac_ops</span>		<span class="o">*</span><span class="n">mac</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">stmmac_desc_ops</span>	<span class="o">*</span><span class="n">desc</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">stmmac_dma_ops</span>	<span class="o">*</span><span class="n">dma</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">stmmac_ring_mode_ops</span>	<span class="o">*</span><span class="n">ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mii_regs</span> <span class="n">mii</span><span class="p">;</span>	<span class="cm">/* MII register Addresses */</span>
	<span class="k">struct</span> <span class="n">mac_link</span> <span class="n">link</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">synopsys_uid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mac_device_info</span> <span class="o">*</span><span class="n">dwmac1000_setup</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">mac_device_info</span> <span class="o">*</span><span class="n">dwmac100_setup</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">stmmac_set_mac_addr</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">high</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">low</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">stmmac_get_mac_addr</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">high</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">low</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">stmmac_set_mac</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">dwmac_dma_flush_tx_fifo</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">ioaddr</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">stmmac_ring_mode_ops</span> <span class="n">ring_mode_ops</span><span class="p">;</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
