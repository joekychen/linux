f | t4fw_api.h | s | 42K | 1485 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | l2t.c | s | 15K | 521 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103870 |  | drivers/net: fix mislocated headers in cxgb4/l2t.c  For some reason three #include <linux/...> are buried way down in the file.  Since the inclusion of module.h is one of them, the inclusion comes after use of EXPORT_SYMBOL which will cause warnings about implicit declarations. Relocate all the headers to the top.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | t4_hw.h | s | 4.9K | 119 | Jeff Kirsher | jeffrey.t.kirsher@intel.com | 1313031292 |  | chelsio: Move the Chelsio drivers  Moves the drivers for the Chelsio chipsets into drivers/net/ethernet/chelsio/ and the necessary Kconfig and Makefile changes.  CC: Divy Le Ray <divy@chelsio.com> CC: Dimitris Michailidis <dm@chelsio.com> CC: Casey Leedom <leedom@chelsio.com> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
f | Makefile | g | 109B |  | Jeff Kirsher | jeffrey.t.kirsher@intel.com | 1313031292 |  | chelsio: Move the Chelsio drivers  Moves the drivers for the Chelsio chipsets into drivers/net/ethernet/chelsio/ and the necessary Kconfig and Makefile changes.  CC: Divy Le Ray <divy@chelsio.com> CC: Dimitris Michailidis <dm@chelsio.com> CC: Casey Leedom <leedom@chelsio.com> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
f | cxgb4.h | s | 25K | 648 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | cxgb4_uld.h | s | 8.1K | 216 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | t4_regs.h | s | 32K | 838 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | l2t.h | s | 4.0K | 96 | Jeff Kirsher | jeffrey.t.kirsher@intel.com | 1313031292 |  | chelsio: Move the Chelsio drivers  Moves the drivers for the Chelsio chipsets into drivers/net/ethernet/chelsio/ and the necessary Kconfig and Makefile changes.  CC: Divy Le Ray <divy@chelsio.com> CC: Dimitris Michailidis <dm@chelsio.com> CC: Casey Leedom <leedom@chelsio.com> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
f | cxgb4_main.c | s | 101K | 3516 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | sge.c | s | 66K | 2177 | Vipul Pandya | vipul@chelsio.com | 1337372548 |  | cxgb4: DB Drop Recovery for RDMA and LLD queues  recover LLD EQs for DB drop interrupts.  This includes adding a new db_lock, a spin lock disabling BH too, used by the recovery thread and the ring_tx_db() paths to allow db drop recovery.  Clean up initial DB avoidance code.  Add read_eq_indices() - this allows the LLD to use the PCIe mw to efficiently read hw eq contexts.  Add cxgb4_sync_txq_pidx() - called by iw_cxgb4 to sync up the sw/hw pidx value.  Add flush_eq_cache() and cxgb4_flush_eq_cache().  This allows iw_cxgb4 to flush the sge eq context cache before beginning db drop recovery.  Add module parameter, dbfoifo_int_thresh, to allow tuning the db interrupt threshold value.  Add dbfifo_int_thresh to cxgb4_lld_info so iw_cxgb4 knows the threshold.  Add module parameter, dbfoifo_drain_delay, to allow tuning the amount of time delay between DB FULL and EMPTY upcalls to iw_cxgb4.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | t4_hw.c | s | 88K | 2621 | Vipul Pandya | vipul@chelsio.com | 1337372547 |  | cxgb4: Common platform specific changes for DB Drop Recovery  Add platform-specific callback functions for interrupts.  This is needed to do a single read-clear of the CAUSE register and then call out to platform specific functions for DB threshold interrupts and DB drop interrupts.  Add t4_mem_win_read_len() - mem-window reads for arbitrary lengths. This is used to read the CIDX/PIDX values from EC contexts during DB drop recovery.  Add t4_fwaddrspace_write() - sends addrspace write cmds to the fw. Needed to flush the sge eq context cache.  Signed-off-by: Vipul Pandya <vipul@chelsio.com> Signed-off-by: Steve Wise <swise@opengridcomputing.com> Signed-off-by: Roland Dreier <roland@purestorage.com>
f | t4_msg.h | s | 13K | 606 | Jeff Kirsher | jeffrey.t.kirsher@intel.com | 1313031292 |  | chelsio: Move the Chelsio drivers  Moves the drivers for the Chelsio chipsets into drivers/net/ethernet/chelsio/ and the necessary Kconfig and Makefile changes.  CC: Divy Le Ray <divy@chelsio.com> CC: Dimitris Michailidis <dm@chelsio.com> CC: Casey Leedom <leedom@chelsio.com> Signed-off-by: Jeff Kirsher <jeffrey.t.kirsher@intel.com>
