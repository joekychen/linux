<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › chelsio › cxgb › common.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>common.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*****************************************************************************</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * File: common.h                                                            *</span>
<span class="cm"> * $Revision: 1.21 $                                                         *</span>
<span class="cm"> * $Date: 2005/06/22 00:43:25 $                                              *</span>
<span class="cm"> * Description:                                                              *</span>
<span class="cm"> *  part of the Chelsio 10Gb Ethernet Driver.                                *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify      *</span>
<span class="cm"> * it under the terms of the GNU General Public License, version 2, as       *</span>
<span class="cm"> * published by the Free Software Foundation.                                *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along   *</span>
<span class="cm"> * with this program; if not, write to the Free Software Foundation, Inc.,   *</span>
<span class="cm"> * 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.                 *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND WITHOUT ANY EXPRESS OR IMPLIED    *</span>
<span class="cm"> * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF      *</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.                     *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * http://www.chelsio.com                                                    *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * Copyright (c) 2003 - 2005 Chelsio Communications, Inc.                    *</span>
<span class="cm"> * All rights reserved.                                                      *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * Maintainers: maintainers@chelsio.com                                      *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * Authors: Dimitrios Michailidis   &lt;dm@chelsio.com&gt;                         *</span>
<span class="cm"> *          Tina Yang               &lt;tainay@chelsio.com&gt;                     *</span>
<span class="cm"> *          Felix Marti             &lt;felix@chelsio.com&gt;                      *</span>
<span class="cm"> *          Scott Bardone           &lt;sbardone@chelsio.com&gt;                   *</span>
<span class="cm"> *          Kurt Ottaway            &lt;kottaway@chelsio.com&gt;                   *</span>
<span class="cm"> *          Frank DiMambro          &lt;frank@chelsio.com&gt;                      *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> * History:                                                                  *</span>
<span class="cm"> *                                                                           *</span>
<span class="cm"> ****************************************************************************/</span>

<span class="cp">#define pr_fmt(fmt) &quot;cxgb: &quot; fmt</span>

<span class="cp">#ifndef _CXGB_COMMON_H_</span>
<span class="cp">#define _CXGB_COMMON_H_</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/ethtool.h&gt;</span>
<span class="cp">#include &lt;linux/if_vlan.h&gt;</span>
<span class="cp">#include &lt;linux/mdio.h&gt;</span>
<span class="cp">#include &lt;linux/crc32.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;linux/pci_ids.h&gt;</span>

<span class="cp">#define DRV_DESCRIPTION &quot;Chelsio 10Gb Ethernet Driver&quot;</span>
<span class="cp">#define DRV_NAME &quot;cxgb&quot;</span>
<span class="cp">#define DRV_VERSION &quot;2.2&quot;</span>

<span class="cp">#define CH_DEVICE(devid, ssid, idx) \</span>
<span class="cp">	{ PCI_VENDOR_ID_CHELSIO, devid, PCI_ANY_ID, ssid, 0, 0, idx }</span>

<span class="cp">#define SUPPORTED_PAUSE       (1 &lt;&lt; 13)</span>
<span class="cp">#define SUPPORTED_LOOPBACK    (1 &lt;&lt; 15)</span>

<span class="cp">#define ADVERTISED_PAUSE      (1 &lt;&lt; 13)</span>
<span class="cp">#define ADVERTISED_ASYM_PAUSE (1 &lt;&lt; 14)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">adapter</span> <span class="n">adapter_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">t1_rx_mode</span> <span class="p">{</span>
       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define t1_rx_mode_promisc(rm)	(rm-&gt;dev-&gt;flags &amp; IFF_PROMISC)</span>
<span class="cp">#define t1_rx_mode_allmulti(rm)	(rm-&gt;dev-&gt;flags &amp; IFF_ALLMULTI)</span>
<span class="cp">#define t1_rx_mode_mc_cnt(rm)	(netdev_mc_count(rm-&gt;dev))</span>
<span class="cp">#define t1_get_netdev(rm)	(rm-&gt;dev)</span>

<span class="cp">#define	MAX_NPORTS 4</span>
<span class="cp">#define PORT_MASK ((1 &lt;&lt; MAX_NPORTS) - 1)</span>
<span class="cp">#define NMTUS      8</span>
<span class="cp">#define TCB_SIZE   128</span>

<span class="cp">#define SPEED_INVALID 0xffff</span>
<span class="cp">#define DUPLEX_INVALID 0xff</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CHBT_BOARD_N110</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_N210</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_7500</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_8000</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT101</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT110</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT210</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT204</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT204V</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHT204E</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_CHN204</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_COUGAR</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_6800</span><span class="p">,</span>
	<span class="n">CHBT_BOARD_SIMUL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CHBT_TERM_FPGA</span><span class="p">,</span>
	<span class="n">CHBT_TERM_T1</span><span class="p">,</span>
	<span class="n">CHBT_TERM_T2</span><span class="p">,</span>
	<span class="n">CHBT_TERM_T3</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CHBT_MAC_CHELSIO_A</span><span class="p">,</span>
	<span class="n">CHBT_MAC_IXF1010</span><span class="p">,</span>
	<span class="n">CHBT_MAC_PM3393</span><span class="p">,</span>
	<span class="n">CHBT_MAC_VSC7321</span><span class="p">,</span>
	<span class="n">CHBT_MAC_DUMMY</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CHBT_PHY_88E1041</span><span class="p">,</span>
	<span class="n">CHBT_PHY_88E1111</span><span class="p">,</span>
	<span class="n">CHBT_PHY_88X2010</span><span class="p">,</span>
	<span class="n">CHBT_PHY_XPAK</span><span class="p">,</span>
	<span class="n">CHBT_PHY_MY3126</span><span class="p">,</span>
	<span class="n">CHBT_PHY_8244</span><span class="p">,</span>
	<span class="n">CHBT_PHY_DUMMY</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">PAUSE_RX</span>      <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PAUSE_TX</span>      <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">PAUSE_AUTONEG</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="cm">/* Revisions of T1 chip */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TERM_T1A</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TERM_T1B</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">TERM_T2</span>    <span class="o">=</span> <span class="mi">3</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sge_params</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmdQ_size</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freelQ_size</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">large_buf_capacity</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_coalesce_usecs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_rx_coalesce_raw</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">default_rx_coalesce_usecs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sample_interval_usecs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">coalesce_enable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">polling</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">chelsio_pci_params</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">speed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">width</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">is_pcix</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tp_params</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cm_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_rx_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_tx_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_rx_pg_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_tx_pg_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_rx_num_pgs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_tx_num_pgs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_coalescing_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">use_5tuple_mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mc5_params</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>       <span class="cm">/* selects MC5 width */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nservers</span><span class="p">;</span>   <span class="cm">/* size of server region */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nroutes</span><span class="p">;</span>    <span class="cm">/* size of routing region */</span>
<span class="p">};</span>

<span class="cm">/* Default MC5 region sizes */</span>
<span class="cp">#define DEFAULT_SERVER_REGION_LEN 256</span>
<span class="cp">#define DEFAULT_RT_REGION_LEN 1024</span>

<span class="k">struct</span> <span class="n">adapter_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sge_params</span> <span class="n">sge</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mc5_params</span> <span class="n">mc5</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tp_params</span>  <span class="n">tp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">chelsio_pci_params</span> <span class="n">pci</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">board_info</span> <span class="o">*</span><span class="n">brd_info</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mtus</span><span class="p">[</span><span class="n">NMTUS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">nports</span><span class="p">;</span>          <span class="cm">/* # of ethernet ports */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">stats_update_period</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">chip_revision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">chip_version</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">is_asic</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">has_msi</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">link_config</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">supported</span><span class="p">;</span>        <span class="cm">/* link capabilities */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">advertising</span><span class="p">;</span>      <span class="cm">/* advertised capabilities */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">requested_speed</span><span class="p">;</span>  <span class="cm">/* speed user has requested */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">speed</span><span class="p">;</span>            <span class="cm">/* actual link speed */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">requested_duplex</span><span class="p">;</span> <span class="cm">/* duplex user has requested */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">duplex</span><span class="p">;</span>           <span class="cm">/* actual link duplex */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">requested_fc</span><span class="p">;</span>     <span class="cm">/* flow control user has requested */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">fc</span><span class="p">;</span>               <span class="cm">/* actual link flow control */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">autoneg</span><span class="p">;</span>          <span class="cm">/* autonegotiating? */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cmac</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">cphy</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">port_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cmac</span> <span class="o">*</span><span class="n">mac</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cphy</span> <span class="o">*</span><span class="n">phy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">link_config</span> <span class="n">link_config</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">netstats</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sge</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">peespi</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">adapter</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">registered_device_map</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">open_device_map</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">msg_enable</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mmio_len</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">ext_intr_handler_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">adapter_params</span> <span class="n">params</span><span class="p">;</span>

	<span class="cm">/* Terminator modules. */</span>
	<span class="k">struct</span> <span class="n">sge</span>    <span class="o">*</span><span class="n">sge</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">peespi</span> <span class="o">*</span><span class="n">espi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">petp</span>   <span class="o">*</span><span class="n">tp</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">napi_struct</span> <span class="n">napi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">port_info</span> <span class="n">port</span><span class="p">[</span><span class="n">MAX_NPORTS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">stats_update_task</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">stats_update_timer</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">tpi_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">work_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">mac_lock</span><span class="p">;</span>

	<span class="cm">/* guards async operations */</span>
	<span class="n">spinlock_t</span> <span class="n">async_lock</span> <span class="n">____cacheline_aligned</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">slow_intr_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">t1powersave</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>                                           <span class="cm">/* adapter flags */</span>
	<span class="n">FULL_INIT_DONE</span>        <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mdio_ops</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gmac</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gphy</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">board_info</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">board</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">port_number</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">caps</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">chip_term</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">chip_mac</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">chip_phy</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">clock_core</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">clock_mc3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">clock_mc4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">espi_nports</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">clock_elmer0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">mdio_mdien</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">mdio_mdiinv</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">mdio_mdc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="n">mdio_phybaseaddr</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">gmac</span>      <span class="o">*</span><span class="n">gmac</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">gphy</span>      <span class="o">*</span><span class="n">gphy</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">mdio_ops</span>  <span class="o">*</span><span class="n">mdio_ops</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span>             <span class="o">*</span><span class="n">desc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">t1_is_asic</span><span class="p">(</span><span class="k">const</span> <span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">is_asic</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pci_device_id</span> <span class="n">t1_pci_tbl</span><span class="p">[];</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">adapter_matches_type</span><span class="p">(</span><span class="k">const</span> <span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span>
				       <span class="kt">int</span> <span class="n">version</span><span class="p">,</span> <span class="kt">int</span> <span class="n">revision</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">chip_version</span> <span class="o">==</span> <span class="n">version</span> <span class="o">&amp;&amp;</span>
	       <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">chip_revision</span> <span class="o">==</span> <span class="n">revision</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define t1_is_T1B(adap) adapter_matches_type(adap, CHBT_TERM_T1, TERM_T1B)</span>
<span class="cp">#define is_T2(adap)     adapter_matches_type(adap, CHBT_TERM_T2, TERM_T2)</span>

<span class="cm">/* Returns true if an adapter supports VLAN acceleration and TSO */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">vlan_tso_capable</span><span class="p">(</span><span class="k">const</span> <span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">t1_is_T1B</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define for_each_port(adapter, iter) \</span>
<span class="cp">	for (iter = 0; iter &lt; (adapter)-&gt;params.nports; ++iter)</span>

<span class="cp">#define board_info(adapter) ((adapter)-&gt;params.brd_info)</span>
<span class="cp">#define is_10G(adapter) (board_info(adapter)-&gt;caps &amp; SUPPORTED_10000baseT_Full)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">core_ticks_per_usec</span><span class="p">(</span><span class="k">const</span> <span class="n">adapter_t</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">board_info</span><span class="p">(</span><span class="n">adap</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">clock_core</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">__t1_tpi_read</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">valp</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__t1_tpi_write</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_tpi_write</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_tpi_read</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_interrupts_enable</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_interrupts_disable</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_interrupts_clear</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_elmer0_ext_intr_handler</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_elmer0_ext_intr</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_slow_intr_handler</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_link_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">cphy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cmac</span> <span class="o">*</span><span class="n">mac</span><span class="p">,</span> <span class="k">struct</span> <span class="n">link_config</span> <span class="o">*</span><span class="n">lc</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">board_info</span> <span class="o">*</span><span class="n">t1_get_board_info</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">board_id</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">board_info</span> <span class="o">*</span><span class="n">t1_get_board_info_from_ids</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">devid</span><span class="p">,</span>
						    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ssid</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_seeprom_read</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">__le32</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_get_board_rev</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">board_info</span> <span class="o">*</span><span class="n">bi</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">adapter_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_init_hw_modules</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">t1_init_sw_modules</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">board_info</span> <span class="o">*</span><span class="n">bi</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_free_sw_modules</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_fatal_err</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_link_changed</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port_id</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">t1_link_negotiated</span><span class="p">(</span><span class="n">adapter_t</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">link_stat</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">duplex</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pause</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* _CXGB_COMMON_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
