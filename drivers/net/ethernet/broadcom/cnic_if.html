<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › broadcom › cnic_if.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cnic_if.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* cnic_if.h: Broadcom CNIC core network driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2006-2012 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>


<span class="cp">#ifndef CNIC_IF_H</span>
<span class="cp">#define CNIC_IF_H</span>

<span class="cp">#define CNIC_MODULE_VERSION	&quot;2.5.10&quot;</span>
<span class="cp">#define CNIC_MODULE_RELDATE	&quot;March 21, 2012&quot;</span>

<span class="cp">#define CNIC_ULP_RDMA		0</span>
<span class="cp">#define CNIC_ULP_ISCSI		1</span>
<span class="cp">#define CNIC_ULP_FCOE		2</span>
<span class="cp">#define CNIC_ULP_L4		3</span>
<span class="cp">#define MAX_CNIC_ULP_TYPE_EXT	3</span>
<span class="cp">#define MAX_CNIC_ULP_TYPE	4</span>

<span class="k">struct</span> <span class="n">kwqe</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">kwqe_op_flag</span><span class="p">;</span>

<span class="cp">#define KWQE_QID_SHIFT		8</span>
<span class="cp">#define KWQE_OPCODE_MASK	0x00ff0000</span>
<span class="cp">#define KWQE_OPCODE_SHIFT	16</span>
<span class="cp">#define KWQE_OPCODE(x)		((x &amp; KWQE_OPCODE_MASK) &gt;&gt; KWQE_OPCODE_SHIFT)</span>
<span class="cp">#define KWQE_LAYER_MASK			0x70000000</span>
<span class="cp">#define KWQE_LAYER_SHIFT		28</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L2	(2&lt;&lt;28)</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L3	(3&lt;&lt;28)</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L4	(4&lt;&lt;28)</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L5_RDMA	(5&lt;&lt;28)</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L5_ISCSI	(6&lt;&lt;28)</span>
<span class="cp">#define KWQE_FLAGS_LAYER_MASK_L5_FCOE	(7&lt;&lt;28)</span>

	<span class="n">u32</span> <span class="n">kwqe_info0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info3</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info5</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info6</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kwqe_16</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">kwqe_info0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kwqe_info3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kcqe</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">kcqe_info0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info2</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info3</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info5</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_info6</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">kcqe_op_flag</span><span class="p">;</span>
		<span class="cp">#define KCQE_RAMROD_COMPLETION		(0x1&lt;&lt;27) </span><span class="cm">/* Everest */</span><span class="cp"></span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK		(0x7&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_MISC	(0&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L2	(2&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L3	(3&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L4	(4&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L5_RDMA	(5&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L5_ISCSI	(6&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_LAYER_MASK_L5_FCOE	(7&lt;&lt;28)</span>
		<span class="cp">#define KCQE_FLAGS_NEXT 		(1&lt;&lt;31)</span>
		<span class="cp">#define KCQE_FLAGS_OPCODE_MASK		(0xff&lt;&lt;16)</span>
		<span class="cp">#define KCQE_FLAGS_OPCODE_SHIFT		(16)</span>
		<span class="cp">#define KCQE_OPCODE(op)			\</span>
<span class="cp">		(((op) &amp; KCQE_FLAGS_OPCODE_MASK) &gt;&gt; KCQE_FLAGS_OPCODE_SHIFT)</span>
<span class="p">};</span>

<span class="cp">#define MAX_CNIC_CTL_DATA	64</span>
<span class="cp">#define MAX_DRV_CTL_DATA	64</span>

<span class="cp">#define CNIC_CTL_STOP_CMD		1</span>
<span class="cp">#define CNIC_CTL_START_CMD		2</span>
<span class="cp">#define CNIC_CTL_COMPLETION_CMD		3</span>
<span class="cp">#define CNIC_CTL_STOP_ISCSI_CMD		4</span>
<span class="cp">#define CNIC_CTL_FCOE_STATS_GET_CMD	5</span>
<span class="cp">#define CNIC_CTL_ISCSI_STATS_GET_CMD	6</span>

<span class="cp">#define DRV_CTL_IO_WR_CMD		0x101</span>
<span class="cp">#define DRV_CTL_IO_RD_CMD		0x102</span>
<span class="cp">#define DRV_CTL_CTX_WR_CMD		0x103</span>
<span class="cp">#define DRV_CTL_CTXTBL_WR_CMD		0x104</span>
<span class="cp">#define DRV_CTL_RET_L5_SPQ_CREDIT_CMD	0x105</span>
<span class="cp">#define DRV_CTL_START_L2_CMD		0x106</span>
<span class="cp">#define DRV_CTL_STOP_L2_CMD		0x107</span>
<span class="cp">#define DRV_CTL_RET_L2_SPQ_CREDIT_CMD	0x10c</span>
<span class="cp">#define DRV_CTL_ISCSI_STOPPED_CMD	0x10d</span>
<span class="cp">#define DRV_CTL_ULP_REGISTER_CMD	0x10e</span>
<span class="cp">#define DRV_CTL_ULP_UNREGISTER_CMD	0x10f</span>

<span class="k">struct</span> <span class="n">cnic_ctl_completion</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">cid</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">opcode</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">error</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_ctl_info</span> <span class="p">{</span>
	<span class="kt">int</span>	<span class="n">cmd</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">cnic_ctl_completion</span> <span class="n">comp</span><span class="p">;</span>
		<span class="kt">char</span> <span class="n">bytes</span><span class="p">[</span><span class="n">MAX_CNIC_CTL_DATA</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drv_ctl_spq_credit</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">credit_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drv_ctl_io</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">cid_addr</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">offset</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">data</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">dma_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drv_ctl_l2_ring</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">client_id</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drv_ctl_info</span> <span class="p">{</span>
	<span class="kt">int</span>	<span class="n">cmd</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">drv_ctl_spq_credit</span> <span class="n">credit</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">drv_ctl_io</span> <span class="n">io</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">drv_ctl_l2_ring</span> <span class="n">ring</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">ulp_type</span><span class="p">;</span>
		<span class="kt">char</span> <span class="n">bytes</span><span class="p">[</span><span class="n">MAX_DRV_CTL_DATA</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_ops</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">module</span>	<span class="o">*</span><span class="n">cnic_owner</span><span class="p">;</span>
	<span class="cm">/* Calls to these functions are protected by RCU.  When</span>
<span class="cm">	 * unregistering, we wait for any calls to complete before</span>
<span class="cm">	 * continuing.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">cnic_handler</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">cnic_ctl</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cnic_ctl_info</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define MAX_CNIC_VEC	8</span>

<span class="k">struct</span> <span class="n">cnic_irq</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">vector</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">status_blk</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">status_blk_num</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">status_blk_num2</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">irq_flags</span><span class="p">;</span>
<span class="cp">#define CNIC_IRQ_FL_MSIX		0x00000001</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_eth_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">module</span>	<span class="o">*</span><span class="n">drv_owner</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">drv_state</span><span class="p">;</span>
<span class="cp">#define CNIC_DRV_STATE_REGD		0x00000001</span>
<span class="cp">#define CNIC_DRV_STATE_USING_MSIX	0x00000002</span>
<span class="cp">#define CNIC_DRV_STATE_NO_ISCSI_OOO	0x00000004</span>
<span class="cp">#define CNIC_DRV_STATE_NO_ISCSI		0x00000008</span>
<span class="cp">#define CNIC_DRV_STATE_NO_FCOE		0x00000010</span>
	<span class="n">u32</span>		<span class="n">chip_id</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_kwqe_pending</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>	<span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">io_base</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">io_base2</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">void</span>	<span class="o">*</span><span class="n">iro_arr</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">ctx_tbl_offset</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">ctx_tbl_len</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">ctx_blk_size</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">starting_cid</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_iscsi_conn</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_fcoe_conn</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_rdma_conn</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fcoe_init_cid</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fcoe_wwn_port_name_hi</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fcoe_wwn_port_name_lo</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fcoe_wwn_node_name_hi</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fcoe_wwn_node_name_lo</span><span class="p">;</span>

	<span class="n">u16</span>		<span class="n">iscsi_l2_client_id</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">iscsi_l2_cid</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">iscsi_mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>

	<span class="kt">int</span>		<span class="n">num_irq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cnic_irq</span>	<span class="n">irq_arr</span><span class="p">[</span><span class="n">MAX_CNIC_VEC</span><span class="p">];</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">drv_register_cnic</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">cnic_ops</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">drv_unregister_cnic</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">drv_submit_kwqes_32</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">kwqe</span> <span class="o">*</span><span class="p">[],</span> <span class="n">u32</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">drv_submit_kwqes_16</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span>
					       <span class="k">struct</span> <span class="n">kwqe_16</span> <span class="o">*</span><span class="p">[],</span> <span class="n">u32</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">drv_ctl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">drv_ctl_info</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">union</span> <span class="n">drv_info_to_mcp</span>	<span class="o">*</span><span class="n">addr_drv_info_to_mcp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_sockaddr</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">sockaddr_in</span>	<span class="n">v4</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">sockaddr_in6</span>	<span class="n">v6</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">local</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">sockaddr_in</span>	<span class="n">v4</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">sockaddr_in6</span>	<span class="n">v6</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">remote</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_sock</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">void</span>	<span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">src_ip</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span>	<span class="n">dst_ip</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u16</span>	<span class="n">src_port</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">dst_port</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">vlan_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">old_ha</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ha</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u32</span>	<span class="n">mtu</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">cid</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">l5_cid</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">pg_cid</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">ulp_type</span><span class="p">;</span>

	<span class="n">u32</span>	<span class="n">ka_timeout</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">ka_interval</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">ka_max_probe_count</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">tos</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">ttl</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">snd_seq_scale</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rcv_buf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">snd_buf</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">seed</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">tcp_flags</span><span class="p">;</span>
<span class="cp">#define SK_TCP_NO_DELAY_ACK	0x1</span>
<span class="cp">#define SK_TCP_KEEP_ALIVE	0x2</span>
<span class="cp">#define SK_TCP_NAGLE		0x4</span>
<span class="cp">#define SK_TCP_TIMESTAMP	0x8</span>
<span class="cp">#define SK_TCP_SACK		0x10</span>
<span class="cp">#define SK_TCP_SEG_SCALING	0x20</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define SK_F_INUSE		0</span>
<span class="cp">#define SK_F_OFFLD_COMPLETE	1</span>
<span class="cp">#define SK_F_OFFLD_SCHED	2</span>
<span class="cp">#define SK_F_PG_OFFLD_COMPLETE	3</span>
<span class="cp">#define SK_F_CONNECT_START	4</span>
<span class="cp">#define SK_F_IPV6		5</span>
<span class="cp">#define SK_F_CLOSING		7</span>
<span class="cp">#define SK_F_HW_ERR		8</span>

	<span class="n">atomic_t</span> <span class="n">ref_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kwqe</span> <span class="n">kwqe1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kwqe</span> <span class="n">kwqe2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kwqe</span> <span class="n">kwqe3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cnic_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span>	<span class="o">*</span><span class="n">netdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>		<span class="o">*</span><span class="n">pcidev</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>		<span class="o">*</span><span class="n">regview</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">list</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">register_device</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ulp_type</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">unregister_device</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ulp_type</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">submit_kwqes</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kwqe</span> <span class="o">*</span><span class="n">wqes</span><span class="p">[],</span>
				<span class="n">u32</span> <span class="n">num_wqes</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">submit_kwqes_16</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kwqe_16</span> <span class="o">*</span><span class="n">wqes</span><span class="p">[],</span>
				<span class="n">u32</span> <span class="n">num_wqes</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_create</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">**</span><span class="p">,</span>
			 <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_destroy</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_connect</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cnic_sockaddr</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_abort</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_close</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">cm_select_dev</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ulp_type</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">iscsi_nl_msg_recv</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">msg_type</span><span class="p">,</span>
				 <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data_size</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
<span class="cp">#define CNIC_F_CNIC_UP		1</span>
<span class="cp">#define CNIC_F_BNX2_CLASS	3</span>
<span class="cp">#define CNIC_F_BNX2X_CLASS	4</span>
	<span class="n">atomic_t</span>	<span class="n">ref_count</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">mac_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

	<span class="kt">int</span>		<span class="n">max_iscsi_conn</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">max_fcoe_conn</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">max_rdma_conn</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">drv_info_to_mcp</span>	<span class="o">*</span><span class="n">stats_addr</span><span class="p">;</span>

	<span class="kt">void</span>		<span class="o">*</span><span class="n">cnic_priv</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CNIC_WR(dev, off, val)		writel(val, dev-&gt;regview + off)</span>
<span class="cp">#define CNIC_WR16(dev, off, val)	writew(val, dev-&gt;regview + off)</span>
<span class="cp">#define CNIC_WR8(dev, off, val)		writeb(val, dev-&gt;regview + off)</span>
<span class="cp">#define CNIC_RD(dev, off)		readl(dev-&gt;regview + off)</span>
<span class="cp">#define CNIC_RD16(dev, off)		readw(dev-&gt;regview + off)</span>

<span class="k">struct</span> <span class="n">cnic_ulp_ops</span> <span class="p">{</span>
	<span class="cm">/* Calls to these functions are protected by RCU.  When</span>
<span class="cm">	 * unregistering, we wait for any calls to complete before</span>
<span class="cm">	 * continuing.</span>
<span class="cm">	 */</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cnic_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cnic_exit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cnic_start</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cnic_stop</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">indicate_kcqes</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kcqe</span> <span class="o">*</span><span class="n">cqes</span><span class="p">[],</span>
				<span class="n">u32</span> <span class="n">num_cqes</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">indicate_netevent</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">event</span><span class="p">,</span> <span class="n">u16</span> <span class="n">vid</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_connect_complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_close_complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_abort_complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_remote_close</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cm_remote_abort</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cnic_sock</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">iscsi_nl_send_msg</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">msg_type</span><span class="p">,</span>
				  <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data_size</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">cnic_get_stats</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ulp_ctx</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">ref_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cnic_register_driver</span><span class="p">(</span><span class="kt">int</span> <span class="n">ulp_type</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cnic_ulp_ops</span> <span class="o">*</span><span class="n">ulp_ops</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cnic_unregister_driver</span><span class="p">(</span><span class="kt">int</span> <span class="n">ulp_type</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">cnic_eth_dev</span> <span class="o">*</span><span class="n">bnx2_cnic_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cnic_eth_dev</span> <span class="o">*</span><span class="n">bnx2x_cnic_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
