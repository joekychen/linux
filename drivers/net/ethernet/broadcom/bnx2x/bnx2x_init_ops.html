<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › broadcom › bnx2x › bnx2x_init_ops.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>bnx2x_init_ops.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* bnx2x_init_ops.h: Broadcom Everest network driver.</span>
<span class="cm"> *               Static functions needed during the initialization.</span>
<span class="cm"> *               This file is &quot;included&quot; in bnx2x_main.c.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2007-2012 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * Maintained by: Eilon Greenstein &lt;eilong@broadcom.com&gt;</span>
<span class="cm"> * Written by: Vladislav Zolotarov &lt;vladz@broadcom.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef BNX2X_INIT_OPS_H</span>
<span class="cp">#define BNX2X_INIT_OPS_H</span>


<span class="cp">#ifndef BP_ILT</span>
<span class="cp">#define BP_ILT(bp)	NULL</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BP_FUNC</span>
<span class="cp">#define BP_FUNC(bp)	0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BP_PORT</span>
<span class="cp">#define BP_PORT(bp)	0</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BNX2X_ILT_FREE</span>
<span class="cp">#define BNX2X_ILT_FREE(x, y, sz)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef BNX2X_ILT_ZALLOC</span>
<span class="cp">#define BNX2X_ILT_ZALLOC(x, y, sz)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef ILOG2</span>
<span class="cp">#define ILOG2(x)	x</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">bnx2x_gunzip</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">zbuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">bnx2x_reg_wr_ind</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">bnx2x_write_dmae_phys_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				      <span class="n">dma_addr_t</span> <span class="n">phys_addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">len</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_str_wr</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
			      <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_ind_wr</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
			      <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">bnx2x_reg_wr_ind</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_write_big_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span>
				<span class="n">u8</span> <span class="n">wb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dmae_ready</span><span class="p">)</span>
		<span class="n">bnx2x_write_dmae_phys_len</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">GUNZIP_PHYS</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* in E1 chips BIOS initiated ZLR may interrupt widebus writes */</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">wb</span> <span class="o">&amp;&amp;</span> <span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">bnx2x_init_ind_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* in later chips PXP root complex handles BIOS ZLR w/o interrupting */</span>
	<span class="k">else</span>
		<span class="n">bnx2x_init_str_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_fill</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fill</span><span class="p">,</span>
			    <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">wb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">buf_len</span> <span class="o">=</span> <span class="p">(((</span><span class="n">len</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">FW_BUF_SIZE</span><span class="p">)</span> <span class="o">?</span> <span class="n">FW_BUF_SIZE</span> <span class="o">:</span> <span class="p">(</span><span class="n">len</span><span class="o">*</span><span class="mi">4</span><span class="p">));</span>
	<span class="n">u32</span> <span class="n">buf_len32</span> <span class="o">=</span> <span class="n">buf_len</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">fill</span><span class="p">,</span> <span class="n">buf_len</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">buf_len32</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">cur_len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">buf_len32</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>

		<span class="n">bnx2x_write_big_buf</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">cur_len</span><span class="p">,</span> <span class="n">wb</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_write_big_buf_wb</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dmae_ready</span><span class="p">)</span>
		<span class="n">bnx2x_write_dmae_phys_len</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">GUNZIP_PHYS</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* in E1 chips BIOS initiated ZLR may interrupt widebus writes */</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">bnx2x_init_ind_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* in later chips PXP root complex handles BIOS ZLR w/o interrupting */</span>
	<span class="k">else</span>
		<span class="n">bnx2x_init_str_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">),</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_wr_64</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
			     <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len64</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">buf_len32</span> <span class="o">=</span> <span class="n">FW_BUF_SIZE</span><span class="o">/</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span> <span class="o">=</span> <span class="n">len64</span><span class="o">*</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">data64</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* 64 bit value is in a blob: first low DWORD, then high DWORD */</span>
	<span class="n">data64</span> <span class="o">=</span> <span class="n">HILO_U64</span><span class="p">((</span><span class="o">*</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">));</span>

	<span class="n">len64</span> <span class="o">=</span> <span class="n">min</span><span class="p">((</span><span class="n">u32</span><span class="p">)(</span><span class="n">FW_BUF_SIZE</span><span class="o">/</span><span class="mi">8</span><span class="p">),</span> <span class="n">len64</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len64</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="p">((</span><span class="n">u64</span> <span class="o">*</span><span class="p">)(</span><span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">)))</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

		<span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">data64</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">buf_len32</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">cur_len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">buf_len32</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="n">i</span><span class="p">);</span>

		<span class="n">bnx2x_write_big_buf_wb</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">cur_len</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*********************************************************</span>
<span class="cm">   There are different blobs for each PRAM section.</span>
<span class="cm">   In addition, each blob write operation is divided into a few operations</span>
<span class="cm">   in order to decrease the amount of phys. contiguous buffer needed.</span>
<span class="cm">   Thus, when we select a blob the address may be with some offset</span>
<span class="cm">   from the beginning of PRAM section.</span>
<span class="cm">   The same holds for the INT_TABLE sections.</span>
<span class="cm">**********************************************************/</span>
<span class="cp">#define IF_IS_INT_TABLE_ADDR(base, addr) \</span>
<span class="cp">			if (((base) &lt;= (addr)) &amp;&amp; ((base) + 0x400 &gt;= (addr)))</span>

<span class="cp">#define IF_IS_PRAM_ADDR(base, addr) \</span>
<span class="cp">			if (((base) &lt;= (addr)) &amp;&amp; ((base) + 0x40000 &gt;= (addr)))</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="nf">bnx2x_sel_blob</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
				<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IF_IS_INT_TABLE_ADDR</span><span class="p">(</span><span class="n">TSEM_REG_INT_TABLE</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_TSEM_INT_TABLE_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_INT_TABLE_ADDR</span><span class="p">(</span><span class="n">CSEM_REG_INT_TABLE</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_CSEM_INT_TABLE_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_INT_TABLE_ADDR</span><span class="p">(</span><span class="n">USEM_REG_INT_TABLE</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_USEM_INT_TABLE_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_INT_TABLE_ADDR</span><span class="p">(</span><span class="n">XSEM_REG_INT_TABLE</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_XSEM_INT_TABLE_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_PRAM_ADDR</span><span class="p">(</span><span class="n">TSEM_REG_PRAM</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_TSEM_PRAM_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_PRAM_ADDR</span><span class="p">(</span><span class="n">CSEM_REG_PRAM</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_CSEM_PRAM_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_PRAM_ADDR</span><span class="p">(</span><span class="n">USEM_REG_PRAM</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_USEM_PRAM_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IF_IS_PRAM_ADDR</span><span class="p">(</span><span class="n">XSEM_REG_PRAM</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="n">INIT_XSEM_PRAM_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_wr_wb</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span>
			     <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bp</span><span class="o">-&gt;</span><span class="n">dmae_ready</span><span class="p">)</span>
		<span class="n">VIRT_WR_DMAE_LEN</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* in E1 chips BIOS initiated ZLR may interrupt widebus writes */</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">bnx2x_init_ind_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* in later chips PXP root complex handles BIOS ZLR w/o interrupting */</span>
	<span class="k">else</span>
		<span class="n">bnx2x_init_str_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_wr_64</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val_lo</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">val_hi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">wb_write</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">wb_write</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_lo</span><span class="p">;</span>
	<span class="n">wb_write</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_hi</span><span class="p">;</span>
	<span class="n">REG_WR_DMAE_LEN</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">wb_write</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_wr_zp</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="n">blob_off</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">bnx2x_sel_blob</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">blob_off</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_gunzip</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* gunzip_outlen is in dwords */</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">GUNZIP_OUTLEN</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">))[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">cpu_to_le32</span><span class="p">(((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">GUNZIP_BUF</span><span class="p">(</span><span class="n">bp</span><span class="p">))[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">bnx2x_write_big_buf_wb</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u32</span> <span class="n">block</span><span class="p">,</span> <span class="n">u32</span> <span class="n">stage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">op_start</span> <span class="o">=</span>
		<span class="n">INIT_OPS_OFFSETS</span><span class="p">(</span><span class="n">bp</span><span class="p">)[</span><span class="n">BLOCK_OPS_IDX</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span>
						     <span class="n">STAGE_START</span><span class="p">)];</span>
	<span class="n">u16</span> <span class="n">op_end</span> <span class="o">=</span>
		<span class="n">INIT_OPS_OFFSETS</span><span class="p">(</span><span class="n">bp</span><span class="p">)[</span><span class="n">BLOCK_OPS_IDX</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span>
						     <span class="n">STAGE_END</span><span class="p">)];</span>
	<span class="k">union</span> <span class="n">init_op</span> <span class="o">*</span><span class="n">op</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">op_idx</span><span class="p">,</span> <span class="n">op_type</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">data_base</span><span class="p">;</span>

	<span class="cm">/* If empty block */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">op_start</span> <span class="o">==</span> <span class="n">op_end</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">data_base</span> <span class="o">=</span> <span class="n">INIT_DATA</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">op_idx</span> <span class="o">=</span> <span class="n">op_start</span><span class="p">;</span> <span class="n">op_idx</span> <span class="o">&lt;</span> <span class="n">op_end</span><span class="p">;</span> <span class="n">op_idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">op</span> <span class="o">=</span> <span class="p">(</span><span class="k">union</span> <span class="n">init_op</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="p">(</span><span class="n">INIT_OPS</span><span class="p">(</span><span class="n">bp</span><span class="p">)[</span><span class="n">op_idx</span><span class="p">]);</span>
		<span class="cm">/* Get generic data */</span>
		<span class="n">op_type</span> <span class="o">=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">raw</span><span class="p">.</span><span class="n">op</span><span class="p">;</span>
		<span class="n">addr</span> <span class="o">=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">raw</span><span class="p">.</span><span class="n">offset</span><span class="p">;</span>
		<span class="cm">/* Get data that&#39;s used for OP_SW, OP_WB, OP_FW, OP_ZP and</span>
<span class="cm">		 * OP_WR64 (we assume that op_arr_write and op_write have the</span>
<span class="cm">		 * same structure).</span>
<span class="cm">		 */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">arr_wr</span><span class="p">.</span><span class="n">data_len</span><span class="p">;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">data_base</span> <span class="o">+</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">arr_wr</span><span class="p">.</span><span class="n">data_off</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">op_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">OP_RD</span>:
			<span class="n">REG_RD</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_WR</span>:
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">write</span><span class="p">.</span><span class="n">val</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_SW</span>:
			<span class="n">bnx2x_init_str_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_WB</span>:
			<span class="n">bnx2x_init_wr_wb</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_ZR</span>:
			<span class="n">bnx2x_init_fill</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">zero</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_WB_ZR</span>:
			<span class="n">bnx2x_init_fill</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">zero</span><span class="p">.</span><span class="n">len</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_ZP</span>:
			<span class="n">bnx2x_init_wr_zp</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
					 <span class="n">op</span><span class="o">-&gt;</span><span class="n">arr_wr</span><span class="p">.</span><span class="n">data_off</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_WR_64</span>:
			<span class="n">bnx2x_init_wr_64</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_IF_MODE_AND</span>:
			<span class="cm">/* if any of the flags doesn&#39;t match, skip the</span>
<span class="cm">			 * conditional block.</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">INIT_MODE_FLAGS</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">&amp;</span>
				<span class="n">op</span><span class="o">-&gt;</span><span class="n">if_mode</span><span class="p">.</span><span class="n">mode_bit_map</span><span class="p">)</span> <span class="o">!=</span>
				<span class="n">op</span><span class="o">-&gt;</span><span class="n">if_mode</span><span class="p">.</span><span class="n">mode_bit_map</span><span class="p">)</span>
				<span class="n">op_idx</span> <span class="o">+=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">if_mode</span><span class="p">.</span><span class="n">cmd_offset</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OP_IF_MODE_OR</span>:
			<span class="cm">/* if all the flags don&#39;t match, skip the conditional</span>
<span class="cm">			 * block.</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">INIT_MODE_FLAGS</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">&amp;</span>
				<span class="n">op</span><span class="o">-&gt;</span><span class="n">if_mode</span><span class="p">.</span><span class="n">mode_bit_map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">op_idx</span> <span class="o">+=</span> <span class="n">op</span><span class="o">-&gt;</span><span class="n">if_mode</span><span class="p">.</span><span class="n">cmd_offset</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="cm">/* Should never get here! */</span>

			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************</span>
<span class="cm">* PXP Arbiter</span>
<span class="cm">****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * This code configures the PCI read/write arbiter</span>
<span class="cm"> * which implements a weighted round robin</span>
<span class="cm"> * between the virtual queues in the chip.</span>
<span class="cm"> *</span>
<span class="cm"> * The values were derived for each PCI max payload and max request size.</span>
<span class="cm"> * since max payload and max request size are only known at run time,</span>
<span class="cm"> * this is done as a separate init stage.</span>
<span class="cm"> */</span>

<span class="cp">#define NUM_WR_Q			13</span>
<span class="cp">#define NUM_RD_Q			29</span>
<span class="cp">#define MAX_RD_ORD			3</span>
<span class="cp">#define MAX_WR_ORD			2</span>

<span class="cm">/* configuration for one arbiter queue */</span>
<span class="k">struct</span> <span class="n">arb_line</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">add</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ubound</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* derived configuration for each read queue for each max request size */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">arb_line</span> <span class="n">read_arb_data</span><span class="p">[</span><span class="n">NUM_RD_Q</span><span class="p">][</span><span class="n">MAX_RD_ORD</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 1 */</span>	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span>  <span class="mi">4</span><span class="p">}</span>  <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">}</span>  <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">41</span><span class="p">}</span> <span class="p">},</span>
<span class="cm">/* 10 */</span><span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
<span class="cm">/* 20 */</span><span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">41</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">},</span> <span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">120</span><span class="p">}</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* derived configuration for each write queue for each max request size */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">arb_line</span> <span class="n">write_arb_data</span><span class="p">[</span><span class="n">NUM_WR_Q</span><span class="p">][</span><span class="n">MAX_WR_ORD</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 1 */</span>	<span class="p">{</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span>  <span class="mi">3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span>  <span class="p">{</span><span class="mi">4</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">11</span><span class="p">}</span> <span class="p">},</span>
<span class="cm">/* 10 */</span><span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">19</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">21</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">6</span><span class="p">},</span>  <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">11</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">11</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">25</span><span class="p">},</span> <span class="p">{</span><span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">41</span><span class="p">},</span> <span class="p">{</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">81</span><span class="p">}</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* register addresses for read queues */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">arb_line</span> <span class="n">read_arb_addr</span><span class="p">[</span><span class="n">NUM_RD_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 1 */</span>	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L0</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD0</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND0</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L1</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD1</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB1</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L2</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD2</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB2</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L3</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD3</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB3</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L4</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD4</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND4</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L5</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD5</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND5</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L6</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD6</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB6</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L7</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD7</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB7</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L8</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD8</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB8</span><span class="p">},</span>
<span class="cm">/* 10 */</span><span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L9</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD9</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB9</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L10</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD10</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB10</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L11</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD11</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB11</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L12</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD12</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND12</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L13</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD13</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L14</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD14</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND14</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L15</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD15</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND15</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L16</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD16</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND16</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L17</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD17</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND17</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L18</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD18</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND18</span><span class="p">},</span>
<span class="cm">/* 20 */</span><span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L19</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD19</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND19</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L20</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD20</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND20</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L22</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD22</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND22</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L23</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD23</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND23</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L24</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD24</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND24</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L25</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD25</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND25</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L26</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD26</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND26</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_RD_L27</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_RD_ADD27</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_RD_UBOUND27</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L28</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD28</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB28</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* register addresses for write queues */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">arb_line</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">NUM_WR_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 1 */</span>	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L1</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD1</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB1</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L2</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD2</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB2</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L3</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD3</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB3</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L6</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD6</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB6</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L7</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD7</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB7</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L8</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD8</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB8</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L9</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD9</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB9</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L10</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD10</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB10</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L11</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD11</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB11</span><span class="p">},</span>
<span class="cm">/* 10 */</span><span class="p">{</span><span class="n">PXP2_REG_PSWRQ_BW_L28</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_ADD28</span><span class="p">,</span>
		<span class="n">PXP2_REG_PSWRQ_BW_UB28</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_WR_L29</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_WR_ADD29</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_WR_UBOUND29</span><span class="p">},</span>
	<span class="p">{</span><span class="n">PXP2_REG_RQ_BW_WR_L30</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_BW_WR_ADD30</span><span class="p">,</span>
		<span class="n">PXP2_REG_RQ_BW_WR_UBOUND30</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_init_pxp_arb</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">r_order</span><span class="p">,</span>
			       <span class="kt">int</span> <span class="n">w_order</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">r_order</span> <span class="o">&gt;</span> <span class="n">MAX_RD_ORD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DP</span><span class="p">(</span><span class="n">NETIF_MSG_HW</span><span class="p">,</span> <span class="s">&quot;read order of %d  order adjusted to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">r_order</span><span class="p">,</span> <span class="n">MAX_RD_ORD</span><span class="p">);</span>
		<span class="n">r_order</span> <span class="o">=</span> <span class="n">MAX_RD_ORD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">w_order</span> <span class="o">&gt;</span> <span class="n">MAX_WR_ORD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">DP</span><span class="p">(</span><span class="n">NETIF_MSG_HW</span><span class="p">,</span> <span class="s">&quot;write order of %d  order adjusted to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">w_order</span><span class="p">,</span> <span class="n">MAX_WR_ORD</span><span class="p">);</span>
		<span class="n">w_order</span> <span class="o">=</span> <span class="n">MAX_WR_ORD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CHIP_REV_IS_FPGA</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">DP</span><span class="p">(</span><span class="n">NETIF_MSG_HW</span><span class="p">,</span> <span class="s">&quot;write order adjusted to 1 for FPGA</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">w_order</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">DP</span><span class="p">(</span><span class="n">NETIF_MSG_HW</span><span class="p">,</span> <span class="s">&quot;read order %d  write order %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">r_order</span><span class="p">,</span> <span class="n">w_order</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_RD_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">read_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span> <span class="n">read_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">l</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">read_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">add</span><span class="p">,</span>
		       <span class="n">read_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">add</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">read_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ubound</span><span class="p">,</span>
		       <span class="n">read_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">ubound</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_WR_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span> <span class="o">==</span> <span class="n">PXP2_REG_RQ_BW_WR_L29</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">(</span><span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span> <span class="o">==</span> <span class="n">PXP2_REG_RQ_BW_WR_L30</span><span class="p">))</span> <span class="p">{</span>

			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span>
			       <span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">l</span><span class="p">);</span>

			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">add</span><span class="p">,</span>
			       <span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">add</span><span class="p">);</span>

			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ubound</span><span class="p">,</span>
			       <span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">ubound</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

			<span class="n">val</span> <span class="o">=</span> <span class="n">REG_RD</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">);</span>
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">l</span><span class="p">,</span>
			       <span class="n">val</span> <span class="o">|</span> <span class="p">(</span><span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">));</span>

			<span class="n">val</span> <span class="o">=</span> <span class="n">REG_RD</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">add</span><span class="p">);</span>
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">add</span><span class="p">,</span>
			       <span class="n">val</span> <span class="o">|</span> <span class="p">(</span><span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">add</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">));</span>

			<span class="n">val</span> <span class="o">=</span> <span class="n">REG_RD</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ubound</span><span class="p">);</span>
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">write_arb_addr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ubound</span><span class="p">,</span>
			       <span class="n">val</span> <span class="o">|</span> <span class="p">(</span><span class="n">write_arb_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">ubound</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">val</span> <span class="o">=</span>  <span class="n">write_arb_data</span><span class="p">[</span><span class="n">NUM_WR_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">add</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">+=</span> <span class="n">write_arb_data</span><span class="p">[</span><span class="n">NUM_WR_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">ubound</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">+=</span> <span class="n">write_arb_data</span><span class="p">[</span><span class="n">NUM_WR_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">w_order</span><span class="p">].</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">;</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_RD</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span>  <span class="n">read_arb_data</span><span class="p">[</span><span class="n">NUM_RD_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">add</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">+=</span> <span class="n">read_arb_data</span><span class="p">[</span><span class="n">NUM_RD_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">ubound</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">+=</span> <span class="n">read_arb_data</span><span class="p">[</span><span class="n">NUM_RD_Q</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">r_order</span><span class="p">].</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">;</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_PSWRQ_BW_WR</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_WR_MBS0</span><span class="p">,</span> <span class="n">w_order</span><span class="p">);</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_WR_MBS1</span><span class="p">,</span> <span class="n">w_order</span><span class="p">);</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_RD_MBS0</span><span class="p">,</span> <span class="n">r_order</span><span class="p">);</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_RD_MBS1</span><span class="p">,</span> <span class="n">r_order</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span> <span class="o">||</span> <span class="n">CHIP_IS_E1H</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">r_order</span> <span class="o">==</span> <span class="n">MAX_RD_ORD</span><span class="p">))</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_RQ_PDR_LIMIT</span><span class="p">,</span> <span class="mh">0xe00</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E3</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_USDMDP_TH</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x4</span> <span class="o">&lt;&lt;</span> <span class="n">w_order</span><span class="p">));</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E2</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_USDMDP_TH</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x8</span> <span class="o">&lt;&lt;</span> <span class="n">w_order</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_USDMDP_TH</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x18</span> <span class="o">&lt;&lt;</span> <span class="n">w_order</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/*    MPS      w_order     optimal TH      presently TH</span>
<span class="cm">		 *    128         0             0               2</span>
<span class="cm">		 *    256         1             1               3</span>
<span class="cm">		 *    &gt;=512       2             2               3</span>
<span class="cm">		 */</span>
		<span class="cm">/* DMAE is special */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">CHIP_IS_E1H</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span> <span class="p">{</span>
			<span class="cm">/* E2 can use optimal TH */</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">w_order</span><span class="p">;</span>
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_DMAE_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="p">((</span><span class="n">w_order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">);</span>
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_DMAE_MPS</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_HC_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_USDM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_CSDM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_TSDM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_XSDM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_QM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_TM_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_SRC_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_DBG_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_WR_CDU_MPS</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Validate number of tags suppoted by device */</span>
<span class="cp">#define PCIE_REG_PCIER_TL_HDR_FC_ST		0x2980</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">REG_RD</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PCIE_REG_PCIER_TL_HDR_FC_ST</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;=</span> <span class="mh">0x20</span><span class="p">)</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">PXP2_REG_PGL_TAGS_LIMIT</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************</span>
<span class="cm">* ILT management</span>
<span class="cm">****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * This codes hides the low level HW interaction for ILT management and</span>
<span class="cm"> * configuration. The API consists of a shadow ILT table which is set by the</span>
<span class="cm"> * driver and a set of routines to use it to configure the HW.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* ILT HW init operations */</span>

<span class="cm">/* ILT memory management operations */</span>
<span class="cp">#define ILT_MEMOP_ALLOC		0</span>
<span class="cp">#define ILT_MEMOP_FREE		1</span>

<span class="cm">/* the phys address is shifted right 12 bits and has an added</span>
<span class="cm"> * 1=valid bit added to the 53rd bit</span>
<span class="cm"> * then since this is a wide register(TM)</span>
<span class="cm"> * we split it into two 32 bit writes</span>
<span class="cm"> */</span>
<span class="cp">#define ILT_ADDR1(x)		((u32)(((u64)x &gt;&gt; 12) &amp; 0xFFFFFFFF))</span>
<span class="cp">#define ILT_ADDR2(x)		((u32)((1 &lt;&lt; 20) | ((u64)x &gt;&gt; 44)))</span>
<span class="cp">#define ILT_RANGE(f, l)		(((l) &lt;&lt; 10) | f)</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bnx2x_ilt_line_mem_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">ilt_line</span> <span class="o">*</span><span class="n">line</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">,</span> <span class="n">u8</span> <span class="n">memop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">memop</span> <span class="o">==</span> <span class="n">ILT_MEMOP_FREE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">BNX2X_ILT_FREE</span><span class="p">(</span><span class="n">line</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">,</span> <span class="n">line</span><span class="o">-&gt;</span><span class="n">page_mapping</span><span class="p">,</span> <span class="n">line</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">BNX2X_ILT_ZALLOC</span><span class="p">(</span><span class="n">line</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">line</span><span class="o">-&gt;</span><span class="n">page_mapping</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">line</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">line</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">bnx2x_ilt_client_mem_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cli_num</span><span class="p">,</span>
				   <span class="n">u8</span> <span class="n">memop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span> <span class="o">=</span> <span class="n">BP_ILT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ilt</span><span class="o">-&gt;</span><span class="n">clients</span><span class="p">[</span><span class="n">cli_num</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ilt</span> <span class="o">||</span> <span class="o">!</span><span class="n">ilt</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ILT_CLIENT_SKIP_INIT</span> <span class="o">|</span> <span class="n">ILT_CLIENT_SKIP_MEM</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">rc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_ilt_line_mem_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ilt</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					   <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">page_size</span><span class="p">,</span> <span class="n">memop</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bnx2x_ilt_mem_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">memop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_ilt_client_mem_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_CDU</span><span class="p">,</span> <span class="n">memop</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_ilt_client_mem_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_QM</span><span class="p">,</span> <span class="n">memop</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_ilt_client_mem_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_SRC</span><span class="p">,</span> <span class="n">memop</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rc</span><span class="p">)</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">bnx2x_ilt_client_mem_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_TM</span><span class="p">,</span> <span class="n">memop</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_line_wr</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">abs_idx</span><span class="p">,</span>
			      <span class="n">dma_addr_t</span> <span class="n">page_mapping</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_ONCHIP_AT</span> <span class="o">+</span> <span class="n">abs_idx</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_ONCHIP_AT_B0</span> <span class="o">+</span> <span class="n">abs_idx</span><span class="o">*</span><span class="mi">8</span><span class="p">;</span>

	<span class="n">bnx2x_wr_64</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ILT_ADDR1</span><span class="p">(</span><span class="n">page_mapping</span><span class="p">),</span> <span class="n">ILT_ADDR2</span><span class="p">(</span><span class="n">page_mapping</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_line_init_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dma_addr_t</span>	<span class="n">null_mapping</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">abs_idx</span> <span class="o">=</span> <span class="n">ilt</span><span class="o">-&gt;</span><span class="n">start_line</span> <span class="o">+</span> <span class="n">idx</span><span class="p">;</span>


	<span class="k">switch</span> <span class="p">(</span><span class="n">initop</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">INITOP_INIT</span>:
		<span class="cm">/* set in the init-value array */</span>
	<span class="k">case</span> <span class="n">INITOP_SET</span>:
		<span class="n">bnx2x_ilt_line_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">abs_idx</span><span class="p">,</span> <span class="n">ilt</span><span class="o">-&gt;</span><span class="n">lines</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">page_mapping</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">INITOP_CLEAR</span>:
		<span class="n">null_mapping</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">bnx2x_ilt_line_wr</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">abs_idx</span><span class="p">,</span> <span class="n">null_mapping</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_boundry_init_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">ilt_start</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">start_reg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">end_reg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* The boundary is either SET or INIT,</span>
<span class="cm">	   CLEAR =&gt; SET and for now SET ~~ INIT */</span>

	<span class="cm">/* find the appropriate regs */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E1</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">client_num</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_CDU</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_PSWRQ_CDU0_L2P</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_QM</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_PSWRQ_QM0_L2P</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_SRC</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_PSWRQ_SRC0_L2P</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_TM</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_PSWRQ_TM0_L2P</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">start_reg</span> <span class="o">+</span> <span class="n">BP_FUNC</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
		       <span class="n">ILT_RANGE</span><span class="p">((</span><span class="n">ilt_start</span> <span class="o">+</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">),</span>
				 <span class="p">(</span><span class="n">ilt_start</span> <span class="o">+</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">)));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">client_num</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_CDU</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_CDU_FIRST_ILT</span><span class="p">;</span>
			<span class="n">end_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_CDU_LAST_ILT</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_QM</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_QM_FIRST_ILT</span><span class="p">;</span>
			<span class="n">end_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_QM_LAST_ILT</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_SRC</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_SRC_FIRST_ILT</span><span class="p">;</span>
			<span class="n">end_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_SRC_LAST_ILT</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ILT_CLIENT_TM</span>:
			<span class="n">start_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_TM_FIRST_ILT</span><span class="p">;</span>
			<span class="n">end_reg</span> <span class="o">=</span> <span class="n">PXP2_REG_RQ_TM_LAST_ILT</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">start_reg</span><span class="p">,</span> <span class="p">(</span><span class="n">ilt_start</span> <span class="o">+</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">));</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">end_reg</span><span class="p">,</span> <span class="p">(</span><span class="n">ilt_start</span> <span class="o">+</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_client_init_op_ilt</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span><span class="p">,</span>
					 <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ILT_CLIENT_SKIP_INIT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">bnx2x_ilt_line_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ilt</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>

	<span class="cm">/* init/clear the ILT boundries */</span>
	<span class="n">bnx2x_ilt_boundry_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ilt_cli</span><span class="p">,</span> <span class="n">ilt</span><span class="o">-&gt;</span><span class="n">start_line</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_client_init_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span> <span class="o">=</span> <span class="n">BP_ILT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>

	<span class="n">bnx2x_ilt_client_init_op_ilt</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ilt</span><span class="p">,</span> <span class="n">ilt_cli</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_client_id_init_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
					<span class="kt">int</span> <span class="n">cli_num</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span> <span class="o">=</span> <span class="n">BP_ILT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ilt</span><span class="o">-&gt;</span><span class="n">clients</span><span class="p">[</span><span class="n">cli_num</span><span class="p">];</span>

	<span class="n">bnx2x_ilt_client_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ilt_cli</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_init_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bnx2x_ilt_client_id_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_CDU</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_client_id_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_QM</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_client_id_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_SRC</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_client_id_init_op</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_TM</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_init_client_psz</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cli_num</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">psz_reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_ilt</span> <span class="o">*</span><span class="n">ilt</span> <span class="o">=</span> <span class="n">BP_ILT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ilt_client_info</span> <span class="o">*</span><span class="n">ilt_cli</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ilt</span><span class="o">-&gt;</span><span class="n">clients</span><span class="p">[</span><span class="n">cli_num</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ILT_CLIENT_SKIP_INIT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">initop</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">INITOP_INIT</span>:
		<span class="cm">/* set in the init-value array */</span>
	<span class="k">case</span> <span class="n">INITOP_SET</span>:
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">psz_reg</span><span class="p">,</span> <span class="n">ILOG2</span><span class="p">(</span><span class="n">ilt_cli</span><span class="o">-&gt;</span><span class="n">page_size</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">INITOP_CLEAR</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * called during init common stage, ilt clients should be initialized</span>
<span class="cm"> * prioir to calling this function</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_ilt_init_page_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bnx2x_ilt_init_client_psz</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_CDU</span><span class="p">,</span>
				  <span class="n">PXP2_REG_RQ_CDU_P_SIZE</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_init_client_psz</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_QM</span><span class="p">,</span>
				  <span class="n">PXP2_REG_RQ_QM_P_SIZE</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_init_client_psz</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_SRC</span><span class="p">,</span>
				  <span class="n">PXP2_REG_RQ_SRC_P_SIZE</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
	<span class="n">bnx2x_ilt_init_client_psz</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">ILT_CLIENT_TM</span><span class="p">,</span>
				  <span class="n">PXP2_REG_RQ_TM_P_SIZE</span><span class="p">,</span> <span class="n">initop</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************</span>
<span class="cm">* QM initializations</span>
<span class="cm">****************************************************************************/</span>
<span class="cp">#define QM_QUEUES_PER_FUNC	16 </span><span class="cm">/* E1 has 32, but only 16 are used */</span><span class="cp"></span>
<span class="cp">#define QM_INIT_MIN_CID_COUNT	31</span>
<span class="cp">#define QM_INIT(cid_cnt)	(cid_cnt &gt; QM_INIT_MIN_CID_COUNT)</span>

<span class="cm">/* called during init port stage */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_qm_init_cid_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qm_cid_count</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">BP_PORT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">QM_INIT</span><span class="p">(</span><span class="n">qm_cid_count</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">initop</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">INITOP_INIT</span>:
			<span class="cm">/* set in the init-value array */</span>
		<span class="k">case</span> <span class="n">INITOP_SET</span>:
			<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">QM_REG_CONNNUM_0</span> <span class="o">+</span> <span class="n">port</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
			       <span class="n">qm_cid_count</span><span class="o">/</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">INITOP_CLEAR</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_qm_set_ptr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qm_cid_count</span><span class="p">,</span>
				   <span class="n">u32</span> <span class="n">base_reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">wb_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">QM_QUEUES_PER_FUNC</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">base_reg</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
		       <span class="n">qm_cid_count</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">QM_QUEUES_PER_FUNC</span><span class="p">));</span>
		<span class="n">bnx2x_init_wr_wb</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span>	 <span class="n">wb_data</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* called during init common stage */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_qm_init_ptr_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">qm_cid_count</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="n">initop</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">QM_INIT</span><span class="p">(</span><span class="n">qm_cid_count</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">initop</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">INITOP_INIT</span>:
		<span class="cm">/* set in the init-value array */</span>
	<span class="k">case</span> <span class="n">INITOP_SET</span>:
		<span class="n">bnx2x_qm_set_ptr_table</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">qm_cid_count</span><span class="p">,</span>
				       <span class="n">QM_REG_BASEADDR</span><span class="p">,</span> <span class="n">QM_REG_PTRTBL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHIP_IS_E1H</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
			<span class="n">bnx2x_qm_set_ptr_table</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">qm_cid_count</span><span class="p">,</span>
					       <span class="n">QM_REG_BASEADDR_EXT_A</span><span class="p">,</span>
					       <span class="n">QM_REG_PTRTBL_EXT_A</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">INITOP_CLEAR</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************</span>
<span class="cm">* SRC initializations</span>
<span class="cm">****************************************************************************/</span>
<span class="cp">#ifdef BCM_CNIC</span>
<span class="cm">/* called during init func stage */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">bnx2x_src_init_t2</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">src_ent</span> <span class="o">*</span><span class="n">t2</span><span class="p">,</span>
			      <span class="n">dma_addr_t</span> <span class="n">t2_mapping</span><span class="p">,</span> <span class="kt">int</span> <span class="n">src_cid_count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="n">BP_PORT</span><span class="p">(</span><span class="n">bp</span><span class="p">);</span>

	<span class="cm">/* Initialize T2 */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">src_cid_count</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">next</span> <span class="o">=</span> <span class="p">(</span><span class="n">u64</span><span class="p">)(</span><span class="n">t2_mapping</span> <span class="o">+</span>
			     <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">src_ent</span><span class="p">));</span>

	<span class="cm">/* tell the searcher where the T2 table is */</span>
	<span class="n">REG_WR</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">SRC_REG_COUNTFREE0</span> <span class="o">+</span> <span class="n">port</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span> <span class="n">src_cid_count</span><span class="p">);</span>

	<span class="n">bnx2x_wr_64</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">SRC_REG_FIRSTFREE0</span> <span class="o">+</span> <span class="n">port</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span>
		    <span class="n">U64_LO</span><span class="p">(</span><span class="n">t2_mapping</span><span class="p">),</span> <span class="n">U64_HI</span><span class="p">(</span><span class="n">t2_mapping</span><span class="p">));</span>

	<span class="n">bnx2x_wr_64</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">SRC_REG_LASTFREE0</span> <span class="o">+</span> <span class="n">port</span><span class="o">*</span><span class="mi">16</span><span class="p">,</span>
		    <span class="n">U64_LO</span><span class="p">((</span><span class="n">u64</span><span class="p">)</span><span class="n">t2_mapping</span> <span class="o">+</span>
			   <span class="p">(</span><span class="n">src_cid_count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">src_ent</span><span class="p">)),</span>
		    <span class="n">U64_HI</span><span class="p">((</span><span class="n">u64</span><span class="p">)</span><span class="n">t2_mapping</span> <span class="o">+</span>
			   <span class="p">(</span><span class="n">src_cid_count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">src_ent</span><span class="p">)));</span>
<span class="p">}</span>
<span class="cp">#endif</span>
<span class="cp">#endif </span><span class="cm">/* BNX2X_INIT_OPS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
