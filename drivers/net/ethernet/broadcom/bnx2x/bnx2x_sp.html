<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › broadcom › bnx2x › bnx2x_sp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>bnx2x_sp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* bnx2x_sp.h: Broadcom Everest network driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2011-2012 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Unless you and Broadcom execute a separate written software license</span>
<span class="cm"> * agreement governing use of this software, this software is licensed to you</span>
<span class="cm"> * under the terms of the GNU General Public License version 2, available</span>
<span class="cm"> * at http://www.gnu.org/licenses/old-licenses/gpl-2.0.html (the &quot;GPL&quot;).</span>
<span class="cm"> *</span>
<span class="cm"> * Notwithstanding the above, under no circumstances may you combine this</span>
<span class="cm"> * software in any way with any other Broadcom software provided under a</span>
<span class="cm"> * license other than the GPL, without Broadcom&#39;s express prior written</span>
<span class="cm"> * consent.</span>
<span class="cm"> *</span>
<span class="cm"> * Maintained by: Eilon Greenstein &lt;eilong@broadcom.com&gt;</span>
<span class="cm"> * Written by: Vladislav Zolotarov</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef BNX2X_SP_VERBS</span>
<span class="cp">#define BNX2X_SP_VERBS</span>

<span class="k">struct</span> <span class="n">bnx2x</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">eth_context</span><span class="p">;</span>

<span class="cm">/* Bits representing general command&#39;s configuration */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">RAMROD_TX</span><span class="p">,</span>
	<span class="n">RAMROD_RX</span><span class="p">,</span>
	<span class="cm">/* Wait until all pending commands complete */</span>
	<span class="n">RAMROD_COMP_WAIT</span><span class="p">,</span>
	<span class="cm">/* Don&#39;t send a ramrod, only update a registry */</span>
	<span class="n">RAMROD_DRV_CLR_ONLY</span><span class="p">,</span>
	<span class="cm">/* Configure HW according to the current object state */</span>
	<span class="n">RAMROD_RESTORE</span><span class="p">,</span>
	 <span class="cm">/* Execute the next command now */</span>
	<span class="n">RAMROD_EXEC</span><span class="p">,</span>
	<span class="cm">/*</span>
<span class="cm">	 * Don&#39;t add a new command and continue execution of posponed</span>
<span class="cm">	 * commands. If not set a new command will be added to the</span>
<span class="cm">	 * pending commands list.</span>
<span class="cm">	 */</span>
	<span class="n">RAMROD_CONT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_OBJ_TYPE_RX</span><span class="p">,</span>
	<span class="n">BNX2X_OBJ_TYPE_TX</span><span class="p">,</span>
	<span class="n">BNX2X_OBJ_TYPE_RX_TX</span><span class="p">,</span>
<span class="p">}</span> <span class="n">bnx2x_obj_type</span><span class="p">;</span>

<span class="cm">/* Filtering states */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_FILTER_MAC_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_VLAN_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_VLAN_MAC_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_RX_MODE_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_RX_MODE_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_ISCSI_ETH_START_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_ISCSI_ETH_STOP_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_FCOE_ETH_START_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_FCOE_ETH_STOP_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_MCAST_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_MCAST_SCHED</span><span class="p">,</span>
	<span class="n">BNX2X_FILTER_RSS_CONF_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_AFEX_FCOE_Q_UPDATE_PENDING</span><span class="p">,</span>
	<span class="n">BNX2X_AFEX_PENDING_VIFSET_MCP_ACK</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="p">{</span>
	<span class="n">u8</span>		<span class="n">func_id</span><span class="p">;</span>

	<span class="cm">/* Queue params */</span>
	<span class="n">u8</span>		<span class="n">cl_id</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cid</span><span class="p">;</span>

	<span class="cm">/* Ramrod data buffer params */</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">rdata</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">rdata_mapping</span><span class="p">;</span>

	<span class="cm">/* Ramrod state params */</span>
	<span class="kt">int</span>		<span class="n">state</span><span class="p">;</span>   <span class="cm">/* &quot;ramrod is pending&quot; state bit */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="o">*</span><span class="n">pstate</span><span class="p">;</span> <span class="cm">/* pointer to state buffer */</span>

	<span class="n">bnx2x_obj_type</span>	<span class="n">obj_type</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_comp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>

	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">check_pending</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_pending</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_pending</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/************************* VLAN-MAC commands related parameters ***************/</span>
<span class="k">struct</span> <span class="n">bnx2x_mac_ramrod_data</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_vlan_ramrod_data</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">vlan</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_data</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">vlan</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_mac_ramrod_data</span> <span class="n">mac</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_ramrod_data</span> <span class="n">vlan</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_data</span> <span class="n">vlan_mac</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* VLAN_MAC commands */</span>
<span class="k">enum</span> <span class="n">bnx2x_vlan_mac_cmd</span> <span class="p">{</span>
	<span class="n">BNX2X_VLAN_MAC_ADD</span><span class="p">,</span>
	<span class="n">BNX2X_VLAN_MAC_DEL</span><span class="p">,</span>
	<span class="n">BNX2X_VLAN_MAC_MOVE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_data</span> <span class="p">{</span>
	<span class="cm">/* Requested command: BNX2X_VLAN_MAC_XX */</span>
	<span class="k">enum</span> <span class="n">bnx2x_vlan_mac_cmd</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * used to contain the data related vlan_mac_flags bits from</span>
<span class="cm">	 * ramrod parameters.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vlan_mac_flags</span><span class="p">;</span>

	<span class="cm">/* Needed for MOVE command */</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">target_obj</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*************************** Exe Queue obj ************************************/</span>
<span class="k">union</span> <span class="n">bnx2x_exe_queue_cmd_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_data</span> <span class="n">vlan_mac</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/* TODO */</span>
	<span class="p">}</span> <span class="n">mcast</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">link</span><span class="p">;</span>

	<span class="cm">/* Length of this element in the exe_chunk. */</span>
	<span class="kt">int</span>				<span class="n">cmd_len</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">bnx2x_exe_queue_cmd_data</span>	<span class="n">cmd_data</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">bnx2x_qable_obj</span><span class="p">;</span>

<span class="k">union</span> <span class="n">bnx2x_exeq_comp_elem</span> <span class="p">{</span>
	<span class="k">union</span> <span class="n">event_ring_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_exe_queue_obj</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">exe_q_validate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			      <span class="k">union</span> <span class="n">bnx2x_qable_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">);</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">exe_q_remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			    <span class="k">union</span> <span class="n">bnx2x_qable_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * @return positive is entry was optimized, 0 - if not, negative</span>
<span class="cm"> *         in case of an error.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">exe_q_optimize</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			      <span class="k">union</span> <span class="n">bnx2x_qable_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">exe_q_execute</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">bnx2x_qable_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">exe_chunk</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">ramrod_flags</span><span class="p">);</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span>
			<span class="p">(</span><span class="o">*</span><span class="n">exe_q_get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_exe_queue_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">bnx2x_exe_queue_obj</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Commands pending for an execution.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">exe_queue</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Commands pending for an completion.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">pending_comp</span><span class="p">;</span>

	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>

	<span class="cm">/* Maximum length of commands&#39; list for one execution */</span>
	<span class="kt">int</span>			<span class="n">exe_chunk_len</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">bnx2x_qable_obj</span>	<span class="o">*</span><span class="n">owner</span><span class="p">;</span>

	<span class="cm">/****** Virtual functions ******/</span>
	<span class="cm">/**</span>
<span class="cm">	 * Called before commands execution for commands that are really</span>
<span class="cm">	 * going to be executed (after &#39;optimize&#39;).</span>
<span class="cm">	 *</span>
<span class="cm">	 * Must run under exe_queue-&gt;lock</span>
<span class="cm">	 */</span>
	<span class="n">exe_q_validate</span>		<span class="n">validate</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Called before removing pending commands, cleaning allocated</span>
<span class="cm">	 * resources (e.g., credits from validate)</span>
<span class="cm">	 */</span>
	 <span class="n">exe_q_remove</span>		<span class="n">remove</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * This will try to cancel the current pending commands list</span>
<span class="cm">	 * considering the new command.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Returns the number of optimized commands or a negative error code</span>
<span class="cm">	 *</span>
<span class="cm">	 * Must run under exe_queue-&gt;lock</span>
<span class="cm">	 */</span>
	<span class="n">exe_q_optimize</span>		<span class="n">optimize</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Run the next commands chunk (owner specific).</span>
<span class="cm">	 */</span>
	<span class="n">exe_q_execute</span>		<span class="n">execute</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Return the exe_queue element containing the specific command</span>
<span class="cm">	 * if any. Otherwise return NULL.</span>
<span class="cm">	 */</span>
	<span class="n">exe_q_get</span>		<span class="n">get</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/***************** Classification verbs: Set/Del MAC/VLAN/VLAN-MAC ************/</span>
<span class="cm">/*</span>
<span class="cm"> * Element in the VLAN_MAC registry list having all currenty configured</span>
<span class="cm"> * rules.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_registry_elem</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">link</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Used to store the cam offset used for the mac/vlan/vlan-mac.</span>
<span class="cm">	 * Relevant for 57710 and 57711 only. VLANs and MACs share the</span>
<span class="cm">	 * same CAM for these chips.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span>			<span class="n">cam_offset</span><span class="p">;</span>

	<span class="cm">/* Needed for DEL and RESTORE flows */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">vlan_mac_flags</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Bits representing VLAN_MAC commands specific flags */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_UC_LIST_MAC</span><span class="p">,</span>
	<span class="n">BNX2X_ETH_MAC</span><span class="p">,</span>
	<span class="n">BNX2X_ISCSI_ETH_MAC</span><span class="p">,</span>
	<span class="n">BNX2X_NETQ_ETH_MAC</span><span class="p">,</span>
	<span class="n">BNX2X_DONT_CONSUME_CAM_CREDIT</span><span class="p">,</span>
	<span class="n">BNX2X_DONT_CONSUME_CAM_CREDIT_DEST</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_params</span> <span class="p">{</span>
	<span class="cm">/* Object to run the command from */</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">vlan_mac_obj</span><span class="p">;</span>

	<span class="cm">/* General command flags: COMP_WAIT, etc. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ramrod_flags</span><span class="p">;</span>

	<span class="cm">/* Command specific configuration request */</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_data</span> <span class="n">user_req</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="n">raw</span><span class="p">;</span>

	<span class="cm">/* Bookkeeping list: will prevent the addition of already existing</span>
<span class="cm">	 * entries.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">head</span><span class="p">;</span>

	<span class="cm">/* TODO: Add it&#39;s initialization in the init functions */</span>
	<span class="k">struct</span> <span class="n">bnx2x_exe_queue_obj</span>	<span class="n">exe_queue</span><span class="p">;</span>

	<span class="cm">/* MACs credit pool */</span>
	<span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span>	<span class="o">*</span><span class="n">macs_pool</span><span class="p">;</span>

	<span class="cm">/* VLANs credit pool */</span>
	<span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span>	<span class="o">*</span><span class="n">vlans_pool</span><span class="p">;</span>

	<span class="cm">/* RAMROD command to be used */</span>
	<span class="kt">int</span>				<span class="n">ramrod_cmd</span><span class="p">;</span>

	<span class="cm">/* copy first n elements onto preallocated buffer</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param n number of elements to get</span>
<span class="cm">	 * @param buf buffer preallocated by caller into which elements</span>
<span class="cm">	 *            will be copied. Note elements are 4-byte aligned</span>
<span class="cm">	 *            so buffer size must be able to accomodate the</span>
<span class="cm">	 *            aligned elements.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return number of copied bytes</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_n_elements</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Checks if ADD-ramrod with the given params may be performed.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return zero if the element may be added</span>
<span class="cm">	 */</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check_add</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			 <span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Checks if DEL-ramrod with the given params may be performed.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return true if the element may be deleted</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_registry_elem</span> <span class="o">*</span>
		<span class="p">(</span><span class="o">*</span><span class="n">check_del</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Checks if DEL-ramrod with the given params may be performed.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return true if the element may be deleted</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">check_move</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">src_o</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">dst_o</span><span class="p">,</span>
			   <span class="k">union</span> <span class="n">bnx2x_classification_ramrod_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 *  Update the relevant credit object(s) (consume/return</span>
<span class="cm">	 *  correspondingly).</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">get_credit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">put_credit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">get_cam_offset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">offset</span><span class="p">);</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">put_cam_offset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Configures one rule in the ramrod data buffer.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_one_rule</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_exeq_elem</span> <span class="o">*</span><span class="n">elem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rule_idx</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">cam_offset</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	*  Delete all configured elements having the given</span>
<span class="cm">	*  vlan_mac_flags specification. Assumes no pending for</span>
<span class="cm">	*  execution commands. Will schedule all all currently</span>
<span class="cm">	*  configured MACs/VLANs/VLAN-MACs matching the vlan_mac_flags</span>
<span class="cm">	*  specification for deletion and will use the given</span>
<span class="cm">	*  ramrod_flags for the last DEL operation.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param bp</span>
<span class="cm">	 * @param o</span>
<span class="cm">	 * @param ramrod_flags RAMROD_XX flags</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return 0 if the last operation has completed successfully</span>
<span class="cm">	 *         and there are no more elements left, positive value</span>
<span class="cm">	 *         if there are pending for completion commands,</span>
<span class="cm">	 *         negative value in case of failure.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">delete_all</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">vlan_mac_flags</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">ramrod_flags</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Reconfigures the next MAC/VLAN/VLAN-MAC element from the previously</span>
<span class="cm">	 * configured elements list.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param bp</span>
<span class="cm">	 * @param p Command parameters (RAMROD_COMP_WAIT bit in</span>
<span class="cm">	 *          ramrod_flags is only taken into an account)</span>
<span class="cm">	 * @param ppos a pointer to the cooky that should be given back in the</span>
<span class="cm">	 *        next call to make function handle the next element. If</span>
<span class="cm">	 *        *ppos is set to NULL it will restart the iterator.</span>
<span class="cm">	 *        If returned *ppos == NULL this means that the last</span>
<span class="cm">	 *        element has been handled.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return int</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">restore</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_registry_elem</span> <span class="o">**</span><span class="n">ppos</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Should be called on a completion arival.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param bp</span>
<span class="cm">	 * @param o</span>
<span class="cm">	 * @param cqe Completion element we are handling</span>
<span class="cm">	 * @param ramrod_flags if RAMROD_CONT is set the next bulk of</span>
<span class="cm">	 *		       pending commands will be executed.</span>
<span class="cm">	 *		       RAMROD_DRV_CLR_ONLY and RAMROD_RESTORE</span>
<span class="cm">	 *		       may also be set if needed.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return 0 if there are neither pending nor waiting for</span>
<span class="cm">	 *         completion commands. Positive value if there are</span>
<span class="cm">	 *         pending for execution or for completion commands.</span>
<span class="cm">	 *         Negative value in case of an error (including an</span>
<span class="cm">	 *         error in the cqe).</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			<span class="k">union</span> <span class="n">event_ring_elem</span> <span class="o">*</span><span class="n">cqe</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">ramrod_flags</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Wait for completion of all commands. Don&#39;t schedule new ones,</span>
<span class="cm">	 * just wait. It assumes that the completion code will schedule</span>
<span class="cm">	 * for new commands.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_LLH_CAM_ISCSI_ETH_LINE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">BNX2X_LLH_CAM_ETH_LINE</span><span class="p">,</span>
	<span class="n">BNX2X_LLH_CAM_MAX_PF_LINE</span> <span class="o">=</span> <span class="n">NIG_REG_LLH1_FUNC_MEM_SIZE</span> <span class="o">/</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">bnx2x_set_mac_in_nig</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="n">bool</span> <span class="n">add</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dev_addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">);</span>

<span class="cm">/** RX_MODE verbs:DROP_ALL/ACCEPT_ALL/ACCEPT_ALL_MULTI/ACCEPT_ALL_VLAN/NORMAL */</span>

<span class="cm">/* RX_MODE ramrod spesial flags: set in rx_mode_flags field in</span>
<span class="cm"> * a bnx2x_rx_mode_ramrod_params.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_RX_MODE_FCOE_ETH</span><span class="p">,</span>
	<span class="n">BNX2X_RX_MODE_ISCSI_ETH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_ACCEPT_UNICAST</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_MULTICAST</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_ALL_UNICAST</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_ALL_MULTICAST</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_BROADCAST</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_UNMATCHED</span><span class="p">,</span>
	<span class="n">BNX2X_ACCEPT_ANY_VLAN</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_rx_mode_ramrod_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_rx_mode_obj</span> <span class="o">*</span><span class="n">rx_mode_obj</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">state</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cl_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">func_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ramrod_flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_mode_flags</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * rdata is either a pointer to eth_filter_rules_ramrod_data(e2) or to</span>
<span class="cm">	 * a tstorm_eth_mac_filter_config (e1x).</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">;</span>

	<span class="cm">/* Rx mode settings */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rx_accept_flags</span><span class="p">;</span>

	<span class="cm">/* internal switching settings */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_accept_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_rx_mode_obj</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">config_rx_mode</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">bnx2x_rx_mode_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_comp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_rx_mode_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/********************** Set multicast group ***********************************/</span>

<span class="k">struct</span> <span class="n">bnx2x_mcast_list_elem</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">link</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">mac</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">bnx2x_mcast_config_data</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">mac</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bin</span><span class="p">;</span> <span class="cm">/* used in a RESTORE flow */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">mcast_obj</span><span class="p">;</span>

	<span class="cm">/* Relevant options are RAMROD_COMP_WAIT and RAMROD_DRV_CLR_ONLY */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ramrod_flags</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">mcast_list</span><span class="p">;</span> <span class="cm">/* list of struct bnx2x_mcast_list_elem */</span>
	<span class="cm">/** TODO:</span>
<span class="cm">	 *      - rename it to macs_num.</span>
<span class="cm">	 *      - Add a new command type for handling pending commands</span>
<span class="cm">	 *        (remove &quot;zero semantics&quot;).</span>
<span class="cm">	 *</span>
<span class="cm">	 *  Length of mcast_list. If zero and ADD_CONT command - post</span>
<span class="cm">	 *  pending commands.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">mcast_list_len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_MCAST_CMD_ADD</span><span class="p">,</span>
	<span class="n">BNX2X_MCAST_CMD_CONT</span><span class="p">,</span>
	<span class="n">BNX2X_MCAST_CMD_DEL</span><span class="p">,</span>
	<span class="n">BNX2X_MCAST_CMD_RESTORE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_raw_obj</span> <span class="n">raw</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
		<span class="cp">#define BNX2X_MCAST_BINS_NUM	256</span>
		<span class="cp">#define BNX2X_MCAST_VEC_SZ	(BNX2X_MCAST_BINS_NUM / 64)</span>
			<span class="n">u64</span> <span class="n">vec</span><span class="p">[</span><span class="n">BNX2X_MCAST_VEC_SZ</span><span class="p">];</span>

			<span class="cm">/** Number of BINs to clear. Should be updated</span>
<span class="cm">			 *  immediately when a command arrives in order to</span>
<span class="cm">			 *  properly create DEL commands.</span>
<span class="cm">			 */</span>
			<span class="kt">int</span> <span class="n">num_bins_set</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">aprox_match</span><span class="p">;</span>

		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">list_head</span> <span class="n">macs</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">num_macs_set</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">exact_match</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">registry</span><span class="p">;</span>

	<span class="cm">/* Pending commands */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pending_cmds_head</span><span class="p">;</span>

	<span class="cm">/* A state that is set in raw.pstate, when there are pending commands */</span>
	<span class="kt">int</span> <span class="n">sched_state</span><span class="p">;</span>

	<span class="cm">/* Maximal number of mcast MACs configured in one command */</span>
	<span class="kt">int</span> <span class="n">max_cmd_len</span><span class="p">;</span>

	<span class="cm">/* Total number of currently pending MACs to configure: both</span>
<span class="cm">	 * in the pending commands list and in the current command.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">total_pending_num</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">engine_id</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * @param cmd command to execute (BNX2X_MCAST_CMD_X, see above)</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">config_mcast</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Fills the ramrod data during the RESTORE flow.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param bp</span>
<span class="cm">	 * @param o</span>
<span class="cm">	 * @param start_idx Registry index to start from</span>
<span class="cm">	 * @param rdata_idx Index in the ramrod data to start from</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return -1 if we handled the whole registry or index of the last</span>
<span class="cm">	 *         handled registry element.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hdl_restore</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="n">start_bin</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">rdata_idx</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">enqueue_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_one_rule</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span>
			     <span class="k">union</span> <span class="n">bnx2x_mcast_config_data</span> <span class="o">*</span><span class="n">cfg_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>

	<span class="cm">/** Checks if there are more mcast MACs to be set or a previous</span>
<span class="cm">	 *  command is still pending.</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">check_pending</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Set/Clear/Check SCHEDULED state of the object</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_sched</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">clear_sched</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">check_sched</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>

	<span class="cm">/* Wait until all pending commands complete */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_comp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Handle the internal object counters needed for proper</span>
<span class="cm">	 * commands handling. Checks that the provided parameters are</span>
<span class="cm">	 * feasible.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">validate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Restore the values of internal counters in case of a failure.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">revert</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">old_num_bins</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_registry_size</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_registry_size</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*************************** Credit handling **********************************/</span>
<span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="p">{</span>

	<span class="cm">/* Current amount of credit in the pool */</span>
	<span class="n">atomic_t</span>	<span class="n">credit</span><span class="p">;</span>

	<span class="cm">/* Maximum allowed credit. put() will check against it. */</span>
	<span class="kt">int</span>		<span class="n">pool_sz</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 *  Allocate a pool table statically.</span>
<span class="cm">	 *</span>
<span class="cm">	 *  Currently the mamimum allowed size is MAX_MAC_CREDIT_E2(272)</span>
<span class="cm">	 *</span>
<span class="cm">	 *  The set bit in the table will mean that the entry is available.</span>
<span class="cm">	 */</span>
<span class="cp">#define BNX2X_POOL_VEC_SIZE	(MAX_MAC_CREDIT_E2 / 64)</span>
	<span class="n">u64</span>		<span class="n">pool_mirror</span><span class="p">[</span><span class="n">BNX2X_POOL_VEC_SIZE</span><span class="p">];</span>

	<span class="cm">/* Base pool offset (initialized differently */</span>
	<span class="kt">int</span>		<span class="n">base_pool_offset</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Get the next free pool entry.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return true if there was a free entry in the pool</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">get_entry</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">entry</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Return the entry back to the pool.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return true if entry is legal and has been successfully</span>
<span class="cm">	 *         returned to the pool.</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">put_entry</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">entry</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Get the requested amount of credit from the pool.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param cnt Amount of requested credit</span>
<span class="cm">	 * @return true if the operation is successful</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Returns the credit to the pool.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @param cnt Amount of credit to return</span>
<span class="cm">	 * @return true if the operation is successful</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="p">(</span><span class="o">*</span><span class="n">put</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cnt</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Reads the current amount of credit.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*************************** RSS configuration ********************************/</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="cm">/* RSS_MODE bits are mutually exclusive */</span>
	<span class="n">BNX2X_RSS_MODE_DISABLED</span><span class="p">,</span>
	<span class="n">BNX2X_RSS_MODE_REGULAR</span><span class="p">,</span>

	<span class="n">BNX2X_RSS_SET_SRCH</span><span class="p">,</span> <span class="cm">/* Setup searcher, E1x specific flag */</span>

	<span class="n">BNX2X_RSS_IPV4</span><span class="p">,</span>
	<span class="n">BNX2X_RSS_IPV4_TCP</span><span class="p">,</span>
	<span class="n">BNX2X_RSS_IPV6</span><span class="p">,</span>
	<span class="n">BNX2X_RSS_IPV6_TCP</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_config_rss_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_rss_config_obj</span> <span class="o">*</span><span class="n">rss_obj</span><span class="p">;</span>

	<span class="cm">/* may have RAMROD_COMP_WAIT set only */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ramrod_flags</span><span class="p">;</span>

	<span class="cm">/* BNX2X_RSS_X bits */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rss_flags</span><span class="p">;</span>

	<span class="cm">/* Number hash bits to take into an account */</span>
	<span class="n">u8</span>		<span class="n">rss_result_mask</span><span class="p">;</span>

	<span class="cm">/* Indirection table */</span>
	<span class="n">u8</span>		<span class="n">ind_table</span><span class="p">[</span><span class="n">T_ETH_INDIRECTION_TABLE_SIZE</span><span class="p">];</span>

	<span class="cm">/* RSS hash values */</span>
	<span class="n">u32</span>		<span class="n">rss_key</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

	<span class="cm">/* valid only iff BNX2X_RSS_UPDATE_TOE is set */</span>
	<span class="n">u16</span>		<span class="n">toe_rss_bitmap</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_rss_config_obj</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_raw_obj</span>	<span class="n">raw</span><span class="p">;</span>

	<span class="cm">/* RSS engine to use */</span>
	<span class="n">u8</span>			<span class="n">engine_id</span><span class="p">;</span>

	<span class="cm">/* Last configured indirection table */</span>
	<span class="n">u8</span>			<span class="n">ind_table</span><span class="p">[</span><span class="n">T_ETH_INDIRECTION_TABLE_SIZE</span><span class="p">];</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">config_rss</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">bnx2x_config_rss_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*********************** Queue state update ***********************************/</span>

<span class="cm">/* UPDATE command options */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_Q_UPDATE_IN_VLAN_REM</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_IN_VLAN_REM_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_OUT_VLAN_REM</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_OUT_VLAN_REM_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_ANTI_SPOOF</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_ANTI_SPOOF_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_ACTIVATE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_ACTIVATE_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_DEF_VLAN_EN</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_DEF_VLAN_EN_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_SILENT_VLAN_REM_CHNG</span><span class="p">,</span>
	<span class="n">BNX2X_Q_UPDATE_SILENT_VLAN_REM</span>
<span class="p">};</span>

<span class="cm">/* Allowed Queue states */</span>
<span class="k">enum</span> <span class="n">bnx2x_q_state</span> <span class="p">{</span>
	<span class="n">BNX2X_Q_STATE_RESET</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_INITIALIZED</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_ACTIVE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_MULTI_COS</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_MCOS_TERMINATED</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_INACTIVE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_STOPPED</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_TERMINATED</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_FLRED</span><span class="p">,</span>
	<span class="n">BNX2X_Q_STATE_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Allowed commands */</span>
<span class="k">enum</span> <span class="n">bnx2x_queue_cmd</span> <span class="p">{</span>
	<span class="n">BNX2X_Q_CMD_INIT</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_SETUP</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_SETUP_TX_ONLY</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_DEACTIVATE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_ACTIVATE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_UPDATE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_UPDATE_TPA</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_HALT</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_CFC_DEL</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_TERMINATE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_EMPTY</span><span class="p">,</span>
	<span class="n">BNX2X_Q_CMD_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* queue SETUP + INIT flags */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BNX2X_Q_FLG_TPA</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_TPA_IPV6</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_TPA_GRO</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_STATS</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_ZERO_STATS</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_ACTIVE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_OV</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_VLAN</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_COS</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_HC</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_HC_EN</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_DHC</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_FCOE</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_LEADING_RSS</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_MCAST</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_DEF_VLAN</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_TX_SWITCH</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_TX_SEC</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_ANTI_SPOOF</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_SILENT_VLAN_REM</span><span class="p">,</span>
	<span class="n">BNX2X_Q_FLG_FORCE_DEFAULT_PRI</span>
<span class="p">};</span>

<span class="cm">/* Queue type options: queue type may be a compination of below. */</span>
<span class="k">enum</span> <span class="n">bnx2x_q_type</span> <span class="p">{</span>
	<span class="cm">/** TODO: Consider moving both these flags into the init()</span>
<span class="cm">	 *        ramrod params.</span>
<span class="cm">	 */</span>
	<span class="n">BNX2X_Q_TYPE_HAS_RX</span><span class="p">,</span>
	<span class="n">BNX2X_Q_TYPE_HAS_TX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define BNX2X_PRIMARY_CID_INDEX			0</span>
<span class="cp">#define BNX2X_MULTI_TX_COS_E1X			3 </span><span class="cm">/* QM only */</span><span class="cp"></span>
<span class="cp">#define BNX2X_MULTI_TX_COS_E2_E3A0		2</span>
<span class="cp">#define BNX2X_MULTI_TX_COS_E3B0			3</span>
<span class="cp">#define BNX2X_MULTI_TX_COS			3 </span><span class="cm">/* Maximum possible */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">bnx2x_queue_init_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
		<span class="n">u16</span>		<span class="n">hc_rate</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">fw_sb_id</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">sb_cq_index</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">tx</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
		<span class="n">u16</span>		<span class="n">hc_rate</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">fw_sb_id</span><span class="p">;</span>
		<span class="n">u8</span>		<span class="n">sb_cq_index</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rx</span><span class="p">;</span>

	<span class="cm">/* CID context in the host memory */</span>
	<span class="k">struct</span> <span class="n">eth_context</span> <span class="o">*</span><span class="n">cxts</span><span class="p">[</span><span class="n">BNX2X_MULTI_TX_COS</span><span class="p">];</span>

	<span class="cm">/* maximum number of cos supported by hardware */</span>
	<span class="n">u8</span> <span class="n">max_cos</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_terminate_params</span> <span class="p">{</span>
	<span class="cm">/* index within the tx_only cids of this queue object */</span>
	<span class="n">u8</span> <span class="n">cid_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_cfc_del_params</span> <span class="p">{</span>
	<span class="cm">/* index within the tx_only cids of this queue object */</span>
	<span class="n">u8</span> <span class="n">cid_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_update_params</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">update_flags</span><span class="p">;</span> <span class="cm">/* BNX2X_Q_UPDATE_XX bits */</span>
	<span class="n">u16</span>		<span class="n">def_vlan</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">silent_removal_value</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">silent_removal_mask</span><span class="p">;</span>
<span class="cm">/* index within the tx_only cids of this queue object */</span>
	<span class="n">u8</span>		<span class="n">cid_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rxq_pause_params</span> <span class="p">{</span>
	<span class="n">u16</span>		<span class="n">bd_th_lo</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">bd_th_hi</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">rcq_th_lo</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">rcq_th_hi</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">sge_th_lo</span><span class="p">;</span> <span class="cm">/* valid iff BNX2X_Q_FLG_TPA */</span>
	<span class="n">u16</span>		<span class="n">sge_th_hi</span><span class="p">;</span> <span class="cm">/* valid iff BNX2X_Q_FLG_TPA */</span>
	<span class="n">u16</span>		<span class="n">pri_map</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* general */</span>
<span class="k">struct</span> <span class="n">bnx2x_general_setup_params</span> <span class="p">{</span>
	<span class="cm">/* valid iff BNX2X_Q_FLG_STATS */</span>
	<span class="n">u8</span>		<span class="n">stat_id</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">spcl_id</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">mtu</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">cos</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_rxq_setup_params</span> <span class="p">{</span>
	<span class="cm">/* dma */</span>
	<span class="n">dma_addr_t</span>	<span class="n">dscr_map</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">sge_map</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">rcq_map</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">rcq_np_map</span><span class="p">;</span>

	<span class="n">u16</span>		<span class="n">drop_flags</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">buf_sz</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">fw_sb_id</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">cl_qzone_id</span><span class="p">;</span>

	<span class="cm">/* valid iff BNX2X_Q_FLG_TPA */</span>
	<span class="n">u16</span>		<span class="n">tpa_agg_sz</span><span class="p">;</span>
	<span class="n">u16</span>		<span class="n">sge_buf_sz</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">max_sges_pkt</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">max_tpa_queues</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">rss_engine_id</span><span class="p">;</span>

	<span class="cm">/* valid iff BNX2X_Q_FLG_MCAST */</span>
	<span class="n">u8</span>		<span class="n">mcast_engine_id</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">cache_line_log</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">sb_cq_index</span><span class="p">;</span>

	<span class="cm">/* valid iff BXN2X_Q_FLG_SILENT_VLAN_REM */</span>
	<span class="n">u16</span> <span class="n">silent_removal_value</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">silent_removal_mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_txq_setup_params</span> <span class="p">{</span>
	<span class="cm">/* dma */</span>
	<span class="n">dma_addr_t</span>	<span class="n">dscr_map</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">fw_sb_id</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">sb_cq_index</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">cos</span><span class="p">;</span>		<span class="cm">/* valid iff BNX2X_Q_FLG_COS */</span>
	<span class="n">u16</span>		<span class="n">traffic_type</span><span class="p">;</span>
	<span class="cm">/* equals to the leading rss client id, used for TX classification*/</span>
	<span class="n">u8</span>		<span class="n">tss_leading_cl_id</span><span class="p">;</span>

	<span class="cm">/* valid iff BNX2X_Q_FLG_DEF_VLAN */</span>
	<span class="n">u16</span>		<span class="n">default_vlan</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_setup_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_general_setup_params</span> <span class="n">gen_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_txq_setup_params</span> <span class="n">txq_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_rxq_setup_params</span> <span class="n">rxq_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rxq_pause_params</span> <span class="n">pause_params</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_setup_tx_only_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_general_setup_params</span>	<span class="n">gen_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bnx2x_txq_setup_params</span>		<span class="n">txq_params</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>				<span class="n">flags</span><span class="p">;</span>
	<span class="cm">/* index within the tx_only cids of this queue object */</span>
	<span class="n">u8</span>					<span class="n">cid_index</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_state_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">q_obj</span><span class="p">;</span>

	<span class="cm">/* Current command */</span>
	<span class="k">enum</span> <span class="n">bnx2x_queue_cmd</span> <span class="n">cmd</span><span class="p">;</span>

	<span class="cm">/* may have RAMROD_COMP_WAIT set only */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ramrod_flags</span><span class="p">;</span>

	<span class="cm">/* Params according to the current command */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_update_params</span>	<span class="n">update</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_setup_params</span>		<span class="n">setup</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_init_params</span>		<span class="n">init</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_setup_tx_only_params</span>	<span class="n">tx_only</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_terminate_params</span>	<span class="n">terminate</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_queue_cfc_del_params</span>	<span class="n">cfc_del</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">params</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_viflist_params</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">echo_res</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">func_bit_map_res</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">cids</span><span class="p">[</span><span class="n">BNX2X_MULTI_TX_COS</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">cl_id</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">func_id</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * number of traffic classes supported by queue.</span>
<span class="cm">	 * The primary connection of the queue suppotrs the first traffic</span>
<span class="cm">	 * class. Any further traffic class is suppoted by a tx-only</span>
<span class="cm">	 * connection.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Therefore max_cos is also a number of valid entries in the cids</span>
<span class="cm">	 * array.</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="n">max_cos</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">num_tx_only</span><span class="p">,</span> <span class="n">next_tx_only</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">bnx2x_q_state</span> <span class="n">state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>

	<span class="cm">/* bits from enum bnx2x_q_type */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">type</span><span class="p">;</span>

	<span class="cm">/* BNX2X_Q_CMD_XX bits. This object implements &quot;one</span>
<span class="cm">	 * pending&quot; paradigm but for debug and tracing purposes it&#39;s</span>
<span class="cm">	 * more convinient to have different bits for different</span>
<span class="cm">	 * commands.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">pending</span><span class="p">;</span>

	<span class="cm">/* Buffer to use as a ramrod data and its mapping */</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">rdata</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>	<span class="n">rdata_mapping</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Performs one state change according to the given parameters.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return 0 in case of success and negative value otherwise.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">send_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_queue_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Sets the pending bit according to the requested transition.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_pending</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">bnx2x_queue_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Checks that the requested state transition is legal.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check_transition</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_queue_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Completes the pending command.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">complete_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			    <span class="k">enum</span> <span class="n">bnx2x_queue_cmd</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_comp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			 <span class="k">enum</span> <span class="n">bnx2x_queue_cmd</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/********************** Function state update *********************************/</span>
<span class="cm">/* Allowed Function states */</span>
<span class="k">enum</span> <span class="n">bnx2x_func_state</span> <span class="p">{</span>
	<span class="n">BNX2X_F_STATE_RESET</span><span class="p">,</span>
	<span class="n">BNX2X_F_STATE_INITIALIZED</span><span class="p">,</span>
	<span class="n">BNX2X_F_STATE_STARTED</span><span class="p">,</span>
	<span class="n">BNX2X_F_STATE_TX_STOPPED</span><span class="p">,</span>
	<span class="n">BNX2X_F_STATE_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Allowed Function commands */</span>
<span class="k">enum</span> <span class="n">bnx2x_func_cmd</span> <span class="p">{</span>
	<span class="n">BNX2X_F_CMD_HW_INIT</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_START</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_STOP</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_HW_RESET</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_AFEX_UPDATE</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_AFEX_VIFLISTS</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_TX_STOP</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_TX_START</span><span class="p">,</span>
	<span class="n">BNX2X_F_CMD_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_hw_init_params</span> <span class="p">{</span>
	<span class="cm">/* A load phase returned by MCP.</span>
<span class="cm">	 *</span>
<span class="cm">	 * May be:</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_COMMON_CHIP</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_COMMON</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_PORT</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_FUNCTION</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">load_phase</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_hw_reset_params</span> <span class="p">{</span>
	<span class="cm">/* A load phase returned by MCP.</span>
<span class="cm">	 *</span>
<span class="cm">	 * May be:</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_COMMON_CHIP</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_COMMON</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_PORT</span>
<span class="cm">	 *		FW_MSG_CODE_DRV_LOAD_FUNCTION</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">reset_phase</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_start_params</span> <span class="p">{</span>
	<span class="cm">/* Multi Function mode:</span>
<span class="cm">	 *	- Single Function</span>
<span class="cm">	 *	- Switch Dependent</span>
<span class="cm">	 *	- Switch Independent</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">mf_mode</span><span class="p">;</span>

	<span class="cm">/* Switch Dependent mode outer VLAN tag */</span>
	<span class="n">u16</span> <span class="n">sd_vlan_tag</span><span class="p">;</span>

	<span class="cm">/* Function cos mode */</span>
	<span class="n">u8</span> <span class="n">network_cos_mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_afex_update_params</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">vif_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">afex_default_vlan</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">allowed_priorities</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_afex_viflists_params</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">vif_list_index</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">func_bit_map</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">afex_vif_list_command</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">func_to_clear</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">bnx2x_func_tx_start_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">priority_cos</span> <span class="n">traffic_type_to_priority_cos</span><span class="p">[</span><span class="n">MAX_TRAFFIC_TYPES</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">dcb_enabled</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dcb_version</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dont_add_pri_0_en</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_state_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">f_obj</span><span class="p">;</span>

	<span class="cm">/* Current command */</span>
	<span class="k">enum</span> <span class="n">bnx2x_func_cmd</span> <span class="n">cmd</span><span class="p">;</span>

	<span class="cm">/* may have RAMROD_COMP_WAIT set only */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ramrod_flags</span><span class="p">;</span>

	<span class="cm">/* Params according to the current command */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_hw_init_params</span> <span class="n">hw_init</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_hw_reset_params</span> <span class="n">hw_reset</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_start_params</span> <span class="n">start</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_afex_update_params</span> <span class="n">afex_update</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_afex_viflists_params</span> <span class="n">afex_viflists</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">bnx2x_func_tx_start_params</span> <span class="n">tx_start</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">params</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_sp_drv_ops</span> <span class="p">{</span>
	<span class="cm">/* Init tool + runtime initialization:</span>
<span class="cm">	 *      - Common Chip</span>
<span class="cm">	 *      - Common (per Path)</span>
<span class="cm">	 *      - Port</span>
<span class="cm">	 *      - Function phases</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_hw_cmn_chip</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_hw_cmn</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_hw_port</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_hw_func</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>

	<span class="cm">/* Reset Function HW: Common, Port, Function phases. */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_hw_cmn</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_hw_port</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_hw_func</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>

	<span class="cm">/* Init/Free GUNZIP resources */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">gunzip_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">gunzip_end</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>

	<span class="cm">/* Prepare/Release FW resources */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_fw</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">release_fw</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">bnx2x_func_state</span>	<span class="n">state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>

	<span class="cm">/* BNX2X_FUNC_CMD_XX bits. This object implements &quot;one</span>
<span class="cm">	 * pending&quot; paradigm but for debug and tracing purposes it&#39;s</span>
<span class="cm">	 * more convinient to have different bits for different</span>
<span class="cm">	 * commands.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">pending</span><span class="p">;</span>

	<span class="cm">/* Buffer to use as a ramrod data and its mapping */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">rdata</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">rdata_mapping</span><span class="p">;</span>

	<span class="cm">/* Buffer to use as a afex ramrod data and its mapping.</span>
<span class="cm">	 * This can&#39;t be same rdata as above because afex ramrod requests</span>
<span class="cm">	 * can arrive to the object in parallel to other ramrod requests.</span>
<span class="cm">	 */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">afex_rdata</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>		<span class="n">afex_rdata_mapping</span><span class="p">;</span>

	<span class="cm">/* this mutex validates that when pending flag is taken, the next</span>
<span class="cm">	 * ramrod to be sent will be the one set the pending bit</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">one_pending_mutex</span><span class="p">;</span>

	<span class="cm">/* Driver interface */</span>
	<span class="k">struct</span> <span class="n">bnx2x_func_sp_drv_ops</span>	<span class="o">*</span><span class="n">drv</span><span class="p">;</span>

	<span class="cm">/**</span>
<span class="cm">	 * Performs one state change according to the given parameters.</span>
<span class="cm">	 *</span>
<span class="cm">	 * @return 0 in case of success and negative value otherwise.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">send_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_func_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Checks that the requested state transition is legal.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check_transition</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_func_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

	<span class="cm">/**</span>
<span class="cm">	 * Completes the pending command.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">complete_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			    <span class="k">enum</span> <span class="n">bnx2x_func_cmd</span> <span class="n">cmd</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_comp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">,</span>
			 <span class="k">enum</span> <span class="n">bnx2x_func_cmd</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/********************** Interfaces ********************************************/</span>
<span class="cm">/* Queueable objects set */</span>
<span class="k">union</span> <span class="n">bnx2x_qable_obj</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="n">vlan_mac</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/************** Function state update *********/</span>
<span class="kt">void</span> <span class="n">bnx2x_init_func_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span>
			 <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span>
			 <span class="kt">void</span> <span class="o">*</span><span class="n">afex_rdata</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">afex_rdata_mapping</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_func_sp_drv_ops</span> <span class="o">*</span><span class="n">drv_iface</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bnx2x_func_state_change</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">bnx2x_func_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

<span class="k">enum</span> <span class="n">bnx2x_func_state</span> <span class="n">bnx2x_func_get_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">bnx2x_func_sp_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>
<span class="cm">/******************* Queue State **************/</span>
<span class="kt">void</span> <span class="n">bnx2x_init_queue_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">bnx2x_queue_sp_obj</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">u8</span> <span class="n">cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">cids</span><span class="p">,</span>
			  <span class="n">u8</span> <span class="n">cid_cnt</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span>
			  <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bnx2x_queue_state_change</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_queue_state_params</span> <span class="o">*</span><span class="n">params</span><span class="p">);</span>

<span class="cm">/********************* VLAN-MAC ****************/</span>
<span class="kt">void</span> <span class="n">bnx2x_init_mac_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">mac_obj</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span>
			<span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">,</span> <span class="n">bnx2x_obj_type</span> <span class="n">type</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">macs_pool</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">bnx2x_init_vlan_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">vlan_obj</span><span class="p">,</span>
			 <span class="n">u8</span> <span class="n">cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span>
			 <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">,</span> <span class="n">bnx2x_obj_type</span> <span class="n">type</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">vlans_pool</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">bnx2x_init_vlan_mac_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">vlan_mac_obj</span><span class="p">,</span>
			     <span class="n">u8</span> <span class="n">cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span>
			     <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">,</span> <span class="n">bnx2x_obj_type</span> <span class="n">type</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">macs_pool</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">vlans_pool</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bnx2x_config_vlan_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bnx2x_vlan_mac_move</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">bnx2x_vlan_mac_obj</span> <span class="o">*</span><span class="n">dest_o</span><span class="p">);</span>

<span class="cm">/********************* RX MODE ****************/</span>

<span class="kt">void</span> <span class="n">bnx2x_init_rx_mode_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">bnx2x_rx_mode_obj</span> <span class="o">*</span><span class="n">o</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Send and RX_MODE ramrod according to the provided parameters.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bp</span>
<span class="cm"> * @param p Command parameters</span>
<span class="cm"> *</span>
<span class="cm"> * @return 0 - if operation was successfull and there is no pending completions,</span>
<span class="cm"> *         positive number - if there are pending completions,</span>
<span class="cm"> *         negative - if there were errors</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">bnx2x_config_rx_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">bnx2x_rx_mode_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="cm">/****************** MULTICASTS ****************/</span>

<span class="kt">void</span> <span class="n">bnx2x_init_mcast_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">bnx2x_mcast_obj</span> <span class="o">*</span><span class="n">mcast_obj</span><span class="p">,</span>
			  <span class="n">u8</span> <span class="n">mcast_cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mcast_cid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span>
			  <span class="n">u8</span> <span class="n">engine_id</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="n">state</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">,</span>
			  <span class="n">bnx2x_obj_type</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Configure multicast MACs list. May configure a new list</span>
<span class="cm"> * provided in p-&gt;mcast_list (BNX2X_MCAST_CMD_ADD), clean up</span>
<span class="cm"> * (BNX2X_MCAST_CMD_DEL) or restore (BNX2X_MCAST_CMD_RESTORE) a current</span>
<span class="cm"> * configuration, continue to execute the pending commands</span>
<span class="cm"> * (BNX2X_MCAST_CMD_CONT).</span>
<span class="cm"> *</span>
<span class="cm"> * If previous command is still pending or if number of MACs to</span>
<span class="cm"> * configure is more that maximum number of MACs in one command,</span>
<span class="cm"> * the current command will be enqueued to the tail of the</span>
<span class="cm"> * pending commands list.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bp</span>
<span class="cm"> * @param p</span>
<span class="cm"> * @param command to execute: BNX2X_MCAST_CMD_X</span>
<span class="cm"> *</span>
<span class="cm"> * @return 0 is operation was sucessfull and there are no pending completions,</span>
<span class="cm"> *         negative if there were errors, positive if there are pending</span>
<span class="cm"> *         completions.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">bnx2x_config_mcast</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">bnx2x_mcast_ramrod_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>

<span class="cm">/****************** CREDIT POOL ****************/</span>
<span class="kt">void</span> <span class="n">bnx2x_init_mac_credit_pool</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span>
				<span class="n">u8</span> <span class="n">func_num</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">bnx2x_init_vlan_credit_pool</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">bnx2x_credit_pool_obj</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span>
				 <span class="n">u8</span> <span class="n">func_num</span><span class="p">);</span>


<span class="cm">/****************** RSS CONFIGURATION ****************/</span>
<span class="kt">void</span> <span class="n">bnx2x_init_rss_config_obj</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">bnx2x_rss_config_obj</span> <span class="o">*</span><span class="n">rss_obj</span><span class="p">,</span>
			       <span class="n">u8</span> <span class="n">cl_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">func_id</span><span class="p">,</span> <span class="n">u8</span> <span class="n">engine_id</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">rdata</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="n">rdata_mapping</span><span class="p">,</span>
			       <span class="kt">int</span> <span class="n">state</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">pstate</span><span class="p">,</span>
			       <span class="n">bnx2x_obj_type</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Updates RSS configuration according to provided parameters.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bp</span>
<span class="cm"> * @param p</span>
<span class="cm"> *</span>
<span class="cm"> * @return 0 in case of success</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">bnx2x_config_rss</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x</span> <span class="o">*</span><span class="n">bp</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">bnx2x_config_rss_params</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * Return the current ind_table configuration.</span>
<span class="cm"> *</span>
<span class="cm"> * @param bp</span>
<span class="cm"> * @param ind_table buffer to fill with the current indirection</span>
<span class="cm"> *                  table content. Should be at least</span>
<span class="cm"> *                  T_ETH_INDIRECTION_TABLE_SIZE bytes long.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">bnx2x_get_rss_ind_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">bnx2x_rss_config_obj</span> <span class="o">*</span><span class="n">rss_obj</span><span class="p">,</span>
			     <span class="n">u8</span> <span class="o">*</span><span class="n">ind_table</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* BNX2X_SP_VERBS */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
