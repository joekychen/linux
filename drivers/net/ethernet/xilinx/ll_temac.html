<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › xilinx › ll_temac.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ll_temac.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef XILINX_LL_TEMAC_H</span>
<span class="cp">#define XILINX_LL_TEMAC_H</span>

<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/of.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>

<span class="cp">#ifdef CONFIG_PPC_DCR</span>
<span class="cp">#include &lt;asm/dcr.h&gt;</span>
<span class="cp">#include &lt;asm/dcr-regs.h&gt;</span>
<span class="cp">#endif</span>

<span class="cm">/* packet size info */</span>
<span class="cp">#define XTE_HDR_SIZE			14      </span><span class="cm">/* size of Ethernet header */</span><span class="cp"></span>
<span class="cp">#define XTE_TRL_SIZE			4       </span><span class="cm">/* size of Ethernet trailer (FCS) */</span><span class="cp"></span>
<span class="cp">#define XTE_JUMBO_MTU			9000</span>
<span class="cp">#define XTE_MAX_JUMBO_FRAME_SIZE	(XTE_JUMBO_MTU + XTE_HDR_SIZE + XTE_TRL_SIZE)</span>

<span class="cm">/*  Configuration options */</span>

<span class="cm">/*  Accept all incoming packets.</span>
<span class="cm"> *  This option defaults to disabled (cleared) */</span>
<span class="cp">#define XTE_OPTION_PROMISC                      (1 &lt;&lt; 0)</span>
<span class="cm">/*  Jumbo frame support for Tx &amp; Rx.</span>
<span class="cm"> *  This option defaults to disabled (cleared) */</span>
<span class="cp">#define XTE_OPTION_JUMBO                        (1 &lt;&lt; 1)</span>
<span class="cm">/*  VLAN Rx &amp; Tx frame support.</span>
<span class="cm"> *  This option defaults to disabled (cleared) */</span>
<span class="cp">#define XTE_OPTION_VLAN                         (1 &lt;&lt; 2)</span>
<span class="cm">/*  Enable recognition of flow control frames on Rx</span>
<span class="cm"> *  This option defaults to enabled (set) */</span>
<span class="cp">#define XTE_OPTION_FLOW_CONTROL                 (1 &lt;&lt; 4)</span>
<span class="cm">/*  Strip FCS and PAD from incoming frames.</span>
<span class="cm"> *  Note: PAD from VLAN frames is not stripped.</span>
<span class="cm"> *  This option defaults to disabled (set) */</span>
<span class="cp">#define XTE_OPTION_FCS_STRIP                    (1 &lt;&lt; 5)</span>
<span class="cm">/*  Generate FCS field and add PAD automatically for outgoing frames.</span>
<span class="cm"> *  This option defaults to enabled (set) */</span>
<span class="cp">#define XTE_OPTION_FCS_INSERT                   (1 &lt;&lt; 6)</span>
<span class="cm">/*  Enable Length/Type error checking for incoming frames. When this option is</span>
<span class="cm">set, the MAC will filter frames that have a mismatched type/length field</span>
<span class="cm">and if XTE_OPTION_REPORT_RXERR is set, the user is notified when these</span>
<span class="cm">types of frames are encountered. When this option is cleared, the MAC will</span>
<span class="cm">allow these types of frames to be received.</span>
<span class="cm">This option defaults to enabled (set) */</span>
<span class="cp">#define XTE_OPTION_LENTYPE_ERR                  (1 &lt;&lt; 7)</span>
<span class="cm">/*  Enable the transmitter.</span>
<span class="cm"> *  This option defaults to enabled (set) */</span>
<span class="cp">#define XTE_OPTION_TXEN                         (1 &lt;&lt; 11)</span>
<span class="cm">/*  Enable the receiver</span>
<span class="cm">*   This option defaults to enabled (set) */</span>
<span class="cp">#define XTE_OPTION_RXEN                         (1 &lt;&lt; 12)</span>

<span class="cm">/*  Default options set when device is initialized or reset */</span>
<span class="cp">#define XTE_OPTION_DEFAULTS                     \</span>
<span class="cp">	(XTE_OPTION_TXEN |                          \</span>
<span class="cp">	 XTE_OPTION_FLOW_CONTROL |                  \</span>
<span class="cp">	 XTE_OPTION_RXEN)</span>

<span class="cm">/* XPS_LL_TEMAC SDMA registers definition */</span>

<span class="cp">#define TX_NXTDESC_PTR      0x00            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define TX_CURBUF_ADDR      0x01            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define TX_CURBUF_LENGTH    0x02            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define TX_CURDESC_PTR      0x03            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define TX_TAILDESC_PTR     0x04            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define TX_CHNL_CTRL        0x05            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> 0:7      24:31       IRQTimeout</span>
<span class="cm"> 8:15     16:23       IRQCount</span>
<span class="cm"> 16:20    11:15       Reserved</span>
<span class="cm"> 21       10          0</span>
<span class="cm"> 22       9           UseIntOnEnd</span>
<span class="cm"> 23       8           LdIRQCnt</span>
<span class="cm"> 24       7           IRQEn</span>
<span class="cm"> 25:28    3:6         Reserved</span>
<span class="cm"> 29       2           IrqErrEn</span>
<span class="cm"> 30       1           IrqDlyEn</span>
<span class="cm"> 31       0           IrqCoalEn</span>
<span class="cm">*/</span>
<span class="cp">#define CHNL_CTRL_IRQ_IOE       (1 &lt;&lt; 9)</span>
<span class="cp">#define CHNL_CTRL_IRQ_EN        (1 &lt;&lt; 7)</span>
<span class="cp">#define CHNL_CTRL_IRQ_ERR_EN    (1 &lt;&lt; 2)</span>
<span class="cp">#define CHNL_CTRL_IRQ_DLY_EN    (1 &lt;&lt; 1)</span>
<span class="cp">#define CHNL_CTRL_IRQ_COAL_EN   (1 &lt;&lt; 0)</span>
<span class="cp">#define TX_IRQ_REG          0x06            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm">  0:7      24:31       DltTmrValue</span>
<span class="cm"> 8:15     16:23       ClscCntrValue</span>
<span class="cm"> 16:17    14:15       Reserved</span>
<span class="cm"> 18:21    10:13       ClscCnt</span>
<span class="cm"> 22:23    8:9         DlyCnt</span>
<span class="cm"> 24:28    3::7        Reserved</span>
<span class="cm"> 29       2           ErrIrq</span>
<span class="cm"> 30       1           DlyIrq</span>
<span class="cm"> 31       0           CoalIrq</span>
<span class="cm"> */</span>
<span class="cp">#define TX_CHNL_STS         0x07            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm">   0:9      22:31   Reserved</span>
<span class="cm"> 10       21      TailPErr</span>
<span class="cm"> 11       20      CmpErr</span>
<span class="cm"> 12       19      AddrErr</span>
<span class="cm"> 13       18      NxtPErr</span>
<span class="cm"> 14       17      CurPErr</span>
<span class="cm"> 15       16      BsyWr</span>
<span class="cm"> 16:23    8:15    Reserved</span>
<span class="cm"> 24       7       Error</span>
<span class="cm"> 25       6       IOE</span>
<span class="cm"> 26       5       SOE</span>
<span class="cm"> 27       4       Cmplt</span>
<span class="cm"> 28       3       SOP</span>
<span class="cm"> 29       2       EOP</span>
<span class="cm"> 30       1       EngBusy</span>
<span class="cm"> 31       0       Reserved</span>
<span class="cm">*/</span>

<span class="cp">#define RX_NXTDESC_PTR      0x08            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define RX_CURBUF_ADDR      0x09            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define RX_CURBUF_LENGTH    0x0a            </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define RX_CURDESC_PTR      0x0b            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define RX_TAILDESC_PTR     0x0c            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define RX_CHNL_CTRL        0x0d            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> 0:7      24:31       IRQTimeout</span>
<span class="cm"> 8:15     16:23       IRQCount</span>
<span class="cm"> 16:20    11:15       Reserved</span>
<span class="cm"> 21       10          0</span>
<span class="cm"> 22       9           UseIntOnEnd</span>
<span class="cm"> 23       8           LdIRQCnt</span>
<span class="cm"> 24       7           IRQEn</span>
<span class="cm"> 25:28    3:6         Reserved</span>
<span class="cm"> 29       2           IrqErrEn</span>
<span class="cm"> 30       1           IrqDlyEn</span>
<span class="cm"> 31       0           IrqCoalEn</span>
<span class="cm"> */</span>
<span class="cp">#define RX_IRQ_REG          0x0e            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define IRQ_COAL        (1 &lt;&lt; 0)</span>
<span class="cp">#define IRQ_DLY         (1 &lt;&lt; 1)</span>
<span class="cp">#define IRQ_ERR         (1 &lt;&lt; 2)</span>
<span class="cp">#define IRQ_DMAERR      (1 &lt;&lt; 7)            </span><span class="cm">/* this is not documented ??? */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> 0:7      24:31       DltTmrValue</span>
<span class="cm"> 8:15     16:23       ClscCntrValue</span>
<span class="cm"> 16:17    14:15       Reserved</span>
<span class="cm"> 18:21    10:13       ClscCnt</span>
<span class="cm"> 22:23    8:9         DlyCnt</span>
<span class="cm"> 24:28    3::7        Reserved</span>
<span class="cm">*/</span>
<span class="cp">#define RX_CHNL_STS         0x0f        </span><span class="cm">/* r */</span><span class="cp"></span>
<span class="cp">#define CHNL_STS_ENGBUSY    (1 &lt;&lt; 1)</span>
<span class="cp">#define CHNL_STS_EOP        (1 &lt;&lt; 2)</span>
<span class="cp">#define CHNL_STS_SOP        (1 &lt;&lt; 3)</span>
<span class="cp">#define CHNL_STS_CMPLT      (1 &lt;&lt; 4)</span>
<span class="cp">#define CHNL_STS_SOE        (1 &lt;&lt; 5)</span>
<span class="cp">#define CHNL_STS_IOE        (1 &lt;&lt; 6)</span>
<span class="cp">#define CHNL_STS_ERR        (1 &lt;&lt; 7)</span>

<span class="cp">#define CHNL_STS_BSYWR      (1 &lt;&lt; 16)</span>
<span class="cp">#define CHNL_STS_CURPERR    (1 &lt;&lt; 17)</span>
<span class="cp">#define CHNL_STS_NXTPERR    (1 &lt;&lt; 18)</span>
<span class="cp">#define CHNL_STS_ADDRERR    (1 &lt;&lt; 19)</span>
<span class="cp">#define CHNL_STS_CMPERR     (1 &lt;&lt; 20)</span>
<span class="cp">#define CHNL_STS_TAILERR    (1 &lt;&lt; 21)</span>
<span class="cm">/*</span>
<span class="cm"> 0:9      22:31   Reserved</span>
<span class="cm"> 10       21      TailPErr</span>
<span class="cm"> 11       20      CmpErr</span>
<span class="cm"> 12       19      AddrErr</span>
<span class="cm"> 13       18      NxtPErr</span>
<span class="cm"> 14       17      CurPErr</span>
<span class="cm"> 15       16      BsyWr</span>
<span class="cm"> 16:23    8:15    Reserved</span>
<span class="cm"> 24       7       Error</span>
<span class="cm"> 25       6       IOE</span>
<span class="cm"> 26       5       SOE</span>
<span class="cm"> 27       4       Cmplt</span>
<span class="cm"> 28       3       SOP</span>
<span class="cm"> 29       2       EOP</span>
<span class="cm"> 30       1       EngBusy</span>
<span class="cm"> 31       0       Reserved</span>
<span class="cm">*/</span>

<span class="cp">#define DMA_CONTROL_REG             0x10            </span><span class="cm">/* rw */</span><span class="cp"></span>
<span class="cp">#define DMA_CONTROL_RST                 (1 &lt;&lt; 0)</span>
<span class="cp">#define DMA_TAIL_ENABLE                 (1 &lt;&lt; 2)</span>

<span class="cm">/* XPS_LL_TEMAC direct registers definition */</span>

<span class="cp">#define XTE_RAF0_OFFSET              0x00</span>
<span class="cp">#define RAF0_RST                        (1 &lt;&lt; 0)</span>
<span class="cp">#define RAF0_MCSTREJ                    (1 &lt;&lt; 1)</span>
<span class="cp">#define RAF0_BCSTREJ                    (1 &lt;&lt; 2)</span>
<span class="cp">#define XTE_TPF0_OFFSET              0x04</span>
<span class="cp">#define XTE_IFGP0_OFFSET             0x08</span>
<span class="cp">#define XTE_ISR0_OFFSET              0x0c</span>
<span class="cp">#define ISR0_HARDACSCMPLT               (1 &lt;&lt; 0)</span>
<span class="cp">#define ISR0_AUTONEG                    (1 &lt;&lt; 1)</span>
<span class="cp">#define ISR0_RXCMPLT                    (1 &lt;&lt; 2)</span>
<span class="cp">#define ISR0_RXREJ                      (1 &lt;&lt; 3)</span>
<span class="cp">#define ISR0_RXFIFOOVR                  (1 &lt;&lt; 4)</span>
<span class="cp">#define ISR0_TXCMPLT                    (1 &lt;&lt; 5)</span>
<span class="cp">#define ISR0_RXDCMLCK                   (1 &lt;&lt; 6)</span>

<span class="cp">#define XTE_IPR0_OFFSET              0x10</span>
<span class="cp">#define XTE_IER0_OFFSET              0x14</span>

<span class="cp">#define XTE_MSW0_OFFSET              0x20</span>
<span class="cp">#define XTE_LSW0_OFFSET              0x24</span>
<span class="cp">#define XTE_CTL0_OFFSET              0x28</span>
<span class="cp">#define XTE_RDY0_OFFSET              0x2c</span>

<span class="cp">#define XTE_RSE_MIIM_RR_MASK      0x0002</span>
<span class="cp">#define XTE_RSE_MIIM_WR_MASK      0x0004</span>
<span class="cp">#define XTE_RSE_CFG_RR_MASK       0x0020</span>
<span class="cp">#define XTE_RSE_CFG_WR_MASK       0x0040</span>
<span class="cp">#define XTE_RDY0_HARD_ACS_RDY_MASK  (0x10000)</span>

<span class="cm">/* XPS_LL_TEMAC indirect registers offset definition */</span>

<span class="cp">#define	XTE_RXC0_OFFSET			0x00000200 </span><span class="cm">/* Rx configuration word 0 */</span><span class="cp"></span>
<span class="cp">#define	XTE_RXC1_OFFSET			0x00000240 </span><span class="cm">/* Rx configuration word 1 */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXRST_MASK		(1 &lt;&lt; 31)  </span><span class="cm">/* Receiver reset */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXJMBO_MASK		(1 &lt;&lt; 30)  </span><span class="cm">/* Jumbo frame enable */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXFCS_MASK		(1 &lt;&lt; 29)  </span><span class="cm">/* FCS not stripped */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXEN_MASK		(1 &lt;&lt; 28)  </span><span class="cm">/* Receiver enable */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXVLAN_MASK		(1 &lt;&lt; 27)  </span><span class="cm">/* VLAN enable */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXHD_MASK		(1 &lt;&lt; 26)  </span><span class="cm">/* Half duplex */</span><span class="cp"></span>
<span class="cp">#define XTE_RXC1_RXLT_MASK		(1 &lt;&lt; 25)  </span><span class="cm">/* Length/type check disable */</span><span class="cp"></span>

<span class="cp">#define XTE_TXC_OFFSET			0x00000280 </span><span class="cm">/*  Tx configuration */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXRST_MASK		(1 &lt;&lt; 31)  </span><span class="cm">/* Transmitter reset */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXJMBO_MASK		(1 &lt;&lt; 30)  </span><span class="cm">/* Jumbo frame enable */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXFCS_MASK		(1 &lt;&lt; 29)  </span><span class="cm">/* Generate FCS */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXEN_MASK		(1 &lt;&lt; 28)  </span><span class="cm">/* Transmitter enable */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXVLAN_MASK		(1 &lt;&lt; 27)  </span><span class="cm">/* VLAN enable */</span><span class="cp"></span>
<span class="cp">#define XTE_TXC_TXHD_MASK		(1 &lt;&lt; 26)  </span><span class="cm">/* Half duplex */</span><span class="cp"></span>

<span class="cp">#define XTE_FCC_OFFSET			0x000002C0 </span><span class="cm">/* Flow control config */</span><span class="cp"></span>
<span class="cp">#define XTE_FCC_RXFLO_MASK		(1 &lt;&lt; 29)  </span><span class="cm">/* Rx flow control enable */</span><span class="cp"></span>
<span class="cp">#define XTE_FCC_TXFLO_MASK		(1 &lt;&lt; 30)  </span><span class="cm">/* Tx flow control enable */</span><span class="cp"></span>

<span class="cp">#define XTE_EMCFG_OFFSET		0x00000300 </span><span class="cm">/* EMAC configuration */</span><span class="cp"></span>
<span class="cp">#define XTE_EMCFG_LINKSPD_MASK		0xC0000000 </span><span class="cm">/* Link speed */</span><span class="cp"></span>
<span class="cp">#define XTE_EMCFG_HOSTEN_MASK		(1 &lt;&lt; 26)  </span><span class="cm">/* Host interface enable */</span><span class="cp"></span>
<span class="cp">#define XTE_EMCFG_LINKSPD_10		0x00000000 </span><span class="cm">/* 10 Mbit LINKSPD_MASK */</span><span class="cp"></span>
<span class="cp">#define XTE_EMCFG_LINKSPD_100		(1 &lt;&lt; 30)  </span><span class="cm">/* 100 Mbit LINKSPD_MASK */</span><span class="cp"></span>
<span class="cp">#define XTE_EMCFG_LINKSPD_1000		(1 &lt;&lt; 31)  </span><span class="cm">/* 1000 Mbit LINKSPD_MASK */</span><span class="cp"></span>

<span class="cp">#define XTE_GMIC_OFFSET			0x00000320 </span><span class="cm">/* RGMII/SGMII config */</span><span class="cp"></span>
<span class="cp">#define XTE_MC_OFFSET			0x00000340 </span><span class="cm">/* MDIO configuration */</span><span class="cp"></span>
<span class="cp">#define XTE_UAW0_OFFSET			0x00000380 </span><span class="cm">/* Unicast address word 0 */</span><span class="cp"></span>
<span class="cp">#define XTE_UAW1_OFFSET			0x00000384 </span><span class="cm">/* Unicast address word 1 */</span><span class="cp"></span>

<span class="cp">#define XTE_MAW0_OFFSET			0x00000388 </span><span class="cm">/* Multicast addr word 0 */</span><span class="cp"></span>
<span class="cp">#define XTE_MAW1_OFFSET			0x0000038C </span><span class="cm">/* Multicast addr word 1 */</span><span class="cp"></span>
<span class="cp">#define XTE_AFM_OFFSET			0x00000390 </span><span class="cm">/* Promiscuous mode */</span><span class="cp"></span>
<span class="cp">#define XTE_AFM_EPPRM_MASK		(1 &lt;&lt; 31)  </span><span class="cm">/* Promiscuous mode enable */</span><span class="cp"></span>

<span class="cm">/* Interrupt Request status */</span>
<span class="cp">#define XTE_TIS_OFFSET			0x000003A0</span>
<span class="cp">#define TIS_FRIS			(1 &lt;&lt; 0)</span>
<span class="cp">#define TIS_MRIS			(1 &lt;&lt; 1)</span>
<span class="cp">#define TIS_MWIS			(1 &lt;&lt; 2)</span>
<span class="cp">#define TIS_ARIS			(1 &lt;&lt; 3)</span>
<span class="cp">#define TIS_AWIS			(1 &lt;&lt; 4)</span>
<span class="cp">#define TIS_CRIS			(1 &lt;&lt; 5)</span>
<span class="cp">#define TIS_CWIS			(1 &lt;&lt; 6)</span>

<span class="cp">#define XTE_TIE_OFFSET			0x000003A4 </span><span class="cm">/* Interrupt enable */</span><span class="cp"></span>

<span class="cm">/**  MII Mamagement Control register (MGTCR) */</span>
<span class="cp">#define XTE_MGTDR_OFFSET		0x000003B0 </span><span class="cm">/* MII data */</span><span class="cp"></span>
<span class="cp">#define XTE_MIIMAI_OFFSET		0x000003B4 </span><span class="cm">/* MII control */</span><span class="cp"></span>

<span class="cp">#define CNTLREG_WRITE_ENABLE_MASK   0x8000</span>
<span class="cp">#define CNTLREG_EMAC1SEL_MASK       0x0400</span>
<span class="cp">#define CNTLREG_ADDRESSCODE_MASK    0x03ff</span>

<span class="cm">/* CDMAC descriptor status bit definitions */</span>

<span class="cp">#define STS_CTRL_APP0_ERR         (1 &lt;&lt; 31)</span>
<span class="cp">#define STS_CTRL_APP0_IRQONEND    (1 &lt;&lt; 30)</span>
<span class="cm">/* undoccumented */</span>
<span class="cp">#define STS_CTRL_APP0_STOPONEND   (1 &lt;&lt; 29)</span>
<span class="cp">#define STS_CTRL_APP0_CMPLT       (1 &lt;&lt; 28)</span>
<span class="cp">#define STS_CTRL_APP0_SOP         (1 &lt;&lt; 27)</span>
<span class="cp">#define STS_CTRL_APP0_EOP         (1 &lt;&lt; 26)</span>
<span class="cp">#define STS_CTRL_APP0_ENGBUSY     (1 &lt;&lt; 25)</span>
<span class="cm">/* undocumented */</span>
<span class="cp">#define STS_CTRL_APP0_ENGRST      (1 &lt;&lt; 24)</span>

<span class="cp">#define TX_CONTROL_CALC_CSUM_MASK   1</span>

<span class="cp">#define MULTICAST_CAM_TABLE_NUM 4</span>

<span class="cm">/* TEMAC Synthesis features */</span>
<span class="cp">#define TEMAC_FEATURE_RX_CSUM  (1 &lt;&lt; 0)</span>
<span class="cp">#define TEMAC_FEATURE_TX_CSUM  (1 &lt;&lt; 1)</span>

<span class="cm">/* TX/RX CURDESC_PTR points to first descriptor */</span>
<span class="cm">/* TX/RX TAILDESC_PTR points to last descriptor in linked list */</span>

<span class="cm">/**</span>
<span class="cm"> * struct cdmac_bd - LocalLink buffer descriptor format</span>
<span class="cm"> *</span>
<span class="cm"> * app0 bits:</span>
<span class="cm"> *	0    Error</span>
<span class="cm"> *	1    IrqOnEnd    generate an interrupt at completion of DMA  op</span>
<span class="cm"> *	2    reserved</span>
<span class="cm"> *	3    completed   Current descriptor completed</span>
<span class="cm"> *	4    SOP         TX - marks first desc/ RX marks first desct</span>
<span class="cm"> *	5    EOP         TX marks last desc/RX marks last desc</span>
<span class="cm"> *	6    EngBusy     DMA is processing</span>
<span class="cm"> *	7    reserved</span>
<span class="cm"> *	8:31 application specific</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cdmac_bd</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">next</span><span class="p">;</span>	<span class="cm">/* Physical address of next buffer descriptor */</span>
	<span class="n">u32</span> <span class="n">phys</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">app0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">app1</span><span class="p">;</span>	<span class="cm">/* TX start &lt;&lt; 16 | insert */</span>
	<span class="n">u32</span> <span class="n">app2</span><span class="p">;</span>	<span class="cm">/* TX csum */</span>
	<span class="n">u32</span> <span class="n">app3</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">app4</span><span class="p">;</span>	<span class="cm">/* skb for TX length for RX */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">temac_local</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">ndev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="cm">/* Connection to PHY device */</span>
	<span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phy_dev</span><span class="p">;</span>	<span class="cm">/* Pointer to PHY device */</span>
	<span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">phy_node</span><span class="p">;</span>

	<span class="cm">/* MDIO bus data */</span>
	<span class="k">struct</span> <span class="n">mii_bus</span> <span class="o">*</span><span class="n">mii_bus</span><span class="p">;</span>	<span class="cm">/* MII bus reference */</span>
	<span class="kt">int</span> <span class="n">mdio_irqs</span><span class="p">[</span><span class="n">PHY_MAX_ADDR</span><span class="p">];</span>	<span class="cm">/* IRQs table for MDIO bus */</span>

	<span class="cm">/* IO registers, dma functions and IRQs */</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">sdma_regs</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_PPC_DCR</span>
	<span class="n">dcr_host_t</span> <span class="n">sdma_dcrs</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_in</span><span class="p">)(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_out</span><span class="p">)(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">tx_irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">emac_num</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">**</span><span class="n">rx_skb</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">rx_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">indirect_mutex</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">options</span><span class="p">;</span>			<span class="cm">/* Current options word */</span>
	<span class="kt">int</span> <span class="n">last_link</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">temac_features</span><span class="p">;</span>

	<span class="cm">/* Buffer descriptors */</span>
	<span class="k">struct</span> <span class="n">cdmac_bd</span> <span class="o">*</span><span class="n">tx_bd_v</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">tx_bd_p</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cdmac_bd</span> <span class="o">*</span><span class="n">rx_bd_v</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">rx_bd_p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_bd_ci</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_bd_next</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_bd_tail</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_bd_ci</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* xilinx_temac.c */</span>
<span class="n">u32</span> <span class="n">temac_ior</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">temac_iow</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">temac_indirect_busywait</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">temac_indirect_in32</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">temac_indirect_out32</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>


<span class="cm">/* xilinx_temac_mdio.c */</span>
<span class="kt">int</span> <span class="n">temac_mdio_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">np</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">temac_mdio_teardown</span><span class="p">(</span><span class="k">struct</span> <span class="n">temac_local</span> <span class="o">*</span><span class="n">lp</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* XILINX_LL_TEMAC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
