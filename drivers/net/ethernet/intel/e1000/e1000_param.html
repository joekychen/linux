<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › intel › e1000 › e1000_param.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>e1000_param.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*******************************************************************************</span>

<span class="cm">  Intel PRO/1000 Linux driver</span>
<span class="cm">  Copyright(c) 1999 - 2006 Intel Corporation.</span>

<span class="cm">  This program is free software; you can redistribute it and/or modify it</span>
<span class="cm">  under the terms and conditions of the GNU General Public License,</span>
<span class="cm">  version 2, as published by the Free Software Foundation.</span>

<span class="cm">  This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm">  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm">  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm">  more details.</span>

<span class="cm">  You should have received a copy of the GNU General Public License along with</span>
<span class="cm">  this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm">  51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span class="cm">  The full GNU General Public License is included in this distribution in</span>
<span class="cm">  the file called &quot;COPYING&quot;.</span>

<span class="cm">  Contact Information:</span>
<span class="cm">  Linux NICS &lt;linux.nics@intel.com&gt;</span>
<span class="cm">  e1000-devel Mailing List &lt;e1000-devel@lists.sourceforge.net&gt;</span>
<span class="cm">  Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497</span>

<span class="cm">*******************************************************************************/</span>

<span class="cp">#include &quot;e1000.h&quot;</span>

<span class="cm">/* This is the only thing that needs to be changed to adjust the</span>
<span class="cm"> * maximum number of ports that the driver can manage.</span>
<span class="cm"> */</span>

<span class="cp">#define E1000_MAX_NIC 32</span>

<span class="cp">#define OPTION_UNSET   -1</span>
<span class="cp">#define OPTION_DISABLED 0</span>
<span class="cp">#define OPTION_ENABLED  1</span>

<span class="cm">/* All parameters are treated the same, as an integer array of values.</span>
<span class="cm"> * This macro just reduces the need to repeat the same declaration code</span>
<span class="cm"> * over and over (plus this helps to avoid typo bugs).</span>
<span class="cm"> */</span>

<span class="cp">#define E1000_PARAM_INIT { [0 ... E1000_MAX_NIC] = OPTION_UNSET }</span>
<span class="cp">#define E1000_PARAM(X, desc) \</span>
<span class="cp">	static int __devinitdata X[E1000_MAX_NIC+1] = E1000_PARAM_INIT; \</span>
<span class="cp">	static unsigned int num_##X; \</span>
<span class="cp">	module_param_array_named(X, X, int, &amp;num_##X, 0); \</span>
<span class="cp">	MODULE_PARM_DESC(X, desc);</span>

<span class="cm">/* Transmit Descriptor Count</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 80-256 for 82542 and 82543 gigabit ethernet controllers</span>
<span class="cm"> * Valid Range: 80-4096 for 82544 and newer</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 256</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">TxDescriptors</span><span class="p">,</span> <span class="s">&quot;Number of transmit descriptors&quot;</span><span class="p">);</span>

<span class="cm">/* Receive Descriptor Count</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 80-256 for 82542 and 82543 gigabit ethernet controllers</span>
<span class="cm"> * Valid Range: 80-4096 for 82544 and newer</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 256</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">RxDescriptors</span><span class="p">,</span> <span class="s">&quot;Number of receive descriptors&quot;</span><span class="p">);</span>

<span class="cm">/* User Specified Speed Override</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0, 10, 100, 1000</span>
<span class="cm"> *  - 0    - auto-negotiate at all supported speeds</span>
<span class="cm"> *  - 10   - only link at 10 Mbps</span>
<span class="cm"> *  - 100  - only link at 100 Mbps</span>
<span class="cm"> *  - 1000 - only link at 1000 Mbps</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 0</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">Speed</span><span class="p">,</span> <span class="s">&quot;Speed setting&quot;</span><span class="p">);</span>

<span class="cm">/* User Specified Duplex Override</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-2</span>
<span class="cm"> *  - 0 - auto-negotiate for duplex</span>
<span class="cm"> *  - 1 - only link at half duplex</span>
<span class="cm"> *  - 2 - only link at full duplex</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 0</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">Duplex</span><span class="p">,</span> <span class="s">&quot;Duplex setting&quot;</span><span class="p">);</span>

<span class="cm">/* Auto-negotiation Advertisement Override</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0x01-0x0F, 0x20-0x2F (copper); 0x20 (fiber)</span>
<span class="cm"> *</span>
<span class="cm"> * The AutoNeg value is a bit mask describing which speed and duplex</span>
<span class="cm"> * combinations should be advertised during auto-negotiation.</span>
<span class="cm"> * The supported speed and duplex modes are listed below</span>
<span class="cm"> *</span>
<span class="cm"> * Bit           7     6     5      4      3     2     1      0</span>
<span class="cm"> * Speed (Mbps)  N/A   N/A   1000   N/A    100   100   10     10</span>
<span class="cm"> * Duplex                    Full          Full  Half  Full   Half</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 0x2F (copper); 0x20 (fiber)</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">AutoNeg</span><span class="p">,</span> <span class="s">&quot;Advertised auto-negotiation setting&quot;</span><span class="p">);</span>
<span class="cp">#define AUTONEG_ADV_DEFAULT  0x2F</span>
<span class="cp">#define AUTONEG_ADV_MASK     0x2F</span>

<span class="cm">/* User Specified Flow Control Override</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-3</span>
<span class="cm"> *  - 0 - No Flow Control</span>
<span class="cm"> *  - 1 - Rx only, respond to PAUSE frames but do not generate them</span>
<span class="cm"> *  - 2 - Tx only, generate PAUSE frames but ignore them on receive</span>
<span class="cm"> *  - 3 - Full Flow Control Support</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: Read flow control settings from the EEPROM</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">FlowControl</span><span class="p">,</span> <span class="s">&quot;Flow Control setting&quot;</span><span class="p">);</span>
<span class="cp">#define FLOW_CONTROL_DEFAULT FLOW_CONTROL_FULL</span>

<span class="cm">/* XsumRX - Receive Checksum Offload Enable/Disable</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0, 1</span>
<span class="cm"> *  - 0 - disables all checksum offload</span>
<span class="cm"> *  - 1 - enables receive IP/TCP/UDP checksum offload</span>
<span class="cm"> *        on 82543 and newer -based NICs</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 1</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">XsumRX</span><span class="p">,</span> <span class="s">&quot;Disable or enable Receive Checksum offload&quot;</span><span class="p">);</span>

<span class="cm">/* Transmit Interrupt Delay in units of 1.024 microseconds</span>
<span class="cm"> *  Tx interrupt delay needs to typically be set to something non zero</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-65535</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">TxIntDelay</span><span class="p">,</span> <span class="s">&quot;Transmit Interrupt Delay&quot;</span><span class="p">);</span>
<span class="cp">#define DEFAULT_TIDV                   8</span>
<span class="cp">#define MAX_TXDELAY               0xFFFF</span>
<span class="cp">#define MIN_TXDELAY                    0</span>

<span class="cm">/* Transmit Absolute Interrupt Delay in units of 1.024 microseconds</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-65535</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">TxAbsIntDelay</span><span class="p">,</span> <span class="s">&quot;Transmit Absolute Interrupt Delay&quot;</span><span class="p">);</span>
<span class="cp">#define DEFAULT_TADV                  32</span>
<span class="cp">#define MAX_TXABSDELAY            0xFFFF</span>
<span class="cp">#define MIN_TXABSDELAY                 0</span>

<span class="cm">/* Receive Interrupt Delay in units of 1.024 microseconds</span>
<span class="cm"> *   hardware will likely hang if you set this to anything but zero.</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-65535</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">RxIntDelay</span><span class="p">,</span> <span class="s">&quot;Receive Interrupt Delay&quot;</span><span class="p">);</span>
<span class="cp">#define DEFAULT_RDTR                   0</span>
<span class="cp">#define MAX_RXDELAY               0xFFFF</span>
<span class="cp">#define MIN_RXDELAY                    0</span>

<span class="cm">/* Receive Absolute Interrupt Delay in units of 1.024 microseconds</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0-65535</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">RxAbsIntDelay</span><span class="p">,</span> <span class="s">&quot;Receive Absolute Interrupt Delay&quot;</span><span class="p">);</span>
<span class="cp">#define DEFAULT_RADV                   8</span>
<span class="cp">#define MAX_RXABSDELAY            0xFFFF</span>
<span class="cp">#define MIN_RXABSDELAY                 0</span>

<span class="cm">/* Interrupt Throttle Rate (interrupts/sec)</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 100-100000 (0=off, 1=dynamic, 3=dynamic conservative)</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">InterruptThrottleRate</span><span class="p">,</span> <span class="s">&quot;Interrupt Throttling Rate&quot;</span><span class="p">);</span>
<span class="cp">#define DEFAULT_ITR                    3</span>
<span class="cp">#define MAX_ITR                   100000</span>
<span class="cp">#define MIN_ITR                      100</span>

<span class="cm">/* Enable Smart Power Down of the PHY</span>
<span class="cm"> *</span>
<span class="cm"> * Valid Range: 0, 1</span>
<span class="cm"> *</span>
<span class="cm"> * Default Value: 0 (disabled)</span>
<span class="cm"> */</span>
<span class="n">E1000_PARAM</span><span class="p">(</span><span class="n">SmartPowerDownEnable</span><span class="p">,</span> <span class="s">&quot;Enable PHY smart power down&quot;</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">e1000_option</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="p">{</span> <span class="n">enable_option</span><span class="p">,</span> <span class="n">range_option</span><span class="p">,</span> <span class="n">list_option</span> <span class="p">}</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">err</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">def</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span> <span class="cm">/* range_option info */</span>
			<span class="kt">int</span> <span class="n">min</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">max</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">r</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span> <span class="cm">/* list_option info */</span>
			<span class="kt">int</span> <span class="n">nr</span><span class="p">;</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span> <span class="p">}</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">l</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">arg</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">e1000_validate_option</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span>
					   <span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_option</span> <span class="o">*</span><span class="n">opt</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">value</span> <span class="o">==</span> <span class="n">OPTION_UNSET</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">def</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">enable_option</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">OPTION_ENABLED</span>:
			<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s Enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OPTION_DISABLED</span>:
			<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s Disabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">range_option</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">.</span><span class="n">r</span><span class="p">.</span><span class="n">max</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s set to %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">list_option</span>: <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="o">*</span><span class="n">ent</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">nr</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">opt</span><span class="o">-&gt;</span><span class="n">arg</span><span class="p">.</span><span class="n">l</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">value</span> <span class="o">==</span> <span class="n">ent</span><span class="o">-&gt;</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">ent</span><span class="o">-&gt;</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\0&#39;</span><span class="p">)</span>
					<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ent</span><span class="o">-&gt;</span><span class="n">str</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Invalid %s value specified (%i) %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">opt</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">err</span><span class="p">);</span>
	<span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="o">-&gt;</span><span class="n">def</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">e1000_check_fiber_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">e1000_check_copper_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * e1000_check_options - Range Checking for Command Line Parameters</span>
<span class="cm"> * @adapter: board private structure</span>
<span class="cm"> *</span>
<span class="cm"> * This routine checks all command line parameters for valid user</span>
<span class="cm"> * input.  If an invalid value is given, or if no user specified</span>
<span class="cm"> * value exists, a default value is used.  The final value is stored</span>
<span class="cm"> * in a variable in the adapter structure.</span>
<span class="cm"> **/</span>

<span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">e1000_check_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">e1000_option</span> <span class="n">opt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bd</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">bd_number</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bd</span> <span class="o">&gt;=</span> <span class="n">E1000_MAX_NIC</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">e_dev_warn</span><span class="p">(</span><span class="s">&quot;Warning: no configuration for board #%i &quot;</span>
			   <span class="s">&quot;using defaults for all values</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">bd</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="p">{</span> <span class="cm">/* Transmit Descriptor Count */</span>
		<span class="k">struct</span> <span class="n">e1000_tx_ring</span> <span class="o">*</span><span class="n">tx_ring</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">e1000_mac_type</span> <span class="n">mac_type</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">mac_type</span><span class="p">;</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Transmit Descriptors&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span>
				<span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">E1000_DEFAULT_TXD</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">E1000_DEFAULT_TXD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">E1000_MIN_TXD</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">mac_type</span> <span class="o">&lt;</span> <span class="n">e1000_82544</span> <span class="o">?</span> <span class="n">E1000_MAX_TXD</span> <span class="o">:</span> <span class="n">E1000_MAX_82544_TXD</span>
				<span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_TxDescriptors</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">TxDescriptors</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
			<span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span>
						<span class="n">REQ_TX_DESCRIPTOR_MULTIPLE</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">num_tx_queues</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">tx_ring</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span> <span class="n">tx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Receive Descriptor Count */</span>
		<span class="k">struct</span> <span class="n">e1000_rx_ring</span> <span class="o">*</span><span class="n">rx_ring</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">e1000_mac_type</span> <span class="n">mac_type</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">mac_type</span><span class="p">;</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Receive Descriptors&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span>
				<span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">E1000_DEFAULT_RXD</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">E1000_DEFAULT_RXD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">E1000_MIN_RXD</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">mac_type</span> <span class="o">&lt;</span> <span class="n">e1000_82544</span> <span class="o">?</span> <span class="n">E1000_MAX_RXD</span> <span class="o">:</span> <span class="n">E1000_MAX_82544_RXD</span>
			<span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_RxDescriptors</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">RxDescriptors</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
			<span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span>
						<span class="n">REQ_RX_DESCRIPTOR_MULTIPLE</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">num_rx_queues</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">rx_ring</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">count</span> <span class="o">=</span> <span class="n">rx_ring</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Checksum Offload Enable/Disable */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">enable_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Checksum Offload&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;defaulting to Enabled&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">OPTION_ENABLED</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_XsumRX</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_csum</span> <span class="o">=</span> <span class="n">XsumRX</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rx_csum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_csum</span> <span class="o">=</span> <span class="n">rx_csum</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_csum</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Flow Control */</span>

		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="n">fc_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		       <span class="p">{</span> <span class="n">E1000_FC_NONE</span><span class="p">,</span> <span class="s">&quot;Flow Control Disabled&quot;</span> <span class="p">},</span>
		       <span class="p">{</span> <span class="n">E1000_FC_RX_PAUSE</span><span class="p">,</span> <span class="s">&quot;Flow Control Receive Only&quot;</span> <span class="p">},</span>
		       <span class="p">{</span> <span class="n">E1000_FC_TX_PAUSE</span><span class="p">,</span> <span class="s">&quot;Flow Control Transmit Only&quot;</span> <span class="p">},</span>
		       <span class="p">{</span> <span class="n">E1000_FC_FULL</span><span class="p">,</span> <span class="s">&quot;Flow Control Enabled&quot;</span> <span class="p">},</span>
		       <span class="p">{</span> <span class="n">E1000_FC_DEFAULT</span><span class="p">,</span> <span class="s">&quot;Flow Control Hardware Default&quot;</span> <span class="p">}</span>
		<span class="p">};</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">list_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Flow Control&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;reading default settings from EEPROM&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">E1000_FC_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">nr</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">fc_list</span><span class="p">),</span>
					 <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">fc_list</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_FlowControl</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fc</span> <span class="o">=</span> <span class="n">FlowControl</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">original_fc</span> <span class="o">=</span> <span class="n">fc</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">original_fc</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Transmit Interrupt Delay */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Transmit Interrupt Delay&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span> <span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">DEFAULT_TIDV</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">DEFAULT_TIDV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIN_TXDELAY</span><span class="p">,</span>
					 <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAX_TXDELAY</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_TxIntDelay</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_int_delay</span> <span class="o">=</span> <span class="n">TxIntDelay</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_int_delay</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span>
			                      <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_int_delay</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Transmit Absolute Interrupt Delay */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Transmit Absolute Interrupt Delay&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span> <span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">DEFAULT_TADV</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">DEFAULT_TADV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIN_TXABSDELAY</span><span class="p">,</span>
					 <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAX_TXABSDELAY</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_TxAbsIntDelay</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_abs_int_delay</span> <span class="o">=</span> <span class="n">TxAbsIntDelay</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_abs_int_delay</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span>
			                      <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_abs_int_delay</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Receive Interrupt Delay */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Receive Interrupt Delay&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span> <span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">DEFAULT_RDTR</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">DEFAULT_RDTR</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIN_RXDELAY</span><span class="p">,</span>
					 <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAX_RXDELAY</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_RxIntDelay</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_int_delay</span> <span class="o">=</span> <span class="n">RxIntDelay</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_int_delay</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span>
			                      <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_int_delay</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Receive Absolute Interrupt Delay */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Receive Absolute Interrupt Delay&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span> <span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">DEFAULT_RADV</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">DEFAULT_RADV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIN_RXABSDELAY</span><span class="p">,</span>
					 <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAX_RXABSDELAY</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_RxAbsIntDelay</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_abs_int_delay</span> <span class="o">=</span> <span class="n">RxAbsIntDelay</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_abs_int_delay</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span>
			                      <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_abs_int_delay</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Interrupt Throttling Rate */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">range_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Interrupt Throttling Rate (ints/sec)&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;using default of &quot;</span> <span class="n">__MODULE_STRING</span><span class="p">(</span><span class="n">DEFAULT_ITR</span><span class="p">),</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">DEFAULT_ITR</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">r</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIN_ITR</span><span class="p">,</span>
					 <span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MAX_ITR</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_InterruptThrottleRate</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span> <span class="o">=</span> <span class="n">InterruptThrottleRate</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mi">0</span>:
				<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s turned off</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">1</span>:
				<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s set to dynamic mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					   <span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr_setting</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span><span class="p">;</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">3</span>:
				<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s set to dynamic conservative &quot;</span>
					   <span class="s">&quot;mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr_setting</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span><span class="p">;</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mi">4</span>:
				<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;%s set to simplified &quot;</span>
				           <span class="s">&quot;(2000-8000) ints mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opt</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr_setting</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span>
				        <span class="n">adapter</span><span class="p">);</span>
				<span class="cm">/* save the setting, because the dynamic bits</span>
<span class="cm">				 * change itr.</span>
<span class="cm">				 * clear the lower two bits because they are</span>
<span class="cm">				 * used as control */</span>
				<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr_setting</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr_setting</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">itr</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Smart Power Down */</span>
		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">enable_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PHY Smart Power Down&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;defaulting to Disabled&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">OPTION_DISABLED</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_SmartPowerDownEnable</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spd</span> <span class="o">=</span> <span class="n">SmartPowerDownEnable</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">smart_power_down</span> <span class="o">=</span> <span class="n">spd</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">smart_power_down</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">media_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">e1000_media_type_fiber</span>:
	<span class="k">case</span> <span class="n">e1000_media_type_internal_serdes</span>:
		<span class="n">e1000_check_fiber_options</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">e1000_media_type_copper</span>:
		<span class="n">e1000_check_copper_options</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * e1000_check_fiber_options - Range Checking for Link Options, Fiber Version</span>
<span class="cm"> * @adapter: board private structure</span>
<span class="cm"> *</span>
<span class="cm"> * Handles speed and duplex options on fiber adapters</span>
<span class="cm"> **/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">e1000_check_fiber_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">bd</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">bd_number</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num_Speed</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Speed not valid for fiber adapters, parameter &quot;</span>
			   <span class="s">&quot;ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">num_Duplex</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Duplex not valid for fiber adapters, parameter &quot;</span>
			   <span class="s">&quot;ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">num_AutoNeg</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">AutoNeg</span><span class="p">[</span><span class="n">bd</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x20</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;AutoNeg other than 1000/Full is not valid for fiber&quot;</span>
			   <span class="s">&quot;adapters, parameter ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * e1000_check_copper_options - Range Checking for Link Options, Copper Version</span>
<span class="cm"> * @adapter: board private structure</span>
<span class="cm"> *</span>
<span class="cm"> * Handles speed and duplex options on copper adapters</span>
<span class="cm"> **/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">e1000_check_copper_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">e1000_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">e1000_option</span> <span class="n">opt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="n">dplx</span><span class="p">,</span> <span class="n">an</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bd</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">bd_number</span><span class="p">;</span>

	<span class="p">{</span> <span class="cm">/* Speed */</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="n">speed_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>          <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">},</span>
			<span class="p">{</span>   <span class="n">SPEED_10</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">},</span>
			<span class="p">{</span>  <span class="n">SPEED_100</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">},</span>
			<span class="p">{</span> <span class="n">SPEED_1000</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">}};</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">list_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Speed&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;parameter ignored&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">nr</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">speed_list</span><span class="p">),</span>
					 <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">speed_list</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_Speed</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">speed</span> <span class="o">=</span> <span class="n">Speed</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">speed</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">speed</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="p">{</span> <span class="cm">/* Duplex */</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="n">dplx_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>           <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">},</span>
			<span class="p">{</span> <span class="n">HALF_DUPLEX</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">},</span>
			<span class="p">{</span> <span class="n">FULL_DUPLEX</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">}};</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">list_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Duplex&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;parameter ignored&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">nr</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">dplx_list</span><span class="p">),</span>
					 <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">dplx_list</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_Duplex</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dplx</span> <span class="o">=</span> <span class="n">Duplex</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dplx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">dplx</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">num_AutoNeg</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">speed</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">dplx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;AutoNeg specified along with Speed or Duplex, &quot;</span>
			   <span class="s">&quot;parameter ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">AUTONEG_ADV_DEFAULT</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* Autoneg */</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">e1000_opt_list</span> <span class="n">an_list</span><span class="p">[]</span> <span class="o">=</span>
			<span class="cp">#define AA &quot;AutoNeg advertising &quot;</span>
			<span class="p">{{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x05</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/HD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/HD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x07</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/HD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x08</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x09</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 100/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 100/HD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 100/HD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;100/FD, 100/HD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x23</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x24</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/HD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/HD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/HD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 10/FD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 100/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 100/HD, 10/HD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 100/HD, 10/FD&quot;</span> <span class="p">},</span>
			 <span class="p">{</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="n">AA</span> <span class="s">&quot;1000/FD, 100/FD, 100/HD, 10/FD, 10/HD&quot;</span> <span class="p">}};</span>

		<span class="n">opt</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">e1000_option</span><span class="p">)</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">list_option</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AutoNeg&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">err</span>  <span class="o">=</span> <span class="s">&quot;parameter ignored&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">def</span>  <span class="o">=</span> <span class="n">AUTONEG_ADV_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">arg</span>  <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">l</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">nr</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">an_list</span><span class="p">),</span>
					 <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">an_list</span> <span class="p">}}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">num_AutoNeg</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">an</span> <span class="o">=</span> <span class="n">AutoNeg</span><span class="p">[</span><span class="n">bd</span><span class="p">];</span>
			<span class="n">e1000_validate_option</span><span class="p">(</span><span class="o">&amp;</span><span class="n">an</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">opt</span><span class="p">,</span> <span class="n">adapter</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">an</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="n">def</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">an</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">speed</span> <span class="o">+</span> <span class="n">dplx</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">num_Speed</span> <span class="o">&gt;</span> <span class="n">bd</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">speed</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">dplx</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
			<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Speed and duplex autonegotiation &quot;</span>
				   <span class="s">&quot;enabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HALF_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Half Duplex specified without Speed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Using Autonegotiation at Half Duplex only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">ADVERTISE_10_HALF</span> <span class="o">|</span>
		                                 <span class="n">ADVERTISE_100_HALF</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FULL_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Full Duplex specified without Speed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Using Autonegotiation at Full Duplex only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">ADVERTISE_10_FULL</span> <span class="o">|</span>
		                                 <span class="n">ADVERTISE_100_FULL</span> <span class="o">|</span>
		                                 <span class="n">ADVERTISE_1000_FULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_10</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;10 Mbps Speed specified without Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Using Autonegotiation at 10 Mbps only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">ADVERTISE_10_HALF</span> <span class="o">|</span>
		                                 <span class="n">ADVERTISE_10_FULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_10</span> <span class="o">+</span> <span class="n">HALF_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Forcing to 10 Mbps Half Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">forced_speed_duplex</span> <span class="o">=</span> <span class="n">e1000_10_half</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_10</span> <span class="o">+</span> <span class="n">FULL_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Forcing to 10 Mbps Full Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">forced_speed_duplex</span> <span class="o">=</span> <span class="n">e1000_10_full</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_100</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;100 Mbps Speed specified without Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Using Autonegotiation at 100 Mbps only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">ADVERTISE_100_HALF</span> <span class="o">|</span>
		                                 <span class="n">ADVERTISE_100_FULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_100</span> <span class="o">+</span> <span class="n">HALF_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Forcing to 100 Mbps Half Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">forced_speed_duplex</span> <span class="o">=</span> <span class="n">e1000_100_half</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_100</span> <span class="o">+</span> <span class="n">FULL_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Forcing to 100 Mbps Full Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">forced_speed_duplex</span> <span class="o">=</span> <span class="n">e1000_100_full</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_1000</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;1000 Mbps Speed specified without Duplex</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">full_duplex_only</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SPEED_1000</span> <span class="o">+</span> <span class="n">HALF_DUPLEX</span>:
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Half Duplex is not supported at 1000 Mbps</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="cm">/* fall through */</span>
	<span class="k">case</span> <span class="n">SPEED_1000</span> <span class="o">+</span> <span class="n">FULL_DUPLEX</span>:
<span class="nl">full_duplex_only:</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Using Autonegotiation at 1000 Mbps Full Duplex &quot;</span>
			   <span class="s">&quot;only</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fc_autoneg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">.</span><span class="n">autoneg_advertised</span> <span class="o">=</span> <span class="n">ADVERTISE_1000_FULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="cm">/* Speed, AutoNeg and MDI/MDI-X must all play nice */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">e1000_validate_mdi_setting</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">e_dev_info</span><span class="p">(</span><span class="s">&quot;Speed, AutoNeg and MDI-X specs are incompatible. &quot;</span>
			   <span class="s">&quot;Setting MDI-X to a compatible value.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
