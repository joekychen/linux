<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › intel › ixgbe › ixgbe_dcb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>ixgbe_dcb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*******************************************************************************</span>

<span class="cm">  Intel 10 Gigabit PCI Express Linux driver</span>
<span class="cm">  Copyright(c) 1999 - 2012 Intel Corporation.</span>

<span class="cm">  This program is free software; you can redistribute it and/or modify it</span>
<span class="cm">  under the terms and conditions of the GNU General Public License,</span>
<span class="cm">  version 2, as published by the Free Software Foundation.</span>

<span class="cm">  This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm">  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm">  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm">  more details.</span>

<span class="cm">  You should have received a copy of the GNU General Public License along with</span>
<span class="cm">  this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm">  51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span class="cm">  The full GNU General Public License is included in this distribution in</span>
<span class="cm">  the file called &quot;COPYING&quot;.</span>

<span class="cm">  Contact Information:</span>
<span class="cm">  Linux NICS &lt;linux.nics@intel.com&gt;</span>
<span class="cm">  e1000-devel Mailing List &lt;e1000-devel@lists.sourceforge.net&gt;</span>
<span class="cm">  Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497</span>

<span class="cm">*******************************************************************************/</span>

<span class="cp">#ifndef _DCB_CONFIG_H_</span>
<span class="cp">#define _DCB_CONFIG_H_</span>

<span class="cp">#include &lt;linux/dcbnl.h&gt;</span>
<span class="cp">#include &quot;ixgbe_type.h&quot;</span>

<span class="cm">/* DCB data structures */</span>

<span class="cp">#define IXGBE_MAX_PACKET_BUFFERS 8</span>
<span class="cp">#define MAX_USER_PRIORITY        8</span>
<span class="cp">#define MAX_BW_GROUP             8</span>
<span class="cp">#define BW_PERCENT               100</span>

<span class="cp">#define DCB_TX_CONFIG            0</span>
<span class="cp">#define DCB_RX_CONFIG            1</span>

<span class="cm">/* DCB error Codes */</span>
<span class="cp">#define DCB_SUCCESS              0</span>
<span class="cp">#define DCB_ERR_CONFIG           -1</span>
<span class="cp">#define DCB_ERR_PARAM            -2</span>

<span class="cm">/* Transmit and receive Errors */</span>
<span class="cm">/* Error in bandwidth group allocation */</span>
<span class="cp">#define DCB_ERR_BW_GROUP        -3</span>
<span class="cm">/* Error in traffic class bandwidth allocation */</span>
<span class="cp">#define DCB_ERR_TC_BW           -4</span>
<span class="cm">/* Traffic class has both link strict and group strict enabled */</span>
<span class="cp">#define DCB_ERR_LS_GS           -5</span>
<span class="cm">/* Link strict traffic class has non zero bandwidth */</span>
<span class="cp">#define DCB_ERR_LS_BW_NONZERO   -6</span>
<span class="cm">/* Link strict bandwidth group has non zero bandwidth */</span>
<span class="cp">#define DCB_ERR_LS_BWG_NONZERO  -7</span>
<span class="cm">/*  Traffic class has zero bandwidth */</span>
<span class="cp">#define DCB_ERR_TC_BW_ZERO      -8</span>

<span class="cp">#define DCB_NOT_IMPLEMENTED      0x7FFFFFFF</span>

<span class="k">struct</span> <span class="n">dcb_pfc_tc_debug</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">tc</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">pause_status</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pause_quanta</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">strict_prio_type</span> <span class="p">{</span>
	<span class="n">prio_none</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">prio_group</span><span class="p">,</span>
	<span class="n">prio_link</span>
<span class="p">};</span>

<span class="cm">/* DCB capability definitions */</span>
<span class="cp">#define IXGBE_DCB_PG_SUPPORT        0x00000001</span>
<span class="cp">#define IXGBE_DCB_PFC_SUPPORT       0x00000002</span>
<span class="cp">#define IXGBE_DCB_BCN_SUPPORT       0x00000004</span>
<span class="cp">#define IXGBE_DCB_UP2TC_SUPPORT     0x00000008</span>
<span class="cp">#define IXGBE_DCB_GSP_SUPPORT       0x00000010</span>

<span class="cp">#define IXGBE_DCB_8_TC_SUPPORT      0x80</span>

<span class="k">struct</span> <span class="n">dcb_support</span> <span class="p">{</span>
	<span class="cm">/* DCB capabilities */</span>
	<span class="n">u32</span> <span class="n">capabilities</span><span class="p">;</span>

	<span class="cm">/* Each bit represents a number of TCs configurable in the hw.</span>
<span class="cm">	 * If 8 traffic classes can be configured, the value is 0x80.</span>
<span class="cm">	 */</span>
	<span class="n">u8</span>  <span class="n">traffic_classes</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">pfc_traffic_classes</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Traffic class bandwidth allocation per direction */</span>
<span class="k">struct</span> <span class="n">tc_bw_alloc</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">bwg_id</span><span class="p">;</span>		  <span class="cm">/* Bandwidth Group (BWG) ID */</span>
	<span class="n">u8</span> <span class="n">bwg_percent</span><span class="p">;</span>		  <span class="cm">/* % of BWG&#39;s bandwidth */</span>
	<span class="n">u8</span> <span class="n">link_percent</span><span class="p">;</span>	  <span class="cm">/* % of link bandwidth */</span>
	<span class="n">u8</span> <span class="n">up_to_tc_bitmap</span><span class="p">;</span>	  <span class="cm">/* User Priority to Traffic Class mapping */</span>
	<span class="n">u16</span> <span class="n">data_credits_refill</span><span class="p">;</span>  <span class="cm">/* Credit refill amount in 64B granularity */</span>
	<span class="n">u16</span> <span class="n">data_credits_max</span><span class="p">;</span>	  <span class="cm">/* Max credits for a configured packet buffer</span>
<span class="cm">				   * in 64B granularity.*/</span>
	<span class="k">enum</span> <span class="n">strict_prio_type</span> <span class="n">prio_type</span><span class="p">;</span> <span class="cm">/* Link or Group Strict Priority */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">dcb_pfc_type</span> <span class="p">{</span>
	<span class="n">pfc_disabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">pfc_enabled_full</span><span class="p">,</span>
	<span class="n">pfc_enabled_tx</span><span class="p">,</span>
	<span class="n">pfc_enabled_rx</span>
<span class="p">};</span>

<span class="cm">/* Traffic class configuration */</span>
<span class="k">struct</span> <span class="n">tc_configuration</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">tc_bw_alloc</span> <span class="n">path</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="cm">/* One each for Tx/Rx */</span>
	<span class="k">enum</span> <span class="n">dcb_pfc_type</span>  <span class="n">dcb_pfc</span><span class="p">;</span> <span class="cm">/* Class based flow control setting */</span>

	<span class="n">u16</span> <span class="n">desc_credits_max</span><span class="p">;</span> <span class="cm">/* For Tx Descriptor arbitration */</span>
	<span class="n">u8</span> <span class="n">tc</span><span class="p">;</span> <span class="cm">/* Traffic class (TC) */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dcb_num_tcs</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">pg_tcs</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pfc_tcs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dcb_support</span> <span class="n">support</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dcb_num_tcs</span> <span class="n">num_tcs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tc_configuration</span> <span class="n">tc_config</span><span class="p">[</span><span class="n">MAX_TRAFFIC_CLASS</span><span class="p">];</span>
	<span class="n">u8</span>     <span class="n">bw_percentage</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">MAX_BW_GROUP</span><span class="p">];</span> <span class="cm">/* One each for Tx/Rx */</span>
	<span class="n">bool</span>   <span class="n">pfc_mode_enable</span><span class="p">;</span>

	<span class="n">u32</span>  <span class="n">dcb_cfg_version</span><span class="p">;</span> <span class="cm">/* Not used...OS-specific? */</span>
	<span class="n">u32</span>  <span class="n">link_speed</span><span class="p">;</span> <span class="cm">/* For bandwidth allocation validation purpose */</span>
<span class="p">};</span>

<span class="cm">/* DCB driver APIs */</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_pfc</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pfc_en</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_refill</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_max</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_bwgid</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_prio</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ixgbe_dcb_unpack_map</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* DCB credits calculation */</span>
<span class="n">s32</span> <span class="n">ixgbe_dcb_calculate_tc_credits</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_hw</span> <span class="o">*</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>

<span class="cm">/* DCB hw initialization */</span>
<span class="n">s32</span> <span class="n">ixgbe_dcb_hw_ets</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee_ets</span> <span class="o">*</span><span class="n">ets</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max</span><span class="p">);</span>
<span class="n">s32</span> <span class="n">ixgbe_dcb_hw_ets_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">refill</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">max</span><span class="p">,</span>
			    <span class="n">u8</span> <span class="o">*</span><span class="n">bwg_id</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">prio_type</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">tc_prio</span><span class="p">);</span>
<span class="n">s32</span> <span class="n">ixgbe_dcb_hw_pfc_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pfc_en</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">tc_prio</span><span class="p">);</span>
<span class="n">s32</span> <span class="n">ixgbe_dcb_hw_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">ixgbe_hw</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ixgbe_dcb_config</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* DCB definitions for credit calculation */</span>
<span class="cp">#define DCB_CREDIT_QUANTUM	64   </span><span class="cm">/* DCB Quantum */</span><span class="cp"></span>
<span class="cp">#define MAX_CREDIT_REFILL       511  </span><span class="cm">/* 0x1FF * 64B = 32704B */</span><span class="cp"></span>
<span class="cp">#define DCB_MAX_TSO_SIZE        (32*1024) </span><span class="cm">/* MAX TSO packet size supported in DCB mode */</span><span class="cp"></span>
<span class="cp">#define MINIMUM_CREDIT_FOR_TSO  (DCB_MAX_TSO_SIZE/64 + 1) </span><span class="cm">/* 513 for 32KB TSO packet */</span><span class="cp"></span>
<span class="cp">#define MAX_CREDIT              4095 </span><span class="cm">/* Maximum credit supported: 256KB * 1204 / 64B */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _DCB_CONFIG_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
