<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › intel › ixgb › ixgb_ethtool.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>ixgb_ethtool.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*******************************************************************************</span>

<span class="cm">  Intel PRO/10GbE Linux driver</span>
<span class="cm">  Copyright(c) 1999 - 2008 Intel Corporation.</span>

<span class="cm">  This program is free software; you can redistribute it and/or modify it</span>
<span class="cm">  under the terms and conditions of the GNU General Public License,</span>
<span class="cm">  version 2, as published by the Free Software Foundation.</span>

<span class="cm">  This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm">  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm">  FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm">  more details.</span>

<span class="cm">  You should have received a copy of the GNU General Public License along with</span>
<span class="cm">  this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm">  51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span class="cm">  The full GNU General Public License is included in this distribution in</span>
<span class="cm">  the file called &quot;COPYING&quot;.</span>

<span class="cm">  Contact Information:</span>
<span class="cm">  Linux NICS &lt;linux.nics@intel.com&gt;</span>
<span class="cm">  e1000-devel Mailing List &lt;e1000-devel@lists.sourceforge.net&gt;</span>
<span class="cm">  Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497</span>

<span class="cm">*******************************************************************************/</span>

<span class="cm">/* ethtool support for ixgb */</span>

<span class="cp">#include &quot;ixgb.h&quot;</span>

<span class="cp">#include &lt;asm/uaccess.h&gt;</span>

<span class="cp">#define IXGB_ALL_RAR_ENTRIES 16</span>

<span class="k">enum</span> <span class="p">{</span><span class="n">NETDEV_STATS</span><span class="p">,</span> <span class="n">IXGB_STATS</span><span class="p">};</span>

<span class="k">struct</span> <span class="n">ixgb_stats</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">stat_string</span><span class="p">[</span><span class="n">ETH_GSTRING_LEN</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sizeof_stat</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">stat_offset</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IXGB_STAT(m)		IXGB_STATS, \</span>
<span class="cp">				FIELD_SIZEOF(struct ixgb_adapter, m), \</span>
<span class="cp">				offsetof(struct ixgb_adapter, m)</span>
<span class="cp">#define IXGB_NETDEV_STAT(m)	NETDEV_STATS, \</span>
<span class="cp">				FIELD_SIZEOF(struct net_device, m), \</span>
<span class="cp">				offsetof(struct net_device, m)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ixgb_stats</span> <span class="n">ixgb_gstrings_stats</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;rx_packets&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_packets</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_packets&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_packets</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_bytes&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_bytes</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_bytes&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_bytes</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_dropped&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_dropped</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_dropped&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_dropped</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;multicast&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">multicast</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;collisions&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">collisions</span><span class="p">)},</span>

<span class="cm">/*	{ &quot;rx_length_errors&quot;, IXGB_NETDEV_STAT(stats.rx_length_errors) },	*/</span>
	<span class="p">{</span><span class="s">&quot;rx_over_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_over_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_crc_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_crc_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_frame_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_frame_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_no_buffer_count&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rnbc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_fifo_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_fifo_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_missed_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">rx_missed_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_aborted_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_aborted_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_carrier_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_carrier_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_fifo_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_fifo_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_heartbeat_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_heartbeat_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_window_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_NETDEV_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tx_window_errors</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_deferred_ok&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">dc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_timeout_count&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">tx_timeout_count</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;tx_restart_queue&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">restart_queue</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;rx_long_length_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">roc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_short_length_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">ruc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_tcp_seg_good&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tsctc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_tcp_seg_failed&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">tsctfc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_flow_control_xon&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">xonrxc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_flow_control_xoff&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">xoffrxc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_flow_control_xon&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">xontxc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_flow_control_xoff&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="n">xofftxc</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_csum_offload_good&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">hw_csum_rx_good</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;rx_csum_offload_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">hw_csum_rx_error</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_csum_offload_good&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">hw_csum_tx_good</span><span class="p">)},</span>
	<span class="p">{</span><span class="s">&quot;tx_csum_offload_errors&quot;</span><span class="p">,</span> <span class="n">IXGB_STAT</span><span class="p">(</span><span class="n">hw_csum_tx_error</span><span class="p">)}</span>
<span class="p">};</span>

<span class="cp">#define IXGB_STATS_LEN	ARRAY_SIZE(ixgb_gstrings_stats)</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_get_settings</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ethtool_cmd</span> <span class="o">*</span><span class="n">ecmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>

	<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">supported</span> <span class="o">=</span> <span class="p">(</span><span class="n">SUPPORTED_10000baseT_Full</span> <span class="o">|</span> <span class="n">SUPPORTED_FIBRE</span><span class="p">);</span>
	<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">advertising</span> <span class="o">=</span> <span class="p">(</span><span class="n">ADVERTISED_10000baseT_Full</span> <span class="o">|</span> <span class="n">ADVERTISED_FIBRE</span><span class="p">);</span>
	<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">=</span> <span class="n">PORT_FIBRE</span><span class="p">;</span>
	<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">transceiver</span> <span class="o">=</span> <span class="n">XCVR_EXTERNAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">netif_carrier_ok</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">netdev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ethtool_cmd_speed_set</span><span class="p">(</span><span class="n">ecmd</span><span class="p">,</span> <span class="n">SPEED_10000</span><span class="p">);</span>
		<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">duplex</span> <span class="o">=</span> <span class="n">DUPLEX_FULL</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ethtool_cmd_speed_set</span><span class="p">(</span><span class="n">ecmd</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">duplex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">AUTONEG_DISABLE</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ixgb_set_speed_duplex</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="cm">/* be optimistic about our link, since we were up before */</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">link_speed</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">link_duplex</span> <span class="o">=</span> <span class="n">FULL_DUPLEX</span><span class="p">;</span>
	<span class="n">netif_carrier_on</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="n">netif_wake_queue</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_set_settings</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ethtool_cmd</span> <span class="o">*</span><span class="n">ecmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">speed</span> <span class="o">=</span> <span class="n">ethtool_cmd_speed</span><span class="p">(</span><span class="n">ecmd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">autoneg</span> <span class="o">==</span> <span class="n">AUTONEG_ENABLE</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">speed</span> <span class="o">+</span> <span class="n">ecmd</span><span class="o">-&gt;</span><span class="n">duplex</span> <span class="o">!=</span> <span class="n">SPEED_10000</span> <span class="o">+</span> <span class="n">DUPLEX_FULL</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">netif_running</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">netdev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ixgb_down</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
		<span class="n">ixgb_reset</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="n">ixgb_up</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="n">ixgb_set_speed_duplex</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">ixgb_reset</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_pauseparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ethtool_pauseparam</span> <span class="o">*</span><span class="n">pause</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>

	<span class="n">pause</span><span class="o">-&gt;</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">AUTONEG_DISABLE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ixgb_fc_rx_pause</span><span class="p">)</span>
		<span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ixgb_fc_tx_pause</span><span class="p">)</span>
		<span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">ixgb_fc_full</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_set_pauseparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ethtool_pauseparam</span> <span class="o">*</span><span class="n">pause</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">autoneg</span> <span class="o">==</span> <span class="n">AUTONEG_ENABLE</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">&amp;&amp;</span> <span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span><span class="p">)</span>
		<span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ixgb_fc_full</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span><span class="p">)</span>
		<span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ixgb_fc_rx_pause</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">&amp;&amp;</span> <span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span><span class="p">)</span>
		<span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ixgb_fc_tx_pause</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">rx_pause</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">pause</span><span class="o">-&gt;</span><span class="n">tx_pause</span><span class="p">)</span>
		<span class="n">hw</span><span class="o">-&gt;</span><span class="n">fc</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ixgb_fc_none</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">netif_running</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">netdev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ixgb_down</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
		<span class="n">ixgb_up</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="n">ixgb_set_speed_duplex</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">ixgb_reset</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span>
<span class="nf">ixgb_get_msglevel</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">msg_enable</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_set_msglevel</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">msg_enable</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#define IXGB_GET_STAT(_A_, _R_) _A_-&gt;stats._R_</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_get_regs_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define IXGB_REG_DUMP_LEN  136*sizeof(u32)</span>
	<span class="k">return</span> <span class="n">IXGB_REG_DUMP_LEN</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">ethtool_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">reg</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">reg_start</span> <span class="o">=</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* the 1 (one) below indicates an attempt at versioning, if the</span>
<span class="cm">	 * interface in ethtool or the driver changes, this 1 should be</span>
<span class="cm">	 * incremented */</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">revision_id</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span> <span class="o">|</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">device_id</span><span class="p">;</span>

	<span class="cm">/* General Registers */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">CTRL0</span><span class="p">);</span>	<span class="cm">/*   0 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">CTRL1</span><span class="p">);</span>	<span class="cm">/*   1 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">STATUS</span><span class="p">);</span>	<span class="cm">/*   2 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">EECD</span><span class="p">);</span>	<span class="cm">/*   3 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">MFS</span><span class="p">);</span>	<span class="cm">/*   4 */</span>

	<span class="cm">/* Interrupt */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">ICR</span><span class="p">);</span>	<span class="cm">/*   5 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">ICS</span><span class="p">);</span>	<span class="cm">/*   6 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">IMS</span><span class="p">);</span>	<span class="cm">/*   7 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">IMC</span><span class="p">);</span>	<span class="cm">/*   8 */</span>

	<span class="cm">/* Receive */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RCTL</span><span class="p">);</span>	<span class="cm">/*   9 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">FCRTL</span><span class="p">);</span>	<span class="cm">/*  10 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">FCRTH</span><span class="p">);</span>	<span class="cm">/*  11 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDBAL</span><span class="p">);</span>	<span class="cm">/*  12 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDBAH</span><span class="p">);</span>	<span class="cm">/*  13 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDLEN</span><span class="p">);</span>	<span class="cm">/*  14 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDH</span><span class="p">);</span>	<span class="cm">/*  15 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDT</span><span class="p">);</span>	<span class="cm">/*  16 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RDTR</span><span class="p">);</span>	<span class="cm">/*  17 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RXDCTL</span><span class="p">);</span>	<span class="cm">/*  18 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RAIDC</span><span class="p">);</span>	<span class="cm">/*  19 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RXCSUM</span><span class="p">);</span>	<span class="cm">/*  20 */</span>

	<span class="cm">/* there are 16 RAR entries in hardware, we only use 3 */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IXGB_ALL_RAR_ENTRIES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG_ARRAY</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RAL</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span> <span class="cm">/*21,...,51 */</span>
		<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG_ARRAY</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">RAH</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span> <span class="cm">/*22,...,52 */</span>
	<span class="p">}</span>

	<span class="cm">/* Transmit */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TCTL</span><span class="p">);</span>	<span class="cm">/*  53 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TDBAL</span><span class="p">);</span>	<span class="cm">/*  54 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TDBAH</span><span class="p">);</span>	<span class="cm">/*  55 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TDLEN</span><span class="p">);</span>	<span class="cm">/*  56 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TDH</span><span class="p">);</span>	<span class="cm">/*  57 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TDT</span><span class="p">);</span>	<span class="cm">/*  58 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TIDV</span><span class="p">);</span>	<span class="cm">/*  59 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TXDCTL</span><span class="p">);</span>	<span class="cm">/*  60 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">TSPMT</span><span class="p">);</span>	<span class="cm">/*  61 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">PAP</span><span class="p">);</span>	<span class="cm">/*  62 */</span>

	<span class="cm">/* Physical */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">PCSC1</span><span class="p">);</span>	<span class="cm">/*  63 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">PCSC2</span><span class="p">);</span>	<span class="cm">/*  64 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">PCSS1</span><span class="p">);</span>	<span class="cm">/*  65 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">PCSS2</span><span class="p">);</span>	<span class="cm">/*  66 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">XPCSS</span><span class="p">);</span>	<span class="cm">/*  67 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">UCCR</span><span class="p">);</span>	<span class="cm">/*  68 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">XPCSTC</span><span class="p">);</span>	<span class="cm">/*  69 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">MACA</span><span class="p">);</span>	<span class="cm">/*  70 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">APAE</span><span class="p">);</span>	<span class="cm">/*  71 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">ARD</span><span class="p">);</span>	<span class="cm">/*  72 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">AIS</span><span class="p">);</span>	<span class="cm">/*  73 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">MSCA</span><span class="p">);</span>	<span class="cm">/*  74 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_READ_REG</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">MSRWD</span><span class="p">);</span>	<span class="cm">/*  75 */</span>

	<span class="cm">/* Statistics */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tprl</span><span class="p">);</span>	<span class="cm">/*  76 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tprh</span><span class="p">);</span>	<span class="cm">/*  77 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gprcl</span><span class="p">);</span>	<span class="cm">/*  78 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gprch</span><span class="p">);</span>	<span class="cm">/*  79 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">bprcl</span><span class="p">);</span>	<span class="cm">/*  80 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">bprch</span><span class="p">);</span>	<span class="cm">/*  81 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mprcl</span><span class="p">);</span>	<span class="cm">/*  82 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mprch</span><span class="p">);</span>	<span class="cm">/*  83 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">uprcl</span><span class="p">);</span>	<span class="cm">/*  84 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">uprch</span><span class="p">);</span>	<span class="cm">/*  85 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">vprcl</span><span class="p">);</span>	<span class="cm">/*  86 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">vprch</span><span class="p">);</span>	<span class="cm">/*  87 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">jprcl</span><span class="p">);</span>	<span class="cm">/*  88 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">jprch</span><span class="p">);</span>	<span class="cm">/*  89 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gorcl</span><span class="p">);</span>	<span class="cm">/*  90 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gorch</span><span class="p">);</span>	<span class="cm">/*  91 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">torl</span><span class="p">);</span>	<span class="cm">/*  92 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">torh</span><span class="p">);</span>	<span class="cm">/*  93 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">rnbc</span><span class="p">);</span>	<span class="cm">/*  94 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">ruc</span><span class="p">);</span>	<span class="cm">/*  95 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">roc</span><span class="p">);</span>	<span class="cm">/*  96 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">rlec</span><span class="p">);</span>	<span class="cm">/*  97 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">crcerrs</span><span class="p">);</span>	<span class="cm">/*  98 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">icbc</span><span class="p">);</span>	<span class="cm">/*  99 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">ecbc</span><span class="p">);</span>	<span class="cm">/* 100 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mpc</span><span class="p">);</span>	<span class="cm">/* 101 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tptl</span><span class="p">);</span>	<span class="cm">/* 102 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tpth</span><span class="p">);</span>	<span class="cm">/* 103 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gptcl</span><span class="p">);</span>	<span class="cm">/* 104 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gptch</span><span class="p">);</span>	<span class="cm">/* 105 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">bptcl</span><span class="p">);</span>	<span class="cm">/* 106 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">bptch</span><span class="p">);</span>	<span class="cm">/* 107 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mptcl</span><span class="p">);</span>	<span class="cm">/* 108 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mptch</span><span class="p">);</span>	<span class="cm">/* 109 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">uptcl</span><span class="p">);</span>	<span class="cm">/* 110 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">uptch</span><span class="p">);</span>	<span class="cm">/* 111 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">vptcl</span><span class="p">);</span>	<span class="cm">/* 112 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">vptch</span><span class="p">);</span>	<span class="cm">/* 113 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">jptcl</span><span class="p">);</span>	<span class="cm">/* 114 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">jptch</span><span class="p">);</span>	<span class="cm">/* 115 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gotcl</span><span class="p">);</span>	<span class="cm">/* 116 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">gotch</span><span class="p">);</span>	<span class="cm">/* 117 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">totl</span><span class="p">);</span>	<span class="cm">/* 118 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">toth</span><span class="p">);</span>	<span class="cm">/* 119 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">dc</span><span class="p">);</span>	<span class="cm">/* 120 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">plt64c</span><span class="p">);</span>	<span class="cm">/* 121 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tsctc</span><span class="p">);</span>	<span class="cm">/* 122 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">tsctfc</span><span class="p">);</span>	<span class="cm">/* 123 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">ibic</span><span class="p">);</span>	<span class="cm">/* 124 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">rfc</span><span class="p">);</span>	<span class="cm">/* 125 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">lfc</span><span class="p">);</span>	<span class="cm">/* 126 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">pfrc</span><span class="p">);</span>	<span class="cm">/* 127 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">pftc</span><span class="p">);</span>	<span class="cm">/* 128 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mcfrc</span><span class="p">);</span>	<span class="cm">/* 129 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">mcftc</span><span class="p">);</span>	<span class="cm">/* 130 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">xonrxc</span><span class="p">);</span>	<span class="cm">/* 131 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">xontxc</span><span class="p">);</span>	<span class="cm">/* 132 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">xoffrxc</span><span class="p">);</span>	<span class="cm">/* 133 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">xofftxc</span><span class="p">);</span>	<span class="cm">/* 134 */</span>
	<span class="o">*</span><span class="n">reg</span><span class="o">++</span> <span class="o">=</span> <span class="n">IXGB_GET_STAT</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">rjc</span><span class="p">);</span>	<span class="cm">/* 135 */</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">-</span> <span class="n">reg_start</span><span class="p">)</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_get_eeprom_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* return size in bytes */</span>
	<span class="k">return</span> <span class="n">IXGB_EEPROM_SIZE</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_get_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">ethtool_eeprom</span> <span class="o">*</span><span class="n">eeprom</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">bytes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="o">*</span><span class="n">eeprom_buff</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">first_word</span><span class="p">,</span> <span class="n">last_word</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret_val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret_val</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">geeprom_error</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">magic</span> <span class="o">=</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">|</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">device_id</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>

	<span class="n">max_len</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom_len</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret_val</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">geeprom_error</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">)</span>
		<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">);</span>

	<span class="n">first_word</span> <span class="o">=</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">last_word</span> <span class="o">=</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">eeprom_buff</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">__le16</span><span class="p">)</span> <span class="o">*</span>
			<span class="p">(</span><span class="n">last_word</span> <span class="o">-</span> <span class="n">first_word</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">eeprom_buff</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/* note the eeprom was good because the driver loaded */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">last_word</span> <span class="o">-</span> <span class="n">first_word</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">eeprom_buff</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom_word</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="p">(</span><span class="n">first_word</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">eeprom_buff</span> <span class="o">+</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">),</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">eeprom_buff</span><span class="p">);</span>

<span class="nl">geeprom_error:</span>
	<span class="k">return</span> <span class="n">ret_val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_set_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">ethtool_eeprom</span> <span class="o">*</span><span class="n">eeprom</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">bytes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">eeprom_buff</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">first_word</span><span class="p">,</span> <span class="n">last_word</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">magic</span> <span class="o">!=</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">|</span> <span class="p">(</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">device_id</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">max_len</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom_len</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&gt;</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_len</span><span class="p">)</span>
		<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_len</span> <span class="o">-</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">);</span>

	<span class="n">first_word</span> <span class="o">=</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">last_word</span> <span class="o">=</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">eeprom_buff</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">eeprom_buff</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">ptr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">eeprom_buff</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* need read/modify/write of first changed EEPROM word */</span>
		<span class="cm">/* only the second byte of the word is being modified */</span>
		<span class="n">eeprom_buff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ixgb_read_eeprom</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">first_word</span><span class="p">);</span>
		<span class="n">ptr</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">+</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* need read/modify/write of last changed EEPROM word */</span>
		<span class="cm">/* only the first byte of the word is being modified */</span>
		<span class="n">eeprom_buff</span><span class="p">[</span><span class="n">last_word</span> <span class="o">-</span> <span class="n">first_word</span><span class="p">]</span>
			<span class="o">=</span> <span class="n">ixgb_read_eeprom</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">last_word</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">bytes</span><span class="p">,</span> <span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">last_word</span> <span class="o">-</span> <span class="n">first_word</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ixgb_write_eeprom</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">first_word</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">eeprom_buff</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="cm">/* Update the checksum over the first part of the EEPROM if needed */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">first_word</span> <span class="o">&lt;=</span> <span class="n">EEPROM_CHECKSUM_REG</span><span class="p">)</span>
		<span class="n">ixgb_update_eeprom_checksum</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">eeprom_buff</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_drvinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">ethtool_drvinfo</span> <span class="o">*</span><span class="n">drvinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>

	<span class="n">strlcpy</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">,</span>  <span class="n">ixgb_driver_name</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">));</span>
	<span class="n">strlcpy</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span> <span class="n">ixgb_driver_version</span><span class="p">,</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">));</span>
	<span class="n">strlcpy</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">bus_info</span><span class="p">,</span> <span class="n">pci_name</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">),</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">bus_info</span><span class="p">));</span>
	<span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">n_stats</span> <span class="o">=</span> <span class="n">IXGB_STATS_LEN</span><span class="p">;</span>
	<span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">regdump_len</span> <span class="o">=</span> <span class="n">ixgb_get_regs_len</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="n">drvinfo</span><span class="o">-&gt;</span><span class="n">eedump_len</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom_len</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_ringparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ethtool_ringparam</span> <span class="o">*</span><span class="n">ring</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_desc_ring</span> <span class="o">*</span><span class="n">txdr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ixgb_desc_ring</span> <span class="o">*</span><span class="n">rxdr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span><span class="p">;</span>

	<span class="n">ring</span><span class="o">-&gt;</span><span class="n">rx_max_pending</span> <span class="o">=</span> <span class="n">MAX_RXD</span><span class="p">;</span>
	<span class="n">ring</span><span class="o">-&gt;</span><span class="n">tx_max_pending</span> <span class="o">=</span> <span class="n">MAX_TXD</span><span class="p">;</span>
	<span class="n">ring</span><span class="o">-&gt;</span><span class="n">rx_pending</span> <span class="o">=</span> <span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
	<span class="n">ring</span><span class="o">-&gt;</span><span class="n">tx_pending</span> <span class="o">=</span> <span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_set_ringparam</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ethtool_ringparam</span> <span class="o">*</span><span class="n">ring</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ixgb_desc_ring</span> <span class="o">*</span><span class="n">txdr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ixgb_desc_ring</span> <span class="o">*</span><span class="n">rxdr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ixgb_desc_ring</span> <span class="n">tx_old</span><span class="p">,</span> <span class="n">tx_new</span><span class="p">,</span> <span class="n">rx_old</span><span class="p">,</span> <span class="n">rx_new</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">tx_old</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">;</span>
	<span class="n">rx_old</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">rx_mini_pending</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">rx_jumbo_pending</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">netif_running</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">netdev</span><span class="p">))</span>
		<span class="n">ixgb_down</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

	<span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">rx_pending</span><span class="p">,(</span><span class="n">u32</span><span class="p">)</span><span class="n">MIN_RXD</span><span class="p">);</span>
	<span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,(</span><span class="n">u32</span><span class="p">)</span><span class="n">MAX_RXD</span><span class="p">);</span>
	<span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">rxdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span> <span class="n">IXGB_REQ_RX_DESCRIPTOR_MULTIPLE</span><span class="p">);</span>

	<span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">tx_pending</span><span class="p">,(</span><span class="n">u32</span><span class="p">)</span><span class="n">MIN_TXD</span><span class="p">);</span>
	<span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,(</span><span class="n">u32</span><span class="p">)</span><span class="n">MAX_TXD</span><span class="p">);</span>
	<span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">ALIGN</span><span class="p">(</span><span class="n">txdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">,</span> <span class="n">IXGB_REQ_TX_DESCRIPTOR_MULTIPLE</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">netif_running</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">netdev</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* Try to get new resources before deleting old */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">ixgb_setup_rx_resources</span><span class="p">(</span><span class="n">adapter</span><span class="p">)))</span>
			<span class="k">goto</span> <span class="n">err_setup_rx</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">ixgb_setup_tx_resources</span><span class="p">(</span><span class="n">adapter</span><span class="p">)))</span>
			<span class="k">goto</span> <span class="n">err_setup_tx</span><span class="p">;</span>

		<span class="cm">/* save the new, restore the old in order to free it,</span>
<span class="cm">		 * then restore the new back again */</span>

		<span class="n">rx_new</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span><span class="p">;</span>
		<span class="n">tx_new</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span> <span class="o">=</span> <span class="n">rx_old</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span> <span class="o">=</span> <span class="n">tx_old</span><span class="p">;</span>
		<span class="n">ixgb_free_rx_resources</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="n">ixgb_free_tx_resources</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span> <span class="o">=</span> <span class="n">rx_new</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span> <span class="o">=</span> <span class="n">tx_new</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">ixgb_up</span><span class="p">(</span><span class="n">adapter</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">ixgb_set_speed_duplex</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">err_setup_tx:</span>
	<span class="n">ixgb_free_rx_resources</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
<span class="nl">err_setup_rx:</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">rx_ring</span> <span class="o">=</span> <span class="n">rx_old</span><span class="p">;</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_ring</span> <span class="o">=</span> <span class="n">tx_old</span><span class="p">;</span>
	<span class="n">ixgb_up</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_set_phys_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ethtool_phys_id_state</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ETHTOOL_ID_ACTIVE</span>:
		<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">ETHTOOL_ID_ON</span>:
		<span class="n">ixgb_led_on</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">ETHTOOL_ID_OFF</span>:
	<span class="k">case</span> <span class="n">ETHTOOL_ID_INACTIVE</span>:
		<span class="n">ixgb_led_off</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ixgb_get_sset_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sset</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ETH_SS_STATS</span>:
		<span class="k">return</span> <span class="n">IXGB_STATS_LEN</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_ethtool_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">ethtool_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ixgb_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">netdev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">ixgb_update_stats</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IXGB_STATS_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">ixgb_gstrings_stats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">NETDEV_STATS</span>:
			<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">netdev</span> <span class="o">+</span>
					<span class="n">ixgb_gstrings_stats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stat_offset</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">IXGB_STATS</span>:
			<span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">adapter</span> <span class="o">+</span>
					<span class="n">ixgb_gstrings_stats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stat_offset</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ixgb_gstrings_stats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sizeof_stat</span> <span class="o">==</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="n">u64</span><span class="p">))</span> <span class="o">?</span> <span class="o">*</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">:</span> <span class="o">*</span><span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ixgb_get_strings</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">stringset</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">stringset</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ETH_SS_STATS</span>:
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IXGB_STATS_LEN</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">ETH_GSTRING_LEN</span><span class="p">,</span>
			<span class="n">ixgb_gstrings_stats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stat_string</span><span class="p">,</span>
			<span class="n">ETH_GSTRING_LEN</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ethtool_ops</span> <span class="n">ixgb_ethtool_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">get_settings</span> <span class="o">=</span> <span class="n">ixgb_get_settings</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_settings</span> <span class="o">=</span> <span class="n">ixgb_set_settings</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_drvinfo</span> <span class="o">=</span> <span class="n">ixgb_get_drvinfo</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_regs_len</span> <span class="o">=</span> <span class="n">ixgb_get_regs_len</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_regs</span> <span class="o">=</span> <span class="n">ixgb_get_regs</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_link</span> <span class="o">=</span> <span class="n">ethtool_op_get_link</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_eeprom_len</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom_len</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_eeprom</span> <span class="o">=</span> <span class="n">ixgb_get_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_eeprom</span> <span class="o">=</span> <span class="n">ixgb_set_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_ringparam</span> <span class="o">=</span> <span class="n">ixgb_get_ringparam</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_ringparam</span> <span class="o">=</span> <span class="n">ixgb_set_ringparam</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_pauseparam</span>	<span class="o">=</span> <span class="n">ixgb_get_pauseparam</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_pauseparam</span>	<span class="o">=</span> <span class="n">ixgb_set_pauseparam</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_msglevel</span> <span class="o">=</span> <span class="n">ixgb_get_msglevel</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_msglevel</span> <span class="o">=</span> <span class="n">ixgb_set_msglevel</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_strings</span> <span class="o">=</span> <span class="n">ixgb_get_strings</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_phys_id</span> <span class="o">=</span> <span class="n">ixgb_set_phys_id</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_sset_count</span> <span class="o">=</span> <span class="n">ixgb_get_sset_count</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_ethtool_stats</span> <span class="o">=</span> <span class="n">ixgb_get_ethtool_stats</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">ixgb_set_ethtool_ops</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">netdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">SET_ETHTOOL_OPS</span><span class="p">(</span><span class="n">netdev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ixgb_ethtool_ops</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
