<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › ethernet › 8390 › pcnet_cs.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>pcnet_cs.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*======================================================================</span>

<span class="cm">    A PCMCIA ethernet driver for NS8390-based cards</span>

<span class="cm">    This driver supports the D-Link DE-650 and Linksys EthernetCard</span>
<span class="cm">    cards, the newer D-Link and Linksys combo cards, Accton EN2212</span>
<span class="cm">    cards, the RPTI EP400, and the PreMax PE-200 in non-shared-memory</span>
<span class="cm">    mode, and the IBM Credit Card Adapter, the NE4100, the Thomas</span>
<span class="cm">    Conrad ethernet card, and the Kingston KNE-PCM/x in shared-memory</span>
<span class="cm">    mode.  It will also handle the Socket EA card in either mode.</span>

<span class="cm">    Copyright (C) 1999 David A. Hinds -- dahinds@users.sourceforge.net</span>

<span class="cm">    pcnet_cs.c 1.153 2003/11/09 18:53:09</span>

<span class="cm">    The network driver code is based on Donald Becker&#39;s NE2000 code:</span>

<span class="cm">    Written 1992,1993 by Donald Becker.</span>
<span class="cm">    Copyright 1993 United States Government as represented by the</span>
<span class="cm">    Director, National Security Agency.  This software may be used and</span>
<span class="cm">    distributed according to the terms of the GNU General Public License,</span>
<span class="cm">    incorporated herein by reference.</span>
<span class="cm">    Donald Becker may be reached at becker@scyld.com</span>

<span class="cm">    Based also on Keith Moore&#39;s changes to Don Becker&#39;s code, for IBM</span>
<span class="cm">    CCAE support.  Drivers merged back together, and shared-memory</span>
<span class="cm">    Socket EA support added, by Ken Raeburn, September 1995.</span>

<span class="cm">======================================================================*/</span>

<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/ptrace.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/log2.h&gt;</span>
<span class="cp">#include &lt;linux/etherdevice.h&gt;</span>
<span class="cp">#include &lt;linux/mii.h&gt;</span>
<span class="cp">#include &quot;8390.h&quot;</span>

<span class="cp">#include &lt;pcmcia/cistpl.h&gt;</span>
<span class="cp">#include &lt;pcmcia/ciscode.h&gt;</span>
<span class="cp">#include &lt;pcmcia/ds.h&gt;</span>
<span class="cp">#include &lt;pcmcia/cisreg.h&gt;</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>

<span class="cp">#define PCNET_CMD	0x00</span>
<span class="cp">#define PCNET_DATAPORT	0x10	</span><span class="cm">/* NatSemi-defined port window offset. */</span><span class="cp"></span>
<span class="cp">#define PCNET_RESET	0x1f	</span><span class="cm">/* Issue a read to reset, a write to clear. */</span><span class="cp"></span>
<span class="cp">#define PCNET_MISC	0x18	</span><span class="cm">/* For IBM CCAE and Socket EA cards */</span><span class="cp"></span>

<span class="cp">#define PCNET_START_PG	0x40	</span><span class="cm">/* First page of TX buffer */</span><span class="cp"></span>
<span class="cp">#define PCNET_STOP_PG	0x80	</span><span class="cm">/* Last page +1 of RX ring */</span><span class="cp"></span>

<span class="cm">/* Socket EA cards have a larger packet buffer */</span>
<span class="cp">#define SOCKET_START_PG	0x01</span>
<span class="cp">#define SOCKET_STOP_PG	0xff</span>

<span class="cp">#define PCNET_RDC_TIMEOUT (2*HZ/100)	</span><span class="cm">/* Max wait in jiffies for Tx RDC */</span><span class="cp"></span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">if_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span> <span class="s">&quot;10baseT&quot;</span><span class="p">,</span> <span class="s">&quot;10base2&quot;</span><span class="p">};</span>


<span class="cm">/*====================================================================*/</span>

<span class="cm">/* Module parameters */</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;David Hinds &lt;dahinds@users.sourceforge.net&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;NE2000 compatible PCMCIA ethernet driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="cp">#define INT_MODULE_PARM(n, v) static int n = v; module_param(n, int, 0)</span>

<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">if_port</span><span class="p">,</span>	<span class="mi">1</span><span class="p">);</span>	<span class="cm">/* Transceiver type */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">use_big_buf</span><span class="p">,</span>	<span class="mi">1</span><span class="p">);</span>	<span class="cm">/* use 64K packet buffer? */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">mem_speed</span><span class="p">,</span>	<span class="mi">0</span><span class="p">);</span>	<span class="cm">/* shared mem speed, in ns */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">delay_output</span><span class="p">,</span>	<span class="mi">0</span><span class="p">);</span>	<span class="cm">/* pause after xmit? */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">delay_time</span><span class="p">,</span>	<span class="mi">4</span><span class="p">);</span>	<span class="cm">/* in usec */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">use_shmem</span><span class="p">,</span>	<span class="o">-</span><span class="mi">1</span><span class="p">);</span>	<span class="cm">/* use shared memory? */</span>
<span class="n">INT_MODULE_PARM</span><span class="p">(</span><span class="n">full_duplex</span><span class="p">,</span>	<span class="mi">0</span><span class="p">);</span>	<span class="cm">/* full duplex? */</span>

<span class="cm">/* Ugh!  Let the user hardwire the hardware address for queer cards */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">hw_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* ... */</span> <span class="p">};</span>
<span class="n">module_param_array</span><span class="p">(</span><span class="n">hw_addr</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">mii_phy_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">pcnet_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">pcnet_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">pcnet_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">pcnet_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">ei_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ifreq</span> <span class="o">*</span><span class="n">rq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">);</span>
<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="n">ei_irq_wrapper</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">ei_watchdog</span><span class="p">(</span><span class="n">u_long</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">pcnet_reset_8390</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">set_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ifmap</span> <span class="o">*</span><span class="n">map</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">setup_shmem_window</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start_pg</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">stop_pg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cm_offset</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">setup_dma_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start_pg</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">stop_pg</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">pcnet_detach</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">p_dev</span><span class="p">);</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">hw_info_t</span> <span class="p">{</span>
    <span class="n">u_int</span>	<span class="n">offset</span><span class="p">;</span>
    <span class="n">u_char</span>	<span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">;</span>
    <span class="n">u_int</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">hw_info_t</span><span class="p">;</span>

<span class="cp">#define DELAY_OUTPUT	0x01</span>
<span class="cp">#define HAS_MISC_REG	0x02</span>
<span class="cp">#define USE_BIG_BUF	0x04</span>
<span class="cp">#define HAS_IBM_MISC	0x08</span>
<span class="cp">#define IS_DL10019	0x10</span>
<span class="cp">#define IS_DL10022	0x20</span>
<span class="cp">#define HAS_MII		0x40</span>
<span class="cp">#define USE_SHMEM	0x80	</span><span class="cm">/* autodetected */</span><span class="cp"></span>

<span class="cp">#define AM79C9XX_HOME_PHY	0x00006B90  </span><span class="cm">/* HomePNA PHY */</span><span class="cp"></span>
<span class="cp">#define AM79C9XX_ETH_PHY	0x00006B70  </span><span class="cm">/* 10baseT PHY */</span><span class="cp"></span>
<span class="cp">#define MII_PHYID_REV_MASK	0xfffffff0</span>
<span class="cp">#define MII_PHYID_REG1		0x02</span>
<span class="cp">#define MII_PHYID_REG2		0x03</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="n">hw_info</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="cm">/* Accton EN2212 */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="n">DELAY_OUTPUT</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Allied Telesis LA-PCM */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* APEX MultiCard */</span> <span class="mh">0x03f4</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* ASANTE FriendlyNet */</span> <span class="mh">0x4910</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span>
      <span class="n">DELAY_OUTPUT</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Danpex EN-6200P2 */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* DataTrek NetCard */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Dayna CommuniCard E */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* D-Link DE-650 */</span> <span class="mh">0x0040</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* EP-210 Ethernet */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* EP4000 Ethernet */</span> <span class="mh">0x01c0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Epson EEN10B */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* ELECOM Laneed LD-CDWA */</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Hypertec Ethernet */</span> <span class="mh">0x01c0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* IBM CCAE */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* IBM CCAE */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* IBM CCAE */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* IBM FME */</span> <span class="mh">0x0374</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* IBM FME */</span> <span class="mh">0x0374</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Kansai KLA-PCM/T */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NSC DP83903 */</span> <span class="mh">0x0374</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NSC DP83903 */</span> <span class="mh">0x0374</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NSC DP83903 */</span> <span class="mh">0x0374</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NSC DP83903 */</span> <span class="mh">0x0198</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* I-O DATA PCLA/T */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Katron PE-520 */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Kingston KNE-PCM/x */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Kingston KNE-PCM/x */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Kingston KNE-PC2 */</span> <span class="mh">0x0180</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Maxtech PCN2000 */</span> <span class="mh">0x5000</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe8</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NDC Instant-Link */</span> <span class="mh">0x003a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NE2000 Compatible */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Network General Sniffer */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Panasonic VEL211 */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span>
      <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">HAS_IBM_MISC</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* PreMax PE-200 */</span> <span class="mh">0x07f0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* RPTI EP400 */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* SCM Ethernet */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Socket EA */</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span>
      <span class="n">DELAY_OUTPUT</span> <span class="o">|</span> <span class="n">HAS_MISC_REG</span> <span class="o">|</span> <span class="n">USE_BIG_BUF</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Socket LP-E CF+ */</span> <span class="mh">0x01c0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* SuperSocket RE450T */</span> <span class="mh">0x0110</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* Volktek NPL-402CT */</span> <span class="mh">0x0060</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* NEC PC-9801N-J12 */</span> <span class="mh">0x0ff0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
    <span class="p">{</span> <span class="cm">/* PCMCIA Technology OEM */</span> <span class="mh">0x01c8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define NR_INFO		ARRAY_SIZE(hw_info)</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="n">default_info</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
<span class="k">static</span> <span class="n">hw_info_t</span> <span class="n">dl10019_info</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IS_DL10019</span><span class="o">|</span><span class="n">HAS_MII</span> <span class="p">};</span>
<span class="k">static</span> <span class="n">hw_info_t</span> <span class="n">dl10022_info</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">IS_DL10022</span><span class="o">|</span><span class="n">HAS_MII</span> <span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pcnet_dev_t</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pcmcia_device</span>	<span class="o">*</span><span class="n">p_dev</span><span class="p">;</span>
    <span class="n">u_int</span>		<span class="n">flags</span><span class="p">;</span>
    <span class="kt">void</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">watchdog</span><span class="p">;</span>
    <span class="kt">int</span>			<span class="n">stale</span><span class="p">,</span> <span class="n">fast_poll</span><span class="p">;</span>
    <span class="n">u_char</span>		<span class="n">phy_id</span><span class="p">;</span>
    <span class="n">u_char</span>		<span class="n">eth_phy</span><span class="p">,</span> <span class="n">pna_phy</span><span class="p">;</span>
    <span class="n">u_short</span>		<span class="n">link_status</span><span class="p">;</span>
    <span class="n">u_long</span>		<span class="n">mii_reset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pcnet_dev_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="nf">PRIV</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">netdev_priv</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="p">)(</span><span class="n">p</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ei_device</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">net_device_ops</span> <span class="n">pcnet_netdev_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ndo_open</span>		<span class="o">=</span> <span class="n">pcnet_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_stop</span>		<span class="o">=</span> <span class="n">pcnet_close</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_set_config</span>		<span class="o">=</span> <span class="n">set_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_start_xmit</span> 	<span class="o">=</span> <span class="n">ei_start_xmit</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_get_stats</span>		<span class="o">=</span> <span class="n">ei_get_stats</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_do_ioctl</span> 		<span class="o">=</span> <span class="n">ei_ioctl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_set_rx_mode</span>	<span class="o">=</span> <span class="n">ei_set_multicast_list</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_tx_timeout</span> 	<span class="o">=</span> <span class="n">ei_tx_timeout</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_change_mtu</span>		<span class="o">=</span> <span class="n">eth_change_mtu</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_set_mac_address</span> 	<span class="o">=</span> <span class="n">eth_mac_addr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ndo_validate_addr</span>	<span class="o">=</span> <span class="n">eth_validate_addr</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_NET_POLL_CONTROLLER</span>
	<span class="p">.</span><span class="n">ndo_poll_controller</span> 	<span class="o">=</span> <span class="n">ei_poll</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

    <span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_attach()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="cm">/* Create new ethernet device */</span>
    <span class="n">dev</span> <span class="o">=</span> <span class="n">__alloc_ei_netdev</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">pcnet_dev_t</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">p_dev</span> <span class="o">=</span> <span class="n">link</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="p">;</span>

    <span class="n">link</span><span class="o">-&gt;</span><span class="n">config_flags</span> <span class="o">|=</span> <span class="n">CONF_ENABLE_IRQ</span> <span class="o">|</span> <span class="n">CONF_AUTO_SET_IO</span><span class="p">;</span>

    <span class="n">dev</span><span class="o">-&gt;</span><span class="n">netdev_ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pcnet_netdev_ops</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">pcnet_config</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="p">}</span> <span class="cm">/* pcnet_attach */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pcnet_detach</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_detach</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">unregister_netdev</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">pcnet_release</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>

	<span class="n">free_netdev</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span> <span class="cm">/* pcnet_detach */</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    This probes for a card&#39;s hardware address, for card types that</span>
<span class="cm">    encode this information in their CIS.</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">get_hwinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="n">u_char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span><span class="p">,</span> <span class="o">*</span><span class="n">virt</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

    <span class="cm">/* Allocate a small memory window */</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">WIN_DATA_WIDTH_8</span><span class="o">|</span><span class="n">WIN_MEMORY_TYPE_AM</span><span class="o">|</span><span class="n">WIN_ENABLE</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">pcmcia_request_window</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">virt</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span>
	    <span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_INFO</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">pcmcia_map_mem_page</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
		<span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
	<span class="n">base</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">virt</span><span class="p">[</span><span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">offset</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">)];</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">readb</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">readb</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">readb</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
		    <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">readb</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

    <span class="n">iounmap</span><span class="p">(</span><span class="n">virt</span><span class="p">);</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">pcmcia_release_window</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_INFO</span><span class="p">)</span> <span class="o">?</span> <span class="n">hw_info</span><span class="o">+</span><span class="n">i</span> <span class="o">:</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* get_hwinfo */</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    This probes for a card&#39;s hardware address by reading the PROM.</span>
<span class="cm">    It checks the address against a list of known types, then falls</span>
<span class="cm">    back to a simple NE2000 clone signature check.</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">get_prom</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ioaddr</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="n">u_char</span> <span class="n">prom</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

    <span class="cm">/* This is lifted straight from drivers/net/ethernet/8390/ne.c */</span>
    <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">value</span><span class="p">,</span> <span class="n">offset</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">program_seq</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">E8390_NODMA</span><span class="o">+</span><span class="n">E8390_PAGE0</span><span class="o">+</span><span class="n">E8390_STOP</span><span class="p">,</span> <span class="n">E8390_CMD</span><span class="p">},</span> <span class="cm">/* Select page 0*/</span>
	<span class="p">{</span><span class="mh">0x48</span><span class="p">,</span>	<span class="n">EN0_DCFG</span><span class="p">},</span>	<span class="cm">/* Set byte-wide (0x48) access. */</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_RCNTLO</span><span class="p">},</span>	<span class="cm">/* Clear the count regs. */</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_RCNTHI</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_IMR</span><span class="p">},</span>	<span class="cm">/* Mask completion irq. */</span>
	<span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span>	<span class="n">EN0_ISR</span><span class="p">},</span>
	<span class="p">{</span><span class="n">E8390_RXOFF</span><span class="p">,</span> <span class="n">EN0_RXCR</span><span class="p">},</span>	<span class="cm">/* 0x20  Set to monitor */</span>
	<span class="p">{</span><span class="n">E8390_TXOFF</span><span class="p">,</span> <span class="n">EN0_TXCR</span><span class="p">},</span>	<span class="cm">/* 0x02  and loopback mode. */</span>
	<span class="p">{</span><span class="mi">32</span><span class="p">,</span>	<span class="n">EN0_RCNTLO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_RCNTHI</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_RSARLO</span><span class="p">},</span>	<span class="cm">/* DMA starting at 0x0000. */</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span>	<span class="n">EN0_RSARHI</span><span class="p">},</span>
	<span class="p">{</span><span class="n">E8390_RREAD</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">E8390_CMD</span><span class="p">},</span>
    <span class="p">};</span>

    <span class="n">pcnet_reset_8390</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">program_seq</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">program_seq</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">,</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">program_seq</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">offset</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">prom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">ioaddr</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_INFO</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">prom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">prom</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a1</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">prom</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">hw_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a2</span><span class="p">))</span>
	    <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_INFO</span><span class="p">)</span> <span class="o">||</span> <span class="p">((</span><span class="n">prom</span><span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x57</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">prom</span><span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x57</span><span class="p">)))</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
	    <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">prom</span><span class="p">[</span><span class="n">j</span><span class="o">&lt;&lt;</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_INFO</span><span class="p">)</span> <span class="o">?</span> <span class="n">hw_info</span><span class="o">+</span><span class="n">i</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">default_info</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* get_prom */</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    For DL10019 based cards, like the Linksys EtherFast</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">get_dl10019</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">u_char</span> <span class="n">sum</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x1c</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">sum</span> <span class="o">+=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sum</span> <span class="o">!=</span> <span class="mh">0xff</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x14</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x1f</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">i</span> <span class="o">==</span> <span class="mh">0x91</span><span class="p">)</span><span class="o">||</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mh">0x99</span><span class="p">))</span> <span class="o">?</span> <span class="o">&amp;</span><span class="n">dl10022_info</span> <span class="o">:</span> <span class="o">&amp;</span><span class="n">dl10019_info</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    For Asix AX88190 based cards</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">get_ax88190</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ioaddr</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

    <span class="cm">/* Not much of a test, but the alternatives are messy */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">config_base</span> <span class="o">!=</span> <span class="mh">0x03c0</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">EN0_DCFG</span><span class="p">);</span>	<span class="cm">/* Set word-wide access. */</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>	<span class="cm">/* DMA starting at 0x0400. */</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_RREAD</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">E8390_CMD</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">j</span> <span class="o">=</span> <span class="n">inw</span><span class="p">(</span><span class="n">ioaddr</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">);</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    This should be totally unnecessary... but when we can&#39;t figure</span>
<span class="cm">    out the hardware address any other way, we&#39;ll let the user hard</span>
<span class="cm">    wire it when the module is initialized.</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">get_hwired</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hw_addr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hw_addr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

    <span class="k">return</span> <span class="o">&amp;</span><span class="n">default_info</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* get_hwired */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">try_io_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">j</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">IO_DATA_PATH_WIDTH</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">IO_DATA_PATH_WIDTH</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">==</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">IO_DATA_PATH_WIDTH_AUTO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="cm">/* for master/slave multifunction cards */</span>
	    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">IO_DATA_PATH_WIDTH_8</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="cm">/* This should be two 16-port windows */</span>
	<span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">IO_DATA_PATH_WIDTH_8</span><span class="p">;</span>
	<span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">IO_DATA_PATH_WIDTH_16</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mh">0x400</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="mh">0x20</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">j</span> <span class="o">^</span> <span class="mh">0x300</span><span class="p">;</span>
	    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">^</span> <span class="mh">0x300</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">;</span>
	    <span class="n">link</span><span class="o">-&gt;</span><span class="n">io_lines</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	    <span class="n">ret</span> <span class="o">=</span> <span class="n">pcmcia_request_io</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">return</span> <span class="n">pcmcia_request_io</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_confcheck</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">p_dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">priv_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">try</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">priv</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="o">*</span><span class="n">priv</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">p_dev</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="mh">0x4000</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x10</span> <span class="o">:</span> <span class="o">~</span><span class="mh">0x10</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p_dev</span><span class="o">-&gt;</span><span class="n">config_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p_dev</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">+</span> <span class="n">p_dev</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">try</span><span class="p">)</span>
		<span class="n">p_dev</span><span class="o">-&gt;</span><span class="n">io_lines</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">try_io_port</span><span class="p">(</span><span class="n">p_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">hw_info_t</span> <span class="o">*</span><span class="nf">pcnet_try_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">,</span>
				   <span class="kt">int</span> <span class="o">*</span><span class="n">has_shmem</span><span class="p">,</span> <span class="kt">int</span> <span class="n">try</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">hw_info_t</span> <span class="o">*</span><span class="n">local_hw_info</span><span class="p">;</span>
	<span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">priv</span> <span class="o">=</span> <span class="n">try</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">pcmcia_loop_config</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">pcnet_confcheck</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_warn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;no useable port range found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">has_shmem</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span>
		<span class="n">link</span><span class="o">-&gt;</span><span class="n">config_flags</span> <span class="o">|=</span> <span class="n">CONF_ENABLE_SPKR</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">manf_id</span> <span class="o">==</span> <span class="n">MANFID_IBM</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">card_id</span> <span class="o">==</span> <span class="n">PRODID_IBM_HOME_AND_AWAY</span><span class="p">))</span>
		<span class="n">link</span><span class="o">-&gt;</span><span class="n">config_index</span> <span class="o">|=</span> <span class="mh">0x10</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">pcmcia_enable_device</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MISC_REG</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">if_port</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">if_port</span> <span class="o">==</span> <span class="mi">2</span><span class="p">))</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span> <span class="o">=</span> <span class="n">if_port</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">dev_notice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;invalid if_port requested</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">config_base</span> <span class="o">==</span> <span class="mh">0x03c0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">manf_id</span> <span class="o">==</span> <span class="mh">0x149</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">card_id</span> <span class="o">==</span> <span class="mh">0xc1ab</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;this is an AX88190 card - use axnet_cs instead.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">get_hwinfo</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">local_hw_info</span><span class="p">)</span>
		<span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">get_prom</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">local_hw_info</span><span class="p">)</span>
		<span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">get_dl10019</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">local_hw_info</span><span class="p">)</span>
		<span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">get_ax88190</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">local_hw_info</span><span class="p">)</span>
		<span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">get_hwired</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">local_hw_info</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">start_pg</span><span class="p">,</span> <span class="n">stop_pg</span><span class="p">,</span> <span class="n">cm_offset</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">has_shmem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">hw_info_t</span> <span class="o">*</span><span class="n">local_hw_info</span><span class="p">;</span>

    <span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_config</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">pcnet_try_config</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">has_shmem</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">local_hw_info</span><span class="p">)</span> <span class="p">{</span>
	    <span class="cm">/* check whether forcing io_lines to 16 helps... */</span>
	    <span class="n">pcmcia_disable_device</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
	    <span class="n">local_hw_info</span> <span class="o">=</span> <span class="n">pcnet_try_config</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">has_shmem</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">local_hw_info</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		    <span class="n">dev_notice</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;unable to read hardware net&quot;</span>
			    <span class="s">&quot; address for io base %#3lx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">);</span>
		    <span class="k">goto</span> <span class="n">failed</span><span class="p">;</span>
	    <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">local_hw_info</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">;</span>
    <span class="cm">/* Check for user overrides */</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="p">(</span><span class="n">delay_output</span><span class="p">)</span> <span class="o">?</span> <span class="n">DELAY_OUTPUT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">manf_id</span> <span class="o">==</span> <span class="n">MANFID_SOCKET</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	<span class="p">((</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">card_id</span> <span class="o">==</span> <span class="n">PRODID_SOCKET_LPE</span><span class="p">)</span> <span class="o">||</span>
	 <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">card_id</span> <span class="o">==</span> <span class="n">PRODID_SOCKET_LPE_CF</span><span class="p">)</span> <span class="o">||</span>
	 <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">card_id</span> <span class="o">==</span> <span class="n">PRODID_SOCKET_EIO</span><span class="p">)))</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">USE_BIG_BUF</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">use_big_buf</span><span class="p">)</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">USE_BIG_BUF</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">USE_BIG_BUF</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">start_pg</span> <span class="o">=</span> <span class="n">SOCKET_START_PG</span><span class="p">;</span>
	<span class="n">stop_pg</span> <span class="o">=</span> <span class="n">SOCKET_STOP_PG</span><span class="p">;</span>
	<span class="n">cm_offset</span> <span class="o">=</span> <span class="mh">0x10000</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">start_pg</span> <span class="o">=</span> <span class="n">PCNET_START_PG</span><span class="p">;</span>
	<span class="n">stop_pg</span> <span class="o">=</span> <span class="n">PCNET_STOP_PG</span><span class="p">;</span>
	<span class="n">cm_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/* has_shmem is ignored if use_shmem != -1 */</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">use_shmem</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">has_shmem</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">use_shmem</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">||</span>
	<span class="p">(</span><span class="n">setup_shmem_window</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">start_pg</span><span class="p">,</span> <span class="n">stop_pg</span><span class="p">,</span> <span class="n">cm_offset</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
	<span class="n">setup_dma_config</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">start_pg</span><span class="p">,</span> <span class="n">stop_pg</span><span class="p">);</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;NE2000&quot;</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">word16</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">reset_8390</span> <span class="o">=</span> <span class="n">pcnet_reset_8390</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">IS_DL10019</span><span class="o">|</span><span class="n">IS_DL10022</span><span class="p">))</span>
	<span class="n">mii_phy_probe</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

    <span class="n">SET_NETDEV_DEV</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">register_netdev</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">pr_notice</span><span class="p">(</span><span class="s">&quot;register_netdev() failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">goto</span> <span class="n">failed</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">IS_DL10019</span><span class="o">|</span><span class="n">IS_DL10022</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">id</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="mh">0x1a</span><span class="p">);</span>
	<span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;NE2000 (DL100%d rev %02x): &quot;</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IS_DL10022</span><span class="p">)</span> <span class="o">?</span> <span class="mi">22</span> <span class="o">:</span> <span class="mi">19</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span><span class="p">)</span>
	    <span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot;PNA, &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;NE2000 Compatible: &quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot;io %#3lx, irq %d,&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">USE_SHMEM</span><span class="p">)</span>
	<span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot; mem %#5lx,&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mem_start</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MISC_REG</span><span class="p">)</span>
	<span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot; %s xcvr,&quot;</span><span class="p">,</span> <span class="n">if_names</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span><span class="p">]);</span>
    <span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot; hw_addr %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_addr</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">failed:</span>
    <span class="n">pcnet_release</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* pcnet_config */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pcnet_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_release</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">USE_SHMEM</span><span class="p">)</span>
		<span class="n">iounmap</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>

	<span class="n">pcmcia_disable_device</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">open</span><span class="p">)</span>
		<span class="n">netif_device_detach</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">open</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pcnet_reset_8390</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="n">NS8390_init</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">netif_device_attach</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*======================================================================</span>

<span class="cm">    MII interface support for DL10019 and DL10022 based cards</span>

<span class="cm">    On the DL10019, the MII IO direction bit is 0x10; on the DL10022</span>
<span class="cm">    it is 0x20.  Setting both bits seems to work on both card types.</span>

<span class="cm">======================================================================*/</span>

<span class="cp">#define DLINK_GPIO		0x1c</span>
<span class="cp">#define DLINK_DIAG		0x1d</span>
<span class="cp">#define DLINK_EEPROM		0x1e</span>

<span class="cp">#define MDIO_SHIFT_CLK		0x80</span>
<span class="cp">#define MDIO_DATA_OUT		0x40</span>
<span class="cp">#define MDIO_DIR_WRITE		0x30</span>
<span class="cp">#define MDIO_DATA_WRITE0	(MDIO_DIR_WRITE)</span>
<span class="cp">#define MDIO_DATA_WRITE1	(MDIO_DIR_WRITE | MDIO_DATA_OUT)</span>
<span class="cp">#define MDIO_DATA_READ		0x10</span>
<span class="cp">#define MDIO_MASK		0x0f</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mdio_sync</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">bits</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MDIO_MASK</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">bits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">bits</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">bits</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">MDIO_DATA_WRITE1</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">MDIO_DATA_WRITE1</span> <span class="o">|</span> <span class="n">MDIO_SHIFT_CLK</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mdio_read</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">phy_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u_int</span> <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x06</span><span class="o">&lt;&lt;</span><span class="mi">10</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">phy_id</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="n">loc</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MDIO_MASK</span><span class="p">;</span>

    <span class="n">mdio_sync</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">dat</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="n">MDIO_DATA_WRITE1</span> <span class="o">:</span> <span class="n">MDIO_DATA_WRITE0</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">dat</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">dat</span> <span class="o">|</span> <span class="n">MDIO_SHIFT_CLK</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">19</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">retval</span> <span class="o">=</span> <span class="p">(</span><span class="n">retval</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">inb</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MDIO_DATA_READ</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">MDIO_SHIFT_CLK</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">retval</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mdio_write</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">phy_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">loc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u_int</span> <span class="n">cmd</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x05</span><span class="o">&lt;&lt;</span><span class="mi">28</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">phy_id</span><span class="o">&lt;&lt;</span><span class="mi">23</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">loc</span><span class="o">&lt;&lt;</span><span class="mi">18</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">17</span><span class="p">)</span><span class="o">|</span><span class="n">value</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">MDIO_MASK</span><span class="p">;</span>

    <span class="n">mdio_sync</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">dat</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="n">MDIO_DATA_WRITE1</span> <span class="o">:</span> <span class="n">MDIO_DATA_WRITE0</span><span class="p">;</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">dat</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">dat</span> <span class="o">|</span> <span class="n">MDIO_SHIFT_CLK</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">mask</span> <span class="o">|</span> <span class="n">MDIO_SHIFT_CLK</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    EEPROM access routines for DL10019 and DL10022 based cards</span>

<span class="cm">======================================================================*/</span>

<span class="cp">#define EE_EEP		0x40</span>
<span class="cp">#define EE_ASIC		0x10</span>
<span class="cp">#define EE_CS		0x08</span>
<span class="cp">#define EE_CK		0x04</span>
<span class="cp">#define EE_DO		0x02</span>
<span class="cp">#define EE_DI		0x01</span>
<span class="cp">#define EE_ADOT		0x01	</span><span class="cm">/* DataOut for ASIC */</span><span class="cp"></span>
<span class="cp">#define EE_READ_CMD	0x06</span>

<span class="cp">#define DL19FDUPLX	0x0400	</span><span class="cm">/* DL10019 Full duplex mode */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">read_eeprom</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ioaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">location</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ee_addr</span> <span class="o">=</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">DLINK_EEPROM</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">read_cmd</span> <span class="o">=</span> <span class="n">location</span> <span class="o">|</span> <span class="p">(</span><span class="n">EE_READ_CMD</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

    <span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
    <span class="n">outb</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>

    <span class="cm">/* Shift the read command bits out. */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">short</span> <span class="n">dataval</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_cmd</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="n">EE_DO</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">dataval</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">dataval</span><span class="o">|</span><span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">outb</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span> <span class="o">|</span> <span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">retval</span> <span class="o">=</span> <span class="p">(</span><span class="n">retval</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">inb</span><span class="p">(</span><span class="n">ee_addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">EE_DI</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_EEP</span><span class="o">|</span><span class="n">EE_CS</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cm">/* Terminate the EEPROM access. */</span>
    <span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">    The internal ASIC registers can be changed by EEPROM READ access</span>
<span class="cm">    with EE_ASIC bit set.</span>
<span class="cm">    In ASIC mode, EE_ADOT is used to output the data to the ASIC.</span>
<span class="cm">*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">write_asic</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ioaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">location</span><span class="p">,</span> <span class="kt">short</span> <span class="n">asic_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ee_addr</span> <span class="o">=</span> <span class="n">ioaddr</span> <span class="o">+</span> <span class="n">DLINK_EEPROM</span><span class="p">;</span>
	<span class="kt">short</span> <span class="n">dataval</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">read_cmd</span> <span class="o">=</span> <span class="n">location</span> <span class="o">|</span> <span class="p">(</span><span class="n">EE_READ_CMD</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">asic_data</span> <span class="o">|=</span> <span class="n">read_eeprom</span><span class="p">(</span><span class="n">ioaddr</span><span class="p">,</span> <span class="n">location</span><span class="p">);</span>

	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">EE_DI</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>

	<span class="n">read_cmd</span> <span class="o">=</span> <span class="n">read_cmd</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Shift the read command bits out. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dataval</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_cmd</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="n">EE_DO</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">EE_DI</span><span class="o">|</span><span class="n">dataval</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">EE_DI</span><span class="o">|</span><span class="n">dataval</span><span class="o">|</span><span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">EE_DI</span><span class="o">|</span><span class="n">dataval</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="p">}</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>sync</p></td><td class="code"><div class="highlight"><pre>	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dataval</span> <span class="o">=</span> <span class="p">(</span><span class="n">asic_data</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="n">EE_ADOT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">dataval</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">dataval</span><span class="o">|</span><span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
		<span class="n">outb_p</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_CS</span><span class="o">|</span><span class="n">dataval</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Terminate the ASIC access. */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_DI</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_DI</span><span class="o">|</span> <span class="n">EE_CK</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">EE_ASIC</span><span class="o">|</span><span class="n">EE_DI</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>

	<span class="n">outb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ee_addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_misc_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">u_char</span> <span class="n">tmp</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MISC_REG</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_MISC</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">3</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
	    <span class="n">tmp</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">USE_BIG_BUF</span><span class="p">)</span>
	    <span class="n">tmp</span> <span class="o">|=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_IBM_MISC</span><span class="p">)</span>
	    <span class="n">tmp</span> <span class="o">|=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">outb_p</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_MISC</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IS_DL10022</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MII</span><span class="p">)</span> <span class="p">{</span>
	    <span class="cm">/* Advertise 100F, 100H, 10F, 10H */</span>
	    <span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01e1</span><span class="p">);</span>
	    <span class="cm">/* Restart MII autonegotiation */</span>
	    <span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	    <span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x1200</span><span class="p">);</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">mii_reset</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">outb</span><span class="p">(</span><span class="n">full_duplex</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_DIAG</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IS_DL10019</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* Advertise 100F, 100H, 10F, 10H */</span>
	<span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x01e1</span><span class="p">);</span>
	<span class="cm">/* Restart MII autonegotiation */</span>
	<span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	<span class="n">mdio_write</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x1200</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mii_phy_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mii_addr</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">u_int</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">phyid</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">tmp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">==</span> <span class="mh">0xffff</span><span class="p">))</span>
	    <span class="k">continue</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">MII_PHYID_REG1</span><span class="p">);</span>
	<span class="n">phyid</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">phyid</span> <span class="o">|=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">MII_PHYID_REG2</span><span class="p">);</span>
	<span class="n">phyid</span> <span class="o">&amp;=</span> <span class="n">MII_PHYID_REV_MASK</span><span class="p">;</span>
	<span class="n">netdev_dbg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;MII at %d is 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">phyid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">phyid</span> <span class="o">==</span> <span class="n">AM79C9XX_HOME_PHY</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">phyid</span> <span class="o">!=</span> <span class="n">AM79C9XX_ETH_PHY</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">p_dev</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>

    <span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_open(&#39;%s&#39;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pcmcia_dev_present</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

    <span class="n">set_misc_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="mh">0xFF</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span> <span class="cm">/* Clear bogus intr. */</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">request_irq</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">ei_irq_wrapper</span><span class="p">,</span> <span class="n">IRQF_SHARED</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
	    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

    <span class="n">link</span><span class="o">-&gt;</span><span class="n">open</span><span class="o">++</span><span class="p">;</span>

    <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">;</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">link_status</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
    <span class="n">init_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">);</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">ei_watchdog</span><span class="p">;</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_long</span><span class="p">)</span><span class="n">dev</span><span class="p">;</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">HZ</span><span class="p">;</span>
    <span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">ei_open</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span> <span class="cm">/* pcnet_open */</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pcnet_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">p_dev</span><span class="p">;</span>

    <span class="n">dev_dbg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_close(&#39;%s&#39;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

    <span class="n">ei_close</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">free_irq</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

    <span class="n">link</span><span class="o">-&gt;</span><span class="n">open</span><span class="o">--</span><span class="p">;</span>
    <span class="n">netif_stop_queue</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* pcnet_close */</span>

<span class="cm">/*======================================================================</span>

<span class="cm">    Hard reset the card.  This used to pause for the same period that</span>
<span class="cm">    a 8390 reset command required, but that shouldn&#39;t be necessary.</span>

<span class="cm">======================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pcnet_reset_8390</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">txing</span> <span class="o">=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_NODMA</span><span class="o">+</span><span class="n">E8390_PAGE0</span><span class="o">+</span><span class="n">E8390_STOP</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">E8390_CMD</span><span class="p">);</span>

    <span class="n">outb</span><span class="p">(</span><span class="n">inb</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_RESET</span><span class="p">),</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_RESET</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span><span class="o">+</span><span class="n">EN0_ISR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ENISR_RESET</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
	    <span class="k">break</span><span class="p">;</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">ENISR_RESET</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span> <span class="cm">/* Ack intr. */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">100</span><span class="p">)</span>
	<span class="n">netdev_err</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pcnet_reset_8390() did not complete.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

    <span class="n">set_misc_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

<span class="p">}</span> <span class="cm">/* pcnet_reset_8390 */</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">set_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ifmap</span> <span class="o">*</span><span class="n">map</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">!=</span> <span class="p">(</span><span class="n">u_char</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">!=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MISC_REG</span><span class="p">))</span>
	    <span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span>
	    <span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span> <span class="o">=</span> <span class="n">map</span><span class="o">-&gt;</span><span class="n">port</span><span class="p">;</span>
	<span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;switched to %s port</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">if_names</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">if_port</span><span class="p">]);</span>
	<span class="n">NS8390_init</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">ei_irq_wrapper</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">dev_id</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>
    <span class="n">irqreturn_t</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ei_interrupt</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="n">IRQ_HANDLED</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">stale</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ei_watchdog</span><span class="p">(</span><span class="n">u_long</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">)</span><span class="n">arg</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mii_addr</span> <span class="o">=</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">;</span>
    <span class="n">u_short</span> <span class="n">link</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">netif_device_present</span><span class="p">(</span><span class="n">dev</span><span class="p">))</span> <span class="k">goto</span> <span class="n">reschedule</span><span class="p">;</span>

    <span class="cm">/* Check for pending interrupt with expired latency timer: with</span>
<span class="cm">       this, we can limp along even if the interrupt is blocked */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">stale</span><span class="o">++</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ENISR_ALL</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">fast_poll</span><span class="p">)</span>
	    <span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;interrupt(s) dropped!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">ei_irq_wrapper</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">fast_poll</span> <span class="o">=</span> <span class="n">HZ</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">fast_poll</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">fast_poll</span><span class="o">--</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HAS_MII</span><span class="p">))</span>
	<span class="k">goto</span> <span class="n">reschedule</span><span class="p">;</span>

    <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">link</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">link</span> <span class="o">||</span> <span class="p">(</span><span class="n">link</span> <span class="o">==</span> <span class="mh">0xffff</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;MII is missing!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HAS_MII</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">goto</span> <span class="n">reschedule</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">link</span> <span class="o">&amp;=</span> <span class="mh">0x0004</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">link</span> <span class="o">!=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">link_status</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">u_short</span> <span class="n">p</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
	<span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%s link beat</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">link</span> <span class="o">?</span> <span class="s">&quot;found&quot;</span> <span class="o">:</span> <span class="s">&quot;lost&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">link</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IS_DL10022</span><span class="p">))</span> <span class="p">{</span>
	    <span class="cm">/* Disable collision detection on full duplex links */</span>
	    <span class="n">outb</span><span class="p">((</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x0140</span><span class="p">)</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">DLINK_DIAG</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">link</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IS_DL10019</span><span class="p">))</span> <span class="p">{</span>
	    <span class="cm">/* Disable collision detection on full duplex links */</span>
	    <span class="n">write_asic</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x140</span><span class="p">)</span> <span class="o">?</span> <span class="n">DL19FDUPLX</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">==</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span>
		    <span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;autonegotiation complete: &quot;</span>
			   <span class="s">&quot;%sbaseT-%cD selected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			   <span class="p">((</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x0180</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;100&quot;</span> <span class="o">:</span> <span class="s">&quot;10&quot;</span><span class="p">),</span>
			   <span class="p">((</span><span class="n">p</span> <span class="o">&amp;</span> <span class="mh">0x0140</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;F&#39;</span> <span class="o">:</span> <span class="sc">&#39;H&#39;</span><span class="p">));</span>
		<span class="k">else</span>
		    <span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;link partner did not autonegotiate</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	    <span class="p">}</span>
	    <span class="n">NS8390_init</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">link_status</span> <span class="o">=</span> <span class="n">link</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span> <span class="o">&amp;&amp;</span> <span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">mii_reset</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">HZ</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">link</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0004</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(((</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">==</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">link</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">((</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">!=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">link</span><span class="p">))</span> <span class="p">{</span>
	    <span class="cm">/* isolate this MII and try flipping to the other one */</span>
	    <span class="n">mdio_write</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0400</span><span class="p">);</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">^=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">pna_phy</span> <span class="o">^</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">;</span>
	    <span class="n">netdev_info</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;switched to %s transceiver</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">==</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;ethernet&quot;</span> <span class="o">:</span> <span class="s">&quot;PNA&quot;</span><span class="p">);</span>
	    <span class="n">mdio_write</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		       <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">==</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">eth_phy</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x1000</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">link_status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="n">info</span><span class="o">-&gt;</span><span class="n">mii_reset</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>

<span class="nl">reschedule:</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">.</span><span class="n">expires</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">HZ</span><span class="p">;</span>
    <span class="n">add_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">watchdog</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">ei_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ifreq</span> <span class="o">*</span><span class="n">rq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="k">struct</span> <span class="n">mii_ioctl_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">if_mii</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mii_addr</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span> <span class="o">+</span> <span class="n">DLINK_GPIO</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">IS_DL10019</span><span class="o">|</span><span class="n">IS_DL10022</span><span class="p">)))</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

    <span class="k">switch</span> <span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">SIOCGMIIPHY</span>:
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">SIOCGMIIREG</span>:		<span class="cm">/* Read MII PHY register. */</span>
	<span class="n">data</span><span class="o">-&gt;</span><span class="n">val_out</span> <span class="o">=</span> <span class="n">mdio_read</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">reg_num</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">SIOCSMIIREG</span>:		<span class="cm">/* Write MII PHY register. */</span>
	<span class="n">mdio_write</span><span class="p">(</span><span class="n">mii_addr</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">phy_id</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">reg_num</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">val_in</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dma_get_8390_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">e8390_pkt_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">ring_page</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;DMAing conflict in dma_block_input.&quot;</span>
	       <span class="s">&quot;[DMAstat:%1x][irqlock:%1x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">,</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">irqlock</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_NODMA</span><span class="o">+</span><span class="n">E8390_PAGE0</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_CMD</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">e8390_pkt_hdr</span><span class="p">),</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTLO</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>		<span class="cm">/* On page boundary */</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">ring_page</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_RREAD</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_CMD</span><span class="p">);</span>

    <span class="n">insw</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">,</span> <span class="n">hdr</span><span class="p">,</span>
	    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">e8390_pkt_hdr</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
    <span class="cm">/* Fix for big endian systems */</span>
    <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="n">ENISR_RDC</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span>	<span class="cm">/* Ack intr. */</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dma_block_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ring_offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">xfer_count</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="n">ei_debug</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">))</span>
	<span class="n">netdev_dbg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;[bi=%d]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;DMAing conflict in dma_block_input.&quot;</span>
	       <span class="s">&quot;[DMAstat:%1x][irqlock:%1x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">,</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">irqlock</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_NODMA</span><span class="o">+</span><span class="n">E8390_PAGE0</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_CMD</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">count</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTLO</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">ring_offset</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">ring_offset</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_RREAD</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_CMD</span><span class="p">);</span>

    <span class="n">insw</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">,</span><span class="n">buf</span><span class="p">,</span><span class="n">count</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
	<span class="n">buf</span><span class="p">[</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">),</span> <span class="n">xfer_count</span><span class="o">++</span><span class="p">;</span>

    <span class="cm">/* This was for the ALPHA version only, but enough people have been</span>
<span class="cm">       encountering problems that it is still here. */</span>
<span class="cp">#ifdef PCMCIA_DEBUG</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ei_debug</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* DMA termination address check... */</span>
	<span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">tries</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
	<span class="k">do</span> <span class="p">{</span>
	    <span class="cm">/* DON&#39;T check for &#39;inb_p(EN0_ISR) &amp; ENISR_RDC&#39; here</span>
<span class="cm">	       -- it&#39;s broken for Rx on some cards! */</span>
	    <span class="kt">int</span> <span class="n">high</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>
	    <span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>
	    <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">low</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">(((</span><span class="n">ring_offset</span> <span class="o">+</span> <span class="n">xfer_count</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">))</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tries</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
	    <span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;RX transfer address mismatch,&quot;</span>
		   <span class="s">&quot;%#4.4x (expected) vs. %#4.4x (actual).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="n">ring_offset</span> <span class="o">+</span> <span class="n">xfer_count</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="cp">#endif</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">ENISR_RDC</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span>	<span class="cm">/* Ack intr. */</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">;</span>
<span class="p">}</span> <span class="cm">/* dma_block_input */</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dma_block_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span>
			     <span class="k">const</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">start_page</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nic_base</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">base_addr</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="cp">#ifdef PCMCIA_DEBUG</span>
    <span class="kt">int</span> <span class="n">retries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>
    <span class="n">u_long</span> <span class="n">dma_start</span><span class="p">;</span>

<span class="cp">#ifdef PCMCIA_DEBUG</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ei_debug</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
	<span class="n">netdev_dbg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;[bo=%d]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="cp">#endif</span>

    <span class="cm">/* Round the count up for word writes.  Do we need to do this?</span>
<span class="cm">       What effect will an odd byte count have on the 8390?</span>
<span class="cm">       I should check someday. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
	<span class="n">count</span><span class="o">++</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;DMAing conflict in dma_block_output.&quot;</span>
	       <span class="s">&quot;[DMAstat:%1x][irqlock:%1x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span><span class="p">,</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">irqlock</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">|=</span> <span class="mh">0x01</span><span class="p">;</span>
    <span class="cm">/* We should already be in page 0, but to be safe... */</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_PAGE0</span><span class="o">+</span><span class="n">E8390_START</span><span class="o">+</span><span class="n">E8390_NODMA</span><span class="p">,</span> <span class="n">nic_base</span><span class="o">+</span><span class="n">PCNET_CMD</span><span class="p">);</span>

<span class="cp">#ifdef PCMCIA_DEBUG</span>
  <span class="nl">retry:</span>
<span class="cp">#endif</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="n">ENISR_RDC</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span>

    <span class="cm">/* Now the normal output. */</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">count</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTLO</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span>   <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RCNTHI</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="mh">0x00</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>
    <span class="n">outb_p</span><span class="p">(</span><span class="n">start_page</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="n">E8390_RWRITE</span><span class="o">+</span><span class="n">E8390_START</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_CMD</span><span class="p">);</span>
    <span class="n">outsw</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">PCNET_DATAPORT</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">count</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">dma_start</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>

<span class="cp">#ifdef PCMCIA_DEBUG</span>
    <span class="cm">/* This was for the ALPHA version only, but enough people have been</span>
<span class="cm">       encountering problems that it is still here. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ei_debug</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* DMA termination address check... */</span>
	<span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">tries</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
	<span class="k">do</span> <span class="p">{</span>
	    <span class="kt">int</span> <span class="n">high</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARHI</span><span class="p">);</span>
	    <span class="kt">int</span> <span class="n">low</span> <span class="o">=</span> <span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_RSARLO</span><span class="p">);</span>
	    <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">low</span><span class="p">;</span>
	    <span class="k">if</span> <span class="p">((</span><span class="n">start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span> <span class="o">==</span> <span class="n">addr</span><span class="p">)</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">tries</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tries</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
	    <span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Tx packet transfer address mismatch,&quot;</span>
		   <span class="s">&quot;%#4.4x (expected) vs. %#4.4x (actual).</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		   <span class="p">(</span><span class="n">start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	    <span class="k">if</span> <span class="p">(</span><span class="n">retries</span><span class="o">++</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">retry</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
<span class="cp">#endif</span>

    <span class="k">while</span> <span class="p">((</span><span class="n">inb_p</span><span class="p">(</span><span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">ENISR_RDC</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">dma_start</span> <span class="o">+</span> <span class="n">PCNET_RDC_TIMEOUT</span><span class="p">))</span> <span class="p">{</span>
	    <span class="n">netdev_notice</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;timeout waiting for Tx RDC.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	    <span class="n">pcnet_reset_8390</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	    <span class="n">NS8390_init</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	    <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

    <span class="n">outb_p</span><span class="p">(</span><span class="n">ENISR_RDC</span><span class="p">,</span> <span class="n">nic_base</span> <span class="o">+</span> <span class="n">EN0_ISR</span><span class="p">);</span>	<span class="cm">/* Ack intr. */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">DELAY_OUTPUT</span><span class="p">)</span>
	<span class="n">udelay</span><span class="p">((</span><span class="kt">long</span><span class="p">)</span><span class="n">delay_time</span><span class="p">);</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">dmaing</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x01</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">setup_dma_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start_pg</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">stop_pg</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">tx_start_page</span> <span class="o">=</span> <span class="n">start_pg</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">rx_start_page</span> <span class="o">=</span> <span class="n">start_pg</span> <span class="o">+</span> <span class="n">TX_PAGES</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">stop_page</span> <span class="o">=</span> <span class="n">stop_pg</span><span class="p">;</span>

    <span class="cm">/* set up block i/o functions */</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">get_8390_hdr</span> <span class="o">=</span> <span class="n">dma_get_8390_hdr</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">block_input</span> <span class="o">=</span> <span class="n">dma_block_input</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">block_output</span> <span class="o">=</span> <span class="n">dma_block_output</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">copyin</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u_short</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
    <span class="n">u_short</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">odd</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span> <span class="n">c</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">do</span> <span class="p">{</span> <span class="o">*</span><span class="n">d</span><span class="o">++</span> <span class="o">=</span> <span class="n">__raw_readw</span><span class="p">(</span><span class="n">s</span><span class="o">++</span><span class="p">);</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* get last byte by fetching a word and masking */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">odd</span><span class="p">)</span>
	<span class="o">*</span><span class="p">((</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="p">)</span> <span class="o">=</span> <span class="n">readw</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">copyout</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dest</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u_short</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
    <span class="k">const</span> <span class="n">u_short</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">odd</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">return</span><span class="p">;</span>
    <span class="n">odd</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span> <span class="n">c</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">do</span> <span class="p">{</span> <span class="n">__raw_writew</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="o">++</span><span class="p">,</span> <span class="n">d</span><span class="o">++</span><span class="p">);</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">c</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="cm">/* copy last byte doing a read-modify-write */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">odd</span><span class="p">)</span>
	<span class="n">writew</span><span class="p">((</span><span class="n">readw</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="o">*</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">shmem_get_8390_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">e8390_pkt_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span>
			       <span class="kt">int</span> <span class="n">ring_page</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xfer_start</span> <span class="o">=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">mem</span> <span class="o">+</span> <span class="p">(</span><span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span>
				<span class="o">+</span> <span class="p">(</span><span class="n">ring_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
				<span class="o">-</span> <span class="p">(</span><span class="n">ei_status</span><span class="p">.</span><span class="n">rx_start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

    <span class="n">copyin</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">xfer_start</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">e8390_pkt_hdr</span><span class="p">));</span>
    <span class="cm">/* Fix for big endian systems */</span>
    <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">shmem_block_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ring_offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base</span> <span class="o">=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">mem</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">ring_offset</span>
				<span class="o">-</span> <span class="p">(</span><span class="n">ei_status</span><span class="p">.</span><span class="n">rx_start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">priv</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* We must wrap the input move. */</span>
	<span class="kt">int</span> <span class="n">semi_count</span> <span class="o">=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">priv</span> <span class="o">-</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">copyin</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">semi_count</span><span class="p">);</span>
	<span class="n">buf</span> <span class="o">+=</span> <span class="n">semi_count</span><span class="p">;</span>
	<span class="n">offset</span> <span class="o">=</span> <span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">count</span> <span class="o">-=</span> <span class="n">semi_count</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">copyin</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">shmem_block_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span>
			       <span class="k">const</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">start_page</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">shmem</span> <span class="o">=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">mem</span> <span class="o">+</span> <span class="p">(</span><span class="n">start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
    <span class="n">shmem</span> <span class="o">-=</span> <span class="n">ei_status</span><span class="p">.</span><span class="n">tx_start_page</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
    <span class="n">copyout</span><span class="p">(</span><span class="n">shmem</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">setup_shmem_window</span><span class="p">(</span><span class="k">struct</span> <span class="n">pcmcia_device</span> <span class="o">*</span><span class="n">link</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start_pg</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">stop_pg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cm_offset</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
    <span class="n">pcnet_dev_t</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">PRIV</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">window_size</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

    <span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">stop_pg</span> <span class="o">-</span> <span class="n">start_pg</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">window_size</span> <span class="o">&gt;</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
	<span class="n">window_size</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">;</span>

    <span class="cm">/* Make sure it&#39;s a power of two.  */</span>
    <span class="n">window_size</span> <span class="o">=</span> <span class="n">roundup_pow_of_two</span><span class="p">(</span><span class="n">window_size</span><span class="p">);</span>

    <span class="cm">/* Allocate a memory window */</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">WIN_DATA_WIDTH_16</span><span class="o">|</span><span class="n">WIN_MEMORY_TYPE_CM</span><span class="o">|</span><span class="n">WIN_ENABLE</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">WIN_USE_WAIT</span><span class="p">;</span>
    <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">=</span> <span class="n">window_size</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">pcmcia_request_window</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">mem_speed</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
	    <span class="k">goto</span> <span class="n">failed</span><span class="p">;</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">start_pg</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">cm_offset</span><span class="p">;</span>
    <span class="n">offset</span> <span class="o">-=</span> <span class="n">offset</span> <span class="o">%</span> <span class="n">window_size</span><span class="p">;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">pcmcia_map_mem_page</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">offset</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
	    <span class="k">goto</span> <span class="n">failed</span><span class="p">;</span>

    <span class="cm">/* Try scribbling on the buffer */</span>
    <span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">,</span>
			<span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]));</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">);</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
	<span class="n">__raw_writew</span><span class="p">((</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">),</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span><span class="o">+</span><span class="n">offset</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
    <span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">);</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">__raw_readw</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span><span class="o">+</span><span class="n">offset</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">))</span> <span class="k">break</span><span class="p">;</span>
    <span class="n">pcnet_reset_8390</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">!=</span> <span class="p">(</span><span class="n">TX_PAGES</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">))</span> <span class="p">{</span>
	<span class="n">iounmap</span><span class="p">(</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span><span class="p">);</span>
	<span class="n">pcmcia_release_window</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">goto</span> <span class="n">failed</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mem_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_long</span><span class="p">)</span><span class="n">ei_status</span><span class="p">.</span><span class="n">mem</span><span class="p">;</span>
    <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mem_end</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mem_start</span> <span class="o">+</span> <span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

    <span class="n">ei_status</span><span class="p">.</span><span class="n">tx_start_page</span> <span class="o">=</span> <span class="n">start_pg</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">rx_start_page</span> <span class="o">=</span> <span class="n">start_pg</span> <span class="o">+</span> <span class="n">TX_PAGES</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">stop_page</span> <span class="o">=</span> <span class="n">start_pg</span> <span class="o">+</span> <span class="p">(</span>
	    <span class="p">(</span><span class="n">resource_size</span><span class="p">(</span><span class="n">link</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>

    <span class="cm">/* set up block i/o functions */</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">get_8390_hdr</span> <span class="o">=</span> <span class="n">shmem_get_8390_hdr</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">block_input</span> <span class="o">=</span> <span class="n">shmem_block_input</span><span class="p">;</span>
    <span class="n">ei_status</span><span class="p">.</span><span class="n">block_output</span> <span class="o">=</span> <span class="n">shmem_block_output</span><span class="p">;</span>

    <span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">USE_SHMEM</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">failed:</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*====================================================================*/</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcmcia_device_id</span> <span class="n">pcnet_ids</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0057</span><span class="p">,</span> <span class="mh">0x0021</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0104</span><span class="p">,</span> <span class="mh">0x000a</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0105</span><span class="p">,</span> <span class="mh">0xea15</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0143</span><span class="p">,</span> <span class="mh">0x3341</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0143</span><span class="p">,</span> <span class="mh">0xc0ab</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x021b</span><span class="p">,</span> <span class="mh">0x0101</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x08a1</span><span class="p">,</span> <span class="mh">0xc0ab</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;AnyCom&quot;</span><span class="p">,</span> <span class="s">&quot;Fast Ethernet + 56K COMBO&quot;</span><span class="p">,</span> <span class="mh">0x578ba6e7</span><span class="p">,</span> <span class="mh">0xb0ac62c4</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;ATKK&quot;</span><span class="p">,</span> <span class="s">&quot;LM33-PCM-T&quot;</span><span class="p">,</span> <span class="mh">0xba9eb7e2</span><span class="p">,</span> <span class="mh">0x077c174e</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;D-Link&quot;</span><span class="p">,</span> <span class="s">&quot;DME336T&quot;</span><span class="p">,</span> <span class="mh">0x1a424a1c</span><span class="p">,</span> <span class="mh">0xb23897ff</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Grey Cell&quot;</span><span class="p">,</span> <span class="s">&quot;GCS3000&quot;</span><span class="p">,</span> <span class="mh">0x2a151fac</span><span class="p">,</span> <span class="mh">0x48b932ae</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;EtherFast 10&amp;100 + 56K PC Card (PCMLM56)&quot;</span><span class="p">,</span> <span class="mh">0x0733cc81</span><span class="p">,</span> <span class="mh">0xb3765033</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;LINKSYS&quot;</span><span class="p">,</span> <span class="s">&quot;PCMLM336&quot;</span><span class="p">,</span> <span class="mh">0xf7cb0b07</span><span class="p">,</span> <span class="mh">0x7a821b58</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;MICRO RESEARCH&quot;</span><span class="p">,</span> <span class="s">&quot;COMBO-L/M-336&quot;</span><span class="p">,</span> <span class="mh">0xb2ced065</span><span class="p">,</span> <span class="mh">0x3ced0555</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;PCMCIAs&quot;</span><span class="p">,</span> <span class="s">&quot;ComboCard&quot;</span><span class="p">,</span> <span class="mh">0xdcfe12d3</span><span class="p">,</span> <span class="mh">0xcd8906cc</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;PCMCIAs&quot;</span><span class="p">,</span> <span class="s">&quot;LanModem&quot;</span><span class="p">,</span> <span class="mh">0xdcfe12d3</span><span class="p">,</span> <span class="mh">0xc67c648f</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IBM&quot;</span><span class="p">,</span> <span class="s">&quot;Home and Away 28.8 PC Card       &quot;</span><span class="p">,</span> <span class="mh">0xb569a6e5</span><span class="p">,</span> <span class="mh">0x5bd4ff2c</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IBM&quot;</span><span class="p">,</span> <span class="s">&quot;Home and Away Credit Card Adapter&quot;</span><span class="p">,</span> <span class="mh">0xb569a6e5</span><span class="p">,</span> <span class="mh">0x4bdf15c3</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;IBM&quot;</span><span class="p">,</span> <span class="s">&quot;w95 Home and Away Credit Card &quot;</span><span class="p">,</span> <span class="mh">0xb569a6e5</span><span class="p">,</span> <span class="mh">0xae911c15</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_PROD_ID123</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;APEX DATA&quot;</span><span class="p">,</span> <span class="s">&quot;MULTICARD&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET-MODEM&quot;</span><span class="p">,</span> <span class="mh">0x11c2da09</span><span class="p">,</span> <span class="mh">0x7289dc5d</span><span class="p">,</span> <span class="mh">0xaad95e1f</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_PROD_ID2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;FAX/Modem/Ethernet Combo Card &quot;</span><span class="p">,</span> <span class="mh">0x1ed59302</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0057</span><span class="p">,</span> <span class="mh">0x1004</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0104</span><span class="p">,</span> <span class="mh">0x000d</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0104</span><span class="p">,</span> <span class="mh">0x0075</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0104</span><span class="p">,</span> <span class="mh">0x0145</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0149</span><span class="p">,</span> <span class="mh">0x0230</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0149</span><span class="p">,</span> <span class="mh">0x4530</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0149</span><span class="p">,</span> <span class="mh">0xc1ab</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0186</span><span class="p">,</span> <span class="mh">0x0110</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x01bf</span><span class="p">,</span> <span class="mh">0x8041</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0213</span><span class="p">,</span> <span class="mh">0x2452</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x026f</span><span class="p">,</span> <span class="mh">0x0300</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x026f</span><span class="p">,</span> <span class="mh">0x0307</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x026f</span><span class="p">,</span> <span class="mh">0x030a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0274</span><span class="p">,</span> <span class="mh">0x1103</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_MANF_CARD</span><span class="p">(</span><span class="mh">0x0274</span><span class="p">,</span> <span class="mh">0x1121</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;2408LAN&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x352fff7f</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1234</span><span class="p">(</span><span class="s">&quot;Socket&quot;</span><span class="p">,</span> <span class="s">&quot;CF 10/100 Ethernet Card&quot;</span><span class="p">,</span> <span class="s">&quot;Revision B&quot;</span><span class="p">,</span> <span class="s">&quot;05/11/06&quot;</span><span class="p">,</span> <span class="mh">0xb38bcc2e</span><span class="p">,</span> <span class="mh">0x4de88352</span><span class="p">,</span> <span class="mh">0xeaca6c8d</span><span class="p">,</span> <span class="mh">0x7e57c22e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;Cardwell&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x9533672e</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;CNet  &quot;</span><span class="p">,</span> <span class="s">&quot;CN30BC&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x9fe55d3d</span><span class="p">,</span> <span class="mh">0x85601198</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;Digital&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="s">&quot;Adapter&quot;</span><span class="p">,</span> <span class="mh">0x9999ab35</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">,</span> <span class="mh">0x4b0d829e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;Edimax Technology Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x738a0019</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x5e9d92c0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;EFA   &quot;</span><span class="p">,</span> <span class="s">&quot;EFA207&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x3d294be4</span><span class="p">,</span> <span class="mh">0xeb9aab6c</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;I-O DATA&quot;</span><span class="p">,</span> <span class="s">&quot;PCLA&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x1d55d7ec</span><span class="p">,</span> <span class="mh">0xe4c64d34</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;IO DATA&quot;</span><span class="p">,</span> <span class="s">&quot;PCLATE&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x547e66dc</span><span class="p">,</span> <span class="mh">0x6b260753</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;KingMax Technology Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;EN10-T2&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x932b7189</span><span class="p">,</span> <span class="mh">0x699e4436</span><span class="p">,</span> <span class="mh">0x6f6652e0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA-ETHERNET-CARD&quot;</span><span class="p">,</span> <span class="s">&quot;UE2216&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xd4cd2f20</span><span class="p">,</span> <span class="mh">0xb87add82</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA-ETHERNET-CARD&quot;</span><span class="p">,</span> <span class="s">&quot;UE2620&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xd4cd2f20</span><span class="p">,</span> <span class="mh">0x7d3d83a8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1</span><span class="p">(</span><span class="s">&quot;2412LAN&quot;</span><span class="p">,</span> <span class="mh">0x67f236ab</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;ACCTON&quot;</span><span class="p">,</span> <span class="s">&quot;EN2212&quot;</span><span class="p">,</span> <span class="mh">0xdfc6b5b2</span><span class="p">,</span> <span class="mh">0xcb112a11</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;ACCTON&quot;</span><span class="p">,</span> <span class="s">&quot;EN2216-PCMCIA-ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0xdfc6b5b2</span><span class="p">,</span> <span class="mh">0x5542bfff</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Allied Telesis, K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;CentreCOM LA100-PCM-T V2 100/10M LAN PC Card&quot;</span><span class="p">,</span> <span class="mh">0xbb7fbdd7</span><span class="p">,</span> <span class="mh">0xcd91cc68</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Allied Telesis K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;LA100-PCM V2&quot;</span><span class="p">,</span> <span class="mh">0x36634a66</span><span class="p">,</span> <span class="mh">0xc6d05997</span><span class="p">),</span>
  	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Allied Telesis, K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;CentreCOM LA-PCM_V2&quot;</span><span class="p">,</span> <span class="mh">0xbb7fBdd7</span><span class="p">,</span> <span class="mh">0x28e299f8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Allied Telesis K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;LA-PCM V3&quot;</span><span class="p">,</span> <span class="mh">0x36634a66</span><span class="p">,</span> <span class="mh">0x62241d96</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AmbiCom&quot;</span><span class="p">,</span> <span class="s">&quot;AMB8010&quot;</span><span class="p">,</span> <span class="mh">0x5070a7f9</span><span class="p">,</span> <span class="mh">0x82f96e96</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AmbiCom&quot;</span><span class="p">,</span> <span class="s">&quot;AMB8610&quot;</span><span class="p">,</span> <span class="mh">0x5070a7f9</span><span class="p">,</span> <span class="mh">0x86741224</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AmbiCom Inc&quot;</span><span class="p">,</span> <span class="s">&quot;AMB8002&quot;</span><span class="p">,</span> <span class="mh">0x93b15570</span><span class="p">,</span> <span class="mh">0x75ec3efb</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AmbiCom Inc&quot;</span><span class="p">,</span> <span class="s">&quot;AMB8002T&quot;</span><span class="p">,</span> <span class="mh">0x93b15570</span><span class="p">,</span> <span class="mh">0x461c5247</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AmbiCom Inc&quot;</span><span class="p">,</span> <span class="s">&quot;AMB8010&quot;</span><span class="p">,</span> <span class="mh">0x93b15570</span><span class="p">,</span> <span class="mh">0x82f96e96</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AnyCom&quot;</span><span class="p">,</span> <span class="s">&quot;ECO Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x578ba6e7</span><span class="p">,</span> <span class="mh">0x0a9888c1</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AnyCom&quot;</span><span class="p">,</span> <span class="s">&quot;ECO Ethernet 10/100&quot;</span><span class="p">,</span> <span class="mh">0x578ba6e7</span><span class="p">,</span> <span class="mh">0x939fedbd</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;AROWANA&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA Ethernet LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x313adbc8</span><span class="p">,</span> <span class="mh">0x08d9f190</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;ASANTE&quot;</span><span class="p">,</span> <span class="s">&quot;FriendlyNet PC Card&quot;</span><span class="p">,</span> <span class="mh">0x3a7ade0f</span><span class="p">,</span> <span class="mh">0x41c64504</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Billionton&quot;</span><span class="p">,</span> <span class="s">&quot;LNT-10TB&quot;</span><span class="p">,</span> <span class="mh">0x552ab682</span><span class="p">,</span> <span class="mh">0xeeb1ba6a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CF&quot;</span><span class="p">,</span> <span class="s">&quot;10Base-Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x44ebf863</span><span class="p">,</span> <span class="mh">0x93ae4d79</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CNet&quot;</span><span class="p">,</span> <span class="s">&quot;CN40BC Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xbc477dde</span><span class="p">,</span> <span class="mh">0xfba775a7</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;COMPU-SHACK&quot;</span><span class="p">,</span> <span class="s">&quot;BASEline PCMCIA 10 MBit Ethernetadapter&quot;</span><span class="p">,</span> <span class="mh">0xfa2e424d</span><span class="p">,</span> <span class="mh">0xe9190d8a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;COMPU-SHACK&quot;</span><span class="p">,</span> <span class="s">&quot;FASTline PCMCIA 10/100 Fast-Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xfa2e424d</span><span class="p">,</span> <span class="mh">0x3953d9b9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CONTEC&quot;</span><span class="p">,</span> <span class="s">&quot;C-NET(PC)C-10L&quot;</span><span class="p">,</span> <span class="mh">0x21cab552</span><span class="p">,</span> <span class="mh">0xf6f90722</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega&quot;</span><span class="p">,</span> <span class="s">&quot;FEther PCC-TXF&quot;</span><span class="p">,</span> <span class="mh">0x0a21501a</span><span class="p">,</span> <span class="mh">0xa51564a2</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega&quot;</span><span class="p">,</span> <span class="s">&quot;Ether CF-TD&quot;</span><span class="p">,</span> <span class="mh">0x0a21501a</span><span class="p">,</span> <span class="mh">0x6589340a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega Ether CF-TD LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0x8797663b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega EtherII PCC-T&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0xfa9d85bd</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega EtherII PCC-TD&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0xc49bd73d</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega EtherII PCC-TD&quot;</span><span class="p">,</span> <span class="mh">0xd4fdcbd8</span><span class="p">,</span> <span class="mh">0xc49bd73d</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega Ether PCC-T&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0x6705fcaa</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega Ether PCC-TD&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0x47d5ca83</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;corega FastEther PCC-TX&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0x485e85d9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Corega,K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x110d26d9</span><span class="p">,</span> <span class="mh">0x9fd2f0a2</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega,K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x9791a90e</span><span class="p">,</span> <span class="mh">0x9fd2f0a2</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;corega K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;(CG-LAPCCTXD)&quot;</span><span class="p">,</span> <span class="mh">0x5261440f</span><span class="p">,</span> <span class="mh">0x73ec0d88</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CouplerlessPCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;100BASE&quot;</span><span class="p">,</span> <span class="mh">0xee5af0ad</span><span class="p">,</span> <span class="mh">0x7c2add04</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CyQ&#39;ve&quot;</span><span class="p">,</span> <span class="s">&quot;ELA-010&quot;</span><span class="p">,</span> <span class="mh">0x77008979</span><span class="p">,</span> <span class="mh">0x9d8d445d</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;CyQ&#39;ve&quot;</span><span class="p">,</span> <span class="s">&quot;ELA-110E 10/100M LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x77008979</span><span class="p">,</span> <span class="mh">0xfd184814</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;DataTrek.&quot;</span><span class="p">,</span> <span class="s">&quot;NetCard &quot;</span><span class="p">,</span> <span class="mh">0x5cd66d9d</span><span class="p">,</span> <span class="mh">0x84697ce0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Dayna Communications, Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;CommuniCard E&quot;</span><span class="p">,</span> <span class="mh">0x0c629325</span><span class="p">,</span> <span class="mh">0xb4e7dbaf</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Digicom&quot;</span><span class="p">,</span> <span class="s">&quot;Palladio LAN 10/100&quot;</span><span class="p">,</span> <span class="mh">0x697403d8</span><span class="p">,</span> <span class="mh">0xe160b995</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Digicom&quot;</span><span class="p">,</span> <span class="s">&quot;Palladio LAN 10/100 Dongless&quot;</span><span class="p">,</span> <span class="mh">0x697403d8</span><span class="p">,</span> <span class="mh">0xa6d3b233</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;DIGITAL&quot;</span><span class="p">,</span> <span class="s">&quot;DEPCM-XX&quot;</span><span class="p">,</span> <span class="mh">0x69616cb3</span><span class="p">,</span> <span class="mh">0xe600e76e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;D-Link&quot;</span><span class="p">,</span> <span class="s">&quot;DE-650&quot;</span><span class="p">,</span> <span class="mh">0x1a424a1c</span><span class="p">,</span> <span class="mh">0xf28c8398</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;D-Link&quot;</span><span class="p">,</span> <span class="s">&quot;DE-660&quot;</span><span class="p">,</span> <span class="mh">0x1a424a1c</span><span class="p">,</span> <span class="mh">0xd9a1d05b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;D-Link&quot;</span><span class="p">,</span> <span class="s">&quot;DE-660+&quot;</span><span class="p">,</span> <span class="mh">0x1a424a1c</span><span class="p">,</span> <span class="mh">0x50dcd0ec</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;D-Link&quot;</span><span class="p">,</span> <span class="s">&quot;DFE-650&quot;</span><span class="p">,</span> <span class="mh">0x1a424a1c</span><span class="p">,</span> <span class="mh">0x0f0073f9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Dual Speed&quot;</span><span class="p">,</span> <span class="s">&quot;10/100 PC Card&quot;</span><span class="p">,</span> <span class="mh">0x725b842d</span><span class="p">,</span> <span class="mh">0xf1efee84</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Dual Speed&quot;</span><span class="p">,</span> <span class="s">&quot;10/100 Port Attached PC Card&quot;</span><span class="p">,</span> <span class="mh">0x725b842d</span><span class="p">,</span> <span class="mh">0x2db1f8e9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Dynalink&quot;</span><span class="p">,</span> <span class="s">&quot;L10BC&quot;</span><span class="p">,</span> <span class="mh">0x55632fd5</span><span class="p">,</span> <span class="mh">0xdc65f2b1</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;DYNALINK&quot;</span><span class="p">,</span> <span class="s">&quot;L10BC&quot;</span><span class="p">,</span> <span class="mh">0x6a26d1cf</span><span class="p">,</span> <span class="mh">0xdc65f2b1</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;DYNALINK&quot;</span><span class="p">,</span> <span class="s">&quot;L10C&quot;</span><span class="p">,</span> <span class="mh">0x6a26d1cf</span><span class="p">,</span> <span class="mh">0xc4f84efb</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;E-CARD&quot;</span><span class="p">,</span> <span class="s">&quot;E-CARD&quot;</span><span class="p">,</span> <span class="mh">0x6701da11</span><span class="p">,</span> <span class="mh">0x6701da11</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;EIGER Labs Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet 10BaseT card&quot;</span><span class="p">,</span> <span class="mh">0x53c864c6</span><span class="p">,</span> <span class="mh">0xedd059f6</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;EIGER Labs Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Combo card&quot;</span><span class="p">,</span> <span class="mh">0x53c864c6</span><span class="p">,</span> <span class="mh">0x929c486c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="s">&quot;Adapter&quot;</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">,</span> <span class="mh">0x4b0d829e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Ethernet Adapter&quot;</span><span class="p">,</span> <span class="s">&quot;E2000 PCMCIA Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x96767301</span><span class="p">,</span> <span class="mh">0x71fbbc61</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Ethernet PCMCIA adapter&quot;</span><span class="p">,</span> <span class="s">&quot;EP-210&quot;</span><span class="p">,</span> <span class="mh">0x8dd86181</span><span class="p">,</span> <span class="mh">0xf2b52517</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Fast Ethernet&quot;</span><span class="p">,</span> <span class="s">&quot;Adapter&quot;</span><span class="p">,</span> <span class="mh">0xb4be14e3</span><span class="p">,</span> <span class="mh">0x4b0d829e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Grey Cell&quot;</span><span class="p">,</span> <span class="s">&quot;GCS2000&quot;</span><span class="p">,</span> <span class="mh">0x2a151fac</span><span class="p">,</span> <span class="mh">0xf00555cb</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Grey Cell&quot;</span><span class="p">,</span> <span class="s">&quot;GCS2220&quot;</span><span class="p">,</span> <span class="mh">0x2a151fac</span><span class="p">,</span> <span class="mh">0xc1b7e327</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;GVC&quot;</span><span class="p">,</span> <span class="s">&quot;NIC-2000p&quot;</span><span class="p">,</span> <span class="mh">0x76e171bd</span><span class="p">,</span> <span class="mh">0x6eb1c947</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;IBM Corp.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xe3736c88</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;IC-CARD&quot;</span><span class="p">,</span> <span class="s">&quot;IC-CARD&quot;</span><span class="p">,</span> <span class="mh">0x60cb09a6</span><span class="p">,</span> <span class="mh">0x60cb09a6</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;IC-CARD+&quot;</span><span class="p">,</span> <span class="s">&quot;IC-CARD+&quot;</span><span class="p">,</span> <span class="mh">0x93693494</span><span class="p">,</span> <span class="mh">0x93693494</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;IO DATA&quot;</span><span class="p">,</span> <span class="s">&quot;PCETTX&quot;</span><span class="p">,</span> <span class="mh">0x547e66dc</span><span class="p">,</span> <span class="mh">0x6fc5459b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;iPort&quot;</span><span class="p">,</span> <span class="s">&quot;10/100 Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x56c538d2</span><span class="p">,</span> <span class="mh">0x11b0ffc0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;KANSAI ELECTRIC CO.,LTD&quot;</span><span class="p">,</span> <span class="s">&quot;KLA-PCM/T&quot;</span><span class="p">,</span> <span class="mh">0xb18dc3b4</span><span class="p">,</span> <span class="mh">0xcc51a956</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;KENTRONICS&quot;</span><span class="p">,</span> <span class="s">&quot;KEP-230&quot;</span><span class="p">,</span> <span class="mh">0xaf8144c9</span><span class="p">,</span> <span class="mh">0x868f6616</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;KCI&quot;</span><span class="p">,</span> <span class="s">&quot;PE520 PCMCIA Ethernet Adapter&quot;</span><span class="p">,</span> <span class="mh">0xa89b87d3</span><span class="p">,</span> <span class="mh">0x1eb88e64</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;KINGMAX&quot;</span><span class="p">,</span> <span class="s">&quot;EN10T2T&quot;</span><span class="p">,</span> <span class="mh">0x7bcb459a</span><span class="p">,</span> <span class="mh">0xa5c81fa5</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Kingston&quot;</span><span class="p">,</span> <span class="s">&quot;KNE-PC2&quot;</span><span class="p">,</span> <span class="mh">0x1128e633</span><span class="p">,</span> <span class="mh">0xce2a89b3</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Kingston Technology Corp.&quot;</span><span class="p">,</span> <span class="s">&quot;EtheRx PC Card Ethernet Adapter&quot;</span><span class="p">,</span> <span class="mh">0x313c7be3</span><span class="p">,</span> <span class="mh">0x0afb54a2</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Laneed&quot;</span><span class="p">,</span> <span class="s">&quot;LD-10/100CD&quot;</span><span class="p">,</span> <span class="mh">0x1b7827b2</span><span class="p">,</span> <span class="mh">0xcda71d1c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Laneed&quot;</span><span class="p">,</span> <span class="s">&quot;LD-CDF&quot;</span><span class="p">,</span> <span class="mh">0x1b7827b2</span><span class="p">,</span> <span class="mh">0xfec71e40</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Laneed&quot;</span><span class="p">,</span> <span class="s">&quot;LD-CDL/T&quot;</span><span class="p">,</span> <span class="mh">0x1b7827b2</span><span class="p">,</span> <span class="mh">0x79fba4f7</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Laneed&quot;</span><span class="p">,</span> <span class="s">&quot;LD-CDS&quot;</span><span class="p">,</span> <span class="mh">0x1b7827b2</span><span class="p">,</span> <span class="mh">0x931afaab</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;LEMEL&quot;</span><span class="p">,</span> <span class="s">&quot;LM-N89TX PRO&quot;</span><span class="p">,</span> <span class="mh">0xbbefb52f</span><span class="p">,</span> <span class="mh">0xd2897a97</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;Combo PCMCIA EthernetCard (EC2T)&quot;</span><span class="p">,</span> <span class="mh">0x0733cc81</span><span class="p">,</span> <span class="mh">0x32ee8c78</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;LINKSYS&quot;</span><span class="p">,</span> <span class="s">&quot;E-CARD&quot;</span><span class="p">,</span> <span class="mh">0xf7cb0b07</span><span class="p">,</span> <span class="mh">0x6701da11</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;EtherFast 10/100 Integrated PC Card (PCM100)&quot;</span><span class="p">,</span> <span class="mh">0x0733cc81</span><span class="p">,</span> <span class="mh">0x453c3f9d</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;EtherFast 10/100 PC Card (PCMPC100)&quot;</span><span class="p">,</span> <span class="mh">0x0733cc81</span><span class="p">,</span> <span class="mh">0x66c5a389</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;EtherFast 10/100 PC Card (PCMPC100 V2)&quot;</span><span class="p">,</span> <span class="mh">0x0733cc81</span><span class="p">,</span> <span class="mh">0x3a3b28e9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Linksys&quot;</span><span class="p">,</span> <span class="s">&quot;HomeLink Phoneline + 10/100 Network PC Card (PCM100H1)&quot;</span><span class="p">,</span> <span class="mh">0x733cc81</span><span class="p">,</span> <span class="mh">0x7a3e5c3a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Logitec&quot;</span><span class="p">,</span> <span class="s">&quot;LPM-LN100TX&quot;</span><span class="p">,</span> <span class="mh">0x88fcdeda</span><span class="p">,</span> <span class="mh">0x6d772737</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Logitec&quot;</span><span class="p">,</span> <span class="s">&quot;LPM-LN100TE&quot;</span><span class="p">,</span> <span class="mh">0x88fcdeda</span><span class="p">,</span> <span class="mh">0x0e714bee</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Logitec&quot;</span><span class="p">,</span> <span class="s">&quot;LPM-LN20T&quot;</span><span class="p">,</span> <span class="mh">0x88fcdeda</span><span class="p">,</span> <span class="mh">0x81090922</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Logitec&quot;</span><span class="p">,</span> <span class="s">&quot;LPM-LN10TE&quot;</span><span class="p">,</span> <span class="mh">0x88fcdeda</span><span class="p">,</span> <span class="mh">0xc1e2521c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;LONGSHINE&quot;</span><span class="p">,</span> <span class="s">&quot;PCMCIA Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0xf866b0b0</span><span class="p">,</span> <span class="mh">0x6f6652e0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;MACNICA&quot;</span><span class="p">,</span> <span class="s">&quot;ME1-JEIDA&quot;</span><span class="p">,</span> <span class="mh">0x20841b68</span><span class="p">,</span> <span class="mh">0xaf8a3578</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Macsense&quot;</span><span class="p">,</span> <span class="s">&quot;MPC-10&quot;</span><span class="p">,</span> <span class="mh">0xd830297f</span><span class="p">,</span> <span class="mh">0xd265c307</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Matsushita Electric Industrial Co.,LTD.&quot;</span><span class="p">,</span> <span class="s">&quot;CF-VEL211&quot;</span><span class="p">,</span> <span class="mh">0x44445376</span><span class="p">,</span> <span class="mh">0x8ded41d4</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;MAXTECH&quot;</span><span class="p">,</span> <span class="s">&quot;PCN2000&quot;</span><span class="p">,</span> <span class="mh">0x78d64bc0</span><span class="p">,</span> <span class="mh">0xca0ca4b8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;MELCO&quot;</span><span class="p">,</span> <span class="s">&quot;LPC2-T&quot;</span><span class="p">,</span> <span class="mh">0x481e0094</span><span class="p">,</span> <span class="mh">0xa2eb0cf3</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;MELCO&quot;</span><span class="p">,</span> <span class="s">&quot;LPC2-TX&quot;</span><span class="p">,</span> <span class="mh">0x481e0094</span><span class="p">,</span> <span class="mh">0x41a6916c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Microcom C.E.&quot;</span><span class="p">,</span> <span class="s">&quot;Travel Card LAN 10/100&quot;</span><span class="p">,</span> <span class="mh">0x4b91cec7</span><span class="p">,</span> <span class="mh">0xe70220d6</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Microdyne&quot;</span><span class="p">,</span> <span class="s">&quot;NE4200&quot;</span><span class="p">,</span> <span class="mh">0x2e6da59b</span><span class="p">,</span> <span class="mh">0x0478e472</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;MIDORI ELEC.&quot;</span><span class="p">,</span> <span class="s">&quot;LT-PCMT&quot;</span><span class="p">,</span> <span class="mh">0x648d55c1</span><span class="p">,</span> <span class="mh">0xbde526c7</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;National Semiconductor&quot;</span><span class="p">,</span> <span class="s">&quot;InfoMover 4100&quot;</span><span class="p">,</span> <span class="mh">0x36e1191f</span><span class="p">,</span> <span class="mh">0x60c229b9</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;National Semiconductor&quot;</span><span class="p">,</span> <span class="s">&quot;InfoMover NE4100&quot;</span><span class="p">,</span> <span class="mh">0x36e1191f</span><span class="p">,</span> <span class="mh">0xa6617ec8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;NEC&quot;</span><span class="p">,</span> <span class="s">&quot;PC-9801N-J12&quot;</span><span class="p">,</span> <span class="mh">0x18df0ba0</span><span class="p">,</span> <span class="mh">0xbc912d76</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;NETGEAR&quot;</span><span class="p">,</span> <span class="s">&quot;FA410TX&quot;</span><span class="p">,</span> <span class="mh">0x9aa79dc3</span><span class="p">,</span> <span class="mh">0x60e5bc0e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Network Everywhere&quot;</span><span class="p">,</span> <span class="s">&quot;Fast Ethernet 10/100 PC Card&quot;</span><span class="p">,</span> <span class="mh">0x820a67b6</span><span class="p">,</span> <span class="mh">0x31ed1a5f</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;NextCom K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;Next Hawk&quot;</span><span class="p">,</span> <span class="mh">0xaedaec74</span><span class="p">,</span> <span class="mh">0xad050ef1</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;10/100Mbps Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x6e41773b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x3ff7175b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet 10BaseT Card&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x4de2f6c8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x5e9d92c0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Combo card&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x929c486c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;ETHERNET V1.0&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x4d8817c8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;FastEthernet&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xfe871eeb</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;Fast-Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x45f1f3b4</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;FAST ETHERNET CARD&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xec5dbca7</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA LAN&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x7500e246</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;LNT-10TN&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xe707f641</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIAs&quot;</span><span class="p">,</span> <span class="s">&quot;ComboCard&quot;</span><span class="p">,</span> <span class="mh">0xdcfe12d3</span><span class="p">,</span> <span class="mh">0xcd8906cc</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;UE2212&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0xbf17199b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;    Ethernet NE2000 Compatible&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x42d5d7e1</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PRETEC&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet CompactLAN 10baseT 3.3V&quot;</span><span class="p">,</span> <span class="mh">0xebf91155</span><span class="p">,</span> <span class="mh">0x30074c80</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PRETEC&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet CompactLAN 10BaseT 3.3V&quot;</span><span class="p">,</span> <span class="mh">0xebf91155</span><span class="p">,</span> <span class="mh">0x7f5a4f50</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Psion Dacom&quot;</span><span class="p">,</span> <span class="s">&quot;Gold Card Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xf5f025c2</span><span class="p">,</span> <span class="mh">0x3a30e110</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;=RELIA==&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xcdd0644a</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;RIOS Systems Co.&quot;</span><span class="p">,</span> <span class="s">&quot;PC CARD3 ETHERNET&quot;</span><span class="p">,</span> <span class="mh">0x7dd33481</span><span class="p">,</span> <span class="mh">0x10b41826</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;RP&quot;</span><span class="p">,</span> <span class="s">&quot;1625B Ethernet NE2000 Compatible&quot;</span><span class="p">,</span> <span class="mh">0xe3e66e22</span><span class="p">,</span> <span class="mh">0xb96150df</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;RPTI&quot;</span><span class="p">,</span> <span class="s">&quot;EP400 Ethernet NE2000 Compatible&quot;</span><span class="p">,</span> <span class="mh">0xdc6f88fd</span><span class="p">,</span> <span class="mh">0x4a7e2ae0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;RPTI&quot;</span><span class="p">,</span> <span class="s">&quot;EP401 Ethernet NE2000 Compatible&quot;</span><span class="p">,</span> <span class="mh">0xdc6f88fd</span><span class="p">,</span> <span class="mh">0x4bcbd7fd</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;RPTI LTD.&quot;</span><span class="p">,</span> <span class="s">&quot;EP400&quot;</span><span class="p">,</span> <span class="mh">0xc53ac515</span><span class="p">,</span> <span class="mh">0x81e39388</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;SCM&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Combo card&quot;</span><span class="p">,</span> <span class="mh">0xbdc3b102</span><span class="p">,</span> <span class="mh">0x929c486c</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Seiko Epson Corp.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x09928730</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;SMC&quot;</span><span class="p">,</span> <span class="s">&quot;EZCard-10-PCMCIA&quot;</span><span class="p">,</span> <span class="mh">0xc4f8b18b</span><span class="p">,</span> <span class="mh">0xfb21d265</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Socket Communications Inc&quot;</span><span class="p">,</span> <span class="s">&quot;Socket EA PCMCIA LAN Adapter Revision D&quot;</span><span class="p">,</span> <span class="mh">0xc70a4760</span><span class="p">,</span> <span class="mh">0x2ade483e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Socket Communications Inc&quot;</span><span class="p">,</span> <span class="s">&quot;Socket EA PCMCIA LAN Adapter Revision E&quot;</span><span class="p">,</span> <span class="mh">0xc70a4760</span><span class="p">,</span> <span class="mh">0x5dd978a8</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;TDK&quot;</span><span class="p">,</span> <span class="s">&quot;LAK-CD031 for PCMCIA&quot;</span><span class="p">,</span> <span class="mh">0x1eae9475</span><span class="p">,</span> <span class="mh">0x0ed386fa</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Telecom Device K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;SuperSocket RE450T&quot;</span><span class="p">,</span> <span class="mh">0x466b05f0</span><span class="p">,</span> <span class="mh">0x8b74bc4f</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Telecom Device K.K.&quot;</span><span class="p">,</span> <span class="s">&quot;SuperSocket RE550T&quot;</span><span class="p">,</span> <span class="mh">0x466b05f0</span><span class="p">,</span> <span class="mh">0x33c8db2a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID13</span><span class="p">(</span><span class="s">&quot;Hypertec&quot;</span><span class="p">,</span>  <span class="s">&quot;EP401&quot;</span><span class="p">,</span> <span class="mh">0x8787bec7</span><span class="p">,</span> <span class="mh">0xf6e4a31e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID13</span><span class="p">(</span><span class="s">&quot;KingMax Technology Inc.&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet Card&quot;</span><span class="p">,</span> <span class="mh">0x932b7189</span><span class="p">,</span> <span class="mh">0x5e9d92c0</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID13</span><span class="p">(</span><span class="s">&quot;LONGSHINE&quot;</span><span class="p">,</span> <span class="s">&quot;EP401&quot;</span><span class="p">,</span> <span class="mh">0xf866b0b0</span><span class="p">,</span> <span class="mh">0xf6e4a31e</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID13</span><span class="p">(</span><span class="s">&quot;Xircom&quot;</span><span class="p">,</span> <span class="s">&quot;CFE-10&quot;</span><span class="p">,</span> <span class="mh">0x2e3ee845</span><span class="p">,</span> <span class="mh">0x22a49f89</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1</span><span class="p">(</span><span class="s">&quot;CyQ&#39;ve 10 Base-T LAN CARD&quot;</span><span class="p">,</span> <span class="mh">0x94faf360</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1</span><span class="p">(</span><span class="s">&quot;EP-210 PCMCIA LAN CARD.&quot;</span><span class="p">,</span> <span class="mh">0x8850b4de</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1</span><span class="p">(</span><span class="s">&quot;ETHER-C16&quot;</span><span class="p">,</span> <span class="mh">0x06a8514f</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID1</span><span class="p">(</span><span class="s">&quot;NE2000 Compatible&quot;</span><span class="p">,</span> <span class="mh">0x75b8ad5a</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID2</span><span class="p">(</span><span class="s">&quot;EN-6200P2&quot;</span><span class="p">,</span> <span class="mh">0xa996d078</span><span class="p">),</span>
	<span class="cm">/* too generic! */</span>
	<span class="cm">/* PCMCIA_DEVICE_PROD_ID12(&quot;PCMCIA&quot;, &quot;10/100 Ethernet Card&quot;, 0x281f1c5d, 0x11b0ffc0), */</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;EN2218-LAN/MODEM&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x570f348e</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;PCMCIA&quot;</span><span class="p">,</span> <span class="s">&quot;UE2218-LAN/MODEM&quot;</span><span class="p">,</span> <span class="mh">0x281f1c5d</span><span class="p">,</span> <span class="mh">0x6fdcacee</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Psion Dacom&quot;</span><span class="p">,</span> <span class="s">&quot;Gold Card V34 Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xf5f025c2</span><span class="p">,</span> <span class="mh">0x338e8155</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Psion Dacom&quot;</span><span class="p">,</span> <span class="s">&quot;Gold Card V34 Ethernet GSM&quot;</span><span class="p">,</span> <span class="mh">0xf5f025c2</span><span class="p">,</span> <span class="mh">0x4ae85d35</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;LINKSYS&quot;</span><span class="p">,</span> <span class="s">&quot;PCMLM28&quot;</span><span class="p">,</span> <span class="mh">0xf7cb0b07</span><span class="p">,</span> <span class="mh">0x66881874</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_PFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;TOSHIBA&quot;</span><span class="p">,</span> <span class="s">&quot;Modem/LAN Card&quot;</span><span class="p">,</span> <span class="mh">0xb4585a1a</span><span class="p">,</span> <span class="mh">0x53f922f8</span><span class="p">,</span> <span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;DAYNA COMMUNICATIONS&quot;</span><span class="p">,</span> <span class="s">&quot;LAN AND MODEM MULTIFUNCTION&quot;</span><span class="p">,</span> <span class="mh">0x8fdf8f89</span><span class="p">,</span> <span class="mh">0xdd5ed9e8</span><span class="p">,</span> <span class="s">&quot;cis/DP83903.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_CIS_PROD_ID4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">&quot;NSC MF LAN/Modem&quot;</span><span class="p">,</span> <span class="mh">0x58fc6056</span><span class="p">,</span> <span class="s">&quot;cis/DP83903.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_MFC_DEVICE_CIS_MANF_CARD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x0175</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="s">&quot;cis/DP83903.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Allied Telesis,K.K&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet LAN Card&quot;</span><span class="p">,</span> <span class="mh">0x2ad62f3c</span><span class="p">,</span> <span class="mh">0x9fd2f0a2</span><span class="p">,</span> <span class="s">&quot;cis/LA-PCM.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="s">&quot;KTI&quot;</span><span class="p">,</span> <span class="s">&quot;PE520 PLUS&quot;</span><span class="p">,</span> <span class="mh">0xad180345</span><span class="p">,</span> <span class="mh">0x9d58d392</span><span class="p">,</span> <span class="s">&quot;cis/PE520.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="s">&quot;NDC&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0x01c43ae1</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">,</span> <span class="s">&quot;cis/NE2K.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="s">&quot;PMX   &quot;</span><span class="p">,</span> <span class="s">&quot;PE-200&quot;</span><span class="p">,</span> <span class="mh">0x34f3f1c8</span><span class="p">,</span> <span class="mh">0x10b59f8c</span><span class="p">,</span> <span class="s">&quot;cis/PE-200.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_CIS_PROD_ID12</span><span class="p">(</span><span class="s">&quot;TAMARACK&quot;</span><span class="p">,</span> <span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="mh">0xcf434fba</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">,</span> <span class="s">&quot;cis/tamarack.cis&quot;</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID12</span><span class="p">(</span><span class="s">&quot;Ethernet&quot;</span><span class="p">,</span> <span class="s">&quot;CF Size PC Card&quot;</span><span class="p">,</span> <span class="mh">0x00b2e941</span><span class="p">,</span> <span class="mh">0x43ac239b</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_PROD_ID123</span><span class="p">(</span><span class="s">&quot;Fast Ethernet&quot;</span><span class="p">,</span> <span class="s">&quot;CF Size PC Card&quot;</span><span class="p">,</span> <span class="s">&quot;1.0&quot;</span><span class="p">,</span>
		<span class="mh">0xb4be14e3</span><span class="p">,</span> <span class="mh">0x43ac239b</span><span class="p">,</span> <span class="mh">0x0877b627</span><span class="p">),</span>
	<span class="n">PCMCIA_DEVICE_NULL</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">pcmcia</span><span class="p">,</span> <span class="n">pcnet_ids</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/PCMLM28.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/DP83903.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/LA-PCM.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/PE520.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/NE2K.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/PE-200.cis&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;cis/tamarack.cis&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pcmcia_driver</span> <span class="n">pcnet_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;pcnet_cs&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">pcnet_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">pcnet_detach</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span>	<span class="o">=</span> <span class="n">pcnet_ids</span><span class="p">,</span>
	<span class="p">.</span><span class="n">suspend</span>	<span class="o">=</span> <span class="n">pcnet_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span>		<span class="o">=</span> <span class="n">pcnet_resume</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">init_pcnet_cs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pcmcia_register_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pcnet_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">exit_pcnet_cs</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pcmcia_unregister_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pcnet_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">init_pcnet_cs</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">exit_pcnet_cs</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
