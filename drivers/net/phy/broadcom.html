<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › phy › broadcom.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>broadcom.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	drivers/net/phy/broadcom.c</span>
<span class="cm"> *</span>
<span class="cm"> *	Broadcom BCM5411, BCM5421 and BCM5461 Gigabit Ethernet</span>
<span class="cm"> *	transceivers.</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (c) 2006  Maciej W. Rozycki</span>
<span class="cm"> *</span>
<span class="cm"> *	Inspired by code written by Amy Fong.</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or</span>
<span class="cm"> *	modify it under the terms of the GNU General Public License</span>
<span class="cm"> *	as published by the Free Software Foundation; either version</span>
<span class="cm"> *	2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/phy.h&gt;</span>
<span class="cp">#include &lt;linux/brcmphy.h&gt;</span>


<span class="cp">#define BRCM_PHY_MODEL(phydev) \</span>
<span class="cp">	((phydev)-&gt;drv-&gt;phy_id &amp; (phydev)-&gt;drv-&gt;phy_id_mask)</span>

<span class="cp">#define BRCM_PHY_REV(phydev) \</span>
<span class="cp">	((phydev)-&gt;drv-&gt;phy_id &amp; ~((phydev)-&gt;drv-&gt;phy_id_mask))</span>


<span class="cp">#define MII_BCM54XX_ECR		0x10	</span><span class="cm">/* BCM54xx extended control register */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_ECR_IM	0x1000	</span><span class="cm">/* Interrupt mask */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_ECR_IF	0x0800	</span><span class="cm">/* Interrupt force */</span><span class="cp"></span>

<span class="cp">#define MII_BCM54XX_ESR		0x11	</span><span class="cm">/* BCM54xx extended status register */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_ESR_IS	0x1000	</span><span class="cm">/* Interrupt status */</span><span class="cp"></span>

<span class="cp">#define MII_BCM54XX_EXP_DATA	0x15	</span><span class="cm">/* Expansion register data */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_EXP_SEL	0x17	</span><span class="cm">/* Expansion register select */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_EXP_SEL_SSD	0x0e00	</span><span class="cm">/* Secondary SerDes select */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_EXP_SEL_ER	0x0f00	</span><span class="cm">/* Expansion register select */</span><span class="cp"></span>

<span class="cp">#define MII_BCM54XX_AUX_CTL	0x18	</span><span class="cm">/* Auxiliary control register */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_ISR		0x1a	</span><span class="cm">/* BCM54xx interrupt status register */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_IMR		0x1b	</span><span class="cm">/* BCM54xx interrupt mask register */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_CRCERR	0x0001	</span><span class="cm">/* CRC error */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_LINK	0x0002	</span><span class="cm">/* Link status changed */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_SPEED	0x0004	</span><span class="cm">/* Link speed change */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_DUPLEX	0x0008	</span><span class="cm">/* Duplex mode changed */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_LRS	0x0010	</span><span class="cm">/* Local receiver status changed */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_RRS	0x0020	</span><span class="cm">/* Remote receiver status changed */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_SSERR	0x0040	</span><span class="cm">/* Scrambler synchronization error */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_UHCD	0x0080	</span><span class="cm">/* Unsupported HCD negotiated */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_NHCD	0x0100	</span><span class="cm">/* No HCD */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_NHCDL	0x0200	</span><span class="cm">/* No HCD link */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_ANPR	0x0400	</span><span class="cm">/* Auto-negotiation page received */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_LC	0x0800	</span><span class="cm">/* All counters below 128 */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_HC	0x1000	</span><span class="cm">/* Counter above 32768 */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_MDIX	0x2000	</span><span class="cm">/* MDIX status change */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_INT_PSERR	0x4000	</span><span class="cm">/* Pair swap error */</span><span class="cp"></span>

<span class="cp">#define MII_BCM54XX_SHD		0x1c	</span><span class="cm">/* 0x1c shadow registers */</span><span class="cp"></span>
<span class="cp">#define MII_BCM54XX_SHD_WRITE	0x8000</span>
<span class="cp">#define MII_BCM54XX_SHD_VAL(x)	((x &amp; 0x1f) &lt;&lt; 10)</span>
<span class="cp">#define MII_BCM54XX_SHD_DATA(x)	((x &amp; 0x3ff) &lt;&lt; 0)</span>

<span class="cm">/*</span>
<span class="cm"> * AUXILIARY CONTROL SHADOW ACCESS REGISTERS.  (PHY REG 0x18)</span>
<span class="cm"> */</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_SHDWSEL_AUXCTL	0x0000</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_ACTL_TX_6DB		0x0400</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_ACTL_SMDSP_ENA	0x0800</span>

<span class="cp">#define MII_BCM54XX_AUXCTL_MISC_WREN	0x8000</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_MISC_FORCE_AMDIX	0x0200</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_MISC_RDSEL_MISC	0x7000</span>
<span class="cp">#define MII_BCM54XX_AUXCTL_SHDWSEL_MISC	0x0007</span>

<span class="cp">#define MII_BCM54XX_AUXCTL_SHDWSEL_AUXCTL	0x0000</span>


<span class="cm">/*</span>
<span class="cm"> * Broadcom LED source encodings.  These are used in BCM5461, BCM5481,</span>
<span class="cm"> * BCM5482, and possibly some others.</span>
<span class="cm"> */</span>
<span class="cp">#define BCM_LED_SRC_LINKSPD1	0x0</span>
<span class="cp">#define BCM_LED_SRC_LINKSPD2	0x1</span>
<span class="cp">#define BCM_LED_SRC_XMITLED	0x2</span>
<span class="cp">#define BCM_LED_SRC_ACTIVITYLED	0x3</span>
<span class="cp">#define BCM_LED_SRC_FDXLED	0x4</span>
<span class="cp">#define BCM_LED_SRC_SLAVE	0x5</span>
<span class="cp">#define BCM_LED_SRC_INTR	0x6</span>
<span class="cp">#define BCM_LED_SRC_QUALITY	0x7</span>
<span class="cp">#define BCM_LED_SRC_RCVLED	0x8</span>
<span class="cp">#define BCM_LED_SRC_MULTICOLOR1	0xa</span>
<span class="cp">#define BCM_LED_SRC_OPENSHORT	0xb</span>
<span class="cp">#define BCM_LED_SRC_OFF		0xe	</span><span class="cm">/* Tied high */</span><span class="cp"></span>
<span class="cp">#define BCM_LED_SRC_ON		0xf	</span><span class="cm">/* Tied low */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * BCM5482: Shadow registers</span>
<span class="cm"> * Shadow values go into bits [14:10] of register 0x1c to select a shadow</span>
<span class="cm"> * register to access.</span>
<span class="cm"> */</span>
<span class="cm">/* 00101: Spare Control Register 3 */</span>
<span class="cp">#define BCM54XX_SHD_SCR3		0x05</span>
<span class="cp">#define  BCM54XX_SHD_SCR3_DEF_CLK125	0x0001</span>
<span class="cp">#define  BCM54XX_SHD_SCR3_DLLAPD_DIS	0x0002</span>
<span class="cp">#define  BCM54XX_SHD_SCR3_TRDDAPD	0x0004</span>

<span class="cm">/* 01010: Auto Power-Down */</span>
<span class="cp">#define BCM54XX_SHD_APD			0x0a</span>
<span class="cp">#define  BCM54XX_SHD_APD_EN		0x0020</span>

<span class="cp">#define BCM5482_SHD_LEDS1	0x0d	</span><span class="cm">/* 01101: LED Selector 1 */</span><span class="cp"></span>
					<span class="cm">/* LED3 / ~LINKSPD[2] selector */</span>
<span class="cp">#define BCM5482_SHD_LEDS1_LED3(src)	((src &amp; 0xf) &lt;&lt; 4)</span>
					<span class="cm">/* LED1 / ~LINKSPD[1] selector */</span>
<span class="cp">#define BCM5482_SHD_LEDS1_LED1(src)	((src &amp; 0xf) &lt;&lt; 0)</span>
<span class="cp">#define BCM54XX_SHD_RGMII_MODE	0x0b	</span><span class="cm">/* 01011: RGMII Mode Selector */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SHD_SSD		0x14	</span><span class="cm">/* 10100: Secondary SerDes control */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SHD_SSD_LEDM	0x0008	</span><span class="cm">/* SSD LED Mode enable */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SHD_SSD_EN	0x0001	</span><span class="cm">/* SSD enable */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SHD_MODE	0x1f	</span><span class="cm">/* 11111: Mode Control Register */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SHD_MODE_1000BX	0x0001	</span><span class="cm">/* Enable 1000BASE-X registers */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * EXPANSION SHADOW ACCESS REGISTERS.  (PHY REG 0x15, 0x16, and 0x17)</span>
<span class="cm"> */</span>
<span class="cp">#define MII_BCM54XX_EXP_AADJ1CH0		0x001f</span>
<span class="cp">#define  MII_BCM54XX_EXP_AADJ1CH0_SWP_ABCD_OEN	0x0200</span>
<span class="cp">#define  MII_BCM54XX_EXP_AADJ1CH0_SWSEL_THPF	0x0100</span>
<span class="cp">#define MII_BCM54XX_EXP_AADJ1CH3		0x601f</span>
<span class="cp">#define  MII_BCM54XX_EXP_AADJ1CH3_ADCCKADJ	0x0002</span>
<span class="cp">#define MII_BCM54XX_EXP_EXP08			0x0F08</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP08_RJCT_2MHZ	0x0001</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP08_EARLY_DAC_WAKE	0x0200</span>
<span class="cp">#define MII_BCM54XX_EXP_EXP75			0x0f75</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP75_VDACCTRL		0x003c</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP75_CM_OSC		0x0001</span>
<span class="cp">#define MII_BCM54XX_EXP_EXP96			0x0f96</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP96_MYST		0x0010</span>
<span class="cp">#define MII_BCM54XX_EXP_EXP97			0x0f97</span>
<span class="cp">#define  MII_BCM54XX_EXP_EXP97_MYST		0x0c0c</span>

<span class="cm">/*</span>
<span class="cm"> * BCM5482: Secondary SerDes registers</span>
<span class="cm"> */</span>
<span class="cp">#define BCM5482_SSD_1000BX_CTL		0x00	</span><span class="cm">/* 1000BASE-X Control */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SSD_1000BX_CTL_PWRDOWN	0x0800	</span><span class="cm">/* Power-down SSD */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SSD_SGMII_SLAVE		0x15	</span><span class="cm">/* SGMII Slave Register */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SSD_SGMII_SLAVE_EN	0x0002	</span><span class="cm">/* Slave mode enable */</span><span class="cp"></span>
<span class="cp">#define BCM5482_SSD_SGMII_SLAVE_AD	0x0001	</span><span class="cm">/* Slave auto-detection */</span><span class="cp"></span>


<span class="cm">/*****************************************************************************/</span>
<span class="cm">/* Fast Ethernet Transceiver definitions. */</span>
<span class="cm">/*****************************************************************************/</span>

<span class="cp">#define MII_BRCM_FET_INTREG		0x1a	</span><span class="cm">/* Interrupt register */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_IR_MASK		0x0100	</span><span class="cm">/* Mask all interrupts */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_IR_LINK_EN		0x0200	</span><span class="cm">/* Link status change enable */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_IR_SPEED_EN	0x0400	</span><span class="cm">/* Link speed change enable */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_IR_DUPLEX_EN	0x0800	</span><span class="cm">/* Duplex mode change enable */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_IR_ENABLE		0x4000	</span><span class="cm">/* Interrupt enable */</span><span class="cp"></span>

<span class="cp">#define MII_BRCM_FET_BRCMTEST		0x1f	</span><span class="cm">/* Brcm test register */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_BT_SRE		0x0080	</span><span class="cm">/* Shadow register enable */</span><span class="cp"></span>


<span class="cm">/*** Shadow register definitions ***/</span>

<span class="cp">#define MII_BRCM_FET_SHDW_MISCCTRL	0x10	</span><span class="cm">/* Shadow misc ctrl */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_SHDW_MC_FAME	0x4000	</span><span class="cm">/* Force Auto MDIX enable */</span><span class="cp"></span>

<span class="cp">#define MII_BRCM_FET_SHDW_AUXMODE4	0x1a	</span><span class="cm">/* Auxiliary mode 4 */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_SHDW_AM4_LED_MASK	0x0003</span>
<span class="cp">#define MII_BRCM_FET_SHDW_AM4_LED_MODE1 0x0001</span>

<span class="cp">#define MII_BRCM_FET_SHDW_AUXSTAT2	0x1b	</span><span class="cm">/* Auxiliary status 2 */</span><span class="cp"></span>
<span class="cp">#define MII_BRCM_FET_SHDW_AS2_APDE	0x0020	</span><span class="cm">/* Auto power down enable */</span><span class="cp"></span>


<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Broadcom PHY driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Maciej W. Rozycki&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Indirect register access functions for the 1000BASE-T/100BASE-TX/10BASE-T</span>
<span class="cm"> * 0x1c shadow registers.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_shadow_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">shadow</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_SHD</span><span class="p">,</span> <span class="n">MII_BCM54XX_SHD_VAL</span><span class="p">(</span><span class="n">shadow</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">MII_BCM54XX_SHD_DATA</span><span class="p">(</span><span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_SHD</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_shadow_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">shadow</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_SHD</span><span class="p">,</span>
			 <span class="n">MII_BCM54XX_SHD_WRITE</span> <span class="o">|</span>
			 <span class="n">MII_BCM54XX_SHD_VAL</span><span class="p">(</span><span class="n">shadow</span><span class="p">)</span> <span class="o">|</span>
			 <span class="n">MII_BCM54XX_SHD_DATA</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* Indirect register access functions for the Expansion Registers */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_exp_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">regnum</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_SEL</span><span class="p">,</span> <span class="n">regnum</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_DATA</span><span class="p">);</span>

	<span class="cm">/* Restore default value.  It&#39;s O.K. if this write fails. */</span>
	<span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_exp_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">regnum</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_SEL</span><span class="p">,</span> <span class="n">regnum</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_DATA</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="cm">/* Restore default value.  It&#39;s O.K. if this write fails. */</span>
	<span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_auxctl_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">regnum</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_AUX_CTL</span><span class="p">,</span> <span class="n">regnum</span> <span class="o">|</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Needs SMDSP clock enabled via bcm54xx_phydsp_config() */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm50610_a0_workaround</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_AADJ1CH0</span><span class="p">,</span>
				<span class="n">MII_BCM54XX_EXP_AADJ1CH0_SWP_ABCD_OEN</span> <span class="o">|</span>
				<span class="n">MII_BCM54XX_EXP_AADJ1CH0_SWSEL_THPF</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_AADJ1CH3</span><span class="p">,</span>
					<span class="n">MII_BCM54XX_EXP_AADJ1CH3_ADCCKADJ</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP75</span><span class="p">,</span>
				<span class="n">MII_BCM54XX_EXP_EXP75_VDACCTRL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP96</span><span class="p">,</span>
				<span class="n">MII_BCM54XX_EXP_EXP96_MYST</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP97</span><span class="p">,</span>
				<span class="n">MII_BCM54XX_EXP_EXP97_MYST</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_phydsp_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">err2</span><span class="p">;</span>

	<span class="cm">/* Enable the SMDSP clock */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_auxctl_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span>
				   <span class="n">MII_BCM54XX_AUXCTL_SHDWSEL_AUXCTL</span><span class="p">,</span>
				   <span class="n">MII_BCM54XX_AUXCTL_ACTL_SMDSP_ENA</span> <span class="o">|</span>
				   <span class="n">MII_BCM54XX_AUXCTL_ACTL_TX_6DB</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610</span> <span class="o">||</span>
	    <span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Clear bit 9 to fix a phy interop issue. */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP08</span><span class="p">,</span>
					<span class="n">MII_BCM54XX_EXP_EXP08_RJCT_2MHZ</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">drv</span><span class="o">-&gt;</span><span class="n">phy_id</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">bcm50610_a0_workaround</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM57780</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">=</span> <span class="n">bcm54xx_exp_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP75</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">|=</span> <span class="n">MII_BCM54XX_EXP_EXP75_CM_OSC</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_EXP_EXP75</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">error:</span>
	<span class="cm">/* Disable the SMDSP clock */</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">bcm54xx_auxctl_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span>
				    <span class="n">MII_BCM54XX_AUXCTL_SHDWSEL_AUXCTL</span><span class="p">,</span>
				    <span class="n">MII_BCM54XX_AUXCTL_ACTL_TX_6DB</span><span class="p">);</span>

	<span class="cm">/* Return the first error reported. */</span>
	<span class="k">return</span> <span class="n">err</span> <span class="o">?</span> <span class="n">err</span> <span class="o">:</span> <span class="n">err2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bcm54xx_adjust_rxrefclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">orig</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">clk125en</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="cm">/* Abort if we are using an untested phy. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PHY_ID_BCM57780</span> <span class="o">&amp;&amp;</span>
	    <span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PHY_ID_BCM50610</span> <span class="o">&amp;&amp;</span>
	    <span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">!=</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">bcm54xx_shadow_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM54XX_SHD_SCR3</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">orig</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610</span> <span class="o">||</span>
	     <span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">BRCM_PHY_REV</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mh">0x3</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Here, bit 0 _disables_ CLK125 when set.</span>
<span class="cm">		 * This bit is set by default.</span>
<span class="cm">		 */</span>
		<span class="n">clk125en</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_RX_REFCLK_UNUSED</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Here, bit 0 _enables_ CLK125 when set */</span>
			<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BCM54XX_SHD_SCR3_DEF_CLK125</span><span class="p">;</span>
			<span class="n">clk125en</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk125en</span> <span class="o">||</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_AUTO_PWRDWN_ENABLE</span><span class="p">))</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BCM54XX_SHD_SCR3_DLLAPD_DIS</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">BCM54XX_SHD_SCR3_DLLAPD_DIS</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_DIS_TXCRXC_NOENRGY</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">BCM54XX_SHD_SCR3_TRDDAPD</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">orig</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM54XX_SHD_SCR3</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">bcm54xx_shadow_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM54XX_SHD_APD</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">orig</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">clk125en</span> <span class="o">||</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_AUTO_PWRDWN_ENABLE</span><span class="p">))</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">BCM54XX_SHD_APD_EN</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">BCM54XX_SHD_APD_EN</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">orig</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM54XX_SHD_APD</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_config_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_ECR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="cm">/* Mask interrupts globally.  */</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">MII_BCM54XX_ECR_IM</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_ECR</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* Unmask events we are interested in.  */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">MII_BCM54XX_INT_DUPLEX</span> <span class="o">|</span>
		<span class="n">MII_BCM54XX_INT_SPEED</span> <span class="o">|</span>
		<span class="n">MII_BCM54XX_INT_LINK</span><span class="p">);</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_IMR</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610</span> <span class="o">||</span>
	     <span class="n">BRCM_PHY_MODEL</span><span class="p">(</span><span class="n">phydev</span><span class="p">)</span> <span class="o">==</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_CLEAR_RGMII_MODE</span><span class="p">))</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM54XX_SHD_RGMII_MODE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_RX_REFCLK_UNUSED</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_DIS_TXCRXC_NOENRGY</span><span class="p">)</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_AUTO_PWRDWN_ENABLE</span><span class="p">))</span>
		<span class="n">bcm54xx_adjust_rxrefclk</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>

	<span class="n">bcm54xx_phydsp_config</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm5482_config_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BCM_FLAGS_MODE_1000BX</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Enable secondary SerDes and its use as an LED source</span>
<span class="cm">		 */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">bcm54xx_shadow_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM5482_SHD_SSD</span><span class="p">);</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM5482_SHD_SSD</span><span class="p">,</span>
				     <span class="n">reg</span> <span class="o">|</span>
				     <span class="n">BCM5482_SHD_SSD_LEDM</span> <span class="o">|</span>
				     <span class="n">BCM5482_SHD_SSD_EN</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * Enable SGMII slave mode and auto-detection</span>
<span class="cm">		 */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">BCM5482_SSD_SGMII_SLAVE</span> <span class="o">|</span> <span class="n">MII_BCM54XX_EXP_SEL_SSD</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">err</span> <span class="o">|</span>
					<span class="n">BCM5482_SSD_SGMII_SLAVE_EN</span> <span class="o">|</span>
					<span class="n">BCM5482_SSD_SGMII_SLAVE_AD</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Disable secondary SerDes powerdown</span>
<span class="cm">		 */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">BCM5482_SSD_1000BX_CTL</span> <span class="o">|</span> <span class="n">MII_BCM54XX_EXP_SEL_SSD</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">bcm54xx_exp_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span>
					<span class="n">err</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">BCM5482_SSD_1000BX_CTL_PWRDOWN</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Select 1000BASE-X register set (primary SerDes)</span>
<span class="cm">		 */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">bcm54xx_shadow_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM5482_SHD_MODE</span><span class="p">);</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM5482_SHD_MODE</span><span class="p">,</span>
				     <span class="n">reg</span> <span class="o">|</span> <span class="n">BCM5482_SHD_MODE_1000BX</span><span class="p">);</span>

		<span class="cm">/*</span>
<span class="cm">		 * LED1=ACTIVITYLED, LED3=LINKSPD[2]</span>
<span class="cm">		 * (Use LED1 as secondary SerDes ACTIVITY LED)</span>
<span class="cm">		 */</span>
		<span class="n">bcm54xx_shadow_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">BCM5482_SHD_LEDS1</span><span class="p">,</span>
			<span class="n">BCM5482_SHD_LEDS1_LED1</span><span class="p">(</span><span class="n">BCM_LED_SRC_ACTIVITYLED</span><span class="p">)</span> <span class="o">|</span>
			<span class="n">BCM5482_SHD_LEDS1_LED3</span><span class="p">(</span><span class="n">BCM_LED_SRC_LINKSPD2</span><span class="p">));</span>

		<span class="cm">/*</span>
<span class="cm">		 * Auto-negotiation doesn&#39;t seem to work quite right</span>
<span class="cm">		 * in this mode, so we disable it and force it to the</span>
<span class="cm">		 * right speed/duplex setting.  Only &#39;link status&#39;</span>
<span class="cm">		 * is important.</span>
<span class="cm">		 */</span>
		<span class="n">phydev</span><span class="o">-&gt;</span><span class="n">autoneg</span> <span class="o">=</span> <span class="n">AUTONEG_DISABLE</span><span class="p">;</span>
		<span class="n">phydev</span><span class="o">-&gt;</span><span class="n">speed</span> <span class="o">=</span> <span class="n">SPEED_1000</span><span class="p">;</span>
		<span class="n">phydev</span><span class="o">-&gt;</span><span class="n">duplex</span> <span class="o">=</span> <span class="n">DUPLEX_FULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm5482_read_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BCM_FLAGS_MODE_1000BX</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Only link status matters for 1000Base-X mode, so force</span>
<span class="cm">		 * 1000 Mbit/s full-duplex status</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">link</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">phydev</span><span class="o">-&gt;</span><span class="n">speed</span> <span class="o">=</span> <span class="n">SPEED_1000</span><span class="p">;</span>
			<span class="n">phydev</span><span class="o">-&gt;</span><span class="n">duplex</span> <span class="o">=</span> <span class="n">DUPLEX_FULL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_ack_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="cm">/* Clear pending interrupts.  */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_ISR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm54xx_config_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_ECR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">interrupts</span> <span class="o">==</span> <span class="n">PHY_INTERRUPT_ENABLED</span><span class="p">)</span>
		<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MII_BCM54XX_ECR_IM</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">reg</span> <span class="o">|=</span> <span class="n">MII_BCM54XX_ECR_IM</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BCM54XX_ECR</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bcm5481_config_aneg</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* Aneg firsly. */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">(</span><span class="n">phydev</span><span class="p">);</span>

	<span class="cm">/* Then we can set up the delay. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">interface</span> <span class="o">==</span> <span class="n">PHY_INTERFACE_MODE_RGMII_RXID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * There is no BCM5481 specification available, so down</span>
<span class="cm">		 * here is everything we know about &quot;register 0x18&quot;. This</span>
<span class="cm">		 * at least helps BCM5481 to successfully receive packets</span>
<span class="cm">		 * on MPC8360E-RDK board. Peter Barada &lt;peterb@logicpd.com&gt;</span>
<span class="cm">		 * says: &quot;This sets delay between the RXD and RXC signals</span>
<span class="cm">		 * instead of using trace lengths to achieve timing&quot;.</span>
<span class="cm">		 */</span>

		<span class="cm">/* Set RDX clk delay. */</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="mh">0x7</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
		<span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

		<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
		<span class="cm">/* Set RDX-RXC skew. */</span>
		<span class="n">reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="cm">/* Write bits 14:0. */</span>
		<span class="n">reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>
		<span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">brcm_phy_setbits</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">set</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span> <span class="o">|</span> <span class="n">set</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">brcm_fet_config_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">err2</span><span class="p">,</span> <span class="n">brcmtest</span><span class="p">;</span>

	<span class="cm">/* Reset the PHY to bring it to a known state. */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BMCR</span><span class="p">,</span> <span class="n">BMCR_RESET</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_INTREG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="cm">/* Unmask events we are interested in and mask interrupts globally. */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">MII_BRCM_FET_IR_DUPLEX_EN</span> <span class="o">|</span>
	      <span class="n">MII_BRCM_FET_IR_SPEED_EN</span> <span class="o">|</span>
	      <span class="n">MII_BRCM_FET_IR_LINK_EN</span> <span class="o">|</span>
	      <span class="n">MII_BRCM_FET_IR_ENABLE</span> <span class="o">|</span>
	      <span class="n">MII_BRCM_FET_IR_MASK</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_INTREG</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* Enable shadow register access */</span>
	<span class="n">brcmtest</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_BRCMTEST</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">brcmtest</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">brcmtest</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">brcmtest</span> <span class="o">|</span> <span class="n">MII_BRCM_FET_BT_SRE</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_BRCMTEST</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* Set the LED mode */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_SHDW_AUXMODE4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">reg</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MII_BRCM_FET_SHDW_AM4_LED_MASK</span><span class="p">;</span>
	<span class="n">reg</span> <span class="o">|=</span> <span class="n">MII_BRCM_FET_SHDW_AM4_LED_MODE1</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_SHDW_AUXMODE4</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>

	<span class="cm">/* Enable auto MDIX */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">brcm_phy_setbits</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_SHDW_MISCCTRL</span><span class="p">,</span>
				       <span class="n">MII_BRCM_FET_SHDW_MC_FAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">dev_flags</span> <span class="o">&amp;</span> <span class="n">PHY_BRCM_AUTO_PWRDWN_ENABLE</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Enable auto power down */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">brcm_phy_setbits</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_SHDW_AUXSTAT2</span><span class="p">,</span>
					       <span class="n">MII_BRCM_FET_SHDW_AS2_APDE</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">done:</span>
	<span class="cm">/* Disable shadow register access */</span>
	<span class="n">err2</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_BRCMTEST</span><span class="p">,</span> <span class="n">brcmtest</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">err</span><span class="p">)</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">err2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">brcm_fet_ack_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="cm">/* Clear pending interrupts.  */</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_INTREG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">brcm_fet_config_intr</span><span class="p">(</span><span class="k">struct</span> <span class="n">phy_device</span> <span class="o">*</span><span class="n">phydev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">phy_read</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_INTREG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">reg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phydev</span><span class="o">-&gt;</span><span class="n">interrupts</span> <span class="o">==</span> <span class="n">PHY_INTERRUPT_ENABLED</span><span class="p">)</span>
		<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MII_BRCM_FET_IR_MASK</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">reg</span> <span class="o">|=</span> <span class="n">MII_BRCM_FET_IR_MASK</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">phy_write</span><span class="p">(</span><span class="n">phydev</span><span class="p">,</span> <span class="n">MII_BRCM_FET_INTREG</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5411_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5411</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5411&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5421_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5421</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5421&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5461_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5461</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5461&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5464_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5464</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5464&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5481_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5481</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5481&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">bcm5481_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5482_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5482</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5482&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm5482_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">bcm5482_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm50610_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM50610</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM50610&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm50610m_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM50610M&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm57780_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM57780</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM57780&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_GBIT_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">bcm54xx_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">bcm54xx_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">bcm54xx_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcmac131_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCMAC131</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCMAC131&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_BASIC_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">brcm_fet_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">brcm_fet_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">brcm_fet_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">phy_driver</span> <span class="n">bcm5241_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">phy_id</span>		<span class="o">=</span> <span class="n">PHY_ID_BCM5241</span><span class="p">,</span>
	<span class="p">.</span><span class="n">phy_id_mask</span>	<span class="o">=</span> <span class="mh">0xfffffff0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;Broadcom BCM5241&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">features</span>	<span class="o">=</span> <span class="n">PHY_BASIC_FEATURES</span> <span class="o">|</span>
			  <span class="n">SUPPORTED_Pause</span> <span class="o">|</span> <span class="n">SUPPORTED_Asym_Pause</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>		<span class="o">=</span> <span class="n">PHY_HAS_MAGICANEG</span> <span class="o">|</span> <span class="n">PHY_HAS_INTERRUPT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_init</span>	<span class="o">=</span> <span class="n">brcm_fet_config_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_aneg</span>	<span class="o">=</span> <span class="n">genphy_config_aneg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>	<span class="o">=</span> <span class="n">genphy_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_interrupt</span>	<span class="o">=</span> <span class="n">brcm_fet_ack_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">config_intr</span>	<span class="o">=</span> <span class="n">brcm_fet_config_intr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">broadcom_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5411_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5411</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5421_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5421</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5461_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5461</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5464_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5464</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5481_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5481</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5482_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5482</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_50610</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610m_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_50610m</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm57780_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_57780</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcmac131_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_ac131</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">phy_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5241_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_5241</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="nl">out_5241:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcmac131_driver</span><span class="p">);</span>
<span class="nl">out_ac131:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm57780_driver</span><span class="p">);</span>
<span class="nl">out_57780:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610m_driver</span><span class="p">);</span>
<span class="nl">out_50610m:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610_driver</span><span class="p">);</span>
<span class="nl">out_50610:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5482_driver</span><span class="p">);</span>
<span class="nl">out_5482:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5481_driver</span><span class="p">);</span>
<span class="nl">out_5481:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5464_driver</span><span class="p">);</span>
<span class="nl">out_5464:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5461_driver</span><span class="p">);</span>
<span class="nl">out_5461:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5421_driver</span><span class="p">);</span>
<span class="nl">out_5421:</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5411_driver</span><span class="p">);</span>
<span class="nl">out_5411:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">broadcom_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5241_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcmac131_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm57780_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610m_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm50610_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5482_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5481_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5464_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5461_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5421_driver</span><span class="p">);</span>
	<span class="n">phy_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bcm5411_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">broadcom_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">broadcom_exit</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mdio_device_id</span> <span class="n">__maybe_unused</span> <span class="n">broadcom_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5411</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5421</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5461</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5464</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5482</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5482</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM50610</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM50610M</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM57780</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCMAC131</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">PHY_ID_BCM5241</span><span class="p">,</span> <span class="mh">0xfffffff0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">mdio</span><span class="p">,</span> <span class="n">broadcom_tbl</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
