<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wimax › i2400m › i2400m-sdio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>i2400m-sdio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Intel Wireless WiMAX Connection 2400m</span>
<span class="cm"> * SDIO-specific i2400m driver definitions</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2007-2008 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> *</span>
<span class="cm"> *   * Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *   * Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in</span>
<span class="cm"> *     the documentation and/or other materials provided with the</span>
<span class="cm"> *     distribution.</span>
<span class="cm"> *   * Neither the name of Intel Corporation nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="cm"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<span class="cm"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="cm"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="cm"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="cm"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="cm"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="cm"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="cm"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="cm"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * Intel Corporation &lt;linux-wimax@intel.com&gt;</span>
<span class="cm"> * Brian Bian &lt;brian.bian@intel.com&gt;</span>
<span class="cm"> * Dirk Brandewie &lt;dirk.j.brandewie@intel.com&gt;</span>
<span class="cm"> * Inaky Perez-Gonzalez &lt;inaky.perez-gonzalez@intel.com&gt;</span>
<span class="cm"> * Yanir Lubetkin &lt;yanirx.lubetkin@intel.com&gt;</span>
<span class="cm"> *  - Initial implementation</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * This driver implements the bus-specific part of the i2400m for</span>
<span class="cm"> * SDIO. Check i2400m.h for a generic driver description.</span>
<span class="cm"> *</span>
<span class="cm"> * ARCHITECTURE</span>
<span class="cm"> *</span>
<span class="cm"> * This driver sits under the bus-generic i2400m driver, providing the</span>
<span class="cm"> * connection to the device.</span>
<span class="cm"> *</span>
<span class="cm"> * When probed, all the function pointers are setup and then the</span>
<span class="cm"> * bus-generic code called. The generic driver will then use the</span>
<span class="cm"> * provided pointers for uploading firmware (i2400ms_bus_bm*() in</span>
<span class="cm"> * sdio-fw.c) and then setting up the device (i2400ms_dev_*() in</span>
<span class="cm"> * sdio.c).</span>
<span class="cm"> *</span>
<span class="cm"> * Once firmware is uploaded, TX functions (sdio-tx.c) are called when</span>
<span class="cm"> * data is ready for transmission in the TX fifo; then the SDIO IRQ is</span>
<span class="cm"> * fired and data is available (sdio-rx.c), it is sent to the generic</span>
<span class="cm"> * driver for processing with i2400m_rx.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __I2400M_SDIO_H__</span>
<span class="cp">#define __I2400M_SDIO_H__</span>

<span class="cp">#include &quot;i2400m.h&quot;</span>

<span class="cm">/* Host-Device interface for SDIO */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">I2400M_SDIO_BOOT_RETRIES</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">I2400MS_BLK_SIZE</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
	<span class="n">I2400MS_PL_SIZE_MAX</span> <span class="o">=</span> <span class="mh">0x3E00</span><span class="p">,</span>

	<span class="n">I2400MS_DATA_ADDR</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">I2400MS_INTR_STATUS_ADDR</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">I2400MS_INTR_CLEAR_ADDR</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">I2400MS_INTR_ENABLE_ADDR</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">I2400MS_INTR_GET_SIZE_ADDR</span> <span class="o">=</span> <span class="mh">0x2C</span><span class="p">,</span>
	<span class="cm">/* The number of ticks to wait for the device to signal that</span>
<span class="cm">	 * it is ready */</span>
	<span class="n">I2400MS_INIT_SLEEP_INTERVAL</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
	<span class="cm">/* How long to wait for the device to settle after reset */</span>
	<span class="n">I2400MS_SETTLE_TIME</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="cm">/* The number of msec to wait for IOR after sending IOE */</span>
	<span class="n">IWMC3200_IOR_TIMEOUT</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/**</span>
<span class="cm"> * struct i2400ms - descriptor for a SDIO connected i2400m</span>
<span class="cm"> *</span>
<span class="cm"> * @i2400m: bus-generic i2400m implementation; has to be first (see</span>
<span class="cm"> *     it&#39;s documentation in i2400m.h).</span>
<span class="cm"> *</span>
<span class="cm"> * @func: pointer to our SDIO function</span>
<span class="cm"> *</span>
<span class="cm"> * @tx_worker: workqueue struct used to TX data when the bus-generic</span>
<span class="cm"> *     code signals packets are pending for transmission to the device.</span>
<span class="cm"> *</span>
<span class="cm"> * @tx_workqueue: workqeueue used for data TX; we don&#39;t use the</span>
<span class="cm"> *     system&#39;s workqueue as that might cause deadlocks with code in</span>
<span class="cm"> *     the bus-generic driver. The read/write operation to the queue</span>
<span class="cm"> *     is protected with spinlock (tx_lock in struct i2400m) to avoid</span>
<span class="cm"> *     the queue being destroyed in the middle of a the queue read/write</span>
<span class="cm"> *     operation.</span>
<span class="cm"> *</span>
<span class="cm"> * @debugfs_dentry: dentry for the SDIO specific debugfs files</span>
<span class="cm"> *</span>
<span class="cm"> *     Note this value is set to NULL upon destruction; this is</span>
<span class="cm"> *     because some routinges use it to determine if we are inside the</span>
<span class="cm"> *     probe() path or some other path. When debugfs is disabled,</span>
<span class="cm"> *     creation sets the dentry to &#39;(void*) -ENODEV&#39;, which is valid</span>
<span class="cm"> *     for the test.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">i2400ms</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2400m</span> <span class="n">i2400m</span><span class="p">;</span>		<span class="cm">/* FIRST! See doc */</span>
	<span class="k">struct</span> <span class="n">sdio_func</span> <span class="o">*</span><span class="n">func</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tx_worker</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">tx_workqueue</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">tx_wq_name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debugfs_dentry</span><span class="p">;</span>

	<span class="n">wait_queue_head_t</span> <span class="n">bm_wfa_wq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bm_wait_result</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">bm_ack_size</span><span class="p">;</span>

	<span class="cm">/* Device is any of the iwmc3200 SKUs */</span>
	<span class="kt">unsigned</span> <span class="n">iwmc3200</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">i2400ms_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400ms</span> <span class="o">*</span><span class="n">i2400ms</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i2400m_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2400ms</span><span class="o">-&gt;</span><span class="n">i2400m</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">extern</span> <span class="kt">int</span> <span class="n">i2400ms_rx_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400ms</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i2400ms_rx_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400ms</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">i2400ms_tx_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400ms</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i2400ms_tx_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400ms</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i2400ms_bus_tx_kick</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400m</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">i2400ms_bus_bm_cmd_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400m</span> <span class="o">*</span><span class="p">,</span>
				       <span class="k">const</span> <span class="k">struct</span> <span class="n">i2400m_bootrom_header</span> <span class="o">*</span><span class="p">,</span>
				       <span class="kt">size_t</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">i2400ms_bus_bm_wait_for_ack</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400m</span> <span class="o">*</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">i2400m_bootrom_header</span> <span class="o">*</span><span class="p">,</span>
					   <span class="kt">size_t</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">i2400ms_bus_bm_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400m</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">i2400ms_bus_bm_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2400m</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* #ifndef __I2400M_SDIO_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
