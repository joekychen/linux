<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › vmxnet3 › vmxnet3_defs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>vmxnet3_defs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Linux driver for VMware&#39;s vmxnet3 ethernet NIC.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008-2009, VMware, Inc. All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of the GNU General Public License as published by the</span>
<span class="cm"> * Free Software Foundation; version 2 of the License and no later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE, GOOD TITLE or</span>
<span class="cm"> * NON INFRINGEMENT.  See the GNU General Public License for more</span>
<span class="cm"> * details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in</span>
<span class="cm"> * the file called &quot;COPYING&quot;.</span>
<span class="cm"> *</span>
<span class="cm"> * Maintained by: Shreyas Bhatewara &lt;pv-drivers@vmware.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _VMXNET3_DEFS_H_</span>
<span class="cp">#define _VMXNET3_DEFS_H_</span>

<span class="cp">#include &quot;upt1_defs.h&quot;</span>

<span class="cm">/* all registers are 32 bit wide */</span>
<span class="cm">/* BAR 1 */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_REG_VRRS</span>	<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>	<span class="cm">/* Vmxnet3 Revision Report Selection */</span>
	<span class="n">VMXNET3_REG_UVRS</span>	<span class="o">=</span> <span class="mh">0x8</span><span class="p">,</span>	<span class="cm">/* UPT Version Report Selection */</span>
	<span class="n">VMXNET3_REG_DSAL</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>	<span class="cm">/* Driver Shared Address Low */</span>
	<span class="n">VMXNET3_REG_DSAH</span>	<span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>	<span class="cm">/* Driver Shared Address High */</span>
	<span class="n">VMXNET3_REG_CMD</span>		<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>	<span class="cm">/* Command */</span>
	<span class="n">VMXNET3_REG_MACL</span>	<span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>	<span class="cm">/* MAC Address Low */</span>
	<span class="n">VMXNET3_REG_MACH</span>	<span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>	<span class="cm">/* MAC Address High */</span>
	<span class="n">VMXNET3_REG_ICR</span>		<span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>	<span class="cm">/* Interrupt Cause Register */</span>
	<span class="n">VMXNET3_REG_ECR</span>		<span class="o">=</span> <span class="mh">0x40</span>	<span class="cm">/* Event Cause Register */</span>
<span class="p">};</span>

<span class="cm">/* BAR 0 */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_REG_IMR</span>		<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>	 <span class="cm">/* Interrupt Mask Register */</span>
	<span class="n">VMXNET3_REG_TXPROD</span>	<span class="o">=</span> <span class="mh">0x600</span><span class="p">,</span> <span class="cm">/* Tx Producer Index */</span>
	<span class="n">VMXNET3_REG_RXPROD</span>	<span class="o">=</span> <span class="mh">0x800</span><span class="p">,</span> <span class="cm">/* Rx Producer Index for ring 1 */</span>
	<span class="n">VMXNET3_REG_RXPROD2</span>	<span class="o">=</span> <span class="mh">0xA00</span>	 <span class="cm">/* Rx Producer Index for ring 2 */</span>
<span class="p">};</span>

<span class="cp">#define VMXNET3_PT_REG_SIZE     4096	</span><span class="cm">/* BAR 0 */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_VD_REG_SIZE     4096	</span><span class="cm">/* BAR 1 */</span><span class="cp"></span>

<span class="cp">#define VMXNET3_REG_ALIGN       8	</span><span class="cm">/* All registers are 8-byte aligned. */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_REG_ALIGN_MASK  0x7</span>

<span class="cm">/* I/O Mapped access to registers */</span>
<span class="cp">#define VMXNET3_IO_TYPE_PT              0</span>
<span class="cp">#define VMXNET3_IO_TYPE_VD              1</span>
<span class="cp">#define VMXNET3_IO_ADDR(type, reg)      (((type) &lt;&lt; 24) | ((reg) &amp; 0xFFFFFF))</span>
<span class="cp">#define VMXNET3_IO_TYPE(addr)           ((addr) &gt;&gt; 24)</span>
<span class="cp">#define VMXNET3_IO_REG(addr)            ((addr) &amp; 0xFFFFFF)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_CMD_FIRST_SET</span> <span class="o">=</span> <span class="mh">0xCAFE0000</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_ACTIVATE_DEV</span> <span class="o">=</span> <span class="n">VMXNET3_CMD_FIRST_SET</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_QUIESCE_DEV</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_RESET_DEV</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_RX_MODE</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_MAC_FILTERS</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_VLAN_FILTERS</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_RSSIDT</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_IML</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_PMCFG</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_UPDATE_FEATURE</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_LOAD_PLUGIN</span><span class="p">,</span>

	<span class="n">VMXNET3_CMD_FIRST_GET</span> <span class="o">=</span> <span class="mh">0xF00D0000</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_QUEUE_STATUS</span> <span class="o">=</span> <span class="n">VMXNET3_CMD_FIRST_GET</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_STATS</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_LINK</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_PERM_MAC_LO</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_PERM_MAC_HI</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_DID_LO</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_DID_HI</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_DEV_EXTRA_INFO</span><span class="p">,</span>
	<span class="n">VMXNET3_CMD_GET_CONF_INTR</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Little Endian layout of bitfields -</span>
<span class="cm"> *	Byte 0 :	7.....len.....0</span>
<span class="cm"> *	Byte 1 :	rsvd gen 13.len.8</span>
<span class="cm"> *	Byte 2 : 	5.msscof.0 ext1  dtype</span>
<span class="cm"> *	Byte 3 : 	13...msscof...6</span>
<span class="cm"> *</span>
<span class="cm"> *	Big Endian layout of bitfields -</span>
<span class="cm"> *	Byte 0:		13...msscof...6</span>
<span class="cm"> *	Byte 1 : 	5.msscof.0 ext1  dtype</span>
<span class="cm"> *	Byte 2 :	rsvd gen 13.len.8</span>
<span class="cm"> *	Byte 3 :	7.....len.....0</span>
<span class="cm"> *</span>
<span class="cm"> *	Thus, le32_to_cpu on the dword will allow the big endian driver to read</span>
<span class="cm"> *	the bit fields correctly. And cpu_to_le32 will convert bitfields</span>
<span class="cm"> *	bit fields written by big endian driver to format required by device.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">Vmxnet3_TxDesc</span> <span class="p">{</span>
	<span class="n">__le64</span> <span class="n">addr</span><span class="p">;</span>

<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span> <span class="n">msscof</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>  <span class="cm">/* MSS, checksum offset, flags */</span>
	<span class="n">u32</span> <span class="n">ext1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dtype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>    <span class="cm">/* descriptor type */</span>
	<span class="n">u32</span> <span class="n">rsvd</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* generation bit */</span>
	<span class="n">u32</span> <span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="n">u32</span> <span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* generation bit */</span>
	<span class="n">u32</span> <span class="n">rsvd</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dtype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>    <span class="cm">/* descriptor type */</span>
	<span class="n">u32</span> <span class="n">ext1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msscof</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>  <span class="cm">/* MSS, checksum offset, flags */</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>

<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span> <span class="n">tci</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>     <span class="cm">/* Tag to Insert */</span>
	<span class="n">u32</span> <span class="n">ti</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>       <span class="cm">/* VLAN Tag Insertion */</span>
	<span class="n">u32</span> <span class="n">ext2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cq</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>       <span class="cm">/* completion request */</span>
	<span class="n">u32</span> <span class="n">eop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* End Of Packet */</span>
	<span class="n">u32</span> <span class="n">om</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>       <span class="cm">/* offload mode */</span>
	<span class="n">u32</span> <span class="n">hlen</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>    <span class="cm">/* header len */</span>
<span class="cp">#else</span>
	<span class="n">u32</span> <span class="n">hlen</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>    <span class="cm">/* header len */</span>
	<span class="n">u32</span> <span class="n">om</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>       <span class="cm">/* offload mode */</span>
	<span class="n">u32</span> <span class="n">eop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* End Of Packet */</span>
	<span class="n">u32</span> <span class="n">cq</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>       <span class="cm">/* completion request */</span>
	<span class="n">u32</span> <span class="n">ext2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ti</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>       <span class="cm">/* VLAN Tag Insertion */</span>
	<span class="n">u32</span> <span class="n">tci</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>     <span class="cm">/* Tag to Insert */</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>
<span class="p">};</span>

<span class="cm">/* TxDesc.OM values */</span>
<span class="cp">#define VMXNET3_OM_NONE		0</span>
<span class="cp">#define VMXNET3_OM_CSUM		2</span>
<span class="cp">#define VMXNET3_OM_TSO		3</span>

<span class="cm">/* fields in TxDesc we access w/o using bit fields */</span>
<span class="cp">#define VMXNET3_TXD_EOP_SHIFT	12</span>
<span class="cp">#define VMXNET3_TXD_CQ_SHIFT	13</span>
<span class="cp">#define VMXNET3_TXD_GEN_SHIFT	14</span>
<span class="cp">#define VMXNET3_TXD_EOP_DWORD_SHIFT 3</span>
<span class="cp">#define VMXNET3_TXD_GEN_DWORD_SHIFT 2</span>

<span class="cp">#define VMXNET3_TXD_CQ		(1 &lt;&lt; VMXNET3_TXD_CQ_SHIFT)</span>
<span class="cp">#define VMXNET3_TXD_EOP		(1 &lt;&lt; VMXNET3_TXD_EOP_SHIFT)</span>
<span class="cp">#define VMXNET3_TXD_GEN		(1 &lt;&lt; VMXNET3_TXD_GEN_SHIFT)</span>

<span class="cp">#define VMXNET3_HDR_COPY_SIZE   128</span>


<span class="k">struct</span> <span class="n">Vmxnet3_TxDataDesc</span> <span class="p">{</span>
	<span class="n">u8</span>		<span class="n">data</span><span class="p">[</span><span class="n">VMXNET3_HDR_COPY_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define VMXNET3_TCD_GEN_SHIFT	31</span>
<span class="cp">#define VMXNET3_TCD_GEN_SIZE	1</span>
<span class="cp">#define VMXNET3_TCD_TXIDX_SHIFT	0</span>
<span class="cp">#define VMXNET3_TCD_TXIDX_SIZE	12</span>
<span class="cp">#define VMXNET3_TCD_GEN_DWORD_SHIFT	3</span>

<span class="k">struct</span> <span class="n">Vmxnet3_TxCompDesc</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">txdIdx</span><span class="o">:</span><span class="mi">12</span><span class="p">;</span>    <span class="cm">/* Index of the EOP TxDesc */</span>
	<span class="n">u32</span>		<span class="n">ext1</span><span class="o">:</span><span class="mi">20</span><span class="p">;</span>

	<span class="n">__le32</span>		<span class="n">ext2</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">ext3</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">rsvd</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">type</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>       <span class="cm">/* completion type */</span>
	<span class="n">u32</span>		<span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* generation bit */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Vmxnet3_RxDesc</span> <span class="p">{</span>
	<span class="n">__le64</span>		<span class="n">addr</span><span class="p">;</span>

<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span>		<span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Generation bit */</span>
	<span class="n">u32</span>		<span class="n">rsvd</span><span class="o">:</span><span class="mi">15</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">dtype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* Descriptor type */</span>
	<span class="n">u32</span>		<span class="n">btype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* Buffer Type */</span>
	<span class="n">u32</span>		<span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="n">u32</span>		<span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">btype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* Buffer Type */</span>
	<span class="n">u32</span>		<span class="n">dtype</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>      <span class="cm">/* Descriptor type */</span>
	<span class="n">u32</span>		<span class="n">rsvd</span><span class="o">:</span><span class="mi">15</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Generation bit */</span>
<span class="cp">#endif</span>
	<span class="n">u32</span>		<span class="n">ext1</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* values of RXD.BTYPE */</span>
<span class="cp">#define VMXNET3_RXD_BTYPE_HEAD   0    </span><span class="cm">/* head only */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_RXD_BTYPE_BODY   1    </span><span class="cm">/* body only */</span><span class="cp"></span>

<span class="cm">/* fields in RxDesc we access w/o using bit fields */</span>
<span class="cp">#define VMXNET3_RXD_BTYPE_SHIFT  14</span>
<span class="cp">#define VMXNET3_RXD_GEN_SHIFT    31</span>

<span class="k">struct</span> <span class="n">Vmxnet3_RxCompDesc</span> <span class="p">{</span>
<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span>		<span class="n">ext2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cnc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Checksum Not Calculated */</span>
	<span class="n">u32</span>		<span class="n">rssType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>    <span class="cm">/* RSS hash type used */</span>
	<span class="n">u32</span>		<span class="n">rqID</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>      <span class="cm">/* rx queue/ring ID */</span>
	<span class="n">u32</span>		<span class="n">sop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Start of Packet */</span>
	<span class="n">u32</span>		<span class="n">eop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* End of Packet */</span>
	<span class="n">u32</span>		<span class="n">ext1</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">rxdIdx</span><span class="o">:</span><span class="mi">12</span><span class="p">;</span>    <span class="cm">/* Index of the RxDesc */</span>
<span class="cp">#else</span>
	<span class="n">u32</span>		<span class="n">rxdIdx</span><span class="o">:</span><span class="mi">12</span><span class="p">;</span>    <span class="cm">/* Index of the RxDesc */</span>
	<span class="n">u32</span>		<span class="n">ext1</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">eop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* End of Packet */</span>
	<span class="n">u32</span>		<span class="n">sop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Start of Packet */</span>
	<span class="n">u32</span>		<span class="n">rqID</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>      <span class="cm">/* rx queue/ring ID */</span>
	<span class="n">u32</span>		<span class="n">rssType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>    <span class="cm">/* RSS hash type used */</span>
	<span class="n">u32</span>		<span class="n">cnc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Checksum Not Calculated */</span>
	<span class="n">u32</span>		<span class="n">ext2</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>

	<span class="n">__le32</span>		<span class="n">rssHash</span><span class="p">;</span>      <span class="cm">/* RSS hash value */</span>

<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span>		<span class="n">tci</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>       <span class="cm">/* Tag stripped */</span>
	<span class="n">u32</span>		<span class="n">ts</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* Tag is stripped */</span>
	<span class="n">u32</span>		<span class="n">err</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Error */</span>
	<span class="n">u32</span>		<span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>       <span class="cm">/* data length */</span>
<span class="cp">#else</span>
	<span class="n">u32</span>		<span class="n">len</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>       <span class="cm">/* data length */</span>
	<span class="n">u32</span>		<span class="n">err</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Error */</span>
	<span class="n">u32</span>		<span class="n">ts</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* Tag is stripped */</span>
	<span class="n">u32</span>		<span class="n">tci</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>       <span class="cm">/* Tag stripped */</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>


<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span>		<span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* generation bit */</span>
	<span class="n">u32</span>		<span class="n">type</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>       <span class="cm">/* completion type */</span>
	<span class="n">u32</span>		<span class="n">fcs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Frame CRC correct */</span>
	<span class="n">u32</span>		<span class="n">frg</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* IP Fragment */</span>
	<span class="n">u32</span>		<span class="n">v4</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* IPv4 */</span>
	<span class="n">u32</span>		<span class="n">v6</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* IPv6 */</span>
	<span class="n">u32</span>		<span class="n">ipc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* IP Checksum Correct */</span>
	<span class="n">u32</span>		<span class="n">tcp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* TCP packet */</span>
	<span class="n">u32</span>		<span class="n">udp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* UDP packet */</span>
	<span class="n">u32</span>		<span class="n">tuc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* TCP/UDP Checksum Correct */</span>
	<span class="n">u32</span>		<span class="n">csum</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="n">u32</span>		<span class="n">csum</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">tuc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* TCP/UDP Checksum Correct */</span>
	<span class="n">u32</span>		<span class="n">udp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* UDP packet */</span>
	<span class="n">u32</span>		<span class="n">tcp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* TCP packet */</span>
	<span class="n">u32</span>		<span class="n">ipc</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* IP Checksum Correct */</span>
	<span class="n">u32</span>		<span class="n">v6</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* IPv6 */</span>
	<span class="n">u32</span>		<span class="n">v4</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* IPv4 */</span>
	<span class="n">u32</span>		<span class="n">frg</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* IP Fragment */</span>
	<span class="n">u32</span>		<span class="n">fcs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* Frame CRC correct */</span>
	<span class="n">u32</span>		<span class="n">type</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>       <span class="cm">/* completion type */</span>
	<span class="n">u32</span>		<span class="n">gen</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* generation bit */</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>
<span class="p">};</span>

<span class="cm">/* fields in RxCompDesc we access via Vmxnet3_GenericDesc.dword[3] */</span>
<span class="cp">#define VMXNET3_RCD_TUC_SHIFT	16</span>
<span class="cp">#define VMXNET3_RCD_IPC_SHIFT	19</span>

<span class="cm">/* fields in RxCompDesc we access via Vmxnet3_GenericDesc.qword[1] */</span>
<span class="cp">#define VMXNET3_RCD_TYPE_SHIFT	56</span>
<span class="cp">#define VMXNET3_RCD_GEN_SHIFT	63</span>

<span class="cm">/* csum OK for TCP/UDP pkts over IP */</span>
<span class="cp">#define VMXNET3_RCD_CSUM_OK (1 &lt;&lt; VMXNET3_RCD_TUC_SHIFT | \</span>
<span class="cp">			     1 &lt;&lt; VMXNET3_RCD_IPC_SHIFT)</span>
<span class="cp">#define VMXNET3_TXD_GEN_SIZE 1</span>
<span class="cp">#define VMXNET3_TXD_EOP_SIZE 1</span>

<span class="cm">/* value of RxCompDesc.rssType */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_RCD_RSS_TYPE_NONE</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">VMXNET3_RCD_RSS_TYPE_IPV4</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">VMXNET3_RCD_RSS_TYPE_TCPIPV4</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">VMXNET3_RCD_RSS_TYPE_IPV6</span>     <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">VMXNET3_RCD_RSS_TYPE_TCPIPV6</span>  <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/* a union for accessing all cmd/completion descriptors */</span>
<span class="k">union</span> <span class="n">Vmxnet3_GenericDesc</span> <span class="p">{</span>
	<span class="n">__le64</span>				<span class="n">qword</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__le32</span>				<span class="n">dword</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__le16</span>				<span class="n">word</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_TxDesc</span>		<span class="n">txd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_RxDesc</span>		<span class="n">rxd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_TxCompDesc</span>	<span class="n">tcd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_RxCompDesc</span>	<span class="n">rcd</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define VMXNET3_INIT_GEN       1</span>

<span class="cm">/* Max size of a single tx buffer */</span>
<span class="cp">#define VMXNET3_MAX_TX_BUF_SIZE  (1 &lt;&lt; 14)</span>

<span class="cm">/* # of tx desc needed for a tx buffer size */</span>
<span class="cp">#define VMXNET3_TXD_NEEDED(size) (((size) + VMXNET3_MAX_TX_BUF_SIZE - 1) / \</span>
<span class="cp">				  VMXNET3_MAX_TX_BUF_SIZE)</span>

<span class="cm">/* max # of tx descs for a non-tso pkt */</span>
<span class="cp">#define VMXNET3_MAX_TXD_PER_PKT 16</span>

<span class="cm">/* Max size of a single rx buffer */</span>
<span class="cp">#define VMXNET3_MAX_RX_BUF_SIZE  ((1 &lt;&lt; 14) - 1)</span>
<span class="cm">/* Minimum size of a type 0 buffer */</span>
<span class="cp">#define VMXNET3_MIN_T0_BUF_SIZE  128</span>
<span class="cp">#define VMXNET3_MAX_CSUM_OFFSET  1024</span>

<span class="cm">/* Ring base address alignment */</span>
<span class="cp">#define VMXNET3_RING_BA_ALIGN   512</span>
<span class="cp">#define VMXNET3_RING_BA_MASK    (VMXNET3_RING_BA_ALIGN - 1)</span>

<span class="cm">/* Ring size must be a multiple of 32 */</span>
<span class="cp">#define VMXNET3_RING_SIZE_ALIGN 32</span>
<span class="cp">#define VMXNET3_RING_SIZE_MASK  (VMXNET3_RING_SIZE_ALIGN - 1)</span>

<span class="cm">/* Max ring size */</span>
<span class="cp">#define VMXNET3_TX_RING_MAX_SIZE   4096</span>
<span class="cp">#define VMXNET3_TC_RING_MAX_SIZE   4096</span>
<span class="cp">#define VMXNET3_RX_RING_MAX_SIZE   4096</span>
<span class="cp">#define VMXNET3_RC_RING_MAX_SIZE   8192</span>

<span class="cm">/* a list of reasons for queue stop */</span>

<span class="k">enum</span> <span class="p">{</span>
 <span class="n">VMXNET3_ERR_NOEOP</span>        <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>  <span class="cm">/* cannot find the EOP desc of a pkt */</span>
 <span class="n">VMXNET3_ERR_TXD_REUSE</span>    <span class="o">=</span> <span class="mh">0x80000001</span><span class="p">,</span>  <span class="cm">/* reuse TxDesc before tx completion */</span>
 <span class="n">VMXNET3_ERR_BIG_PKT</span>      <span class="o">=</span> <span class="mh">0x80000002</span><span class="p">,</span>  <span class="cm">/* too many TxDesc for a pkt */</span>
 <span class="n">VMXNET3_ERR_DESC_NOT_SPT</span> <span class="o">=</span> <span class="mh">0x80000003</span><span class="p">,</span>  <span class="cm">/* descriptor type not supported */</span>
 <span class="n">VMXNET3_ERR_SMALL_BUF</span>    <span class="o">=</span> <span class="mh">0x80000004</span><span class="p">,</span>  <span class="cm">/* type 0 buffer too small */</span>
 <span class="n">VMXNET3_ERR_STRESS</span>       <span class="o">=</span> <span class="mh">0x80000005</span><span class="p">,</span>  <span class="cm">/* stress option firing in vmkernel */</span>
 <span class="n">VMXNET3_ERR_SWITCH</span>       <span class="o">=</span> <span class="mh">0x80000006</span><span class="p">,</span>  <span class="cm">/* mode switch failure */</span>
 <span class="n">VMXNET3_ERR_TXD_INVALID</span>  <span class="o">=</span> <span class="mh">0x80000007</span><span class="p">,</span>  <span class="cm">/* invalid TxDesc */</span>
<span class="p">};</span>

<span class="cm">/* completion descriptor types */</span>
<span class="cp">#define VMXNET3_CDTYPE_TXCOMP      0    </span><span class="cm">/* Tx Completion Descriptor */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_CDTYPE_RXCOMP      3    </span><span class="cm">/* Rx Completion Descriptor */</span><span class="cp"></span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_GOS_BITS_UNK</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>   <span class="cm">/* unknown */</span>
	<span class="n">VMXNET3_GOS_BITS_32</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">VMXNET3_GOS_BITS_64</span>     <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define VMXNET3_GOS_TYPE_LINUX	1</span>


<span class="k">struct</span> <span class="n">Vmxnet3_GOSInfo</span> <span class="p">{</span>
<span class="cp">#ifdef __BIG_ENDIAN_BITFIELD</span>
	<span class="n">u32</span>		<span class="n">gosMisc</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>    <span class="cm">/* other info about gos */</span>
	<span class="n">u32</span>		<span class="n">gosVer</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>     <span class="cm">/* gos version */</span>
	<span class="n">u32</span>		<span class="n">gosType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>     <span class="cm">/* which guest */</span>
	<span class="n">u32</span>		<span class="n">gosBits</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>    <span class="cm">/* 32-bit or 64-bit? */</span>
<span class="cp">#else</span>
	<span class="n">u32</span>		<span class="n">gosBits</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>     <span class="cm">/* 32-bit or 64-bit? */</span>
	<span class="n">u32</span>		<span class="n">gosType</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>     <span class="cm">/* which guest */</span>
	<span class="n">u32</span>		<span class="n">gosVer</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>     <span class="cm">/* gos version */</span>
	<span class="n">u32</span>		<span class="n">gosMisc</span><span class="o">:</span><span class="mi">10</span><span class="p">;</span>    <span class="cm">/* other info about gos */</span>
<span class="cp">#endif  </span><span class="cm">/* __BIG_ENDIAN_BITFIELD */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Vmxnet3_DriverInfo</span> <span class="p">{</span>
	<span class="n">__le32</span>				<span class="n">version</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_GOSInfo</span>		<span class="n">gos</span><span class="p">;</span>
	<span class="n">__le32</span>				<span class="n">vmxnet3RevSpt</span><span class="p">;</span>
	<span class="n">__le32</span>				<span class="n">uptVerSpt</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#define VMXNET3_REV1_MAGIC  0xbabefee1</span>

<span class="cm">/*</span>
<span class="cm"> * QueueDescPA must be 128 bytes aligned. It points to an array of</span>
<span class="cm"> * Vmxnet3_TxQueueDesc followed by an array of Vmxnet3_RxQueueDesc.</span>
<span class="cm"> * The number of Vmxnet3_TxQueueDesc/Vmxnet3_RxQueueDesc are specified by</span>
<span class="cm"> * Vmxnet3_MiscConf.numTxQueues/numRxQueues, respectively.</span>
<span class="cm"> */</span>
<span class="cp">#define VMXNET3_QUEUE_DESC_ALIGN  128</span>


<span class="k">struct</span> <span class="n">Vmxnet3_MiscConf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_DriverInfo</span> <span class="n">driverInfo</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">uptFeatures</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">ddPA</span><span class="p">;</span>         <span class="cm">/* driver data PA */</span>
	<span class="n">__le64</span>		<span class="n">queueDescPA</span><span class="p">;</span>  <span class="cm">/* queue descriptor table PA */</span>
	<span class="n">__le32</span>		<span class="n">ddLen</span><span class="p">;</span>        <span class="cm">/* driver data len */</span>
	<span class="n">__le32</span>		<span class="n">queueDescLen</span><span class="p">;</span> <span class="cm">/* queue desc. table len in bytes */</span>
	<span class="n">__le32</span>		<span class="n">mtu</span><span class="p">;</span>
	<span class="n">__le16</span>		<span class="n">maxNumRxSG</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">numTxQueues</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">numRxQueues</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_TxQueueConf</span> <span class="p">{</span>
	<span class="n">__le64</span>		<span class="n">txRingBasePA</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">dataRingBasePA</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">compRingBasePA</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">ddPA</span><span class="p">;</span>         <span class="cm">/* driver data */</span>
	<span class="n">__le64</span>		<span class="n">reserved</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">txRingSize</span><span class="p">;</span>   <span class="cm">/* # of tx desc */</span>
	<span class="n">__le32</span>		<span class="n">dataRingSize</span><span class="p">;</span> <span class="cm">/* # of data desc */</span>
	<span class="n">__le32</span>		<span class="n">compRingSize</span><span class="p">;</span> <span class="cm">/* # of comp desc */</span>
	<span class="n">__le32</span>		<span class="n">ddLen</span><span class="p">;</span>        <span class="cm">/* size of driver data */</span>
	<span class="n">u8</span>		<span class="n">intrIdx</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">_pad</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_RxQueueConf</span> <span class="p">{</span>
	<span class="n">__le64</span>		<span class="n">rxRingBasePA</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__le64</span>		<span class="n">compRingBasePA</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">ddPA</span><span class="p">;</span>            <span class="cm">/* driver data */</span>
	<span class="n">__le64</span>		<span class="n">reserved</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">rxRingSize</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>   <span class="cm">/* # of rx desc */</span>
	<span class="n">__le32</span>		<span class="n">compRingSize</span><span class="p">;</span>    <span class="cm">/* # of rx comp desc */</span>
	<span class="n">__le32</span>		<span class="n">ddLen</span><span class="p">;</span>           <span class="cm">/* size of driver data */</span>
	<span class="n">u8</span>		<span class="n">intrIdx</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">_pad</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">enum</span> <span class="n">vmxnet3_intr_mask_mode</span> <span class="p">{</span>
	<span class="n">VMXNET3_IMM_AUTO</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">VMXNET3_IMM_ACTIVE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">VMXNET3_IMM_LAZY</span>   <span class="o">=</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">vmxnet3_intr_type</span> <span class="p">{</span>
	<span class="n">VMXNET3_IT_AUTO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">VMXNET3_IT_INTX</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">VMXNET3_IT_MSI</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">VMXNET3_IT_MSIX</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">};</span>

<span class="cp">#define VMXNET3_MAX_TX_QUEUES  8</span>
<span class="cp">#define VMXNET3_MAX_RX_QUEUES  16</span>
<span class="cm">/* addition 1 for events */</span>
<span class="cp">#define VMXNET3_MAX_INTRS      25</span>

<span class="cm">/* value of intrCtrl */</span>
<span class="cp">#define VMXNET3_IC_DISABLE_ALL  0x1   </span><span class="cm">/* bit 0 */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">Vmxnet3_IntrConf</span> <span class="p">{</span>
	<span class="n">bool</span>		<span class="n">autoMask</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">numIntrs</span><span class="p">;</span>      <span class="cm">/* # of interrupts */</span>
	<span class="n">u8</span>		<span class="n">eventIntrIdx</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">modLevels</span><span class="p">[</span><span class="n">VMXNET3_MAX_INTRS</span><span class="p">];</span>	<span class="cm">/* moderation level for</span>
<span class="cm">							 * each intr */</span>
	<span class="n">__le32</span>		<span class="n">intrCtrl</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* one bit per VLAN ID, the size is in the units of u32	*/</span>
<span class="cp">#define VMXNET3_VFT_SIZE  (4096 / (sizeof(u32) * 8))</span>


<span class="k">struct</span> <span class="n">Vmxnet3_QueueStatus</span> <span class="p">{</span>
	<span class="n">bool</span>		<span class="n">stopped</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">_pad</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__le32</span>		<span class="n">error</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_TxQueueCtrl</span> <span class="p">{</span>
	<span class="n">__le32</span>		<span class="n">txNumDeferred</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">txThreshold</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_RxQueueCtrl</span> <span class="p">{</span>
	<span class="n">bool</span>		<span class="n">updateRxProd</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">_pad</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">__le64</span>		<span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">VMXNET3_RXM_UCAST</span>     <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>  <span class="cm">/* unicast only */</span>
	<span class="n">VMXNET3_RXM_MCAST</span>     <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>  <span class="cm">/* multicast passing the filters */</span>
	<span class="n">VMXNET3_RXM_BCAST</span>     <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>  <span class="cm">/* broadcast only */</span>
	<span class="n">VMXNET3_RXM_ALL_MULTI</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>  <span class="cm">/* all multicast */</span>
	<span class="n">VMXNET3_RXM_PROMISC</span>   <span class="o">=</span> <span class="mh">0x10</span>  <span class="cm">/* promiscuous */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">Vmxnet3_RxFilterConf</span> <span class="p">{</span>
	<span class="n">__le32</span>		<span class="n">rxMode</span><span class="p">;</span>       <span class="cm">/* VMXNET3_RXM_xxx */</span>
	<span class="n">__le16</span>		<span class="n">mfTableLen</span><span class="p">;</span>   <span class="cm">/* size of the multicast filter table */</span>
	<span class="n">__le16</span>		<span class="n">_pad1</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">mfTablePA</span><span class="p">;</span>    <span class="cm">/* PA of the multicast filters table */</span>
	<span class="n">__le32</span>		<span class="n">vfTable</span><span class="p">[</span><span class="n">VMXNET3_VFT_SIZE</span><span class="p">];</span> <span class="cm">/* vlan filter */</span>
<span class="p">};</span>


<span class="cp">#define VMXNET3_PM_MAX_FILTERS        6</span>
<span class="cp">#define VMXNET3_PM_MAX_PATTERN_SIZE   128</span>
<span class="cp">#define VMXNET3_PM_MAX_MASK_SIZE      (VMXNET3_PM_MAX_PATTERN_SIZE / 8)</span>

<span class="cp">#define VMXNET3_PM_WAKEUP_MAGIC       cpu_to_le16(0x01)  </span><span class="cm">/* wake up on magic pkts */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_PM_WAKEUP_FILTER      cpu_to_le16(0x02)  </span><span class="cm">/* wake up on pkts matching</span>
<span class="cm">							  * filters */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">Vmxnet3_PM_PktFilter</span> <span class="p">{</span>
	<span class="n">u8</span>		<span class="n">maskSize</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">patternSize</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">mask</span><span class="p">[</span><span class="n">VMXNET3_PM_MAX_MASK_SIZE</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">pattern</span><span class="p">[</span><span class="n">VMXNET3_PM_MAX_PATTERN_SIZE</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">pad</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_PMConf</span> <span class="p">{</span>
	<span class="n">__le16</span>		<span class="n">wakeUpEvents</span><span class="p">;</span>  <span class="cm">/* VMXNET3_PM_WAKEUP_xxx */</span>
	<span class="n">u8</span>		<span class="n">numFilters</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">pad</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_PM_PktFilter</span> <span class="n">filters</span><span class="p">[</span><span class="n">VMXNET3_PM_MAX_FILTERS</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_VariableLenConfDesc</span> <span class="p">{</span>
	<span class="n">__le32</span>		<span class="n">confVer</span><span class="p">;</span>
	<span class="n">__le32</span>		<span class="n">confLen</span><span class="p">;</span>
	<span class="n">__le64</span>		<span class="n">confPA</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_TxQueueDesc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_TxQueueCtrl</span>		<span class="n">ctrl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_TxQueueConf</span>		<span class="n">conf</span><span class="p">;</span>

	<span class="cm">/* Driver read after a GET command */</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_QueueStatus</span>		<span class="n">status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">UPT1_TxStats</span>			<span class="n">stats</span><span class="p">;</span>
	<span class="n">u8</span>					<span class="n">_pad</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span> <span class="cm">/* 128 aligned */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_RxQueueDesc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_RxQueueCtrl</span>		<span class="n">ctrl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_RxQueueConf</span>		<span class="n">conf</span><span class="p">;</span>
	<span class="cm">/* Driver read after a GET commad */</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_QueueStatus</span>		<span class="n">status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">UPT1_RxStats</span>			<span class="n">stats</span><span class="p">;</span>
	<span class="n">u8</span>				      <span class="n">__pad</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span> <span class="cm">/* 128 aligned */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">Vmxnet3_DSDevRead</span> <span class="p">{</span>
	<span class="cm">/* read-only region for device, read by dev in response to a SET cmd */</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_MiscConf</span>			<span class="n">misc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_IntrConf</span>			<span class="n">intrConf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_RxFilterConf</span>		<span class="n">rxFilterConf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_VariableLenConfDesc</span>	<span class="n">rssConfDesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_VariableLenConfDesc</span>	<span class="n">pmConfDesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_VariableLenConfDesc</span>	<span class="n">pluginConfDesc</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* All structures in DriverShared are padded to multiples of 8 bytes */</span>
<span class="k">struct</span> <span class="n">Vmxnet3_DriverShared</span> <span class="p">{</span>
	<span class="n">__le32</span>				<span class="n">magic</span><span class="p">;</span>
	<span class="cm">/* make devRead start at 64bit boundaries */</span>
	<span class="n">__le32</span>				<span class="n">pad</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Vmxnet3_DSDevRead</span>	<span class="n">devRead</span><span class="p">;</span>
	<span class="n">__le32</span>				<span class="n">ecr</span><span class="p">;</span>
	<span class="n">__le32</span>				<span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">};</span>


<span class="cp">#define VMXNET3_ECR_RQERR       (1 &lt;&lt; 0)</span>
<span class="cp">#define VMXNET3_ECR_TQERR       (1 &lt;&lt; 1)</span>
<span class="cp">#define VMXNET3_ECR_LINK        (1 &lt;&lt; 2)</span>
<span class="cp">#define VMXNET3_ECR_DIC         (1 &lt;&lt; 3)</span>
<span class="cp">#define VMXNET3_ECR_DEBUG       (1 &lt;&lt; 4)</span>

<span class="cm">/* flip the gen bit of a ring */</span>
<span class="cp">#define VMXNET3_FLIP_RING_GEN(gen) ((gen) = (gen) ^ 0x1)</span>

<span class="cm">/* only use this if moving the idx won&#39;t affect the gen bit */</span>
<span class="cp">#define VMXNET3_INC_RING_IDX_ONLY(idx, ring_size) \</span>
<span class="cp">	do {\</span>
<span class="cp">		(idx)++;\</span>
<span class="cp">		if (unlikely((idx) == (ring_size))) {\</span>
<span class="cp">			(idx) = 0;\</span>
<span class="cp">		} \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define VMXNET3_SET_VFTABLE_ENTRY(vfTable, vid) \</span>
<span class="cp">	(vfTable[vid &gt;&gt; 5] |= (1 &lt;&lt; (vid &amp; 31)))</span>
<span class="cp">#define VMXNET3_CLEAR_VFTABLE_ENTRY(vfTable, vid) \</span>
<span class="cp">	(vfTable[vid &gt;&gt; 5] &amp;= ~(1 &lt;&lt; (vid &amp; 31)))</span>

<span class="cp">#define VMXNET3_VFTABLE_ENTRY_IS_SET(vfTable, vid) \</span>
<span class="cp">	((vfTable[vid &gt;&gt; 5] &amp; (1 &lt;&lt; (vid &amp; 31))) != 0)</span>

<span class="cp">#define VMXNET3_MAX_MTU     9000</span>
<span class="cp">#define VMXNET3_MIN_MTU     60</span>

<span class="cp">#define VMXNET3_LINK_UP         (10000 &lt;&lt; 16 | 1)    </span><span class="cm">/* 10 Gbps, up */</span><span class="cp"></span>
<span class="cp">#define VMXNET3_LINK_DOWN       0</span>

<span class="cp">#endif </span><span class="cm">/* _VMXNET3_DEFS_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
