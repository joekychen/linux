<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › fddi › skfp › h › smc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>smc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> *	(C)Copyright 1998,1999 SysKonnect,</span>
<span class="cm"> *	a business unit of Schneider &amp; Koch &amp; Co. Datensysteme GmbH.</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *	it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *	the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *	(at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *	The information in this file is provided &quot;AS IS&quot; without warranty.</span>
<span class="cm"> *</span>
<span class="cm"> ******************************************************************************/</span>

<span class="cp">#ifndef	_SCMECM_</span>
<span class="cp">#define _SCMECM_</span>

<span class="cp">#if	defined(PCI) &amp;&amp; !defined(OSDEF)</span>
<span class="cm">/*</span>
<span class="cm"> * In the case of the PCI bus the file osdef1st.h must be present</span>
<span class="cm"> */</span>
<span class="cp">#define	OSDEF</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef	PCI</span>
<span class="cp">#ifndef	SUPERNET_3</span>
<span class="cp">#define	SUPERNET_3</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef	TAG_MODE</span>
<span class="cp">#define	TAG_MODE</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * include all other files in required order</span>
<span class="cm"> * the following files must have been included before:</span>
<span class="cm"> *	types.h</span>
<span class="cm"> *	fddi.h</span>
<span class="cm"> */</span>
<span class="cp">#ifdef	OSDEF</span>
<span class="cp">#include &quot;osdef1st.h&quot;</span>
<span class="cp">#endif	</span><span class="cm">/* OSDEF */</span><span class="cp"></span>
<span class="cp">#ifdef	OEM_CONCEPT</span>
<span class="cp">#include &quot;oemdef.h&quot;</span>
<span class="cp">#endif	</span><span class="cm">/* OEM_CONCEPT */</span><span class="cp"></span>
<span class="cp">#include &quot;smt.h&quot;</span>
<span class="cp">#include &quot;cmtdef.h&quot;</span>
<span class="cp">#include &quot;fddimib.h&quot;</span>
<span class="cp">#include &quot;targethw.h&quot;		</span><span class="cm">/* all target hw dependencies */</span><span class="cp"></span>
<span class="cp">#include &quot;targetos.h&quot;		</span><span class="cm">/* all target os dependencies */</span><span class="cp"></span>
<span class="cp">#ifdef	ESS</span>
<span class="cp">#include &quot;sba.h&quot;</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Event Queue</span>
<span class="cm"> *	queue.c</span>
<span class="cm"> * events are class/value pairs</span>
<span class="cm"> *	class	is addressee, e.g. RMT, PCM etc.</span>
<span class="cm"> *	value	is command, e.g. line state change, ring op change etc.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">event_queue</span> <span class="p">{</span>
	<span class="n">u_short</span>	<span class="n">class</span> <span class="p">;</span>			<span class="cm">/* event class */</span>
	<span class="n">u_short</span>	<span class="n">event</span> <span class="p">;</span>			<span class="cm">/* event value */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * define event queue as circular buffer</span>
<span class="cm"> */</span>
<span class="cp">#ifdef	CONCENTRATOR</span>
<span class="cp">#define MAX_EVENT	128</span>
<span class="cp">#else	</span><span class="cm">/* nCONCENTRATOR */</span><span class="cp"></span>
<span class="cp">#define MAX_EVENT	64</span>
<span class="cp">#endif	</span><span class="cm">/* nCONCENTRATOR */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">s_queue</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">event_queue</span> <span class="n">ev_queue</span><span class="p">[</span><span class="n">MAX_EVENT</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">event_queue</span> <span class="o">*</span><span class="n">ev_put</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">event_queue</span> <span class="o">*</span><span class="n">ev_get</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * ECM - Entity Coordination Management</span>
<span class="cm"> * ecm.c</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_ecm</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">path_test</span> <span class="p">;</span>		<span class="cm">/* ECM path test variable */</span>
	<span class="n">u_char</span> <span class="n">sb_flag</span> <span class="p">;</span>		<span class="cm">/* ECM stuck bypass */</span>
	<span class="n">u_char</span> <span class="n">DisconnectFlag</span> <span class="p">;</span>		<span class="cm">/* jd 05-Aug-1999 Bug #10419 </span>
<span class="cm">					 * ECM disconnected */</span>
	<span class="n">u_char</span> <span class="n">ecm_line_state</span> <span class="p">;</span>		<span class="cm">/* flag to dispatcher : line states */</span>
	<span class="n">u_long</span> <span class="n">trace_prop</span> <span class="p">;</span>		<span class="cm">/* ECM Trace_Prop flag &gt;= 16 bits !! */</span>
	<span class="cm">/* NUMPHYS note:</span>
<span class="cm">	 * this variable must have enough bits to hold all entiies in</span>
<span class="cm">	 * the station. So NUMPHYS may not be greater than 31.</span>
<span class="cm">	 */</span>
	<span class="kt">char</span>	<span class="n">ec_pad</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">ecm_timer</span> <span class="p">;</span>	<span class="cm">/* timer */</span>
<span class="p">}</span> <span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * RMT - Ring Management</span>
<span class="cm"> * rmt.c</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_rmt</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">dup_addr_test</span> <span class="p">;</span>		<span class="cm">/* state of dupl. addr. test */</span>
	<span class="n">u_char</span> <span class="n">da_flag</span> <span class="p">;</span>		<span class="cm">/* flag : duplicate address det. */</span>
	<span class="n">u_char</span> <span class="n">loop_avail</span> <span class="p">;</span>		<span class="cm">/* flag : MAC available for loopback */</span>
	<span class="n">u_char</span> <span class="n">sm_ma_avail</span> <span class="p">;</span>		<span class="cm">/* flag : MAC available for SMT */</span>
	<span class="n">u_char</span> <span class="n">no_flag</span> <span class="p">;</span>		<span class="cm">/* flag : ring not operational */</span>
	<span class="n">u_char</span> <span class="n">bn_flag</span> <span class="p">;</span>		<span class="cm">/* flag : MAC reached beacon state */</span>
	<span class="n">u_char</span> <span class="n">jm_flag</span> <span class="p">;</span>		<span class="cm">/* flag : jamming in NON_OP_DUP */</span>
	<span class="n">u_char</span> <span class="n">rm_join</span> <span class="p">;</span>		<span class="cm">/* CFM flag RM_Join */</span>
	<span class="n">u_char</span> <span class="n">rm_loop</span> <span class="p">;</span>		<span class="cm">/* CFM flag RM_Loop */</span>

	<span class="kt">long</span> <span class="n">fast_rm_join</span> <span class="p">;</span>		<span class="cm">/* bit mask of active ports */</span>
	<span class="cm">/*</span>
<span class="cm">	 * timer and flags</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">rmt_timer0</span> <span class="p">;</span>	<span class="cm">/* timer 0 */</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">rmt_timer1</span> <span class="p">;</span>	<span class="cm">/* timer 1 */</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">rmt_timer2</span> <span class="p">;</span>	<span class="cm">/* timer 2 */</span>
	<span class="n">u_char</span> <span class="n">timer0_exp</span> <span class="p">;</span>		<span class="cm">/* flag : timer 0 expired */</span>
	<span class="n">u_char</span> <span class="n">timer1_exp</span> <span class="p">;</span>		<span class="cm">/* flag : timer 1 expired */</span>
	<span class="n">u_char</span> <span class="n">timer2_exp</span> <span class="p">;</span>		<span class="cm">/* flag : timer 2 expired */</span>

	<span class="n">u_char</span> <span class="n">rm_pad1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * CFM - Configuration Management</span>
<span class="cm"> * cfm.c</span>
<span class="cm"> * used for SAS and DAS</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_cfm</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">cf_state</span><span class="p">;</span>		<span class="cm">/* CFM state machine current state */</span>
	<span class="n">u_char</span> <span class="n">cf_pad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * CEM - Configuration Element Management</span>
<span class="cm"> * cem.c</span>
<span class="cm"> * used for Concentrator</span>
<span class="cm"> */</span>
<span class="cp">#ifdef	CONCENTRATOR</span>
<span class="k">struct</span> <span class="n">s_cem</span> <span class="p">{</span>
	<span class="kt">int</span>	<span class="n">ce_state</span> <span class="p">;</span>	<span class="cm">/* CEM state */</span>
	<span class="kt">int</span>	<span class="n">ce_port</span> <span class="p">;</span>	<span class="cm">/* PA PB PM PM+1 .. */</span>
	<span class="kt">int</span>	<span class="n">ce_type</span> <span class="p">;</span>	<span class="cm">/* TA TB TS TM */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * linked list of CCEs in current token path</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_c_ring</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">s_c_ring</span>	<span class="o">*</span><span class="n">c_next</span> <span class="p">;</span>
	<span class="kt">char</span>		<span class="n">c_entity</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="k">struct</span> <span class="n">mib_path_config</span> <span class="p">{</span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigSMTIndex</span><span class="p">;</span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigPATHIndex</span><span class="p">;</span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigTokenOrder</span><span class="p">;</span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigResourceType</span><span class="p">;</span>
<span class="cp">#define SNMP_RES_TYPE_MAC	2	</span><span class="cm">/* Resource is a MAC */</span><span class="cp"></span>
<span class="cp">#define SNMP_RES_TYPE_PORT	4	</span><span class="cm">/* Resource is a PORT */</span><span class="cp"></span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigResourceIndex</span><span class="p">;</span>
	<span class="n">u_long</span>	<span class="n">fddimibPATHConfigCurrentPath</span><span class="p">;</span>
<span class="cp">#define SNMP_PATH_ISOLATED	1	</span><span class="cm">/* Current path is isolated */</span><span class="cp"></span>
<span class="cp">#define SNMP_PATH_LOCAL		2	</span><span class="cm">/* Current path is local */</span><span class="cp"></span>
<span class="cp">#define SNMP_PATH_SECONDARY	3	</span><span class="cm">/* Current path is secondary */</span><span class="cp"></span>
<span class="cp">#define SNMP_PATH_PRIMARY	4	</span><span class="cm">/* Current path is primary */</span><span class="cp"></span>
<span class="cp">#define SNMP_PATH_CONCATENATED	5	</span><span class="cm">/* Current path is concatenated */</span><span class="cp"></span>
<span class="cp">#define SNMP_PATH_THRU		6	</span><span class="cm">/* Current path is thru */</span><span class="cp"></span>
<span class="p">};</span>


<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * PCM connect states</span>
<span class="cm"> */</span>
<span class="cp">#define PCM_DISABLED	0</span>
<span class="cp">#define PCM_CONNECTING	1</span>
<span class="cp">#define PCM_STANDBY	2</span>
<span class="cp">#define PCM_ACTIVE	3</span>

<span class="k">struct</span> <span class="n">s_pcm</span> <span class="p">{</span>
	<span class="n">u_char</span>	<span class="n">pcm_pad</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * PHY struct</span>
<span class="cm"> * one per physical port</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_phy</span> <span class="p">{</span>
	<span class="cm">/* Inter Module Globals */</span>
	<span class="k">struct</span> <span class="n">fddi_mib_p</span>	<span class="o">*</span><span class="n">mib</span> <span class="p">;</span>

	<span class="n">u_char</span> <span class="n">np</span> <span class="p">;</span>		<span class="cm">/* index 0 .. NUMPHYS */</span>
	<span class="n">u_char</span> <span class="n">cf_join</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">cf_loop</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">wc_flag</span> <span class="p">;</span>	<span class="cm">/* withhold connection flag */</span>
	<span class="n">u_char</span> <span class="n">pc_mode</span> <span class="p">;</span>	<span class="cm">/* Holds the negotiated mode of the PCM */</span>
	<span class="n">u_char</span> <span class="n">pc_lem_fail</span> <span class="p">;</span>	<span class="cm">/* flag : LCT failed */</span>
	<span class="n">u_char</span> <span class="n">lc_test</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">scrub</span> <span class="p">;</span>		<span class="cm">/* CFM flag Scrub -&gt; PCM */</span>
	<span class="kt">char</span> <span class="n">phy_name</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">pmd_type</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* SK connector/transceiver type codes */</span>
<span class="cp">#define PMD_SK_CONN	0	</span><span class="cm">/* pmd_type[PMD_SK_CONN] = Connector */</span><span class="cp"></span>
<span class="cp">#define PMD_SK_PMD	1	</span><span class="cm">/* pmd_type[PMD_SK_PMD] = Xver */</span><span class="cp"></span>
	<span class="n">u_char</span> <span class="n">pmd_scramble</span> <span class="p">;</span>	<span class="cm">/* scrambler on/off */</span>

	<span class="cm">/* inner Module Globals */</span>
	<span class="n">u_char</span> <span class="n">curr_ls</span> <span class="p">;</span>	<span class="cm">/* current line state */</span>
	<span class="n">u_char</span> <span class="n">ls_flag</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">rc_flag</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">tc_flag</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">td_flag</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">bitn</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">tr_flag</span> <span class="p">;</span>	<span class="cm">/* trace recvd while in active */</span>
	<span class="n">u_char</span> <span class="n">twisted</span> <span class="p">;</span>	<span class="cm">/* flag to indicate an A-A or B-B connection */</span>
	<span class="n">u_char</span> <span class="n">t_val</span><span class="p">[</span><span class="n">NUMBITS</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* transmit bits for signaling */</span>
	<span class="n">u_char</span> <span class="n">r_val</span><span class="p">[</span><span class="n">NUMBITS</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* receive bits for signaling */</span>
	<span class="n">u_long</span> <span class="n">t_next</span><span class="p">[</span><span class="n">NUMBITS</span><span class="p">]</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">pcm_timer0</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">pcm_timer1</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span> <span class="n">pcm_timer2</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">timer0_exp</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">timer1_exp</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">timer2_exp</span> <span class="p">;</span>
	<span class="n">u_char</span> <span class="n">pcm_pad1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">cem_pst</span> <span class="p">;</span>	<span class="cm">/* CEM privae state; used for dual homing */</span>
	<span class="k">struct</span> <span class="n">lem_counter</span> <span class="n">lem</span> <span class="p">;</span>
<span class="cp">#ifdef	AMDPLC</span>
	<span class="k">struct</span> <span class="n">s_plc</span>	<span class="n">plc</span> <span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * timer package</span>
<span class="cm"> * smttimer.c</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_timer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">smt_timer</span>	<span class="o">*</span><span class="n">st_queue</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span>	<span class="n">st_fast</span> <span class="p">;</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * SRF types and data</span>
<span class="cm"> */</span>
<span class="cp">#define SMT_EVENT_BASE			1</span>
<span class="cp">#define SMT_EVENT_MAC_PATH_CHANGE	(SMT_EVENT_BASE+0)</span>
<span class="cp">#define SMT_EVENT_MAC_NEIGHBOR_CHANGE	(SMT_EVENT_BASE+1)</span>
<span class="cp">#define SMT_EVENT_PORT_PATH_CHANGE	(SMT_EVENT_BASE+2)</span>
<span class="cp">#define SMT_EVENT_PORT_CONNECTION	(SMT_EVENT_BASE+3)</span>

<span class="cp">#define SMT_IS_CONDITION(x)			((x)&gt;=SMT_COND_BASE)</span>

<span class="cp">#define SMT_COND_BASE		(SMT_EVENT_PORT_CONNECTION+1)</span>
<span class="cp">#define SMT_COND_SMT_PEER_WRAP		(SMT_COND_BASE+0)</span>
<span class="cp">#define SMT_COND_SMT_HOLD		(SMT_COND_BASE+1)</span>
<span class="cp">#define SMT_COND_MAC_FRAME_ERROR	(SMT_COND_BASE+2)</span>
<span class="cp">#define SMT_COND_MAC_DUP_ADDR		(SMT_COND_BASE+3)</span>
<span class="cp">#define SMT_COND_MAC_NOT_COPIED		(SMT_COND_BASE+4)</span>
<span class="cp">#define SMT_COND_PORT_EB_ERROR		(SMT_COND_BASE+5)</span>
<span class="cp">#define SMT_COND_PORT_LER		(SMT_COND_BASE+6)</span>

<span class="cp">#define SR0_WAIT	0</span>
<span class="cp">#define SR1_HOLDOFF	1</span>
<span class="cp">#define SR2_DISABLED	2</span>

<span class="k">struct</span> <span class="n">s_srf</span> <span class="p">{</span>
	<span class="n">u_long</span>	<span class="n">SRThreshold</span> <span class="p">;</span>			<span class="cm">/* threshold value */</span>
	<span class="n">u_char</span>	<span class="n">RT_Flag</span> <span class="p">;</span>			<span class="cm">/* report transmitted flag */</span>
	<span class="n">u_char</span>	<span class="n">sr_state</span> <span class="p">;</span>			<span class="cm">/* state-machine */</span>
	<span class="n">u_char</span>	<span class="n">any_report</span> <span class="p">;</span>			<span class="cm">/* any report required */</span>
	<span class="n">u_long</span>	<span class="n">TSR</span> <span class="p">;</span>				<span class="cm">/* timer */</span>
	<span class="n">u_short</span>	<span class="n">ring_status</span> <span class="p">;</span>			<span class="cm">/* IBM ring status */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * IBM token ring status</span>
<span class="cm"> */</span>
<span class="cp">#define RS_RES15	(1&lt;&lt;15)			</span><span class="cm">/* reserved */</span><span class="cp"></span>
<span class="cp">#define RS_HARDERROR	(1&lt;&lt;14)			</span><span class="cm">/* ring down */</span><span class="cp"></span>
<span class="cp">#define RS_SOFTERROR	(1&lt;&lt;13)			</span><span class="cm">/* sent SRF */</span><span class="cp"></span>
<span class="cp">#define RS_BEACON	(1&lt;&lt;12)			</span><span class="cm">/* transmitted beacon */</span><span class="cp"></span>
<span class="cp">#define RS_PATHTEST	(1&lt;&lt;11)			</span><span class="cm">/* path test failed */</span><span class="cp"></span>
<span class="cp">#define RS_SELFTEST	(1&lt;&lt;10)			</span><span class="cm">/* selftest required */</span><span class="cp"></span>
<span class="cp">#define RS_RES9		(1&lt;&lt; 9)			</span><span class="cm">/* reserved */</span><span class="cp"></span>
<span class="cp">#define RS_DISCONNECT	(1&lt;&lt; 8)			</span><span class="cm">/* remote disconnect */</span><span class="cp"></span>
<span class="cp">#define RS_RES7		(1&lt;&lt; 7)			</span><span class="cm">/* reserved */</span><span class="cp"></span>
<span class="cp">#define RS_DUPADDR	(1&lt;&lt; 6)			</span><span class="cm">/* duplicate address */</span><span class="cp"></span>
<span class="cp">#define RS_NORINGOP	(1&lt;&lt; 5)			</span><span class="cm">/* no ring op */</span><span class="cp"></span>
<span class="cp">#define RS_VERSION	(1&lt;&lt; 4)			</span><span class="cm">/* SMT version mismatch */</span><span class="cp"></span>
<span class="cp">#define RS_STUCKBYPASSS	(1&lt;&lt; 3)			</span><span class="cm">/* stuck bypass */</span><span class="cp"></span>
<span class="cp">#define RS_EVENT	(1&lt;&lt; 2)			</span><span class="cm">/* FDDI event occurred */</span><span class="cp"></span>
<span class="cp">#define RS_RINGOPCHANGE	(1&lt;&lt; 1)			</span><span class="cm">/* ring op changed */</span><span class="cp"></span>
<span class="cp">#define RS_RES0		(1&lt;&lt; 0)			</span><span class="cm">/* reserved */</span><span class="cp"></span>

<span class="cp">#define RS_SET(smc,bit) \</span>
<span class="cp">	ring_status_indication(smc,smc-&gt;srf.ring_status |= bit)</span>
<span class="cp">#define RS_CLEAR(smc,bit)	\</span>
<span class="cp">	ring_status_indication(smc,smc-&gt;srf.ring_status &amp;= ~bit)</span>

<span class="cp">#define RS_CLEAR_EVENT	(0xffff &amp; ~(RS_NORINGOP))</span>

<span class="cm">/* Define the AIX-event-Notification as null function if it isn&#39;t defined */</span>
<span class="cm">/* in the targetos.h file */</span>
<span class="cp">#ifndef AIX_EVENT</span>
<span class="cp">#define AIX_EVENT(smc,opt0,opt1,opt2,opt3)	</span><span class="cm">/* nothing */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">s_srf_evc</span> <span class="p">{</span>
	<span class="n">u_char</span>	<span class="n">evc_code</span> <span class="p">;</span>			<span class="cm">/* event code type */</span>
	<span class="n">u_char</span>	<span class="n">evc_index</span> <span class="p">;</span>			<span class="cm">/* index for mult. instances */</span>
	<span class="n">u_char</span>	<span class="n">evc_rep_required</span> <span class="p">;</span>		<span class="cm">/* report required */</span>
	<span class="n">u_short</span>	<span class="n">evc_para</span> <span class="p">;</span>			<span class="cm">/* SMT Para Number */</span>
	<span class="n">u_char</span>	<span class="o">*</span><span class="n">evc_cond_state</span> <span class="p">;</span>		<span class="cm">/* condition state */</span>
	<span class="n">u_char</span>	<span class="o">*</span><span class="n">evc_multiple</span> <span class="p">;</span>			<span class="cm">/* multiple occurrence */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Values used by frame based services</span>
<span class="cm"> * smt.c</span>
<span class="cm"> */</span>
<span class="cp">#define SMT_MAX_TEST		5</span>
<span class="cp">#define SMT_TID_NIF		0		</span><span class="cm">/* pending NIF request */</span><span class="cp"></span>
<span class="cp">#define SMT_TID_NIF_TEST	1		</span><span class="cm">/* pending NIF test */</span><span class="cp"></span>
<span class="cp">#define SMT_TID_ECF_UNA		2		</span><span class="cm">/* pending ECF UNA test */</span><span class="cp"></span>
<span class="cp">#define SMT_TID_ECF_DNA		3		</span><span class="cm">/* pending ECF DNA test */</span><span class="cp"></span>
<span class="cp">#define SMT_TID_ECF		4		</span><span class="cm">/* pending ECF test */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">smt_values</span> <span class="p">{</span>
	<span class="n">u_long</span>		<span class="n">smt_tvu</span> <span class="p">;</span>		<span class="cm">/* timer valid una */</span>
	<span class="n">u_long</span>		<span class="n">smt_tvd</span> <span class="p">;</span>		<span class="cm">/* timer valid dna */</span>
	<span class="n">u_long</span>		<span class="n">smt_tid</span> <span class="p">;</span>		<span class="cm">/* transaction id */</span>
	<span class="n">u_long</span>		<span class="n">pend</span><span class="p">[</span><span class="n">SMT_MAX_TEST</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* TID of requests */</span>
	<span class="n">u_long</span>		<span class="n">uniq_time</span> <span class="p">;</span>		<span class="cm">/* unique time stamp */</span>
	<span class="n">u_short</span>		<span class="n">uniq_ticks</span>  <span class="p">;</span>		<span class="cm">/* unique time stamp */</span>
	<span class="n">u_short</span>		<span class="n">please_reconnect</span> <span class="p">;</span>	<span class="cm">/* flag : reconnect */</span>
	<span class="n">u_long</span>		<span class="n">smt_last_lem</span> <span class="p">;</span>
	<span class="n">u_long</span>		<span class="n">smt_last_notify</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">smt_timer</span>	<span class="n">smt_timer</span> <span class="p">;</span>	<span class="cm">/* SMT NIF timer */</span>
	<span class="n">u_long</span>		<span class="n">last_tok_time</span><span class="p">[</span><span class="n">NUMMACS</span><span class="p">];</span>	<span class="cm">/* token cnt emulation */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * SMT/CMT configurable parameters</span>
<span class="cm"> */</span>
<span class="cp">#define SMT_DAS	0			</span><span class="cm">/* dual attach */</span><span class="cp"></span>
<span class="cp">#define SMT_SAS	1			</span><span class="cm">/* single attach */</span><span class="cp"></span>
<span class="cp">#define SMT_NAC	2			</span><span class="cm">/* null attach concentrator */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">smt_config</span> <span class="p">{</span>
	<span class="n">u_char</span>	<span class="n">attach_s</span> <span class="p">;</span>		<span class="cm">/* CFM attach to secondary path */</span>
	<span class="n">u_char</span>	<span class="n">sas</span> <span class="p">;</span>			<span class="cm">/* SMT_DAS/SAS/NAC */</span>
	<span class="n">u_char</span>	<span class="n">build_ring_map</span> <span class="p">;</span>	<span class="cm">/* build ringmap if TRUE */</span>
	<span class="n">u_char</span>	<span class="n">numphys</span> <span class="p">;</span>		<span class="cm">/* number of active phys */</span>
	<span class="n">u_char</span>	<span class="n">sc_pad</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">;</span>

	<span class="n">u_long</span>	<span class="n">pcm_tb_min</span> <span class="p">;</span>		<span class="cm">/* PCM : TB_Min timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_tb_max</span> <span class="p">;</span>		<span class="cm">/* PCM : TB_Max timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_c_min</span> <span class="p">;</span>		<span class="cm">/* PCM : C_Min timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_t_out</span> <span class="p">;</span>		<span class="cm">/* PCM : T_Out timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_tl_min</span> <span class="p">;</span>		<span class="cm">/* PCM : TL_min timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_lc_short</span> <span class="p">;</span>		<span class="cm">/* PCM : LC_Short timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_lc_medium</span> <span class="p">;</span>		<span class="cm">/* PCM : LC_Medium timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_lc_long</span> <span class="p">;</span>		<span class="cm">/* PCM : LC_Long timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_lc_extended</span> <span class="p">;</span>	<span class="cm">/* PCM : LC_Extended timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_t_next_9</span> <span class="p">;</span>		<span class="cm">/* PCM : T_Next[9] timer value */</span>
	<span class="n">u_long</span>	<span class="n">pcm_ns_max</span> <span class="p">;</span>		<span class="cm">/* PCM : NS_Max timer value */</span>

	<span class="n">u_long</span>	<span class="n">ecm_i_max</span> <span class="p">;</span>		<span class="cm">/* ECM : I_Max timer value */</span>
	<span class="n">u_long</span>	<span class="n">ecm_in_max</span> <span class="p">;</span>		<span class="cm">/* ECM : IN_Max timer value */</span>
	<span class="n">u_long</span>	<span class="n">ecm_td_min</span> <span class="p">;</span>		<span class="cm">/* ECM : TD_Min timer */</span>
	<span class="n">u_long</span>	<span class="n">ecm_test_done</span> <span class="p">;</span>		<span class="cm">/* ECM : path test done timer */</span>
	<span class="n">u_long</span>	<span class="n">ecm_check_poll</span> <span class="p">;</span>	<span class="cm">/* ECM : check bypass poller */</span>

	<span class="n">u_long</span>	<span class="n">rmt_t_non_op</span> <span class="p">;</span>		<span class="cm">/* RMT : T_Non_OP timer value */</span>
	<span class="n">u_long</span>	<span class="n">rmt_t_stuck</span> <span class="p">;</span>		<span class="cm">/* RMT : T_Stuck timer value */</span>
	<span class="n">u_long</span>	<span class="n">rmt_t_direct</span> <span class="p">;</span>		<span class="cm">/* RMT : T_Direct timer value */</span>
	<span class="n">u_long</span>	<span class="n">rmt_t_jam</span> <span class="p">;</span>		<span class="cm">/* RMT : T_Jam timer value */</span>
	<span class="n">u_long</span>	<span class="n">rmt_t_announce</span> <span class="p">;</span>	<span class="cm">/* RMT : T_Announce timer value */</span>
	<span class="n">u_long</span>	<span class="n">rmt_t_poll</span> <span class="p">;</span>		<span class="cm">/* RMT : claim/beacon poller */</span>
	<span class="n">u_long</span>  <span class="n">rmt_dup_mac_behavior</span> <span class="p">;</span>  <span class="cm">/* Flag for the beavior of SMT if</span>
<span class="cm">					 * a Duplicate MAC Address was detected.</span>
<span class="cm">					 * FALSE: SMT will leave finally the ring</span>
<span class="cm">					 * TRUE:  SMT will reinstert into the ring</span>
<span class="cm">					 */</span>
	<span class="n">u_long</span>	<span class="n">mac_d_max</span> <span class="p">;</span>		<span class="cm">/* MAC : D_Max timer value */</span>

	<span class="n">u_long</span> <span class="n">lct_short</span> <span class="p">;</span>		<span class="cm">/* LCT : error threshold */</span>
	<span class="n">u_long</span> <span class="n">lct_medium</span> <span class="p">;</span>		<span class="cm">/* LCT : error threshold */</span>
	<span class="n">u_long</span> <span class="n">lct_long</span> <span class="p">;</span>		<span class="cm">/* LCT : error threshold */</span>
	<span class="n">u_long</span> <span class="n">lct_extended</span> <span class="p">;</span>		<span class="cm">/* LCT : error threshold */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cp">#ifdef	DEBUG</span>
<span class="cm">/*</span>
<span class="cm"> * Debugging struct sometimes used in smc</span>
<span class="cm"> */</span>
<span class="k">struct</span>	<span class="n">smt_debug</span> <span class="p">{</span>
	<span class="kt">int</span>	<span class="n">d_smtf</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_smt</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_ecm</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_rmt</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_cfm</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_pcm</span> <span class="p">;</span>
	<span class="kt">int</span>	<span class="n">d_plc</span> <span class="p">;</span>
<span class="cp">#ifdef	ESS</span>
	<span class="kt">int</span>	<span class="n">d_ess</span> <span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef	SBA</span>
	<span class="kt">int</span>	<span class="n">d_sba</span> <span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">struct</span>	<span class="n">os_debug</span>	<span class="n">d_os</span><span class="p">;</span>	<span class="cm">/* Include specific OS DEBUG struct */</span>
<span class="p">}</span> <span class="p">;</span>

<span class="cp">#ifndef	DEBUG_BRD</span>
<span class="cm">/* all boards shall be debugged with one debug struct */</span>
<span class="k">extern</span>	<span class="k">struct</span>	<span class="n">smt_debug</span>	<span class="n">debug</span><span class="p">;</span>	<span class="cm">/* Declaration of debug struct */</span>
<span class="cp">#endif	</span><span class="cm">/* DEBUG_BRD */</span><span class="cp"></span>

<span class="cp">#endif	</span><span class="cm">/* DEBUG */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * the SMT Context Struct SMC</span>
<span class="cm"> * this struct contains ALL global variables of SMT</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">s_smc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">s_smt_os</span>	<span class="n">os</span> <span class="p">;</span>		<span class="cm">/* os specific */</span>
	<span class="k">struct</span> <span class="n">s_smt_hw</span>	<span class="n">hw</span> <span class="p">;</span>		<span class="cm">/* hardware */</span>

<span class="cm">/*</span>
<span class="cm"> * NOTE: os and hw MUST BE the first two structs</span>
<span class="cm"> * anything beyond hw WILL BE SET TO ZERO in smt_set_defaults()</span>
<span class="cm"> */</span>
	<span class="k">struct</span> <span class="n">smt_config</span> <span class="n">s</span> <span class="p">;</span>		<span class="cm">/* smt constants */</span>
	<span class="k">struct</span> <span class="n">smt_values</span> <span class="n">sm</span> <span class="p">;</span>		<span class="cm">/* smt variables */</span>
	<span class="k">struct</span> <span class="n">s_ecm</span>	<span class="n">e</span> <span class="p">;</span>		<span class="cm">/* ecm */</span>
	<span class="k">struct</span> <span class="n">s_rmt</span>	<span class="n">r</span> <span class="p">;</span>		<span class="cm">/* rmt */</span>
	<span class="k">struct</span> <span class="n">s_cfm</span>	<span class="n">cf</span> <span class="p">;</span>		<span class="cm">/* cfm/cem */</span>
<span class="cp">#ifdef	CONCENTRATOR</span>
	<span class="k">struct</span> <span class="n">s_cem</span>	<span class="n">ce</span><span class="p">[</span><span class="n">NUMPHYS</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* cem */</span>
	<span class="k">struct</span> <span class="n">s_c_ring</span>	<span class="n">cr</span><span class="p">[</span><span class="n">NUMPHYS</span><span class="o">+</span><span class="n">NUMMACS</span><span class="p">]</span> <span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">s_pcm</span>	<span class="n">p</span> <span class="p">;</span>		<span class="cm">/* pcm */</span>
	<span class="k">struct</span> <span class="n">s_phy</span>	<span class="n">y</span><span class="p">[</span><span class="n">NUMPHYS</span><span class="p">]</span> <span class="p">;</span>	<span class="cm">/* phy */</span>
	<span class="k">struct</span> <span class="n">s_queue</span>	<span class="n">q</span> <span class="p">;</span>		<span class="cm">/* queue */</span>
	<span class="k">struct</span> <span class="n">s_timer</span>	<span class="n">t</span> <span class="p">;</span>		<span class="cm">/* timer */</span>
	<span class="k">struct</span> <span class="n">s_srf</span> <span class="n">srf</span> <span class="p">;</span>		<span class="cm">/* SRF */</span>
	<span class="k">struct</span> <span class="n">s_srf_evc</span> <span class="n">evcs</span><span class="p">[</span><span class="mi">6</span><span class="o">+</span><span class="n">NUMPHYS</span><span class="o">*</span><span class="mi">4</span><span class="p">]</span> <span class="p">;</span>
	<span class="k">struct</span> <span class="n">fddi_mib</span>	<span class="n">mib</span> <span class="p">;</span>		<span class="cm">/* __THE_MIB__ */</span>
<span class="cp">#ifdef	SBA</span>
	<span class="k">struct</span> <span class="n">s_sba</span>	<span class="n">sba</span> <span class="p">;</span>		<span class="cm">/* SBA variables */</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef	ESS</span>
	<span class="k">struct</span> <span class="n">s_ess</span>	<span class="n">ess</span> <span class="p">;</span>		<span class="cm">/* Ess variables */</span>
<span class="cp">#endif</span>
<span class="cp">#if	defined(DEBUG) &amp;&amp; defined(DEBUG_BRD)</span>
	<span class="cm">/* If you want all single board to be debugged separately */</span>
	<span class="k">struct</span> <span class="n">smt_debug</span>	<span class="n">debug</span><span class="p">;</span>	<span class="cm">/* Declaration of debug struct */</span>
<span class="cp">#endif	</span><span class="cm">/* DEBUG_BRD &amp;&amp; DEBUG */</span><span class="cp"></span>
<span class="p">}</span> <span class="p">;</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fddi_addr</span> <span class="n">fddi_broadcast</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">all_selection_criteria</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">card_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_board</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="n">mac_addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">init_fplus</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_plc</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">init_smt</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span> <span class="n">mac_addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mac1_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">stu</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">stl</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mac2_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">code_s2u</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">code_s2l</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mac3_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">code_s3u</span><span class="p">,</span> <span class="n">u_short</span> <span class="n">code_s3l</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">pcm_status_twisted</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">plc1_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">plc2_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">read_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span> <span class="n">mac_addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">timer_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">s_smc</span> <span class="o">*</span><span class="n">smc</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* _SCMECM_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
