<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wan › lmc › lmc_var.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>lmc_var.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LMC_VAR_H_</span>
<span class="cp">#define _LMC_VAR_H_</span>

 <span class="cm">/*</span>
<span class="cm">  * Copyright (c) 1997-2000 LAN Media Corporation (LMC)</span>
<span class="cm">  * All rights reserved.  www.lanmedia.com</span>
<span class="cm">  *</span>
<span class="cm">  * This code is written by:</span>
<span class="cm">  * Andrew Stanley-Jones (asj@cban.com)</span>
<span class="cm">  * Rob Braun (bbraun@vix.com),</span>
<span class="cm">  * Michael Graff (explorer@vix.com) and</span>
<span class="cm">  * Matt Thomas (matt@3am-software.com).</span>
<span class="cm">  *</span>
<span class="cm">  * This software may be used and distributed according to the terms</span>
<span class="cm">  * of the GNU General Public License version 2, incorporated herein by reference.</span>
<span class="cm">  */</span>

<span class="cp">#include &lt;linux/timer.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * basic definitions used in lmc include files</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lmc___softc</span> <span class="n">lmc_softc_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lmc___media</span> <span class="n">lmc_media_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lmc___ctl</span> <span class="n">lmc_ctl_t</span><span class="p">;</span>

<span class="cp">#define lmc_csrptr_t    unsigned long</span>

<span class="cp">#define LMC_REG_RANGE 0x80</span>

<span class="cp">#define LMC_PRINTF_FMT  &quot;%s&quot;</span>
<span class="cp">#define LMC_PRINTF_ARGS	(sc-&gt;lmc_device-&gt;name)</span>

<span class="cp">#define TX_TIMEOUT (2*HZ)</span>

<span class="cp">#define LMC_TXDESCS            32</span>
<span class="cp">#define LMC_RXDESCS            32</span>

<span class="cp">#define LMC_LINK_UP            1</span>
<span class="cp">#define LMC_LINK_DOWN          0</span>

<span class="cm">/* These macros for generic read and write to and from the dec chip */</span>
<span class="cp">#define LMC_CSR_READ(sc, csr) \</span>
<span class="cp">	inl((sc)-&gt;lmc_csrs.csr)</span>
<span class="cp">#define LMC_CSR_WRITE(sc, reg, val) \</span>
<span class="cp">	outl((val), (sc)-&gt;lmc_csrs.reg)</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>ifdef <em>LINUX</em>DELAY_H</h1>

<h1>define SLOW<em>DOWN</em>IO udelay(2);</h1>

<h1>undef <em>_SLOW</em>DOWN_IO</h1>

<h1>define <em>_SLOW</em>DOWN_IO udelay(2);</h1>

<h1>endif</h1></td><td class="code"><div class="highlight"><pre><span class="cp">#define DELAY(n) SLOW_DOWN_IO</span>

<span class="cp">#define lmc_delay() inl(sc-&gt;lmc_csrs.csr_9)</span>

<span class="cm">/* This macro sync&#39;s up with the mii so that reads and writes can take place */</span>
<span class="cp">#define LMC_MII_SYNC(sc) do {int n=32; while( n &gt;= 0 ) { \</span>
<span class="cp">                LMC_CSR_WRITE((sc), csr_9, 0x20000); \</span>
<span class="cp">		lmc_delay(); \</span>
<span class="cp">		LMC_CSR_WRITE((sc), csr_9, 0x30000); \</span>
<span class="cp">                lmc_delay(); \</span>
<span class="cp">		n--; }} while(0)</span>

<span class="k">struct</span> <span class="n">lmc_regfile_t</span> <span class="p">{</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_busmode</span><span class="p">;</span>                  <span class="cm">/* CSR0 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_txpoll</span><span class="p">;</span>                   <span class="cm">/* CSR1 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_rxpoll</span><span class="p">;</span>                   <span class="cm">/* CSR2 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_rxlist</span><span class="p">;</span>                   <span class="cm">/* CSR3 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_txlist</span><span class="p">;</span>                   <span class="cm">/* CSR4 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_status</span><span class="p">;</span>                   <span class="cm">/* CSR5 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_command</span><span class="p">;</span>                  <span class="cm">/* CSR6 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_intr</span><span class="p">;</span>                     <span class="cm">/* CSR7 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_missed_frames</span><span class="p">;</span>            <span class="cm">/* CSR8 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_9</span><span class="p">;</span>                        <span class="cm">/* CSR9 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_10</span><span class="p">;</span>                       <span class="cm">/* CSR10 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_11</span><span class="p">;</span>                       <span class="cm">/* CSR11 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_12</span><span class="p">;</span>                       <span class="cm">/* CSR12 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_13</span><span class="p">;</span>                       <span class="cm">/* CSR13 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_14</span><span class="p">;</span>                       <span class="cm">/* CSR14 */</span>
    <span class="n">lmc_csrptr_t</span> <span class="n">csr_15</span><span class="p">;</span>                       <span class="cm">/* CSR15 */</span>
<span class="p">};</span>

<span class="cp">#define csr_enetrom             csr_9   </span><span class="cm">/* 21040 */</span><span class="cp"></span>
<span class="cp">#define csr_reserved            csr_10  </span><span class="cm">/* 21040 */</span><span class="cp"></span>
<span class="cp">#define csr_full_duplex         csr_11  </span><span class="cm">/* 21040 */</span><span class="cp"></span>
<span class="cp">#define csr_bootrom             csr_10  </span><span class="cm">/* 21041/21140A/?? */</span><span class="cp"></span>
<span class="cp">#define csr_gp                  csr_12  </span><span class="cm">/* 21140* */</span><span class="cp"></span>
<span class="cp">#define csr_watchdog            csr_15  </span><span class="cm">/* 21140* */</span><span class="cp"></span>
<span class="cp">#define csr_gp_timer            csr_11  </span><span class="cm">/* 21041/21140* */</span><span class="cp"></span>
<span class="cp">#define csr_srom_mii            csr_9   </span><span class="cm">/* 21041/21140* */</span><span class="cp"></span>
<span class="cp">#define csr_sia_status          csr_12  </span><span class="cm">/* 2104x */</span><span class="cp"></span>
<span class="cp">#define csr_sia_connectivity    csr_13  </span><span class="cm">/* 2104x */</span><span class="cp"></span>
<span class="cp">#define csr_sia_tx_rx           csr_14  </span><span class="cm">/* 2104x */</span><span class="cp"></span>
<span class="cp">#define csr_sia_general         csr_15  </span><span class="cm">/* 2104x */</span><span class="cp"></span>

<span class="cm">/* tulip length/control transmit descriptor definitions</span>
<span class="cm"> *  used to define bits in the second tulip_desc_t field (length)</span>
<span class="cm"> *  for the transmit descriptor -baz */</span>

<span class="cp">#define LMC_TDES_FIRST_BUFFER_SIZE       ((u32)(0x000007FF))</span>
<span class="cp">#define LMC_TDES_SECOND_BUFFER_SIZE      ((u32)(0x003FF800))</span>
<span class="cp">#define LMC_TDES_HASH_FILTERING          ((u32)(0x00400000))</span>
<span class="cp">#define LMC_TDES_DISABLE_PADDING         ((u32)(0x00800000))</span>
<span class="cp">#define LMC_TDES_SECOND_ADDR_CHAINED     ((u32)(0x01000000))</span>
<span class="cp">#define LMC_TDES_END_OF_RING             ((u32)(0x02000000))</span>
<span class="cp">#define LMC_TDES_ADD_CRC_DISABLE         ((u32)(0x04000000))</span>
<span class="cp">#define LMC_TDES_SETUP_PACKET            ((u32)(0x08000000))</span>
<span class="cp">#define LMC_TDES_INVERSE_FILTERING       ((u32)(0x10000000))</span>
<span class="cp">#define LMC_TDES_FIRST_SEGMENT           ((u32)(0x20000000))</span>
<span class="cp">#define LMC_TDES_LAST_SEGMENT            ((u32)(0x40000000))</span>
<span class="cp">#define LMC_TDES_INTERRUPT_ON_COMPLETION ((u32)(0x80000000))</span>

<span class="cp">#define TDES_SECOND_BUFFER_SIZE_BIT_NUMBER  11</span>
<span class="cp">#define TDES_COLLISION_COUNT_BIT_NUMBER     3</span>

<span class="cm">/* Constants for the RCV descriptor RDES */</span>

<span class="cp">#define LMC_RDES_OVERFLOW             ((u32)(0x00000001))</span>
<span class="cp">#define LMC_RDES_CRC_ERROR            ((u32)(0x00000002))</span>
<span class="cp">#define LMC_RDES_DRIBBLING_BIT        ((u32)(0x00000004))</span>
<span class="cp">#define LMC_RDES_REPORT_ON_MII_ERR    ((u32)(0x00000008))</span>
<span class="cp">#define LMC_RDES_RCV_WATCHDOG_TIMEOUT ((u32)(0x00000010))</span>
<span class="cp">#define LMC_RDES_FRAME_TYPE           ((u32)(0x00000020))</span>
<span class="cp">#define LMC_RDES_COLLISION_SEEN       ((u32)(0x00000040))</span>
<span class="cp">#define LMC_RDES_FRAME_TOO_LONG       ((u32)(0x00000080))</span>
<span class="cp">#define LMC_RDES_LAST_DESCRIPTOR      ((u32)(0x00000100))</span>
<span class="cp">#define LMC_RDES_FIRST_DESCRIPTOR     ((u32)(0x00000200))</span>
<span class="cp">#define LMC_RDES_MULTICAST_FRAME      ((u32)(0x00000400))</span>
<span class="cp">#define LMC_RDES_RUNT_FRAME           ((u32)(0x00000800))</span>
<span class="cp">#define LMC_RDES_DATA_TYPE            ((u32)(0x00003000))</span>
<span class="cp">#define LMC_RDES_LENGTH_ERROR         ((u32)(0x00004000))</span>
<span class="cp">#define LMC_RDES_ERROR_SUMMARY        ((u32)(0x00008000))</span>
<span class="cp">#define LMC_RDES_FRAME_LENGTH         ((u32)(0x3FFF0000))</span>
<span class="cp">#define LMC_RDES_OWN_BIT              ((u32)(0x80000000))</span>

<span class="cp">#define RDES_FRAME_LENGTH_BIT_NUMBER       16</span>

<span class="cp">#define LMC_RDES_ERROR_MASK ( (u32)( \</span>
<span class="cp">	  LMC_RDES_OVERFLOW \</span>
<span class="cp">	| LMC_RDES_DRIBBLING_BIT \</span>
<span class="cp">	| LMC_RDES_REPORT_ON_MII_ERR \</span>
<span class="cp">        | LMC_RDES_COLLISION_SEEN ) )</span>


<span class="cm">/*</span>
<span class="cm"> * Ioctl info</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">n</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">m</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">v</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">x</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">r</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">f</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">exact</span><span class="p">;</span>
<span class="p">}</span> <span class="n">lmc_av9110_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Common structure passed to the ioctl code.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">lmc___ctl</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">cardtype</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">clock_source</span><span class="p">;</span>		<span class="cm">/* HSSI, T1 */</span>
	<span class="n">u32</span>	<span class="n">clock_rate</span><span class="p">;</span>		<span class="cm">/* T1 */</span>
	<span class="n">u32</span>	<span class="n">crc_length</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">cable_length</span><span class="p">;</span>		<span class="cm">/* DS3 */</span>
	<span class="n">u32</span>	<span class="n">scrambler_onoff</span><span class="p">;</span>	<span class="cm">/* DS3 */</span>
	<span class="n">u32</span>	<span class="n">cable_type</span><span class="p">;</span>		<span class="cm">/* T1 */</span>
	<span class="n">u32</span>	<span class="n">keepalive_onoff</span><span class="p">;</span>	<span class="cm">/* protocol */</span>
	<span class="n">u32</span>	<span class="n">ticks</span><span class="p">;</span>			<span class="cm">/* ticks/sec */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">lmc_av9110_t</span>	<span class="n">ssi</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">cardspec</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">circuit_type</span><span class="p">;</span>   <span class="cm">/* T1 or E1 */</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * Careful, look at the data sheet, there&#39;s more to this</span>
<span class="cm"> * structure than meets the eye.  It should probably be:</span>
<span class="cm"> *</span>
<span class="cm"> * struct tulip_desc_t {</span>
<span class="cm"> *         u8  own:1;</span>
<span class="cm"> *         u32 status:31;</span>
<span class="cm"> *         u32 control:10;</span>
<span class="cm"> *         u32 buffer1;</span>
<span class="cm"> *         u32 buffer2;</span>
<span class="cm"> * };</span>
<span class="cm"> * You could also expand status control to provide more bit information</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">tulip_desc_t</span> <span class="p">{</span>
	<span class="n">s32</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buffer1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buffer2</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * media independent methods to check on media status, link, light LEDs,</span>
<span class="cm"> * etc.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">lmc___media</span> <span class="p">{</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">init</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">defaults</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_status</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="n">lmc_ctl_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_clock_source</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_speed</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="n">lmc_ctl_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_cable_length</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_scrambler</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span>	<span class="p">(</span><span class="o">*</span> <span class="n">get_link_status</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_link_status</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">set_crc_length</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
        <span class="kt">void</span>    <span class="p">(</span><span class="o">*</span> <span class="n">set_circuit_type</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
        <span class="kt">void</span>	<span class="p">(</span><span class="o">*</span> <span class="n">watchdog</span><span class="p">)(</span><span class="n">lmc_softc_t</span> <span class="o">*</span> <span class="k">const</span><span class="p">);</span>
<span class="p">};</span>


<span class="cp">#define STATCHECK     0xBEEFCAFE</span>

<span class="k">struct</span> <span class="n">lmc_extra_statistics</span>
<span class="p">{</span>
	<span class="n">u32</span>       <span class="n">version_size</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lmc_cardtype</span><span class="p">;</span>

	<span class="n">u32</span>       <span class="n">tx_ProcTimeout</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_IntTimeout</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_NoCompleteCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_MaxXmtsB4Int</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_TimeoutCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_OutOfSyncPtr</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_tbusy0</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_tbusy1</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_tbusy_calls</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">resetCount</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lmc_txfull</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tbusy</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">dirtyTx</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lmc_next_tx</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">otherTypeCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lastType</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lastTypeOK</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">txLoopCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">usedXmtDescripCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">txIndexCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">rxIntLoopCnt</span><span class="p">;</span>

	<span class="n">u32</span>       <span class="n">rx_SmallPktCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">rx_BadPktSurgeCnt</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">rx_BuffAllocErr</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">tx_lossOfClockCnt</span><span class="p">;</span>

	<span class="cm">/* T1 error counters */</span>
	<span class="n">u32</span>       <span class="n">framingBitErrorCount</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">lineCodeViolationCount</span><span class="p">;</span>

	<span class="n">u32</span>       <span class="n">lossOfFrameCount</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">changeOfFrameAlignmentCount</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">severelyErroredFrameCount</span><span class="p">;</span>

	<span class="n">u32</span>       <span class="n">check</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lmc_xinfo</span> <span class="p">{</span>
	<span class="n">u32</span>       <span class="n">Magic0</span><span class="p">;</span>                         <span class="cm">/* BEEFCAFE */</span>

	<span class="n">u32</span>       <span class="n">PciCardType</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">PciSlotNumber</span><span class="p">;</span>          <span class="cm">/* PCI slot number       */</span>

	<span class="n">u16</span>	       <span class="n">DriverMajorVersion</span><span class="p">;</span>
	<span class="n">u16</span>	       <span class="n">DriverMinorVersion</span><span class="p">;</span>
	<span class="n">u16</span>	       <span class="n">DriverSubVersion</span><span class="p">;</span>

	<span class="n">u16</span>	       <span class="n">XilinxRevisionNumber</span><span class="p">;</span>
	<span class="n">u16</span>	       <span class="n">MaxFrameSize</span><span class="p">;</span>

	<span class="n">u16</span>     	  <span class="n">t1_alarm1_status</span><span class="p">;</span>
	<span class="n">u16</span>       	<span class="n">t1_alarm2_status</span><span class="p">;</span>

	<span class="kt">int</span>             <span class="n">link_status</span><span class="p">;</span>
	<span class="n">u32</span>       <span class="n">mii_reg16</span><span class="p">;</span>

	<span class="n">u32</span>       <span class="n">Magic1</span><span class="p">;</span>                         <span class="cm">/* DEADBEEF */</span>
<span class="p">}</span> <span class="n">LMC_XINFO</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * forward decl</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">lmc___softc</span> <span class="p">{</span>
	<span class="kt">char</span>                   <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">board_idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lmc_extra_statistics</span> <span class="n">extra_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">lmc_device</span><span class="p">;</span>

	<span class="kt">int</span>                     <span class="n">hang</span><span class="p">,</span> <span class="n">rxdesc</span><span class="p">,</span> <span class="n">bad_packet</span><span class="p">,</span> <span class="n">some_counter</span><span class="p">;</span>
	<span class="n">u32</span>  	         	<span class="n">txgo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lmc_regfile_t</span>	<span class="n">lmc_csrs</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u32</span>		<span class="n">lmc_txtick</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u32</span>		<span class="n">lmc_rxtick</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lmc_flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lmc_intrmask</span><span class="p">;</span>	<span class="cm">/* our copy of csr_intr */</span>
	<span class="n">u32</span>			<span class="n">lmc_cmdmode</span><span class="p">;</span>	<span class="cm">/* our copy of csr_cmdmode */</span>
	<span class="n">u32</span>			<span class="n">lmc_busmode</span><span class="p">;</span>	<span class="cm">/* our copy of csr_busmode */</span>
	<span class="n">u32</span>			<span class="n">lmc_gpio_io</span><span class="p">;</span>	<span class="cm">/* state of in/out settings */</span>
	<span class="n">u32</span>			<span class="n">lmc_gpio</span><span class="p">;</span>	<span class="cm">/* state of outputs */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span><span class="o">*</span>		<span class="n">lmc_txq</span><span class="p">[</span><span class="n">LMC_TXDESCS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">sk_buff</span><span class="o">*</span>		<span class="n">lmc_rxq</span><span class="p">[</span><span class="n">LMC_RXDESCS</span><span class="p">];</span>
	<span class="k">volatile</span>
	<span class="k">struct</span> <span class="n">tulip_desc_t</span>	<span class="n">lmc_rxring</span><span class="p">[</span><span class="n">LMC_RXDESCS</span><span class="p">];</span>
	<span class="k">volatile</span>
	<span class="k">struct</span> <span class="n">tulip_desc_t</span>	<span class="n">lmc_txring</span><span class="p">[</span><span class="n">LMC_TXDESCS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">lmc_next_rx</span><span class="p">,</span> <span class="n">lmc_next_tx</span><span class="p">;</span>
	<span class="k">volatile</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">lmc_taint_tx</span><span class="p">,</span> <span class="n">lmc_taint_rx</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lmc_tx_start</span><span class="p">,</span> <span class="n">lmc_txfull</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lmc_txbusy</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">lmc_miireg16</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lmc_ok</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">last_link_status</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lmc_cardtype</span><span class="p">;</span>
	<span class="n">u32</span>               	<span class="n">last_frameerr</span><span class="p">;</span>
	<span class="n">lmc_media_t</span>	       <span class="o">*</span><span class="n">lmc_media</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	<span class="n">timer</span><span class="p">;</span>
	<span class="n">lmc_ctl_t</span>		<span class="n">ictl</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">TxDescriptControlInit</span><span class="p">;</span>

	<span class="kt">int</span>                     <span class="n">tx_TimeoutInd</span><span class="p">;</span> <span class="cm">/* additional driver state */</span>
	<span class="kt">int</span>                     <span class="n">tx_TimeoutDisplay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">lastlmc_taint_tx</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">lasttx_packets</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">tx_clockState</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lmc_crcSize</span><span class="p">;</span>
	<span class="n">LMC_XINFO</span>		<span class="n">lmc_xinfo</span><span class="p">;</span>
	<span class="kt">char</span>                    <span class="n">lmc_yel</span><span class="p">,</span> <span class="n">lmc_blue</span><span class="p">,</span> <span class="n">lmc_red</span><span class="p">;</span> <span class="cm">/* for T1 and DS3 */</span>
	<span class="kt">char</span>                    <span class="n">lmc_timing</span><span class="p">;</span> <span class="cm">/* for HSSI and SSI */</span>
	<span class="kt">int</span>                     <span class="n">got_irq</span><span class="p">;</span>

	<span class="kt">char</span>                    <span class="n">last_led_err</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="n">u32</span>                     <span class="n">last_int</span><span class="p">;</span>
	<span class="n">u32</span>                     <span class="n">num_int</span><span class="p">;</span>

	<span class="n">spinlock_t</span>              <span class="n">lmc_lock</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">if_type</span><span class="p">;</span>       <span class="cm">/* HDLC/PPP or NET */</span>

	<span class="cm">/* Failure cases */</span>
	<span class="n">u8</span>			<span class="n">failed_ring</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">failed_recv_alloc</span><span class="p">;</span>

	<span class="cm">/* Structure check */</span>
	<span class="n">u32</span>                     <span class="n">check</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define LMC_PCI_TIME 1</span>
<span class="cp">#define LMC_EXT_TIME 0</span>

<span class="cp">#define PKT_BUF_SZ              1542  </span><span class="cm">/* was 1536 */</span><span class="cp"></span>

<span class="cm">/* CSR5 settings */</span>
<span class="cp">#define TIMER_INT     0x00000800</span>
<span class="cp">#define TP_LINK_FAIL  0x00001000</span>
<span class="cp">#define TP_LINK_PASS  0x00000010</span>
<span class="cp">#define NORMAL_INT    0x00010000</span>
<span class="cp">#define ABNORMAL_INT  0x00008000</span>
<span class="cp">#define RX_JABBER_INT 0x00000200</span>
<span class="cp">#define RX_DIED       0x00000100</span>
<span class="cp">#define RX_NOBUFF     0x00000080</span>
<span class="cp">#define RX_INT        0x00000040</span>
<span class="cp">#define TX_FIFO_UNDER 0x00000020</span>
<span class="cp">#define TX_JABBER     0x00000008</span>
<span class="cp">#define TX_NOBUFF     0x00000004</span>
<span class="cp">#define TX_DIED       0x00000002</span>
<span class="cp">#define TX_INT        0x00000001</span>

<span class="cm">/* CSR6 settings */</span>
<span class="cp">#define OPERATION_MODE  0x00000200 </span><span class="cm">/* Full Duplex      */</span><span class="cp"></span>
<span class="cp">#define PROMISC_MODE    0x00000040 </span><span class="cm">/* Promiscuous Mode */</span><span class="cp"></span>
<span class="cp">#define RECEIVE_ALL     0x40000000 </span><span class="cm">/* Receive All      */</span><span class="cp"></span>
<span class="cp">#define PASS_BAD_FRAMES 0x00000008 </span><span class="cm">/* Pass Bad Frames  */</span><span class="cp"></span>

<span class="cm">/* Dec control registers  CSR6 as well */</span>
<span class="cp">#define LMC_DEC_ST 0x00002000</span>
<span class="cp">#define LMC_DEC_SR 0x00000002</span>

<span class="cm">/* CSR15 settings */</span>
<span class="cp">#define RECV_WATCHDOG_DISABLE 0x00000010</span>
<span class="cp">#define JABBER_DISABLE        0x00000001</span>

<span class="cm">/* More settings */</span>
<span class="cm">/*</span>
<span class="cm"> * aSR6 -- Command (Operation Mode) Register</span>
<span class="cm"> */</span>
<span class="cp">#define TULIP_CMD_RECEIVEALL    0x40000000L </span><span class="cm">/* (RW)  Receivel all frames? */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_MUSTBEONE     0x02000000L </span><span class="cm">/* (RW)  Must Be One (21140) */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_TXTHRSHLDCTL  0x00400000L </span><span class="cm">/* (RW)  Transmit Threshold Mode (21140) */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_STOREFWD      0x00200000L </span><span class="cm">/* (RW)  Store and Forward (21140) */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_NOHEARTBEAT   0x00080000L </span><span class="cm">/* (RW)  No Heartbeat (21140) */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_PORTSELECT    0x00040000L </span><span class="cm">/* (RW)  Post Select (100Mb) (21140) */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_FULLDUPLEX    0x00000200L </span><span class="cm">/* (RW)  Full Duplex Mode */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_OPERMODE      0x00000C00L </span><span class="cm">/* (RW)  Operating Mode */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_PROMISCUOUS   0x00000041L </span><span class="cm">/* (RW)  Promiscuous Mode */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_PASSBADPKT    0x00000008L </span><span class="cm">/* (RW)  Pass Bad Frames */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_THRESHOLDCTL  0x0000C000L </span><span class="cm">/* (RW)  Threshold Control */</span><span class="cp"></span>

<span class="cp">#define TULIP_GP_PINSET         0x00000100L</span>
<span class="cp">#define TULIP_BUSMODE_SWRESET   0x00000001L</span>
<span class="cp">#define TULIP_WATCHDOG_TXDISABLE 0x00000001L</span>
<span class="cp">#define TULIP_WATCHDOG_RXDISABLE 0x00000010L</span>

<span class="cp">#define TULIP_STS_NORMALINTR    0x00010000L </span><span class="cm">/* (RW)  Normal Interrupt */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_ABNRMLINTR    0x00008000L </span><span class="cm">/* (RW)  Abnormal Interrupt */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_ERI           0x00004000L </span><span class="cm">/* (RW)  Early Receive Interrupt */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_SYSERROR      0x00002000L </span><span class="cm">/* (RW)  System Error */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_GTE           0x00000800L </span><span class="cm">/* (RW)  General Pupose Timer Exp */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_ETI           0x00000400L </span><span class="cm">/* (RW)  Early Transmit Interrupt */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_RXWT          0x00000200L </span><span class="cm">/* (RW)  Receiver Watchdog Timeout */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_RXSTOPPED     0x00000100L </span><span class="cm">/* (RW)  Receiver Process Stopped */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_RXNOBUF       0x00000080L </span><span class="cm">/* (RW)  Receive Buf Unavail */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_RXINTR        0x00000040L </span><span class="cm">/* (RW)  Receive Interrupt */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_TXUNDERFLOW   0x00000020L </span><span class="cm">/* (RW)  Transmit Underflow */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_TXJABER       0x00000008L </span><span class="cm">/* (RW)  Jabber timeout */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_TXNOBUF       0x00000004L</span>
<span class="cp">#define TULIP_STS_TXSTOPPED     0x00000002L </span><span class="cm">/* (RW)  Transmit Process Stopped */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_TXINTR        0x00000001L </span><span class="cm">/* (RW)  Transmit Interrupt */</span><span class="cp"></span>

<span class="cp">#define TULIP_STS_RXS_STOPPED   0x00000000L </span><span class="cm">/*        000 - Stopped */</span><span class="cp"></span>

<span class="cp">#define TULIP_STS_RXSTOPPED     0x00000100L             </span><span class="cm">/* (RW)  Receive Process Stopped */</span><span class="cp"></span>
<span class="cp">#define TULIP_STS_RXNOBUF       0x00000080L</span>

<span class="cp">#define TULIP_CMD_TXRUN         0x00002000L </span><span class="cm">/* (RW)  Start/Stop Transmitter */</span><span class="cp"></span>
<span class="cp">#define TULIP_CMD_RXRUN         0x00000002L </span><span class="cm">/* (RW)  Start/Stop Receive Filtering */</span><span class="cp"></span>
<span class="cp">#define TULIP_DSTS_TxDEFERRED   0x00000001      </span><span class="cm">/* Initially Deferred */</span><span class="cp"></span>
<span class="cp">#define TULIP_DSTS_OWNER        0x80000000      </span><span class="cm">/* Owner (1 = 21040) */</span><span class="cp"></span>
<span class="cp">#define TULIP_DSTS_RxMIIERR     0x00000008</span>
<span class="cp">#define LMC_DSTS_ERRSUM         (TULIP_DSTS_RxMIIERR)</span>

<span class="cp">#define TULIP_DEFAULT_INTR_MASK  (TULIP_STS_NORMALINTR \</span>
<span class="cp">  | TULIP_STS_RXINTR       \</span>
<span class="cp">  | TULIP_STS_TXINTR     \</span>
<span class="cp">  | TULIP_STS_ABNRMLINTR \</span>
<span class="cp">  | TULIP_STS_SYSERROR   \</span>
<span class="cp">  | TULIP_STS_TXSTOPPED  \</span>
<span class="cp">  | TULIP_STS_TXUNDERFLOW\</span>
<span class="cp">  | TULIP_STS_RXSTOPPED )</span>

<span class="cp">#define DESC_OWNED_BY_SYSTEM   ((u32)(0x00000000))</span>
<span class="cp">#define DESC_OWNED_BY_DC21X4   ((u32)(0x80000000))</span>

<span class="cp">#ifndef TULIP_CMD_RECEIVEALL</span>
<span class="cp">#define TULIP_CMD_RECEIVEALL 0x40000000L</span>
<span class="cp">#endif</span>

<span class="cm">/* Adapter module number */</span>
<span class="cp">#define LMC_ADAP_HSSI           2</span>
<span class="cp">#define LMC_ADAP_DS3            3</span>
<span class="cp">#define LMC_ADAP_SSI            4</span>
<span class="cp">#define LMC_ADAP_T1             5</span>

<span class="cp">#define LMC_MTU 1500</span>

<span class="cp">#define LMC_CRC_LEN_16 2  </span><span class="cm">/* 16-bit CRC */</span><span class="cp"></span>
<span class="cp">#define LMC_CRC_LEN_32 4</span>

<span class="cp">#endif </span><span class="cm">/* _LMC_VAR_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
