<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › b43 › b43.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>b43.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef B43_H_</span>
<span class="cp">#define B43_H_</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/hw_random.h&gt;</span>
<span class="cp">#include &lt;linux/bcma/bcma.h&gt;</span>
<span class="cp">#include &lt;linux/ssb/ssb.h&gt;</span>
<span class="cp">#include &lt;net/mac80211.h&gt;</span>

<span class="cp">#include &quot;debugfs.h&quot;</span>
<span class="cp">#include &quot;leds.h&quot;</span>
<span class="cp">#include &quot;rfkill.h&quot;</span>
<span class="cp">#include &quot;bus.h&quot;</span>
<span class="cp">#include &quot;lo.h&quot;</span>
<span class="cp">#include &quot;phy_common.h&quot;</span>


<span class="cp">#ifdef CONFIG_B43_DEBUG</span>
<span class="cp"># define B43_DEBUG	1</span>
<span class="cp">#else</span>
<span class="cp"># define B43_DEBUG	0</span>
<span class="cp">#endif</span>

<span class="cm">/* MMIO offsets */</span>
<span class="cp">#define B43_MMIO_DMA0_REASON		0x20</span>
<span class="cp">#define B43_MMIO_DMA0_IRQ_MASK		0x24</span>
<span class="cp">#define B43_MMIO_DMA1_REASON		0x28</span>
<span class="cp">#define B43_MMIO_DMA1_IRQ_MASK		0x2C</span>
<span class="cp">#define B43_MMIO_DMA2_REASON		0x30</span>
<span class="cp">#define B43_MMIO_DMA2_IRQ_MASK		0x34</span>
<span class="cp">#define B43_MMIO_DMA3_REASON		0x38</span>
<span class="cp">#define B43_MMIO_DMA3_IRQ_MASK		0x3C</span>
<span class="cp">#define B43_MMIO_DMA4_REASON		0x40</span>
<span class="cp">#define B43_MMIO_DMA4_IRQ_MASK		0x44</span>
<span class="cp">#define B43_MMIO_DMA5_REASON		0x48</span>
<span class="cp">#define B43_MMIO_DMA5_IRQ_MASK		0x4C</span>
<span class="cp">#define B43_MMIO_MACCTL			0x120	</span><span class="cm">/* MAC control */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_MACCMD			0x124	</span><span class="cm">/* MAC command */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_GEN_IRQ_REASON		0x128</span>
<span class="cp">#define B43_MMIO_GEN_IRQ_MASK		0x12C</span>
<span class="cp">#define B43_MMIO_RAM_CONTROL		0x130</span>
<span class="cp">#define B43_MMIO_RAM_DATA		0x134</span>
<span class="cp">#define B43_MMIO_PS_STATUS		0x140</span>
<span class="cp">#define B43_MMIO_RADIO_HWENABLED_HI	0x158</span>
<span class="cp">#define B43_MMIO_SHM_CONTROL		0x160</span>
<span class="cp">#define B43_MMIO_SHM_DATA		0x164</span>
<span class="cp">#define B43_MMIO_SHM_DATA_UNALIGNED	0x166</span>
<span class="cp">#define B43_MMIO_XMITSTAT_0		0x170</span>
<span class="cp">#define B43_MMIO_XMITSTAT_1		0x174</span>
<span class="cp">#define B43_MMIO_REV3PLUS_TSF_LOW	0x180	</span><span class="cm">/* core rev &gt;= 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_REV3PLUS_TSF_HIGH	0x184	</span><span class="cm">/* core rev &gt;= 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_TSF_CFP_REP		0x188</span>
<span class="cp">#define B43_MMIO_TSF_CFP_START		0x18C</span>
<span class="cp">#define B43_MMIO_TSF_CFP_MAXDUR		0x190</span>

<span class="cm">/* 32-bit DMA */</span>
<span class="cp">#define B43_MMIO_DMA32_BASE0		0x200</span>
<span class="cp">#define B43_MMIO_DMA32_BASE1		0x220</span>
<span class="cp">#define B43_MMIO_DMA32_BASE2		0x240</span>
<span class="cp">#define B43_MMIO_DMA32_BASE3		0x260</span>
<span class="cp">#define B43_MMIO_DMA32_BASE4		0x280</span>
<span class="cp">#define B43_MMIO_DMA32_BASE5		0x2A0</span>
<span class="cm">/* 64-bit DMA */</span>
<span class="cp">#define B43_MMIO_DMA64_BASE0		0x200</span>
<span class="cp">#define B43_MMIO_DMA64_BASE1		0x240</span>
<span class="cp">#define B43_MMIO_DMA64_BASE2		0x280</span>
<span class="cp">#define B43_MMIO_DMA64_BASE3		0x2C0</span>
<span class="cp">#define B43_MMIO_DMA64_BASE4		0x300</span>
<span class="cp">#define B43_MMIO_DMA64_BASE5		0x340</span>

<span class="cm">/* PIO on core rev &lt; 11 */</span>
<span class="cp">#define B43_MMIO_PIO_BASE0		0x300</span>
<span class="cp">#define B43_MMIO_PIO_BASE1		0x310</span>
<span class="cp">#define B43_MMIO_PIO_BASE2		0x320</span>
<span class="cp">#define B43_MMIO_PIO_BASE3		0x330</span>
<span class="cp">#define B43_MMIO_PIO_BASE4		0x340</span>
<span class="cp">#define B43_MMIO_PIO_BASE5		0x350</span>
<span class="cp">#define B43_MMIO_PIO_BASE6		0x360</span>
<span class="cp">#define B43_MMIO_PIO_BASE7		0x370</span>
<span class="cm">/* PIO on core rev &gt;= 11 */</span>
<span class="cp">#define B43_MMIO_PIO11_BASE0		0x200</span>
<span class="cp">#define B43_MMIO_PIO11_BASE1		0x240</span>
<span class="cp">#define B43_MMIO_PIO11_BASE2		0x280</span>
<span class="cp">#define B43_MMIO_PIO11_BASE3		0x2C0</span>
<span class="cp">#define B43_MMIO_PIO11_BASE4		0x300</span>
<span class="cp">#define B43_MMIO_PIO11_BASE5		0x340</span>

<span class="cp">#define B43_MMIO_RADIO24_CONTROL	0x3D8	</span><span class="cm">/* core rev &gt;= 24 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_RADIO24_DATA		0x3DA	</span><span class="cm">/* core rev &gt;= 24 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_PHY_VER		0x3E0</span>
<span class="cp">#define B43_MMIO_PHY_RADIO		0x3E2</span>
<span class="cp">#define B43_MMIO_PHY0			0x3E6</span>
<span class="cp">#define B43_MMIO_ANTENNA		0x3E8</span>
<span class="cp">#define B43_MMIO_CHANNEL		0x3F0</span>
<span class="cp">#define B43_MMIO_CHANNEL_EXT		0x3F4</span>
<span class="cp">#define B43_MMIO_RADIO_CONTROL		0x3F6</span>
<span class="cp">#define B43_MMIO_RADIO_DATA_HIGH	0x3F8</span>
<span class="cp">#define B43_MMIO_RADIO_DATA_LOW		0x3FA</span>
<span class="cp">#define B43_MMIO_PHY_CONTROL		0x3FC</span>
<span class="cp">#define B43_MMIO_PHY_DATA		0x3FE</span>
<span class="cp">#define B43_MMIO_MACFILTER_CONTROL	0x420</span>
<span class="cp">#define B43_MMIO_MACFILTER_DATA		0x422</span>
<span class="cp">#define B43_MMIO_RCMTA_COUNT		0x43C</span>
<span class="cp">#define B43_MMIO_PSM_PHY_HDR		0x492</span>
<span class="cp">#define B43_MMIO_RADIO_HWENABLED_LO	0x49A</span>
<span class="cp">#define B43_MMIO_GPIO_CONTROL		0x49C</span>
<span class="cp">#define B43_MMIO_GPIO_MASK		0x49E</span>
<span class="cp">#define B43_MMIO_TXE0_CTL		0x500</span>
<span class="cp">#define B43_MMIO_TXE0_AUX		0x502</span>
<span class="cp">#define B43_MMIO_TXE0_TS_LOC		0x504</span>
<span class="cp">#define B43_MMIO_TXE0_TIME_OUT		0x506</span>
<span class="cp">#define B43_MMIO_TXE0_WM_0		0x508</span>
<span class="cp">#define B43_MMIO_TXE0_WM_1		0x50A</span>
<span class="cp">#define B43_MMIO_TXE0_PHYCTL		0x50C</span>
<span class="cp">#define B43_MMIO_TXE0_STATUS		0x50E</span>
<span class="cp">#define B43_MMIO_TXE0_MMPLCP0		0x510</span>
<span class="cp">#define B43_MMIO_TXE0_MMPLCP1		0x512</span>
<span class="cp">#define B43_MMIO_TXE0_PHYCTL1		0x514</span>
<span class="cp">#define B43_MMIO_XMTFIFODEF		0x520</span>
<span class="cp">#define B43_MMIO_XMTFIFO_FRAME_CNT	0x522	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFO_BYTE_CNT	0x524	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFO_HEAD		0x526	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFO_RD_PTR		0x528	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFO_WR_PTR		0x52A	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFODEF1		0x52C	</span><span class="cm">/* core rev&gt;= 16 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTFIFOCMD		0x540</span>
<span class="cp">#define B43_MMIO_XMTFIFOFLUSH		0x542</span>
<span class="cp">#define B43_MMIO_XMTFIFOTHRESH		0x544</span>
<span class="cp">#define B43_MMIO_XMTFIFORDY		0x546</span>
<span class="cp">#define B43_MMIO_XMTFIFOPRIRDY		0x548</span>
<span class="cp">#define B43_MMIO_XMTFIFORQPRI		0x54A</span>
<span class="cp">#define B43_MMIO_XMTTPLATETXPTR		0x54C</span>
<span class="cp">#define B43_MMIO_XMTTPLATEPTR		0x550</span>
<span class="cp">#define B43_MMIO_SMPL_CLCT_STRPTR	0x552	</span><span class="cm">/* core rev&gt;= 22 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_SMPL_CLCT_STPPTR	0x554	</span><span class="cm">/* core rev&gt;= 22 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_SMPL_CLCT_CURPTR	0x556	</span><span class="cm">/* core rev&gt;= 22 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_XMTTPLATEDATALO	0x560</span>
<span class="cp">#define B43_MMIO_XMTTPLATEDATAHI	0x562</span>
<span class="cp">#define B43_MMIO_XMTSEL			0x568</span>
<span class="cp">#define B43_MMIO_XMTTXCNT		0x56A</span>
<span class="cp">#define B43_MMIO_XMTTXSHMADDR		0x56C</span>
<span class="cp">#define B43_MMIO_TSF_CFP_START_LOW	0x604</span>
<span class="cp">#define B43_MMIO_TSF_CFP_START_HIGH	0x606</span>
<span class="cp">#define B43_MMIO_TSF_CFP_PRETBTT	0x612</span>
<span class="cp">#define B43_MMIO_TSF_CLK_FRAC_LOW	0x62E</span>
<span class="cp">#define B43_MMIO_TSF_CLK_FRAC_HIGH	0x630</span>
<span class="cp">#define B43_MMIO_TSF_0			0x632	</span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_TSF_1			0x634	</span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_TSF_2			0x636	</span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_TSF_3			0x638	</span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_RNG			0x65A</span>
<span class="cp">#define B43_MMIO_IFSSLOT		0x684	</span><span class="cm">/* Interframe slot time */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_IFSCTL			0x688	</span><span class="cm">/* Interframe space control */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_IFSSTAT		0x690</span>
<span class="cp">#define B43_MMIO_IFSMEDBUSYCTL		0x692</span>
<span class="cp">#define B43_MMIO_IFTXDUR		0x694</span>
<span class="cp">#define  B43_MMIO_IFSCTL_USE_EDCF	0x0004</span>
<span class="cp">#define B43_MMIO_POWERUP_DELAY		0x6A8</span>
<span class="cp">#define B43_MMIO_BTCOEX_CTL		0x6B4 </span><span class="cm">/* Bluetooth Coexistence Control */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_BTCOEX_STAT		0x6B6 </span><span class="cm">/* Bluetooth Coexistence Status */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_BTCOEX_TXCTL		0x6B8 </span><span class="cm">/* Bluetooth Coexistence Transmit Control */</span><span class="cp"></span>
<span class="cp">#define B43_MMIO_WEPCTL			0x7C0</span>

<span class="cm">/* SPROM boardflags_lo values */</span>
<span class="cp">#define B43_BFL_BTCOEXIST		0x0001	</span><span class="cm">/* implements Bluetooth coexistance */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_PACTRL			0x0002	</span><span class="cm">/* GPIO 9 controlling the PA */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_AIRLINEMODE		0x0004	</span><span class="cm">/* implements GPIO 13 radio disable indication */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_RSSI			0x0008	</span><span class="cm">/* software calculates nrssi slope. */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_ENETSPI			0x0010	</span><span class="cm">/* has ephy roboswitch spi */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_XTAL_NOSLOW		0x0020	</span><span class="cm">/* no slow clock available */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_CCKHIPWR		0x0040	</span><span class="cm">/* can do high power CCK transmission */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_ENETADM			0x0080	</span><span class="cm">/* has ADMtek switch */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_ENETVLAN		0x0100	</span><span class="cm">/* can do vlan */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_AFTERBURNER		0x0200	</span><span class="cm">/* supports Afterburner mode */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_NOPCI			0x0400	</span><span class="cm">/* leaves PCI floating */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_FEM			0x0800	</span><span class="cm">/* supports the Front End Module */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_EXTLNA			0x1000	</span><span class="cm">/* has an external LNA */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_HGPA			0x2000	</span><span class="cm">/* had high gain PA */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_BTCMOD			0x4000	</span><span class="cm">/* BFL_BTCOEXIST is given in alternate GPIOs */</span><span class="cp"></span>
<span class="cp">#define B43_BFL_ALTIQ			0x8000	</span><span class="cm">/* alternate I/Q settings */</span><span class="cp"></span>

<span class="cm">/* SPROM boardflags_hi values */</span>
<span class="cp">#define B43_BFH_NOPA			0x0001	</span><span class="cm">/* has no PA */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_RSSIINV			0x0002	</span><span class="cm">/* RSSI uses positive slope (not TSSI) */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_PAREF			0x0004	</span><span class="cm">/* uses the PARef LDO */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_3TSWITCH		0x0008	</span><span class="cm">/* uses a triple throw switch shared</span>
<span class="cm">						 * with bluetooth */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_PHASESHIFT		0x0010	</span><span class="cm">/* can support phase shifter */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_BUCKBOOST		0x0020	</span><span class="cm">/* has buck/booster */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_FEM_BT			0x0040	</span><span class="cm">/* has FEM and switch to share antenna</span>
<span class="cm">						 * with bluetooth */</span><span class="cp"></span>
<span class="cp">#define B43_BFH_NOCBUCK			0x0080</span>
<span class="cp">#define B43_BFH_PALDO			0x0200</span>
<span class="cp">#define B43_BFH_EXTLNA_5GHZ		0x1000	</span><span class="cm">/* has an external LNA (5GHz mode) */</span><span class="cp"></span>

<span class="cm">/* SPROM boardflags2_lo values */</span>
<span class="cp">#define B43_BFL2_RXBB_INT_REG_DIS	0x0001	</span><span class="cm">/* external RX BB regulator present */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_APLL_WAR		0x0002	</span><span class="cm">/* alternative A-band PLL settings implemented */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_TXPWRCTRL_EN 		0x0004	</span><span class="cm">/* permits enabling TX Power Control */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_2X4_DIV		0x0008	</span><span class="cm">/* 2x4 diversity switch */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_5G_PWRGAIN		0x0010	</span><span class="cm">/* supports 5G band power gain */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_PCIEWAR_OVR		0x0020	</span><span class="cm">/* overrides ASPM and Clkreq settings */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_CAESERS_BRD		0x0040	</span><span class="cm">/* is Caesers board (unused) */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_BTC3WIRE		0x0080	</span><span class="cm">/* used 3-wire bluetooth coexist */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_SKWRKFEM_BRD		0x0100	</span><span class="cm">/* 4321mcm93 uses Skyworks FEM */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_SPUR_WAR		0x0200	</span><span class="cm">/* has a workaround for clock-harmonic spurs */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_GPLL_WAR		0x0400	</span><span class="cm">/* altenative G-band PLL settings implemented */</span><span class="cp"></span>
<span class="cp">#define B43_BFL2_SINGLEANT_CCK		0x1000</span>
<span class="cp">#define B43_BFL2_2G_SPUR_WAR		0x2000</span>

<span class="cm">/* SPROM boardflags2_hi values */</span>
<span class="cp">#define B43_BFH2_GPLL_WAR2		0x0001</span>
<span class="cp">#define B43_BFH2_IPALVLSHIFT_3P3	0x0002</span>
<span class="cp">#define B43_BFH2_INTERNDET_TXIQCAL	0x0004</span>
<span class="cp">#define B43_BFH2_XTALBUFOUTEN		0x0008</span>

<span class="cm">/* GPIO register offset, in both ChipCommon and PCI core. */</span>
<span class="cp">#define B43_GPIO_CONTROL		0x6c</span>

<span class="cm">/* SHM Routing */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43_SHM_UCODE</span><span class="p">,</span>		<span class="cm">/* Microcode memory */</span>
	<span class="n">B43_SHM_SHARED</span><span class="p">,</span>		<span class="cm">/* Shared memory */</span>
	<span class="n">B43_SHM_SCRATCH</span><span class="p">,</span>	<span class="cm">/* Scratch memory */</span>
	<span class="n">B43_SHM_HW</span><span class="p">,</span>		<span class="cm">/* Internal hardware register */</span>
	<span class="n">B43_SHM_RCMTA</span><span class="p">,</span>		<span class="cm">/* Receive match transmitter address (rev &gt;= 5 only) */</span>
<span class="p">};</span>
<span class="cm">/* SHM Routing modifiers */</span>
<span class="cp">#define B43_SHM_AUTOINC_R		0x0200	</span><span class="cm">/* Auto-increment address on read */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_AUTOINC_W		0x0100	</span><span class="cm">/* Auto-increment address on write */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_AUTOINC_RW		(B43_SHM_AUTOINC_R | \</span>
<span class="cp">					 B43_SHM_AUTOINC_W)</span>

<span class="cm">/* Misc SHM_SHARED offsets */</span>
<span class="cp">#define B43_SHM_SH_WLCOREREV		0x0016	</span><span class="cm">/* 802.11 core revision */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PCTLWDPOS		0x0008</span>
<span class="cp">#define B43_SHM_SH_RXPADOFF		0x0034	</span><span class="cm">/* RX Padding data offset (PIO only) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_FWCAPA		0x0042	</span><span class="cm">/* Firmware capabilities (Opensource firmware only) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PHYVER		0x0050	</span><span class="cm">/* PHY version */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PHYTYPE		0x0052	</span><span class="cm">/* PHY type */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_ANTSWAP		0x005C	</span><span class="cm">/* Antenna swap threshold */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_HOSTFLO		0x005E	</span><span class="cm">/* Hostflags for ucode options (low) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_HOSTFMI		0x0060	</span><span class="cm">/* Hostflags for ucode options (middle) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_HOSTFHI		0x0062	</span><span class="cm">/* Hostflags for ucode options (high) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_RFATT		0x0064	</span><span class="cm">/* Current radio attenuation value */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_RADAR		0x0066	</span><span class="cm">/* Radar register */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PHYTXNOI		0x006E	</span><span class="cm">/* PHY noise directly after TX (lower 8bit only) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_RFRXSP1		0x0072	</span><span class="cm">/* RF RX SP Register 1 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_CHAN			0x00A0	</span><span class="cm">/* Current channel (low 8bit only) */</span><span class="cp"></span>
<span class="cp">#define  B43_SHM_SH_CHAN_5GHZ		0x0100	</span><span class="cm">/* Bit set, if 5 Ghz channel */</span><span class="cp"></span>
<span class="cp">#define  B43_SHM_SH_CHAN_40MHZ		0x0200	</span><span class="cm">/* Bit set, if 40 Mhz channel width */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_BCMCFIFOID		0x0108	</span><span class="cm">/* Last posted cookie to the bcast/mcast FIFO */</span><span class="cp"></span>
<span class="cm">/* TSSI information */</span>
<span class="cp">#define B43_SHM_SH_TSSI_CCK		0x0058	</span><span class="cm">/* TSSI for last 4 CCK frames (32bit) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_TSSI_OFDM_A		0x0068	</span><span class="cm">/* TSSI for last 4 OFDM frames (32bit) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_TSSI_OFDM_G		0x0070	</span><span class="cm">/* TSSI for last 4 OFDM frames (32bit) */</span><span class="cp"></span>
<span class="cp">#define  B43_TSSI_MAX			0x7F	</span><span class="cm">/* Max value for one TSSI value */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED TX FIFO variables */</span>
<span class="cp">#define B43_SHM_SH_SIZE01		0x0098	</span><span class="cm">/* TX FIFO size for FIFO 0 (low) and 1 (high) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_SIZE23		0x009A	</span><span class="cm">/* TX FIFO size for FIFO 2 and 3 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_SIZE45		0x009C	</span><span class="cm">/* TX FIFO size for FIFO 4 and 5 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_SIZE67		0x009E	</span><span class="cm">/* TX FIFO size for FIFO 6 and 7 */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED background noise */</span>
<span class="cp">#define B43_SHM_SH_JSSI0		0x0088	</span><span class="cm">/* Measure JSSI 0 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_JSSI1		0x008A	</span><span class="cm">/* Measure JSSI 1 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_JSSIAUX		0x008C	</span><span class="cm">/* Measure JSSI AUX */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED crypto engine */</span>
<span class="cp">#define B43_SHM_SH_DEFAULTIV		0x003C	</span><span class="cm">/* Default IV location */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_NRRXTRANS		0x003E	</span><span class="cm">/* # of soft RX transmitter addresses (max 8) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_KTP			0x0056	</span><span class="cm">/* Key table pointer */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_TKIPTSCTTAK		0x0318</span>
<span class="cp">#define B43_SHM_SH_KEYIDXBLOCK		0x05D4	</span><span class="cm">/* Key index/algorithm block (v4 firmware) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PSM			0x05F4	</span><span class="cm">/* PSM transmitter address match block (rev &lt; 5) */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED WME variables */</span>
<span class="cp">#define B43_SHM_SH_EDCFSTAT		0x000E	</span><span class="cm">/* EDCF status */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_TXFCUR		0x0030	</span><span class="cm">/* TXF current index */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_EDCFQ		0x0240	</span><span class="cm">/* EDCF Q info */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED powersave mode related */</span>
<span class="cp">#define B43_SHM_SH_SLOTT		0x0010	</span><span class="cm">/* Slot time */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_DTIMPER		0x0012	</span><span class="cm">/* DTIM period */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_NOSLPZNATDTIM	0x004C	</span><span class="cm">/* NOSLPZNAT DTIM */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED beacon/AP variables */</span>
<span class="cp">#define B43_SHM_SH_BTL0			0x0018	</span><span class="cm">/* Beacon template length 0 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_BTL1			0x001A	</span><span class="cm">/* Beacon template length 1 */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_BTSFOFF		0x001C	</span><span class="cm">/* Beacon TSF offset */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_TIMBPOS		0x001E	</span><span class="cm">/* TIM B position in beacon */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_DTIMP		0x0012	</span><span class="cm">/* DTIP period */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_MCASTCOOKIE		0x00A8	</span><span class="cm">/* Last bcast/mcast frame ID */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_SFFBLIM		0x0044	</span><span class="cm">/* Short frame fallback retry limit */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_LFFBLIM		0x0046	</span><span class="cm">/* Long frame fallback retry limit */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_BEACPHYCTL		0x0054	</span><span class="cm">/* Beacon PHY TX control word (see PHY TX control) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_EXTNPHYCTL		0x00B0	</span><span class="cm">/* Extended bytes for beacon PHY control (N) */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED ACK/CTS control */</span>
<span class="cp">#define B43_SHM_SH_ACKCTSPHYCTL		0x0022	</span><span class="cm">/* ACK/CTS PHY control word (see PHY TX control) */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED probe response variables */</span>
<span class="cp">#define B43_SHM_SH_PRSSID		0x0160	</span><span class="cm">/* Probe Response SSID */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PRSSIDLEN		0x0048	</span><span class="cm">/* Probe Response SSID length */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PRTLEN		0x004A	</span><span class="cm">/* Probe Response template length */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PRMAXTIME		0x0074	</span><span class="cm">/* Probe Response max time */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PRPHYCTL		0x0188	</span><span class="cm">/* Probe Response PHY TX control word */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED rate tables */</span>
<span class="cp">#define B43_SHM_SH_OFDMDIRECT		0x01C0	</span><span class="cm">/* Pointer to OFDM direct map */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_OFDMBASIC		0x01E0	</span><span class="cm">/* Pointer to OFDM basic rate map */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_CCKDIRECT		0x0200	</span><span class="cm">/* Pointer to CCK direct map */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_CCKBASIC		0x0220	</span><span class="cm">/* Pointer to CCK basic rate map */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED microcode soft registers */</span>
<span class="cp">#define B43_SHM_SH_UCODEREV		0x0000	</span><span class="cm">/* Microcode revision */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_UCODEPATCH		0x0002	</span><span class="cm">/* Microcode patchlevel */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_UCODEDATE		0x0004	</span><span class="cm">/* Microcode date */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_UCODETIME		0x0006	</span><span class="cm">/* Microcode time */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_UCODESTAT		0x0040	</span><span class="cm">/* Microcode debug status code */</span><span class="cp"></span>
<span class="cp">#define  B43_SHM_SH_UCODESTAT_INVALID	0</span>
<span class="cp">#define  B43_SHM_SH_UCODESTAT_INIT	1</span>
<span class="cp">#define  B43_SHM_SH_UCODESTAT_ACTIVE	2</span>
<span class="cp">#define  B43_SHM_SH_UCODESTAT_SUSP	3	</span><span class="cm">/* suspended */</span><span class="cp"></span>
<span class="cp">#define  B43_SHM_SH_UCODESTAT_SLEEP	4	</span><span class="cm">/* asleep (PS) */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_MAXBFRAMES		0x0080	</span><span class="cm">/* Maximum number of frames in a burst */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_SPUWKUP		0x0094	</span><span class="cm">/* pre-wakeup for synth PU in us */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SH_PRETBTT		0x0096	</span><span class="cm">/* pre-TBTT in us */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED tx iq workarounds */</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXIQW0		0x0700</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXIQW1		0x0702</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXIQW2		0x0704</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXIQW3		0x0706</span>
<span class="cm">/* SHM_SHARED tx pwr ctrl */</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXPWR_INDX0	0x0708</span>
<span class="cp">#define B43_SHM_SH_NPHY_TXPWR_INDX1	0x070E</span>

<span class="cm">/* SHM_SCRATCH offsets */</span>
<span class="cp">#define B43_SHM_SC_MINCONT		0x0003	</span><span class="cm">/* Minimum contention window */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_MAXCONT		0x0004	</span><span class="cm">/* Maximum contention window */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_CURCONT		0x0005	</span><span class="cm">/* Current contention window */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_SRLIMIT		0x0006	</span><span class="cm">/* Short retry count limit */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_LRLIMIT		0x0007	</span><span class="cm">/* Long retry count limit */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_DTIMC		0x0008	</span><span class="cm">/* Current DTIM count */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_BTL0LEN		0x0015	</span><span class="cm">/* Beacon 0 template length */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_BTL1LEN		0x0016	</span><span class="cm">/* Beacon 1 template length */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_SCFB			0x0017	</span><span class="cm">/* Short frame transmit count threshold for rate fallback */</span><span class="cp"></span>
<span class="cp">#define B43_SHM_SC_LCFB			0x0018	</span><span class="cm">/* Long frame transmit count threshold for rate fallback */</span><span class="cp"></span>

<span class="cm">/* Hardware Radio Enable masks */</span>
<span class="cp">#define B43_MMIO_RADIO_HWENABLED_HI_MASK (1 &lt;&lt; 16)</span>
<span class="cp">#define B43_MMIO_RADIO_HWENABLED_LO_MASK (1 &lt;&lt; 4)</span>

<span class="cm">/* HostFlags. See b43_hf_read/write() */</span>
<span class="cp">#define B43_HF_ANTDIVHELP	0x000000000001ULL </span><span class="cm">/* ucode antenna div helper */</span><span class="cp"></span>
<span class="cp">#define B43_HF_SYMW		0x000000000002ULL </span><span class="cm">/* G-PHY SYM workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_RXPULLW		0x000000000004ULL </span><span class="cm">/* RX pullup workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_CCKBOOST		0x000000000008ULL </span><span class="cm">/* 4dB CCK power boost (exclusive with OFDM boost) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_BTCOEX		0x000000000010ULL </span><span class="cm">/* Bluetooth coexistance */</span><span class="cp"></span>
<span class="cp">#define B43_HF_GDCW		0x000000000020ULL </span><span class="cm">/* G-PHY DC canceller filter bw workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_OFDMPABOOST	0x000000000040ULL </span><span class="cm">/* Enable PA gain boost for OFDM */</span><span class="cp"></span>
<span class="cp">#define B43_HF_ACPR		0x000000000080ULL </span><span class="cm">/* Disable for Japan, channel 14 */</span><span class="cp"></span>
<span class="cp">#define B43_HF_EDCF		0x000000000100ULL </span><span class="cm">/* on if WME and MAC suspended */</span><span class="cp"></span>
<span class="cp">#define B43_HF_TSSIRPSMW	0x000000000200ULL </span><span class="cm">/* TSSI reset PSM ucode workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_20IN40IQW	0x000000000200ULL </span><span class="cm">/* 20 in 40 MHz I/Q workaround (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_DSCRQ		0x000000000400ULL </span><span class="cm">/* Disable slow clock request in ucode */</span><span class="cp"></span>
<span class="cp">#define B43_HF_ACIW		0x000000000800ULL </span><span class="cm">/* ACI workaround: shift bits by 2 on PHY CRS */</span><span class="cp"></span>
<span class="cp">#define B43_HF_2060W		0x000000001000ULL </span><span class="cm">/* 2060 radio workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_RADARW		0x000000002000ULL </span><span class="cm">/* Radar workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_USEDEFKEYS	0x000000004000ULL </span><span class="cm">/* Enable use of default keys */</span><span class="cp"></span>
<span class="cp">#define B43_HF_AFTERBURNER	0x000000008000ULL </span><span class="cm">/* Afterburner enabled */</span><span class="cp"></span>
<span class="cp">#define B43_HF_BT4PRIOCOEX	0x000000010000ULL </span><span class="cm">/* Bluetooth 4-priority coexistance */</span><span class="cp"></span>
<span class="cp">#define B43_HF_FWKUP		0x000000020000ULL </span><span class="cm">/* Fast wake-up ucode */</span><span class="cp"></span>
<span class="cp">#define B43_HF_VCORECALC	0x000000040000ULL </span><span class="cm">/* Force VCO recalculation when powering up synthpu */</span><span class="cp"></span>
<span class="cp">#define B43_HF_PCISCW		0x000000080000ULL </span><span class="cm">/* PCI slow clock workaround */</span><span class="cp"></span>
<span class="cp">#define B43_HF_4318TSSI		0x000000200000ULL </span><span class="cm">/* 4318 TSSI */</span><span class="cp"></span>
<span class="cp">#define B43_HF_FBCMCFIFO	0x000000400000ULL </span><span class="cm">/* Flush bcast/mcast FIFO immediately */</span><span class="cp"></span>
<span class="cp">#define B43_HF_HWPCTL		0x000000800000ULL </span><span class="cm">/* Enable hardwarre power control */</span><span class="cp"></span>
<span class="cp">#define B43_HF_BTCOEXALT	0x000001000000ULL </span><span class="cm">/* Bluetooth coexistance in alternate pins */</span><span class="cp"></span>
<span class="cp">#define B43_HF_TXBTCHECK	0x000002000000ULL </span><span class="cm">/* Bluetooth check during transmission */</span><span class="cp"></span>
<span class="cp">#define B43_HF_SKCFPUP		0x000004000000ULL </span><span class="cm">/* Skip CFP update */</span><span class="cp"></span>
<span class="cp">#define B43_HF_N40W		0x000008000000ULL </span><span class="cm">/* N PHY 40 MHz workaround (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_ANTSEL		0x000020000000ULL </span><span class="cm">/* Antenna selection (for testing antenna div.) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_BT3COEXT		0x000020000000ULL </span><span class="cm">/* Bluetooth 3-wire coexistence (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_BTCANT		0x000040000000ULL </span><span class="cm">/* Bluetooth coexistence (antenna mode) (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_ANTSELEN		0x000100000000ULL </span><span class="cm">/* Antenna selection enabled (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_ANTSELMODE	0x000200000000ULL </span><span class="cm">/* Antenna selection mode (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_MLADVW		0x001000000000ULL </span><span class="cm">/* N PHY ML ADV workaround (rev &gt;= 13 only) */</span><span class="cp"></span>
<span class="cp">#define B43_HF_PR45960W		0x080000000000ULL </span><span class="cm">/* PR 45960 workaround (rev &gt;= 13 only) */</span><span class="cp"></span>

<span class="cm">/* Firmware capabilities field in SHM (Opensource firmware only) */</span>
<span class="cp">#define B43_FWCAPA_HWCRYPTO	0x0001</span>
<span class="cp">#define B43_FWCAPA_QOS		0x0002</span>

<span class="cm">/* MacFilter offsets. */</span>
<span class="cp">#define B43_MACFILTER_SELF		0x0000</span>
<span class="cp">#define B43_MACFILTER_BSSID		0x0003</span>

<span class="cm">/* PowerControl */</span>
<span class="cp">#define B43_PCTL_IN			0xB0</span>
<span class="cp">#define B43_PCTL_OUT			0xB4</span>
<span class="cp">#define B43_PCTL_OUTENABLE		0xB8</span>
<span class="cp">#define B43_PCTL_XTAL_POWERUP		0x40</span>
<span class="cp">#define B43_PCTL_PLL_POWERDOWN		0x80</span>

<span class="cm">/* PowerControl Clock Modes */</span>
<span class="cp">#define B43_PCTL_CLK_FAST		0x00</span>
<span class="cp">#define B43_PCTL_CLK_SLOW		0x01</span>
<span class="cp">#define B43_PCTL_CLK_DYNAMIC		0x02</span>

<span class="cp">#define B43_PCTL_FORCE_SLOW		0x0800</span>
<span class="cp">#define B43_PCTL_FORCE_PLL		0x1000</span>
<span class="cp">#define B43_PCTL_DYN_XTAL		0x2000</span>

<span class="cm">/* PHYVersioning */</span>
<span class="cp">#define B43_PHYTYPE_A			0x00</span>
<span class="cp">#define B43_PHYTYPE_B			0x01</span>
<span class="cp">#define B43_PHYTYPE_G			0x02</span>
<span class="cp">#define B43_PHYTYPE_N			0x04</span>
<span class="cp">#define B43_PHYTYPE_LP			0x05</span>
<span class="cp">#define B43_PHYTYPE_SSLPN		0x06</span>
<span class="cp">#define B43_PHYTYPE_HT			0x07</span>
<span class="cp">#define B43_PHYTYPE_LCN			0x08</span>
<span class="cp">#define B43_PHYTYPE_LCNXN		0x09</span>

<span class="cm">/* PHYRegisters */</span>
<span class="cp">#define B43_PHY_ILT_A_CTRL		0x0072</span>
<span class="cp">#define B43_PHY_ILT_A_DATA1		0x0073</span>
<span class="cp">#define B43_PHY_ILT_A_DATA2		0x0074</span>
<span class="cp">#define B43_PHY_G_LO_CONTROL		0x0810</span>
<span class="cp">#define B43_PHY_ILT_G_CTRL		0x0472</span>
<span class="cp">#define B43_PHY_ILT_G_DATA1		0x0473</span>
<span class="cp">#define B43_PHY_ILT_G_DATA2		0x0474</span>
<span class="cp">#define B43_PHY_A_PCTL			0x007B</span>
<span class="cp">#define B43_PHY_G_PCTL			0x0029</span>
<span class="cp">#define B43_PHY_A_CRS			0x0029</span>
<span class="cp">#define B43_PHY_RADIO_BITFIELD		0x0401</span>
<span class="cp">#define B43_PHY_G_CRS			0x0429</span>
<span class="cp">#define B43_PHY_NRSSILT_CTRL		0x0803</span>
<span class="cp">#define B43_PHY_NRSSILT_DATA		0x0804</span>

<span class="cm">/* RadioRegisters */</span>
<span class="cp">#define B43_RADIOCTL_ID			0x01</span>

<span class="cm">/* MAC Control bitfield */</span>
<span class="cp">#define B43_MACCTL_ENABLED		0x00000001	</span><span class="cm">/* MAC Enabled */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_PSM_RUN		0x00000002	</span><span class="cm">/* Run Microcode */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_PSM_JMP0		0x00000004	</span><span class="cm">/* Microcode jump to 0 */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_SHM_ENABLED		0x00000100	</span><span class="cm">/* SHM Enabled */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_SHM_UPPER		0x00000200	</span><span class="cm">/* SHM Upper */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_IHR_ENABLED		0x00000400	</span><span class="cm">/* IHR Region Enabled */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_PSM_DBG		0x00002000	</span><span class="cm">/* Microcode debugging enabled */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_GPOUTSMSK		0x0000C000	</span><span class="cm">/* GPOUT Select Mask */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_BE			0x00010000	</span><span class="cm">/* Big Endian mode */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_INFRA		0x00020000	</span><span class="cm">/* Infrastructure mode */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_AP			0x00040000	</span><span class="cm">/* AccessPoint mode */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_RADIOLOCK		0x00080000	</span><span class="cm">/* Radio lock */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_BEACPROMISC		0x00100000	</span><span class="cm">/* Beacon Promiscuous */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_KEEP_BADPLCP		0x00200000	</span><span class="cm">/* Keep frames with bad PLCP */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_KEEP_CTL		0x00400000	</span><span class="cm">/* Keep control frames */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_KEEP_BAD		0x00800000	</span><span class="cm">/* Keep bad frames (FCS) */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_PROMISC		0x01000000	</span><span class="cm">/* Promiscuous mode */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_HWPS			0x02000000	</span><span class="cm">/* Hardware Power Saving */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_AWAKE		0x04000000	</span><span class="cm">/* Device is awake */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_CLOSEDNET		0x08000000	</span><span class="cm">/* Closed net (no SSID bcast) */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_TBTTHOLD		0x10000000	</span><span class="cm">/* TBTT Hold */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_DISCTXSTAT		0x20000000	</span><span class="cm">/* Discard TX status */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_DISCPMQ		0x40000000	</span><span class="cm">/* Discard Power Management Queue */</span><span class="cp"></span>
<span class="cp">#define B43_MACCTL_GMODE		0x80000000	</span><span class="cm">/* G Mode */</span><span class="cp"></span>

<span class="cm">/* MAC Command bitfield */</span>
<span class="cp">#define B43_MACCMD_BEACON0_VALID	0x00000001	</span><span class="cm">/* Beacon 0 in template RAM is busy/valid */</span><span class="cp"></span>
<span class="cp">#define B43_MACCMD_BEACON1_VALID	0x00000002	</span><span class="cm">/* Beacon 1 in template RAM is busy/valid */</span><span class="cp"></span>
<span class="cp">#define B43_MACCMD_DFQ_VALID		0x00000004	</span><span class="cm">/* Directed frame queue valid (IBSS PS mode, ATIM) */</span><span class="cp"></span>
<span class="cp">#define B43_MACCMD_CCA			0x00000008	</span><span class="cm">/* Clear channel assessment */</span><span class="cp"></span>
<span class="cp">#define B43_MACCMD_BGNOISE		0x00000010	</span><span class="cm">/* Background noise */</span><span class="cp"></span>

<span class="cm">/* BCMA 802.11 core specific IO Control (BCMA_IOCTL) flags */</span>
<span class="cp">#define B43_BCMA_IOCTL_PHY_CLKEN	0x00000004	</span><span class="cm">/* PHY Clock Enable */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOCTL_PHY_RESET	0x00000008	</span><span class="cm">/* PHY Reset */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOCTL_MACPHYCLKEN	0x00000010	</span><span class="cm">/* MAC PHY Clock Control Enable */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOCTL_PLLREFSEL	0x00000020	</span><span class="cm">/* PLL Frequency Reference Select */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOCTL_PHY_BW		0x000000C0	</span><span class="cm">/* PHY band width and clock speed mask (N-PHY+ only?) */</span><span class="cp"></span>
<span class="cp">#define  B43_BCMA_IOCTL_PHY_BW_10MHZ	0x00000000	</span><span class="cm">/* 10 MHz bandwidth, 40 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define  B43_BCMA_IOCTL_PHY_BW_20MHZ	0x00000040	</span><span class="cm">/* 20 MHz bandwidth, 80 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define  B43_BCMA_IOCTL_PHY_BW_40MHZ	0x00000080	</span><span class="cm">/* 40 MHz bandwidth, 160 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOCTL_GMODE		0x00002000	</span><span class="cm">/* G Mode Enable */</span><span class="cp"></span>

<span class="cm">/* BCMA 802.11 core specific IO status (BCMA_IOST) flags */</span>
<span class="cp">#define B43_BCMA_IOST_2G_PHY		0x00000001	</span><span class="cm">/* 2.4G capable phy */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOST_5G_PHY		0x00000002	</span><span class="cm">/* 5G capable phy */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOST_FASTCLKA		0x00000004	</span><span class="cm">/* Fast Clock Available */</span><span class="cp"></span>
<span class="cp">#define B43_BCMA_IOST_DUALB_PHY		0x00000008	</span><span class="cm">/* Dualband phy */</span><span class="cp"></span>

<span class="cm">/* 802.11 core specific TM State Low (SSB_TMSLOW) flags */</span>
<span class="cp">#define B43_TMSLOW_GMODE		0x20000000	</span><span class="cm">/* G Mode Enable */</span><span class="cp"></span>
<span class="cp">#define B43_TMSLOW_PHY_BANDWIDTH	0x00C00000	</span><span class="cm">/* PHY band width and clock speed mask (N-PHY only) */</span><span class="cp"></span>
<span class="cp">#define  B43_TMSLOW_PHY_BANDWIDTH_10MHZ	0x00000000	</span><span class="cm">/* 10 MHz bandwidth, 40 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define  B43_TMSLOW_PHY_BANDWIDTH_20MHZ	0x00400000	</span><span class="cm">/* 20 MHz bandwidth, 80 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define  B43_TMSLOW_PHY_BANDWIDTH_40MHZ	0x00800000	</span><span class="cm">/* 40 MHz bandwidth, 160 MHz PHY */</span><span class="cp"></span>
<span class="cp">#define B43_TMSLOW_PLLREFSEL		0x00200000	</span><span class="cm">/* PLL Frequency Reference Select (rev &gt;= 5) */</span><span class="cp"></span>
<span class="cp">#define B43_TMSLOW_MACPHYCLKEN		0x00100000	</span><span class="cm">/* MAC PHY Clock Control Enable (rev &gt;= 5) */</span><span class="cp"></span>
<span class="cp">#define B43_TMSLOW_PHYRESET		0x00080000	</span><span class="cm">/* PHY Reset */</span><span class="cp"></span>
<span class="cp">#define B43_TMSLOW_PHYCLKEN		0x00040000	</span><span class="cm">/* PHY Clock Enable */</span><span class="cp"></span>

<span class="cm">/* 802.11 core specific TM State High (SSB_TMSHIGH) flags */</span>
<span class="cp">#define B43_TMSHIGH_DUALBAND_PHY	0x00080000	</span><span class="cm">/* Dualband PHY available */</span><span class="cp"></span>
<span class="cp">#define B43_TMSHIGH_FCLOCK		0x00040000	</span><span class="cm">/* Fast Clock Available (rev &gt;= 5) */</span><span class="cp"></span>
<span class="cp">#define B43_TMSHIGH_HAVE_5GHZ_PHY	0x00020000	</span><span class="cm">/* 5 GHz PHY available (rev &gt;= 5) */</span><span class="cp"></span>
<span class="cp">#define B43_TMSHIGH_HAVE_2GHZ_PHY	0x00010000	</span><span class="cm">/* 2.4 GHz PHY available (rev &gt;= 5) */</span><span class="cp"></span>

<span class="cm">/* Generic-Interrupt reasons. */</span>
<span class="cp">#define B43_IRQ_MAC_SUSPENDED		0x00000001</span>
<span class="cp">#define B43_IRQ_BEACON			0x00000002</span>
<span class="cp">#define B43_IRQ_TBTT_INDI		0x00000004</span>
<span class="cp">#define B43_IRQ_BEACON_TX_OK		0x00000008</span>
<span class="cp">#define B43_IRQ_BEACON_CANCEL		0x00000010</span>
<span class="cp">#define B43_IRQ_ATIM_END		0x00000020</span>
<span class="cp">#define B43_IRQ_PMQ			0x00000040</span>
<span class="cp">#define B43_IRQ_PIO_WORKAROUND		0x00000100</span>
<span class="cp">#define B43_IRQ_MAC_TXERR		0x00000200</span>
<span class="cp">#define B43_IRQ_PHY_TXERR		0x00000800</span>
<span class="cp">#define B43_IRQ_PMEVENT			0x00001000</span>
<span class="cp">#define B43_IRQ_TIMER0			0x00002000</span>
<span class="cp">#define B43_IRQ_TIMER1			0x00004000</span>
<span class="cp">#define B43_IRQ_DMA			0x00008000</span>
<span class="cp">#define B43_IRQ_TXFIFO_FLUSH_OK		0x00010000</span>
<span class="cp">#define B43_IRQ_CCA_MEASURE_OK		0x00020000</span>
<span class="cp">#define B43_IRQ_NOISESAMPLE_OK		0x00040000</span>
<span class="cp">#define B43_IRQ_UCODE_DEBUG		0x08000000</span>
<span class="cp">#define B43_IRQ_RFKILL			0x10000000</span>
<span class="cp">#define B43_IRQ_TX_OK			0x20000000</span>
<span class="cp">#define B43_IRQ_PHY_G_CHANGED		0x40000000</span>
<span class="cp">#define B43_IRQ_TIMEOUT			0x80000000</span>

<span class="cp">#define B43_IRQ_ALL			0xFFFFFFFF</span>
<span class="cp">#define B43_IRQ_MASKTEMPLATE		(B43_IRQ_TBTT_INDI | \</span>
<span class="cp">					 B43_IRQ_ATIM_END | \</span>
<span class="cp">					 B43_IRQ_PMQ | \</span>
<span class="cp">					 B43_IRQ_MAC_TXERR | \</span>
<span class="cp">					 B43_IRQ_PHY_TXERR | \</span>
<span class="cp">					 B43_IRQ_DMA | \</span>
<span class="cp">					 B43_IRQ_TXFIFO_FLUSH_OK | \</span>
<span class="cp">					 B43_IRQ_NOISESAMPLE_OK | \</span>
<span class="cp">					 B43_IRQ_UCODE_DEBUG | \</span>
<span class="cp">					 B43_IRQ_RFKILL | \</span>
<span class="cp">					 B43_IRQ_TX_OK)</span>

<span class="cm">/* The firmware register to fetch the debug-IRQ reason from. */</span>
<span class="cp">#define B43_DEBUGIRQ_REASON_REG		63</span>
<span class="cm">/* Debug-IRQ reasons. */</span>
<span class="cp">#define B43_DEBUGIRQ_PANIC		0	</span><span class="cm">/* The firmware panic&#39;ed */</span><span class="cp"></span>
<span class="cp">#define B43_DEBUGIRQ_DUMP_SHM		1	</span><span class="cm">/* Dump shared SHM */</span><span class="cp"></span>
<span class="cp">#define B43_DEBUGIRQ_DUMP_REGS		2	</span><span class="cm">/* Dump the microcode registers */</span><span class="cp"></span>
<span class="cp">#define B43_DEBUGIRQ_MARKER		3	</span><span class="cm">/* A &quot;marker&quot; was thrown by the firmware. */</span><span class="cp"></span>
<span class="cp">#define B43_DEBUGIRQ_ACK		0xFFFF	</span><span class="cm">/* The host writes that to ACK the IRQ */</span><span class="cp"></span>

<span class="cm">/* The firmware register that contains the &quot;marker&quot; line. */</span>
<span class="cp">#define B43_MARKER_ID_REG		2</span>
<span class="cp">#define B43_MARKER_LINE_REG		3</span>

<span class="cm">/* The firmware register to fetch the panic reason from. */</span>
<span class="cp">#define B43_FWPANIC_REASON_REG		3</span>
<span class="cm">/* Firmware panic reason codes */</span>
<span class="cp">#define B43_FWPANIC_DIE			0 </span><span class="cm">/* Firmware died. Don&#39;t auto-restart it. */</span><span class="cp"></span>
<span class="cp">#define B43_FWPANIC_RESTART		1 </span><span class="cm">/* Firmware died. Schedule a controller reset. */</span><span class="cp"></span>

<span class="cm">/* The firmware register that contains the watchdog counter. */</span>
<span class="cp">#define B43_WATCHDOG_REG		1</span>

<span class="cm">/* Device specific rate values.</span>
<span class="cm"> * The actual values defined here are (rate_in_mbps * 2).</span>
<span class="cm"> * Some code depends on this. Don&#39;t change it. */</span>
<span class="cp">#define B43_CCK_RATE_1MB		0x02</span>
<span class="cp">#define B43_CCK_RATE_2MB		0x04</span>
<span class="cp">#define B43_CCK_RATE_5MB		0x0B</span>
<span class="cp">#define B43_CCK_RATE_11MB		0x16</span>
<span class="cp">#define B43_OFDM_RATE_6MB		0x0C</span>
<span class="cp">#define B43_OFDM_RATE_9MB		0x12</span>
<span class="cp">#define B43_OFDM_RATE_12MB		0x18</span>
<span class="cp">#define B43_OFDM_RATE_18MB		0x24</span>
<span class="cp">#define B43_OFDM_RATE_24MB		0x30</span>
<span class="cp">#define B43_OFDM_RATE_36MB		0x48</span>
<span class="cp">#define B43_OFDM_RATE_48MB		0x60</span>
<span class="cp">#define B43_OFDM_RATE_54MB		0x6C</span>
<span class="cm">/* Convert a b43 rate value to a rate in 100kbps */</span>
<span class="cp">#define B43_RATE_TO_BASE100KBPS(rate)	(((rate) * 10) / 2)</span>

<span class="cp">#define B43_DEFAULT_SHORT_RETRY_LIMIT	7</span>
<span class="cp">#define B43_DEFAULT_LONG_RETRY_LIMIT	4</span>

<span class="cp">#define B43_PHY_TX_BADNESS_LIMIT	1000</span>

<span class="cm">/* Max size of a security key */</span>
<span class="cp">#define B43_SEC_KEYSIZE			16</span>
<span class="cm">/* Max number of group keys */</span>
<span class="cp">#define B43_NR_GROUP_KEYS		4</span>
<span class="cm">/* Max number of pairwise keys */</span>
<span class="cp">#define B43_NR_PAIRWISE_KEYS		50</span>
<span class="cm">/* Security algorithms. */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43_SEC_ALGO_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* unencrypted, as of TX header. */</span>
	<span class="n">B43_SEC_ALGO_WEP40</span><span class="p">,</span>
	<span class="n">B43_SEC_ALGO_TKIP</span><span class="p">,</span>
	<span class="n">B43_SEC_ALGO_AES</span><span class="p">,</span>
	<span class="n">B43_SEC_ALGO_WEP104</span><span class="p">,</span>
	<span class="n">B43_SEC_ALGO_AES_LEGACY</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43_dmaring</span><span class="p">;</span>

<span class="cm">/* The firmware file header */</span>
<span class="cp">#define B43_FW_TYPE_UCODE	&#39;u&#39;</span>
<span class="cp">#define B43_FW_TYPE_PCM		&#39;p&#39;</span>
<span class="cp">#define B43_FW_TYPE_IV		&#39;i&#39;</span>
<span class="k">struct</span> <span class="n">b43_fw_header</span> <span class="p">{</span>
	<span class="cm">/* File type */</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="cm">/* File format version */</span>
	<span class="n">u8</span> <span class="n">ver</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">__padding</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="cm">/* Size of the data. For ucode and PCM this is in bytes.</span>
<span class="cm">	 * For IV this is number-of-ivs. */</span>
	<span class="n">__be32</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* Initial Value file format */</span>
<span class="cp">#define B43_IV_OFFSET_MASK	0x7FFF</span>
<span class="cp">#define B43_IV_32BIT		0x8000</span>
<span class="k">struct</span> <span class="n">b43_iv</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">offset_size</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">__be16</span> <span class="n">d16</span><span class="p">;</span>
		<span class="n">__be32</span> <span class="n">d32</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">data</span> <span class="n">__packed</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>


<span class="cm">/* Data structures for DMA transmission, per 80211 core. */</span>
<span class="k">struct</span> <span class="n">b43_dma</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">tx_ring_AC_BK</span><span class="p">;</span> <span class="cm">/* Background */</span>
	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">tx_ring_AC_BE</span><span class="p">;</span> <span class="cm">/* Best Effort */</span>
	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">tx_ring_AC_VI</span><span class="p">;</span> <span class="cm">/* Video */</span>
	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">tx_ring_AC_VO</span><span class="p">;</span> <span class="cm">/* Voice */</span>
	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">tx_ring_mcast</span><span class="p">;</span> <span class="cm">/* Multicast */</span>

	<span class="k">struct</span> <span class="n">b43_dmaring</span> <span class="o">*</span><span class="n">rx_ring</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">translation</span><span class="p">;</span> <span class="cm">/* Routing bits */</span>
	<span class="n">bool</span> <span class="n">translation_in_low</span><span class="p">;</span> <span class="cm">/* Should translation bit go into low addr? */</span>
	<span class="n">bool</span> <span class="n">parity</span><span class="p">;</span> <span class="cm">/* Check for parity */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43_pio_txqueue</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">b43_pio_rxqueue</span><span class="p">;</span>

<span class="cm">/* Data structures for PIO transmission, per 80211 core. */</span>
<span class="k">struct</span> <span class="n">b43_pio</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">b43_pio_txqueue</span> <span class="o">*</span><span class="n">tx_queue_AC_BK</span><span class="p">;</span> <span class="cm">/* Background */</span>
	<span class="k">struct</span> <span class="n">b43_pio_txqueue</span> <span class="o">*</span><span class="n">tx_queue_AC_BE</span><span class="p">;</span> <span class="cm">/* Best Effort */</span>
	<span class="k">struct</span> <span class="n">b43_pio_txqueue</span> <span class="o">*</span><span class="n">tx_queue_AC_VI</span><span class="p">;</span> <span class="cm">/* Video */</span>
	<span class="k">struct</span> <span class="n">b43_pio_txqueue</span> <span class="o">*</span><span class="n">tx_queue_AC_VO</span><span class="p">;</span> <span class="cm">/* Voice */</span>
	<span class="k">struct</span> <span class="n">b43_pio_txqueue</span> <span class="o">*</span><span class="n">tx_queue_mcast</span><span class="p">;</span> <span class="cm">/* Multicast */</span>

	<span class="k">struct</span> <span class="n">b43_pio_rxqueue</span> <span class="o">*</span><span class="n">rx_queue</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Context information for a noise calculation (Link Quality). */</span>
<span class="k">struct</span> <span class="n">b43_noise_calculation</span> <span class="p">{</span>
	<span class="n">bool</span> <span class="n">calculation_running</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nr_samples</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">samples</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43_stats</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">link_noise</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43_key</span> <span class="p">{</span>
	<span class="cm">/* If keyconf is NULL, this key is disabled.</span>
<span class="cm">	 * keyconf is a cookie. Don&#39;t derefenrence it outside of the set_key</span>
<span class="cm">	 * path, because b43 doesn&#39;t own it. */</span>
	<span class="k">struct</span> <span class="n">ieee80211_key_conf</span> <span class="o">*</span><span class="n">keyconf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">algorithm</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* SHM offsets to the QOS data structures for the 4 different queues. */</span>
<span class="cp">#define B43_QOS_QUEUE_NUM	4</span>
<span class="cp">#define B43_QOS_PARAMS(queue)	(B43_SHM_SH_EDCFQ + \</span>
<span class="cp">				 (B43_NR_QOSPARAMS * sizeof(u16) * (queue)))</span>
<span class="cp">#define B43_QOS_BACKGROUND	B43_QOS_PARAMS(0)</span>
<span class="cp">#define B43_QOS_BESTEFFORT	B43_QOS_PARAMS(1)</span>
<span class="cp">#define B43_QOS_VIDEO		B43_QOS_PARAMS(2)</span>
<span class="cp">#define B43_QOS_VOICE		B43_QOS_PARAMS(3)</span>

<span class="cm">/* QOS parameter hardware data structure offsets. */</span>
<span class="cp">#define B43_NR_QOSPARAMS	16</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43_QOSPARAM_TXOP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_CWMIN</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_CWMAX</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_CWCUR</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_AIFS</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_BSLOTS</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_REGGAP</span><span class="p">,</span>
	<span class="n">B43_QOSPARAM_STATUS</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* QOS parameters for a queue. */</span>
<span class="k">struct</span> <span class="n">b43_qos_params</span> <span class="p">{</span>
	<span class="cm">/* The QOS parameters */</span>
	<span class="k">struct</span> <span class="n">ieee80211_tx_queue_params</span> <span class="n">p</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43_wl</span><span class="p">;</span>

<span class="cm">/* The type of the firmware file. */</span>
<span class="k">enum</span> <span class="n">b43_firmware_file_type</span> <span class="p">{</span>
	<span class="n">B43_FWTYPE_PROPRIETARY</span><span class="p">,</span>
	<span class="n">B43_FWTYPE_OPENSOURCE</span><span class="p">,</span>
	<span class="n">B43_NR_FWTYPES</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Context data for fetching firmware. */</span>
<span class="k">struct</span> <span class="n">b43_request_fw_context</span> <span class="p">{</span>
	<span class="cm">/* The device we are requesting the fw for. */</span>
	<span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="cm">/* The type of firmware to request. */</span>
	<span class="k">enum</span> <span class="n">b43_firmware_file_type</span> <span class="n">req_type</span><span class="p">;</span>
	<span class="cm">/* Error messages for each firmware type. */</span>
	<span class="kt">char</span> <span class="n">errors</span><span class="p">[</span><span class="n">B43_NR_FWTYPES</span><span class="p">][</span><span class="mi">128</span><span class="p">];</span>
	<span class="cm">/* Temporary buffer for storing the firmware name. */</span>
	<span class="kt">char</span> <span class="n">fwname</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="cm">/* A fatal error occurred while requesting. Firmware request</span>
<span class="cm">	 * can not continue, as any other request will also fail. */</span>
	<span class="kt">int</span> <span class="n">fatal_failure</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* In-memory representation of a cached microcode file. */</span>
<span class="k">struct</span> <span class="n">b43_firmware_file</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
	<span class="cm">/* Type of the firmware file name. Note that this does only indicate</span>
<span class="cm">	 * the type by the firmware name. NOT the file contents.</span>
<span class="cm">	 * If you want to check for proprietary vs opensource, use (struct b43_firmware)-&gt;opensource</span>
<span class="cm">	 * instead! The (struct b43_firmware)-&gt;opensource flag is derived from the actual firmware</span>
<span class="cm">	 * binary code, not just the filename.</span>
<span class="cm">	 */</span>
	<span class="k">enum</span> <span class="n">b43_firmware_file_type</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">b43_firmware_hdr_format</span> <span class="p">{</span>
	<span class="n">B43_FW_HDR_598</span><span class="p">,</span>
	<span class="n">B43_FW_HDR_410</span><span class="p">,</span>
	<span class="n">B43_FW_HDR_351</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Pointers to the firmware data and meta information about it. */</span>
<span class="k">struct</span> <span class="n">b43_firmware</span> <span class="p">{</span>
	<span class="cm">/* Microcode */</span>
	<span class="k">struct</span> <span class="n">b43_firmware_file</span> <span class="n">ucode</span><span class="p">;</span>
	<span class="cm">/* PCM code */</span>
	<span class="k">struct</span> <span class="n">b43_firmware_file</span> <span class="n">pcm</span><span class="p">;</span>
	<span class="cm">/* Initial MMIO values for the firmware */</span>
	<span class="k">struct</span> <span class="n">b43_firmware_file</span> <span class="n">initvals</span><span class="p">;</span>
	<span class="cm">/* Initial MMIO values for the firmware, band-specific */</span>
	<span class="k">struct</span> <span class="n">b43_firmware_file</span> <span class="n">initvals_band</span><span class="p">;</span>

	<span class="cm">/* Firmware revision */</span>
	<span class="n">u16</span> <span class="n">rev</span><span class="p">;</span>
	<span class="cm">/* Firmware patchlevel */</span>
	<span class="n">u16</span> <span class="n">patch</span><span class="p">;</span>

	<span class="cm">/* Format of header used by firmware */</span>
	<span class="k">enum</span> <span class="n">b43_firmware_hdr_format</span> <span class="n">hdr_format</span><span class="p">;</span>

	<span class="cm">/* Set to true, if we are using an opensource firmware.</span>
<span class="cm">	 * Use this to check for proprietary vs opensource. */</span>
	<span class="n">bool</span> <span class="n">opensource</span><span class="p">;</span>
	<span class="cm">/* Set to true, if the core needs a PCM firmware, but</span>
<span class="cm">	 * we failed to load one. This is always false for</span>
<span class="cm">	 * core rev &gt; 10, as these don&#39;t need PCM firmware. */</span>
	<span class="n">bool</span> <span class="n">pcm_request_failed</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Device (802.11 core) initialization status. */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43_STAT_UNINIT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Uninitialized. */</span>
	<span class="n">B43_STAT_INITIALIZED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Initialized, but not started, yet. */</span>
	<span class="n">B43_STAT_STARTED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Up and running. */</span>
<span class="p">};</span>
<span class="cp">#define b43_status(wldev)		atomic_read(&amp;(wldev)-&gt;__init_status)</span>
<span class="cp">#define b43_set_status(wldev, stat)	do {			\</span>
<span class="cp">		atomic_set(&amp;(wldev)-&gt;__init_status, (stat));	\</span>
<span class="cp">		smp_wmb();					\</span>
<span class="cp">					} while (0)</span>

<span class="cm">/* Data structure for one wireless device (802.11 core) */</span>
<span class="k">struct</span> <span class="n">b43_wldev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">b43_bus_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">;</span>

	<span class="cm">/* The device initialization status.</span>
<span class="cm">	 * Use b43_status() to query. */</span>
	<span class="n">atomic_t</span> <span class="n">__init_status</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">bad_frames_preempt</span><span class="p">;</span>	<span class="cm">/* Use &quot;Bad Frames Preemption&quot; (default off) */</span>
	<span class="n">bool</span> <span class="n">dfq_valid</span><span class="p">;</span>		<span class="cm">/* Directed frame queue valid (IBSS PS mode, ATIM) */</span>
	<span class="n">bool</span> <span class="n">radio_hw_enable</span><span class="p">;</span>	<span class="cm">/* saved state of radio hardware enabled state */</span>
	<span class="n">bool</span> <span class="n">qos_enabled</span><span class="p">;</span>		<span class="cm">/* TRUE, if QoS is used. */</span>
	<span class="n">bool</span> <span class="n">hwcrypto_enabled</span><span class="p">;</span>		<span class="cm">/* TRUE, if HW crypto acceleration is enabled. */</span>
	<span class="n">bool</span> <span class="n">use_pio</span><span class="p">;</span>			<span class="cm">/* TRUE if next init should use PIO */</span>

	<span class="cm">/* PHY/Radio device. */</span>
	<span class="k">struct</span> <span class="n">b43_phy</span> <span class="n">phy</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="cm">/* DMA engines. */</span>
		<span class="k">struct</span> <span class="n">b43_dma</span> <span class="n">dma</span><span class="p">;</span>
		<span class="cm">/* PIO engines. */</span>
		<span class="k">struct</span> <span class="n">b43_pio</span> <span class="n">pio</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="cm">/* Use b43_using_pio_transfers() to check whether we are using</span>
<span class="cm">	 * DMA or PIO data transfers. */</span>
	<span class="n">bool</span> <span class="n">__using_pio_transfers</span><span class="p">;</span>

	<span class="cm">/* Various statistics about the physical device. */</span>
	<span class="k">struct</span> <span class="n">b43_stats</span> <span class="n">stats</span><span class="p">;</span>

	<span class="cm">/* Reason code of the last interrupt. */</span>
	<span class="n">u32</span> <span class="n">irq_reason</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_reason</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="cm">/* The currently active generic-interrupt mask. */</span>
	<span class="n">u32</span> <span class="n">irq_mask</span><span class="p">;</span>

	<span class="cm">/* Link Quality calculation context. */</span>
	<span class="k">struct</span> <span class="n">b43_noise_calculation</span> <span class="n">noisecalc</span><span class="p">;</span>
	<span class="cm">/* if &gt; 0 MAC is suspended. if == 0 MAC is enabled. */</span>
	<span class="kt">int</span> <span class="n">mac_suspended</span><span class="p">;</span>

	<span class="cm">/* Periodic tasks */</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">periodic_work</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">periodic_state</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">restart_work</span><span class="p">;</span>

	<span class="cm">/* encryption/decryption */</span>
	<span class="n">u16</span> <span class="n">ktp</span><span class="p">;</span>		<span class="cm">/* Key table pointer */</span>
	<span class="k">struct</span> <span class="n">b43_key</span> <span class="n">key</span><span class="p">[</span><span class="n">B43_NR_GROUP_KEYS</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">B43_NR_PAIRWISE_KEYS</span><span class="p">];</span>

	<span class="cm">/* Firmware data */</span>
	<span class="k">struct</span> <span class="n">b43_firmware</span> <span class="n">fw</span><span class="p">;</span>

	<span class="cm">/* Devicelist in struct b43_wl (all 802.11 cores) */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* Debugging stuff follows. */</span>
<span class="cp">#ifdef CONFIG_B43_DEBUG</span>
	<span class="k">struct</span> <span class="n">b43_dfsentry</span> <span class="o">*</span><span class="n">dfsentry</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq_bit_count</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_count</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cm">/* Data structure for the WLAN parts (802.11 cores) of the b43 chip. */</span>
<span class="k">struct</span> <span class="n">b43_wl</span> <span class="p">{</span>
	<span class="cm">/* Pointer to the active wireless device on this chip */</span>
	<span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">current_dev</span><span class="p">;</span>
	<span class="cm">/* Pointer to the ieee80211 hardware data structure */</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>

	<span class="cm">/* Global driver mutex. Every operation must run with this mutex locked. */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>
	<span class="cm">/* Hard-IRQ spinlock. This lock protects things used in the hard-IRQ</span>
<span class="cm">	 * handler, only. This basically is just the IRQ mask register. */</span>
	<span class="n">spinlock_t</span> <span class="n">hardirq_lock</span><span class="p">;</span>

	<span class="cm">/* The number of queues that were registered with the mac80211 subsystem</span>
<span class="cm">	 * initially. This is a backup copy of hw-&gt;queues in case hw-&gt;queues has</span>
<span class="cm">	 * to be dynamically lowered at runtime (Firmware does not support QoS).</span>
<span class="cm">	 * hw-&gt;queues has to be restored to the original value before unregistering</span>
<span class="cm">	 * from the mac80211 subsystem. */</span>
	<span class="n">u16</span> <span class="n">mac80211_initially_registered_queues</span><span class="p">;</span>

	<span class="cm">/* Set this if we call ieee80211_register_hw() and check if we call</span>
<span class="cm">	 * ieee80211_unregister_hw(). */</span>
	<span class="n">bool</span> <span class="n">hw_registred</span><span class="p">;</span>

	<span class="cm">/* We can only have one operating interface (802.11 core)</span>
<span class="cm">	 * at a time. General information about this interface follows.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">vif</span><span class="p">;</span>
	<span class="cm">/* The MAC address of the operating interface. */</span>
	<span class="n">u8</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="cm">/* Current BSSID */</span>
	<span class="n">u8</span> <span class="n">bssid</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="cm">/* Interface type. (NL80211_IFTYPE_XXX) */</span>
	<span class="kt">int</span> <span class="n">if_type</span><span class="p">;</span>
	<span class="cm">/* Is the card operating in AP, STA or IBSS mode? */</span>
	<span class="n">bool</span> <span class="n">operating</span><span class="p">;</span>
	<span class="cm">/* filter flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">filter_flags</span><span class="p">;</span>
	<span class="cm">/* Stats about the wireless interface */</span>
	<span class="k">struct</span> <span class="n">ieee80211_low_level_stats</span> <span class="n">ieee_stats</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_B43_HWRNG</span>
	<span class="k">struct</span> <span class="n">hwrng</span> <span class="n">rng</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">rng_initialized</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">rng_name</span><span class="p">[</span><span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_B43_HWRNG */</span><span class="cp"></span>

	<span class="cm">/* List of all wireless devices on this chip */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">devlist</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nr_devs</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">radiotap_enabled</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">radio_enabled</span><span class="p">;</span>

	<span class="cm">/* The beacon we are currently using (AP or IBSS mode). */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">current_beacon</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon0_uploaded</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon1_uploaded</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon_templates_virgin</span><span class="p">;</span> <span class="cm">/* Never wrote the templates? */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">beacon_update_trigger</span><span class="p">;</span>

	<span class="cm">/* The current QOS parameters for the 4 queues. */</span>
	<span class="k">struct</span> <span class="n">b43_qos_params</span> <span class="n">qos_params</span><span class="p">[</span><span class="n">B43_QOS_QUEUE_NUM</span><span class="p">];</span>

	<span class="cm">/* Work for adjustment of the transmission power.</span>
<span class="cm">	 * This is scheduled when we determine that the actual TX output</span>
<span class="cm">	 * power doesn&#39;t match what we want. */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">txpower_adjust_work</span><span class="p">;</span>

	<span class="cm">/* Packet transmit work */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tx_work</span><span class="p">;</span>

	<span class="cm">/* Queue of packets to be transmitted. */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">tx_queue</span><span class="p">[</span><span class="n">B43_QOS_QUEUE_NUM</span><span class="p">];</span>

	<span class="cm">/* Flag that implement the queues stopping. */</span>
	<span class="n">bool</span> <span class="n">tx_queue_stopped</span><span class="p">[</span><span class="n">B43_QOS_QUEUE_NUM</span><span class="p">];</span>

	<span class="cm">/* firmware loading work */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">firmware_load</span><span class="p">;</span>

	<span class="cm">/* The device LEDs. */</span>
	<span class="k">struct</span> <span class="n">b43_leds</span> <span class="n">leds</span><span class="p">;</span>

	<span class="cm">/* Kmalloc&#39;ed scratch space for PIO TX/RX. Protected by wl-&gt;mutex. */</span>
	<span class="n">u8</span> <span class="n">pio_scratchspace</span><span class="p">[</span><span class="mi">118</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">__aligned__</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
	<span class="n">u8</span> <span class="n">pio_tailspace</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">__aligned__</span><span class="p">(</span><span class="mi">8</span><span class="p">)));</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="nf">hw_to_b43_wl</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="nf">dev_to_b43_wldev</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">ssb_dev</span> <span class="o">=</span> <span class="n">dev_to_ssb_dev</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ssb_get_drvdata</span><span class="p">(</span><span class="n">ssb_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Is the device operating in a specified mode (NL80211_IFTYPE_XXX). */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">b43_is_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">operating</span> <span class="o">&amp;&amp;</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">if_type</span> <span class="o">==</span> <span class="n">type</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * b43_current_band - Returns the currently used band.</span>
<span class="cm"> * Returns one of IEEE80211_BAND_2GHZ and IEEE80211_BAND_5GHZ.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">enum</span> <span class="n">ieee80211_band</span> <span class="nf">b43_current_band</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">.</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">band</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">b43_bus_may_powerdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">wldev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bus_may_powerdown</span><span class="p">(</span><span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">b43_bus_powerup</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">wldev</span><span class="p">,</span> <span class="n">bool</span> <span class="n">dynamic_pctl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bus_powerup</span><span class="p">(</span><span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">dynamic_pctl</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">b43_device_is_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">wldev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">device_is_enabled</span><span class="p">(</span><span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_device_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">wldev</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="n">core_specific_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">device_enable</span><span class="p">(</span><span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">core_specific_flags</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_device_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">wldev</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">core_specific_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">device_disable</span><span class="p">(</span><span class="n">wldev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">core_specific_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">b43_read16</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">read16</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_write16</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">write16</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_maskset16</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="n">mask</span><span class="p">,</span>
				 <span class="n">u16</span> <span class="n">set</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">b43_write16</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="p">(</span><span class="n">b43_read16</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">|</span> <span class="n">set</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">b43_read32</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">read32</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_write32</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">write32</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_maskset32</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
				 <span class="n">u32</span> <span class="n">set</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">b43_write32</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="p">(</span><span class="n">b43_read32</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">|</span> <span class="n">set</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_block_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
				 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg_width</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">block_read</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">reg_width</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">b43_block_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
				   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg_width</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">block_write</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">reg_width</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">b43_using_pio_transfers</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">__using_pio_transfers</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Message printing */</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">void</span> <span class="n">b43info</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">void</span> <span class="n">b43err</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">void</span> <span class="n">b43warn</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">void</span> <span class="n">b43dbg</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>


<span class="cm">/* A WARN_ON variant that vanishes when b43 debugging is disabled.</span>
<span class="cm"> * This _also_ evaluates the arg with debugging disabled. */</span>
<span class="cp">#if B43_DEBUG</span>
<span class="cp"># define B43_WARN_ON(x)	WARN_ON(x)</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__b43_warn_on_dummy</span><span class="p">(</span><span class="n">bool</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
<span class="cp"># define B43_WARN_ON(x)	__b43_warn_on_dummy(unlikely(!!(x)))</span>
<span class="cp">#endif</span>

<span class="cm">/* Convert an integer to a Q5.2 value */</span>
<span class="cp">#define INT_TO_Q52(i)	((i) &lt;&lt; 2)</span>
<span class="cm">/* Convert a Q5.2 value to an integer (precision loss!) */</span>
<span class="cp">#define Q52_TO_INT(q52)	((q52) &gt;&gt; 2)</span>
<span class="cm">/* Macros for printing a value in Q5.2 format */</span>
<span class="cp">#define Q52_FMT		&quot;%u.%u&quot;</span>
<span class="cp">#define Q52_ARG(q52)	Q52_TO_INT(q52), ((((q52) &amp; 0x3) * 100) / 4)</span>

<span class="cp">#endif </span><span class="cm">/* B43_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
