<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › iwlegacy › 3945.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>3945.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2003 - 2011 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> *  Intel Linux Wireless &lt;ilw@linux.intel.com&gt;</span>
<span class="cm"> * Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************************/</span>

<span class="cp">#ifndef __il_3945_h__</span>
<span class="cp">#define __il_3945_h__</span>

<span class="cp">#include &lt;linux/pci.h&gt;		</span><span class="cm">/* for struct pci_device_id */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;net/ieee80211_radiotap.h&gt;</span>

<span class="cm">/* Hardware specific file defines the PCI IDs table for that hardware module */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pci_device_id</span> <span class="n">il3945_hw_card_ids</span><span class="p">[];</span>

<span class="cp">#include &quot;common.h&quot;</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">il_ops</span> <span class="n">il3945_ops</span><span class="p">;</span>

<span class="cm">/* Highest firmware API version supported */</span>
<span class="cp">#define IL3945_UCODE_API_MAX 2</span>

<span class="cm">/* Lowest firmware API version supported */</span>
<span class="cp">#define IL3945_UCODE_API_MIN 1</span>

<span class="cp">#define IL3945_FW_PRE	&quot;iwlwifi-3945-&quot;</span>
<span class="cp">#define _IL3945_MODULE_FIRMWARE(api) IL3945_FW_PRE #api &quot;.ucode&quot;</span>
<span class="cp">#define IL3945_MODULE_FIRMWARE(api) _IL3945_MODULE_FIRMWARE(api)</span>

<span class="cm">/* Default noise level to report when noise measurement is not available.</span>
<span class="cm"> *   This may be because we&#39;re:</span>
<span class="cm"> *   1)  Not associated (4965, no beacon stats being sent to driver)</span>
<span class="cm"> *   2)  Scanning (noise measurement does not apply to associated channel)</span>
<span class="cm"> *   3)  Receiving CCK (3945 delivers noise info only for OFDM frames)</span>
<span class="cm"> * Use default noise value of -127 ... this is below the range of measurable</span>
<span class="cm"> *   Rx dBm for either 3945 or 4965, so it can indicate &quot;unmeasurable&quot; to user.</span>
<span class="cm"> *   Also, -127 works better than 0 when averaging frames with/without</span>
<span class="cm"> *   noise info (e.g. averaging might be done in app); measured dBm values are</span>
<span class="cm"> *   always negative ... using a negative value as the default keeps all</span>
<span class="cm"> *   averages within an s8&#39;s (used in some apps) range of negative values. */</span>
<span class="cp">#define IL_NOISE_MEAS_NOT_AVAILABLE (-127)</span>

<span class="cm">/* Module parameters accessible from iwl-*.c */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">il_mod_params</span> <span class="n">il3945_mod_params</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">il3945_rate_scale_data</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">success_counter</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">success_ratio</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">counter</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">average_tpt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">stamp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">il3945_rs_sta</span> <span class="p">{</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">;</span>
	<span class="n">s32</span> <span class="o">*</span><span class="n">expected_tpt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_partial_flush</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_flush</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flush_time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_tx_packets</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_packets</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tgg</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flush_pending</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">start_rate</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">rate_scale_flush</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">il3945_rate_scale_data</span> <span class="n">win</span><span class="p">[</span><span class="n">RATE_COUNT_3945</span><span class="p">];</span>
<span class="cp">#ifdef CONFIG_MAC80211_DEBUGFS</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rs_sta_dbgfs_stats_table_file</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="cm">/* used to be in sta_info */</span>
	<span class="kt">int</span> <span class="n">last_txrate_idx</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The common struct MUST be first because it is shared between</span>
<span class="cm"> * 3945 and 4965!</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">il3945_sta_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">il_station_priv_common</span> <span class="n">common</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">il3945_rs_sta</span> <span class="n">rs_sta</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">il3945_antenna</span> <span class="p">{</span>
	<span class="n">IL_ANTENNA_DIVERSITY</span><span class="p">,</span>
	<span class="n">IL_ANTENNA_MAIN</span><span class="p">,</span>
	<span class="n">IL_ANTENNA_AUX</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * RTS threshold here is total size [2347] minus 4 FCS bytes</span>
<span class="cm"> * Per spec:</span>
<span class="cm"> *   a value of 0 means RTS on all data/management packets</span>
<span class="cm"> *   a value &gt; max MSDU size means no RTS</span>
<span class="cm"> * else RTS for data/management frames where MPDU is larger</span>
<span class="cm"> *   than RTS value.</span>
<span class="cm"> */</span>
<span class="cp">#define DEFAULT_RTS_THRESHOLD     2347U</span>
<span class="cp">#define MIN_RTS_THRESHOLD         0U</span>
<span class="cp">#define MAX_RTS_THRESHOLD         2347U</span>
<span class="cp">#define MAX_MSDU_SIZE		  2304U</span>
<span class="cp">#define MAX_MPDU_SIZE		  2346U</span>
<span class="cp">#define DEFAULT_BEACON_INTERVAL   100U</span>
<span class="cp">#define	DEFAULT_SHORT_RETRY_LIMIT 7U</span>
<span class="cp">#define	DEFAULT_LONG_RETRY_LIMIT  4U</span>

<span class="cp">#define IL_TX_FIFO_AC0	0</span>
<span class="cp">#define IL_TX_FIFO_AC1	1</span>
<span class="cp">#define IL_TX_FIFO_AC2	2</span>
<span class="cp">#define IL_TX_FIFO_AC3	3</span>
<span class="cp">#define IL_TX_FIFO_HCCA_1	5</span>
<span class="cp">#define IL_TX_FIFO_HCCA_2	6</span>
<span class="cp">#define IL_TX_FIFO_NONE	7</span>

<span class="cp">#define IEEE80211_DATA_LEN              2304</span>
<span class="cp">#define IEEE80211_4ADDR_LEN             30</span>
<span class="cp">#define IEEE80211_HLEN                  (IEEE80211_4ADDR_LEN)</span>
<span class="cp">#define IEEE80211_FRAME_LEN             (IEEE80211_DATA_LEN + IEEE80211_HLEN)</span>

<span class="k">struct</span> <span class="n">il3945_frame</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">frame</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">il3945_tx_beacon_cmd</span> <span class="n">beacon</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">raw</span><span class="p">[</span><span class="n">IEEE80211_FRAME_LEN</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">360</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SEQ_TO_SN(seq) (((seq) &amp; IEEE80211_SCTL_SEQ) &gt;&gt; 4)</span>
<span class="cp">#define SN_TO_SEQ(ssn) (((ssn) &lt;&lt; 4) &amp; IEEE80211_SCTL_SEQ)</span>
<span class="cp">#define MAX_SN ((IEEE80211_SCTL_SEQ) &gt;&gt; 4)</span>

<span class="cp">#define SUP_RATE_11A_MAX_NUM_CHANNELS  8</span>
<span class="cp">#define SUP_RATE_11B_MAX_NUM_CHANNELS  4</span>
<span class="cp">#define SUP_RATE_11G_MAX_NUM_CHANNELS  12</span>

<span class="cp">#define IL_SUPPORTED_RATES_IE_LEN         8</span>

<span class="cp">#define SCAN_INTERVAL 100</span>

<span class="cp">#define MAX_TID_COUNT        9</span>

<span class="cp">#define IL_INVALID_RATE     0xFF</span>
<span class="cp">#define IL_INVALID_VALUE    -1</span>

<span class="cp">#define STA_PS_STATUS_WAKE             0</span>
<span class="cp">#define STA_PS_STATUS_SLEEP            1</span>

<span class="k">struct</span> <span class="n">il3945_ibss_seq</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">seq_num</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">frag_num</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">packet_time</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IL_RX_HDR(x) ((struct il3945_rx_frame_hdr *)(\</span>
<span class="cp">		       x-&gt;u.rx_frame.stats.payload + \</span>
<span class="cp">		       x-&gt;u.rx_frame.stats.phy_count))</span>
<span class="cp">#define IL_RX_END(x) ((struct il3945_rx_frame_end *)(\</span>
<span class="cp">		       IL_RX_HDR(x)-&gt;payload + \</span>
<span class="cp">		       le16_to_cpu(IL_RX_HDR(x)-&gt;len)))</span>
<span class="cp">#define IL_RX_STATS(x) (&amp;x-&gt;u.rx_frame.stats)</span>
<span class="cp">#define IL_RX_DATA(x) (IL_RX_HDR(x)-&gt;payload)</span>

<span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Functions implemented in iwl3945-base.c which are forward declared here</span>
<span class="cm"> * for use by iwl-*.c</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************************/</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_calc_db_from_ratio</span><span class="p">(</span><span class="kt">int</span> <span class="n">sig_ratio</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_rx_replenish</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_rx_queue_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_rx_queue</span> <span class="o">*</span><span class="n">rxq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">il3945_fill_beacon_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span>
					     <span class="kt">int</span> <span class="n">left</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_dump_nic_event_log</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="n">bool</span> <span class="n">full_log</span><span class="p">,</span>
				     <span class="kt">char</span> <span class="o">**</span><span class="n">buf</span><span class="p">,</span> <span class="n">bool</span> <span class="n">display</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_dump_nic_error_log</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>

<span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Functions implemented in iwl-[34]*.c which are forward declared here</span>
<span class="cm"> * for use by iwl3945-base.c</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE:  The implementation of these functions are hardware specific</span>
<span class="cm"> * which is why they are in the hardware specific files (vs. iwl-base.c)</span>
<span class="cm"> *</span>
<span class="cm"> * Naming convention --</span>
<span class="cm"> * il3945_         &lt;-- Its part of iwlwifi (should be changed to il3945_)</span>
<span class="cm"> * il3945_hw_      &lt;-- Hardware specific (implemented in iwl-XXXX.c by all HW)</span>
<span class="cm"> * iwlXXXX_     &lt;-- Hardware specific (implemented in iwl-XXXX.c for XXXX)</span>
<span class="cm"> * il3945_bg_      &lt;-- Called from work queue context</span>
<span class="cm"> * il3945_mac_     &lt;-- mac80211 callback</span>
<span class="cm"> *</span>
<span class="cm"> ****************************************************************************/</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_handler_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_setup_deferred_work</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_cancel_deferred_work</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_rxq_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_set_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_nic_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_nic_stop_master</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_txq_ctx_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_txq_ctx_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_nic_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_txq_attach_buf_to_tfd</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">il_tx_queue</span> <span class="o">*</span><span class="n">txq</span><span class="p">,</span>
					   <span class="n">dma_addr_t</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reset</span><span class="p">,</span>
					   <span class="n">u8</span> <span class="n">pad</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hw_txq_free_tfd</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_tx_queue</span> <span class="o">*</span><span class="n">txq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_get_temperature</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_tx_queue_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_tx_queue</span> <span class="o">*</span><span class="n">txq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">il3945_hw_get_beacon_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">il3945_frame</span> <span class="o">*</span><span class="n">frame</span><span class="p">,</span>
					     <span class="n">u8</span> <span class="n">rate</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">il3945_hw_build_tx_cmd_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_device_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">ieee80211_tx_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sta_id</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_reg_send_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_hw_reg_set_txpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="n">s8</span> <span class="n">power</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_hdl_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_rx_buf</span> <span class="o">*</span><span class="n">rxb</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">il3945_hdl_c_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">il_rx_buf</span> <span class="o">*</span><span class="n">rxb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_disable_events</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il4965_get_temperature</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_post_associate</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_config_ap</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_commit_rxon</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * il3945_hw_find_station - Find station id for a given BSSID</span>
<span class="cm"> * @bssid: MAC address of station ID to find</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE:  This should not be hardware specific but the code has</span>
<span class="cm"> * not yet been merged into a single common layer for managing the</span>
<span class="cm"> * station tables.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">u8</span> <span class="n">il3945_hw_find_station</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span> <span class="n">bssid</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">__le32</span> <span class="n">il3945_get_antenna_flags</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_init_hw_rate_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">il3945_reg_txpower_periodic</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_txpower_set_from_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">il3945_rs_next_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>

<span class="cm">/* scanning */</span>
<span class="kt">int</span> <span class="n">il3945_request_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">vif</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">il3945_post_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">il_priv</span> <span class="o">*</span><span class="n">il</span><span class="p">);</span>

<span class="cm">/* rates */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">il3945_rate_info</span> <span class="n">il3945_rates</span><span class="p">[</span><span class="n">RATE_COUNT_3945</span><span class="p">];</span>

<span class="cm">/* RSSI to dBm */</span>
<span class="cp">#define IL39_RSSI_OFFSET	95</span>

<span class="cm">/*</span>
<span class="cm"> * EEPROM related constants, enums, and structures.</span>
<span class="cm"> */</span>
<span class="cp">#define EEPROM_SKU_CAP_OP_MODE_MRC                      (1 &lt;&lt; 7)</span>

<span class="cm">/*</span>
<span class="cm"> * Mapping of a Tx power level, at factory calibration temperature,</span>
<span class="cm"> *   to a radio/DSP gain table idx.</span>
<span class="cm"> * One for each of 5 &quot;sample&quot; power levels in each band.</span>
<span class="cm"> * v_det is measured at the factory, using the 3945&#39;s built-in power amplifier</span>
<span class="cm"> *   (PA) output voltage detector.  This same detector is used during Tx of</span>
<span class="cm"> *   long packets in normal operation to provide feedback as to proper output</span>
<span class="cm"> *   level.</span>
<span class="cm"> * Data copied from EEPROM.</span>
<span class="cm"> * DO NOT ALTER THIS STRUCTURE!!!</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">il3945_eeprom_txpower_sample</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">gain_idx</span><span class="p">;</span>		<span class="cm">/* idx into power (gain) setup table ... */</span>
	<span class="n">s8</span> <span class="n">power</span><span class="p">;</span>		<span class="cm">/* ... for this pwr level for this chnl group */</span>
	<span class="n">u16</span> <span class="n">v_det</span><span class="p">;</span>		<span class="cm">/* PA output voltage */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Mappings of Tx power levels -&gt; nominal radio/DSP gain table idxes.</span>
<span class="cm"> * One for each channel group (a.k.a. &quot;band&quot;) (1 for BG, 4 for A).</span>
<span class="cm"> * Tx power setup code interpolates between the 5 &quot;sample&quot; power levels</span>
<span class="cm"> *    to determine the nominal setup for a requested power level.</span>
<span class="cm"> * Data copied from EEPROM.</span>
<span class="cm"> * DO NOT ALTER THIS STRUCTURE!!!</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">il3945_eeprom_txpower_group</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">il3945_eeprom_txpower_sample</span> <span class="n">samples</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>	<span class="cm">/* 5 power levels */</span>
	<span class="n">s32</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">e</span><span class="p">;</span>	<span class="cm">/* coefficients for voltage-&gt;power</span>
<span class="cm">				 * formula (signed) */</span>
	<span class="n">s32</span> <span class="n">Fa</span><span class="p">,</span> <span class="n">Fb</span><span class="p">,</span> <span class="n">Fc</span><span class="p">,</span> <span class="n">Fd</span><span class="p">,</span> <span class="n">Fe</span><span class="p">;</span>	<span class="cm">/* these modify coeffs based on</span>
<span class="cm">				 * frequency (signed) */</span>
	<span class="n">s8</span> <span class="n">saturation_power</span><span class="p">;</span>	<span class="cm">/* highest power possible by h/w in this</span>
<span class="cm">				 * band */</span>
	<span class="n">u8</span> <span class="n">group_channel</span><span class="p">;</span>	<span class="cm">/* &quot;representative&quot; channel # in this band */</span>
	<span class="n">s16</span> <span class="n">temperature</span><span class="p">;</span>	<span class="cm">/* h/w temperature at factory calib this band</span>
<span class="cm">				 * (signed) */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Temperature-based Tx-power compensation data, not band-specific.</span>
<span class="cm"> * These coefficients are use to modify a/b/c/d/e coeffs based on</span>
<span class="cm"> *   difference between current temperature and factory calib temperature.</span>
<span class="cm"> * Data copied from EEPROM.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">il3945_eeprom_temperature_corr</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">Ta</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Tb</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Tc</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Td</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Te</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * EEPROM map</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">il3945_eeprom</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reserved0</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">device_id</span><span class="p">;</span>		<span class="cm">/* abs.ofs: 16 */</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">pmc</span><span class="p">;</span>		<span class="cm">/* abs.ofs: 20 */</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">mac_address</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 42 */</span>
	<span class="n">u8</span> <span class="n">reserved3</span><span class="p">[</span><span class="mi">58</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">board_revision</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 106 */</span>
	<span class="n">u8</span> <span class="n">reserved4</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">board_pba_number</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 119 */</span>
	<span class="n">u8</span> <span class="n">reserved5</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">version</span><span class="p">;</span>		<span class="cm">/* abs.ofs: 136 */</span>
	<span class="n">u8</span> <span class="n">sku_cap</span><span class="p">;</span>		<span class="cm">/* abs.ofs: 138 */</span>
	<span class="n">u8</span> <span class="n">leds_mode</span><span class="p">;</span>		<span class="cm">/* abs.ofs: 139 */</span>
	<span class="n">u16</span> <span class="n">oem_mode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">wowlan_mode</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 142 */</span>
	<span class="n">u16</span> <span class="n">leds_time_interval</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 144 */</span>
	<span class="n">u8</span> <span class="n">leds_off_time</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 146 */</span>
	<span class="n">u8</span> <span class="n">leds_on_time</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 147 */</span>
	<span class="n">u8</span> <span class="n">almgor_m_version</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 148 */</span>
	<span class="n">u8</span> <span class="n">antenna_switch_type</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 149 */</span>
	<span class="n">u8</span> <span class="n">reserved6</span><span class="p">[</span><span class="mi">42</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">sku_id</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* abs.ofs: 192 */</span>

<span class="cm">/*</span>
<span class="cm"> * Per-channel regulatory data.</span>
<span class="cm"> *</span>
<span class="cm"> * Each channel that *might* be supported by 3945 has a fixed location</span>
<span class="cm"> * in EEPROM containing EEPROM_CHANNEL_* usage flags (LSB) and max regulatory</span>
<span class="cm"> * txpower (MSB).</span>
<span class="cm"> *</span>
<span class="cm"> * Entries immediately below are for 20 MHz channel width.</span>
<span class="cm"> *</span>
<span class="cm"> * 2.4 GHz channels 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14</span>
<span class="cm"> */</span>
	<span class="n">u16</span> <span class="n">band_1_count</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 196 */</span>
	<span class="k">struct</span> <span class="n">il_eeprom_channel</span> <span class="n">band_1_channels</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 198 */</span>

<span class="cm">/*</span>
<span class="cm"> * 4.9 GHz channels 183, 184, 185, 187, 188, 189, 192, 196,</span>
<span class="cm"> * 5.0 GHz channels 7, 8, 11, 12, 16</span>
<span class="cm"> * (4915-5080MHz) (none of these is ever supported)</span>
<span class="cm"> */</span>
	<span class="n">u16</span> <span class="n">band_2_count</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 226 */</span>
	<span class="k">struct</span> <span class="n">il_eeprom_channel</span> <span class="n">band_2_channels</span><span class="p">[</span><span class="mi">13</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 228 */</span>

<span class="cm">/*</span>
<span class="cm"> * 5.2 GHz channels 34, 36, 38, 40, 42, 44, 46, 48, 52, 56, 60, 64</span>
<span class="cm"> * (5170-5320MHz)</span>
<span class="cm"> */</span>
	<span class="n">u16</span> <span class="n">band_3_count</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 254 */</span>
	<span class="k">struct</span> <span class="n">il_eeprom_channel</span> <span class="n">band_3_channels</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 256 */</span>

<span class="cm">/*</span>
<span class="cm"> * 5.5 GHz channels 100, 104, 108, 112, 116, 120, 124, 128, 132, 136, 140</span>
<span class="cm"> * (5500-5700MHz)</span>
<span class="cm"> */</span>
	<span class="n">u16</span> <span class="n">band_4_count</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 280 */</span>
	<span class="k">struct</span> <span class="n">il_eeprom_channel</span> <span class="n">band_4_channels</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 282 */</span>

<span class="cm">/*</span>
<span class="cm"> * 5.7 GHz channels 145, 149, 153, 157, 161, 165</span>
<span class="cm"> * (5725-5825MHz)</span>
<span class="cm"> */</span>
	<span class="n">u16</span> <span class="n">band_5_count</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 304 */</span>
	<span class="k">struct</span> <span class="n">il_eeprom_channel</span> <span class="n">band_5_channels</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* abs.ofs: 306 */</span>

	<span class="n">u8</span> <span class="n">reserved9</span><span class="p">[</span><span class="mi">194</span><span class="p">];</span>

<span class="cm">/*</span>
<span class="cm"> * 3945 Txpower calibration data.</span>
<span class="cm"> */</span>
<span class="cp">#define IL_NUM_TX_CALIB_GROUPS 5</span>
	<span class="k">struct</span> <span class="n">il3945_eeprom_txpower_group</span> <span class="n">groups</span><span class="p">[</span><span class="n">IL_NUM_TX_CALIB_GROUPS</span><span class="p">];</span>
<span class="cm">/* abs.ofs: 512 */</span>
	<span class="k">struct</span> <span class="n">il3945_eeprom_temperature_corr</span> <span class="n">corrections</span><span class="p">;</span>	<span class="cm">/* abs.ofs: 832 */</span>
	<span class="n">u8</span> <span class="n">reserved16</span><span class="p">[</span><span class="mi">172</span><span class="p">];</span>	<span class="cm">/* fill out to full 1024 byte block */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define IL3945_EEPROM_IMG_SIZE 1024</span>

<span class="cm">/* End of EEPROM */</span>

<span class="cp">#define PCI_CFG_REV_ID_BIT_BASIC_SKU                (0x40)	</span><span class="cm">/* bit 6    */</span><span class="cp"></span>
<span class="cp">#define PCI_CFG_REV_ID_BIT_RTP                      (0x80)	</span><span class="cm">/* bit 7    */</span><span class="cp"></span>

<span class="cm">/* 4 DATA + 1 CMD. There are 2 HCCA queues that are not used. */</span>
<span class="cp">#define IL39_NUM_QUEUES        5</span>
<span class="cp">#define IL39_CMD_QUEUE_NUM	4</span>

<span class="cp">#define IL_DEFAULT_TX_RETRY  15</span>

<span class="cm">/*********************************************/</span>

<span class="cp">#define RFD_SIZE                              4</span>
<span class="cp">#define NUM_TFD_CHUNKS                        4</span>

<span class="cp">#define TFD_CTL_COUNT_SET(n)       (n &lt;&lt; 24)</span>
<span class="cp">#define TFD_CTL_COUNT_GET(ctl)     ((ctl &gt;&gt; 24) &amp; 7)</span>
<span class="cp">#define TFD_CTL_PAD_SET(n)         (n &lt;&lt; 28)</span>
<span class="cp">#define TFD_CTL_PAD_GET(ctl)       (ctl &gt;&gt; 28)</span>

<span class="cm">/* Sizes and addresses for instruction and data memory (SRAM) in</span>
<span class="cm"> * 3945&#39;s embedded processor.  Driver access is via HBUS_TARG_MEM_* regs. */</span>
<span class="cp">#define IL39_RTC_INST_LOWER_BOUND		(0x000000)</span>
<span class="cp">#define IL39_RTC_INST_UPPER_BOUND		(0x014000)</span>

<span class="cp">#define IL39_RTC_DATA_LOWER_BOUND		(0x800000)</span>
<span class="cp">#define IL39_RTC_DATA_UPPER_BOUND		(0x808000)</span>

<span class="cp">#define IL39_RTC_INST_SIZE (IL39_RTC_INST_UPPER_BOUND - \</span>
<span class="cp">				IL39_RTC_INST_LOWER_BOUND)</span>
<span class="cp">#define IL39_RTC_DATA_SIZE (IL39_RTC_DATA_UPPER_BOUND - \</span>
<span class="cp">				IL39_RTC_DATA_LOWER_BOUND)</span>

<span class="cp">#define IL39_MAX_INST_SIZE IL39_RTC_INST_SIZE</span>
<span class="cp">#define IL39_MAX_DATA_SIZE IL39_RTC_DATA_SIZE</span>

<span class="cm">/* Size of uCode instruction memory in bootstrap state machine */</span>
<span class="cp">#define IL39_MAX_BSM_SIZE IL39_RTC_INST_SIZE</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">il3945_hw_valid_rtc_data_addr</span><span class="p">(</span><span class="n">u32</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IL39_RTC_DATA_LOWER_BOUND</span> <span class="o">&amp;&amp;</span>
		<span class="n">addr</span> <span class="o">&lt;</span> <span class="n">IL39_RTC_DATA_UPPER_BOUND</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Base physical address of il3945_shared is provided to FH39_TSSR_CBB_BASE</span>
<span class="cm"> * and &amp;il3945_shared.rx_read_ptr[0] is provided to FH39_RCSR_RPTR_ADDR(0) */</span>
<span class="k">struct</span> <span class="n">il3945_shared</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">tx_base_ptr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/************************************/</span>
<span class="cm">/* iwl3945 Flow Handler Definitions */</span>
<span class="cm">/************************************/</span>

<span class="cm">/**</span>
<span class="cm"> * This I/O area is directly read/writable by driver (e.g. Linux uses writel())</span>
<span class="cm"> * Addresses are offsets from device&#39;s PCI hardware base address.</span>
<span class="cm"> */</span>
<span class="cp">#define FH39_MEM_LOWER_BOUND                   (0x0800)</span>
<span class="cp">#define FH39_MEM_UPPER_BOUND                   (0x1000)</span>

<span class="cp">#define FH39_CBCC_TBL		(FH39_MEM_LOWER_BOUND + 0x140)</span>
<span class="cp">#define FH39_TFDB_TBL		(FH39_MEM_LOWER_BOUND + 0x180)</span>
<span class="cp">#define FH39_RCSR_TBL		(FH39_MEM_LOWER_BOUND + 0x400)</span>
<span class="cp">#define FH39_RSSR_TBL		(FH39_MEM_LOWER_BOUND + 0x4c0)</span>
<span class="cp">#define FH39_TCSR_TBL		(FH39_MEM_LOWER_BOUND + 0x500)</span>
<span class="cp">#define FH39_TSSR_TBL		(FH39_MEM_LOWER_BOUND + 0x680)</span>

<span class="cm">/* TFDB (Transmit Frame Buffer Descriptor) */</span>
<span class="cp">#define FH39_TFDB(_ch, buf)			(FH39_TFDB_TBL + \</span>
<span class="cp">						 ((_ch) * 2 + (buf)) * 0x28)</span>
<span class="cp">#define FH39_TFDB_CHNL_BUF_CTRL_REG(_ch)	(FH39_TFDB_TBL + 0x50 * (_ch))</span>

<span class="cm">/* CBCC channel is [0,2] */</span>
<span class="cp">#define FH39_CBCC(_ch)		(FH39_CBCC_TBL + (_ch) * 0x8)</span>
<span class="cp">#define FH39_CBCC_CTRL(_ch)	(FH39_CBCC(_ch) + 0x00)</span>
<span class="cp">#define FH39_CBCC_BASE(_ch)	(FH39_CBCC(_ch) + 0x04)</span>

<span class="cm">/* RCSR channel is [0,2] */</span>
<span class="cp">#define FH39_RCSR(_ch)			(FH39_RCSR_TBL + (_ch) * 0x40)</span>
<span class="cp">#define FH39_RCSR_CONFIG(_ch)		(FH39_RCSR(_ch) + 0x00)</span>
<span class="cp">#define FH39_RCSR_RBD_BASE(_ch)		(FH39_RCSR(_ch) + 0x04)</span>
<span class="cp">#define FH39_RCSR_WPTR(_ch)		(FH39_RCSR(_ch) + 0x20)</span>
<span class="cp">#define FH39_RCSR_RPTR_ADDR(_ch)	(FH39_RCSR(_ch) + 0x24)</span>

<span class="cp">#define FH39_RSCSR_CHNL0_WPTR		(FH39_RCSR_WPTR(0))</span>

<span class="cm">/* RSSR */</span>
<span class="cp">#define FH39_RSSR_CTRL			(FH39_RSSR_TBL + 0x000)</span>
<span class="cp">#define FH39_RSSR_STATUS		(FH39_RSSR_TBL + 0x004)</span>

<span class="cm">/* TCSR */</span>
<span class="cp">#define FH39_TCSR(_ch)			(FH39_TCSR_TBL + (_ch) * 0x20)</span>
<span class="cp">#define FH39_TCSR_CONFIG(_ch)		(FH39_TCSR(_ch) + 0x00)</span>
<span class="cp">#define FH39_TCSR_CREDIT(_ch)		(FH39_TCSR(_ch) + 0x04)</span>
<span class="cp">#define FH39_TCSR_BUFF_STTS(_ch)	(FH39_TCSR(_ch) + 0x08)</span>

<span class="cm">/* TSSR */</span>
<span class="cp">#define FH39_TSSR_CBB_BASE        (FH39_TSSR_TBL + 0x000)</span>
<span class="cp">#define FH39_TSSR_MSG_CONFIG      (FH39_TSSR_TBL + 0x008)</span>
<span class="cp">#define FH39_TSSR_TX_STATUS       (FH39_TSSR_TBL + 0x010)</span>

<span class="cm">/* DBM */</span>

<span class="cp">#define FH39_SRVC_CHNL                            (6)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_POS_RBDC_SIZE     (20)</span>
<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_POS_IRQ_RBTH      (4)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_BIT_WR_STTS_EN    (0x08000000)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_VAL_DMA_CHNL_EN_ENABLE        (0x80000000)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_VAL_RDRBD_EN_ENABLE           (0x20000000)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_VAL_MAX_FRAG_SIZE_128		(0x01000000)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_VAL_IRQ_DEST_INT_HOST		(0x00001000)</span>

<span class="cp">#define FH39_RCSR_RX_CONFIG_REG_VAL_MSG_MODE_FH			(0x00000000)</span>

<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_TXF		(0x00000000)</span>
<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_DRIVER		(0x00000001)</span>

<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_DISABLE_VAL	(0x00000000)</span>
<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_ENABLE_VAL	(0x00000008)</span>

<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_IFTFD		(0x00200000)</span>

<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_CIRQ_RTC_NOINT		(0x00000000)</span>

<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_PAUSE		(0x00000000)</span>
<span class="cp">#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_ENABLE		(0x80000000)</span>

<span class="cp">#define FH39_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_VALID		(0x00004000)</span>

<span class="cp">#define FH39_TCSR_CHNL_TX_BUF_STS_REG_BIT_TFDB_WPTR		(0x00000001)</span>

<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_SNOOP_RD_TXPD_ON	(0xFF000000)</span>
<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RD_TXPD_ON	(0x00FF0000)</span>

<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_MAX_FRAG_SIZE_128B	(0x00000400)</span>

<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_SNOOP_RD_TFD_ON		(0x00000100)</span>
<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RD_CBB_ON		(0x00000080)</span>

<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RSP_WAIT_TH	(0x00000020)</span>
<span class="cp">#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_RSP_WAIT_TH		(0x00000005)</span>

<span class="cp">#define FH39_TSSR_TX_STATUS_REG_BIT_BUFS_EMPTY(_ch)	(BIT(_ch) &lt;&lt; 24)</span>
<span class="cp">#define FH39_TSSR_TX_STATUS_REG_BIT_NO_PEND_REQ(_ch)	(BIT(_ch) &lt;&lt; 16)</span>

<span class="cp">#define FH39_TSSR_TX_STATUS_REG_MSK_CHNL_IDLE(_ch) \</span>
<span class="cp">	(FH39_TSSR_TX_STATUS_REG_BIT_BUFS_EMPTY(_ch) | \</span>
<span class="cp">	 FH39_TSSR_TX_STATUS_REG_BIT_NO_PEND_REQ(_ch))</span>

<span class="cp">#define FH39_RSSR_CHNL0_RX_STATUS_CHNL_IDLE			(0x01000000)</span>

<span class="k">struct</span> <span class="n">il3945_tfd_tb</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">addr</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">il3945_tfd</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">control_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">il3945_tfd_tb</span> <span class="n">tbs</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">__pad</span><span class="p">[</span><span class="mi">28</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_IWLEGACY_DEBUGFS</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">il_debugfs_ops</span> <span class="n">il3945_debugfs_ops</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
