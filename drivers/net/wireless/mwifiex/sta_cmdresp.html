<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › mwifiex › sta_cmdresp.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sta_cmdresp.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Marvell Wireless LAN device driver: station command response handling</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011, Marvell International Ltd.</span>
<span class="cm"> *</span>
<span class="cm"> * This software file (the &quot;File&quot;) is distributed by Marvell International</span>
<span class="cm"> * Ltd. under the terms of the GNU General Public License Version 2, June 1991</span>
<span class="cm"> * (the &quot;License&quot;).  You may use, redistribute and/or modify this File in</span>
<span class="cm"> * accordance with the terms and conditions of the License, a copy of which</span>
<span class="cm"> * is available by writing to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA or on the</span>
<span class="cm"> * worldwide web at http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.</span>
<span class="cm"> *</span>
<span class="cm"> * THE FILE IS DISTRIBUTED AS-IS, WITHOUT WARRANTY OF ANY KIND, AND THE</span>
<span class="cm"> * IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="cm"> * ARE EXPRESSLY DISCLAIMED.  The License provides additional details about</span>
<span class="cm"> * this warranty disclaimer.</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;decl.h&quot;</span>
<span class="cp">#include &quot;ioctl.h&quot;</span>
<span class="cp">#include &quot;util.h&quot;</span>
<span class="cp">#include &quot;fw.h&quot;</span>
<span class="cp">#include &quot;main.h&quot;</span>
<span class="cp">#include &quot;wmm.h&quot;</span>
<span class="cp">#include &quot;11n.h&quot;</span>


<span class="cm">/*</span>
<span class="cm"> * This function handles the command response error case.</span>
<span class="cm"> *</span>
<span class="cm"> * For scan response error, the function cancels all the pending</span>
<span class="cm"> * scan commands and generates an event to inform the applications</span>
<span class="cm"> * of the scan completion.</span>
<span class="cm"> *</span>
<span class="cm"> * For Power Save command failure, we do not retry enter PS</span>
<span class="cm"> * command in case of Ad-hoc mode.</span>
<span class="cm"> *</span>
<span class="cm"> * For all other response errors, the current command buffer is freed</span>
<span class="cm"> * and returned to the free command queue.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">mwifiex_process_cmdresp_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cmd_ctrl_node</span> <span class="o">*</span><span class="n">cmd_node</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_ps_mode_enh</span> <span class="o">*</span><span class="n">pm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">dev_err</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;CMD_RESP: cmd %#x error, result=%#x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">resp</span><span class="o">-&gt;</span><span class="n">command</span><span class="p">,</span> <span class="n">resp</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_cmd</span><span class="o">-&gt;</span><span class="n">wait_q_enabled</span><span class="p">)</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">cmd_wait_q</span><span class="p">.</span><span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">command</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_PS_MODE_ENH</span>:
		<span class="n">pm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">psmode_enh</span><span class="p">;</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;PS_MODE_ENH cmd failed: result=0x%x action=0x%X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">resp</span><span class="o">-&gt;</span><span class="n">result</span><span class="p">,</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">pm</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">));</span>
		<span class="cm">/* We do not re-try enter-ps command in ad-hoc mode. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">pm</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="n">EN_AUTO_PS</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">pm</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">ps_bitmap</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">BITMAP_STA_PS</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">bss_mode</span> <span class="o">==</span> <span class="n">NL80211_IFTYPE_ADHOC</span><span class="p">)</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">ps_mode</span> <span class="o">=</span> <span class="n">MWIFIEX_802_11_POWER_MODE_CAM</span><span class="p">;</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_SCAN</span>:
		<span class="cm">/* Cancel all pending scan command */</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_pending_q_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">list_for_each_entry_safe</span><span class="p">(</span><span class="n">cmd_node</span><span class="p">,</span> <span class="n">tmp_node</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_pending_q</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmd_node</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
			<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_pending_q_lock</span><span class="p">,</span>
					       <span class="n">flags</span><span class="p">);</span>
			<span class="n">mwifiex_insert_cmd_to_free_q</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">cmd_node</span><span class="p">);</span>
			<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_pending_q_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_pending_q_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">mwifiex_cmd_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">scan_processing</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">mwifiex_cmd_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">report_scan_result</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">report_scan_result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">scan_pending_on_block</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">scan_pending_on_block</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">up</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">async_sem</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HostCmd_CMD_MAC_CONTROL</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Handling errors here */</span>
	<span class="n">mwifiex_insert_cmd_to_free_q</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_cmd</span><span class="p">);</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">mwifiex_cmd_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_cmd</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">mwifiex_cmd_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get RSSI info.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the following parameters in driver -</span>
<span class="cm"> *      - Last data and beacon RSSI value</span>
<span class="cm"> *      - Average data and beacon RSSI value</span>
<span class="cm"> *      - Last data and beacon NF value</span>
<span class="cm"> *      - Average data and beacon NF value</span>
<span class="cm"> *</span>
<span class="cm"> * The parameters are send to the application as well, along with</span>
<span class="cm"> * calculated SNR values.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_rssi_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_rssi_info_rsp</span> <span class="o">*</span><span class="n">rssi_info_rsp</span> <span class="o">=</span>
						<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">rssi_info_rsp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_ds_misc_subsc_evt</span> <span class="n">subsc_evt</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_rssi_last</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">data_rssi_last</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_nf_last</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">data_nf_last</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_rssi_avg</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">data_rssi_avg</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_nf_avg</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">data_nf_avg</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_rssi_last</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">bcn_rssi_last</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_nf_last</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">bcn_nf_last</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_rssi_avg</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">bcn_rssi_avg</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_nf_avg</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rssi_info_rsp</span><span class="o">-&gt;</span><span class="n">bcn_nf_avg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">subsc_evt_rssi_state</span> <span class="o">==</span> <span class="n">EVENT_HANDLED</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Resubscribe low and high rssi events with new thresholds */</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">subsc_evt</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_ds_misc_subsc_evt</span><span class="p">));</span>
	<span class="n">subsc_evt</span><span class="p">.</span><span class="n">events</span> <span class="o">=</span> <span class="n">BITMASK_BCN_RSSI_LOW</span> <span class="o">|</span> <span class="n">BITMASK_BCN_RSSI_HIGH</span><span class="p">;</span>
	<span class="n">subsc_evt</span><span class="p">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">HostCmd_ACT_BITWISE_SET</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">subsc_evt_rssi_state</span> <span class="o">==</span> <span class="n">RSSI_LOW_RECVD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_l_rssi_cfg</span><span class="p">.</span><span class="n">abs_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_rssi_avg</span> <span class="o">-</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cqm_rssi_hyst</span><span class="p">);</span>
		<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_h_rssi_cfg</span><span class="p">.</span><span class="n">abs_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cqm_rssi_thold</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">subsc_evt_rssi_state</span> <span class="o">==</span> <span class="n">RSSI_HIGH_RECVD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_l_rssi_cfg</span><span class="p">.</span><span class="n">abs_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cqm_rssi_thold</span><span class="p">);</span>
		<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_h_rssi_cfg</span><span class="p">.</span><span class="n">abs_value</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bcn_rssi_avg</span> <span class="o">+</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">cqm_rssi_hyst</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_l_rssi_cfg</span><span class="p">.</span><span class="n">evt_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">subsc_evt</span><span class="p">.</span><span class="n">bcn_h_rssi_cfg</span><span class="p">.</span><span class="n">evt_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">subsc_evt_rssi_state</span> <span class="o">=</span> <span class="n">EVENT_HANDLED</span><span class="p">;</span>

	<span class="n">mwifiex_send_cmd_async</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">HostCmd_CMD_802_11_SUBSCRIBE_EVENT</span><span class="p">,</span>
			       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">subsc_evt</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get SNMP</span>
<span class="cm"> * MIB parameters.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the parameter in driver.</span>
<span class="cm"> *</span>
<span class="cm"> * The following parameters are supported -</span>
<span class="cm"> *      - Fragmentation threshold</span>
<span class="cm"> *      - RTS threshold</span>
<span class="cm"> *      - Short retry limit</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_snmp_mib</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
				       <span class="n">u32</span> <span class="o">*</span><span class="n">data_buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_snmp_mib</span> <span class="o">*</span><span class="n">smib</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">smib</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">oid</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">smib</span><span class="o">-&gt;</span><span class="n">oid</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">query_type</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">smib</span><span class="o">-&gt;</span><span class="n">query_type</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">ul_temp</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;info: SNMP_RESP: oid value = %#x,&quot;</span>
		<span class="s">&quot; query_type = %#x, buf size = %#x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">oid</span><span class="p">,</span> <span class="n">query_type</span><span class="p">,</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">smib</span><span class="o">-&gt;</span><span class="n">buf_size</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">query_type</span> <span class="o">==</span> <span class="n">HostCmd_ACT_GEN_GET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ul_temp</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">__le16</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">smib</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">)));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data_buf</span><span class="p">)</span>
			<span class="o">*</span><span class="n">data_buf</span> <span class="o">=</span> <span class="n">ul_temp</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">oid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">FRAG_THRESH_I</span>:
			<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;info: SNMP_RESP: FragThsd =%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ul_temp</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">RTS_THRESH_I</span>:
			<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;info: SNMP_RESP: RTSThsd =%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ul_temp</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SHORT_RETRY_LIM_I</span>:
			<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;info: SNMP_RESP: TxRetryCount=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ul_temp</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DTIM_PERIOD_I</span>:
			<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="s">&quot;info: SNMP_RESP: DTIM period=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ul_temp</span><span class="p">);</span>
		<span class="nl">default:</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get log request</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and sending the received parameters to application.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_get_log</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">mwifiex_ds_get_stats</span> <span class="o">*</span><span class="n">stats</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_get_log</span> <span class="o">*</span><span class="n">get_log</span> <span class="o">=</span>
		<span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_802_11_get_log</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">get_log</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">mcast_tx_frame</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">mcast_tx_frame</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">failed</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">failed</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">retry</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">retry</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">multi_retry</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">multi_retry</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">frame_dup</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">frame_dup</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">rts_success</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">rts_success</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">rts_failure</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">rts_failure</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">ack_failure</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">ack_failure</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">rx_frag</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">rx_frag</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">mcast_rx_frame</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">mcast_rx_frame</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">fcs_error</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">fcs_error</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">tx_frame</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">tx_frame</span><span class="p">);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">wep_icv_error</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">wep_icv_err_cnt</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">wep_icv_error</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">wep_icv_err_cnt</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">wep_icv_error</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">wep_icv_err_cnt</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="n">stats</span><span class="o">-&gt;</span><span class="n">wep_icv_error</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">get_log</span><span class="o">-&gt;</span><span class="n">wep_icv_err_cnt</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get Tx rate</span>
<span class="cm"> * configurations.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the following parameters in driver -</span>
<span class="cm"> *      - DSSS rate bitmap</span>
<span class="cm"> *      - OFDM rate bitmap</span>
<span class="cm"> *      - HT MCS rate bitmaps</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the new rate bitmaps, the function re-evaluates if</span>
<span class="cm"> * auto data rate has been activated. If not, it sends another</span>
<span class="cm"> * query to the firmware to get the current Tx data rate and updates</span>
<span class="cm"> * the driver value.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_tx_rate_cfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">mwifiex_rate_cfg</span> <span class="o">*</span><span class="n">ds_rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_tx_rate_cfg</span> <span class="o">*</span><span class="n">rate_cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">tx_rate_cfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_rate_scope</span> <span class="o">*</span><span class="n">rate_scope</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_ie_types_header</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tlv</span><span class="p">,</span> <span class="n">tlv_buf_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">tlv_buf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">tlv_buf</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">rate_cfg</span><span class="p">)</span> <span class="o">+</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_tx_rate_cfg</span><span class="p">);</span>
	<span class="n">tlv_buf_len</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">tlv_buf</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u16</span><span class="p">));</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">tlv_buf</span> <span class="o">&amp;&amp;</span> <span class="n">tlv_buf_len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tlv</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">tlv_buf</span><span class="p">);</span>
		<span class="n">tlv</span> <span class="o">=</span> <span class="n">tlv</span> <span class="o">|</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">tlv_buf</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">tlv</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TLV_TYPE_RATE_SCOPE</span>:
			<span class="n">rate_scope</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_rate_scope</span> <span class="o">*</span><span class="p">)</span> <span class="n">tlv_buf</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bitmap_rates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rate_scope</span><span class="o">-&gt;</span><span class="n">hr_dsss_rate_bitmap</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bitmap_rates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rate_scope</span><span class="o">-&gt;</span><span class="n">ofdm_rate_bitmap</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			     <span class="n">i</span> <span class="o">&lt;</span>
			     <span class="k">sizeof</span><span class="p">(</span><span class="n">rate_scope</span><span class="o">-&gt;</span><span class="n">ht_mcs_rate_bitmap</span><span class="p">)</span> <span class="o">/</span>
			     <span class="k">sizeof</span><span class="p">(</span><span class="n">u16</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bitmap_rates</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rate_scope</span><span class="o">-&gt;</span>
						    <span class="n">ht_mcs_rate_bitmap</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">break</span><span class="p">;</span>
			<span class="cm">/* Add RATE_DROP tlv here */</span>
		<span class="p">}</span>

		<span class="n">head</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_ie_types_header</span> <span class="o">*</span><span class="p">)</span> <span class="n">tlv_buf</span><span class="p">;</span>
		<span class="n">tlv_buf</span> <span class="o">+=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">head</span><span class="p">);</span>
		<span class="n">tlv_buf_len</span> <span class="o">-=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">is_data_rate_auto</span> <span class="o">=</span> <span class="n">mwifiex_is_rate_auto</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">is_data_rate_auto</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_send_cmd_async</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span>
					  <span class="n">HostCmd_CMD_802_11_TX_RATE_QUERY</span><span class="p">,</span>
					  <span class="n">HostCmd_ACT_GEN_GET</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ds_rate</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rate_cfg</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="n">HostCmd_ACT_GEN_GET</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">is_data_rate_auto</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">is_rate_auto</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">mwifiex_get_rate_index</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bitmap_rates</span><span class="p">,</span>
					       <span class="k">sizeof</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bitmap_rates</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="n">MWIFIEX_RATE_BITMAP_OFDM0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="n">MWIFIEX_RATE_BITMAP_OFDM7</span><span class="p">)</span>
		<span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">-=</span> <span class="p">(</span><span class="n">MWIFIEX_RATE_BITMAP_OFDM0</span> <span class="o">-</span>
				  <span class="n">MWIFIEX_RATE_INDEX_OFDM0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="n">MWIFIEX_RATE_BITMAP_MCS0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">&lt;=</span> <span class="n">MWIFIEX_RATE_BITMAP_MCS127</span><span class="p">)</span>
		<span class="n">ds_rate</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">-=</span> <span class="p">(</span><span class="n">MWIFIEX_RATE_BITMAP_MCS0</span> <span class="o">-</span>
				  <span class="n">MWIFIEX_RATE_INDEX_MCS0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get Tx power level.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes saving the maximum and minimum Tx power levels</span>
<span class="cm"> * in driver, as well as sending the values to user.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_get_power_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data_buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">length</span><span class="p">,</span> <span class="n">max_power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_power</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_types_power_group</span> <span class="o">*</span><span class="n">pg_tlv_hdr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_power_group</span> <span class="o">*</span><span class="n">pg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">data_buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">pg_tlv_hdr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span> <span class="o">*</span><span class="p">)</span>
		<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">data_buf</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_txpwr_cfg</span><span class="p">));</span>
	<span class="n">pg</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_power_group</span> <span class="o">*</span><span class="p">)</span>
		<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">pg_tlv_hdr</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span><span class="p">));</span>
	<span class="n">length</span> <span class="o">=</span> <span class="n">pg_tlv_hdr</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">max_power</span> <span class="o">=</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_max</span><span class="p">;</span>
		<span class="n">min_power</span> <span class="o">=</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">;</span>
		<span class="n">length</span> <span class="o">-=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_power_group</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pg</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max_power</span> <span class="o">&lt;</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_max</span><span class="p">)</span>
			<span class="n">max_power</span> <span class="o">=</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_max</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">min_power</span> <span class="o">&gt;</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">)</span>
			<span class="n">min_power</span> <span class="o">=</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">;</span>

		<span class="n">length</span> <span class="o">-=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_power_group</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pg_tlv_hdr</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">min_tx_power_level</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">min_power</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_tx_power_level</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">max_power</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get Tx power</span>
<span class="cm"> * configurations.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the current Tx power level in driver.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_tx_power_cfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mwifiex_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_txpwr_cfg</span> <span class="o">*</span><span class="n">txp_cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">txp_cfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_types_power_group</span> <span class="o">*</span><span class="n">pg_tlv_hdr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_power_group</span> <span class="o">*</span><span class="n">pg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">action</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">txp_cfg</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HostCmd_ACT_GEN_GET</span>:
		<span class="n">pg_tlv_hdr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span> <span class="o">*</span><span class="p">)</span>
			<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">txp_cfg</span> <span class="o">+</span>
			 <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_txpwr_cfg</span><span class="p">));</span>

		<span class="n">pg</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_power_group</span> <span class="o">*</span><span class="p">)</span>
			<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">pg_tlv_hdr</span> <span class="o">+</span>
			 <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">hw_status</span> <span class="o">==</span> <span class="n">MWIFIEX_HW_STATUS_INITIALIZING</span><span class="p">)</span>
			<span class="n">mwifiex_get_power_level</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">txp_cfg</span><span class="p">);</span>

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_power_level</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HostCmd_ACT_GEN_SET</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">txp_cfg</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">pg_tlv_hdr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span> <span class="o">*</span><span class="p">)</span>
			<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">txp_cfg</span> <span class="o">+</span>
			 <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_txpwr_cfg</span><span class="p">));</span>

		<span class="n">pg</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_power_group</span> <span class="o">*</span><span class="p">)</span>
			<span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">pg_tlv_hdr</span> <span class="o">+</span>
			 <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_types_power_group</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_max</span> <span class="o">==</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">)</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_power_level</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">pg</span><span class="o">-&gt;</span><span class="n">power_min</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;CMD_RESP: unknown cmd action %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">action</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
		<span class="s">&quot;info: Current TxPower Level = %d, Max Power=%d, Min Power=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_power_level</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_tx_power_level</span><span class="p">,</span>
	       <span class="n">priv</span><span class="o">-&gt;</span><span class="n">min_tx_power_level</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get MAC address.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes saving the MAC address in driver.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_mac_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_mac_address</span> <span class="o">*</span><span class="n">cmd_mac_addr</span> <span class="o">=</span>
							<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">mac_addr</span><span class="p">;</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_addr</span><span class="p">,</span> <span class="n">cmd_mac_addr</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">,</span> <span class="n">ETH_ALEN</span><span class="p">);</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
		<span class="s">&quot;info: set mac address: %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_addr</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get MAC multicast</span>
<span class="cm"> * address.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_mac_multicast_adr</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get Tx rate query.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the Tx rate and HT information parameters in driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Both rate configuration and current data rate can be retrieved</span>
<span class="cm"> * with this request.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_tx_rate_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_rate</span> <span class="o">=</span> <span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">tx_rate</span><span class="p">.</span><span class="n">tx_rate</span><span class="p">;</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_htinfo</span> <span class="o">=</span> <span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">tx_rate</span><span class="p">.</span><span class="n">ht_info</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">is_data_rate_auto</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">data_rate</span> <span class="o">=</span>
			<span class="n">mwifiex_index_to_data_rate</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_rate</span><span class="p">,</span>
						   <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx_htinfo</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of a deauthenticate</span>
<span class="cm"> * command.</span>
<span class="cm"> *</span>
<span class="cm"> * If the deauthenticated MAC matches the current BSS MAC, the connection</span>
<span class="cm"> * state is reset.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_deauthenticate</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mwifiex_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>

	<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dbg</span><span class="p">.</span><span class="n">num_cmd_deauth</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">deauth</span><span class="p">.</span><span class="n">mac_addr</span><span class="p">,</span>
		    <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">mac_address</span><span class="p">,</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">deauth</span><span class="p">.</span><span class="n">mac_addr</span><span class="p">)))</span>
		<span class="n">mwifiex_reset_connect_state</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of ad-hoc stop.</span>
<span class="cm"> *</span>
<span class="cm"> * The function resets the connection state in driver.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_ad_hoc_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mwifiex_reset_connect_state</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of set/get key material.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes updating the driver parameters to reflect the</span>
<span class="cm"> * changes.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_key_material</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_key_material</span> <span class="o">*</span><span class="n">key</span> <span class="o">=</span>
						<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">key_material</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="n">HostCmd_ACT_GEN_SET</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key_info</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">KEY_MCAST</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;info: key: GTK is set</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">wpa_is_gtk_set</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">scan_block</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">aes_key</span><span class="p">.</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="k">sizeof</span><span class="p">(</span><span class="n">key</span><span class="o">-&gt;</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key</span><span class="p">));</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">aes_key</span><span class="p">.</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key_len</span> <span class="o">=</span> <span class="n">key</span><span class="o">-&gt;</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key_len</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">aes_key</span><span class="p">.</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="o">-&gt;</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key</span><span class="p">,</span>
	       <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">aes_key</span><span class="p">.</span><span class="n">key_param_set</span><span class="p">.</span><span class="n">key_len</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get 11d domain information.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11d_domain_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11d_domain_info_rsp</span> <span class="o">*</span><span class="n">domain_info</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">domain_info_resp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_ietypes_domain_param_set</span> <span class="o">*</span><span class="n">domain</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">domain_info</span><span class="o">-&gt;</span><span class="n">domain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">action</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">domain_info</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">no_of_triplet</span><span class="p">;</span>

	<span class="n">no_of_triplet</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">domain</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">len</span><span class="p">)</span>
				<span class="o">-</span> <span class="n">IEEE80211_COUNTRY_STRING_LEN</span><span class="p">)</span>
			      <span class="o">/</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_country_ie_triplet</span><span class="p">));</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
		<span class="s">&quot;info: 11D Domain Info Resp: no_of_triplet=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">no_of_triplet</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">no_of_triplet</span> <span class="o">&gt;</span> <span class="n">MWIFIEX_MAX_TRIPLET_802_11D</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_warn</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			 <span class="s">&quot;11D: invalid number of triplets %d returned</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">no_of_triplet</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">action</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HostCmd_ACT_GEN_SET</span>:  <span class="cm">/* Proc Set Action */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_ACT_GEN_GET</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;11D: invalid action:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">domain_info</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get RF channel.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes changing the header fields into CPU format</span>
<span class="cm"> * and saving the new channel in driver.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_802_11_rf_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
					 <span class="n">u16</span> <span class="o">*</span><span class="n">data_buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_rf_channel</span> <span class="o">*</span><span class="n">rf_channel</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">rf_channel</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">new_channel</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">rf_channel</span><span class="o">-&gt;</span><span class="n">current_channel</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">channel</span> <span class="o">!=</span> <span class="n">new_channel</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;cmd: Channel Switch: %d to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">channel</span><span class="p">,</span>
			<span class="n">new_channel</span><span class="p">);</span>
		<span class="cm">/* Update the channel again */</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">new_channel</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data_buf</span><span class="p">)</span>
		<span class="o">*</span><span class="n">data_buf</span> <span class="o">=</span> <span class="n">new_channel</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get extended version.</span>
<span class="cm"> *</span>
<span class="cm"> * Handling includes forming the extended version string and sending it</span>
<span class="cm"> * to application.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_ver_ext</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">host_cmd_ds_version_ext</span> <span class="o">*</span><span class="n">version_ext</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_version_ext</span> <span class="o">*</span><span class="n">ver_ext</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">verext</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">version_ext</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">version_ext</span><span class="o">-&gt;</span><span class="n">version_str_sel</span> <span class="o">=</span> <span class="n">ver_ext</span><span class="o">-&gt;</span><span class="n">version_str_sel</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">version_ext</span><span class="o">-&gt;</span><span class="n">version_str</span><span class="p">,</span> <span class="n">ver_ext</span><span class="o">-&gt;</span><span class="n">version_str</span><span class="p">,</span>
		       <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="mi">128</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">version_str</span><span class="p">,</span> <span class="n">ver_ext</span><span class="o">-&gt;</span><span class="n">version_str</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of register access.</span>
<span class="cm"> *</span>
<span class="cm"> * The register value and offset are returned to the user. For EEPROM</span>
<span class="cm"> * access, the byte count is also returned.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_reg_access</span><span class="p">(</span><span class="n">u16</span> <span class="n">type</span><span class="p">,</span> <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
				  <span class="kt">void</span> <span class="o">*</span><span class="n">data_buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mwifiex_ds_reg_rw</span> <span class="o">*</span><span class="n">reg_rw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_ds_read_eeprom</span> <span class="o">*</span><span class="n">eeprom</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">reg</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">host_cmd_ds_mac_reg_access</span> <span class="o">*</span><span class="n">mac</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">host_cmd_ds_bbp_reg_access</span> <span class="o">*</span><span class="n">bbp</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">host_cmd_ds_rf_reg_access</span> <span class="o">*</span><span class="n">rf</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">host_cmd_ds_pmic_reg_access</span> <span class="o">*</span><span class="n">pmic</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_eeprom_access</span> <span class="o">*</span><span class="n">eeprom</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">r</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">data_buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">reg_rw</span> <span class="o">=</span> <span class="n">data_buf</span><span class="p">;</span>
	<span class="n">eeprom</span> <span class="o">=</span> <span class="n">data_buf</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_MAC_REG_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">mac</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_mac_reg_access</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">mac_reg</span><span class="p">;</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">mac</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">));</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">mac</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_BBP_REG_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">bbp</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_bbp_reg_access</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">bbp_reg</span><span class="p">;</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">bbp</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">));</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">bbp</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HostCmd_CMD_RF_REG_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">rf</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_rf_reg_access</span> <span class="o">*</span><span class="p">)</span>
		       <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">rf_reg</span><span class="p">;</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">rf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">));</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">bbp</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_PMIC_REG_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">pmic</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_pmic_reg_access</span> <span class="o">*</span><span class="p">)</span>
			 <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">pmic_reg</span><span class="p">;</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">pmic</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">));</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">pmic</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_CAU_REG_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">rf</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_rf_reg_access</span> <span class="o">*</span><span class="p">)</span>
		       <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">rf_reg</span><span class="p">;</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">rf</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">));</span>
		<span class="n">reg_rw</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">r</span><span class="p">.</span><span class="n">rf</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_EEPROM_ACCESS</span>:
		<span class="n">r</span><span class="p">.</span><span class="n">eeprom</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_802_11_eeprom_access</span> <span class="o">*</span><span class="p">)</span>
			   <span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">eeprom</span><span class="p">;</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;info: EEPROM read len=%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">)</span> <span class="o">&lt;</span>
		    <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
			<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;info: EEPROM read length is too big</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">;</span>
		<span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">,</span>
			       <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">eeprom</span><span class="o">-&gt;</span><span class="n">byte_count</span><span class="p">));</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response of get IBSS coalescing status.</span>
<span class="cm"> *</span>
<span class="cm"> * If the received BSSID is different than the current one, the current BSSID,</span>
<span class="cm"> * beacon interval, ATIM window and ERP information are updated, along with</span>
<span class="cm"> * changing the ad-hoc state accordingly.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_ibss_coalescing_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					      <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_ibss_status</span> <span class="o">*</span><span class="n">ibss_coal_resp</span> <span class="o">=</span>
					<span class="o">&amp;</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">ibss_coalescing</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">zero_mac</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">action</span><span class="p">)</span> <span class="o">==</span> <span class="n">HostCmd_ACT_GEN_SET</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
		<span class="s">&quot;info: new BSSID %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>

	<span class="cm">/* If rsp has NULL BSSID, Just return..... No Action */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">zero_mac</span><span class="p">,</span> <span class="n">ETH_ALEN</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dev_warn</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;new BSSID is NULL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* If BSSID is diff, modify current BSS parameters */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">mac_address</span><span class="p">,</span>
		   <span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">ETH_ALEN</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* BSSID */</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">mac_address</span><span class="p">,</span>
		       <span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">,</span> <span class="n">ETH_ALEN</span><span class="p">);</span>

		<span class="cm">/* Beacon Interval */</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">beacon_period</span>
			<span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">beacon_interval</span><span class="p">);</span>

		<span class="cm">/* ERP Information */</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">curr_bss_params</span><span class="p">.</span><span class="n">bss_descriptor</span><span class="p">.</span><span class="n">erp_flags</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">ibss_coal_resp</span><span class="o">-&gt;</span><span class="n">use_g_rate_protect</span><span class="p">);</span>

		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">adhoc_state</span> <span class="o">=</span> <span class="n">ADHOC_COALESCED</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command response for subscribe event command.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mwifiex_ret_subsc_evt</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">mwifiex_ds_misc_subsc_evt</span> <span class="o">*</span><span class="n">sub_event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">host_cmd_ds_802_11_subsc_evt</span> <span class="o">*</span><span class="n">cmd_sub_event</span> <span class="o">=</span>
		<span class="p">(</span><span class="k">struct</span> <span class="n">host_cmd_ds_802_11_subsc_evt</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">subsc_evt</span><span class="p">;</span>

	<span class="cm">/* For every subscribe event command (Get/Set/Clear), FW reports the</span>
<span class="cm">	 * current set of subscribed events*/</span>
	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Bitmap of currently subscribed events: %16x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">cmd_sub_event</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">));</span>

	<span class="cm">/*Return the subscribed event info for a Get request*/</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sub_event</span><span class="p">)</span>
		<span class="n">sub_event</span><span class="o">-&gt;</span><span class="n">events</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">cmd_sub_event</span><span class="o">-&gt;</span><span class="n">events</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function handles the command responses.</span>
<span class="cm"> *</span>
<span class="cm"> * This is a generic function, which calls command specific</span>
<span class="cm"> * response handlers based on the command ID.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">mwifiex_process_sta_cmdresp</span><span class="p">(</span><span class="k">struct</span> <span class="n">mwifiex_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">u16</span> <span class="n">cmdresp_no</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">host_cmd_ds_command</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mwifiex_adapter</span> <span class="o">*</span><span class="n">adapter</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">data_buf</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_cmd</span><span class="o">-&gt;</span><span class="n">data_buf</span><span class="p">;</span>

	<span class="cm">/* If the command is not successful, cleanup and return failure */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">result</span> <span class="o">!=</span> <span class="n">HostCmd_RESULT_OK</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mwifiex_process_cmdresp_error</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Command successful, handle response */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cmdresp_no</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_GET_HW_SPEC</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_get_hw_spec</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_MAC_CONTROL</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_MAC_ADDRESS</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_mac_address</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_MAC_MULTICAST_ADR</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_mac_multicast_adr</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_TX_RATE_CFG</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_tx_rate_cfg</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_SCAN</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_scan</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_cmd</span><span class="o">-&gt;</span><span class="n">wait_q_enabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_BG_SCAN_QUERY</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_scan</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;info: CMD_RESP: BG_SCAN result is ready!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_TXPWR_CFG</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_tx_power_cfg</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_PS_MODE_ENH</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_enh_power_mode</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_HS_CFG_ENH</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_hs_cfg</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_ASSOCIATE</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_associate</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_DEAUTHENTICATE</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_deauthenticate</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_AD_HOC_START</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_AD_HOC_JOIN</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_ad_hoc</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_AD_HOC_STOP</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_ad_hoc_stop</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_GET_LOG</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_get_log</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_RSSI_INFO</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_rssi_info</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_SNMP_MIB</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_snmp_mib</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_TX_RATE_QUERY</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_tx_rate_query</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_RF_CHANNEL</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_rf_channel</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_VERSION_EXT</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_ver_ext</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_FUNC_INIT</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_FUNC_SHUTDOWN</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_KEY_MATERIAL</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11_key_material</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11D_DOMAIN_INFO</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_802_11d_domain_info</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_11N_ADDBA_REQ</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_11n_addba_req</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_11N_DELBA</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_11n_delba</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_11N_ADDBA_RSP</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_11n_addba_resp</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_RECONFIGURE_TX_BUFF</span>:
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_buf_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span>
							     <span class="n">tx_buf</span><span class="p">.</span><span class="n">buff_size</span><span class="p">);</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_buf_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_buf_size</span>
					<span class="o">/</span> <span class="n">MWIFIEX_SDIO_BLOCK_SIZE</span><span class="p">)</span>
				       <span class="o">*</span> <span class="n">MWIFIEX_SDIO_BLOCK_SIZE</span><span class="p">;</span>
		<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">curr_tx_buf_size</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_buf_size</span><span class="p">;</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;cmd: max_tx_buf_size=%d, tx_buf_size=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">max_tx_buf_size</span><span class="p">,</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">tx_buf_size</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">if_ops</span><span class="p">.</span><span class="n">update_mp_end_port</span><span class="p">)</span>
			<span class="n">adapter</span><span class="o">-&gt;</span><span class="n">if_ops</span><span class="p">.</span><span class="n">update_mp_end_port</span><span class="p">(</span><span class="n">adapter</span><span class="p">,</span>
				<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">params</span><span class="p">.</span><span class="n">tx_buf</span><span class="p">.</span><span class="n">mp_end_port</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_AMSDU_AGGR_CTRL</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_amsdu_aggr_ctrl</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_WMM_GET_STATUS</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_wmm_get_status</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_IBSS_COALESCING_STATUS</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_ibss_coalescing_status</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_MAC_REG_ACCESS</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_BBP_REG_ACCESS</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_RF_REG_ACCESS</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_PMIC_REG_ACCESS</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_CAU_REG_ACCESS</span>:
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_EEPROM_ACCESS</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_reg_access</span><span class="p">(</span><span class="n">cmdresp_no</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_SET_BSS_MODE</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_11N_CFG</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_11n_cfg</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_PCIE_DESC_DETAILS</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_802_11_SUBSCRIBE_EVENT</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mwifiex_ret_subsc_evt</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">resp</span><span class="p">,</span> <span class="n">data_buf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_UAP_SYS_CONFIG</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_UAP_BSS_START</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bss_started</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HostCmd_CMD_UAP_BSS_STOP</span>:
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bss_started</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;CMD_RESP: unknown cmd response %#x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">resp</span><span class="o">-&gt;</span><span class="n">command</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
