<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › libertas › if_spi.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>if_spi.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	linux/drivers/net/wireless/libertas/if_spi.c</span>
<span class="cm"> *</span>
<span class="cm"> *	Driver for Marvell SPI WLAN cards.</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright 2008 Analog Devices Inc.</span>
<span class="cm"> *</span>
<span class="cm"> *	Authors:</span>
<span class="cm"> *	Andrey Yurovsky &lt;andrey@cozybit.com&gt;</span>
<span class="cm"> *	Colin McCabe &lt;colin@cozybit.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or (at</span>
<span class="cm"> * your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LBS_IF_SPI_H_</span>
<span class="cp">#define _LBS_IF_SPI_H_</span>

<span class="cp">#define IPFIELD_ALIGN_OFFSET 2</span>
<span class="cp">#define IF_SPI_CMD_BUF_SIZE 2400</span>

<span class="cm">/***************** Firmware *****************/</span>

<span class="cp">#define IF_SPI_FW_NAME_MAX 30</span>

<span class="cp">#define MAX_MAIN_FW_LOAD_CRC_ERR 10</span>

<span class="cm">/* Chunk size when loading the helper firmware */</span>
<span class="cp">#define HELPER_FW_LOAD_CHUNK_SZ 64</span>

<span class="cm">/* Value to write to indicate end of helper firmware dnld */</span>
<span class="cp">#define FIRMWARE_DNLD_OK 0x0000</span>

<span class="cm">/* Value to check once the main firmware is downloaded */</span>
<span class="cp">#define SUCCESSFUL_FW_DOWNLOAD_MAGIC 0x88888888</span>

<span class="cm">/***************** SPI Interface Unit *****************/</span>
<span class="cm">/* Masks used in SPI register read/write operations */</span>
<span class="cp">#define IF_SPI_READ_OPERATION_MASK 0x0</span>
<span class="cp">#define IF_SPI_WRITE_OPERATION_MASK 0x8000</span>

<span class="cm">/* SPI register offsets. 4-byte aligned. */</span>
<span class="cp">#define IF_SPI_DEVICEID_CTRL_REG 0x00	</span><span class="cm">/* DeviceID controller reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_IO_READBASE_REG 0x04 	</span><span class="cm">/* Read I/O base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_IO_WRITEBASE_REG 0x08	</span><span class="cm">/* Write I/O base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_IO_RDWRPORT_REG 0x0C	</span><span class="cm">/* Read/Write I/O port reg */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_CMD_READBASE_REG 0x10	</span><span class="cm">/* Read command base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_CMD_WRITEBASE_REG 0x14	</span><span class="cm">/* Write command base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_CMD_RDWRPORT_REG 0x18	</span><span class="cm">/* Read/Write command port reg */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_DATA_READBASE_REG 0x1C	</span><span class="cm">/* Read data base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_DATA_WRITEBASE_REG 0x20	</span><span class="cm">/* Write data base reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_DATA_RDWRPORT_REG 0x24	</span><span class="cm">/* Read/Write data port reg */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_SCRATCH_1_REG 0x28	</span><span class="cm">/* Scratch reg 1 */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_SCRATCH_2_REG 0x2C	</span><span class="cm">/* Scratch reg 2 */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_SCRATCH_3_REG 0x30	</span><span class="cm">/* Scratch reg 3 */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_SCRATCH_4_REG 0x34	</span><span class="cm">/* Scratch reg 4 */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_TX_FRAME_SEQ_NUM_REG 0x38 </span><span class="cm">/* Tx frame sequence number reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_TX_FRAME_STATUS_REG 0x3C	</span><span class="cm">/* Tx frame status reg */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_HOST_INT_CTRL_REG 0x40	</span><span class="cm">/* Host interrupt controller reg */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_CARD_INT_CAUSE_REG 0x44	</span><span class="cm">/* Card interrupt cause reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_CARD_INT_STATUS_REG 0x48 </span><span class="cm">/* Card interrupt status reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_CARD_INT_EVENT_MASK_REG 0x4C </span><span class="cm">/* Card interrupt event mask */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_CARD_INT_STATUS_MASK_REG	0x50 </span><span class="cm">/* Card interrupt status mask */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_CARD_INT_RESET_SELECT_REG 0x54 </span><span class="cm">/* Card interrupt reset select */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_HOST_INT_CAUSE_REG 0x58	</span><span class="cm">/* Host interrupt cause reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_HOST_INT_STATUS_REG 0x5C	</span><span class="cm">/* Host interrupt status reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_HOST_INT_EVENT_MASK_REG 0x60 </span><span class="cm">/* Host interrupt event mask */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_HOST_INT_STATUS_MASK_REG	0x64 </span><span class="cm">/* Host interrupt status mask */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_HOST_INT_RESET_SELECT_REG 0x68 </span><span class="cm">/* Host interrupt reset select */</span><span class="cp"></span>

<span class="cp">#define IF_SPI_DELAY_READ_REG 0x6C	</span><span class="cm">/* Delay read reg */</span><span class="cp"></span>
<span class="cp">#define IF_SPI_SPU_BUS_MODE_REG 0x70	</span><span class="cm">/* SPU BUS mode reg */</span><span class="cp"></span>

<span class="cm">/***************** IF_SPI_DEVICEID_CTRL_REG *****************/</span>
<span class="cp">#define IF_SPI_DEVICEID_CTRL_REG_TO_CARD_ID(dc) ((dc &amp; 0xffff0000)&gt;&gt;16)</span>
<span class="cp">#define IF_SPI_DEVICEID_CTRL_REG_TO_CARD_REV(dc) (dc &amp; 0x000000ff)</span>

<span class="cm">/***************** IF_SPI_HOST_INT_CTRL_REG *****************/</span>
<span class="cm">/* Host Interrupt Control bit : Wake up */</span>
<span class="cp">#define IF_SPI_HICT_WAKE_UP				(1&lt;&lt;0)</span>
<span class="cm">/* Host Interrupt Control bit : WLAN ready */</span>
<span class="cp">#define IF_SPI_HICT_WLAN_READY				(1&lt;&lt;1)</span>
<span class="cm">/*#define IF_SPI_HICT_FIFO_FIRST_HALF_EMPTY		(1&lt;&lt;2) */</span>
<span class="cm">/*#define IF_SPI_HICT_FIFO_SECOND_HALF_EMPTY		(1&lt;&lt;3) */</span>
<span class="cm">/*#define IF_SPI_HICT_IRQSRC_WLAN			(1&lt;&lt;4) */</span>
<span class="cm">/* Host Interrupt Control bit : Tx auto download */</span>
<span class="cp">#define IF_SPI_HICT_TX_DOWNLOAD_OVER_AUTO		(1&lt;&lt;5)</span>
<span class="cm">/* Host Interrupt Control bit : Rx auto upload */</span>
<span class="cp">#define IF_SPI_HICT_RX_UPLOAD_OVER_AUTO			(1&lt;&lt;6)</span>
<span class="cm">/* Host Interrupt Control bit : Command auto download */</span>
<span class="cp">#define IF_SPI_HICT_CMD_DOWNLOAD_OVER_AUTO		(1&lt;&lt;7)</span>
<span class="cm">/* Host Interrupt Control bit : Command auto upload */</span>
<span class="cp">#define IF_SPI_HICT_CMD_UPLOAD_OVER_AUTO		(1&lt;&lt;8)</span>

<span class="cm">/***************** IF_SPI_CARD_INT_CAUSE_REG *****************/</span>
<span class="cm">/* Card Interrupt Case bit : Tx download over */</span>
<span class="cp">#define IF_SPI_CIC_TX_DOWNLOAD_OVER			(1&lt;&lt;0)</span>
<span class="cm">/* Card Interrupt Case bit : Rx upload over */</span>
<span class="cp">#define IF_SPI_CIC_RX_UPLOAD_OVER			(1&lt;&lt;1)</span>
<span class="cm">/* Card Interrupt Case bit : Command download over */</span>
<span class="cp">#define IF_SPI_CIC_CMD_DOWNLOAD_OVER			(1&lt;&lt;2)</span>
<span class="cm">/* Card Interrupt Case bit : Host event */</span>
<span class="cp">#define IF_SPI_CIC_HOST_EVENT				(1&lt;&lt;3)</span>
<span class="cm">/* Card Interrupt Case bit : Command upload over */</span>
<span class="cp">#define IF_SPI_CIC_CMD_UPLOAD_OVER			(1&lt;&lt;4)</span>
<span class="cm">/* Card Interrupt Case bit : Power down */</span>
<span class="cp">#define IF_SPI_CIC_POWER_DOWN				(1&lt;&lt;5)</span>

<span class="cm">/***************** IF_SPI_CARD_INT_STATUS_REG *****************/</span>
<span class="cp">#define IF_SPI_CIS_TX_DOWNLOAD_OVER			(1&lt;&lt;0)</span>
<span class="cp">#define IF_SPI_CIS_RX_UPLOAD_OVER			(1&lt;&lt;1)</span>
<span class="cp">#define IF_SPI_CIS_CMD_DOWNLOAD_OVER			(1&lt;&lt;2)</span>
<span class="cp">#define IF_SPI_CIS_HOST_EVENT				(1&lt;&lt;3)</span>
<span class="cp">#define IF_SPI_CIS_CMD_UPLOAD_OVER			(1&lt;&lt;4)</span>
<span class="cp">#define IF_SPI_CIS_POWER_DOWN				(1&lt;&lt;5)</span>

<span class="cm">/***************** IF_SPI_HOST_INT_CAUSE_REG *****************/</span>
<span class="cp">#define IF_SPI_HICU_TX_DOWNLOAD_RDY			(1&lt;&lt;0)</span>
<span class="cp">#define IF_SPI_HICU_RX_UPLOAD_RDY			(1&lt;&lt;1)</span>
<span class="cp">#define IF_SPI_HICU_CMD_DOWNLOAD_RDY			(1&lt;&lt;2)</span>
<span class="cp">#define IF_SPI_HICU_CARD_EVENT				(1&lt;&lt;3)</span>
<span class="cp">#define IF_SPI_HICU_CMD_UPLOAD_RDY			(1&lt;&lt;4)</span>
<span class="cp">#define IF_SPI_HICU_IO_WR_FIFO_OVERFLOW			(1&lt;&lt;5)</span>
<span class="cp">#define IF_SPI_HICU_IO_RD_FIFO_UNDERFLOW		(1&lt;&lt;6)</span>
<span class="cp">#define IF_SPI_HICU_DATA_WR_FIFO_OVERFLOW		(1&lt;&lt;7)</span>
<span class="cp">#define IF_SPI_HICU_DATA_RD_FIFO_UNDERFLOW		(1&lt;&lt;8)</span>
<span class="cp">#define IF_SPI_HICU_CMD_WR_FIFO_OVERFLOW		(1&lt;&lt;9)</span>
<span class="cp">#define IF_SPI_HICU_CMD_RD_FIFO_UNDERFLOW		(1&lt;&lt;10)</span>

<span class="cm">/***************** IF_SPI_HOST_INT_STATUS_REG *****************/</span>
<span class="cm">/* Host Interrupt Status bit : Tx download ready */</span>
<span class="cp">#define IF_SPI_HIST_TX_DOWNLOAD_RDY			(1&lt;&lt;0)</span>
<span class="cm">/* Host Interrupt Status bit : Rx upload ready */</span>
<span class="cp">#define IF_SPI_HIST_RX_UPLOAD_RDY			(1&lt;&lt;1)</span>
<span class="cm">/* Host Interrupt Status bit : Command download ready */</span>
<span class="cp">#define IF_SPI_HIST_CMD_DOWNLOAD_RDY			(1&lt;&lt;2)</span>
<span class="cm">/* Host Interrupt Status bit : Card event */</span>
<span class="cp">#define IF_SPI_HIST_CARD_EVENT				(1&lt;&lt;3)</span>
<span class="cm">/* Host Interrupt Status bit : Command upload ready */</span>
<span class="cp">#define IF_SPI_HIST_CMD_UPLOAD_RDY			(1&lt;&lt;4)</span>
<span class="cm">/* Host Interrupt Status bit : I/O write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HIST_IO_WR_FIFO_OVERFLOW			(1&lt;&lt;5)</span>
<span class="cm">/* Host Interrupt Status bit : I/O read FIFO underflow */</span>
<span class="cp">#define IF_SPI_HIST_IO_RD_FIFO_UNDRFLOW			(1&lt;&lt;6)</span>
<span class="cm">/* Host Interrupt Status bit : Data write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HIST_DATA_WR_FIFO_OVERFLOW		(1&lt;&lt;7)</span>
<span class="cm">/* Host Interrupt Status bit : Data read FIFO underflow */</span>
<span class="cp">#define IF_SPI_HIST_DATA_RD_FIFO_UNDERFLOW		(1&lt;&lt;8)</span>
<span class="cm">/* Host Interrupt Status bit : Command write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HIST_CMD_WR_FIFO_OVERFLOW		(1&lt;&lt;9)</span>
<span class="cm">/* Host Interrupt Status bit : Command read FIFO underflow */</span>
<span class="cp">#define IF_SPI_HIST_CMD_RD_FIFO_UNDERFLOW		(1&lt;&lt;10)</span>

<span class="cm">/***************** IF_SPI_HOST_INT_STATUS_MASK_REG *****************/</span>
<span class="cm">/* Host Interrupt Status Mask bit : Tx download ready */</span>
<span class="cp">#define IF_SPI_HISM_TX_DOWNLOAD_RDY			(1&lt;&lt;0)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Rx upload ready */</span>
<span class="cp">#define IF_SPI_HISM_RX_UPLOAD_RDY			(1&lt;&lt;1)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Command download ready */</span>
<span class="cp">#define IF_SPI_HISM_CMD_DOWNLOAD_RDY			(1&lt;&lt;2)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Card event */</span>
<span class="cp">#define IF_SPI_HISM_CARDEVENT				(1&lt;&lt;3)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Command upload ready */</span>
<span class="cp">#define IF_SPI_HISM_CMD_UPLOAD_RDY			(1&lt;&lt;4)</span>
<span class="cm">/* Host Interrupt Status Mask bit : I/O write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HISM_IO_WR_FIFO_OVERFLOW			(1&lt;&lt;5)</span>
<span class="cm">/* Host Interrupt Status Mask bit : I/O read FIFO underflow */</span>
<span class="cp">#define IF_SPI_HISM_IO_RD_FIFO_UNDERFLOW		(1&lt;&lt;6)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Data write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HISM_DATA_WR_FIFO_OVERFLOW		(1&lt;&lt;7)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Data write FIFO underflow */</span>
<span class="cp">#define IF_SPI_HISM_DATA_RD_FIFO_UNDERFLOW		(1&lt;&lt;8)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Command write FIFO overflow */</span>
<span class="cp">#define IF_SPI_HISM_CMD_WR_FIFO_OVERFLOW		(1&lt;&lt;9)</span>
<span class="cm">/* Host Interrupt Status Mask bit : Command write FIFO underflow */</span>
<span class="cp">#define IF_SPI_HISM_CMD_RD_FIFO_UNDERFLOW		(1&lt;&lt;10)</span>

<span class="cm">/***************** IF_SPI_SPU_BUS_MODE_REG *****************/</span>
<span class="cm">/* SCK edge on which the WLAN module outputs data on MISO */</span>
<span class="cp">#define IF_SPI_BUS_MODE_SPI_CLOCK_PHASE_FALLING 0x8</span>
<span class="cp">#define IF_SPI_BUS_MODE_SPI_CLOCK_PHASE_RISING 0x0</span>

<span class="cm">/* In a SPU read operation, there is a delay between writing the SPU</span>
<span class="cm"> * register name and getting back data from the WLAN module.</span>
<span class="cm"> * This can be specified in terms of nanoseconds or in terms of dummy</span>
<span class="cm"> * clock cycles which the master must output before receiving a response. */</span>
<span class="cp">#define IF_SPI_BUS_MODE_DELAY_METHOD_DUMMY_CLOCK 0x4</span>
<span class="cp">#define IF_SPI_BUS_MODE_DELAY_METHOD_TIMED 0x0</span>

<span class="cm">/* Some different modes of SPI operation */</span>
<span class="cp">#define IF_SPI_BUS_MODE_8_BIT_ADDRESS_16_BIT_DATA 0x00</span>
<span class="cp">#define IF_SPI_BUS_MODE_8_BIT_ADDRESS_32_BIT_DATA 0x01</span>
<span class="cp">#define IF_SPI_BUS_MODE_16_BIT_ADDRESS_16_BIT_DATA 0x02</span>
<span class="cp">#define IF_SPI_BUS_MODE_16_BIT_ADDRESS_32_BIT_DATA 0x03</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
