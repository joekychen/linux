<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › b43legacy › b43legacy.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>b43legacy.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef B43legacy_H_</span>
<span class="cp">#define B43legacy_H_</span>

<span class="cp">#include &lt;linux/hw_random.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/stringify.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/atomic.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>

<span class="cp">#include &lt;linux/ssb/ssb.h&gt;</span>
<span class="cp">#include &lt;linux/ssb/ssb_driver_chipcommon.h&gt;</span>

<span class="cp">#include &lt;net/mac80211.h&gt;</span>

<span class="cp">#include &quot;debugfs.h&quot;</span>
<span class="cp">#include &quot;leds.h&quot;</span>
<span class="cp">#include &quot;rfkill.h&quot;</span>
<span class="cp">#include &quot;phy.h&quot;</span>


<span class="cp">#define B43legacy_IRQWAIT_MAX_RETRIES	20</span>

<span class="cm">/* MMIO offsets */</span>
<span class="cp">#define B43legacy_MMIO_DMA0_REASON	0x20</span>
<span class="cp">#define B43legacy_MMIO_DMA0_IRQ_MASK	0x24</span>
<span class="cp">#define B43legacy_MMIO_DMA1_REASON	0x28</span>
<span class="cp">#define B43legacy_MMIO_DMA1_IRQ_MASK	0x2C</span>
<span class="cp">#define B43legacy_MMIO_DMA2_REASON	0x30</span>
<span class="cp">#define B43legacy_MMIO_DMA2_IRQ_MASK	0x34</span>
<span class="cp">#define B43legacy_MMIO_DMA3_REASON	0x38</span>
<span class="cp">#define B43legacy_MMIO_DMA3_IRQ_MASK	0x3C</span>
<span class="cp">#define B43legacy_MMIO_DMA4_REASON	0x40</span>
<span class="cp">#define B43legacy_MMIO_DMA4_IRQ_MASK	0x44</span>
<span class="cp">#define B43legacy_MMIO_DMA5_REASON	0x48</span>
<span class="cp">#define B43legacy_MMIO_DMA5_IRQ_MASK	0x4C</span>
<span class="cp">#define B43legacy_MMIO_MACCTL		0x120	</span><span class="cm">/* MAC control */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_MACCMD		0x124	</span><span class="cm">/* MAC command */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_GEN_IRQ_REASON	0x128</span>
<span class="cp">#define B43legacy_MMIO_GEN_IRQ_MASK	0x12C</span>
<span class="cp">#define B43legacy_MMIO_RAM_CONTROL	0x130</span>
<span class="cp">#define B43legacy_MMIO_RAM_DATA		0x134</span>
<span class="cp">#define B43legacy_MMIO_PS_STATUS		0x140</span>
<span class="cp">#define B43legacy_MMIO_RADIO_HWENABLED_HI	0x158</span>
<span class="cp">#define B43legacy_MMIO_SHM_CONTROL	0x160</span>
<span class="cp">#define B43legacy_MMIO_SHM_DATA		0x164</span>
<span class="cp">#define B43legacy_MMIO_SHM_DATA_UNALIGNED	0x166</span>
<span class="cp">#define B43legacy_MMIO_XMITSTAT_0		0x170</span>
<span class="cp">#define B43legacy_MMIO_XMITSTAT_1		0x174</span>
<span class="cp">#define B43legacy_MMIO_REV3PLUS_TSF_LOW	0x180 </span><span class="cm">/* core rev &gt;= 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_REV3PLUS_TSF_HIGH	0x184 </span><span class="cm">/* core rev &gt;= 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_TSF_CFP_REP	0x188</span>
<span class="cp">#define B43legacy_MMIO_TSF_CFP_START	0x18C</span>
<span class="cm">/* 32-bit DMA */</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE0	0x200</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE1	0x220</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE2	0x240</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE3	0x260</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE4	0x280</span>
<span class="cp">#define B43legacy_MMIO_DMA32_BASE5	0x2A0</span>
<span class="cm">/* 64-bit DMA */</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE0	0x200</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE1	0x240</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE2	0x280</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE3	0x2C0</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE4	0x300</span>
<span class="cp">#define B43legacy_MMIO_DMA64_BASE5	0x340</span>
<span class="cm">/* PIO */</span>
<span class="cp">#define B43legacy_MMIO_PIO1_BASE		0x300</span>
<span class="cp">#define B43legacy_MMIO_PIO2_BASE		0x310</span>
<span class="cp">#define B43legacy_MMIO_PIO3_BASE		0x320</span>
<span class="cp">#define B43legacy_MMIO_PIO4_BASE		0x330</span>

<span class="cp">#define B43legacy_MMIO_PHY_VER		0x3E0</span>
<span class="cp">#define B43legacy_MMIO_PHY_RADIO		0x3E2</span>
<span class="cp">#define B43legacy_MMIO_PHY0		0x3E6</span>
<span class="cp">#define B43legacy_MMIO_ANTENNA		0x3E8</span>
<span class="cp">#define B43legacy_MMIO_CHANNEL		0x3F0</span>
<span class="cp">#define B43legacy_MMIO_CHANNEL_EXT	0x3F4</span>
<span class="cp">#define B43legacy_MMIO_RADIO_CONTROL	0x3F6</span>
<span class="cp">#define B43legacy_MMIO_RADIO_DATA_HIGH	0x3F8</span>
<span class="cp">#define B43legacy_MMIO_RADIO_DATA_LOW	0x3FA</span>
<span class="cp">#define B43legacy_MMIO_PHY_CONTROL	0x3FC</span>
<span class="cp">#define B43legacy_MMIO_PHY_DATA		0x3FE</span>
<span class="cp">#define B43legacy_MMIO_MACFILTER_CONTROL	0x420</span>
<span class="cp">#define B43legacy_MMIO_MACFILTER_DATA	0x422</span>
<span class="cp">#define B43legacy_MMIO_RCMTA_COUNT	0x43C </span><span class="cm">/* Receive Match Transmitter Addr */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_RADIO_HWENABLED_LO	0x49A</span>
<span class="cp">#define B43legacy_MMIO_GPIO_CONTROL	0x49C</span>
<span class="cp">#define B43legacy_MMIO_GPIO_MASK		0x49E</span>
<span class="cp">#define B43legacy_MMIO_TSF_CFP_PRETBTT	0x612</span>
<span class="cp">#define B43legacy_MMIO_TSF_0		0x632 </span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_TSF_1		0x634 </span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_TSF_2		0x636 </span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_TSF_3		0x638 </span><span class="cm">/* core rev &lt; 3 only */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MMIO_RNG		0x65A</span>
<span class="cp">#define B43legacy_MMIO_POWERUP_DELAY	0x6A8</span>

<span class="cm">/* SPROM boardflags_lo values */</span>
<span class="cp">#define B43legacy_BFL_PACTRL		0x0002</span>
<span class="cp">#define B43legacy_BFL_RSSI		0x0008</span>
<span class="cp">#define B43legacy_BFL_EXTLNA		0x1000</span>

<span class="cm">/* GPIO register offset, in both ChipCommon and PCI core. */</span>
<span class="cp">#define B43legacy_GPIO_CONTROL		0x6c</span>

<span class="cm">/* SHM Routing */</span>
<span class="cp">#define	B43legacy_SHM_SHARED		0x0001</span>
<span class="cp">#define	B43legacy_SHM_WIRELESS		0x0002</span>
<span class="cp">#define	B43legacy_SHM_HW		0x0004</span>
<span class="cp">#define	B43legacy_SHM_UCODE		0x0300</span>

<span class="cm">/* SHM Routing modifiers */</span>
<span class="cp">#define B43legacy_SHM_AUTOINC_R		0x0200 </span><span class="cm">/* Read Auto-increment */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_AUTOINC_W		0x0100 </span><span class="cm">/* Write Auto-increment */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_AUTOINC_RW	(B43legacy_SHM_AUTOINC_R | \</span>
<span class="cp">					 B43legacy_SHM_AUTOINC_W)</span>

<span class="cm">/* Misc SHM_SHARED offsets */</span>
<span class="cp">#define B43legacy_SHM_SH_WLCOREREV	0x0016 </span><span class="cm">/* 802.11 core revision */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_HOSTFLO	0x005E </span><span class="cm">/* Hostflags ucode opts (low) */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_HOSTFHI	0x0060 </span><span class="cm">/* Hostflags ucode opts (high) */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED crypto engine */</span>
<span class="cp">#define B43legacy_SHM_SH_KEYIDXBLOCK	0x05D4 </span><span class="cm">/* Key index/algorithm block */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED beacon/AP variables */</span>
<span class="cp">#define B43legacy_SHM_SH_DTIMP		0x0012 </span><span class="cm">/* DTIM period */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_BTL0		0x0018 </span><span class="cm">/* Beacon template length 0 */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_BTL1		0x001A </span><span class="cm">/* Beacon template length 1 */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_BTSFOFF	0x001C </span><span class="cm">/* Beacon TSF offset */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_TIMPOS		0x001E </span><span class="cm">/* TIM position in beacon */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_BEACPHYCTL	0x0054 </span><span class="cm">/* Beacon PHY TX control word */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED ACK/CTS control */</span>
<span class="cp">#define B43legacy_SHM_SH_ACKCTSPHYCTL	0x0022 </span><span class="cm">/* ACK/CTS PHY control word */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED probe response variables */</span>
<span class="cp">#define B43legacy_SHM_SH_PRTLEN		0x004A </span><span class="cm">/* Probe Response template length */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_PRMAXTIME	0x0074 </span><span class="cm">/* Probe Response max time */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_PRPHYCTL	0x0188 </span><span class="cm">/* Probe Resp PHY TX control */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED rate tables */</span>
<span class="cp">#define B43legacy_SHM_SH_OFDMDIRECT	0x0480 </span><span class="cm">/* Pointer to OFDM direct map */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_OFDMBASIC	0x04A0 </span><span class="cm">/* Pointer to OFDM basic rate map */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_CCKDIRECT	0x04C0 </span><span class="cm">/* Pointer to CCK direct map */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_CCKBASIC	0x04E0 </span><span class="cm">/* Pointer to CCK basic rate map */</span><span class="cp"></span>
<span class="cm">/* SHM_SHARED microcode soft registers */</span>
<span class="cp">#define B43legacy_SHM_SH_UCODEREV	0x0000 </span><span class="cm">/* Microcode revision */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_UCODEPATCH	0x0002 </span><span class="cm">/* Microcode patchlevel */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_UCODEDATE	0x0004 </span><span class="cm">/* Microcode date */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_UCODETIME	0x0006 </span><span class="cm">/* Microcode time */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_SPUWKUP	0x0094 </span><span class="cm">/* pre-wakeup for synth PU in us */</span><span class="cp"></span>
<span class="cp">#define B43legacy_SHM_SH_PRETBTT	0x0096 </span><span class="cm">/* pre-TBTT in us */</span><span class="cp"></span>

<span class="cp">#define B43legacy_UCODEFLAGS_OFFSET     0x005E</span>

<span class="cm">/* Hardware Radio Enable masks */</span>
<span class="cp">#define B43legacy_MMIO_RADIO_HWENABLED_HI_MASK (1 &lt;&lt; 16)</span>
<span class="cp">#define B43legacy_MMIO_RADIO_HWENABLED_LO_MASK (1 &lt;&lt; 4)</span>

<span class="cm">/* HostFlags. See b43legacy_hf_read/write() */</span>
<span class="cp">#define B43legacy_HF_SYMW		0x00000002 </span><span class="cm">/* G-PHY SYM workaround */</span><span class="cp"></span>
<span class="cp">#define B43legacy_HF_GDCW		0x00000020 </span><span class="cm">/* G-PHY DV cancel filter */</span><span class="cp"></span>
<span class="cp">#define B43legacy_HF_OFDMPABOOST	0x00000040 </span><span class="cm">/* Enable PA boost OFDM */</span><span class="cp"></span>
<span class="cp">#define B43legacy_HF_EDCF		0x00000100 </span><span class="cm">/* on if WME/MAC suspended */</span><span class="cp"></span>

<span class="cm">/* MacFilter offsets. */</span>
<span class="cp">#define B43legacy_MACFILTER_SELF	0x0000</span>
<span class="cp">#define B43legacy_MACFILTER_BSSID	0x0003</span>
<span class="cp">#define B43legacy_MACFILTER_MAC		0x0010</span>

<span class="cm">/* PHYVersioning */</span>
<span class="cp">#define B43legacy_PHYTYPE_B		0x01</span>
<span class="cp">#define B43legacy_PHYTYPE_G		0x02</span>

<span class="cm">/* PHYRegisters */</span>
<span class="cp">#define B43legacy_PHY_G_LO_CONTROL	0x0810</span>
<span class="cp">#define B43legacy_PHY_ILT_G_CTRL	0x0472</span>
<span class="cp">#define B43legacy_PHY_ILT_G_DATA1	0x0473</span>
<span class="cp">#define B43legacy_PHY_ILT_G_DATA2	0x0474</span>
<span class="cp">#define B43legacy_PHY_G_PCTL		0x0029</span>
<span class="cp">#define B43legacy_PHY_RADIO_BITFIELD	0x0401</span>
<span class="cp">#define B43legacy_PHY_G_CRS		0x0429</span>
<span class="cp">#define B43legacy_PHY_NRSSILT_CTRL	0x0803</span>
<span class="cp">#define B43legacy_PHY_NRSSILT_DATA	0x0804</span>

<span class="cm">/* RadioRegisters */</span>
<span class="cp">#define B43legacy_RADIOCTL_ID		0x01</span>

<span class="cm">/* MAC Control bitfield */</span>
<span class="cp">#define B43legacy_MACCTL_ENABLED	0x00000001 </span><span class="cm">/* MAC Enabled */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_PSM_RUN	0x00000002 </span><span class="cm">/* Run Microcode */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_PSM_JMP0	0x00000004 </span><span class="cm">/* Microcode jump to 0 */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_SHM_ENABLED	0x00000100 </span><span class="cm">/* SHM Enabled */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_IHR_ENABLED	0x00000400 </span><span class="cm">/* IHR Region Enabled */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_BE		0x00010000 </span><span class="cm">/* Big Endian mode */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_INFRA		0x00020000 </span><span class="cm">/* Infrastructure mode */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_AP		0x00040000 </span><span class="cm">/* AccessPoint mode */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_RADIOLOCK	0x00080000 </span><span class="cm">/* Radio lock */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_BEACPROMISC	0x00100000 </span><span class="cm">/* Beacon Promiscuous */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_KEEP_BADPLCP	0x00200000 </span><span class="cm">/* Keep bad PLCP frames */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_KEEP_CTL	0x00400000 </span><span class="cm">/* Keep control frames */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_KEEP_BAD	0x00800000 </span><span class="cm">/* Keep bad frames (FCS) */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_PROMISC	0x01000000 </span><span class="cm">/* Promiscuous mode */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_HWPS		0x02000000 </span><span class="cm">/* Hardware Power Saving */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_AWAKE		0x04000000 </span><span class="cm">/* Device is awake */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_TBTTHOLD	0x10000000 </span><span class="cm">/* TBTT Hold */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCTL_GMODE		0x80000000 </span><span class="cm">/* G Mode */</span><span class="cp"></span>

<span class="cm">/* MAC Command bitfield */</span>
<span class="cp">#define B43legacy_MACCMD_BEACON0_VALID	0x00000001 </span><span class="cm">/* Beacon 0 in template RAM is busy/valid */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCMD_BEACON1_VALID	0x00000002 </span><span class="cm">/* Beacon 1 in template RAM is busy/valid */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCMD_DFQ_VALID	0x00000004 </span><span class="cm">/* Directed frame queue valid (IBSS PS mode, ATIM) */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCMD_CCA		0x00000008 </span><span class="cm">/* Clear channel assessment */</span><span class="cp"></span>
<span class="cp">#define B43legacy_MACCMD_BGNOISE	0x00000010 </span><span class="cm">/* Background noise */</span><span class="cp"></span>

<span class="cm">/* 802.11 core specific TM State Low flags */</span>
<span class="cp">#define B43legacy_TMSLOW_GMODE		0x20000000 </span><span class="cm">/* G Mode Enable */</span><span class="cp"></span>
<span class="cp">#define B43legacy_TMSLOW_PLLREFSEL	0x00200000 </span><span class="cm">/* PLL Freq Ref Select */</span><span class="cp"></span>
<span class="cp">#define B43legacy_TMSLOW_MACPHYCLKEN	0x00100000 </span><span class="cm">/* MAC PHY Clock Ctrl Enbl */</span><span class="cp"></span>
<span class="cp">#define B43legacy_TMSLOW_PHYRESET	0x00080000 </span><span class="cm">/* PHY Reset */</span><span class="cp"></span>
<span class="cp">#define B43legacy_TMSLOW_PHYCLKEN	0x00040000 </span><span class="cm">/* PHY Clock Enable */</span><span class="cp"></span>

<span class="cm">/* 802.11 core specific TM State High flags */</span>
<span class="cp">#define B43legacy_TMSHIGH_FCLOCK	0x00040000 </span><span class="cm">/* Fast Clock Available */</span><span class="cp"></span>
<span class="cp">#define B43legacy_TMSHIGH_GPHY		0x00010000 </span><span class="cm">/* G-PHY avail (rev &gt;= 5) */</span><span class="cp"></span>

<span class="cp">#define B43legacy_UCODEFLAG_AUTODIV       0x0001</span>

<span class="cm">/* Generic-Interrupt reasons. */</span>
<span class="cp">#define B43legacy_IRQ_MAC_SUSPENDED	0x00000001</span>
<span class="cp">#define B43legacy_IRQ_BEACON		0x00000002</span>
<span class="cp">#define B43legacy_IRQ_TBTT_INDI		0x00000004 </span><span class="cm">/* Target Beacon Transmit Time */</span><span class="cp"></span>
<span class="cp">#define B43legacy_IRQ_BEACON_TX_OK	0x00000008</span>
<span class="cp">#define B43legacy_IRQ_BEACON_CANCEL	0x00000010</span>
<span class="cp">#define B43legacy_IRQ_ATIM_END		0x00000020</span>
<span class="cp">#define B43legacy_IRQ_PMQ		0x00000040</span>
<span class="cp">#define B43legacy_IRQ_PIO_WORKAROUND	0x00000100</span>
<span class="cp">#define B43legacy_IRQ_MAC_TXERR		0x00000200</span>
<span class="cp">#define B43legacy_IRQ_PHY_TXERR		0x00000800</span>
<span class="cp">#define B43legacy_IRQ_PMEVENT		0x00001000</span>
<span class="cp">#define B43legacy_IRQ_TIMER0		0x00002000</span>
<span class="cp">#define B43legacy_IRQ_TIMER1		0x00004000</span>
<span class="cp">#define B43legacy_IRQ_DMA		0x00008000</span>
<span class="cp">#define B43legacy_IRQ_TXFIFO_FLUSH_OK	0x00010000</span>
<span class="cp">#define B43legacy_IRQ_CCA_MEASURE_OK	0x00020000</span>
<span class="cp">#define B43legacy_IRQ_NOISESAMPLE_OK	0x00040000</span>
<span class="cp">#define B43legacy_IRQ_UCODE_DEBUG	0x08000000</span>
<span class="cp">#define B43legacy_IRQ_RFKILL		0x10000000</span>
<span class="cp">#define B43legacy_IRQ_TX_OK		0x20000000</span>
<span class="cp">#define B43legacy_IRQ_PHY_G_CHANGED	0x40000000</span>
<span class="cp">#define B43legacy_IRQ_TIMEOUT		0x80000000</span>

<span class="cp">#define B43legacy_IRQ_ALL		0xFFFFFFFF</span>
<span class="cp">#define B43legacy_IRQ_MASKTEMPLATE	(B43legacy_IRQ_MAC_SUSPENDED |	\</span>
<span class="cp">					 B43legacy_IRQ_TBTT_INDI |	\</span>
<span class="cp">					 B43legacy_IRQ_ATIM_END |	\</span>
<span class="cp">					 B43legacy_IRQ_PMQ |		\</span>
<span class="cp">					 B43legacy_IRQ_MAC_TXERR |	\</span>
<span class="cp">					 B43legacy_IRQ_PHY_TXERR |	\</span>
<span class="cp">					 B43legacy_IRQ_DMA |		\</span>
<span class="cp">					 B43legacy_IRQ_TXFIFO_FLUSH_OK | \</span>
<span class="cp">					 B43legacy_IRQ_NOISESAMPLE_OK | \</span>
<span class="cp">					 B43legacy_IRQ_UCODE_DEBUG |	\</span>
<span class="cp">					 B43legacy_IRQ_RFKILL |		\</span>
<span class="cp">					 B43legacy_IRQ_TX_OK)</span>

<span class="cm">/* Device specific rate values.</span>
<span class="cm"> * The actual values defined here are (rate_in_mbps * 2).</span>
<span class="cm"> * Some code depends on this. Don&#39;t change it. */</span>
<span class="cp">#define B43legacy_CCK_RATE_1MB		2</span>
<span class="cp">#define B43legacy_CCK_RATE_2MB		4</span>
<span class="cp">#define B43legacy_CCK_RATE_5MB		11</span>
<span class="cp">#define B43legacy_CCK_RATE_11MB		22</span>
<span class="cp">#define B43legacy_OFDM_RATE_6MB		12</span>
<span class="cp">#define B43legacy_OFDM_RATE_9MB		18</span>
<span class="cp">#define B43legacy_OFDM_RATE_12MB	24</span>
<span class="cp">#define B43legacy_OFDM_RATE_18MB	36</span>
<span class="cp">#define B43legacy_OFDM_RATE_24MB	48</span>
<span class="cp">#define B43legacy_OFDM_RATE_36MB	72</span>
<span class="cp">#define B43legacy_OFDM_RATE_48MB	96</span>
<span class="cp">#define B43legacy_OFDM_RATE_54MB	108</span>
<span class="cm">/* Convert a b43legacy rate value to a rate in 100kbps */</span>
<span class="cp">#define B43legacy_RATE_TO_100KBPS(rate)	(((rate) * 10) / 2)</span>


<span class="cp">#define B43legacy_DEFAULT_SHORT_RETRY_LIMIT	7</span>
<span class="cp">#define B43legacy_DEFAULT_LONG_RETRY_LIMIT	4</span>

<span class="cp">#define B43legacy_PHY_TX_BADNESS_LIMIT		1000</span>

<span class="cm">/* Max size of a security key */</span>
<span class="cp">#define B43legacy_SEC_KEYSIZE		16</span>
<span class="cm">/* Security algorithms. */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43legacy_SEC_ALGO_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* unencrypted, as of TX header. */</span>
	<span class="n">B43legacy_SEC_ALGO_WEP40</span><span class="p">,</span>
	<span class="n">B43legacy_SEC_ALGO_TKIP</span><span class="p">,</span>
	<span class="n">B43legacy_SEC_ALGO_AES</span><span class="p">,</span>
	<span class="n">B43legacy_SEC_ALGO_WEP104</span><span class="p">,</span>
	<span class="n">B43legacy_SEC_ALGO_AES_LEGACY</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Core Information Registers */</span>
<span class="cp">#define B43legacy_CIR_BASE                0xf00</span>
<span class="cp">#define B43legacy_CIR_SBTPSFLAG           (B43legacy_CIR_BASE + 0x18)</span>
<span class="cp">#define B43legacy_CIR_SBIMSTATE           (B43legacy_CIR_BASE + 0x90)</span>
<span class="cp">#define B43legacy_CIR_SBINTVEC            (B43legacy_CIR_BASE + 0x94)</span>
<span class="cp">#define B43legacy_CIR_SBTMSTATELOW        (B43legacy_CIR_BASE + 0x98)</span>
<span class="cp">#define B43legacy_CIR_SBTMSTATEHIGH       (B43legacy_CIR_BASE + 0x9c)</span>
<span class="cp">#define B43legacy_CIR_SBIMCONFIGLOW       (B43legacy_CIR_BASE + 0xa8)</span>
<span class="cp">#define B43legacy_CIR_SB_ID_HI            (B43legacy_CIR_BASE + 0xfc)</span>

<span class="cm">/* sbtmstatehigh state flags */</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_SERROR		0x00000001</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_BUSY		0x00000004</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_TIMEOUT		0x00000020</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_G_PHY_AVAIL	0x00010000</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_COREFLAGS	0x1FFF0000</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_DMA64BIT	0x10000000</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_GATEDCLK	0x20000000</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_BISTFAILED	0x40000000</span>
<span class="cp">#define B43legacy_SBTMSTATEHIGH_BISTCOMPLETE	0x80000000</span>

<span class="cm">/* sbimstate flags */</span>
<span class="cp">#define B43legacy_SBIMSTATE_IB_ERROR		0x20000</span>
<span class="cp">#define B43legacy_SBIMSTATE_TIMEOUT		0x40000</span>

<span class="cp">#define PFX		KBUILD_MODNAME &quot;: &quot;</span>
<span class="cp">#ifdef assert</span>
<span class="cp"># undef assert</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_B43LEGACY_DEBUG</span>
<span class="cp"># define B43legacy_WARN_ON(x)	WARN_ON(x)</span>
<span class="cp"># define B43legacy_BUG_ON(expr)						\</span>
<span class="cp">	do {								\</span>
<span class="cp">		if (unlikely((expr))) {					\</span>
<span class="cp">			printk(KERN_INFO PFX &quot;Test (%s) failed\n&quot;,	\</span>
<span class="cp">					      #expr);			\</span>
<span class="cp">			BUG_ON(expr);					\</span>
<span class="cp">		}							\</span>
<span class="cp">	} while (0)</span>
<span class="cp"># define B43legacy_DEBUG	1</span>
<span class="cp">#else</span>
<span class="cm">/* This will evaluate the argument even if debugging is disabled. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__b43legacy_warn_on_dummy</span><span class="p">(</span><span class="n">bool</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">}</span>
<span class="cp"># define B43legacy_WARN_ON(x)	__b43legacy_warn_on_dummy(unlikely(!!(x)))</span>
<span class="cp"># define B43legacy_BUG_ON(x)	do { </span><span class="cm">/* nothing */</span><span class="cp"> } while (0)</span>
<span class="cp"># define B43legacy_DEBUG	0</span>
<span class="cp">#endif</span>


<span class="k">struct</span> <span class="n">net_device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">pci_dev</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">b43legacy_dmaring</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">b43legacy_pioqueue</span><span class="p">;</span>

<span class="cm">/* The firmware file header */</span>
<span class="cp">#define B43legacy_FW_TYPE_UCODE	&#39;u&#39;</span>
<span class="cp">#define B43legacy_FW_TYPE_PCM	&#39;p&#39;</span>
<span class="cp">#define B43legacy_FW_TYPE_IV	&#39;i&#39;</span>
<span class="k">struct</span> <span class="n">b43legacy_fw_header</span> <span class="p">{</span>
	<span class="cm">/* File type */</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="cm">/* File format version */</span>
	<span class="n">u8</span> <span class="n">ver</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">__padding</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="cm">/* Size of the data. For ucode and PCM this is in bytes.</span>
<span class="cm">	 * For IV this is number-of-ivs. */</span>
	<span class="n">__be32</span> <span class="n">size</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* Initial Value file format */</span>
<span class="cp">#define B43legacy_IV_OFFSET_MASK	0x7FFF</span>
<span class="cp">#define B43legacy_IV_32BIT		0x8000</span>
<span class="k">struct</span> <span class="n">b43legacy_iv</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">offset_size</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">__be16</span> <span class="n">d16</span><span class="p">;</span>
		<span class="n">__be32</span> <span class="n">d32</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">data</span> <span class="n">__packed</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define B43legacy_PHYMODE(phytype)	(1 &lt;&lt; (phytype))</span>
<span class="cp">#define B43legacy_PHYMODE_B		B43legacy_PHYMODE	\</span>
<span class="cp">					((B43legacy_PHYTYPE_B))</span>
<span class="cp">#define B43legacy_PHYMODE_G		B43legacy_PHYMODE	\</span>
<span class="cp">					((B43legacy_PHYTYPE_G))</span>

<span class="cm">/* Value pair to measure the LocalOscillator. */</span>
<span class="k">struct</span> <span class="n">b43legacy_lopair</span> <span class="p">{</span>
	<span class="n">s8</span> <span class="n">low</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">high</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">used</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define B43legacy_LO_COUNT	(14*4)</span>

<span class="k">struct</span> <span class="n">b43legacy_phy</span> <span class="p">{</span>
	<span class="cm">/* Possible PHYMODEs on this PHY */</span>
	<span class="n">u8</span> <span class="n">possible_phymodes</span><span class="p">;</span>
	<span class="cm">/* GMODE bit enabled in MACCTL? */</span>
	<span class="n">bool</span> <span class="n">gmode</span><span class="p">;</span>

	<span class="cm">/* Analog Type */</span>
	<span class="n">u8</span> <span class="n">analog</span><span class="p">;</span>
	<span class="cm">/* B43legacy_PHYTYPE_ */</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="cm">/* PHY revision number. */</span>
	<span class="n">u8</span> <span class="n">rev</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">antenna_diversity</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">savedpctlreg</span><span class="p">;</span>
	<span class="cm">/* Radio versioning */</span>
	<span class="n">u16</span> <span class="n">radio_manuf</span><span class="p">;</span>	<span class="cm">/* Radio manufacturer */</span>
	<span class="n">u16</span> <span class="n">radio_ver</span><span class="p">;</span>		<span class="cm">/* Radio version */</span>
	<span class="n">u8</span> <span class="n">calibrated</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">radio_rev</span><span class="p">;</span>		<span class="cm">/* Radio revision */</span>

	<span class="n">bool</span> <span class="n">dyn_tssi_tbl</span><span class="p">;</span>	<span class="cm">/* tssi2dbm is kmalloc()ed. */</span>

	<span class="cm">/* ACI (adjacent channel interference) flags. */</span>
	<span class="n">bool</span> <span class="n">aci_enable</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">aci_wlan_automatic</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">aci_hw_rssi</span><span class="p">;</span>

	<span class="cm">/* Radio switched on/off */</span>
	<span class="n">bool</span> <span class="n">radio_on</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/* Values saved when turning the radio off.</span>
<span class="cm">		 * They are needed when turning it on again. */</span>
		<span class="n">bool</span> <span class="n">valid</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">rfover</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">rfoverval</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">radio_off_context</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">minlowsig</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">minlowsigpos</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* LO Measurement Data.</span>
<span class="cm">	 * Use b43legacy_get_lopair() to get a value.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">b43legacy_lopair</span> <span class="o">*</span><span class="n">_lo_pairs</span><span class="p">;</span>
	<span class="cm">/* TSSI to dBm table in use */</span>
	<span class="k">const</span> <span class="n">s8</span> <span class="o">*</span><span class="n">tssi2dbm</span><span class="p">;</span>
	<span class="cm">/* idle TSSI value */</span>
	<span class="n">s8</span> <span class="n">idle_tssi</span><span class="p">;</span>
	<span class="cm">/* Target idle TSSI */</span>
	<span class="kt">int</span> <span class="n">tgt_idle_tssi</span><span class="p">;</span>
	<span class="cm">/* Current idle TSSI */</span>
	<span class="kt">int</span> <span class="n">cur_idle_tssi</span><span class="p">;</span>

	<span class="cm">/* LocalOscillator control values. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_txpower_lo_control</span> <span class="o">*</span><span class="n">lo_control</span><span class="p">;</span>
	<span class="cm">/* Values from b43legacy_calc_loopback_gain() */</span>
	<span class="n">s16</span> <span class="n">max_lb_gain</span><span class="p">;</span>	<span class="cm">/* Maximum Loopback gain in hdB */</span>
	<span class="n">s16</span> <span class="n">trsw_rx_gain</span><span class="p">;</span>	<span class="cm">/* TRSW RX gain in hdB */</span>
	<span class="n">s16</span> <span class="n">lna_lod_gain</span><span class="p">;</span>	<span class="cm">/* LNA lod */</span>
	<span class="n">s16</span> <span class="n">lna_gain</span><span class="p">;</span>		<span class="cm">/* LNA */</span>
	<span class="n">s16</span> <span class="n">pga_gain</span><span class="p">;</span>		<span class="cm">/* PGA */</span>

	<span class="cm">/* Desired TX power level (in dBm). This is set by the user and</span>
<span class="cm">	 * adjusted in b43legacy_phy_xmitpower(). */</span>
	<span class="n">u8</span> <span class="n">power_level</span><span class="p">;</span>

	<span class="cm">/* Values from b43legacy_calc_loopback_gain() */</span>
	<span class="n">u16</span> <span class="n">loopback_gain</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* TX Power control values. */</span>
	<span class="cm">/* B/G PHY */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/* Current Radio Attenuation for TXpower recalculation. */</span>
		<span class="n">u16</span> <span class="n">rfatt</span><span class="p">;</span>
		<span class="cm">/* Current Baseband Attenuation for TXpower recalculation. */</span>
		<span class="n">u16</span> <span class="n">bbatt</span><span class="p">;</span>
		<span class="cm">/* Current TXpower control value for TXpower recalculation. */</span>
		<span class="n">u16</span> <span class="n">txctl1</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">txctl2</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="cm">/* A PHY */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">txpwr_offset</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="cm">/* Current Interference Mitigation mode */</span>
	<span class="kt">int</span> <span class="n">interfmode</span><span class="p">;</span>
	<span class="cm">/* Stack of saved values from the Interference Mitigation code.</span>
<span class="cm">	 * Each value in the stack is laid out as follows:</span>
<span class="cm">	 * bit 0-11:  offset</span>
<span class="cm">	 * bit 12-15: register ID</span>
<span class="cm">	 * bit 16-32: value</span>
<span class="cm">	 * register ID is: 0x1 PHY, 0x2 Radio, 0x3 ILT</span>
<span class="cm">	 */</span>
<span class="cp">#define B43legacy_INTERFSTACK_SIZE	26</span>
	<span class="n">u32</span> <span class="n">interfstack</span><span class="p">[</span><span class="n">B43legacy_INTERFSTACK_SIZE</span><span class="p">];</span>

	<span class="cm">/* Saved values from the NRSSI Slope calculation */</span>
	<span class="n">s16</span> <span class="n">nrssi</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">s32</span> <span class="n">nrssislope</span><span class="p">;</span>
	<span class="cm">/* In memory nrssi lookup table. */</span>
	<span class="n">s8</span> <span class="n">nrssi_lt</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="cm">/* current channel */</span>
	<span class="n">u8</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">lofcal</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">initval</span><span class="p">;</span>

	<span class="cm">/* PHY TX errors counter. */</span>
	<span class="n">atomic_t</span> <span class="n">txerr_cnt</span><span class="p">;</span>

<span class="cp">#if B43legacy_DEBUG</span>
	<span class="cm">/* Manual TX-power control enabled? */</span>
	<span class="n">bool</span> <span class="n">manual_txpower_control</span><span class="p">;</span>
	<span class="cm">/* PHY registers locked by b43legacy_phy_lock()? */</span>
	<span class="n">bool</span> <span class="n">phy_locked</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* B43legacy_DEBUG */</span><span class="cp"></span>
<span class="p">};</span>

<span class="cm">/* Data structures for DMA transmission, per 80211 core. */</span>
<span class="k">struct</span> <span class="n">b43legacy_dma</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring3</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring4</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">tx_ring5</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">rx_ring0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_dmaring</span> <span class="o">*</span><span class="n">rx_ring3</span><span class="p">;</span> <span class="cm">/* only on core.rev &lt; 5 */</span>

	<span class="n">u32</span> <span class="n">translation</span><span class="p">;</span> <span class="cm">/* Routing bits */</span>
<span class="p">};</span>

<span class="cm">/* Data structures for PIO transmission, per 80211 core. */</span>
<span class="k">struct</span> <span class="n">b43legacy_pio</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">b43legacy_pioqueue</span> <span class="o">*</span><span class="n">queue0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_pioqueue</span> <span class="o">*</span><span class="n">queue1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_pioqueue</span> <span class="o">*</span><span class="n">queue2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_pioqueue</span> <span class="o">*</span><span class="n">queue3</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Context information for a noise calculation (Link Quality). */</span>
<span class="k">struct</span> <span class="n">b43legacy_noise_calculation</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">channel_at_start</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">calculation_running</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nr_samples</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">samples</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43legacy_stats</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">link_noise</span><span class="p">;</span>
	<span class="cm">/* Store the last TX/RX times here for updating the leds. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_tx</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_rx</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">b43legacy_key</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">keyconf</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">enabled</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">algorithm</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define B43legacy_QOS_QUEUE_NUM	4</span>

<span class="k">struct</span> <span class="n">b43legacy_wldev</span><span class="p">;</span>

<span class="cm">/* QOS parameters for a queue. */</span>
<span class="k">struct</span> <span class="n">b43legacy_qos_params</span> <span class="p">{</span>
	<span class="cm">/* The QOS parameters */</span>
	<span class="k">struct</span> <span class="n">ieee80211_tx_queue_params</span> <span class="n">p</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Data structure for the WLAN parts (802.11 cores) of the b43legacy chip. */</span>
<span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="p">{</span>
	<span class="cm">/* Pointer to the active wireless device on this chip */</span>
	<span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">current_dev</span><span class="p">;</span>
	<span class="cm">/* Pointer to the ieee80211 hardware data structure */</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">irq_lock</span><span class="p">;</span>		<span class="cm">/* locks IRQ */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>		<span class="cm">/* locks wireless core state */</span>
	<span class="n">spinlock_t</span> <span class="n">leds_lock</span><span class="p">;</span>		<span class="cm">/* lock for leds */</span>

	<span class="cm">/* firmware loading work */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">firmware_load</span><span class="p">;</span>

	<span class="cm">/* We can only have one operating interface (802.11 core)</span>
<span class="cm">	 * at a time. General information about this interface follows.</span>
<span class="cm">	 */</span>

	<span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">vif</span><span class="p">;</span>
	<span class="cm">/* MAC address (can be NULL). */</span>
	<span class="n">u8</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="cm">/* Current BSSID (can be NULL). */</span>
	<span class="n">u8</span> <span class="n">bssid</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="cm">/* Interface type. (IEEE80211_IF_TYPE_XXX) */</span>
	<span class="kt">int</span> <span class="n">if_type</span><span class="p">;</span>
	<span class="cm">/* Is the card operating in AP, STA or IBSS mode? */</span>
	<span class="n">bool</span> <span class="n">operating</span><span class="p">;</span>
	<span class="cm">/* filter flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">filter_flags</span><span class="p">;</span>
	<span class="cm">/* Stats about the wireless interface */</span>
	<span class="k">struct</span> <span class="n">ieee80211_low_level_stats</span> <span class="n">ieee_stats</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_B43LEGACY_HWRNG</span>
	<span class="k">struct</span> <span class="n">hwrng</span> <span class="n">rng</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rng_initialized</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">rng_name</span><span class="p">[</span><span class="mi">30</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="cp">#endif</span>

	<span class="cm">/* List of all wireless devices on this chip */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">devlist</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nr_devs</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">radiotap_enabled</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">radio_enabled</span><span class="p">;</span>

	<span class="cm">/* The beacon we are currently using (AP or IBSS mode).</span>
<span class="cm">	 * This beacon stuff is protected by the irq_lock. */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">current_beacon</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon0_uploaded</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon1_uploaded</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">beacon_templates_virgin</span><span class="p">;</span> <span class="cm">/* Never wrote the templates? */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">beacon_update_trigger</span><span class="p">;</span>
	<span class="cm">/* The current QOS parameters for the 4 queues. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_qos_params</span> <span class="n">qos_params</span><span class="p">[</span><span class="n">B43legacy_QOS_QUEUE_NUM</span><span class="p">];</span>

	<span class="cm">/* Packet transmit work */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tx_work</span><span class="p">;</span>

	<span class="cm">/* Queue of packets to be transmitted. */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">tx_queue</span><span class="p">[</span><span class="n">B43legacy_QOS_QUEUE_NUM</span><span class="p">];</span>

	<span class="cm">/* Flag that implement the queues stopping. */</span>
	<span class="n">bool</span> <span class="n">tx_queue_stopped</span><span class="p">[</span><span class="n">B43legacy_QOS_QUEUE_NUM</span><span class="p">];</span>

<span class="p">};</span>

<span class="cm">/* Pointers to the firmware data and meta information about it. */</span>
<span class="k">struct</span> <span class="n">b43legacy_firmware</span> <span class="p">{</span>
	<span class="cm">/* Microcode */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">ucode</span><span class="p">;</span>
	<span class="cm">/* PCM code */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">pcm</span><span class="p">;</span>
	<span class="cm">/* Initial MMIO values for the firmware */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">initvals</span><span class="p">;</span>
	<span class="cm">/* Initial MMIO values for the firmware, band-specific */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">initvals_band</span><span class="p">;</span>
	<span class="cm">/* Firmware revision */</span>
	<span class="n">u16</span> <span class="n">rev</span><span class="p">;</span>
	<span class="cm">/* Firmware patchlevel */</span>
	<span class="n">u16</span> <span class="n">patch</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Device (802.11 core) initialization status. */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">B43legacy_STAT_UNINIT</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* Uninitialized. */</span>
	<span class="n">B43legacy_STAT_INITIALIZED</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* Initialized, not yet started. */</span>
	<span class="n">B43legacy_STAT_STARTED</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="cm">/* Up and running. */</span>
<span class="p">};</span>
<span class="cp">#define b43legacy_status(wldev)	atomic_read(&amp;(wldev)-&gt;__init_status)</span>
<span class="cp">#define b43legacy_set_status(wldev, stat)	do {		\</span>
<span class="cp">		atomic_set(&amp;(wldev)-&gt;__init_status, (stat));	\</span>
<span class="cp">		smp_wmb();					\</span>
<span class="cp">					} while (0)</span>

<span class="cm">/* *** ---   HOW LOCKING WORKS IN B43legacy   --- ***</span>
<span class="cm"> *</span>
<span class="cm"> * You should always acquire both, wl-&gt;mutex and wl-&gt;irq_lock unless:</span>
<span class="cm"> * - You don&#39;t need to acquire wl-&gt;irq_lock, if the interface is stopped.</span>
<span class="cm"> * - You don&#39;t need to acquire wl-&gt;mutex in the IRQ handler, IRQ tasklet</span>
<span class="cm"> *   and packet TX path (and _ONLY_ there.)</span>
<span class="cm"> */</span>

<span class="cm">/* Data structure for one wireless device (802.11 core) */</span>
<span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">;</span>

	<span class="cm">/* The device initialization status.</span>
<span class="cm">	 * Use b43legacy_status() to query. */</span>
	<span class="n">atomic_t</span> <span class="n">__init_status</span><span class="p">;</span>
	<span class="cm">/* Saved init status for handling suspend. */</span>
	<span class="kt">int</span> <span class="n">suspend_init_status</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">__using_pio</span><span class="p">;</span>	<span class="cm">/* Using pio rather than dma. */</span>
	<span class="n">bool</span> <span class="n">bad_frames_preempt</span><span class="p">;</span><span class="cm">/* Use &quot;Bad Frames Preemption&quot;. */</span>
	<span class="n">bool</span> <span class="n">dfq_valid</span><span class="p">;</span>		<span class="cm">/* Directed frame queue valid (IBSS PS mode, ATIM). */</span>
	<span class="n">bool</span> <span class="n">short_preamble</span><span class="p">;</span>	<span class="cm">/* TRUE if using short preamble. */</span>
	<span class="n">bool</span> <span class="n">radio_hw_enable</span><span class="p">;</span>	<span class="cm">/* State of radio hardware enable bit. */</span>

	<span class="cm">/* PHY/Radio device. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_phy</span> <span class="n">phy</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="cm">/* DMA engines. */</span>
		<span class="k">struct</span> <span class="n">b43legacy_dma</span> <span class="n">dma</span><span class="p">;</span>
		<span class="cm">/* PIO engines. */</span>
		<span class="k">struct</span> <span class="n">b43legacy_pio</span> <span class="n">pio</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="cm">/* Various statistics about the physical device. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_stats</span> <span class="n">stats</span><span class="p">;</span>

	<span class="cm">/* The device LEDs. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_led</span> <span class="n">led_tx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_led</span> <span class="n">led_rx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_led</span> <span class="n">led_assoc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_led</span> <span class="n">led_radio</span><span class="p">;</span>

	<span class="cm">/* Reason code of the last interrupt. */</span>
	<span class="n">u32</span> <span class="n">irq_reason</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dma_reason</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="cm">/* The currently active generic-interrupt mask. */</span>
	<span class="n">u32</span> <span class="n">irq_mask</span><span class="p">;</span>
	<span class="cm">/* Link Quality calculation context. */</span>
	<span class="k">struct</span> <span class="n">b43legacy_noise_calculation</span> <span class="n">noisecalc</span><span class="p">;</span>
	<span class="cm">/* if &gt; 0 MAC is suspended. if == 0 MAC is enabled. */</span>
	<span class="kt">int</span> <span class="n">mac_suspended</span><span class="p">;</span>

	<span class="cm">/* Interrupt Service Routine tasklet (bottom-half) */</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">isr_tasklet</span><span class="p">;</span>

	<span class="cm">/* Periodic tasks */</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">periodic_work</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">periodic_state</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">restart_work</span><span class="p">;</span>

	<span class="cm">/* encryption/decryption */</span>
	<span class="n">u16</span> <span class="n">ktp</span><span class="p">;</span> <span class="cm">/* Key table pointer */</span>
	<span class="n">u8</span> <span class="n">max_nr_keys</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">b43legacy_key</span> <span class="n">key</span><span class="p">[</span><span class="mi">58</span><span class="p">];</span>

	<span class="cm">/* Firmware data */</span>
	<span class="k">struct</span> <span class="n">b43legacy_firmware</span> <span class="n">fw</span><span class="p">;</span>

	<span class="cm">/* Devicelist in struct b43legacy_wl (all 802.11 cores) */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* Debugging stuff follows. */</span>
<span class="cp">#ifdef CONFIG_B43LEGACY_DEBUG</span>
	<span class="k">struct</span> <span class="n">b43legacy_dfsentry</span> <span class="o">*</span><span class="n">dfsentry</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kr">inline</span>
<span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="nf">hw_to_b43legacy_wl</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Helper function, which returns a boolean.</span>
<span class="cm"> * TRUE, if PIO is used; FALSE, if DMA is used.</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_B43LEGACY_DMA) &amp;&amp; defined(CONFIG_B43LEGACY_PIO)</span>
<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">b43legacy_using_pio</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">__using_pio</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#elif defined(CONFIG_B43LEGACY_DMA)</span>
<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">b43legacy_using_pio</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#elif defined(CONFIG_B43LEGACY_PIO)</span>
<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">b43legacy_using_pio</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp"># error &quot;Using neither DMA nor PIO? Confused...&quot;</span>
<span class="cp">#endif</span>


<span class="k">static</span> <span class="kr">inline</span>
<span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="nf">dev_to_b43legacy_wldev</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">ssb_dev</span> <span class="o">=</span> <span class="n">dev_to_ssb_dev</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ssb_get_drvdata</span><span class="p">(</span><span class="n">ssb_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Is the device operating in a specified mode (IEEE80211_IF_TYPE_XXX). */</span>
<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">b43legacy_is_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">operating</span> <span class="o">&amp;&amp;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">if_type</span> <span class="o">==</span> <span class="n">type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="n">bool</span> <span class="nf">is_bcm_board_vendor</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span>  <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">boardinfo</span><span class="p">.</span><span class="n">vendor</span> <span class="o">==</span> <span class="n">PCI_VENDOR_ID_BROADCOM</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="n">u16</span> <span class="nf">b43legacy_read16</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ssb_read16</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">b43legacy_write16</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ssb_write16</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="n">u32</span> <span class="nf">b43legacy_read32</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ssb_read32</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">b43legacy_write32</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wldev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ssb_write32</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="k">struct</span> <span class="n">b43legacy_lopair</span> <span class="o">*</span><span class="nf">b43legacy_get_lopair</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span>
					      <span class="n">u16</span> <span class="n">radio_attenuation</span><span class="p">,</span>
					      <span class="n">u16</span> <span class="n">baseband_attenuation</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">phy</span><span class="o">-&gt;</span><span class="n">_lo_pairs</span> <span class="o">+</span> <span class="p">(</span><span class="n">radio_attenuation</span>
			<span class="o">+</span> <span class="mi">14</span> <span class="o">*</span> <span class="p">(</span><span class="n">baseband_attenuation</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>



<span class="cm">/* Message printing */</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">b43legacyinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">b43legacyerr</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">b43legacywarn</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="cp">#if B43legacy_DEBUG</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">b43legacydbg</span><span class="p">(</span><span class="k">struct</span> <span class="n">b43legacy_wl</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="cp">#else </span><span class="cm">/* DEBUG */</span><span class="cp"></span>
<span class="cp"># define b43legacydbg(wl, fmt...) do { </span><span class="cm">/* nothing */</span><span class="cp"> } while (0)</span>
<span class="cp">#endif </span><span class="cm">/* DEBUG */</span><span class="cp"></span>

<span class="cm">/* Macros for printing a value in Q5.2 format */</span>
<span class="cp">#define Q52_FMT		&quot;%u.%u&quot;</span>
<span class="cp">#define Q52_ARG(q52)	((q52) / 4), (((q52) &amp; 3) * 100 / 4)</span>

<span class="cp">#endif </span><span class="cm">/* B43legacy_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
