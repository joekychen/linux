<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › rtlwifi › rtl8192se › sw.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>sw.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2009-2012  Realtek Corporation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * wlanfae &lt;wlanfae@realtek.com&gt;</span>
<span class="cm"> * Realtek Corporation, No. 2, Innovation Road II, Hsinchu Science Park,</span>
<span class="cm"> * Hsinchu 300, Taiwan.</span>
<span class="cm"> *</span>
<span class="cm"> * Larry Finger &lt;Larry.Finger@lwfinger.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************************/</span>

<span class="cp">#include &quot;../wifi.h&quot;</span>
<span class="cp">#include &quot;../core.h&quot;</span>
<span class="cp">#include &quot;../pci.h&quot;</span>
<span class="cp">#include &quot;../base.h&quot;</span>
<span class="cp">#include &quot;../pci.h&quot;</span>
<span class="cp">#include &quot;reg.h&quot;</span>
<span class="cp">#include &quot;def.h&quot;</span>
<span class="cp">#include &quot;phy.h&quot;</span>
<span class="cp">#include &quot;dm.h&quot;</span>
<span class="cp">#include &quot;fw.h&quot;</span>
<span class="cp">#include &quot;hw.h&quot;</span>
<span class="cp">#include &quot;sw.h&quot;</span>
<span class="cp">#include &quot;trx.h&quot;</span>
<span class="cp">#include &quot;led.h&quot;</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl92s_init_aspm_vars</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_pci</span> <span class="o">*</span><span class="n">rtlpci</span> <span class="o">=</span> <span class="n">rtl_pcidev</span><span class="p">(</span><span class="n">rtl_pcipriv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>

	<span class="cm">/*close ASPM for AMD defaultly */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_amdpci_aspm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * ASPM PS mode.</span>
<span class="cm">	 * 0 - Disable ASPM,</span>
<span class="cm">	 * 1 - Enable ASPM without Clock Req,</span>
<span class="cm">	 * 2 - Enable ASPM with Clock Req,</span>
<span class="cm">	 * 3 - Alwyas Enable ASPM with Clock Req,</span>
<span class="cm">	 * 4 - Always Enable ASPM without Clock Req.</span>
<span class="cm">	 * set defult to RTL8192CE:3 RTL8192E:2</span>
<span class="cm">	 * */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_pci_aspm</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="cm">/*Setting for PCI-E device */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_devicepci_aspm_setting</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>

	<span class="cm">/*Setting for PCI-E bridge */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_hostpci_aspm_setting</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * In Hw/Sw Radio Off situation.</span>
<span class="cm">	 * 0 - Default,</span>
<span class="cm">	 * 1 - From ASPM setting without low Mac Pwr,</span>
<span class="cm">	 * 2 - From ASPM setting with low Mac Pwr,</span>
<span class="cm">	 * 3 - Bus D3</span>
<span class="cm">	 * set default to RTL8192CE:0 RTL8192SE:2</span>
<span class="cm">	 */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_hwsw_rfoff_d3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * This setting works for those device with</span>
<span class="cm">	 * backdoor ASPM setting such as EPHY setting.</span>
<span class="cm">	 * 0 - Not support ASPM,</span>
<span class="cm">	 * 1 - Support ASPM,</span>
<span class="cm">	 * 2 - According to chipset.</span>
<span class="cm">	 */</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">const_support_pciaspm</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl92se_fw_cb</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">firmware</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl_pci_priv</span> <span class="o">*</span><span class="n">pcipriv</span> <span class="o">=</span> <span class="n">rtl_pcipriv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_pci</span> <span class="o">*</span><span class="n">rtlpci</span> <span class="o">=</span> <span class="n">rtl_pcidev</span><span class="p">(</span><span class="n">pcipriv</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rt_firmware</span> <span class="o">*</span><span class="n">pfirmware</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
			 <span class="s">&quot;Firmware callback routine entered!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">complete</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">firmware_loading_complete</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">firmware</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Firmware %s not available</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">fw_name</span><span class="p">);</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">max_fw_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">firmware</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">max_fw_size</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
			 <span class="s">&quot;Firmware is too big!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">max_fw_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">release_firmware</span><span class="p">(</span><span class="n">firmware</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pfirmware</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rt_firmware</span> <span class="o">*</span><span class="p">)</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">pfirmware</span><span class="o">-&gt;</span><span class="n">sz_fw_tmpbuffer</span><span class="p">,</span> <span class="n">firmware</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
	<span class="n">pfirmware</span><span class="o">-&gt;</span><span class="n">sz_fw_tmpbufferlen</span> <span class="o">=</span> <span class="n">firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
	<span class="n">release_firmware</span><span class="p">(</span><span class="n">firmware</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">ieee80211_register_hw</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
			 <span class="s">&quot;Can&#39;t register mac80211 hw</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">mac80211</span><span class="p">.</span><span class="n">mac80211_registered</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">irq_alloc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">set_bit</span><span class="p">(</span><span class="n">RTL_STATUS_INTERFACE_START</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">);</span>

	<span class="cm">/*init rfkill */</span>
	<span class="n">rtl_init_rfkill</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rtl92s_init_sw_vars</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_pci</span> <span class="o">*</span><span class="n">rtlpci</span> <span class="o">=</span> <span class="n">rtl_pcidev</span><span class="p">(</span><span class="n">rtl_pcipriv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">earlyrxthreshold</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>

	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dm</span><span class="p">.</span><span class="n">dm_initialgain_enable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dm</span><span class="p">.</span><span class="n">dm_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dm</span><span class="p">.</span><span class="n">disable_framebursting</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dm</span><span class="p">.</span><span class="n">thermalvalue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dm</span><span class="p">.</span><span class="n">useramask</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="cm">/* compatible 5G band 91se just 2.4G band &amp; smsp */</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">current_bandtype</span> <span class="o">=</span> <span class="n">BAND_ON_2_4G</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">bandset</span> <span class="o">=</span> <span class="n">BAND_ON_2_4G</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">macphymode</span> <span class="o">=</span> <span class="n">SINGLEMAC_SINGLEPHY</span><span class="p">;</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">transmit_config</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">receive_config</span> <span class="o">=</span>
			<span class="n">RCR_APPFCS</span> <span class="o">|</span>
			<span class="n">RCR_APWRMGT</span> <span class="o">|</span>
			<span class="cm">/*RCR_ADD3 |*/</span>
			<span class="n">RCR_AMF</span>	<span class="o">|</span>
			<span class="n">RCR_ADF</span> <span class="o">|</span>
			<span class="n">RCR_APP_MIC</span> <span class="o">|</span>
			<span class="n">RCR_APP_ICV</span> <span class="o">|</span>
			<span class="n">RCR_AICV</span> <span class="o">|</span>
			<span class="cm">/* Accept ICV error, CRC32 Error */</span>
			<span class="n">RCR_ACRC32</span> <span class="o">|</span>
			<span class="n">RCR_AB</span> <span class="o">|</span>
			<span class="cm">/* Accept Broadcast, Multicast */</span>
			<span class="n">RCR_AM</span>	<span class="o">|</span>
			<span class="cm">/* Accept Physical match */</span>
			<span class="n">RCR_APM</span> <span class="o">|</span>
			<span class="cm">/* Accept Destination Address packets */</span>
			<span class="cm">/*RCR_AAP |*/</span>
			<span class="n">RCR_APP_PHYST_STAFF</span> <span class="o">|</span>
			<span class="cm">/* Accept PHY status */</span>
			<span class="n">RCR_APP_PHYST_RXFF</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">earlyrxthreshold</span> <span class="o">&lt;&lt;</span> <span class="n">RCR_FIFO_OFFSET</span><span class="p">);</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span>
			<span class="p">(</span><span class="n">IMR_ROK</span> <span class="o">|</span>
			<span class="n">IMR_VODOK</span> <span class="o">|</span>
			<span class="n">IMR_VIDOK</span> <span class="o">|</span>
			<span class="n">IMR_BEDOK</span> <span class="o">|</span>
			<span class="n">IMR_BKDOK</span> <span class="o">|</span>
			<span class="n">IMR_HCCADOK</span> <span class="o">|</span>
			<span class="n">IMR_MGNTDOK</span> <span class="o">|</span>
			<span class="n">IMR_COMDOK</span> <span class="o">|</span>
			<span class="n">IMR_HIGHDOK</span> <span class="o">|</span>
			<span class="n">IMR_BDOK</span> <span class="o">|</span>
			<span class="n">IMR_RXCMDOK</span> <span class="o">|</span>
			<span class="cm">/*IMR_TIMEOUT0 |*/</span>
			<span class="n">IMR_RDU</span> <span class="o">|</span>
			<span class="n">IMR_RXFOVW</span>	<span class="o">|</span>
			<span class="n">IMR_BCNINT</span>
			<span class="cm">/*| IMR_TXFOVW*/</span>
			<span class="cm">/*| IMR_TBDOK |</span>
<span class="cm">			IMR_TBDER*/</span><span class="p">);</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">irq_mask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">shortretry_limit</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">longretry_limit</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>

	<span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">first_init</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="cm">/* for debug level */</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">dbg</span><span class="p">.</span><span class="n">global_debuglevel</span> <span class="o">=</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mod_params</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">;</span>
	<span class="cm">/* for LPS &amp; IPS */</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">inactiveps</span> <span class="o">=</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mod_params</span><span class="o">-&gt;</span><span class="n">inactiveps</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">swctrl_lps</span> <span class="o">=</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mod_params</span><span class="o">-&gt;</span><span class="n">swctrl_lps</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">fwctrl_lps</span> <span class="o">=</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mod_params</span><span class="o">-&gt;</span><span class="n">fwctrl_lps</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">inactiveps</span><span class="p">)</span>
		<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;Power Save off (module option)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">fwctrl_lps</span><span class="p">)</span>
		<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;FW Power Save off (module option)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">reg_fwctrl_lps</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">reg_max_lps_awakeintvl</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="cm">/* for ASPM, you can close aspm through</span>
<span class="cm">	 * set const_support_pciaspm = 0 */</span>
	<span class="n">rtl92s_init_aspm_vars</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">reg_fwctrl_lps</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">fwctrl_psmode</span> <span class="o">=</span> <span class="n">FW_PS_MIN_MODE</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">reg_fwctrl_lps</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">fwctrl_psmode</span> <span class="o">=</span> <span class="n">FW_PS_MAX_MODE</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">reg_fwctrl_lps</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">psc</span><span class="p">.</span><span class="n">fwctrl_psmode</span> <span class="o">=</span> <span class="n">FW_PS_DTIM_MODE</span><span class="p">;</span>

	<span class="cm">/* for firmware buf */</span>
	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span> <span class="o">=</span> <span class="n">vzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rt_firmware</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">max_fw_size</span> <span class="o">=</span> <span class="n">RTL8190_MAX_RAW_FIRMWARE_CODE_SIZE</span><span class="p">;</span>

	<span class="n">pr_info</span><span class="p">(</span><span class="s">&quot;Driver for Realtek RTL8192SE/RTL8191SE</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;Loading firmware %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">fw_name</span><span class="p">);</span>
	<span class="cm">/* request fw */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">request_firmware_nowait</span><span class="p">(</span><span class="n">THIS_MODULE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">fw_name</span><span class="p">,</span>
				      <span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">,</span> <span class="n">hw</span><span class="p">,</span>
				      <span class="n">rtl92se_fw_cb</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
			 <span class="s">&quot;Failed to request firmware!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl92s_deinit_sw_vars</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">vfree</span><span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span><span class="p">);</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">rtlhal</span><span class="p">.</span><span class="n">pfirmware</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rtl_hal_ops</span> <span class="n">rtl8192se_hal_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">init_sw_vars</span> <span class="o">=</span> <span class="n">rtl92s_init_sw_vars</span><span class="p">,</span>
	<span class="p">.</span><span class="n">deinit_sw_vars</span> <span class="o">=</span> <span class="n">rtl92s_deinit_sw_vars</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_eeprom_info</span> <span class="o">=</span> <span class="n">rtl92se_read_eeprom_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">interrupt_recognized</span> <span class="o">=</span> <span class="n">rtl92se_interrupt_recognized</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_init</span> <span class="o">=</span> <span class="n">rtl92se_hw_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_disable</span> <span class="o">=</span> <span class="n">rtl92se_card_disable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_suspend</span> <span class="o">=</span> <span class="n">rtl92se_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_resume</span> <span class="o">=</span> <span class="n">rtl92se_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_interrupt</span> <span class="o">=</span> <span class="n">rtl92se_enable_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_interrupt</span> <span class="o">=</span> <span class="n">rtl92se_disable_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_network_type</span> <span class="o">=</span> <span class="n">rtl92se_set_network_type</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_chk_bssid</span> <span class="o">=</span> <span class="n">rtl92se_set_check_bssid</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_qos</span> <span class="o">=</span> <span class="n">rtl92se_set_qos</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bcn_reg</span> <span class="o">=</span> <span class="n">rtl92se_set_beacon_related_registers</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bcn_intv</span> <span class="o">=</span> <span class="n">rtl92se_set_beacon_interval</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_interrupt_mask</span> <span class="o">=</span> <span class="n">rtl92se_update_interrupt_mask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_hw_reg</span> <span class="o">=</span> <span class="n">rtl92se_get_hw_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_hw_reg</span> <span class="o">=</span> <span class="n">rtl92se_set_hw_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_rate_tbl</span> <span class="o">=</span> <span class="n">rtl92se_update_hal_rate_tbl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fill_tx_desc</span> <span class="o">=</span> <span class="n">rtl92se_tx_fill_desc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fill_tx_cmddesc</span> <span class="o">=</span> <span class="n">rtl92se_tx_fill_cmddesc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">query_rx_desc</span> <span class="o">=</span> <span class="n">rtl92se_rx_query_desc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_channel_access</span> <span class="o">=</span> <span class="n">rtl92se_update_channel_access_setting</span><span class="p">,</span>
	<span class="p">.</span><span class="n">radio_onoff_checking</span> <span class="o">=</span> <span class="n">rtl92se_gpio_radio_on_off_checking</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bw_mode</span> <span class="o">=</span> <span class="n">rtl92s_phy_set_bw_mode</span><span class="p">,</span>
	<span class="p">.</span><span class="n">switch_channel</span> <span class="o">=</span> <span class="n">rtl92s_phy_sw_chnl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dm_watchdog</span> <span class="o">=</span> <span class="n">rtl92s_dm_watchdog</span><span class="p">,</span>
	<span class="p">.</span><span class="n">scan_operation_backup</span> <span class="o">=</span> <span class="n">rtl92s_phy_scan_operation_backup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rf_power_state</span> <span class="o">=</span> <span class="n">rtl92s_phy_set_rf_power_state</span><span class="p">,</span>
	<span class="p">.</span><span class="n">led_control</span> <span class="o">=</span> <span class="n">rtl92se_led_control</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_desc</span> <span class="o">=</span> <span class="n">rtl92se_set_desc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_desc</span> <span class="o">=</span> <span class="n">rtl92se_get_desc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tx_polling</span> <span class="o">=</span> <span class="n">rtl92se_tx_polling</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_hw_sec</span> <span class="o">=</span> <span class="n">rtl92se_enable_hw_security_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_key</span> <span class="o">=</span> <span class="n">rtl92se_set_key</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_sw_leds</span> <span class="o">=</span> <span class="n">rtl92se_init_sw_leds</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_bbreg</span> <span class="o">=</span> <span class="n">rtl92s_phy_query_bb_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bbreg</span> <span class="o">=</span> <span class="n">rtl92s_phy_set_bb_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_rfreg</span> <span class="o">=</span> <span class="n">rtl92s_phy_query_rf_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rfreg</span> <span class="o">=</span> <span class="n">rtl92s_phy_set_rf_reg</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rtl_mod_params</span> <span class="n">rtl92se_mod_params</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sw_crypto</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inactiveps</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">swctrl_lps</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fwctrl_lps</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
	<span class="p">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Because memory R/W bursting will cause system hang/crash</span>
<span class="cm"> * for 92se, so we don&#39;t read back after every write action */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">rtl_hal_cfg</span> <span class="n">rtl92se_hal_cfg</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">bar_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write_readback</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;rtl92s_pci&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fw_name</span> <span class="o">=</span> <span class="s">&quot;rtlwifi/rtl8192sefw.bin&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtl8192se_hal_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mod_params</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtl92se_mod_params</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SYS_ISO_CTRL</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_SYS_ISO_CTRL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SYS_FUNC_EN</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_SYS_FUNC_EN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SYS_CLK</span><span class="p">]</span> <span class="o">=</span> <span class="n">SYS_CLKR</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">MAC_RCR_AM</span><span class="p">]</span> <span class="o">=</span> <span class="n">RCR_AM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">MAC_RCR_AB</span><span class="p">]</span> <span class="o">=</span> <span class="n">RCR_AB</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">MAC_RCR_ACRC32</span><span class="p">]</span> <span class="o">=</span> <span class="n">RCR_ACRC32</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">MAC_RCR_ACF</span><span class="p">]</span> <span class="o">=</span> <span class="n">RCR_ACF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">MAC_RCR_AAP</span><span class="p">]</span> <span class="o">=</span> <span class="n">RCR_AAP</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_TEST</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_EFUSE_TEST</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_CTRL</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_EFUSE_CTRL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_CLK</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_EFUSE_CLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_CLK_CTRL</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_EFUSE_CTRL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_PWC_EV12V</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* nouse for 8192se */</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_FEN_ELDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* nouse for 8192se */</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_LOADER_CLK_EN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* nouse for 8192se */</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_ANA8M</span><span class="p">]</span> <span class="o">=</span> <span class="n">EFUSE_ANA8M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_HWSET_MAX_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="n">HWSET_MAX_SIZE_92S</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_MAX_SECTION_MAP</span><span class="p">]</span> <span class="o">=</span> <span class="n">EFUSE_MAX_SECTION</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_REAL_CONTENT_SIZE</span><span class="p">]</span> <span class="o">=</span> <span class="n">EFUSE_REAL_CONTENT_LEN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">EFUSE_OOB_PROTECT_BYTES_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="n">EFUSE_OOB_PROTECT_BYTES</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RWCAM</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_RWCAM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">WCAMI</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_WCAMI</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RCAMO</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_RCAMO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">CAMDBG</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_CAMDBG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SECR</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_SECR</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SEC_CAM_NONE</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAM_NONE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SEC_CAM_WEP40</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAM_WEP40</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SEC_CAM_TKIP</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAM_TKIP</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SEC_CAM_AES</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAM_AES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">SEC_CAM_WEP104</span><span class="p">]</span> <span class="o">=</span> <span class="n">CAM_WEP104</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT6</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT5</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT4</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT3</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT2</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDMAINT1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDMAINT1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK8</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK7</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK6</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK5</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK4</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK3</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK2</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BCNDOK1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNDOK1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_TIMEOUT2</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_TIMEOUT2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_TIMEOUT1</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_TIMEOUT1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_TXFOVW</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_TXFOVW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_PSTIMEOUT</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_PSTIMEOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BcnInt</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BCNINT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_RXFOVW</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_RXFOVW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_RDU</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_RDU</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_ATIMEND</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_ATIMEND</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_MGNTDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_MGNTDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_TBDER</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_TBDER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_HIGHDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_HIGHDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_COMDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_COMDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_TBDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_TBDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BKDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BKDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_BEDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_BEDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_VIDOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_VIDOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_VODOK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_VODOK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IMR_ROK</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMR_ROK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_IBSS_INT_MASKS</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">IMR_BCNINT</span> <span class="o">|</span> <span class="n">IMR_TBDOK</span> <span class="o">|</span> <span class="n">IMR_TBDER</span><span class="p">),</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_CCK_RATE1M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE1M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_CCK_RATE2M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE2M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_CCK_RATE5_5M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE5_5M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_CCK_RATE11M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE11M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE6M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE6M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE9M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE9M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE12M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE12M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE18M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE18M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE24M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE24M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE36M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE36M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE48M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE48M</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_OFDM_RATE54M</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATE54M</span><span class="p">,</span>

	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_HT_RATEMCS7</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATEMCS7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">maps</span><span class="p">[</span><span class="n">RTL_RC_HT_RATEMCS15</span><span class="p">]</span> <span class="o">=</span> <span class="n">DESC92_RATEMCS15</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pci_device_id</span> <span class="n">rtl92se_pci_ids</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">RTL_PCI_DEVICE</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_REALTEK</span><span class="p">,</span> <span class="mh">0x8192</span><span class="p">,</span> <span class="n">rtl92se_hal_cfg</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">RTL_PCI_DEVICE</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_REALTEK</span><span class="p">,</span> <span class="mh">0x8171</span><span class="p">,</span> <span class="n">rtl92se_hal_cfg</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">RTL_PCI_DEVICE</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_REALTEK</span><span class="p">,</span> <span class="mh">0x8172</span><span class="p">,</span> <span class="n">rtl92se_hal_cfg</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">RTL_PCI_DEVICE</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_REALTEK</span><span class="p">,</span> <span class="mh">0x8173</span><span class="p">,</span> <span class="n">rtl92se_hal_cfg</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">RTL_PCI_DEVICE</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_REALTEK</span><span class="p">,</span> <span class="mh">0x8174</span><span class="p">,</span> <span class="n">rtl92se_hal_cfg</span><span class="p">)},</span>
	<span class="p">{},</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">pci</span><span class="p">,</span> <span class="n">rtl92se_pci_ids</span><span class="p">);</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;lizhaoming	&lt;chaoming_li@realsil.com.cn&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Realtek WlanFAE	&lt;wlanfae@realtek.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Larry Finger	&lt;Larry.Finger@lwfinger.net&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Realtek 8192S/8191S 802.11n PCI wireless&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="s">&quot;rtlwifi/rtl8192sefw.bin&quot;</span><span class="p">);</span>

<span class="n">module_param_named</span><span class="p">(</span><span class="n">swenc</span><span class="p">,</span> <span class="n">rtl92se_mod_params</span><span class="p">.</span><span class="n">sw_crypto</span><span class="p">,</span> <span class="n">bool</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">rtl92se_mod_params</span><span class="p">.</span><span class="n">debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">ips</span><span class="p">,</span> <span class="n">rtl92se_mod_params</span><span class="p">.</span><span class="n">inactiveps</span><span class="p">,</span> <span class="n">bool</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">swlps</span><span class="p">,</span> <span class="n">rtl92se_mod_params</span><span class="p">.</span><span class="n">swctrl_lps</span><span class="p">,</span> <span class="n">bool</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">fwlps</span><span class="p">,</span> <span class="n">rtl92se_mod_params</span><span class="p">.</span><span class="n">fwctrl_lps</span><span class="p">,</span> <span class="n">bool</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">swenc</span><span class="p">,</span> <span class="s">&quot;Set to 1 for software crypto (default 0)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">ips</span><span class="p">,</span> <span class="s">&quot;Set to 0 to not use link power save (default 1)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">swlps</span><span class="p">,</span> <span class="s">&quot;Set to 1 to use SW control power save (default 0)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">fwlps</span><span class="p">,</span> <span class="s">&quot;Set to 1 to use FW control power save (default 1)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;Set debug level (0-5) (default 0)&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dev_pm_ops</span> <span class="n">rtlwifi_pm_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">rtl_pci_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span> <span class="o">=</span> <span class="n">rtl_pci_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freeze</span> <span class="o">=</span> <span class="n">rtl_pci_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">thaw</span> <span class="o">=</span> <span class="n">rtl_pci_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">poweroff</span> <span class="o">=</span> <span class="n">rtl_pci_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">restore</span> <span class="o">=</span> <span class="n">rtl_pci_resume</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pci_driver</span> <span class="n">rtl92se_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">KBUILD_MODNAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">rtl92se_pci_ids</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">rtl_pci_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">rtl_pci_disconnect</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">pm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtlwifi_pm_ops</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_pci_driver</span><span class="p">(</span><span class="n">rtl92se_driver</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
