<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › rtlwifi › rtl8192c › fw_common.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>fw_common.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2009-2012  Realtek Corporation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin Street, Fifth Floor, Boston, MA 02110, USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution in the</span>
<span class="cm"> * file called LICENSE.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> * wlanfae &lt;wlanfae@realtek.com&gt;</span>
<span class="cm"> * Realtek Corporation, No. 2, Innovation Road II, Hsinchu Science Park,</span>
<span class="cm"> * Hsinchu 300, Taiwan.</span>
<span class="cm"> *</span>
<span class="cm"> * Larry Finger &lt;Larry.Finger@lwfinger.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *****************************************************************************/</span>

<span class="cp">#include &quot;../wifi.h&quot;</span>
<span class="cp">#include &quot;../pci.h&quot;</span>
<span class="cp">#include &quot;../base.h&quot;</span>
<span class="cp">#include &quot;../rtl8192ce/reg.h&quot;</span>
<span class="cp">#include &quot;../rtl8192ce/def.h&quot;</span>
<span class="cp">#include &quot;fw_common.h&quot;</span>
<span class="cp">#include &lt;linux/export.h&gt;</span>
<span class="cp">#include &lt;linux/kmemleak.h&gt;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_enable_fw_download</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_hal</span> <span class="o">*</span><span class="n">rtlhal</span> <span class="o">=</span> <span class="n">rtl_hal</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">hw_type</span> <span class="o">==</span> <span class="n">HARDWARE_TYPE_RTL8192CU</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">value32</span> <span class="o">=</span> <span class="n">rtl_read_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span>
			<span class="n">value32</span> <span class="o">|=</span> <span class="n">MCUFWDL_EN</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">value32</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">MCUFWDL_EN</span><span class="p">;</span>
		<span class="n">rtl_write_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">,</span> <span class="n">value32</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">hw_type</span> <span class="o">==</span> <span class="n">HARDWARE_TYPE_RTL8192CE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_SYS_FUNC_EN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_SYS_FUNC_EN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
				       <span class="n">tmp</span> <span class="o">|</span> <span class="mh">0x04</span><span class="p">);</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
			<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">);</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="mh">0xf7</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

			<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
			<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">,</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="mh">0xfe</span><span class="p">);</span>

			<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl_block_fw_writeN</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">blockSize</span> <span class="o">=</span> <span class="n">REALTEK_USB_VENQT_MAX_BUF_SIZE</span> <span class="o">-</span> <span class="mi">20</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">bufferPtr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">blockCount</span><span class="p">,</span> <span class="n">remainSize</span><span class="p">;</span>

	<span class="n">blockCount</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="n">blockSize</span><span class="p">;</span>
	<span class="n">remainSize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">%</span> <span class="n">blockSize</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">blockCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">blockSize</span><span class="p">;</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">.</span><span class="n">writeN_sync</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span>
					<span class="p">(</span><span class="n">FW_8192C_START_ADDRESS</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					<span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">bufferPtr</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					<span class="n">blockSize</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">remainSize</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="n">blockCount</span> <span class="o">*</span> <span class="n">blockSize</span><span class="p">;</span>
		<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">.</span><span class="n">writeN_sync</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span>
					<span class="p">(</span><span class="n">FW_8192C_START_ADDRESS</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					<span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">bufferPtr</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					<span class="n">remainSize</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_fw_block_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
				   <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">blockSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">);</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">bufferPtr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">pu4BytePtr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">blockCount</span><span class="p">,</span> <span class="n">remainSize</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">.</span><span class="n">writeN_sync</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl_block_fw_writeN</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">blockCount</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="n">blockSize</span><span class="p">;</span>
	<span class="n">remainSize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">%</span> <span class="n">blockSize</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">remainSize</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* the last word is &lt; 4 bytes - pad it with zeros */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">remainSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="o">*</span><span class="p">(</span><span class="n">bufferPtr</span> <span class="o">+</span> <span class="n">size</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">blockCount</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">blockCount</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">blockSize</span><span class="p">;</span>
		<span class="cm">/* for big-endian platforms, the firmware data need to be byte</span>
<span class="cm">		 * swapped as it was read as a byte string and will be written</span>
<span class="cm">		 * as 32-bit dwords and byte swapped when written</span>
<span class="cm">		 */</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">__le32</span> <span class="o">*</span><span class="p">)(</span><span class="n">pu4BytePtr</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
		<span class="n">rtl_write_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="p">(</span><span class="n">FW_8192C_START_ADDRESS</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
				<span class="n">data</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_fw_page_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
				  <span class="n">u32</span> <span class="n">page</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">value8</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">u8page</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">page</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>

	<span class="n">value8</span> <span class="o">=</span> <span class="p">(</span><span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF8</span><span class="p">)</span> <span class="o">|</span> <span class="n">u8page</span><span class="p">;</span>

	<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="p">(</span><span class="n">REG_MCUFWDL</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="n">value8</span><span class="p">);</span>
	<span class="n">_rtl92c_fw_block_write</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_fill_dummy</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">pfwbuf</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">pfwlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">fwlen</span> <span class="o">=</span> <span class="o">*</span><span class="n">pfwlen</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">remain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">fwlen</span> <span class="o">%</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">remain</span> <span class="o">=</span> <span class="p">(</span><span class="n">remain</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="p">(</span><span class="mi">4</span> <span class="o">-</span> <span class="n">remain</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">remain</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pfwbuf</span><span class="p">[</span><span class="n">fwlen</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">fwlen</span><span class="o">++</span><span class="p">;</span>
		<span class="n">remain</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="o">*</span><span class="n">pfwlen</span> <span class="o">=</span> <span class="n">fwlen</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_write_fw</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
			     <span class="k">enum</span> <span class="n">version_8192c</span> <span class="n">version</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_hal</span> <span class="o">*</span><span class="n">rtlhal</span> <span class="o">=</span> <span class="n">rtl_hal</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">bufferPtr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">buffer</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_FW</span><span class="p">,</span> <span class="n">DBG_TRACE</span><span class="p">,</span> <span class="s">&quot;FW size is %d bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_CHIP_VER_B</span><span class="p">(</span><span class="n">version</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">pageNums</span><span class="p">,</span> <span class="n">remainSize</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">page</span><span class="p">,</span> <span class="n">offset</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">IS_HARDWARE_TYPE_8192CE</span><span class="p">(</span><span class="n">rtlhal</span><span class="p">))</span>
			<span class="n">_rtl92c_fill_dummy</span><span class="p">(</span><span class="n">bufferPtr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>

		<span class="n">pageNums</span> <span class="o">=</span> <span class="n">size</span> <span class="o">/</span> <span class="n">FW_8192C_PAGE_SIZE</span><span class="p">;</span>
		<span class="n">remainSize</span> <span class="o">=</span> <span class="n">size</span> <span class="o">%</span> <span class="n">FW_8192C_PAGE_SIZE</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pageNums</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
				 <span class="s">&quot;Page numbers should not greater then 4</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">page</span> <span class="o">&lt;</span> <span class="n">pageNums</span><span class="p">;</span> <span class="n">page</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">offset</span> <span class="o">=</span> <span class="n">page</span> <span class="o">*</span> <span class="n">FW_8192C_PAGE_SIZE</span><span class="p">;</span>
			<span class="n">_rtl92c_fw_page_write</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="p">(</span><span class="n">bufferPtr</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					      <span class="n">FW_8192C_PAGE_SIZE</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">remainSize</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">offset</span> <span class="o">=</span> <span class="n">pageNums</span> <span class="o">*</span> <span class="n">FW_8192C_PAGE_SIZE</span><span class="p">;</span>
			<span class="n">page</span> <span class="o">=</span> <span class="n">pageNums</span><span class="p">;</span>
			<span class="n">_rtl92c_fw_page_write</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="p">(</span><span class="n">bufferPtr</span> <span class="o">+</span> <span class="n">offset</span><span class="p">),</span>
					      <span class="n">remainSize</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">_rtl92c_fw_block_write</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">_rtl92c_fw_free_to_go</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">value32</span><span class="p">;</span>

	<span class="k">do</span> <span class="p">{</span>
		<span class="n">value32</span> <span class="o">=</span> <span class="n">rtl_read_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">counter</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">FW_8192C_POLLING_TIMEOUT_COUNT</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		 <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">value32</span> <span class="o">&amp;</span> <span class="n">FWDL_ChkSum_rpt</span><span class="p">)));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="o">&gt;=</span> <span class="n">FW_8192C_POLLING_TIMEOUT_COUNT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
			 <span class="s">&quot;chksum report faill ! REG_MCUFWDL:0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value32</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_FW</span><span class="p">,</span> <span class="n">DBG_TRACE</span><span class="p">,</span>
		 <span class="s">&quot;Checksum report OK ! REG_MCUFWDL:0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value32</span><span class="p">);</span>

	<span class="n">value32</span> <span class="o">=</span> <span class="n">rtl_read_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
	<span class="n">value32</span> <span class="o">|=</span> <span class="n">MCUFWDL_RDY</span><span class="p">;</span>
	<span class="n">value32</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">WINTINI_RDY</span><span class="p">;</span>
	<span class="n">rtl_write_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">,</span> <span class="n">value32</span><span class="p">);</span>

	<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">do</span> <span class="p">{</span>
		<span class="n">value32</span> <span class="o">=</span> <span class="n">rtl_read_dword</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_MCUFWDL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">value32</span> <span class="o">&amp;</span> <span class="n">WINTINI_RDY</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_FW</span><span class="p">,</span> <span class="n">DBG_TRACE</span><span class="p">,</span>
				 <span class="s">&quot;Polling FW ready success!! REG_MCUFWDL:0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">value32</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">mdelay</span><span class="p">(</span><span class="n">FW_8192C_POLLING_DELAY</span><span class="p">);</span>

	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">counter</span><span class="o">++</span> <span class="o">&lt;</span> <span class="n">FW_8192C_POLLING_TIMEOUT_COUNT</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
		 <span class="s">&quot;Polling FW ready fail!! REG_MCUFWDL:0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value32</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">rtl92c_download_fw</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_hal</span> <span class="o">*</span><span class="n">rtlhal</span> <span class="o">=</span> <span class="n">rtl_hal</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="k">struct</span> <span class="n">rtl92c_firmware_header</span> <span class="o">*</span><span class="n">pfwheader</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">pfwdata</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fwsize</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">version_8192c</span> <span class="n">version</span> <span class="o">=</span> <span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">max_fw_size</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">pfirmware</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pfwheader</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">rtl92c_firmware_header</span> <span class="o">*</span><span class="p">)</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">pfirmware</span><span class="p">;</span>
	<span class="n">pfwdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">pfirmware</span><span class="p">;</span>
	<span class="n">fwsize</span> <span class="o">=</span> <span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">fwsize</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">IS_FW_HEADER_EXIST</span><span class="p">(</span><span class="n">pfwheader</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_FW</span><span class="p">,</span> <span class="n">DBG_DMESG</span><span class="p">,</span>
			 <span class="s">&quot;Firmware Version(%d), Signature(%#x),Size(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">pfwheader</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">),</span>
			 <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">pfwheader</span><span class="o">-&gt;</span><span class="n">signature</span><span class="p">),</span>
			 <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl92c_firmware_header</span><span class="p">));</span>

		<span class="n">pfwdata</span> <span class="o">=</span> <span class="n">pfwdata</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl92c_firmware_header</span><span class="p">);</span>
		<span class="n">fwsize</span> <span class="o">=</span> <span class="n">fwsize</span> <span class="o">-</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl92c_firmware_header</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">_rtl92c_enable_fw_download</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">_rtl92c_write_fw</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">pfwdata</span><span class="p">,</span> <span class="n">fwsize</span><span class="p">);</span>
	<span class="n">_rtl92c_enable_fw_download</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">_rtl92c_fw_free_to_go</span><span class="p">(</span><span class="n">hw</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
			 <span class="s">&quot;Firmware is not ready to run!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_FW</span><span class="p">,</span> <span class="n">DBG_TRACE</span><span class="p">,</span>
			 <span class="s">&quot;Firmware is ready to run!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_download_fw</span><span class="p">);</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">_rtl92c_check_fw_read_last_h2c</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">boxnum</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">val_hmetfr</span><span class="p">,</span> <span class="n">val_mcutst_1</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">val_hmetfr</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_HMETFR</span><span class="p">);</span>
	<span class="n">val_mcutst_1</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="p">(</span><span class="n">REG_MCUTST_1</span> <span class="o">+</span> <span class="n">boxnum</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(((</span><span class="n">val_hmetfr</span> <span class="o">&gt;&gt;</span> <span class="n">boxnum</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">val_mcutst_1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">result</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_rtl92c_fill_h2c_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
			      <span class="n">u8</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cmd_len</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">p_cmdbuffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_hal</span> <span class="o">*</span><span class="n">rtlhal</span> <span class="o">=</span> <span class="n">rtl_hal</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="n">u8</span> <span class="n">boxnum</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">box_reg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">box_extreg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">u1b_tmp</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">isfw_read</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">bwrite_sucess</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wait_h2c_limmit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wait_writeh2c_limmit</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">boxcontent</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">boxextcontent</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">h2c_waitcounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flag</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">idx</span><span class="p">;</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span> <span class="s">&quot;come in</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">h2c_setinprogress</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
				 <span class="s">&quot;H2C set in progress! Wait to set..element_id(%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">element_id</span><span class="p">);</span>

			<span class="k">while</span> <span class="p">(</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">h2c_setinprogress</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span>
						       <span class="n">flag</span><span class="p">);</span>
				<span class="n">h2c_waitcounter</span><span class="o">++</span><span class="p">;</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
					 <span class="s">&quot;Wait 100 us (%d times)...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					 <span class="n">h2c_waitcounter</span><span class="p">);</span>
				<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">h2c_waitcounter</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span>
					<span class="k">return</span><span class="p">;</span>
				<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span>
						  <span class="n">flag</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">h2c_setinprogress</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">bwrite_sucess</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wait_writeh2c_limmit</span><span class="o">--</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wait_writeh2c_limmit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
				 <span class="s">&quot;Write H2C fail because no trigger for FW INT!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">boxnum</span> <span class="o">=</span> <span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">last_hmeboxnum</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">boxnum</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">box_reg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_0</span><span class="p">;</span>
			<span class="n">box_extreg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_EXT_0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">box_reg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_1</span><span class="p">;</span>
			<span class="n">box_extreg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_EXT_1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">box_reg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_2</span><span class="p">;</span>
			<span class="n">box_extreg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_EXT_2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">box_reg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_3</span><span class="p">;</span>
			<span class="n">box_extreg</span> <span class="o">=</span> <span class="n">REG_HMEBOX_EXT_3</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
				 <span class="s">&quot;switch case not processed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">isfw_read</span> <span class="o">=</span> <span class="n">_rtl92c_check_fw_read_last_h2c</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">boxnum</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isfw_read</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">wait_h2c_limmit</span><span class="o">--</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">wait_h2c_limmit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
					 <span class="s">&quot;Waiting too long for FW read clear HMEBox(%d)!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					 <span class="n">boxnum</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

			<span class="n">isfw_read</span> <span class="o">=</span> <span class="n">_rtl92c_check_fw_read_last_h2c</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">boxnum</span><span class="p">);</span>
			<span class="n">u1b_tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="mh">0x1BF</span><span class="p">);</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
				 <span class="s">&quot;Waiting for FW read clear HMEBox(%d)!!! 0x1BF = %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">boxnum</span><span class="p">,</span> <span class="n">u1b_tmp</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isfw_read</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
				 <span class="s">&quot;Write H2C register BOX[%d] fail!!!!! Fw do not read</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">boxnum</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">memset</span><span class="p">(</span><span class="n">boxcontent</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">boxcontent</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">boxextcontent</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">boxextcontent</span><span class="p">));</span>
		<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">element_id</span><span class="p">;</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
			 <span class="s">&quot;Write element_id box_reg(%4x) = %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">box_reg</span><span class="p">,</span> <span class="n">element_id</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">cmd_len</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxcontent</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
			       <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_reg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxcontent</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
			       <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_reg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxcontent</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
			       <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_reg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxextcontent</span><span class="p">),</span>
			       <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxcontent</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
			       <span class="n">p_cmdbuffer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_extreg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxextcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_reg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="n">boxcontent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">));</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxextcontent</span><span class="p">),</span>
			       <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">boxcontent</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
			       <span class="n">p_cmdbuffer</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_extreg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxextcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">box_reg</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span>
					       <span class="n">boxcontent</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_EMERG</span><span class="p">,</span>
				 <span class="s">&quot;switch case not processed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">bwrite_sucess</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

		<span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">last_hmeboxnum</span> <span class="o">=</span> <span class="n">boxnum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">last_hmeboxnum</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
			<span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">last_hmeboxnum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
			 <span class="s">&quot;pHalData-&gt;last_hmeboxnum  = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">last_hmeboxnum</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
	<span class="n">rtlhal</span><span class="o">-&gt;</span><span class="n">h2c_setinprogress</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">h2c_lock</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span> <span class="s">&quot;go out</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">rtl92c_fill_h2c_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
			 <span class="n">u8</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">u32</span> <span class="n">cmd_len</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">p_cmdbuffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp_cmdbuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">tmp_cmdbuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">tmp_cmdbuf</span><span class="p">,</span> <span class="n">p_cmdbuffer</span><span class="p">,</span> <span class="n">cmd_len</span><span class="p">);</span>
	<span class="n">_rtl92c_fill_h2c_command</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">element_id</span><span class="p">,</span> <span class="n">cmd_len</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">tmp_cmdbuf</span><span class="p">);</span>

	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_fill_h2c_cmd</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rtl92c_firmware_selfreset</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">u1b_tmp</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">delay</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>

	<span class="n">rtl_write_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_HMETFR</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">u1b_tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_SYS_FUNC_EN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">u1b_tmp</span> <span class="o">&amp;</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">delay</span><span class="o">--</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">delay</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">RT_ASSERT</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span> <span class="s">&quot;8051 reset fail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
		<span class="n">u1b_tmp</span> <span class="o">=</span> <span class="n">rtl_read_byte</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">REG_SYS_FUNC_EN</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_firmware_selfreset</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rtl92c_set_fw_pwrmode_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">u1_h2c_set_pwrmode</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">rtl_ps_ctl</span> <span class="o">*</span><span class="n">ppsc</span> <span class="o">=</span> <span class="n">rtl_psc</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>

	<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_POWER</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span> <span class="s">&quot;FW LPS mode = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>

	<span class="n">SET_H2CCMD_PWRMODE_PARM_MODE</span><span class="p">(</span><span class="n">u1_h2c_set_pwrmode</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="n">SET_H2CCMD_PWRMODE_PARM_SMART_PS</span><span class="p">(</span><span class="n">u1_h2c_set_pwrmode</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">SET_H2CCMD_PWRMODE_PARM_BCN_PASS_TIME</span><span class="p">(</span><span class="n">u1_h2c_set_pwrmode</span><span class="p">,</span>
					      <span class="n">ppsc</span><span class="o">-&gt;</span><span class="n">reg_max_lps_awakeintvl</span><span class="p">);</span>

	<span class="n">RT_PRINT_DATA</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_DMESG</span><span class="p">,</span>
		      <span class="s">&quot;rtl92c_set_fw_rsvdpagepkt(): u1_h2c_set_pwrmode&quot;</span><span class="p">,</span>
		      <span class="n">u1_h2c_set_pwrmode</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">rtl92c_fill_h2c_cmd</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">H2C_SETPWRMODE</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">u1_h2c_set_pwrmode</span><span class="p">);</span>

<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_set_fw_pwrmode_cmd</span><span class="p">);</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">_rtl92c_cmd_send_packet</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_pci</span> <span class="o">*</span><span class="n">rtlpci</span> <span class="o">=</span> <span class="n">rtl_pcidev</span><span class="p">(</span><span class="n">rtl_pcipriv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="k">struct</span> <span class="n">rtl8192_tx_ring</span> <span class="o">*</span><span class="n">ring</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl_tx_desc</span> <span class="o">*</span><span class="n">pdesc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">pskb</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">ring</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtlpci</span><span class="o">-&gt;</span><span class="n">tx_ring</span><span class="p">[</span><span class="n">BEACON_QUEUE</span><span class="p">];</span>

	<span class="n">pskb</span> <span class="o">=</span> <span class="n">__skb_dequeue</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pskb</span><span class="p">)</span>
		<span class="n">kfree_skb</span><span class="p">(</span><span class="n">pskb</span><span class="p">);</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">irq_th_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">pdesc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">fill_tx_cmddesc</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">pdesc</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>

	<span class="n">__skb_queue_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ring</span><span class="o">-&gt;</span><span class="n">queue</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>

	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">locks</span><span class="p">.</span><span class="n">irq_th_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">rtlpriv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">tx_polling</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">BEACON_QUEUE</span><span class="p">);</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define BEACON_PG		0 </span><span class="cm">/*-&gt;1*/</span><span class="cp"></span>
<span class="cp">#define PSPOLL_PG		2</span>
<span class="cp">#define NULL_PG			3</span>
<span class="cp">#define PROBERSP_PG		4 </span><span class="cm">/*-&gt;5*/</span><span class="cp"></span>

<span class="cp">#define TOTAL_RESERVED_PKT_LEN	768</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">reserved_page_packet</span><span class="p">[</span><span class="n">TOTAL_RESERVED_PKT_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* page 0 beacon */</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span>
	<span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span>
	<span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span>
	<span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span>
	<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span>
	<span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>

	<span class="cm">/* page 1 beacon */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>

	<span class="cm">/* page 2  ps-poll */</span>
	<span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>

	<span class="cm">/* page 3  null */</span>
	<span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>

	<span class="cm">/* page 4  probe_resp */</span>
	<span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xF2</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x69</span><span class="p">,</span>
	<span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span>
	<span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span>
	<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x2A</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span>
	<span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x4C</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>

	<span class="cm">/* page 5  probe_resp */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">rtl92c_set_fw_rsvdpagepkt</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">bool</span> <span class="n">dl_finished</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl_priv</span> <span class="o">*</span><span class="n">rtlpriv</span> <span class="o">=</span> <span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rtl_mac</span> <span class="o">*</span><span class="n">mac</span> <span class="o">=</span> <span class="n">rtl_mac</span><span class="p">(</span><span class="n">rtl_priv</span><span class="p">(</span><span class="n">hw</span><span class="p">));</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">totalpacketlen</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">rtstatus</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">u1RsvdPageLoc</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="n">bool</span> <span class="n">dlok</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">beacon</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">pspoll</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">nullfunc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">probersp</span><span class="p">;</span>
	<span class="cm">/*---------------------------------------------------------</span>
<span class="cm">				(1) beacon</span>
<span class="cm">	---------------------------------------------------------*/</span>
	<span class="n">beacon</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">[</span><span class="n">BEACON_PG</span> <span class="o">*</span> <span class="mi">128</span><span class="p">];</span>
	<span class="n">SET_80211_HDR_ADDRESS2</span><span class="p">(</span><span class="n">beacon</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">);</span>
	<span class="n">SET_80211_HDR_ADDRESS3</span><span class="p">(</span><span class="n">beacon</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>

	<span class="cm">/*-------------------------------------------------------</span>
<span class="cm">				(2) ps-poll</span>
<span class="cm">	--------------------------------------------------------*/</span>
	<span class="n">pspoll</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">[</span><span class="n">PSPOLL_PG</span> <span class="o">*</span> <span class="mi">128</span><span class="p">];</span>
	<span class="n">SET_80211_PS_POLL_AID</span><span class="p">(</span><span class="n">pspoll</span><span class="p">,</span> <span class="p">(</span><span class="n">mac</span><span class="o">-&gt;</span><span class="n">assoc_id</span> <span class="o">|</span> <span class="mh">0xc000</span><span class="p">));</span>
	<span class="n">SET_80211_PS_POLL_BSSID</span><span class="p">(</span><span class="n">pspoll</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
	<span class="n">SET_80211_PS_POLL_TA</span><span class="p">(</span><span class="n">pspoll</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">);</span>

	<span class="n">SET_H2CCMD_RSVDPAGE_LOC_PSPOLL</span><span class="p">(</span><span class="n">u1RsvdPageLoc</span><span class="p">,</span> <span class="n">PSPOLL_PG</span><span class="p">);</span>

	<span class="cm">/*--------------------------------------------------------</span>
<span class="cm">				(3) null data</span>
<span class="cm">	---------------------------------------------------------*/</span>
	<span class="n">nullfunc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">[</span><span class="n">NULL_PG</span> <span class="o">*</span> <span class="mi">128</span><span class="p">];</span>
	<span class="n">SET_80211_HDR_ADDRESS1</span><span class="p">(</span><span class="n">nullfunc</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
	<span class="n">SET_80211_HDR_ADDRESS2</span><span class="p">(</span><span class="n">nullfunc</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">);</span>
	<span class="n">SET_80211_HDR_ADDRESS3</span><span class="p">(</span><span class="n">nullfunc</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>

	<span class="n">SET_H2CCMD_RSVDPAGE_LOC_NULL_DATA</span><span class="p">(</span><span class="n">u1RsvdPageLoc</span><span class="p">,</span> <span class="n">NULL_PG</span><span class="p">);</span>

	<span class="cm">/*---------------------------------------------------------</span>
<span class="cm">				(4) probe response</span>
<span class="cm">	----------------------------------------------------------*/</span>
	<span class="n">probersp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">[</span><span class="n">PROBERSP_PG</span> <span class="o">*</span> <span class="mi">128</span><span class="p">];</span>
	<span class="n">SET_80211_HDR_ADDRESS1</span><span class="p">(</span><span class="n">probersp</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>
	<span class="n">SET_80211_HDR_ADDRESS2</span><span class="p">(</span><span class="n">probersp</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">mac_addr</span><span class="p">);</span>
	<span class="n">SET_80211_HDR_ADDRESS3</span><span class="p">(</span><span class="n">probersp</span><span class="p">,</span> <span class="n">mac</span><span class="o">-&gt;</span><span class="n">bssid</span><span class="p">);</span>

	<span class="n">SET_H2CCMD_RSVDPAGE_LOC_PROBE_RSP</span><span class="p">(</span><span class="n">u1RsvdPageLoc</span><span class="p">,</span> <span class="n">PROBERSP_PG</span><span class="p">);</span>

	<span class="n">totalpacketlen</span> <span class="o">=</span> <span class="n">TOTAL_RESERVED_PKT_LEN</span><span class="p">;</span>

	<span class="n">RT_PRINT_DATA</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
		      <span class="s">&quot;rtl92c_set_fw_rsvdpagepkt(): HW_VAR_SET_TX_CMD: ALL&quot;</span><span class="p">,</span>
		      <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">totalpacketlen</span><span class="p">);</span>
	<span class="n">RT_PRINT_DATA</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_DMESG</span><span class="p">,</span>
		      <span class="s">&quot;rtl92c_set_fw_rsvdpagepkt(): HW_VAR_SET_TX_CMD: ALL&quot;</span><span class="p">,</span>
		      <span class="n">u1RsvdPageLoc</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>


	<span class="n">skb</span> <span class="o">=</span> <span class="n">dev_alloc_skb</span><span class="p">(</span><span class="n">totalpacketlen</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">skb</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">kmemleak_not_leak</span><span class="p">(</span><span class="n">skb</span><span class="p">);</span>

	<span class="n">memcpy</span><span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">skb_put</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">totalpacketlen</span><span class="p">),</span>
	       <span class="o">&amp;</span><span class="n">reserved_page_packet</span><span class="p">,</span> <span class="n">totalpacketlen</span><span class="p">);</span>

	<span class="n">rtstatus</span> <span class="o">=</span> <span class="n">_rtl92c_cmd_send_packet</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rtstatus</span><span class="p">)</span>
		<span class="n">dlok</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dlok</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_POWER</span><span class="p">,</span> <span class="n">DBG_LOUD</span><span class="p">,</span>
			 <span class="s">&quot;Set RSVD page location to Fw</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">RT_PRINT_DATA</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_CMD</span><span class="p">,</span> <span class="n">DBG_DMESG</span><span class="p">,</span>
			      <span class="s">&quot;H2C_RSVDPAGE&quot;</span><span class="p">,</span> <span class="n">u1RsvdPageLoc</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">rtl92c_fill_h2c_cmd</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">H2C_RSVDPAGE</span><span class="p">,</span>
				    <span class="k">sizeof</span><span class="p">(</span><span class="n">u1RsvdPageLoc</span><span class="p">),</span> <span class="n">u1RsvdPageLoc</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">RT_TRACE</span><span class="p">(</span><span class="n">rtlpriv</span><span class="p">,</span> <span class="n">COMP_ERR</span><span class="p">,</span> <span class="n">DBG_WARNING</span><span class="p">,</span>
			 <span class="s">&quot;Set RSVD page location to Fw FAIL!!!!!!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_set_fw_rsvdpagepkt</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">rtl92c_set_fw_joinbss_report_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mstatus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">u1_joinbssrpt_parm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

	<span class="n">SET_H2CCMD_JOINBSSRPT_PARM_OPMODE</span><span class="p">(</span><span class="n">u1_joinbssrpt_parm</span><span class="p">,</span> <span class="n">mstatus</span><span class="p">);</span>

	<span class="n">rtl92c_fill_h2c_cmd</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="n">H2C_JOINBSSRPT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">u1_joinbssrpt_parm</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">rtl92c_set_fw_joinbss_report_cmd</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
