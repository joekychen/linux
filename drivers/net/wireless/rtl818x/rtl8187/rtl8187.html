<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › rtl818x › rtl8187 › rtl8187.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>rtl8187.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Definitions for RTL8187 hardware</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2007 Michael Wu &lt;flamingice@sourmilk.net&gt;</span>
<span class="cm"> * Copyright 2007 Andrea Merello &lt;andreamrl@tiscali.it&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the r8187 driver, which is:</span>
<span class="cm"> * Copyright 2005 Andrea Merello &lt;andreamrl@tiscali.it&gt;, et al.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef RTL8187_H</span>
<span class="cp">#define RTL8187_H</span>

<span class="cp">#include &quot;rtl818x.h&quot;</span>
<span class="cp">#include &quot;leds.h&quot;</span>

<span class="cp">#define RTL8187_EEPROM_TXPWR_BASE	0x05</span>
<span class="cp">#define RTL8187_EEPROM_MAC_ADDR		0x07</span>
<span class="cp">#define RTL8187_EEPROM_TXPWR_CHAN_1	0x16	</span><span class="cm">/* 3 channels */</span><span class="cp"></span>
<span class="cp">#define RTL8187_EEPROM_TXPWR_CHAN_6	0x1B	</span><span class="cm">/* 2 channels */</span><span class="cp"></span>
<span class="cp">#define RTL8187_EEPROM_TXPWR_CHAN_4	0x3D	</span><span class="cm">/* 2 channels */</span><span class="cp"></span>
<span class="cp">#define RTL8187_EEPROM_SELECT_GPIO	0x3B</span>

<span class="cp">#define RTL8187_REQT_READ	0xC0</span>
<span class="cp">#define RTL8187_REQT_WRITE	0x40</span>
<span class="cp">#define RTL8187_REQ_GET_REG	0x05</span>
<span class="cp">#define RTL8187_REQ_SET_REG	0x05</span>

<span class="cp">#define RTL8187_MAX_RX		0x9C4</span>

<span class="cp">#define RFKILL_MASK_8187_89_97	0x2</span>
<span class="cp">#define RFKILL_MASK_8198	0x4</span>

<span class="cp">#define RETRY_COUNT		7</span>

<span class="k">struct</span> <span class="n">rtl8187_rx_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span><span class="n">urb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rtl8187_rx_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">noise</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">signal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">agc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">mac_time</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rtl8187b_rx_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__le64</span> <span class="n">mac_time</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sq</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rssi</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">agc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags2</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">snr_long2end</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">pwdb_g12</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fot</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* {rtl8187,rtl8187b}_tx_info is in skb */</span>

<span class="k">struct</span> <span class="n">rtl8187_tx_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">rts_duration</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">retry</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rtl8187b_tx_hdr</span> <span class="p">{</span>
	<span class="n">__le32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">rts_duration</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">unused_1</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">unused_2</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">tx_duration</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">unused_3</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">retry</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">unused_4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">DEVICE_RTL8187</span><span class="p">,</span>
	<span class="n">DEVICE_RTL8187B</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rtl8187_vif</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="cm">/* beaconing */</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">beacon_work</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">enable_beacon</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="p">{</span>
	<span class="cm">/* common between rtl818x drivers */</span>
	<span class="k">struct</span> <span class="n">rtl818x_csr</span> <span class="o">*</span><span class="n">map</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rtl818x_rf_ops</span> <span class="o">*</span><span class="n">rf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">vif</span><span class="p">;</span>

	<span class="cm">/* The mutex protects the TX loopback state.</span>
<span class="cm">	 * Any attempt to set channels concurrently locks the device.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">conf_mutex</span><span class="p">;</span>

	<span class="cm">/* rtl8187 specific */</span>
	<span class="k">struct</span> <span class="n">ieee80211_channel</span> <span class="n">channels</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ieee80211_rate</span> <span class="n">rates</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ieee80211_supported_band</span> <span class="n">band</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">udev</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_conf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_anchor</span> <span class="n">anchored</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_RTL8187_LEDS</span>
	<span class="k">struct</span> <span class="n">rtl8187_led</span> <span class="n">led_radio</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl8187_led</span> <span class="n">led_tx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl8187_led</span> <span class="n">led_rx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">led_on</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">led_off</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">u16</span> <span class="n">txpwr_base</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">asic_rev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">is_rtl8187b</span><span class="p">;</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">RTL8187BvB</span><span class="p">,</span>
		<span class="n">RTL8187BvD</span><span class="p">,</span>
		<span class="n">RTL8187BvE</span>
	<span class="p">}</span> <span class="n">hw_rev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">rx_queue</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">signal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">noise</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">slot_time</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">aifsn</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">rfkill_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">__le64</span> <span class="n">buf</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">queue</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">b_tx_status</span><span class="p">;</span> <span class="cm">/* This queue is used by both -b and non-b devices */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">io_mutex</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">bits8</span><span class="p">;</span>
		<span class="n">__le16</span> <span class="n">bits16</span><span class="p">;</span>
		<span class="n">__le32</span> <span class="n">bits32</span><span class="p">;</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">io_dmabuf</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">rfkill_off</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">seqno</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">rtl8187_write_phy</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">data</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">rtl818x_ioread8_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				     <span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_GET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_READ</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits8</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits8</span><span class="p">;</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">rtl818x_ioread8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rtl818x_ioread8_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">rtl818x_ioread16_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				       <span class="n">__le16</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__le16</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_GET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_READ</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span><span class="p">;</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">rtl818x_ioread16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">__le16</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rtl818x_ioread16_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">rtl818x_ioread32_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
				       <span class="n">__le32</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__le32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_GET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_READ</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits32</span><span class="p">;</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">rtl818x_ioread32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">__le32</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rtl818x_ioread32_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite8_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					<span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits8</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_SET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_WRITE</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits8</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rtl818x_iowrite8_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite16_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					 <span class="n">__le16</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_SET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_WRITE</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">__le16</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
				     <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rtl818x_iowrite16_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite32_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					 <span class="n">__le32</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="n">u8</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits32</span> <span class="o">=</span> <span class="n">cpu_to_le32</span><span class="p">(</span><span class="n">val</span><span class="p">);</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_SET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_WRITE</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span><span class="p">,</span> <span class="n">idx</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits32</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rtl818x_iowrite32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">__le32</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rtl818x_iowrite32_idx</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* RTL8187_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
