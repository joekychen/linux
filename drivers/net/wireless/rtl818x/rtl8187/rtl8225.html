<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › rtl818x › rtl8187 › rtl8225.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>rtl8225.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Radio tuning for RTL8225 on RTL8187</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2007 Michael Wu &lt;flamingice@sourmilk.net&gt;</span>
<span class="cm"> * Copyright 2007 Andrea Merello &lt;andreamrl@tiscali.it&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the r8187 driver, which is:</span>
<span class="cm"> * Copyright 2005 Andrea Merello &lt;andreamrl@tiscali.it&gt;, et al.</span>
<span class="cm"> *</span>
<span class="cm"> * Magic delays, register offsets, and phy value tables below are</span>
<span class="cm"> * taken from the original r8187 driver sources.  Thanks to Realtek</span>
<span class="cm"> * for their support!</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/usb.h&gt;</span>
<span class="cp">#include &lt;net/mac80211.h&gt;</span>

<span class="cp">#include &quot;rtl8187.h&quot;</span>
<span class="cp">#include &quot;rtl8225.h&quot;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_write_bitbang</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg80</span><span class="p">,</span> <span class="n">reg84</span><span class="p">,</span> <span class="n">reg82</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bangdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">bangdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>

	<span class="n">reg80</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfff3</span><span class="p">;</span>
	<span class="n">reg82</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">,</span> <span class="n">reg82</span> <span class="o">|</span> <span class="mh">0x7</span><span class="p">);</span>

	<span class="n">reg84</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span> <span class="o">|</span> <span class="mh">0x7</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="n">bangdata</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_write_8051</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">__le16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg80</span><span class="p">,</span> <span class="n">reg82</span><span class="p">,</span> <span class="n">reg84</span><span class="p">;</span>

	<span class="n">reg80</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">);</span>
	<span class="n">reg82</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">);</span>
	<span class="n">reg84</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">);</span>

	<span class="n">reg80</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">reg84</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0xF</span><span class="p">;</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">,</span> <span class="n">reg82</span> <span class="o">|</span> <span class="mh">0x0007</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span> <span class="o">|</span> <span class="mh">0x0007</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">usb_control_msg</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">RTL8187_REQ_SET_REG</span><span class="p">,</span> <span class="n">RTL8187_REQT_WRITE</span><span class="p">,</span>
			<span class="n">addr</span><span class="p">,</span> <span class="mh">0x8225</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_dmabuf</span><span class="o">-&gt;</span><span class="n">bits16</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
			<span class="n">HZ</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">io_mutex</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">asic_rev</span><span class="p">)</span>
		<span class="n">rtl8225_write_8051</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">data</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">rtl8225_write_bitbang</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">rtl8225_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg80</span><span class="p">,</span> <span class="n">reg82</span><span class="p">,</span> <span class="n">reg84</span><span class="p">,</span> <span class="n">out</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">reg80</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">);</span>
	<span class="n">reg82</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">);</span>
	<span class="n">reg84</span> <span class="o">=</span> <span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">);</span>

	<span class="n">reg80</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0xF</span><span class="p">;</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">,</span> <span class="n">reg82</span> <span class="o">|</span> <span class="mh">0x000F</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span> <span class="o">|</span> <span class="mh">0x000F</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg80</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">reg80</span> <span class="o">|</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
			  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
			  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
			  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

	<span class="n">out</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">rtl818x_ioread16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsInput</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">out</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>

		<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
				  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">));</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span>
			  <span class="n">reg80</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsEnable</span><span class="p">,</span> <span class="n">reg82</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsSelect</span><span class="p">,</span> <span class="n">reg84</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">RFPinsOutput</span><span class="p">,</span> <span class="mh">0x03A0</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">rtl8225bcd_rxgain</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x0400</span><span class="p">,</span> <span class="mh">0x0401</span><span class="p">,</span> <span class="mh">0x0402</span><span class="p">,</span> <span class="mh">0x0403</span><span class="p">,</span> <span class="mh">0x0404</span><span class="p">,</span> <span class="mh">0x0405</span><span class="p">,</span> <span class="mh">0x0408</span><span class="p">,</span> <span class="mh">0x0409</span><span class="p">,</span>
	<span class="mh">0x040a</span><span class="p">,</span> <span class="mh">0x040b</span><span class="p">,</span> <span class="mh">0x0502</span><span class="p">,</span> <span class="mh">0x0503</span><span class="p">,</span> <span class="mh">0x0504</span><span class="p">,</span> <span class="mh">0x0505</span><span class="p">,</span> <span class="mh">0x0540</span><span class="p">,</span> <span class="mh">0x0541</span><span class="p">,</span>
	<span class="mh">0x0542</span><span class="p">,</span> <span class="mh">0x0543</span><span class="p">,</span> <span class="mh">0x0544</span><span class="p">,</span> <span class="mh">0x0545</span><span class="p">,</span> <span class="mh">0x0580</span><span class="p">,</span> <span class="mh">0x0581</span><span class="p">,</span> <span class="mh">0x0582</span><span class="p">,</span> <span class="mh">0x0583</span><span class="p">,</span>
	<span class="mh">0x0584</span><span class="p">,</span> <span class="mh">0x0585</span><span class="p">,</span> <span class="mh">0x0588</span><span class="p">,</span> <span class="mh">0x0589</span><span class="p">,</span> <span class="mh">0x058a</span><span class="p">,</span> <span class="mh">0x058b</span><span class="p">,</span> <span class="mh">0x0643</span><span class="p">,</span> <span class="mh">0x0644</span><span class="p">,</span>
	<span class="mh">0x0645</span><span class="p">,</span> <span class="mh">0x0680</span><span class="p">,</span> <span class="mh">0x0681</span><span class="p">,</span> <span class="mh">0x0682</span><span class="p">,</span> <span class="mh">0x0683</span><span class="p">,</span> <span class="mh">0x0684</span><span class="p">,</span> <span class="mh">0x0685</span><span class="p">,</span> <span class="mh">0x0688</span><span class="p">,</span>
	<span class="mh">0x0689</span><span class="p">,</span> <span class="mh">0x068a</span><span class="p">,</span> <span class="mh">0x068b</span><span class="p">,</span> <span class="mh">0x068c</span><span class="p">,</span> <span class="mh">0x0742</span><span class="p">,</span> <span class="mh">0x0743</span><span class="p">,</span> <span class="mh">0x0744</span><span class="p">,</span> <span class="mh">0x0745</span><span class="p">,</span>
	<span class="mh">0x0780</span><span class="p">,</span> <span class="mh">0x0781</span><span class="p">,</span> <span class="mh">0x0782</span><span class="p">,</span> <span class="mh">0x0783</span><span class="p">,</span> <span class="mh">0x0784</span><span class="p">,</span> <span class="mh">0x0785</span><span class="p">,</span> <span class="mh">0x0788</span><span class="p">,</span> <span class="mh">0x0789</span><span class="p">,</span>
	<span class="mh">0x078a</span><span class="p">,</span> <span class="mh">0x078b</span><span class="p">,</span> <span class="mh">0x078c</span><span class="p">,</span> <span class="mh">0x078d</span><span class="p">,</span> <span class="mh">0x0790</span><span class="p">,</span> <span class="mh">0x0791</span><span class="p">,</span> <span class="mh">0x0792</span><span class="p">,</span> <span class="mh">0x0793</span><span class="p">,</span>
	<span class="mh">0x0794</span><span class="p">,</span> <span class="mh">0x0795</span><span class="p">,</span> <span class="mh">0x0798</span><span class="p">,</span> <span class="mh">0x0799</span><span class="p">,</span> <span class="mh">0x079a</span><span class="p">,</span> <span class="mh">0x079b</span><span class="p">,</span> <span class="mh">0x079c</span><span class="p">,</span> <span class="mh">0x079d</span><span class="p">,</span>
	<span class="mh">0x07a0</span><span class="p">,</span> <span class="mh">0x07a1</span><span class="p">,</span> <span class="mh">0x07a2</span><span class="p">,</span> <span class="mh">0x07a3</span><span class="p">,</span> <span class="mh">0x07a4</span><span class="p">,</span> <span class="mh">0x07a5</span><span class="p">,</span> <span class="mh">0x07a8</span><span class="p">,</span> <span class="mh">0x07a9</span><span class="p">,</span>
	<span class="mh">0x07aa</span><span class="p">,</span> <span class="mh">0x07ab</span><span class="p">,</span> <span class="mh">0x07ac</span><span class="p">,</span> <span class="mh">0x07ad</span><span class="p">,</span> <span class="mh">0x07b0</span><span class="p">,</span> <span class="mh">0x07b1</span><span class="p">,</span> <span class="mh">0x07b2</span><span class="p">,</span> <span class="mh">0x07b3</span><span class="p">,</span>
	<span class="mh">0x07b4</span><span class="p">,</span> <span class="mh">0x07b5</span><span class="p">,</span> <span class="mh">0x07b8</span><span class="p">,</span> <span class="mh">0x07b9</span><span class="p">,</span> <span class="mh">0x07ba</span><span class="p">,</span> <span class="mh">0x07bb</span><span class="p">,</span> <span class="mh">0x07bb</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_agc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span>
	<span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span>
	<span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">,</span>
	<span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span>
	<span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span>
	<span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span>
	<span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span>
	<span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>
	<span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span>
	<span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span>
	<span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_gain</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span>	<span class="cm">/* -82dBm */</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span>	<span class="cm">/* -82dBm */</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span>	<span class="cm">/* -82dBm */</span>
	<span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span>	<span class="cm">/* -78dBm */</span>
	<span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span>	<span class="cm">/* -74dBm */</span>
	<span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span>	<span class="cm">/* -70dBm */</span>
	<span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span>	<span class="cm">/* -66dBm */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_threshold</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xbd</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_tx_gain_cck_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x7e</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_tx_power_cck</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x03</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_tx_power_cck_ch14</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225_tx_power_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0xe4</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">rtl8225_chan</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x085c</span><span class="p">,</span> <span class="mh">0x08dc</span><span class="p">,</span> <span class="mh">0x095c</span><span class="p">,</span> <span class="mh">0x09dc</span><span class="p">,</span> <span class="mh">0x0a5c</span><span class="p">,</span> <span class="mh">0x0adc</span><span class="p">,</span> <span class="mh">0x0b5c</span><span class="p">,</span>
	<span class="mh">0x0bdc</span><span class="p">,</span> <span class="mh">0x0c5c</span><span class="p">,</span> <span class="mh">0x0cdc</span><span class="p">,</span> <span class="mh">0x0d5c</span><span class="p">,</span> <span class="mh">0x0ddc</span><span class="p">,</span> <span class="mh">0x0e5c</span><span class="p">,</span> <span class="mh">0x0f72</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_rf_set_tx_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cck_power</span><span class="p">,</span> <span class="n">ofdm_power</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">cck_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">15</span><span class="p">)</span>
		<span class="n">ofdm_power</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ofdm_power</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_CCK</span><span class="p">,</span>
			 <span class="n">rtl8225_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">cck_power</span> <span class="o">/</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtl8225_tx_power_cck_ch14</span><span class="p">[(</span><span class="n">cck_power</span> <span class="o">%</span> <span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtl8225_tx_power_cck</span><span class="p">[(</span><span class="n">cck_power</span> <span class="o">%</span> <span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">];</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="o">++</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// FIXME: optional?</span>

	<span class="cm">/* anaparam2 on */</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">EEPROM_CMD</span><span class="p">,</span> <span class="n">RTL818X_EEPROM_CMD_CONFIG</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">rtl818x_ioread8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">,</span>
			<span class="n">reg</span> <span class="o">|</span> <span class="n">RTL818X_CONFIG3_ANAPARAM_WRITE</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite32</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">ANAPARAM2</span><span class="p">,</span>
			  <span class="n">RTL8187_RTL8225_ANAPARAM2_ON</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">,</span>
			<span class="n">reg</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">RTL818X_CONFIG3_ANAPARAM_WRITE</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">EEPROM_CMD</span><span class="p">,</span> <span class="n">RTL818X_EEPROM_CMD_NORMAL</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_OFDM</span><span class="p">,</span>
			 <span class="n">rtl8225_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">ofdm_power</span> <span class="o">/</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rtl8225_tx_power_ofdm</span><span class="p">[</span><span class="n">ofdm_power</span> <span class="o">%</span> <span class="mi">6</span><span class="p">];</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_rf_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x067</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0xFE0</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x441</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x486</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xBC0</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0xAE6</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x82A</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x01F</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x334</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xA</span><span class="p">,</span> <span class="mh">0xFD4</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xB</span><span class="p">,</span> <span class="mh">0x391</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xC</span><span class="p">,</span> <span class="mh">0x050</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xD</span><span class="p">,</span> <span class="mh">0x6DB</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xE</span><span class="p">,</span> <span class="mh">0x029</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xF</span><span class="p">,</span> <span class="mh">0x914</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0xC4D</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x0c4d</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x044d</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)))</span>
			<span class="n">wiphy_warn</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">wiphy</span><span class="p">,</span> <span class="s">&quot;RF Calibration Failed! %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				   <span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x127</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225bcd_rxgain</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">rtl8225bcd_rxgain</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x027</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x22F</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225_agc</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xB</span><span class="p">,</span> <span class="n">rtl8225_agc</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xA</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>

	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TESTR</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">);</span>

	<span class="n">rtl8225_rf_set_tx_power</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* RX antenna default to A */</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">);</span>			<span class="cm">/* B: 0xDB */</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>		<span class="cm">/* B: 0x10 */</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_ANTENNA</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>	<span class="cm">/* B: 0x00 */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite32</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="p">(</span><span class="n">__le32</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xFF94</span><span class="p">,</span> <span class="mh">0x3dc00002</span><span class="p">);</span>

	<span class="cm">/* set sensitivity */</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="n">rtl8225_gain</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="n">rtl8225_threshold</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_agc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x4f</span><span class="p">,</span>
	<span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span>
	<span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span>
	<span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span>
	<span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span>
	<span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span>
	<span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x31</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>
	<span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span>
	<span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span>
	<span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span>
	<span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x07</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_tx_power_cck_ch14</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_tx_power_cck</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_tx_power_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_tx_gain_cck_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span>
	<span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span>
	<span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span>
	<span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x23</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225z2_rf_set_tx_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cck_power</span><span class="p">,</span> <span class="n">ofdm_power</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">cck_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">15</span><span class="p">);</span>
	<span class="n">cck_power</span> <span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpwr_base</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">cck_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">35</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">15</span><span class="p">)</span>
		<span class="n">ofdm_power</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ofdm_power</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpwr_base</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ofdm_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">35</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl8225z2_tx_power_cck_ch14</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl8225z2_tx_power_cck</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="o">++</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_CCK</span><span class="p">,</span>
			 <span class="n">rtl8225z2_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">cck_power</span><span class="p">]);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* anaparam2 on */</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">EEPROM_CMD</span><span class="p">,</span> <span class="n">RTL818X_EEPROM_CMD_CONFIG</span><span class="p">);</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">rtl818x_ioread8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">,</span>
			<span class="n">reg</span> <span class="o">|</span> <span class="n">RTL818X_CONFIG3_ANAPARAM_WRITE</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite32</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">ANAPARAM2</span><span class="p">,</span>
			  <span class="n">RTL8187_RTL8225_ANAPARAM2_ON</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">CONFIG3</span><span class="p">,</span>
			<span class="n">reg</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">RTL818X_CONFIG3_ANAPARAM_WRITE</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">EEPROM_CMD</span><span class="p">,</span> <span class="n">RTL818X_EEPROM_CMD_NORMAL</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_OFDM</span><span class="p">,</span>
			 <span class="n">rtl8225z2_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">ofdm_power</span><span class="p">]);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225z2_b_rf_set_tx_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cck_power</span><span class="p">,</span> <span class="n">ofdm_power</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">hw_value</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">cck_power</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="o">?</span> <span class="mi">15</span> <span class="o">:</span> <span class="mi">22</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cck_power</span> <span class="o">+=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">cck_power</span> <span class="o">+=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpwr_base</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">cck_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">cck_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">35</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">ofdm_power</span> <span class="o">=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="o">?</span> <span class="mi">17</span> <span class="o">:</span> <span class="mi">25</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ofdm_power</span> <span class="o">+=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">10</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">+=</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">txpwr_base</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xF</span><span class="p">;</span>
	<span class="n">ofdm_power</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">ofdm_power</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="mi">35</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl8225z2_tx_power_cck_ch14</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">rtl8225z2_tx_power_cck</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)</span>
			<span class="p">;</span> <span class="cm">/* do nothing */</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">)</span>
			<span class="n">tmp</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">tmp</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span>
			<span class="p">;</span> <span class="cm">/* do nothing */</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">)</span>
			<span class="n">tmp</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cck_power</span> <span class="o">&lt;=</span> <span class="mi">17</span><span class="p">)</span>
			<span class="n">tmp</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">tmp</span> <span class="o">+=</span> <span class="mi">24</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp</span><span class="o">++</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_CCK</span><span class="p">,</span>
			 <span class="n">rtl8225z2_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">cck_power</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_OFDM</span><span class="p">,</span>
			 <span class="n">rtl8225z2_tx_gain_cck_ofdm</span><span class="p">[</span><span class="n">ofdm_power</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_rev</span> <span class="o">==</span> <span class="n">RTL8187BvB</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">);</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&lt;=</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ofdm_power</span> <span class="o">&lt;=</span> <span class="mi">17</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">);</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">);</span>
			<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">rtl8225z2_rxgain</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x0400</span><span class="p">,</span> <span class="mh">0x0401</span><span class="p">,</span> <span class="mh">0x0402</span><span class="p">,</span> <span class="mh">0x0403</span><span class="p">,</span> <span class="mh">0x0404</span><span class="p">,</span> <span class="mh">0x0405</span><span class="p">,</span> <span class="mh">0x0408</span><span class="p">,</span> <span class="mh">0x0409</span><span class="p">,</span>
	<span class="mh">0x040a</span><span class="p">,</span> <span class="mh">0x040b</span><span class="p">,</span> <span class="mh">0x0502</span><span class="p">,</span> <span class="mh">0x0503</span><span class="p">,</span> <span class="mh">0x0504</span><span class="p">,</span> <span class="mh">0x0505</span><span class="p">,</span> <span class="mh">0x0540</span><span class="p">,</span> <span class="mh">0x0541</span><span class="p">,</span>
	<span class="mh">0x0542</span><span class="p">,</span> <span class="mh">0x0543</span><span class="p">,</span> <span class="mh">0x0544</span><span class="p">,</span> <span class="mh">0x0545</span><span class="p">,</span> <span class="mh">0x0580</span><span class="p">,</span> <span class="mh">0x0581</span><span class="p">,</span> <span class="mh">0x0582</span><span class="p">,</span> <span class="mh">0x0583</span><span class="p">,</span>
	<span class="mh">0x0584</span><span class="p">,</span> <span class="mh">0x0585</span><span class="p">,</span> <span class="mh">0x0588</span><span class="p">,</span> <span class="mh">0x0589</span><span class="p">,</span> <span class="mh">0x058a</span><span class="p">,</span> <span class="mh">0x058b</span><span class="p">,</span> <span class="mh">0x0643</span><span class="p">,</span> <span class="mh">0x0644</span><span class="p">,</span>
	<span class="mh">0x0645</span><span class="p">,</span> <span class="mh">0x0680</span><span class="p">,</span> <span class="mh">0x0681</span><span class="p">,</span> <span class="mh">0x0682</span><span class="p">,</span> <span class="mh">0x0683</span><span class="p">,</span> <span class="mh">0x0684</span><span class="p">,</span> <span class="mh">0x0685</span><span class="p">,</span> <span class="mh">0x0688</span><span class="p">,</span>
	<span class="mh">0x0689</span><span class="p">,</span> <span class="mh">0x068a</span><span class="p">,</span> <span class="mh">0x068b</span><span class="p">,</span> <span class="mh">0x068c</span><span class="p">,</span> <span class="mh">0x0742</span><span class="p">,</span> <span class="mh">0x0743</span><span class="p">,</span> <span class="mh">0x0744</span><span class="p">,</span> <span class="mh">0x0745</span><span class="p">,</span>
	<span class="mh">0x0780</span><span class="p">,</span> <span class="mh">0x0781</span><span class="p">,</span> <span class="mh">0x0782</span><span class="p">,</span> <span class="mh">0x0783</span><span class="p">,</span> <span class="mh">0x0784</span><span class="p">,</span> <span class="mh">0x0785</span><span class="p">,</span> <span class="mh">0x0788</span><span class="p">,</span> <span class="mh">0x0789</span><span class="p">,</span>
	<span class="mh">0x078a</span><span class="p">,</span> <span class="mh">0x078b</span><span class="p">,</span> <span class="mh">0x078c</span><span class="p">,</span> <span class="mh">0x078d</span><span class="p">,</span> <span class="mh">0x0790</span><span class="p">,</span> <span class="mh">0x0791</span><span class="p">,</span> <span class="mh">0x0792</span><span class="p">,</span> <span class="mh">0x0793</span><span class="p">,</span>
	<span class="mh">0x0794</span><span class="p">,</span> <span class="mh">0x0795</span><span class="p">,</span> <span class="mh">0x0798</span><span class="p">,</span> <span class="mh">0x0799</span><span class="p">,</span> <span class="mh">0x079a</span><span class="p">,</span> <span class="mh">0x079b</span><span class="p">,</span> <span class="mh">0x079c</span><span class="p">,</span> <span class="mh">0x079d</span><span class="p">,</span>
	<span class="mh">0x07a0</span><span class="p">,</span> <span class="mh">0x07a1</span><span class="p">,</span> <span class="mh">0x07a2</span><span class="p">,</span> <span class="mh">0x07a3</span><span class="p">,</span> <span class="mh">0x07a4</span><span class="p">,</span> <span class="mh">0x07a5</span><span class="p">,</span> <span class="mh">0x07a8</span><span class="p">,</span> <span class="mh">0x07a9</span><span class="p">,</span>
	<span class="mh">0x03aa</span><span class="p">,</span> <span class="mh">0x03ab</span><span class="p">,</span> <span class="mh">0x03ac</span><span class="p">,</span> <span class="mh">0x03ad</span><span class="p">,</span> <span class="mh">0x03b0</span><span class="p">,</span> <span class="mh">0x03b1</span><span class="p">,</span> <span class="mh">0x03b2</span><span class="p">,</span> <span class="mh">0x03b3</span><span class="p">,</span>
	<span class="mh">0x03b4</span><span class="p">,</span> <span class="mh">0x03b5</span><span class="p">,</span> <span class="mh">0x03b8</span><span class="p">,</span> <span class="mh">0x03b9</span><span class="p">,</span> <span class="mh">0x03ba</span><span class="p">,</span> <span class="mh">0x03bb</span><span class="p">,</span> <span class="mh">0x03bb</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">rtl8225z2_gain_bg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="cm">/* -82-1dBm */</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="cm">/* -82-2dBm */</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="cm">/* -82-3dBm */</span>
	<span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="cm">/* -78dBm */</span>
	<span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="cm">/* -74dBm */</span>
	<span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">,</span> <span class="cm">/* -70dBm */</span>
	<span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xc5</span>  <span class="cm">/* -66dBm */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225z2_rf_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x2BF</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0xEE0</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x441</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x8C3</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xC72</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x0E6</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x82A</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x03F</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x335</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x9D4</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x7BB</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0x850</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">,</span> <span class="mh">0xCDF</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0x02B</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x114</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1B7</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225z2_rxgain</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">rtl8225z2_rxgain</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x004</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0B7</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0xc4D</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x0C4D</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x044D</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)))</span>
			<span class="n">wiphy_warn</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">wiphy</span><span class="p">,</span> <span class="s">&quot;RF Calibration Failed! %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				   <span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">6</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x2BF</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225_agc</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xB</span><span class="p">,</span> <span class="n">rtl8225_agc</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xA</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="n">rtl8225z2_gain_bg</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">rtl8225z2_gain_bg</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">rtl8225z2_gain_bg</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xFF5B</span><span class="p">,</span> <span class="mh">0x0D</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">rtl8225z2_rf_set_tx_power</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* RX antenna default to A */</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">);</span>			<span class="cm">/* B: 0xDB */</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>		<span class="cm">/* B: 0x10 */</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_ANTENNA</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>	<span class="cm">/* B: 0x00 */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite32</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="p">(</span><span class="n">__le32</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xFF94</span><span class="p">,</span> <span class="mh">0x3dc00002</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225z2_b_rf_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0B7</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0xEE0</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x441</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x8C3</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0xC72</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x0E6</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x82A</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x03F</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x335</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0x9D4</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0x7BB</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0x850</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">,</span> <span class="mh">0xCDF</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0x02B</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x114</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x1B7</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225z2_rxgain</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">rtl8225z2_rxgain</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x004</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0B7</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0xC4D</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x44D</span><span class="p">);</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x2BF</span><span class="p">);</span>

	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_CCK</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_GAIN_OFDM</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>
	<span class="n">rtl818x_iowrite8</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">map</span><span class="o">-&gt;</span><span class="n">TX_ANTENNA</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225z2_agc</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xF</span><span class="p">,</span> <span class="n">rtl8225z2_agc</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xE</span><span class="p">,</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtl8225z2_ofdm</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">rtl8225z2_ofdm</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_ofdm</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">);</span>
	<span class="n">rtl8225_write_phy_cck</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_rf_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">rtl8225_rf_set_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">ieee80211_conf</span> <span class="o">*</span><span class="n">conf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">chan</span> <span class="o">=</span> <span class="n">ieee80211_frequency_to_channel</span><span class="p">(</span><span class="n">conf</span><span class="o">-&gt;</span><span class="n">channel</span><span class="o">-&gt;</span><span class="n">center_freq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf</span><span class="o">-&gt;</span><span class="n">init</span> <span class="o">==</span> <span class="n">rtl8225_rf_init</span><span class="p">)</span>
		<span class="n">rtl8225_rf_set_tx_power</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">chan</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf</span><span class="o">-&gt;</span><span class="n">init</span> <span class="o">==</span> <span class="n">rtl8225z2_rf_init</span><span class="p">)</span>
		<span class="n">rtl8225z2_rf_set_tx_power</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">chan</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">rtl8225z2_b_rf_set_tx_power</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">chan</span><span class="p">);</span>

	<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="n">rtl8225_chan</span><span class="p">[</span><span class="n">chan</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">rtl818x_rf_ops</span> <span class="n">rtl8225_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;rtl8225&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">rtl8225_rf_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop</span>		<span class="o">=</span> <span class="n">rtl8225_rf_stop</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_chan</span>	<span class="o">=</span> <span class="n">rtl8225_rf_set_channel</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">rtl818x_rf_ops</span> <span class="n">rtl8225z2_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;rtl8225z2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">rtl8225z2_rf_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop</span>		<span class="o">=</span> <span class="n">rtl8225_rf_stop</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_chan</span>	<span class="o">=</span> <span class="n">rtl8225_rf_set_channel</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">rtl818x_rf_ops</span> <span class="n">rtl8225z2_b_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;rtl8225z2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>		<span class="o">=</span> <span class="n">rtl8225z2_b_rf_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop</span>		<span class="o">=</span> <span class="n">rtl8225_rf_stop</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_chan</span>	<span class="o">=</span> <span class="n">rtl8225_rf_set_channel</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">rtl818x_rf_ops</span> <span class="o">*</span> <span class="nf">rtl8187_detect_rf</span><span class="p">(</span><span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg8</span><span class="p">,</span> <span class="n">reg9</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rtl8187_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">is_rtl8187b</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x1B7</span><span class="p">);</span>

		<span class="n">reg8</span> <span class="o">=</span> <span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">reg9</span> <span class="o">=</span> <span class="n">rtl8225_read</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

		<span class="n">rtl8225_write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x0B7</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">reg8</span> <span class="o">!=</span> <span class="mh">0x588</span> <span class="o">||</span> <span class="n">reg9</span> <span class="o">!=</span> <span class="mh">0x700</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">&amp;</span><span class="n">rtl8225_ops</span><span class="p">;</span>

		<span class="k">return</span> <span class="o">&amp;</span><span class="n">rtl8225z2_ops</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="k">return</span> <span class="o">&amp;</span><span class="n">rtl8225z2_b_ops</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
