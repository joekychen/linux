<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › brcm80211 › brcmsmac › phy › phy_lcn.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>phy_lcn.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2010 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> * purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> * copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY</span>
<span class="cm"> * SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION</span>
<span class="cm"> * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/cordic.h&gt;</span>

<span class="cp">#include &lt;pmu.h&gt;</span>
<span class="cp">#include &lt;d11.h&gt;</span>
<span class="cp">#include &lt;phy_shim.h&gt;</span>
<span class="cp">#include &quot;phy_qmath.h&quot;</span>
<span class="cp">#include &quot;phy_hal.h&quot;</span>
<span class="cp">#include &quot;phy_radio.h&quot;</span>
<span class="cp">#include &quot;phytbl_lcn.h&quot;</span>
<span class="cp">#include &quot;phy_lcn.h&quot;</span>

<span class="cp">#define PLL_2064_NDIV		90</span>
<span class="cp">#define PLL_2064_LOW_END_VCO	3000</span>
<span class="cp">#define PLL_2064_LOW_END_KVCO	27</span>
<span class="cp">#define PLL_2064_HIGH_END_VCO	4200</span>
<span class="cp">#define PLL_2064_HIGH_END_KVCO	68</span>
<span class="cp">#define PLL_2064_LOOP_BW_DOUBLER	200</span>
<span class="cp">#define PLL_2064_D30_DOUBLER		10500</span>
<span class="cp">#define PLL_2064_LOOP_BW	260</span>
<span class="cp">#define PLL_2064_D30		8000</span>
<span class="cp">#define PLL_2064_CAL_REF_TO	8</span>
<span class="cp">#define PLL_2064_MHZ		1000000</span>
<span class="cp">#define PLL_2064_OPEN_LOOP_DELAY	5</span>

<span class="cp">#define TEMPSENSE			1</span>
<span class="cp">#define VBATSENSE           2</span>

<span class="cp">#define NOISE_IF_UPD_CHK_INTERVAL	1</span>
<span class="cp">#define NOISE_IF_UPD_RST_INTERVAL	60</span>
<span class="cp">#define NOISE_IF_UPD_THRESHOLD_CNT	1</span>
<span class="cp">#define NOISE_IF_UPD_TRHRESHOLD	50</span>
<span class="cp">#define NOISE_IF_UPD_TIMEOUT		1000</span>
<span class="cp">#define NOISE_IF_OFF			0</span>
<span class="cp">#define NOISE_IF_CHK			1</span>
<span class="cp">#define NOISE_IF_ON			2</span>

<span class="cp">#define PAPD_BLANKING_PROFILE		3</span>
<span class="cp">#define PAPD2LUT			0</span>
<span class="cp">#define PAPD_CORR_NORM			0</span>
<span class="cp">#define PAPD_BLANKING_THRESHOLD		0</span>
<span class="cp">#define PAPD_STOP_AFTER_LAST_UPDATE	0</span>

<span class="cp">#define LCN_TARGET_PWR  60</span>

<span class="cp">#define LCN_VBAT_OFFSET_433X 34649679</span>
<span class="cp">#define LCN_VBAT_SLOPE_433X  8258032</span>

<span class="cp">#define LCN_VBAT_SCALE_NOM  53</span>
<span class="cp">#define LCN_VBAT_SCALE_DEN  432</span>

<span class="cp">#define LCN_TEMPSENSE_OFFSET  80812</span>
<span class="cp">#define LCN_TEMPSENSE_DEN  2647</span>

<span class="cp">#define LCN_BW_LMT	200</span>
<span class="cp">#define LCN_CUR_LMT	1250</span>
<span class="cp">#define LCN_MULT	1</span>
<span class="cp">#define LCN_VCO_DIV	30</span>
<span class="cp">#define LCN_OFFSET	680</span>
<span class="cp">#define LCN_FACT	490</span>
<span class="cp">#define LCN_CUR_DIV	2640</span>

<span class="cp">#define LCNPHY_txgainctrlovrval1_pagain_ovr_val1_SHIFT \</span>
<span class="cp">	(0 + 8)</span>
<span class="cp">#define LCNPHY_txgainctrlovrval1_pagain_ovr_val1_MASK \</span>
<span class="cp">	(0x7f &lt;&lt; LCNPHY_txgainctrlovrval1_pagain_ovr_val1_SHIFT)</span>

<span class="cp">#define LCNPHY_stxtxgainctrlovrval1_pagain_ovr_val1_SHIFT \</span>
<span class="cp">	(0 + 8)</span>
<span class="cp">#define LCNPHY_stxtxgainctrlovrval1_pagain_ovr_val1_MASK \</span>
<span class="cp">	(0x7f &lt;&lt; LCNPHY_stxtxgainctrlovrval1_pagain_ovr_val1_SHIFT)</span>

<span class="cp">#define wlc_lcnphy_enable_tx_gain_override(pi) \</span>
<span class="cp">	wlc_lcnphy_set_tx_gain_override(pi, true)</span>
<span class="cp">#define wlc_lcnphy_disable_tx_gain_override(pi)	\</span>
<span class="cp">	wlc_lcnphy_set_tx_gain_override(pi, false)</span>

<span class="cp">#define wlc_lcnphy_iqcal_active(pi)	\</span>
<span class="cp">	(read_phy_reg((pi), 0x451) &amp; \</span>
<span class="cp">	 ((0x1 &lt;&lt; 15) | (0x1 &lt;&lt; 14)))</span>

<span class="cp">#define txpwrctrl_off(pi) (0x7 != ((read_phy_reg(pi, 0x4a4) &amp; 0xE000) &gt;&gt; 13))</span>
<span class="cp">#define wlc_lcnphy_tempsense_based_pwr_ctrl_enabled(pi)	\</span>
<span class="cp">	(pi-&gt;temppwrctrl_capable)</span>
<span class="cp">#define wlc_lcnphy_tssi_based_pwr_ctrl_enabled(pi) \</span>
<span class="cp">	(pi-&gt;hwpwrctrl_capable)</span>

<span class="cp">#define SWCTRL_BT_TX		0x18</span>
<span class="cp">#define SWCTRL_OVR_DISABLE	0x40</span>

<span class="cp">#define	AFE_CLK_INIT_MODE_TXRX2X	1</span>
<span class="cp">#define	AFE_CLK_INIT_MODE_PAPD		0</span>

<span class="cp">#define LCNPHY_TBL_ID_IQLOCAL			0x00</span>

<span class="cp">#define LCNPHY_TBL_ID_RFSEQ         0x08</span>
<span class="cp">#define LCNPHY_TBL_ID_GAIN_IDX		0x0d</span>
<span class="cp">#define LCNPHY_TBL_ID_SW_CTRL			0x0f</span>
<span class="cp">#define LCNPHY_TBL_ID_GAIN_TBL		0x12</span>
<span class="cp">#define LCNPHY_TBL_ID_SPUR			0x14</span>
<span class="cp">#define LCNPHY_TBL_ID_SAMPLEPLAY		0x15</span>
<span class="cp">#define LCNPHY_TBL_ID_SAMPLEPLAY1		0x16</span>

<span class="cp">#define LCNPHY_TX_PWR_CTRL_RATE_OFFSET	832</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_MAC_OFFSET	128</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_GAIN_OFFSET	192</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_IQ_OFFSET		320</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_LO_OFFSET		448</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_PWR_OFFSET		576</span>

<span class="cp">#define LCNPHY_TX_PWR_CTRL_START_INDEX_2G_4313	140</span>

<span class="cp">#define LCNPHY_TX_PWR_CTRL_START_NPT		1</span>
<span class="cp">#define LCNPHY_TX_PWR_CTRL_MAX_NPT			7</span>

<span class="cp">#define LCNPHY_NOISE_SAMPLES_DEFAULT 5000</span>

<span class="cp">#define LCNPHY_ACI_DETECT_START      1</span>
<span class="cp">#define LCNPHY_ACI_DETECT_PROGRESS   2</span>
<span class="cp">#define LCNPHY_ACI_DETECT_STOP       3</span>

<span class="cp">#define LCNPHY_ACI_CRSHIFRMLO_TRSH 100</span>
<span class="cp">#define LCNPHY_ACI_GLITCH_TRSH 2000</span>
<span class="cp">#define	LCNPHY_ACI_TMOUT 250</span>
<span class="cp">#define LCNPHY_ACI_DETECT_TIMEOUT  2</span>
<span class="cp">#define LCNPHY_ACI_START_DELAY 0</span>

<span class="cp">#define wlc_lcnphy_tx_gain_override_enabled(pi)	\</span>
<span class="cp">	(0 != (read_phy_reg((pi), 0x43b) &amp; (0x1 &lt;&lt; 6)))</span>

<span class="cp">#define wlc_lcnphy_total_tx_frames(pi) \</span>
<span class="cp">	wlapi_bmac_read_shm((pi)-&gt;sh-&gt;physhim, M_UCODE_MACSTAT + \</span>
<span class="cp">			    offsetof(struct macstat, txallfrm))</span>

<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">gm_gain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pga_gain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pad_gain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">dac_gain</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">lcnphy_cal_mode</span> <span class="p">{</span>
	<span class="n">LCNPHY_CAL_FULL</span><span class="p">,</span>
	<span class="n">LCNPHY_CAL_RECAL</span><span class="p">,</span>
	<span class="n">LCNPHY_CAL_CURRECAL</span><span class="p">,</span>
	<span class="n">LCNPHY_CAL_DIGCAL</span><span class="p">,</span>
	<span class="n">LCNPHY_CAL_GCTRL</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lcnphy_rx_iqcomp</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">chan</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">b</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lcnphy_spb_tone</span> <span class="p">{</span>
	<span class="n">s16</span> <span class="n">re</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">im</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lcnphy_unsign16_struct</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">re</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">im</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lcnphy_iq_est</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">iq_prod</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i_pwr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">q_pwr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lcnphy_sfo_cfg</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">ptcentreTs20</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ptcentreFactor</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">lcnphy_papd_cal_type</span> <span class="p">{</span>
	<span class="n">LCNPHY_PAPD_CAL_CW</span><span class="p">,</span>
	<span class="n">LCNPHY_PAPD_CAL_OFDM</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="n">u16</span> <span class="n">iqcal_gain_params_lcnphy</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">iqcal_gain_params_lcnphy</span> <span class="n">tbl_iqcal_gainparams_lcnphy_2G</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">iqcal_gain_params_lcnphy</span> <span class="o">*</span><span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">tbl_iqcal_gainparams_lcnphy_2G</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">iqcal_gainparams_numgains_lcnphy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tbl_iqcal_gainparams_lcnphy_2G</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_sfo_cfg</span> <span class="n">lcnphy_sfo_cfg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">965</span><span class="p">,</span> <span class="mi">1087</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">967</span><span class="p">,</span> <span class="mi">1085</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">969</span><span class="p">,</span> <span class="mi">1082</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">971</span><span class="p">,</span> <span class="mi">1080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">973</span><span class="p">,</span> <span class="mi">1078</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">975</span><span class="p">,</span> <span class="mi">1076</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">977</span><span class="p">,</span> <span class="mi">1073</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">979</span><span class="p">,</span> <span class="mi">1071</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">981</span><span class="p">,</span> <span class="mi">1069</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">983</span><span class="p">,</span> <span class="mi">1067</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">985</span><span class="p">,</span> <span class="mi">1065</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">987</span><span class="p">,</span> <span class="mi">1063</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">989</span><span class="p">,</span> <span class="mi">1060</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">994</span><span class="p">,</span> <span class="mi">1055</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="n">u16</span> <span class="n">lcnphy_iqcal_loft_gainladder</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">6</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">8</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">11</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">2</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">3</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">4</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">5</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">6</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">23</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">32</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">45</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">91</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">128</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="n">u16</span> <span class="n">lcnphy_iqcal_ir_gainladder</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">6</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">8</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">11</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">23</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">32</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">45</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">1</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">2</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">3</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">4</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">5</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">6</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">64</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">91</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">),</span>
	<span class="p">((</span><span class="mi">128</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mi">7</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="k">struct</span> <span class="n">lcnphy_spb_tone</span> <span class="n">lcnphy_spb_tone_3750</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">88</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">73</span><span class="p">,</span> <span class="mi">49</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">34</span><span class="p">,</span> <span class="mi">81</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span> <span class="mi">86</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">62</span><span class="p">,</span> <span class="mi">62</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">86</span><span class="p">,</span> <span class="mi">17</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">81</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="o">-</span><span class="mi">73</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">88</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">49</span><span class="p">,</span> <span class="o">-</span><span class="mi">73</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">81</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">86</span><span class="p">,</span> <span class="mi">17</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">62</span><span class="p">,</span> <span class="mi">62</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">17</span><span class="p">,</span> <span class="mi">86</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">34</span><span class="p">,</span> <span class="mi">81</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">73</span><span class="p">,</span> <span class="mi">49</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">88</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">73</span><span class="p">,</span> <span class="o">-</span><span class="mi">49</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">81</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">17</span><span class="p">,</span> <span class="o">-</span><span class="mi">86</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">62</span><span class="p">,</span> <span class="o">-</span><span class="mi">62</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">86</span><span class="p">,</span> <span class="o">-</span><span class="mi">17</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">81</span><span class="p">,</span> <span class="mi">34</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">49</span><span class="p">,</span> <span class="mi">73</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">88</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="mi">73</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">81</span><span class="p">,</span> <span class="mi">34</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">86</span><span class="p">,</span> <span class="o">-</span><span class="mi">17</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">62</span><span class="p">,</span> <span class="o">-</span><span class="mi">62</span><span class="p">},</span>
	<span class="p">{</span><span class="o">-</span><span class="mi">17</span><span class="p">,</span> <span class="o">-</span><span class="mi">86</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">34</span><span class="p">,</span> <span class="o">-</span><span class="mi">81</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">73</span><span class="p">,</span> <span class="o">-</span><span class="mi">49</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="n">u16</span> <span class="n">iqlo_loopback_rf_regs</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">RADIO_2064_REG036</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG11A</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG03A</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG025</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG028</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG005</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG112</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG0FF</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG11F</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG00B</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG113</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG007</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG0FC</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG0FD</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG012</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG057</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG059</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG05C</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG078</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG092</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="n">u16</span> <span class="n">tempsense_phy_regs</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x503</span><span class="p">,</span>
	<span class="mh">0x4a4</span><span class="p">,</span>
	<span class="mh">0x4d0</span><span class="p">,</span>
	<span class="mh">0x4d9</span><span class="p">,</span>
	<span class="mh">0x4da</span><span class="p">,</span>
	<span class="mh">0x4a6</span><span class="p">,</span>
	<span class="mh">0x938</span><span class="p">,</span>
	<span class="mh">0x939</span><span class="p">,</span>
	<span class="mh">0x4d8</span><span class="p">,</span>
	<span class="mh">0x4d0</span><span class="p">,</span>
	<span class="mh">0x4d7</span><span class="p">,</span>
	<span class="mh">0x4a5</span><span class="p">,</span>
	<span class="mh">0x40d</span><span class="p">,</span>
	<span class="mh">0x4a2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="n">u16</span> <span class="n">rxiq_cal_rf_reg</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">RADIO_2064_REG098</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG116</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG12C</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG06A</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG00B</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG01B</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG113</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG01D</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG114</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG02E</span><span class="p">,</span>
	<span class="n">RADIO_2064_REG12A</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span>
<span class="k">struct</span> <span class="n">lcnphy_rx_iqcomp</span> <span class="n">lcnphy_rx_iqcomp_table_rev0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">34</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">38</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">46</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">36</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">44</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">48</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">52</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">56</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">104</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">108</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">112</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">116</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">124</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">132</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">136</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">140</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">149</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">153</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">157</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">161</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">165</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">184</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">188</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">192</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">196</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">204</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">208</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">212</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">216</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">lcnphy_23bitgaincode_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x200100</span><span class="p">,</span>
	<span class="mh">0x200200</span><span class="p">,</span>
	<span class="mh">0x200004</span><span class="p">,</span>
	<span class="mh">0x200014</span><span class="p">,</span>
	<span class="mh">0x200024</span><span class="p">,</span>
	<span class="mh">0x200034</span><span class="p">,</span>
	<span class="mh">0x200134</span><span class="p">,</span>
	<span class="mh">0x200234</span><span class="p">,</span>
	<span class="mh">0x200334</span><span class="p">,</span>
	<span class="mh">0x200434</span><span class="p">,</span>
	<span class="mh">0x200037</span><span class="p">,</span>
	<span class="mh">0x200137</span><span class="p">,</span>
	<span class="mh">0x200237</span><span class="p">,</span>
	<span class="mh">0x200337</span><span class="p">,</span>
	<span class="mh">0x200437</span><span class="p">,</span>
	<span class="mh">0x000035</span><span class="p">,</span>
	<span class="mh">0x000135</span><span class="p">,</span>
	<span class="mh">0x000235</span><span class="p">,</span>
	<span class="mh">0x000037</span><span class="p">,</span>
	<span class="mh">0x000137</span><span class="p">,</span>
	<span class="mh">0x000237</span><span class="p">,</span>
	<span class="mh">0x000337</span><span class="p">,</span>
	<span class="mh">0x00013f</span><span class="p">,</span>
	<span class="mh">0x00023f</span><span class="p">,</span>
	<span class="mh">0x00033f</span><span class="p">,</span>
	<span class="mh">0x00034f</span><span class="p">,</span>
	<span class="mh">0x00044f</span><span class="p">,</span>
	<span class="mh">0x00144f</span><span class="p">,</span>
	<span class="mh">0x00244f</span><span class="p">,</span>
	<span class="mh">0x00254f</span><span class="p">,</span>
	<span class="mh">0x00354f</span><span class="p">,</span>
	<span class="mh">0x00454f</span><span class="p">,</span>
	<span class="mh">0x00464f</span><span class="p">,</span>
	<span class="mh">0x01464f</span><span class="p">,</span>
	<span class="mh">0x02464f</span><span class="p">,</span>
	<span class="mh">0x03464f</span><span class="p">,</span>
	<span class="mh">0x04464f</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">s8</span> <span class="n">lcnphy_gain_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">-</span><span class="mi">16</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">13</span><span class="p">,</span>
	<span class="mi">10</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">6</span><span class="p">,</span>
	<span class="mi">9</span><span class="p">,</span>
	<span class="mi">12</span><span class="p">,</span>
	<span class="mi">15</span><span class="p">,</span>
	<span class="mi">18</span><span class="p">,</span>
	<span class="mi">21</span><span class="p">,</span>
	<span class="mi">24</span><span class="p">,</span>
	<span class="mi">27</span><span class="p">,</span>
	<span class="mi">30</span><span class="p">,</span>
	<span class="mi">33</span><span class="p">,</span>
	<span class="mi">36</span><span class="p">,</span>
	<span class="mi">39</span><span class="p">,</span>
	<span class="mi">42</span><span class="p">,</span>
	<span class="mi">45</span><span class="p">,</span>
	<span class="mi">48</span><span class="p">,</span>
	<span class="mi">50</span><span class="p">,</span>
	<span class="mi">53</span><span class="p">,</span>
	<span class="mi">56</span><span class="p">,</span>
	<span class="mi">59</span><span class="p">,</span>
	<span class="mi">62</span><span class="p">,</span>
	<span class="mi">65</span><span class="p">,</span>
	<span class="mi">68</span><span class="p">,</span>
	<span class="mi">71</span><span class="p">,</span>
	<span class="mi">74</span><span class="p">,</span>
	<span class="mi">77</span><span class="p">,</span>
	<span class="mi">80</span><span class="p">,</span>
	<span class="mi">83</span><span class="p">,</span>
	<span class="mi">86</span><span class="p">,</span>
	<span class="mi">89</span><span class="p">,</span>
	<span class="mi">92</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">s8</span> <span class="n">lcnphy_gain_index_offset_for_rssi</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">8</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">6</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">2</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">chan_info_2064_lcnphy</span> <span class="p">{</span>
	<span class="n">uint</span> <span class="n">chan</span><span class="p">;</span>
	<span class="n">uint</span> <span class="n">freq</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">logen_buftune</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">logen_rccr_tx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">txrf_mix_tune_ctrl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pa_input_tune_g</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">logen_rccr_rx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pa_rxrf_lna1_freq_tune</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pa_rxrf_lna2_freq_tune</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rxrf_rxrf_spare1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">chan_info_2064_lcnphy</span> <span class="n">chan_info_2064_lcnphy</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2412</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2417</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2422</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2427</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2432</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2437</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2442</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2447</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2452</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2457</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11</span><span class="p">,</span> <span class="mi">2462</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">2467</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13</span><span class="p">,</span> <span class="mi">2472</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2484</span><span class="p">,</span> <span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_radio_regs</span> <span class="n">lcnphy_radio_regs_2064</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0A</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0B</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0C</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0D</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0F</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1A</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1B</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1D</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1E</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1F</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2A</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2B</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2C</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2D</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2F</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3A</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3C</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3D</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3E</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x44</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4A</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4B</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4D</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x4F</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x56</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x57</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x58</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x59</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5E</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5F</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x68</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6B</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6C</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6E</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6F</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0xd6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8A</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8B</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8C</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8D</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8E</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8F</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x95</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x96</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x97</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x98</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9A</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9B</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9C</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9D</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9E</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9F</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA4</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA5</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA6</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA7</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA8</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xA9</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAA</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAB</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAC</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAD</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xAF</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB0</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB2</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB4</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB5</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB6</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB7</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB8</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xB9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBA</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBC</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBD</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBE</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xBF</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC2</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC3</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC4</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC5</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC7</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC8</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xC9</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCA</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCB</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCC</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCD</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCE</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xCF</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD0</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD1</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD2</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD6</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xD9</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDA</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDB</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDD</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDE</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xDF</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE0</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE1</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE5</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE6</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE7</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xE9</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xEA</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xEB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xEC</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xED</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xEE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xEF</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF7</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xF9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFA</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFC</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFD</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x101</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x102</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x103</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x104</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x105</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x106</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x107</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x108</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x109</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x110</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x111</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x112</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x113</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x114</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x115</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x116</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x117</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x118</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x119</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11C</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x120</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x121</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x122</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x123</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x124</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x125</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x126</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x127</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x128</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x129</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12A</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12B</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12C</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12E</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x130</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xFFFF</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define LCNPHY_NUM_DIG_FILT_COEFFS 16</span>
<span class="cp">#define LCNPHY_NUM_TX_DIG_FILTERS_CCK 13</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">LCNPHY_txdigfiltcoeffs_cck</span><span class="p">[</span><span class="n">LCNPHY_NUM_TX_DIG_FILTERS_CCK</span><span class="p">]</span>
	<span class="p">[</span><span class="n">LCNPHY_NUM_DIG_FILT_COEFFS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">415</span><span class="p">,</span> <span class="mi">1874</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">792</span><span class="p">,</span> <span class="mi">1656</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">778</span><span class="p">,</span> <span class="mi">1582</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>
	 <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">402</span><span class="p">,</span> <span class="mi">1847</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">259</span><span class="p">,</span> <span class="mi">671</span><span class="p">,</span> <span class="mi">1794</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">608</span><span class="p">,</span> <span class="mi">1863</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span>
	 <span class="mi">167</span><span class="p">,</span> <span class="mi">93</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">415</span><span class="p">,</span> <span class="mi">1874</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">792</span><span class="p">,</span> <span class="mi">1656</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">778</span><span class="p">,</span> <span class="mi">1582</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span>
	 <span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">1841</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">258</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">658</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">754</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">170</span><span class="p">,</span> <span class="mi">340</span><span class="p">,</span> <span class="mi">170</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">1734</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">1845</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">767</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">256</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">256</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">1874</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">767</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">256</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">256</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">1948</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">1924</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">767</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">256</span><span class="p">,</span> <span class="mi">352</span><span class="p">,</span> <span class="mi">256</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">23</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">1966</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">752</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">2008</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">767</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">128</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">128</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">756</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">471</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">766</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>
	 <span class="mi">1881</span><span class="p">,</span> <span class="mi">256</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">25</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">299</span><span class="p">,</span> <span class="mi">1884</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">736</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">471</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">765</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span>
	 <span class="mi">1881</span><span class="p">,</span> <span class="mi">256</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">277</span><span class="p">,</span> <span class="mi">1943</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">637</span><span class="p">,</span> <span class="mi">1838</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">614</span><span class="p">,</span> <span class="mi">1864</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span>
	 <span class="mi">384</span><span class="p">,</span> <span class="mi">288</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">27</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">1943</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">147</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">626</span><span class="p">,</span> <span class="mi">1838</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="mi">576</span><span class="p">,</span> <span class="mi">613</span><span class="p">,</span> <span class="mi">1864</span><span class="p">,</span>
	 <span class="mi">128</span><span class="p">,</span> <span class="mi">384</span><span class="p">,</span> <span class="mi">288</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">302</span><span class="p">,</span> <span class="mi">1841</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">658</span><span class="p">,</span> <span class="mi">1720</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">754</span><span class="p">,</span> <span class="mi">1760</span><span class="p">,</span>
	 <span class="mi">170</span><span class="p">,</span> <span class="mi">340</span><span class="p">,</span> <span class="mi">170</span><span class="p">,},</span>
<span class="p">};</span>

<span class="cp">#define LCNPHY_NUM_TX_DIG_FILTERS_OFDM 3</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">LCNPHY_txdigfiltcoeffs_ofdm</span><span class="p">[</span><span class="n">LCNPHY_NUM_TX_DIG_FILTERS_OFDM</span><span class="p">]</span>
	<span class="p">[</span><span class="n">LCNPHY_NUM_DIG_FILT_COEFFS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
	 <span class="mh">0x278</span><span class="p">,</span> <span class="mh">0xfea0</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">374</span><span class="p">,</span> <span class="mh">0xFF79</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">799</span><span class="p">,</span> <span class="mh">0xFE74</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span>
	 <span class="mi">750</span><span class="p">,</span> <span class="mh">0xFE2B</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mh">0xFFCE</span><span class="p">,</span> <span class="mi">212</span><span class="p">,},</span>
	<span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mh">0xFF16</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">799</span><span class="p">,</span> <span class="mh">0xFE74</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">748</span><span class="p">,</span>
	 <span class="mh">0xFEF2</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mh">0xFFE2</span><span class="p">,</span> <span class="mi">128</span><span class="p">}</span>
<span class="p">};</span>

<span class="cp">#define wlc_lcnphy_set_start_tx_pwr_idx(pi, idx) \</span>
<span class="cp">	mod_phy_reg(pi, 0x4a4, \</span>
<span class="cp">		    (0x1ff &lt;&lt; 0), \</span>
<span class="cp">		    (u16)(idx) &lt;&lt; 0)</span>

<span class="cp">#define wlc_lcnphy_set_tx_pwr_npt(pi, npt) \</span>
<span class="cp">	mod_phy_reg(pi, 0x4a5, \</span>
<span class="cp">		    (0x7 &lt;&lt; 8),	\</span>
<span class="cp">		    (u16)(npt) &lt;&lt; 8)</span>

<span class="cp">#define wlc_lcnphy_get_tx_pwr_ctrl(pi) \</span>
<span class="cp">	(read_phy_reg((pi), 0x4a4) &amp; \</span>
<span class="cp">	 ((0x1 &lt;&lt; 15) |	\</span>
<span class="cp">	  (0x1 &lt;&lt; 14) |	\</span>
<span class="cp">	  (0x1 &lt;&lt; 13)))</span>

<span class="cp">#define wlc_lcnphy_get_tx_pwr_npt(pi) \</span>
<span class="cp">	((read_phy_reg(pi, 0x4a5) &amp; \</span>
<span class="cp">	  (0x7 &lt;&lt; 8)) &gt;&gt; \</span>
<span class="cp">	 8)</span>

<span class="cp">#define wlc_lcnphy_get_current_tx_pwr_idx_if_pwrctrl_on(pi) \</span>
<span class="cp">	(read_phy_reg(pi, 0x473) &amp; 0x1ff)</span>

<span class="cp">#define wlc_lcnphy_get_target_tx_pwr(pi) \</span>
<span class="cp">	((read_phy_reg(pi, 0x4a7) &amp; \</span>
<span class="cp">	  (0xff &lt;&lt; 0)) &gt;&gt; \</span>
<span class="cp">	 0)</span>

<span class="cp">#define wlc_lcnphy_set_target_tx_pwr(pi, target) \</span>
<span class="cp">	mod_phy_reg(pi, 0x4a7, \</span>
<span class="cp">		    (0xff &lt;&lt; 0), \</span>
<span class="cp">		    (u16)(target) &lt;&lt; 0)</span>

<span class="cp">#define wlc_radio_2064_rcal_done(pi) \</span>
<span class="cp">	(0 != (read_radio_reg(pi, RADIO_2064_REG05C) &amp; 0x20))</span>

<span class="cp">#define tempsense_done(pi) \</span>
<span class="cp">	(0x8000 == (read_phy_reg(pi, 0x476) &amp; 0x8000))</span>

<span class="cp">#define LCNPHY_IQLOCC_READ(val) \</span>
<span class="cp">	((u8)(-(s8)(((val) &amp; 0xf0) &gt;&gt; 4) + (s8)((val) &amp; 0x0f)))</span>

<span class="cp">#define FIXED_TXPWR 78</span>
<span class="cp">#define LCNPHY_TEMPSENSE(val) ((s16)((val &gt; 255) ? (val - 512) : val))</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_write_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">phytbl_info</span> <span class="o">*</span><span class="n">pti</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wlc_phy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pti</span><span class="p">,</span> <span class="mh">0x455</span><span class="p">,</span> <span class="mh">0x457</span><span class="p">,</span> <span class="mh">0x456</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_read_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">phytbl_info</span> <span class="o">*</span><span class="n">pti</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wlc_phy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pti</span><span class="p">,</span> <span class="mh">0x455</span><span class="p">,</span> <span class="mh">0x457</span><span class="p">,</span> <span class="mh">0x456</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_common_read_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_id</span><span class="p">,</span>
			     <span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">tbl_ptr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_len</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="n">tbl_width</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">tbl_id</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">tbl_ptr</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="n">tbl_len</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="n">tbl_width</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">tbl_offset</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_id</span><span class="p">,</span>
			      <span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">tbl_ptr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_len</span><span class="p">,</span>
			      <span class="n">u32</span> <span class="n">tbl_width</span><span class="p">,</span> <span class="n">u32</span> <span class="n">tbl_offset</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">tbl_id</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">tbl_ptr</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="n">tbl_len</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="n">tbl_width</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">tbl_offset</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span>
<span class="nf">wlc_lcnphy_qdiv_roundup</span><span class="p">(</span><span class="n">u32</span> <span class="n">dividend</span><span class="p">,</span> <span class="n">u32</span> <span class="n">divisor</span><span class="p">,</span> <span class="n">u8</span> <span class="n">precision</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">quotient</span><span class="p">,</span> <span class="n">remainder</span><span class="p">,</span> <span class="n">roundup</span><span class="p">,</span> <span class="n">rbit</span><span class="p">;</span>

	<span class="n">quotient</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">;</span>
	<span class="n">remainder</span> <span class="o">=</span> <span class="n">dividend</span> <span class="o">%</span> <span class="n">divisor</span><span class="p">;</span>
	<span class="n">rbit</span> <span class="o">=</span> <span class="n">divisor</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">roundup</span> <span class="o">=</span> <span class="p">(</span><span class="n">divisor</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">rbit</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">precision</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">quotient</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">remainder</span> <span class="o">&gt;=</span> <span class="n">roundup</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">quotient</span><span class="o">++</span><span class="p">;</span>
			<span class="n">remainder</span> <span class="o">=</span> <span class="p">((</span><span class="n">remainder</span> <span class="o">-</span> <span class="n">roundup</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">rbit</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">remainder</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">remainder</span> <span class="o">&gt;=</span> <span class="n">roundup</span><span class="p">)</span>
		<span class="n">quotient</span><span class="o">++</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">quotient</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">s16</span> <span class="n">coeff_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
	<span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">coeff_x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff_x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">k</span> <span class="o">=</span> <span class="n">coeff_x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">coeff_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff_x</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff_x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">k</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="o">*</span><span class="n">gains</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">dac_gain</span><span class="p">,</span> <span class="n">rfgain0</span><span class="p">,</span> <span class="n">rfgain1</span><span class="p">;</span>

	<span class="n">dac_gain</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x439</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">gains</span><span class="o">-&gt;</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">dac_gain</span> <span class="o">&amp;</span> <span class="mh">0x380</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">;</span>

	<span class="n">rfgain0</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">rfgain1</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fb</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7fff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">gains</span><span class="o">-&gt;</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="n">rfgain0</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">gains</span><span class="o">-&gt;</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">rfgain0</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">gains</span><span class="o">-&gt;</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="n">rfgain1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_dac_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">dac_gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">dac_ctrl</span><span class="p">;</span>

	<span class="n">dac_ctrl</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x439</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dac_ctrl</span> <span class="o">=</span> <span class="n">dac_ctrl</span> <span class="o">&amp;</span> <span class="mh">0xc7f</span><span class="p">;</span>
	<span class="n">dac_ctrl</span> <span class="o">=</span> <span class="n">dac_ctrl</span> <span class="o">|</span> <span class="p">(</span><span class="n">dac_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x439</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xfff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">dac_ctrl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_gain_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bEnable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">bit</span> <span class="o">=</span> <span class="n">bEnable</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="n">bit</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_rx_gain_override_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">ebit</span> <span class="o">=</span> <span class="n">enable</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_LT</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4e5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="n">ebit</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_set_rx_gain_by_distribution</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">trsw</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">ext_lna</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">biq2</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">biq1</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">tia</span><span class="p">,</span> <span class="n">u16</span> <span class="n">lna2</span><span class="p">,</span> <span class="n">u16</span> <span class="n">lna1</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">gain0_15</span><span class="p">,</span> <span class="n">gain16_19</span><span class="p">;</span>

	<span class="n">gain16_19</span> <span class="o">=</span> <span class="n">biq2</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">gain0_15</span> <span class="o">=</span> <span class="p">((</span><span class="n">biq1</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span>
		   <span class="p">((</span><span class="n">tia</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
		   <span class="p">((</span><span class="n">lna2</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span>
		   <span class="p">((</span><span class="n">lna2</span> <span class="o">&amp;</span>
		     <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">lna1</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">lna1</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gain0_15</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gain16_19</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">),</span> <span class="n">lna1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_LT</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="n">ext_lna</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ext_lna</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="n">ext_lna</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">!</span><span class="n">trsw</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_trsw_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">tx</span><span class="p">,</span> <span class="n">bool</span> <span class="n">rx</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">tx</span> <span class="o">?</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">rx</span> <span class="o">?</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">));</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_clear_trsw_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="o">~</span><span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_rx_iq_comp</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x645</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x646</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x647</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x648</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x649</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x64a</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">wlc_lcnphy_rx_iq_est</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
		     <span class="n">u16</span> <span class="n">num_samps</span><span class="p">,</span>
		     <span class="n">u8</span> <span class="n">wait_time</span><span class="p">,</span> <span class="k">struct</span> <span class="n">lcnphy_iq_est</span> <span class="o">*</span><span class="n">iq_est</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">wait_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">phybw40</span><span class="p">;</span>
	<span class="n">phybw40</span> <span class="o">=</span> <span class="n">CHSPEC_IS40</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x410</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x482</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">num_samps</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x481</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">((</span><span class="n">u16</span><span class="p">)</span> <span class="n">wait_time</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x481</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x481</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x481</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">))</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wait_count</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">500</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">wait_count</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">iq_est</span><span class="o">-&gt;</span><span class="n">iq_prod</span> <span class="o">=</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x483</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
			  <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x484</span><span class="p">);</span>
	<span class="n">iq_est</span><span class="o">-&gt;</span><span class="n">i_pwr</span> <span class="o">=</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x485</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x486</span><span class="p">);</span>
	<span class="n">iq_est</span><span class="o">-&gt;</span><span class="n">q_pwr</span> <span class="o">=</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x487</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x488</span><span class="p">);</span>

<span class="nl">cleanup:</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x410</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wlc_lcnphy_calc_rx_iq_comp</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">num_samps</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define LCNPHY_MIN_RXIQ_PWR 2</span>
	<span class="n">bool</span> <span class="n">result</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">a0_new</span><span class="p">,</span> <span class="n">b0_new</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_iq_est</span> <span class="n">iq_est</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">s32</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">iq_nbits</span><span class="p">,</span> <span class="n">qq_nbits</span><span class="p">,</span> <span class="n">arsh</span><span class="p">,</span> <span class="n">brsh</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">iq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ii</span><span class="p">,</span> <span class="n">qq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">a0_new</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x645</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">b0_new</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x646</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x64b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_rx_iq_comp</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">wlc_lcnphy_rx_iq_est</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iq_est</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>

	<span class="n">iq</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="n">iq_est</span><span class="p">.</span><span class="n">iq_prod</span><span class="p">;</span>
	<span class="n">ii</span> <span class="o">=</span> <span class="n">iq_est</span><span class="p">.</span><span class="n">i_pwr</span><span class="p">;</span>
	<span class="n">qq</span> <span class="o">=</span> <span class="n">iq_est</span><span class="p">.</span><span class="n">q_pwr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">ii</span> <span class="o">+</span> <span class="n">qq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">LCNPHY_MIN_RXIQ_PWR</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">iq_nbits</span> <span class="o">=</span> <span class="n">wlc_phy_nbits</span><span class="p">(</span><span class="n">iq</span><span class="p">);</span>
	<span class="n">qq_nbits</span> <span class="o">=</span> <span class="n">wlc_phy_nbits</span><span class="p">(</span><span class="n">qq</span><span class="p">);</span>

	<span class="n">arsh</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">-</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">iq_nbits</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">arsh</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">iq</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">iq_nbits</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">arsh</span><span class="p">)));</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&gt;&gt;</span> <span class="n">arsh</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">iq</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">30</span> <span class="o">-</span> <span class="n">iq_nbits</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">arsh</span><span class="p">)));</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">arsh</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">a</span> <span class="o">/=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">brsh</span> <span class="o">=</span> <span class="n">qq_nbits</span> <span class="o">-</span> <span class="mi">31</span> <span class="o">+</span> <span class="mi">20</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">brsh</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">qq</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">31</span> <span class="o">-</span> <span class="n">qq_nbits</span><span class="p">));</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&gt;&gt;</span> <span class="n">brsh</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">qq</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="mi">31</span> <span class="o">-</span> <span class="n">qq_nbits</span><span class="p">));</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">ii</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="n">brsh</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">b</span> <span class="o">/=</span> <span class="n">temp</span><span class="p">;</span>
	<span class="n">b</span> <span class="o">-=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="n">int_sqrt</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">b</span><span class="p">);</span>
	<span class="n">b</span> <span class="o">-=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">a0_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
	<span class="n">b0_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
<span class="nl">cleanup:</span>

	<span class="n">wlc_lcnphy_set_rx_iq_comp</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">a0_new</span><span class="p">,</span> <span class="n">b0_new</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x64b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x64b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">rxiqcal_coeff_a0</span> <span class="o">=</span> <span class="n">a0_new</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">rxiqcal_coeff_b0</span> <span class="o">=</span> <span class="n">b0_new</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">wlc_lcnphy_measure_digital_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">nsamples</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lcnphy_iq_est</span> <span class="n">iq_est</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_lcnphy_rx_iq_est</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iq_est</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">iq_est</span><span class="p">.</span><span class="n">i_pwr</span> <span class="o">+</span> <span class="n">iq_est</span><span class="p">.</span><span class="n">q_pwr</span><span class="p">)</span> <span class="o">/</span> <span class="n">nsamples</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span>
<span class="nf">wlc_lcnphy_rx_iq_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_rx_iqcomp</span> <span class="o">*</span><span class="n">iqcomp</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">iqcomp_sz</span><span class="p">,</span> <span class="n">bool</span> <span class="n">tx_switch</span><span class="p">,</span> <span class="n">bool</span> <span class="n">rx_switch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">module</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">tx_gain_idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">old_gains</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_pwr_ctrl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tx_gain_index_old</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="n">tx_gain_override_old</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">i</span><span class="p">,</span> <span class="n">Core1TxControl_old</span><span class="p">,</span> <span class="n">RFOverride0_old</span><span class="p">,</span>
	    <span class="n">RFOverrideVal0_old</span><span class="p">,</span> <span class="n">rfoverride2_old</span><span class="p">,</span> <span class="n">rfoverride2val_old</span><span class="p">,</span>
	    <span class="n">rfoverride3_old</span><span class="p">,</span> <span class="n">rfoverride3val_old</span><span class="p">,</span> <span class="n">rfoverride4_old</span><span class="p">,</span>
	    <span class="n">rfoverride4val_old</span><span class="p">,</span> <span class="n">afectrlovr_old</span><span class="p">,</span> <span class="n">afectrlovrval_old</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tia_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">received_power</span><span class="p">,</span> <span class="n">rx_pwr_threshold</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">old_sslpnCalibClkEnCtrl</span><span class="p">,</span> <span class="n">old_sslpnRxFeClkEnCtrl</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">values_to_save</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
	<span class="n">s16</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">ptr</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">131</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">ptr</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">module</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">iqcomp_sz</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">iqcomp</span><span class="p">[</span><span class="n">iqcomp_sz</span><span class="p">].</span><span class="n">chan</span> <span class="o">==</span>
			    <span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">wlc_lcnphy_set_rx_iq_comp</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
							  <span class="p">(</span><span class="n">u16</span><span class="p">)</span>
							  <span class="n">iqcomp</span><span class="p">[</span><span class="n">iqcomp_sz</span><span class="p">].</span><span class="n">a</span><span class="p">,</span>
							  <span class="p">(</span><span class="n">u16</span><span class="p">)</span>
							  <span class="n">iqcomp</span><span class="p">[</span><span class="n">iqcomp_sz</span><span class="p">].</span><span class="n">b</span><span class="p">);</span>
				<span class="n">result</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">goto</span> <span class="n">cal_done</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">module</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">tx_pwr_ctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">rxiq_cal_rf_reg</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">Core1TxControl_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x631</span><span class="p">);</span>

		<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x631</span><span class="p">,</span> <span class="mh">0x0015</span><span class="p">);</span>

		<span class="n">RFOverride0_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">);</span>
		<span class="n">RFOverrideVal0_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">);</span>
		<span class="n">rfoverride2_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">);</span>
		<span class="n">rfoverride2val_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">);</span>
		<span class="n">rfoverride3_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">);</span>
		<span class="n">rfoverride3val_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">);</span>
		<span class="n">rfoverride4_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">);</span>
		<span class="n">rfoverride4val_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">);</span>
		<span class="n">afectrlovr_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">);</span>
		<span class="n">afectrlovrval_old</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">);</span>
		<span class="n">old_sslpnCalibClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">);</span>
		<span class="n">old_sslpnRxFeClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">);</span>

		<span class="n">tx_gain_override_old</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tx_gain_override_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tx_gain_override_old</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>
			<span class="n">tx_gain_index_old</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_gain_idx</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG116</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG12C</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG06A</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG098</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG00B</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG113</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG01D</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG114</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG02E</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG12A</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_start_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>
		<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_trsw_override</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_switch</span><span class="p">,</span> <span class="n">rx_switch</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_rx_gain_override_enable</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

		<span class="n">tia_gain</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">rx_pwr_threshold</span> <span class="o">=</span> <span class="mi">950</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">tia_gain</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tia_gain</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">wlc_lcnphy_set_rx_gain_by_distribution</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
							       <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
							       <span class="p">(</span><span class="n">u16</span><span class="p">)</span>
							       <span class="n">tia_gain</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

			<span class="n">received_power</span> <span class="o">=</span>
				<span class="n">wlc_lcnphy_measure_digital_power</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">received_power</span> <span class="o">&lt;</span> <span class="n">rx_pwr_threshold</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_rx_iq_comp</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_stop_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x631</span><span class="p">,</span> <span class="n">Core1TxControl_old</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="n">RFOverrideVal0_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="n">RFOverrideVal0_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="n">rfoverride2_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="n">rfoverride2val_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="n">rfoverride3_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="n">rfoverride3val_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="n">rfoverride4_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="n">rfoverride4val_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="n">afectrlovr_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="n">afectrlovrval_old</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="n">old_sslpnCalibClkEnCtrl</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="n">old_sslpnRxFeClkEnCtrl</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_clear_trsw_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">rxiq_cal_rf_reg</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					<span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">tx_gain_override_old</span><span class="p">)</span>
			<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_gain_index_old</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">wlc_lcnphy_disable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_pwr_ctrl</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_rx_gain_override_enable</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">cal_done:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">s8</span> <span class="nf">wlc_lcnphy_get_current_tx_pwr_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">txpwrctrl_off</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="n">index</span> <span class="o">=</span>	<span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="p">(</span><span class="n">wlc_lcnphy_get_current_tx_pwr_idx_if_pwrctrl_on</span><span class="p">(</span>
			      <span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">index</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_crsuprs</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">afectrlovr</span><span class="p">,</span> <span class="n">afectrlovrval</span><span class="p">;</span>
	<span class="n">afectrlovr</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">);</span>
	<span class="n">afectrlovrval</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44b</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_tx_pu</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x634</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0x0080</span><span class="p">);</span>

		<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x00a</span><span class="p">,</span> <span class="mh">0x228</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x00a</span><span class="p">,</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x228</span><span class="p">));</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0xFF7F</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="n">afectrlovr</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="n">afectrlovrval</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_toggle_afe_pwdn</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">save_AfeCtrlOvrVal</span><span class="p">,</span> <span class="n">save_AfeCtrlOvr</span><span class="p">;</span>

	<span class="n">save_AfeCtrlOvrVal</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">);</span>
	<span class="n">save_AfeCtrlOvr</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="n">save_AfeCtrlOvrVal</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="n">save_AfeCtrlOvr</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="n">save_AfeCtrlOvrVal</span> <span class="o">&amp;</span> <span class="mh">0xfffe</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="n">save_AfeCtrlOvr</span> <span class="o">&amp;</span> <span class="mh">0xfffe</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="n">save_AfeCtrlOvrVal</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="n">save_AfeCtrlOvr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_txrx_spur_avoidance_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93b</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">23</span><span class="p">));</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93c</span><span class="p">,</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1989</span><span class="p">));</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x084</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d3</span><span class="p">,</span> <span class="mh">0x2222</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d3</span><span class="p">,</span> <span class="mh">0x2220</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93b</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">23</span><span class="p">));</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93c</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1989</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="n">wlapi_switch_macfreq</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_set_chanspec_tweaks</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">chanspec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">chanspec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_bandedge_corr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_bandedge_corr</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">||</span>
	    <span class="n">channel</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">||</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">9</span> <span class="o">||</span>
	    <span class="n">channel</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">11</span> <span class="o">||</span> <span class="n">channel</span> <span class="o">==</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x03000c04</span><span class="p">);</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x200005c0</span><span class="p">);</span>

		<span class="n">si_pmu_pllupd</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_txrx_spur_avoidance_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_spurmod</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x424</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1b</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x425</span><span class="p">,</span> <span class="mh">0x5907</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x03140c04</span><span class="p">);</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mh">0x333333</span><span class="p">);</span>
		<span class="n">si_pmu_pllcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x202c2820</span><span class="p">);</span>

		<span class="n">si_pmu_pllupd</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_txrx_spur_avoidance_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_spurmod</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x424</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x425</span><span class="p">,</span> <span class="mh">0x590a</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_radio_2064_channel_tune_4313</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uint</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">chan_info_2064_lcnphy</span> <span class="o">*</span><span class="n">ci</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rfpll_doubler</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pll_pwrup</span><span class="p">,</span> <span class="n">pll_pwrup_ovr</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">qFxtal</span><span class="p">,</span> <span class="n">qFref</span><span class="p">,</span> <span class="n">qFvco</span><span class="p">,</span> <span class="n">qFcal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">d15</span><span class="p">,</span> <span class="n">d16</span><span class="p">,</span> <span class="n">f16</span><span class="p">,</span> <span class="n">e44</span><span class="p">,</span> <span class="n">e45</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">div_int</span><span class="p">,</span> <span class="n">div_frac</span><span class="p">,</span> <span class="n">fvco3</span><span class="p">,</span> <span class="n">fpfd</span><span class="p">,</span> <span class="n">fref3</span><span class="p">,</span> <span class="n">fcal_div</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">loop_bw</span><span class="p">,</span> <span class="n">d30</span><span class="p">,</span> <span class="n">setCount</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">h29</span><span class="p">,</span> <span class="n">h28_ten</span><span class="p">,</span> <span class="n">e30</span><span class="p">,</span> <span class="n">h30_ten</span><span class="p">,</span> <span class="n">cp_current</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">g30</span><span class="p">,</span> <span class="n">d28</span><span class="p">;</span>

	<span class="n">ci</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chan_info_2064_lcnphy</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">rfpll_doubler</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG09D</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG09E</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rfpll_doubler</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">loop_bw</span> <span class="o">=</span> <span class="n">PLL_2064_LOOP_BW</span><span class="p">;</span>
		<span class="n">d30</span> <span class="o">=</span> <span class="n">PLL_2064_D30</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">loop_bw</span> <span class="o">=</span> <span class="n">PLL_2064_LOOP_BW_DOUBLER</span><span class="p">;</span>
		<span class="n">d30</span> <span class="o">=</span> <span class="n">PLL_2064_D30_DOUBLER</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">chan_info_2064_lcnphy</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">chan_info_2064_lcnphy</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">chan</span> <span class="o">==</span> <span class="n">channel</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">chan_info_2064_lcnphy</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span>

		<span class="n">ci</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chan_info_2064_lcnphy</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG02A</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">logen_buftune</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG030</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">logen_rccr_tx</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG091</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">txrf_mix_tune_ctrl</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG038</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">pa_input_tune_g</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG030</span><span class="p">,</span> <span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
		      <span class="p">(</span><span class="n">ci</span><span class="o">-&gt;</span><span class="n">logen_rccr_rx</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05E</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">pa_rxrf_lna1_freq_tune</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05E</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span>
		      <span class="p">(</span><span class="n">ci</span><span class="o">-&gt;</span><span class="n">pa_rxrf_lna2_freq_tune</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG06C</span><span class="p">,</span> <span class="n">ci</span><span class="o">-&gt;</span><span class="n">rxrf_rxrf_spare1</span><span class="p">);</span>

	<span class="n">pll_pwrup</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG044</span><span class="p">);</span>
	<span class="n">pll_pwrup_ovr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG12B</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG044</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG12B</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x07</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">e44</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">e45</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">fpfd</span> <span class="o">=</span> <span class="n">rfpll_doubler</span> <span class="o">?</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">&gt;</span> <span class="mi">26000000</span><span class="p">)</span>
		<span class="n">e44</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">&gt;</span> <span class="mi">52000000</span><span class="p">)</span>
		<span class="n">e45</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">e44</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">fcal_div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">e45</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">fcal_div</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">fcal_div</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">fvco3</span> <span class="o">=</span> <span class="p">(</span><span class="n">ci</span><span class="o">-&gt;</span><span class="n">freq</span> <span class="o">*</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">fref3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fpfd</span><span class="p">;</span>

	<span class="n">qFxtal</span> <span class="o">=</span> <span class="n">wlc_lcnphy_qdiv_roundup</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span><span class="p">,</span> <span class="n">PLL_2064_MHZ</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">qFref</span> <span class="o">=</span> <span class="n">wlc_lcnphy_qdiv_roundup</span><span class="p">(</span><span class="n">fpfd</span><span class="p">,</span> <span class="n">PLL_2064_MHZ</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">qFcal</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">*</span> <span class="n">fcal_div</span> <span class="o">/</span> <span class="n">PLL_2064_MHZ</span><span class="p">;</span>
	<span class="n">qFvco</span> <span class="o">=</span> <span class="n">wlc_lcnphy_qdiv_roundup</span><span class="p">(</span><span class="n">fvco3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG04F</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>

	<span class="n">d15</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">*</span> <span class="n">fcal_div</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="n">PLL_2064_MHZ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG052</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x07</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d15</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)));</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG053</span><span class="p">,</span> <span class="p">(</span><span class="n">d15</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">d16</span> <span class="o">=</span> <span class="p">(</span><span class="n">qFcal</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="p">(</span><span class="n">d15</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG051</span><span class="p">,</span> <span class="n">d16</span><span class="p">);</span>

	<span class="n">f16</span> <span class="o">=</span> <span class="p">((</span><span class="n">d16</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">d15</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">qFcal</span><span class="p">;</span>
	<span class="n">setCount</span> <span class="o">=</span> <span class="n">f16</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">ci</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">)</span> <span class="o">/</span> <span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG053</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x0f</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		      <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">setCount</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">));</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG053</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG054</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">setCount</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>

	<span class="n">div_int</span> <span class="o">=</span> <span class="p">((</span><span class="n">fvco3</span> <span class="o">*</span> <span class="p">(</span><span class="n">PLL_2064_MHZ</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">/</span> <span class="n">fref3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">div_frac</span> <span class="o">=</span> <span class="p">((</span><span class="n">fvco3</span> <span class="o">*</span> <span class="p">(</span><span class="n">PLL_2064_MHZ</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">))</span> <span class="o">%</span> <span class="n">fref3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">div_frac</span> <span class="o">&gt;=</span> <span class="n">fref3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">div_int</span><span class="o">++</span><span class="p">;</span>
		<span class="n">div_frac</span> <span class="o">-=</span> <span class="n">fref3</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">div_frac</span> <span class="o">=</span> <span class="n">wlc_lcnphy_qdiv_roundup</span><span class="p">(</span><span class="n">div_frac</span><span class="p">,</span> <span class="n">fref3</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG045</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		      <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">div_int</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">));</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG046</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span>
		      <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">div_int</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG046</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x0f</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		      <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">div_frac</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG047</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">(</span><span class="n">div_frac</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG048</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">div_frac</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG040</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG041</span><span class="p">,</span> <span class="mh">0x9A</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG042</span><span class="p">,</span> <span class="mh">0xA3</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG043</span><span class="p">,</span> <span class="mh">0x0C</span><span class="p">);</span>

	<span class="n">h29</span> <span class="o">=</span> <span class="n">LCN_BW_LMT</span> <span class="o">/</span> <span class="n">loop_bw</span><span class="p">;</span>
	<span class="n">d28</span> <span class="o">=</span> <span class="p">(((</span><span class="n">PLL_2064_HIGH_END_KVCO</span> <span class="o">-</span> <span class="n">PLL_2064_LOW_END_KVCO</span><span class="p">)</span> <span class="o">*</span>
		<span class="p">(</span><span class="n">fvco3</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">PLL_2064_LOW_END_VCO</span><span class="p">))</span> <span class="o">/</span>
	       <span class="p">(</span><span class="n">PLL_2064_HIGH_END_VCO</span> <span class="o">-</span> <span class="n">PLL_2064_LOW_END_VCO</span><span class="p">))</span>
	      <span class="o">+</span> <span class="n">PLL_2064_LOW_END_KVCO</span><span class="p">;</span>
	<span class="n">h28_ten</span> <span class="o">=</span> <span class="p">(</span><span class="n">d28</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="n">LCN_VCO_DIV</span><span class="p">;</span>
	<span class="n">e30</span> <span class="o">=</span> <span class="p">(</span><span class="n">d30</span> <span class="o">-</span> <span class="n">LCN_OFFSET</span><span class="p">)</span> <span class="o">/</span> <span class="n">LCN_FACT</span><span class="p">;</span>
	<span class="n">g30</span> <span class="o">=</span> <span class="n">LCN_OFFSET</span> <span class="o">+</span> <span class="p">(</span><span class="n">e30</span> <span class="o">*</span> <span class="n">LCN_FACT</span><span class="p">);</span>
	<span class="n">h30_ten</span> <span class="o">=</span> <span class="p">(</span><span class="n">g30</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="n">LCN_CUR_DIV</span><span class="p">;</span>
	<span class="n">cp_current</span> <span class="o">=</span> <span class="p">((</span><span class="n">LCN_CUR_LMT</span> <span class="o">*</span> <span class="n">h29</span> <span class="o">*</span> <span class="n">LCN_MULT</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="n">h28_ten</span><span class="p">)</span> <span class="o">/</span> <span class="n">h30_ten</span><span class="p">;</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03C</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="n">cp_current</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">channel</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">)</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03C</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03C</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03D</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG044</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="n">wlc_2064_vco_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG044</span><span class="p">,</span> <span class="n">pll_pwrup</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG12B</span><span class="p">,</span> <span class="n">pll_pwrup_ovr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG038</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG091</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">wlc_lcnphy_load_tx_iir_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">is_ofdm</span><span class="p">,</span> <span class="n">s16</span> <span class="n">filt_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s16</span> <span class="n">filt_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">j</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">addr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x910</span><span class="p">,</span>
		<span class="mh">0x91e</span><span class="p">,</span>
		<span class="mh">0x91f</span><span class="p">,</span>
		<span class="mh">0x924</span><span class="p">,</span>
		<span class="mh">0x925</span><span class="p">,</span>
		<span class="mh">0x926</span><span class="p">,</span>
		<span class="mh">0x920</span><span class="p">,</span>
		<span class="mh">0x921</span><span class="p">,</span>
		<span class="mh">0x927</span><span class="p">,</span>
		<span class="mh">0x928</span><span class="p">,</span>
		<span class="mh">0x929</span><span class="p">,</span>
		<span class="mh">0x922</span><span class="p">,</span>
		<span class="mh">0x923</span><span class="p">,</span>
		<span class="mh">0x930</span><span class="p">,</span>
		<span class="mh">0x931</span><span class="p">,</span>
		<span class="mh">0x932</span>
	<span class="p">};</span>

	<span class="n">u16</span> <span class="n">addr_ofdm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x90f</span><span class="p">,</span>
		<span class="mh">0x900</span><span class="p">,</span>
		<span class="mh">0x901</span><span class="p">,</span>
		<span class="mh">0x906</span><span class="p">,</span>
		<span class="mh">0x907</span><span class="p">,</span>
		<span class="mh">0x908</span><span class="p">,</span>
		<span class="mh">0x902</span><span class="p">,</span>
		<span class="mh">0x903</span><span class="p">,</span>
		<span class="mh">0x909</span><span class="p">,</span>
		<span class="mh">0x90a</span><span class="p">,</span>
		<span class="mh">0x90b</span><span class="p">,</span>
		<span class="mh">0x904</span><span class="p">,</span>
		<span class="mh">0x905</span><span class="p">,</span>
		<span class="mh">0x90c</span><span class="p">,</span>
		<span class="mh">0x90d</span><span class="p">,</span>
		<span class="mh">0x90e</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_ofdm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LCNPHY_NUM_TX_DIG_FILTERS_CCK</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">filt_type</span> <span class="o">==</span> <span class="n">LCNPHY_txdigfiltcoeffs_cck</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
				<span class="n">filt_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">j</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">filt_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LCNPHY_NUM_DIG_FILT_COEFFS</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">addr</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
					      <span class="n">LCNPHY_txdigfiltcoeffs_cck</span>
					      <span class="p">[</span><span class="n">filt_index</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LCNPHY_NUM_TX_DIG_FILTERS_OFDM</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">filt_type</span> <span class="o">==</span> <span class="n">LCNPHY_txdigfiltcoeffs_ofdm</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
				<span class="n">filt_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">j</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">filt_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">LCNPHY_NUM_DIG_FILT_COEFFS</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">addr_ofdm</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
					      <span class="n">LCNPHY_txdigfiltcoeffs_ofdm</span>
					      <span class="p">[</span><span class="n">filt_index</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">filt_index</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_phy_chanspec_set_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">chanspec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">chanspec</span><span class="p">);</span>

	<span class="n">wlc_phy_chanspec_radio_set</span><span class="p">((</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">,</span> <span class="n">chanspec</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_chanspec_tweaks</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_radio_2064_channel_tune_4313</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">channel</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_toggle_afe_pwdn</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x657</span><span class="p">,</span> <span class="n">lcnphy_sfo_cfg</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">ptcentreTs20</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x658</span><span class="p">,</span> <span class="n">lcnphy_sfo_cfg</span><span class="p">[</span><span class="n">channel</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">ptcentreFactor</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_load_tx_iir_filter</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_load_tx_iir_filter</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_load_tx_iir_filter</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4eb</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">wlc_lcnphy_get_pa_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">pa_gain</span><span class="p">;</span>

	<span class="n">pa_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fb</span><span class="p">)</span> <span class="o">&amp;</span>
		   <span class="n">LCNPHY_txgainctrlovrval1_pagain_ovr_val1_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
		  <span class="n">LCNPHY_txgainctrlovrval1_pagain_ovr_val1_SHIFT</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">pa_gain</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="o">*</span><span class="n">target_gains</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">pa_gain</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_pa_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span>
		<span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b5</span><span class="p">,</span>
		<span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		<span class="p">((</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">gm_gain</span><span class="p">)</span> <span class="o">|</span>
		 <span class="p">(</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pga_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&lt;&lt;</span>
		<span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fb</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x7fff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		    <span class="p">((</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pad_gain</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pa_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span>
		<span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fc</span><span class="p">,</span>
		<span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		<span class="p">((</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">gm_gain</span><span class="p">)</span> <span class="o">|</span>
		 <span class="p">(</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pga_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&lt;&lt;</span>
		<span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fd</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x7fff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
		    <span class="p">((</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pad_gain</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pa_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_dac_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">dac_gain</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_enable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_bbmult</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u8</span> <span class="n">m0</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">m0m1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">m0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m0m1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">87</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_clear_tx_power_offsets</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">data_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">data_buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">data_buf</span><span class="p">));</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">data_buf</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_RATE_OFFSET</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_MAC_OFFSET</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">lcnphy_tssi_mode</span> <span class="p">{</span>
	<span class="n">LCNPHY_TSSI_PRE_PA</span><span class="p">,</span>
	<span class="n">LCNPHY_TSSI_POST_PA</span><span class="p">,</span>
	<span class="n">LCNPHY_TSSI_EXT</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_set_tssi_mux</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="k">enum</span> <span class="n">lcnphy_tssi_mode</span> <span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNPHY_TSSI_POST_PA</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG086</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG086</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x637</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNPHY_TSSI_EXT</span> <span class="o">==</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG07F</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">wlc_lcnphy_rfseq_tbl_adc_pwrup</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">N3</span><span class="p">,</span> <span class="n">N4</span><span class="p">,</span> <span class="n">N5</span><span class="p">,</span> <span class="n">N6</span><span class="p">,</span> <span class="n">N</span><span class="p">;</span>
	<span class="n">N1</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
	      <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">N2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">))</span>
		   <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">N3</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
	      <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">N4</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span>
		   <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">N5</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
	      <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">N6</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span>
		   <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">N1</span> <span class="o">+</span> <span class="n">N2</span> <span class="o">+</span> <span class="n">N3</span> <span class="o">+</span> <span class="n">N4</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">N5</span> <span class="o">+</span> <span class="n">N6</span><span class="p">))</span> <span class="o">+</span> <span class="mi">80</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;</span> <span class="mi">1600</span><span class="p">)</span>
		<span class="n">N</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">N</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_pwrctrl_rssiparams</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">auxpga_vmid</span><span class="p">,</span> <span class="n">auxpga_vmid_temp</span><span class="p">,</span> <span class="n">auxpga_gain_temp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">auxpga_vmid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
		      <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf</span><span class="p">;</span>
	<span class="n">auxpga_vmid_temp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">8</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">auxpga_gain_temp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4db</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">auxpga_vmid</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4dc</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">auxpga_vmid</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40a</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">auxpga_vmid</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40b</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">auxpga_vmid_temp</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">auxpga_gain_temp</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40c</span><span class="p">,</span>
		    <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">auxpga_vmid_temp</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">auxpga_gain_temp</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG082</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_tssi_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rfseq</span><span class="p">,</span> <span class="n">ind</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ind</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">ind</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">704</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ind</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ind</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">ind</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tssi_mux</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TSSI_EXT</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_clear_tx_power_offsets</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x49a</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG086</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG025</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span>
			    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">rfseq</span> <span class="o">=</span> <span class="n">wlc_lcnphy_rfseq_tbl_adc_pwrup</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_RFSEQ</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rfseq</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_pwrctrl_rssiparams</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_tx_pwr_update_npt</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tx_cnt</span><span class="p">,</span> <span class="n">tx_total</span><span class="p">,</span> <span class="n">npt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">tx_total</span> <span class="o">=</span> <span class="n">wlc_lcnphy_total_tx_frames</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">tx_cnt</span> <span class="o">=</span> <span class="n">tx_total</span> <span class="o">-</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_tx_cnt</span><span class="p">;</span>
	<span class="n">npt</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_npt</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tx_cnt</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">npt</span><span class="p">))</span> <span class="p">{</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_tx_cnt</span> <span class="o">=</span> <span class="n">tx_total</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_idx</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_current_tx_pwr_idx</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_npt</span> <span class="o">=</span> <span class="n">npt</span><span class="p">;</span>

	<span class="p">}</span>
<span class="p">}</span>

<span class="n">s32</span> <span class="nf">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="n">s32</span> <span class="n">tssi</span><span class="p">,</span> <span class="n">s32</span> <span class="n">a1</span><span class="p">,</span> <span class="n">s32</span> <span class="n">b0</span><span class="p">,</span> <span class="n">s32</span> <span class="n">b1</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s32</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">;</span>

	<span class="n">a</span> <span class="o">=</span> <span class="mi">32768</span> <span class="o">+</span> <span class="p">(</span><span class="n">a1</span> <span class="o">*</span> <span class="n">tssi</span><span class="p">);</span>
	<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="n">b0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">64</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">tssi</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_txpower_reset_npt</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_idx</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_START_INDEX_2G_4313</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_npt</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_START_NPT</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_txpower_recalc_target</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rate_table</span><span class="p">[</span><span class="n">BRCMS_NUM_RATES_CCK</span> <span class="o">+</span> <span class="n">BRCMS_NUM_RATES_OFDM</span> <span class="o">+</span>
		       <span class="n">BRCMS_NUM_RATES_MCS_1_STREAM</span><span class="p">];</span>
	<span class="n">uint</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rate_table</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">BRCMS_NUM_RATES_CCK</span> <span class="o">+</span> <span class="n">BRCMS_NUM_RATES_OFDM</span><span class="p">)</span>
			<span class="n">j</span> <span class="o">=</span> <span class="n">TXP_FIRST_MCS_20_SISO</span><span class="p">;</span>

		<span class="n">rate_table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="p">((</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_offset</span><span class="p">[</span><span class="n">j</span><span class="p">]));</span>
	<span class="p">}</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rate_table</span><span class="p">);</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">rate_table</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_RATE_OFFSET</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_get_target_tx_pwr</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_min</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_set_target_tx_pwr</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_min</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_txpower_reset_npt</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_pwr_soft_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">s8</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">cck_offset</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">22</span> <span class="p">};</span>
	<span class="n">u32</span> <span class="n">ofdm_offset</span><span class="p">,</span> <span class="n">reg_offset_cck</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">index2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0x0040</span><span class="p">);</span>

	<span class="n">reg_offset_cck</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">cck_offset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-=</span> <span class="n">reg_offset_cck</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">cck_offset</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_RATE_OFFSET</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="n">ofdm_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ofdm_offset</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">836</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">862</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">index2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">index2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6a3</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="n">s8</span> <span class="nf">wlc_lcnphy_tempcompensated_txpwrctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">,</span> <span class="n">delta_brd</span><span class="p">,</span> <span class="n">delta_temp</span><span class="p">,</span> <span class="n">new_index</span><span class="p">,</span> <span class="n">tempcorrx</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">manp</span><span class="p">,</span> <span class="n">meas_temp</span><span class="p">,</span> <span class="n">temp_diff</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">neg</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">temp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>

	<span class="n">index</span> <span class="o">=</span> <span class="n">FIXED_TXPWR</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_slope</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">index</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">wlc_lcnphy_tempsense</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">meas_temp</span> <span class="o">=</span> <span class="n">LCNPHY_TEMPSENSE</span><span class="p">(</span><span class="n">temp</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_min</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">delta_brd</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_measPower</span> <span class="o">-</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_min</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">delta_brd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">manp</span> <span class="o">=</span> <span class="n">LCNPHY_TEMPSENSE</span><span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rawtempsense</span><span class="p">);</span>
	<span class="n">temp_diff</span> <span class="o">=</span> <span class="n">manp</span> <span class="o">-</span> <span class="n">meas_temp</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">temp_diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">neg</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">temp_diff</span> <span class="o">=</span> <span class="o">-</span><span class="n">temp_diff</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">delta_temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">wlc_lcnphy_qdiv_roundup</span><span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="n">temp_diff</span> <span class="o">*</span> <span class="mi">192</span><span class="p">),</span>
						  <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span>
							 <span class="n">lcnphy_tempsense_slope</span>
							 <span class="o">*</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">neg</span><span class="p">)</span>
		<span class="n">delta_temp</span> <span class="o">=</span> <span class="o">-</span><span class="n">delta_temp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_option</span> <span class="o">==</span> <span class="mi">3</span>
	    <span class="o">&amp;&amp;</span> <span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
		<span class="n">delta_temp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempcorrx</span> <span class="o">&gt;</span> <span class="mi">31</span><span class="p">)</span>
		<span class="n">tempcorrx</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempcorrx</span> <span class="o">-</span> <span class="mi">64</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">tempcorrx</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempcorrx</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">tempcorrx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">new_index</span> <span class="o">=</span>
		<span class="n">index</span> <span class="o">+</span> <span class="n">delta_brd</span> <span class="o">+</span> <span class="n">delta_temp</span> <span class="o">-</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_bandedge_corr</span><span class="p">;</span>
	<span class="n">new_index</span> <span class="o">+=</span> <span class="n">tempcorrx</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">index</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">new_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">new_index</span> <span class="o">&gt;</span> <span class="mi">126</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">index</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">new_index</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">wlc_lcnphy_set_tx_pwr_ctrl_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u16</span> <span class="n">current_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">mode</span> <span class="o">==</span> <span class="n">LCNPHY_TX_PWR_CTRL_HW</span><span class="p">)</span>
		<span class="n">current_mode</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_TEMPBASED</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">mode</span> <span class="o">==</span> <span class="n">LCNPHY_TX_PWR_CTRL_TEMPBASED</span><span class="p">)</span>
		<span class="n">current_mode</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_HW</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">current_mode</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">old_mode</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">mode</span> <span class="o">=</span> <span class="n">wlc_lcnphy_set_tx_pwr_ctrl_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="n">old_mode</span> <span class="o">=</span> <span class="n">wlc_lcnphy_set_tx_pwr_ctrl_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">old_mode</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span>
		    <span class="p">((</span><span class="n">LCNPHY_TX_PWR_CTRL_HW</span> <span class="o">==</span> <span class="n">mode</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6a3</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span>
		    <span class="p">((</span><span class="n">LCNPHY_TX_PWR_CTRL_HW</span> <span class="o">==</span> <span class="n">mode</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">old_mode</span> <span class="o">!=</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">LCNPHY_TX_PWR_CTRL_HW</span> <span class="o">==</span> <span class="n">old_mode</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">wlc_lcnphy_tx_pwr_update_npt</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

			<span class="n">wlc_lcnphy_clear_tx_power_offsets</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">LCNPHY_TX_PWR_CTRL_HW</span> <span class="o">==</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">wlc_lcnphy_txpower_recalc_target</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

			<span class="n">wlc_lcnphy_set_start_tx_pwr_idx</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
							<span class="n">pi_lcn</span><span class="o">-&gt;</span>
							<span class="n">lcnphy_tssi_idx</span><span class="p">);</span>
			<span class="n">wlc_lcnphy_set_tx_pwr_npt</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_npt</span><span class="p">);</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

			<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_tx_cnt</span> <span class="o">=</span>
				<span class="n">wlc_lcnphy_total_tx_frames</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

			<span class="n">wlc_lcnphy_disable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
			<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tx_power_idx_override</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">wlc_lcnphy_enable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span>
			    <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)),</span> <span class="n">mode</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">LCNPHY_TX_PWR_CTRL_TEMPBASED</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">index</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tempcompensated_txpwrctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
			<span class="n">wlc_lcnphy_set_tx_pwr_soft_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
			<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span>
						       <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
								      <span class="mh">0x4a9</span><span class="p">)</span> <span class="o">&amp;</span>
							 <span class="mh">0xFF</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_tx_iqlo_loopback</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">values_to_save</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">vmid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">iqlo_loopback_rf_regs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
		<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0xFD</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0xF9</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG036</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11A</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG03A</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG025</span><span class="p">,</span> <span class="mh">0xF</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0xF</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0xF</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x4</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG028</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x6</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG00B</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG113</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">vmid</span> <span class="o">=</span> <span class="mh">0x2A6</span><span class="p">;</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FC</span><span class="p">,</span> <span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">vmid</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FD</span><span class="p">,</span> <span class="p">(</span><span class="n">vmid</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG012</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG036</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG059</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05C</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG078</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG092</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wlc_lcnphy_iqcal_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uint</span> <span class="n">delay_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">wlc_lcnphy_iqcal_active</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">delay_count</span><span class="o">++</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">delay_count</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="mi">500</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">wlc_lcnphy_iqcal_active</span><span class="p">(</span><span class="n">pi</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_tx_iqlo_loopback_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">values_to_save</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="mh">0x0</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">);</span>

	<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="mh">0xC</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">iqlo_loopback_rf_regs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
				<span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_tx_iqlo_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="o">*</span><span class="n">target_gains</span><span class="p">,</span>
		       <span class="k">enum</span> <span class="n">lcnphy_cal_mode</span> <span class="n">cal_mode</span><span class="p">,</span> <span class="n">bool</span> <span class="n">keep_tone</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">cal_gains</span><span class="p">,</span> <span class="n">temp_gains</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">hash</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">band_idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ncorr_override</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">syst_coeffs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span>
			      <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">};</span>

	<span class="n">u16</span> <span class="n">commands_fullcal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x8434</span><span class="p">,</span> <span class="mh">0x8334</span><span class="p">,</span> <span class="mh">0x8084</span><span class="p">,</span> <span class="mh">0x8267</span><span class="p">,</span> <span class="mh">0x8056</span><span class="p">,</span> <span class="mh">0x8234</span>
	<span class="p">};</span>

	<span class="n">u16</span> <span class="n">commands_recal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x8434</span><span class="p">,</span> <span class="mh">0x8334</span><span class="p">,</span> <span class="mh">0x8084</span><span class="p">,</span> <span class="mh">0x8267</span><span class="p">,</span> <span class="mh">0x8056</span><span class="p">,</span> <span class="mh">0x8234</span>
	<span class="p">};</span>

	<span class="n">u16</span> <span class="n">command_nums_fullcal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a87</span><span class="p">,</span> <span class="mh">0x7a87</span><span class="p">,</span> <span class="mh">0x7b97</span>
	<span class="p">};</span>

	<span class="n">u16</span> <span class="n">command_nums_recal</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a97</span><span class="p">,</span> <span class="mh">0x7a87</span><span class="p">,</span> <span class="mh">0x7a87</span><span class="p">,</span> <span class="mh">0x7b97</span>
	<span class="p">};</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">command_nums</span> <span class="o">=</span> <span class="n">command_nums_fullcal</span><span class="p">;</span>

	<span class="n">u16</span> <span class="o">*</span><span class="n">start_coeffs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">cal_cmds</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cal_type</span><span class="p">,</span> <span class="n">diq_start</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_pwr_ctrl_old</span><span class="p">,</span> <span class="n">save_txpwrctrlrfctrl2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">save_sslpnCalibClkEnCtrl</span><span class="p">,</span> <span class="n">save_sslpnRxFeClkEnCtrl</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">tx_gain_override_old</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">old_gains</span><span class="p">;</span>
	<span class="n">uint</span> <span class="n">i</span><span class="p">,</span> <span class="n">n_cal_cmds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_cal_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">values_to_save</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">values_to_save</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">values_to_save</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">save_sslpnRxFeClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">);</span>
	<span class="n">save_sslpnCalibClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">cal_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">LCNPHY_CAL_FULL</span>:
		<span class="n">start_coeffs</span> <span class="o">=</span> <span class="n">syst_coeffs</span><span class="p">;</span>
		<span class="n">cal_cmds</span> <span class="o">=</span> <span class="n">commands_fullcal</span><span class="p">;</span>
		<span class="n">n_cal_cmds</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">commands_fullcal</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">LCNPHY_CAL_RECAL</span>:
		<span class="n">start_coeffs</span> <span class="o">=</span> <span class="n">syst_coeffs</span><span class="p">;</span>
		<span class="n">cal_cmds</span> <span class="o">=</span> <span class="n">commands_recal</span><span class="p">;</span>
		<span class="n">n_cal_cmds</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">commands_recal</span><span class="p">);</span>
		<span class="n">command_nums</span> <span class="o">=</span> <span class="n">command_nums_recal</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				      <span class="n">start_coeffs</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">tx_pwr_ctrl_old</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>

	<span class="n">save_txpwrctrlrfctrl2</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4db</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4db</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x2a6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4db</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_tx_iqlo_loopback</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">values_to_save</span><span class="p">);</span>

	<span class="n">tx_gain_override_old</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tx_gain_override_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tx_gain_override_old</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">target_gains</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tx_gain_override_old</span><span class="p">)</span>
			<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
						       <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tssi_idx</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temp_gains</span><span class="p">);</span>
		<span class="n">target_gains</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">temp_gains</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">hash</span> <span class="o">=</span> <span class="p">(</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">gm_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
	       <span class="p">(</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pga_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">target_gains</span><span class="o">-&gt;</span><span class="n">pad_gain</span><span class="p">);</span>

	<span class="n">band_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">cal_gains</span> <span class="o">=</span> <span class="o">*</span><span class="n">target_gains</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">ncorr_override</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ncorr_override</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">iqcal_gainparams_numgains_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">];</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hash</span> <span class="o">==</span> <span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">cal_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span>
				<span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">cal_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span>
				<span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">cal_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span>
				<span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">ncorr_override</span><span class="p">,</span>
			       <span class="o">&amp;</span><span class="n">tbl_iqcal_gainparams_lcnphy</span><span class="p">[</span><span class="n">band_idx</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
			       <span class="k">sizeof</span><span class="p">(</span><span class="n">ncorr_override</span><span class="p">));</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cal_gains</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x453</span><span class="p">,</span> <span class="mh">0xaa9</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93d</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				      <span class="n">lcnphy_iqcal_loft_gainladder</span><span class="p">,</span>
				      <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcnphy_iqcal_loft_gainladder</span><span class="p">),</span>
				      <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				      <span class="n">lcnphy_iqcal_ir_gainladder</span><span class="p">,</span>
				      <span class="n">ARRAY_SIZE</span><span class="p">(</span>
					      <span class="n">lcnphy_iqcal_ir_gainladder</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span>
				      <span class="mi">32</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_tx_tone_freq</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">wlc_lcnphy_stop_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_start_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3750</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_start_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3750</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">n_cal_start</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n_cal_cmds</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">zero_diq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">best_coeffs</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
		<span class="n">u16</span> <span class="n">command_num</span><span class="p">;</span>

		<span class="n">cal_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">cal_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0f00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>

		<span class="n">command_num</span> <span class="o">=</span> <span class="n">command_nums</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ncorr_override</span><span class="p">[</span><span class="n">cal_type</span><span class="p">])</span>
			<span class="n">command_num</span> <span class="o">=</span>
				<span class="n">ncorr_override</span><span class="p">[</span><span class="n">cal_type</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="p">(</span><span class="n">command_num</span> <span class="o">&amp;</span>
								 <span class="mh">0xff</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x452</span><span class="p">,</span> <span class="n">command_num</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">cal_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">wlc_lcnphy_common_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
						     <span class="o">&amp;</span><span class="n">diq_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">69</span><span class="p">);</span>

			<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
						      <span class="o">&amp;</span><span class="n">zero_diq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">69</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x451</span><span class="p">,</span> <span class="n">cal_cmds</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_lcnphy_iqcal_wait</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>

		<span class="n">wlc_lcnphy_common_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
					     <span class="n">best_coeffs</span><span class="p">,</span>
					     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">best_coeffs</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">96</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
					      <span class="n">best_coeffs</span><span class="p">,</span>
					      <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">best_coeffs</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">cal_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">==</span> <span class="mi">4</span><span class="p">))</span>
			<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
						      <span class="o">&amp;</span><span class="n">diq_start</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">69</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_common_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
					     <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span>
					     <span class="n">txiqlocal_bestcoeffs</span><span class="p">,</span>
					     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span>
							<span class="n">lcnphy_cal_results</span><span class="p">.</span>
							<span class="n">txiqlocal_bestcoeffs</span><span class="p">),</span>
					     <span class="mi">16</span><span class="p">,</span> <span class="mi">96</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_common_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				     <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span>
				     <span class="n">txiqlocal_bestcoeffs</span><span class="p">,</span>
				     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span>
						<span class="n">txiqlocal_bestcoeffs</span><span class="p">),</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">96</span><span class="p">);</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_bestcoeffs_valid</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span>
				      <span class="n">txiqlocal_bestcoeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">80</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_common_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span>
				      <span class="n">txiqlocal_bestcoeffs</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">85</span><span class="p">);</span>

<span class="nl">cleanup:</span>
	<span class="n">wlc_lcnphy_tx_iqlo_loopback_cleanup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">values_to_save</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">values_to_save</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">keep_tone</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_stop_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4db</span><span class="p">,</span> <span class="n">save_txpwrctrlrfctrl2</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x453</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tx_gain_override_old</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_pwr_ctrl_old</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="n">save_sslpnCalibClkEnCtrl</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="n">save_sslpnRxFeClkEnCtrl</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_idle_tssi_est</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="n">ppi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">suspend</span><span class="p">,</span> <span class="n">tx_gain_override_old</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">old_gains</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="p">)</span> <span class="n">ppi</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">idleTssi</span><span class="p">,</span> <span class="n">idleTssi0_2C</span><span class="p">,</span> <span class="n">idleTssi0_OB</span><span class="p">,</span> <span class="n">idleTssi0_regvalue_OB</span><span class="p">,</span>
	    <span class="n">idleTssi0_regvalue_2C</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_txpwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">SAVE_lpfgain</span> <span class="o">=</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">SAVE_jtag_bb_afe_switch</span> <span class="o">=</span>
		<span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_jtag_auxpga</span> <span class="o">=</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_iqadc_aux_en</span> <span class="o">=</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">idleTssi</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ab</span><span class="p">);</span>
	<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>

	<span class="n">tx_gain_override_old</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tx_gain_override_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_enable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">127</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_tssi_setup</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">wlc_phy_do_dummy_tx</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">OFF</span><span class="p">);</span>
	<span class="n">idleTssi</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ab</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
		    <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">idleTssi0_2C</span> <span class="o">=</span> <span class="p">((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x63e</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
			<span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">idleTssi0_2C</span> <span class="o">&gt;=</span> <span class="mi">256</span><span class="p">)</span>
		<span class="n">idleTssi0_OB</span> <span class="o">=</span> <span class="n">idleTssi0_2C</span> <span class="o">-</span> <span class="mi">256</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">idleTssi0_OB</span> <span class="o">=</span> <span class="n">idleTssi0_2C</span> <span class="o">+</span> <span class="mi">256</span><span class="p">;</span>

	<span class="n">idleTssi0_regvalue_OB</span> <span class="o">=</span> <span class="n">idleTssi0_OB</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idleTssi0_regvalue_OB</span> <span class="o">&gt;=</span> <span class="mi">256</span><span class="p">)</span>
		<span class="n">idleTssi0_regvalue_2C</span> <span class="o">=</span> <span class="n">idleTssi0_regvalue_OB</span> <span class="o">-</span> <span class="mi">256</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">idleTssi0_regvalue_2C</span> <span class="o">=</span> <span class="n">idleTssi0_regvalue_OB</span> <span class="o">+</span> <span class="mi">256</span><span class="p">;</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">idleTssi0_regvalue_2C</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tx_gain_override_old</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_txpwrctrl</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="n">SAVE_lpfgain</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">SAVE_jtag_bb_afe_switch</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">SAVE_jtag_auxpga</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">SAVE_iqadc_aux_en</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_vbat_temp_sense_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">suspend</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">save_txpwrCtrlEn</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">auxpga_vmidcourse</span><span class="p">,</span> <span class="n">auxpga_vmidfine</span><span class="p">,</span> <span class="n">auxpga_gain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">auxpga_vmid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">save_reg007</span><span class="p">,</span> <span class="n">save_reg0FF</span><span class="p">,</span> <span class="n">save_reg11F</span><span class="p">,</span> <span class="n">save_reg005</span><span class="p">,</span> <span class="n">save_reg025</span><span class="p">,</span>
	   <span class="n">save_reg112</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">values_to_save</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">999</span><span class="p">);</span>

	<span class="n">save_reg007</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">);</span>
	<span class="n">save_reg0FF</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">);</span>
	<span class="n">save_reg11F</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">);</span>
	<span class="n">save_reg005</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">);</span>
	<span class="n">save_reg025</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG025</span><span class="p">);</span>
	<span class="n">save_reg112</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tempsense_phy_regs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="n">save_txpwrCtrlEn</span> <span class="o">=</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">127</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x503</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a5</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x40d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a2</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG025</span><span class="p">,</span> <span class="mh">0xC</span><span class="p">);</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">,</span> <span class="mh">0x8</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x939</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">wlc_lcnphy_rfseq_tbl_adc_pwrup</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_RFSEQ</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">TEMPSENSE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

		<span class="n">auxpga_vmidcourse</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">auxpga_vmidfine</span> <span class="o">=</span> <span class="mh">0x4</span><span class="p">;</span>
		<span class="n">auxpga_gain</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG082</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

		<span class="n">auxpga_vmidcourse</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		<span class="n">auxpga_vmidfine</span> <span class="o">=</span> <span class="mh">0xa</span><span class="p">;</span>
		<span class="n">auxpga_gain</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">auxpga_vmid</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">auxpga_vmidcourse</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">auxpga_vmidfine</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">auxpga_vmid</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="p">(</span><span class="n">auxpga_gain</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">);</span>

	<span class="n">wlc_phy_do_dummy_tx</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">OFF</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tempsense_done</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG007</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg007</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0FF</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg0FF</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg11F</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG005</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg005</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG025</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg025</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">save_reg112</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">14</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">tempsense_phy_regs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values_to_save</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">index</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a4</span><span class="p">,</span> <span class="n">save_txpwrCtrlEn</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">999</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_tx_pwr_ctrl_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="n">ppi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">tx_gains</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bbmult</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">tssi</span><span class="p">,</span> <span class="n">pwr</span><span class="p">,</span> <span class="n">maxtargetpwr</span><span class="p">,</span> <span class="n">mintargetpwr</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">suspend</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="p">)</span> <span class="n">ppi</span><span class="p">;</span>

	<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl_capable</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="n">bbmult</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
			<span class="n">tx_gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="n">bbmult</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tx_gains</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_bbmult</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">bbmult</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_vbat_temp_sense_setup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">TEMPSENSE</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

		<span class="n">wlc_lcnphy_idle_tssi_est</span><span class="p">(</span><span class="n">ppi</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_clear_tx_power_offsets</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

		<span class="n">b0</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">b1</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">a1</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
		<span class="n">maxtargetpwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>
		<span class="n">mintargetpwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pwr</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">tssi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tssi</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">tssi</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="n">tssi</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>

			<span class="n">pwr</span> <span class="o">=</span> <span class="p">(</span><span class="n">pwr</span> <span class="o">&lt;</span> <span class="n">mintargetpwr</span><span class="p">)</span> <span class="o">?</span> <span class="n">mintargetpwr</span> <span class="o">:</span> <span class="n">pwr</span><span class="p">;</span>
			<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
			<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x410</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a8</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_set_target_tx_pwr</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCN_TARGET_PWR</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_HW</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u8</span> <span class="nf">wlc_lcnphy_get_bbmult</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">m0m1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">m0m1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">87</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">m0m1</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_pa_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fb</span><span class="p">,</span>
		    <span class="n">LCNPHY_txgainctrlovrval1_pagain_ovr_val1_MASK</span><span class="p">,</span>
		    <span class="n">gain</span> <span class="o">&lt;&lt;</span> <span class="n">LCNPHY_txgainctrlovrval1_pagain_ovr_val1_SHIFT</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fd</span><span class="p">,</span>
		    <span class="n">LCNPHY_stxtxgainctrlovrval1_pagain_ovr_val1_MASK</span><span class="p">,</span>
		    <span class="n">gain</span> <span class="o">&lt;&lt;</span> <span class="n">LCNPHY_stxtxgainctrlovrval1_pagain_ovr_val1_SHIFT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">wlc_lcnphy_get_radio_loft</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
			  <span class="n">u8</span> <span class="o">*</span><span class="n">ei0</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">eq0</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">fi0</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">fq0</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">ei0</span> <span class="o">=</span> <span class="n">LCNPHY_IQLOCC_READ</span><span class="p">(</span><span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG089</span><span class="p">));</span>
	<span class="o">*</span><span class="n">eq0</span> <span class="o">=</span> <span class="n">LCNPHY_IQLOCC_READ</span><span class="p">(</span><span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08A</span><span class="p">));</span>
	<span class="o">*</span><span class="n">fi0</span> <span class="o">=</span> <span class="n">LCNPHY_IQLOCC_READ</span><span class="p">(</span><span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08B</span><span class="p">));</span>
	<span class="o">*</span><span class="n">fq0</span> <span class="o">=</span> <span class="n">LCNPHY_IQLOCC_READ</span><span class="p">(</span><span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08C</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_iqcc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">iqcc</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">iqcc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">iqcc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">iqcc</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_locc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="n">didq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_IQLOCAL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">didq</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">bb_mult</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bbmultiqcomp</span><span class="p">,</span> <span class="n">txgain</span><span class="p">,</span> <span class="n">locoeffs</span><span class="p">,</span> <span class="n">rfpower</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">gains</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tx_power_idx_override</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">index</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_IQ_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bbmultiqcomp</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_GAIN_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">txgain</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">txgain</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">txgain</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">txgain</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">bbmultiqcomp</span> <span class="o">&gt;&gt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gains</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_pa_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">txgain</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>

	<span class="n">bb_mult</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="p">((</span><span class="n">bbmultiqcomp</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_bbmult</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">bb_mult</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_enable_tx_gain_override</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>

		<span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="n">bbmultiqcomp</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">bbmultiqcomp</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_tx_iqcc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_LO_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">locoeffs</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_set_tx_locc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">locoeffs</span><span class="p">);</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_PWR_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rfpower</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6a6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1fff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">rfpower</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_clear_papd_comptable</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">temp_offset</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">temp_offset</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_PAPDCOMPDELTATBL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">temp_offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">temp_offset</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">j</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">temp_offset</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80000</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_tx_pu</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">bEnable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bEnable</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="o">~</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)));</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span>
			    <span class="o">~</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span>
				    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span>
				    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span>
				    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)));</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span>
			    <span class="o">~</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)));</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span>
			    <span class="o">~</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)));</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span>
			    <span class="o">~</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_set_trsw_override</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4fa</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_run_samples</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
		       <span class="n">u16</span> <span class="n">num_samps</span><span class="p">,</span>
		       <span class="n">u16</span> <span class="n">num_loops</span><span class="p">,</span> <span class="n">u16</span> <span class="n">wait</span><span class="p">,</span> <span class="n">bool</span> <span class="n">iqcalmode</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0x8080</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x642</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7f</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">num_samps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num_loops</span> <span class="o">!=</span> <span class="mh">0xffff</span><span class="p">)</span>
		<span class="n">num_loops</span><span class="o">--</span><span class="p">;</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x640</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">num_loops</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x641</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">wait</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iqcalmode</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x453</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">));</span>
		<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x453</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x63f</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_tx_pu</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">u8</span> <span class="n">phybw40</span><span class="p">;</span>
	<span class="n">phybw40</span> <span class="o">=</span> <span class="n">CHSPEC_IS40</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_LT</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">phybw40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">((</span><span class="n">pi</span><span class="p">),</span> <span class="mh">0x410</span><span class="p">,</span>
			    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span>
			    <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">),</span>
			    <span class="p">((</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span>
				      <span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="o">?</span> <span class="p">(</span><span class="o">!</span><span class="n">mode</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span>
			    <span class="mi">6</span> <span class="o">|</span> <span class="p">(</span><span class="o">!</span><span class="n">mode</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x410</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">wlc_lcnphy_start_tx_tone</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">s32</span> <span class="n">f_kHz</span><span class="p">,</span> <span class="n">u16</span> <span class="n">max_val</span><span class="p">,</span>
			 <span class="n">bool</span> <span class="n">iqcalmode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">phy_bw</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">num_samps</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bw</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rot</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cordic_iq</span> <span class="n">tone_samp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">data_buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">i_samp</span><span class="p">,</span> <span class="n">q_samp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_tx_tone_freq</span> <span class="o">=</span> <span class="n">f_kHz</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

	<span class="n">phy_bw</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_spurmod</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_txrx_spur_avoidance_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">f_kHz</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="n">bw</span> <span class="o">=</span> <span class="n">phy_bw</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">k</span><span class="p">;</span>
			<span class="n">num_samps</span> <span class="o">=</span> <span class="n">bw</span> <span class="o">/</span> <span class="n">abs</span><span class="p">(</span><span class="n">f_kHz</span><span class="p">);</span>
			<span class="n">k</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">num_samps</span> <span class="o">*</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">f_kHz</span><span class="p">)))</span> <span class="o">!=</span> <span class="n">bw</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">num_samps</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">rot</span> <span class="o">=</span> <span class="p">((</span><span class="n">f_kHz</span> <span class="o">*</span> <span class="mi">36</span><span class="p">)</span> <span class="o">/</span> <span class="n">phy_bw</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">theta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">t</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">num_samps</span><span class="p">;</span> <span class="n">t</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">tone_samp</span> <span class="o">=</span> <span class="n">cordic_calc_iq</span><span class="p">(</span><span class="n">theta</span><span class="p">);</span>

		<span class="n">theta</span> <span class="o">+=</span> <span class="n">rot</span><span class="p">;</span>

		<span class="n">i_samp</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">(</span><span class="n">tone_samp</span><span class="p">.</span><span class="n">i</span> <span class="o">*</span> <span class="n">max_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">q_samp</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">FLOAT</span><span class="p">(</span><span class="n">tone_samp</span><span class="p">.</span><span class="n">q</span> <span class="o">*</span> <span class="n">max_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">data_buf</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_samp</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="n">q_samp</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">data_buf</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="n">num_samps</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_SAMPLEPLAY</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_run_samples</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">num_samps</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">iqcalmode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_stop_tx_tone</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s16</span> <span class="n">playback_status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_tx_tone_freq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_spurmod</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x942</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93b</span><span class="p">,</span> <span class="mh">0x2017</span><span class="p">);</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93c</span><span class="p">,</span> <span class="mh">0x27c5</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_txrx_spur_avoidance_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">playback_status</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x644</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">playback_status</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_tx_pu</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x63f</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">playback_status</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x453</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>

	<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG112</span><span class="p">,</span> <span class="mh">0xFFF9</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cal_type</span><span class="p">,</span> <span class="n">s16</span> <span class="n">coeff_x</span><span class="p">,</span> <span class="n">s16</span> <span class="n">coeff_y</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">di0dq0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">data_rf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cal_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">wlc_lcnphy_set_tx_iqcc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">coeff_x</span><span class="p">,</span> <span class="n">coeff_y</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">di0dq0</span> <span class="o">=</span> <span class="p">(</span><span class="n">coeff_x</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="p">(</span><span class="n">coeff_y</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_tx_locc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">di0dq0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">y</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">data_rf</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG089</span><span class="p">,</span> <span class="n">data_rf</span><span class="p">);</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">y</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">data_rf</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08A</span><span class="p">,</span> <span class="n">data_rf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">y</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_x</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">data_rf</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08B</span><span class="p">,</span> <span class="n">data_rf</span><span class="p">);</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">y</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">k</span> <span class="o">=</span> <span class="n">wlc_lcnphy_calc_floor</span><span class="p">(</span><span class="n">coeff_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">k</span><span class="p">;</span>
		<span class="n">data_rf</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG08C</span><span class="p">,</span> <span class="n">data_rf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lcnphy_unsign16_struct</span>
<span class="nf">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cal_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">didq</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">di0</span><span class="p">,</span> <span class="n">dq0</span><span class="p">,</span> <span class="n">ei</span><span class="p">,</span> <span class="n">eq</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_unsign16_struct</span> <span class="n">cc</span><span class="p">;</span>
	<span class="n">cc</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cc</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">cal_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">wlc_lcnphy_get_tx_iqcc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">didq</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_locc</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">di0</span> <span class="o">=</span> <span class="p">(((</span><span class="n">didq</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>
		<span class="n">dq0</span> <span class="o">=</span> <span class="p">(((</span><span class="n">didq</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">di0</span><span class="p">;</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">dq0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">wlc_lcnphy_get_radio_loft</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ei</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">eq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fq</span><span class="p">);</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">ei</span><span class="p">;</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">eq</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">wlc_lcnphy_get_radio_loft</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ei</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">eq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fq</span><span class="p">);</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">fi</span><span class="p">;</span>
		<span class="n">cc</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">fq</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">cc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_samp_cap</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clip_detect_algo</span><span class="p">,</span> <span class="n">u16</span> <span class="n">thresh</span><span class="p">,</span>
		    <span class="n">s16</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">curval1</span><span class="p">,</span> <span class="n">curval2</span><span class="p">,</span> <span class="n">stpptr</span><span class="p">,</span> <span class="n">curptr</span><span class="p">,</span> <span class="n">strptr</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sslpnCalibClkEnCtrl</span><span class="p">,</span> <span class="n">timer</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">old_sslpnCalibClkEnCtrl</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">imag</span><span class="p">,</span> <span class="n">real</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">timer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">old_sslpnCalibClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">);</span>

	<span class="n">curval1</span> <span class="o">=</span> <span class="n">bcma_read16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_corectlsts</span><span class="p">));</span>
	<span class="n">ptr</span><span class="p">[</span><span class="mi">130</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_corectlsts</span><span class="p">),</span>
		     <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="n">curval1</span><span class="p">));</span>

	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">smpl_clct_strptr</span><span class="p">),</span> <span class="mh">0x7E00</span><span class="p">);</span>
	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">smpl_clct_stpptr</span><span class="p">),</span> <span class="mh">0x8000</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">curval2</span> <span class="o">=</span> <span class="n">bcma_read16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_phy_hdr_param</span><span class="p">));</span>
	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_phy_hdr_param</span><span class="p">),</span>
		     <span class="n">curval2</span> <span class="o">|</span> <span class="mh">0x30</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x555</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x5a6</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x5a2</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">mode</span> <span class="o">|</span> <span class="n">mode</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">));</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x5cf</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x5a5</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x583</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x584</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x585</span><span class="p">,</span> <span class="mh">0x0fff</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x586</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x580</span><span class="p">,</span> <span class="mh">0x4501</span><span class="p">);</span>

	<span class="n">sslpnCalibClkEnCtrl</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="n">sslpnCalibClkEnCtrl</span> <span class="o">|</span> <span class="mh">0x2008</span><span class="p">));</span>
	<span class="n">stpptr</span> <span class="o">=</span> <span class="n">bcma_read16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">smpl_clct_stpptr</span><span class="p">));</span>
	<span class="n">curptr</span> <span class="o">=</span> <span class="n">bcma_read16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">smpl_clct_curptr</span><span class="p">));</span>
	<span class="k">do</span> <span class="p">{</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">curptr</span> <span class="o">=</span> <span class="n">bcma_read16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">smpl_clct_curptr</span><span class="p">));</span>
		<span class="n">timer</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">curptr</span> <span class="o">!=</span> <span class="n">stpptr</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">timer</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">));</span>

	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_phy_hdr_param</span><span class="p">),</span> <span class="mh">0x2</span><span class="p">);</span>
	<span class="n">strptr</span> <span class="o">=</span> <span class="mh">0x7E00</span><span class="p">;</span>
	<span class="n">bcma_write32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">tplatewrptr</span><span class="p">),</span> <span class="n">strptr</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">strptr</span> <span class="o">&lt;</span> <span class="mh">0x8000</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">tplatewrdata</span><span class="p">));</span>
		<span class="n">imag</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">real</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">imag</span> <span class="o">&gt;</span> <span class="mi">511</span><span class="p">)</span>
			<span class="n">imag</span> <span class="o">-=</span> <span class="mi">1024</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">real</span> <span class="o">&gt;</span> <span class="mi">511</span><span class="p">)</span>
			<span class="n">real</span> <span class="o">-=</span> <span class="mi">1024</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_iqcal_swp_dis</span><span class="p">)</span>
			<span class="n">ptr</span><span class="p">[(</span><span class="n">strptr</span> <span class="o">-</span> <span class="mh">0x7E00</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">real</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">ptr</span><span class="p">[(</span><span class="n">strptr</span> <span class="o">-</span> <span class="mh">0x7E00</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">imag</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">clip_detect_algo</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">imag</span> <span class="o">&gt;</span> <span class="n">thresh</span> <span class="o">||</span> <span class="n">imag</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">thresh</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">strptr</span> <span class="o">=</span> <span class="mh">0x8000</span><span class="p">;</span>
				<span class="n">ptr</span><span class="p">[</span><span class="mi">130</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">strptr</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="n">old_sslpnCalibClkEnCtrl</span><span class="p">);</span>
	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_phy_hdr_param</span><span class="p">),</span> <span class="n">curval2</span><span class="p">);</span>
	<span class="n">bcma_write16</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">psm_corectlsts</span><span class="p">),</span> <span class="n">curval1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_a1</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cal_type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_levels</span><span class="p">,</span>
	      <span class="kt">int</span> <span class="n">step_size_lg2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_spb_tone</span> <span class="o">*</span><span class="n">phy_c1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_spb_tone</span> <span class="n">phy_c2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lcnphy_unsign16_struct</span> <span class="n">phy_c3</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">phy_c4</span><span class="p">,</span> <span class="n">phy_c5</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">phy_c6</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">phy_c7</span><span class="p">,</span> <span class="n">phy_c8</span><span class="p">,</span> <span class="n">phy_c9</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">phy_c10</span><span class="p">,</span> <span class="n">phy_c11</span><span class="p">,</span> <span class="n">phy_c12</span><span class="p">,</span> <span class="n">phy_c13</span><span class="p">,</span> <span class="n">phy_c14</span><span class="p">,</span> <span class="n">phy_c15</span><span class="p">,</span> <span class="n">phy_c16</span><span class="p">;</span>
	<span class="n">s16</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">phy_c17</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">phy_c18</span><span class="p">,</span> <span class="n">phy_c19</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">phy_c20</span><span class="p">,</span> <span class="n">phy_c21</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">phy_c22</span><span class="p">,</span> <span class="n">phy_c23</span><span class="p">,</span> <span class="n">phy_c24</span><span class="p">,</span> <span class="n">phy_c25</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">phy_c26</span><span class="p">,</span> <span class="n">phy_c27</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">phy_c28</span><span class="p">,</span> <span class="n">phy_c29</span><span class="p">,</span> <span class="n">phy_c30</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">phy_c31</span><span class="p">;</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">phy_c32</span><span class="p">;</span>
	<span class="n">phy_c21</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">phy_c10</span> <span class="o">=</span> <span class="n">phy_c13</span> <span class="o">=</span> <span class="n">phy_c14</span> <span class="o">=</span> <span class="n">phy_c8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ptr</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">131</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">ptr</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">phy_c32</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">phy_c32</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">phy_c26</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">);</span>
	<span class="n">phy_c27</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">);</span>
	<span class="n">phy_c31</span> <span class="o">=</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG026</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93d</span><span class="p">,</span> <span class="mh">0xC0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_start_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3750</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_tx_iqlo_loopback</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">phy_c32</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
	<span class="n">phy_c28</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">);</span>
	<span class="n">phy_c29</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">);</span>
	<span class="n">phy_c30</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mh">0x2</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3ff</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0x23A</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">phy_c1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">lcnphy_spb_tone_3750</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">phy_c4</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">num_levels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">num_levels</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">num_levels</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">step_size_lg2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">step_size_lg2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">step_size_lg2</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">phy_c7</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">step_size_lg2</span><span class="p">);</span>
	<span class="n">phy_c3</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">cal_type</span><span class="p">);</span>
	<span class="n">phy_c15</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">phy_c3</span><span class="p">.</span><span class="n">re</span><span class="p">;</span>
	<span class="n">phy_c16</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">phy_c3</span><span class="p">.</span><span class="n">im</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">phy_c3</span><span class="p">.</span><span class="n">re</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
			<span class="n">phy_c15</span> <span class="o">=</span> <span class="n">phy_c3</span><span class="p">.</span><span class="n">re</span> <span class="o">-</span> <span class="mi">256</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">phy_c3</span><span class="p">.</span><span class="n">im</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
			<span class="n">phy_c16</span> <span class="o">=</span> <span class="n">phy_c3</span><span class="p">.</span><span class="n">im</span> <span class="o">-</span> <span class="mi">256</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">cal_type</span><span class="p">,</span> <span class="n">phy_c15</span><span class="p">,</span> <span class="n">phy_c16</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">phy_c8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">phy_c7</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">phy_c8</span> <span class="o">&lt;</span> <span class="n">num_levels</span><span class="p">;</span> <span class="n">phy_c8</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">phy_c23</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">phy_c22</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">cal_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">phy_c10</span> <span class="o">=</span> <span class="mi">511</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">phy_c10</span> <span class="o">=</span> <span class="mi">127</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">phy_c10</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">4</span>:
			<span class="n">phy_c10</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">phy_c9</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x93d</span><span class="p">);</span>
		<span class="n">phy_c9</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">phy_c9</span><span class="p">;</span>
		<span class="n">phy_c24</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">phy_c5</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
		<span class="n">phy_c25</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG026</span><span class="p">,</span>
					<span class="p">(</span><span class="n">phy_c5</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">phy_c5</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>
			<span class="n">udelay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
			<span class="n">phy_c22</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">ptr</span><span class="p">[</span><span class="mi">130</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">wlc_lcnphy_samp_cap</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">phy_c9</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">130</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
				<span class="n">phy_c22</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">phy_c22</span><span class="p">)</span>
				<span class="n">phy_c5</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">phy_c22</span> <span class="o">!=</span> <span class="n">phy_c24</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="o">!</span><span class="n">phy_c25</span><span class="p">))</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">phy_c22</span><span class="p">)</span>
				<span class="n">phy_c5</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">phy_c5</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">phy_c5</span> <span class="o">&gt;=</span> <span class="mi">7</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="n">phy_c24</span> <span class="o">=</span> <span class="n">phy_c22</span><span class="p">;</span>
			<span class="n">phy_c25</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">phy_c5</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">phy_c5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">phy_c5</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">)</span>
			<span class="n">phy_c5</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="n">phy_c7</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">phy_c7</span><span class="p">;</span> <span class="n">k</span> <span class="o">+=</span> <span class="n">phy_c7</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">l</span> <span class="o">=</span> <span class="o">-</span><span class="n">phy_c7</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">phy_c7</span><span class="p">;</span> <span class="n">l</span> <span class="o">+=</span> <span class="n">phy_c7</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">phy_c11</span> <span class="o">=</span> <span class="n">phy_c15</span> <span class="o">+</span> <span class="n">k</span><span class="p">;</span>
				<span class="n">phy_c12</span> <span class="o">=</span> <span class="n">phy_c16</span> <span class="o">+</span> <span class="n">l</span><span class="p">;</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">phy_c11</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">phy_c10</span><span class="p">)</span>
					<span class="n">phy_c11</span> <span class="o">=</span> <span class="o">-</span><span class="n">phy_c10</span><span class="p">;</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">phy_c11</span> <span class="o">&gt;</span> <span class="n">phy_c10</span><span class="p">)</span>
					<span class="n">phy_c11</span> <span class="o">=</span> <span class="n">phy_c10</span><span class="p">;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">phy_c12</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">phy_c10</span><span class="p">)</span>
					<span class="n">phy_c12</span> <span class="o">=</span> <span class="o">-</span><span class="n">phy_c10</span><span class="p">;</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">phy_c12</span> <span class="o">&gt;</span> <span class="n">phy_c10</span><span class="p">)</span>
					<span class="n">phy_c12</span> <span class="o">=</span> <span class="n">phy_c10</span><span class="p">;</span>
				<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">cal_type</span><span class="p">,</span> <span class="n">phy_c11</span><span class="p">,</span>
						  <span class="n">phy_c12</span><span class="p">);</span>
				<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
				<span class="n">wlc_lcnphy_samp_cap</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

				<span class="n">phy_c18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">phy_c19</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">cal_type</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
						<span class="n">phy_c6</span> <span class="o">=</span> <span class="n">j</span> <span class="o">%</span> <span class="n">phy_c4</span><span class="p">;</span>
					<span class="k">else</span>
						<span class="n">phy_c6</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="n">phy_c4</span><span class="p">;</span>

					<span class="n">phy_c2</span><span class="p">.</span><span class="n">re</span> <span class="o">=</span> <span class="n">phy_c1</span><span class="p">[</span><span class="n">phy_c6</span><span class="p">].</span><span class="n">re</span><span class="p">;</span>
					<span class="n">phy_c2</span><span class="p">.</span><span class="n">im</span> <span class="o">=</span> <span class="n">phy_c1</span><span class="p">[</span><span class="n">phy_c6</span><span class="p">].</span><span class="n">im</span><span class="p">;</span>
					<span class="n">phy_c17</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
					<span class="n">phy_c18</span> <span class="o">=</span> <span class="n">phy_c18</span> <span class="o">+</span> <span class="n">phy_c17</span> <span class="o">*</span> <span class="n">phy_c2</span><span class="p">.</span><span class="n">re</span><span class="p">;</span>
					<span class="n">phy_c19</span> <span class="o">=</span> <span class="n">phy_c19</span> <span class="o">+</span> <span class="n">phy_c17</span> <span class="o">*</span> <span class="n">phy_c2</span><span class="p">.</span><span class="n">im</span><span class="p">;</span>
				<span class="p">}</span>

				<span class="n">phy_c18</span> <span class="o">=</span> <span class="n">phy_c18</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">;</span>
				<span class="n">phy_c19</span> <span class="o">=</span> <span class="n">phy_c19</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">;</span>
				<span class="n">phy_c20</span> <span class="o">=</span> <span class="p">((</span><span class="n">phy_c18</span> <span class="o">*</span> <span class="n">phy_c18</span><span class="p">)</span> <span class="o">+</span>
					   <span class="p">(</span><span class="n">phy_c19</span> <span class="o">*</span> <span class="n">phy_c19</span><span class="p">));</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">phy_c23</span> <span class="o">||</span> <span class="n">phy_c20</span> <span class="o">&lt;</span> <span class="n">phy_c21</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">phy_c21</span> <span class="o">=</span> <span class="n">phy_c20</span><span class="p">;</span>
					<span class="n">phy_c13</span> <span class="o">=</span> <span class="n">phy_c11</span><span class="p">;</span>
					<span class="n">phy_c14</span> <span class="o">=</span> <span class="n">phy_c12</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">phy_c23</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">phy_c23</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">phy_c15</span> <span class="o">=</span> <span class="n">phy_c13</span><span class="p">;</span>
		<span class="n">phy_c16</span> <span class="o">=</span> <span class="n">phy_c14</span><span class="p">;</span>
		<span class="n">phy_c7</span> <span class="o">=</span> <span class="n">phy_c7</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">cal_type</span><span class="p">,</span> <span class="n">phy_c15</span><span class="p">,</span> <span class="n">phy_c16</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">goto</span> <span class="n">cleanup</span><span class="p">;</span>
<span class="nl">cleanup:</span>
	<span class="n">wlc_lcnphy_tx_iqlo_loopback_cleanup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">phy_c32</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_stop_tx_tone</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6da</span><span class="p">,</span> <span class="n">phy_c26</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6db</span><span class="p">,</span> <span class="n">phy_c27</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="n">phy_c28</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d7</span><span class="p">,</span> <span class="n">phy_c29</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d8</span><span class="p">,</span> <span class="n">phy_c30</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG026</span><span class="p">,</span> <span class="n">phy_c31</span><span class="p">);</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">phy_c32</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_get_tx_iqcc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">iqcc</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">iqcc</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">iqcc</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="n">iqcc</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_tx_iqlo_soft_cal_full</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lcnphy_unsign16_struct</span> <span class="n">iqcc0</span><span class="p">,</span> <span class="n">locc2</span><span class="p">,</span> <span class="n">locc3</span><span class="p">,</span> <span class="n">locc4</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_a1</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">iqcc0</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">locc2</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">locc3</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">locc4</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_cc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">u16</span> <span class="nf">wlc_lcnphy_get_tx_locc</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">didq</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">didq</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">85</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">didq</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_txpwrtbl_iqlo_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">lcnphy_txgains</span> <span class="n">target_gains</span><span class="p">,</span> <span class="n">old_gains</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">save_bb_mult</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">didq</span><span class="p">,</span> <span class="n">save_pa_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uint</span> <span class="n">idx</span><span class="p">,</span> <span class="n">SAVE_txpwrindex</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_txpwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ei0</span><span class="p">,</span> <span class="n">eq0</span><span class="p">,</span> <span class="n">fi0</span><span class="p">,</span> <span class="n">fq0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_get_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>
	<span class="n">save_pa_gain</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_pa_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">save_bb_mult</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_bbmult</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">SAVE_txpwrctrl</span> <span class="o">==</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">)</span>
		<span class="n">SAVE_txpwrindex</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_current_tx_pwr_idx</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>

	<span class="n">target_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">target_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">target_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
	<span class="n">target_gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">target_gains</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_hw_iqcal_en</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_tx_iqlo_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">target_gains</span><span class="p">,</span>
				       <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span>
					<span class="n">lcnphy_recal</span> <span class="o">?</span> <span class="n">LCNPHY_CAL_RECAL</span> <span class="o">:</span>
					<span class="n">LCNPHY_CAL_FULL</span><span class="p">),</span> <span class="nb">false</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_tx_iqlo_soft_cal_full</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_get_radio_loft</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ei0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">eq0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fi0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fq0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">abs</span><span class="p">((</span><span class="n">s8</span><span class="p">)</span> <span class="n">fi0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">abs</span><span class="p">((</span><span class="n">s8</span><span class="p">)</span> <span class="n">fq0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mh">0xf0</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">gm_gain</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mi">186</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">dac_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		    <span class="o">||</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_hw_iqcal_en</span><span class="p">)</span> <span class="p">{</span>

			<span class="n">target_gains</span><span class="p">.</span><span class="n">pga_gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">target_gains</span><span class="p">.</span><span class="n">pad_gain</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
			<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
			<span class="n">wlc_lcnphy_tx_iqlo_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">target_gains</span><span class="p">,</span>
					       <span class="n">LCNPHY_CAL_FULL</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">wlc_lcnphy_tx_iqlo_soft_cal_full</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_get_tx_iqcc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>

	<span class="n">didq</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_locc</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_RATE_OFFSET</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_IQ_OFFSET</span> <span class="o">+</span> <span class="n">idx</span><span class="p">;</span>

		<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xfff00000</span><span class="p">)</span> <span class="o">|</span>
		      <span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mh">0x3FF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0x3ff</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

		<span class="n">val</span> <span class="o">=</span> <span class="n">didq</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_LO_OFFSET</span> <span class="o">+</span> <span class="n">idx</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_a</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_b</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_didq</span> <span class="o">=</span> <span class="n">didq</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_ei0</span> <span class="o">=</span> <span class="n">ei0</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_eq0</span> <span class="o">=</span> <span class="n">eq0</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_fi0</span> <span class="o">=</span> <span class="n">fi0</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_results</span><span class="p">.</span><span class="n">txiqlocal_fq0</span> <span class="o">=</span> <span class="n">fq0</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_set_bbmult</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">save_bb_mult</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_pa_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">save_pa_gain</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">old_gains</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">SAVE_txpwrctrl</span> <span class="o">!=</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_txpwrctrl</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_txpwrindex</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">s16</span> <span class="nf">wlc_lcnphy_tempsense_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tempsenseval1</span><span class="p">,</span> <span class="n">tempsenseval2</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">suspend</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span>
					     <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
				 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_vbat_temp_sense_setup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">TEMPSENSE</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">tempsenseval1</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x476</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
	<span class="n">tempsenseval2</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x477</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tempsenseval1</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="p">(</span><span class="n">tempsenseval1</span> <span class="o">-</span> <span class="mi">512</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">tempsenseval1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tempsenseval2</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">+=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="p">(</span><span class="n">tempsenseval2</span> <span class="o">-</span> <span class="mi">512</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">avg</span> <span class="o">+=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">tempsenseval2</span><span class="p">;</span>

	<span class="n">avg</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">avg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">u16</span> <span class="nf">wlc_lcnphy_tempsense</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tempsenseval1</span><span class="p">,</span> <span class="n">tempsenseval2</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">suspend</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_txpwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span>
					     <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
				 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_vbat_temp_sense_setup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">TEMPSENSE</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">tempsenseval1</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x476</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>
	<span class="n">tempsenseval2</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x477</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tempsenseval1</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">tempsenseval1</span> <span class="o">-</span> <span class="mi">512</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">tempsenseval1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_option</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl_capable</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tempsenseval2</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
			<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">tempsenseval2</span> <span class="o">+</span> <span class="mi">512</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">avg</span> <span class="o">-</span> <span class="n">tempsenseval2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tempsenseval2</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
			<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">avg</span> <span class="o">+</span> <span class="n">tempsenseval2</span> <span class="o">-</span> <span class="mi">512</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">avg</span> <span class="o">+</span> <span class="n">tempsenseval2</span><span class="p">);</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">avg</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="n">avg</span> <span class="o">+</span> <span class="mi">512</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_option</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="n">tempsenseval1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_txpwrctrl</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">avg</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">s8</span> <span class="nf">wlc_lcnphy_tempsense_degree</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s32</span> <span class="n">degree</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tempsense_new</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="n">degree</span> <span class="o">=</span>
		<span class="p">((</span><span class="n">degree</span> <span class="o">&lt;&lt;</span>
		  <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">LCN_TEMPSENSE_OFFSET</span> <span class="o">+</span> <span class="p">(</span><span class="n">LCN_TEMPSENSE_DEN</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span>
		<span class="o">/</span> <span class="n">LCN_TEMPSENSE_DEN</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">degree</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">s8</span> <span class="nf">wlc_lcnphy_vbatsense</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">bool</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">vbatsenseval</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">avg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">suspend</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span>
					     <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
				 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_vbat_temp_sense_setup</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">VBATSENSE</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">vbatsenseval</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x475</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">vbatsenseval</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">)</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">vbatsenseval</span> <span class="o">-</span> <span class="mi">512</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">avg</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="n">vbatsenseval</span><span class="p">;</span>

	<span class="n">avg</span> <span class="o">=</span>	<span class="p">(</span><span class="n">avg</span> <span class="o">*</span> <span class="n">LCN_VBAT_SCALE_NOM</span> <span class="o">+</span>
		 <span class="p">(</span><span class="n">LCN_VBAT_SCALE_DEN</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">LCN_VBAT_SCALE_DEN</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
			<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">avg</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_afe_clk_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">phybw40</span><span class="p">;</span>
	<span class="n">phybw40</span> <span class="o">=</span> <span class="n">CHSPEC_IS40</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(((</span><span class="n">mode</span> <span class="o">==</span> <span class="n">AFE_CLK_INIT_MODE_PAPD</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">phybw40</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">AFE_CLK_INIT_MODE_TXRX2X</span><span class="p">))</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x6d0</span><span class="p">,</span> <span class="mh">0x7</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_toggle_afe_pwdn</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_temp_adj</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_glacial_timer_based_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">suspend</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_pwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_lastcal</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_forcecal</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>

	<span class="n">wlc_lcnphy_txpwrtbl_iqlo_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_pwrctrl</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_periodic_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">suspend</span><span class="p">,</span> <span class="n">full_cal</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_rx_iqcomp</span> <span class="o">*</span><span class="n">rx_iqcomp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_iqcomp_sz</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_pwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">tssi</span><span class="p">,</span> <span class="n">pwr</span><span class="p">,</span> <span class="n">maxtargetpwr</span><span class="p">,</span> <span class="n">mintargetpwr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_lastcal</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">now</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">phy_forcecal</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">full_cal</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_full_cal_channel</span> <span class="o">!=</span>
		 <span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">));</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_full_cal_channel</span> <span class="o">=</span> <span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span><span class="p">;</span>

	<span class="n">suspend</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">bcma_read32</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="p">,</span> <span class="n">D11REGOFFS</span><span class="p">(</span><span class="n">maccontrol</span><span class="p">))</span> <span class="o">&amp;</span>
			 <span class="n">MCTL_EN_MAC</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wlapi_bmac_write_shm</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">,</span> <span class="n">M_CTS_DURATION</span><span class="p">,</span> <span class="mi">10000</span><span class="p">);</span>
		<span class="n">wlapi_suspend_mac_and_wait</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_txpwrtbl_iqlo_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">rx_iqcomp</span> <span class="o">=</span> <span class="n">lcnphy_rx_iqcomp_table_rev0</span><span class="p">;</span>
	<span class="n">rx_iqcomp_sz</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lcnphy_rx_iqcomp_table_rev0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_rx_iq_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">wlc_lcnphy_rx_iq_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">127</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>

		<span class="n">wlc_lcnphy_idle_tssi_est</span><span class="p">((</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">);</span>

		<span class="n">b0</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">b1</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">a1</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
		<span class="n">maxtargetpwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>
		<span class="n">mintargetpwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="mi">125</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pwr</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">tssi</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">tssi</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">tssi</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pwr</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tssi2dbm</span><span class="p">(</span><span class="n">tssi</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">);</span>
			<span class="n">pwr</span> <span class="o">=</span> <span class="p">(</span><span class="n">pwr</span> <span class="o">&lt;</span> <span class="n">mintargetpwr</span><span class="p">)</span> <span class="o">?</span> <span class="n">mintargetpwr</span> <span class="o">:</span> <span class="n">pwr</span><span class="p">;</span>
			<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
			<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">SAVE_pwrctrl</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_deaf_mode</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">suspend</span><span class="p">)</span>
		<span class="n">wlapi_enable_mac</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">physhim</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_calib_modes</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">uint</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">temp_new</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">temp_diff</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">PHY_PERICAL_CHAN</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PHY_FULLCAL</span>:
		<span class="n">wlc_lcnphy_periodic_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PHY_PERICAL_PHYINIT</span>:
		<span class="n">wlc_lcnphy_periodic_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">PHY_PERICAL_WATCHDOG</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">temp_new</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tempsense</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">temp1</span> <span class="o">=</span> <span class="n">LCNPHY_TEMPSENSE</span><span class="p">(</span><span class="n">temp_new</span><span class="p">);</span>
			<span class="n">temp2</span> <span class="o">=</span> <span class="n">LCNPHY_TEMPSENSE</span><span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_temper</span><span class="p">);</span>
			<span class="n">temp_diff</span> <span class="o">=</span> <span class="n">temp1</span> <span class="o">-</span> <span class="n">temp2</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_counter</span> <span class="o">&gt;</span> <span class="mi">90</span><span class="p">)</span> <span class="o">||</span>
			    <span class="p">(</span><span class="n">temp_diff</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">temp_diff</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">60</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">wlc_lcnphy_glacial_timer_based_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
				<span class="n">wlc_2064_vco_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
				<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_temper</span> <span class="o">=</span> <span class="n">temp_new</span><span class="p">;</span>
				<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_counter</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">LCNPHY_PERICAL_TEMPBASED_TXPWRCTRL</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
			<span class="n">wlc_lcnphy_tx_power_adjustment</span><span class="p">(</span>
				<span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_get_tssi</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">s8</span> <span class="o">*</span><span class="n">ofdm_pwr</span><span class="p">,</span> <span class="n">s8</span> <span class="o">*</span><span class="n">cck_pwr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s8</span> <span class="n">cck_offset</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ab</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">status</span>  <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)))</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">ofdm_pwr</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="p">(((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ab</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span>
				   <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wlc_phy_tpc_isenabled_lcnphy</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
			<span class="n">cck_offset</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_power_offset</span><span class="p">[</span><span class="n">TXP_FIRST_CCK</span><span class="p">];</span>
		<span class="k">else</span>
			<span class="n">cck_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="o">*</span><span class="n">cck_pwr</span> <span class="o">=</span> <span class="o">*</span><span class="n">ofdm_pwr</span> <span class="o">+</span> <span class="n">cck_offset</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">cck_pwr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="o">*</span><span class="n">ofdm_pwr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_phy_cal_init_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_lcnphy_tx_power_adjustment</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="n">ppi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s8</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">index2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="p">)</span> <span class="n">ppi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">SAVE_txpwrctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">SAVE_txpwrctrl</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">index</span> <span class="o">=</span> <span class="n">wlc_lcnphy_tempcompensated_txpwrctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">index2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a9</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">index2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_current_index</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">s8</span><span class="p">)((</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4a9</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wlc_lcnphy_load_tx_gain_table</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span>
			      <span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_tx_gain_tbl_entry</span> <span class="o">*</span><span class="n">gain_table</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pa_gain</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">gm_gain</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
		<span class="n">pa_gain</span> <span class="o">=</span> <span class="mh">0x70</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pa_gain</span> <span class="o">=</span> <span class="mh">0x70</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span>
		<span class="n">pa_gain</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">gm_gain</span> <span class="o">=</span> <span class="n">gain_table</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">gm</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">=</span> <span class="p">(((</span><span class="n">u32</span><span class="p">)</span> <span class="n">pa_gain</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span>
		       <span class="p">(</span><span class="n">gain_table</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">pad</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
		       <span class="p">(</span><span class="n">gain_table</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">pga</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">gm_gain</span><span class="p">);</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_GAIN_OFFSET</span> <span class="o">+</span> <span class="n">j</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain_table</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">dac</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">gain_table</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">bb_mult</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">);</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_IQ_OFFSET</span> <span class="o">+</span> <span class="n">j</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_load_rfpower</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="n">bbmult</span><span class="p">,</span> <span class="n">rfgain</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">temp</span><span class="p">,</span> <span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">,</span> <span class="n">qQ</span><span class="p">,</span> <span class="n">qQ1</span><span class="p">,</span> <span class="n">qQ2</span><span class="p">,</span> <span class="n">shift</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_TXPWRCTL</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">index</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bbmult</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_IQ_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
		<span class="n">bbmult</span> <span class="o">=</span> <span class="n">bbmult</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">;</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rfgain</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_GAIN_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

		<span class="n">qm_log10</span><span class="p">((</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="n">bbmult</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temp1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qQ1</span><span class="p">);</span>
		<span class="n">qm_log10</span><span class="p">((</span><span class="n">s32</span><span class="p">)</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temp2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qQ2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">qQ1</span> <span class="o">&lt;</span> <span class="n">qQ2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">temp2</span> <span class="o">=</span> <span class="n">qm_shr16</span><span class="p">(</span><span class="n">temp2</span><span class="p">,</span> <span class="n">qQ2</span> <span class="o">-</span> <span class="n">qQ1</span><span class="p">);</span>
			<span class="n">qQ</span> <span class="o">=</span> <span class="n">qQ1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">temp1</span> <span class="o">=</span> <span class="n">qm_shr16</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span> <span class="n">qQ1</span> <span class="o">-</span> <span class="n">qQ2</span><span class="p">);</span>
			<span class="n">qQ</span> <span class="o">=</span> <span class="n">qQ2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">qm_sub16</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span> <span class="n">temp2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">qQ</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
			<span class="n">shift</span> <span class="o">=</span> <span class="n">qQ</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">shift</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">qQ</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">=</span> <span class="p">(((</span><span class="n">index</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">temp</span><span class="p">)</span> <span class="o">+</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">scale_factor</span> <span class="o">+</span> <span class="n">shift</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)))</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">scale_factor</span> <span class="o">+</span>
							       <span class="n">shift</span> <span class="o">-</span> <span class="mi">2</span><span class="p">));</span>

		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="n">LCNPHY_TX_PWR_CTRL_PWR_OFFSET</span> <span class="o">+</span> <span class="n">index</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_bu_tweaks</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x805</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x42f</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x030</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x414</span><span class="p">,</span> <span class="mh">0x1e10</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x415</span><span class="p">,</span> <span class="mh">0x0640</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4df</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="o">-</span><span class="mi">9</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x434</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xFD</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x420</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardrev</span> <span class="o">&lt;</span> <span class="mh">0x1204</span><span class="p">))</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG09B</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">,</span> <span class="mh">0xF0</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x7d6</span><span class="p">,</span> <span class="mh">0x0902</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x429</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x9</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x429</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3f</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xe</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x423</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0x46</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x411</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x434</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mh">0xFF</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x656</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0F7</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0F1</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0F2</span><span class="p">,</span> <span class="mh">0xF8</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0F3</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">);</span>
		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG0F3</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">);</span>

		<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11F</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">);</span>

		<span class="n">wlc_lcnphy_clear_tx_power_offsets</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1ff</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_rcal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">rcal_value</span><span class="p">;</span>

	<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05B</span><span class="p">,</span> <span class="mh">0xfD</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG004</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG120</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG078</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG129</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG057</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>

	<span class="n">or_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05B</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
	<span class="n">SPINWAIT</span><span class="p">(</span><span class="o">!</span><span class="n">wlc_radio_2064_rcal_done</span><span class="p">(</span><span class="n">pi</span><span class="p">),</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_radio_2064_rcal_done</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">rcal_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05C</span><span class="p">);</span>
		<span class="n">rcal_value</span> <span class="o">=</span> <span class="n">rcal_value</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG05B</span><span class="p">,</span> <span class="mh">0xfD</span><span class="p">);</span>

	<span class="n">and_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG057</span><span class="p">,</span> <span class="mh">0xFE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_rc_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">dflt_rc_cal_val</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flt_val</span><span class="p">;</span>

	<span class="n">dflt_rc_cal_val</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">dflt_rc_cal_val</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
	<span class="n">flt_val</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">dflt_rc_cal_val</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">dflt_rc_cal_val</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">dflt_rc_cal_val</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x933</span><span class="p">,</span> <span class="n">flt_val</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x934</span><span class="p">,</span> <span class="n">flt_val</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x935</span><span class="p">,</span> <span class="n">flt_val</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x936</span><span class="p">,</span> <span class="n">flt_val</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x937</span><span class="p">,</span> <span class="p">(</span><span class="n">flt_val</span> <span class="o">&amp;</span> <span class="mh">0x1FF</span><span class="p">));</span>

	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_radio_2064_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">lcnphy_radio_regs</span> <span class="o">*</span><span class="n">lcnphyregs</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">lcnphyregs</span> <span class="o">=</span> <span class="n">lcnphy_radio_regs_2064</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">address</span> <span class="o">!=</span> <span class="mh">0xffff</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">do_init_a</span><span class="p">)</span>
			<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
					<span class="p">((</span><span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">address</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span><span class="p">)</span> <span class="o">|</span>
					 <span class="n">RADIO_DEFAULT_CORE</span><span class="p">),</span>
					<span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">init_a</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">do_init_g</span><span class="p">)</span>
			<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
					<span class="p">((</span><span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">address</span> <span class="o">&amp;</span> <span class="mh">0x3fff</span><span class="p">)</span> <span class="o">|</span>
					 <span class="n">RADIO_DEFAULT_CORE</span><span class="p">),</span>
					<span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">lcnphyregs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">init_g</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG032</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG033</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG090</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG010</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>

		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG060</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG061</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">);</span>
		<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG062</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG01D</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG01E</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">),</span> <span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4ea</span><span class="p">,</span> <span class="mh">0x4688</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4eb</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4eb</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">),</span> <span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x46a</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">25</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_locc</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_rcal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_rc_cal</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_radio_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wlc_radio_2064_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_tbl_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uint</span> <span class="n">idx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">phybw40</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">phybw40</span> <span class="o">=</span> <span class="n">CHSPEC_IS40</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">dot11lcnphytbl_info_sz_rev0</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dot11lcnphytbl_info_rev0</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM_BT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_RFSEQ</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
		<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_RFSEQ</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="mi">114</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="mi">130</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">val</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span>
			<span class="n">wlc_lcnphy_load_tx_gain_table</span><span class="p">(</span>
				<span class="n">pi</span><span class="p">,</span>
				<span class="n">dot11lcnphy_2GHz_extPA_gaintable_rev0</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">wlc_lcnphy_load_tx_gain_table</span><span class="p">(</span>
				<span class="n">pi</span><span class="p">,</span>
				<span class="n">dot11lcnphy_2GHz_gaintable_rev0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">phytbl_info</span> <span class="o">*</span><span class="n">tb</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">l</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">l</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_2G_rev2_sz</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_EXTLNA</span><span class="p">)</span>
				<span class="n">tb</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_extlna_2G_rev2</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">tb</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_2G_rev2</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">l</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_5G_rev2_sz</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_EXTLNA_5GHz</span><span class="p">)</span>
				<span class="n">tb</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_extlna_5G_rev2</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">tb</span> <span class="o">=</span> <span class="n">dot11lcnphytbl_rx_gain_info_5G_rev2</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">l</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
			<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tb</span><span class="p">[</span><span class="n">idx</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span>
	    <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM_BT</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dot11lcn_sw_ctrl_tbl_info_4313_epa</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM_BT</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardrev</span> <span class="o">&lt;</span> <span class="mh">0x1250</span><span class="p">)</span>
			<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span>
				<span class="n">pi</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">dot11lcn_sw_ctrl_tbl_info_4313_bt_epa</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span>
				<span class="n">pi</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">dot11lcn_sw_ctrl_tbl_info_4313_bt_epa_p250</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">wlc_lcnphy_write_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dot11lcn_sw_ctrl_tbl_info_4313</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_load_rfpower</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_clear_papd_comptable</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_rev0_baseband_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">afectrl1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG11C</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4e6</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4f9</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x938</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b0</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x567</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">);</span>
	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">52</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">afectrl1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">afectrl1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span>
				  <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">));</span>
		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x43e</span><span class="p">,</span> <span class="n">afectrl1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x634</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0xC</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x634</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0xA</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x910</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x608</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x604</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x7ff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x3EA</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_rev2_baseband_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS5G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x416</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">80</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x416</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">),</span> <span class="mi">80</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_agc_temp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s16</span> <span class="n">temp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">phytbl_info</span> <span class="n">tab</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tableBuffer</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4df</span><span class="p">);</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_ofdmgainidxtableoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_ofdmgainidxtableoffset</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_ofdmgainidxtableoffset</span> <span class="o">-=</span> <span class="mi">256</span><span class="p">;</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_dsssgainidxtableoffset</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_dsssgainidxtableoffset</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_dsssgainidxtableoffset</span> <span class="o">-=</span> <span class="mi">256</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">59</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tableBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span>
		<span class="n">tableBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">128</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tr_R_gain_val</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tableBuffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">63</span><span class="p">)</span>
		<span class="n">tableBuffer</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">128</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tr_T_gain_val</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span> <span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x434</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">temp</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
		<span class="n">temp</span> <span class="o">-=</span> <span class="mi">256</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_input_pwr_offset_db</span> <span class="o">=</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="n">temp</span><span class="p">;</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_Med_Low_Gain_db</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x424</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_Very_Low_Gain_db</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x425</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0xff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_ptr</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_id</span> <span class="o">=</span> <span class="n">LCNPHY_TBL_ID_GAIN_IDX</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_offset</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
	<span class="n">tab</span><span class="p">.</span><span class="n">tbl_width</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_read_table</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab</span><span class="p">);</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_gain_idx_14_lowword</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_gain_idx_14_hiword</span> <span class="o">=</span> <span class="n">tableBuffer</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_baseband_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">wlc_lcnphy_tbl_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_rev0_baseband_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_rev2_baseband_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
	<span class="n">wlc_lcnphy_bu_tweaks</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_phy_init_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">phybw40</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="n">phybw40</span> <span class="o">=</span> <span class="n">CHSPEC_IS40</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cal_temper</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rawtempsense</span><span class="p">;</span>

	<span class="n">or_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">and_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44a</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_afe_clk_init</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">AFE_CLK_INIT_MODE_TXRX2X</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x60a</span><span class="p">,</span> <span class="mi">160</span><span class="p">);</span>

	<span class="n">write_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x46a</span><span class="p">,</span> <span class="mi">25</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_baseband_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_radio_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_tx_pwr_ctrl_init</span><span class="p">((</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_phy_chanspec_set</span><span class="p">((</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">);</span>

	<span class="n">si_pmu_regcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mh">0x9</span><span class="p">);</span>

	<span class="n">si_pmu_chipcontrol</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="mh">0x03CDDDDD</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span>
	    <span class="o">&amp;&amp;</span> <span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_by_index</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">FIXED_TXPWR</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_agc_temp_init</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_temp_adj</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x448</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_HW</span><span class="p">);</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_noise_samples</span> <span class="o">=</span> <span class="n">LCNPHY_NOISE_SAMPLES_DEFAULT</span><span class="p">;</span>
	<span class="n">wlc_lcnphy_calib_modes</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">PHY_PERICAL_PHYINIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wlc_phy_txpwr_srom_read_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s8</span> <span class="n">txpwr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ssb_sprom</span> <span class="o">*</span><span class="n">sprom</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">d11core</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">sprom</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">cckpo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">offset_ofdm</span><span class="p">,</span> <span class="n">offset_mcs</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tr_isolation_mid</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">fem</span><span class="p">.</span><span class="n">ghz2</span><span class="p">.</span><span class="n">tr_iso</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rx_power_offset</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">rxpo2g</span><span class="p">;</span>

		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">pa0b0</span><span class="p">;</span>
		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">pa0b1</span><span class="p">;</span>
		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">pa0b2</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">rssismf2g</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">rssismc2g</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">rssisav2g</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf_lowtemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc_lowtemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs_lowtemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span><span class="p">;</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf_hightemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vf</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc_hightemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_vc</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs_hightemp</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rssi_gs</span><span class="p">;</span>

		<span class="n">txpwr</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">core_pwr_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">maxpwr_2g</span><span class="p">;</span>
		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_2g</span> <span class="o">=</span> <span class="n">txpwr</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">PWRTBL_NUM_COEFF</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g_low_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g_high_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">txpa_2g</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="n">cckpo</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">cck2gpo</span><span class="p">;</span>
		<span class="n">offset_ofdm</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">ofdm2gpo</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cckpo</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">uint</span> <span class="n">max_pwr_chan</span> <span class="o">=</span> <span class="n">txpwr</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">TXP_FIRST_CCK</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">TXP_LAST_CCK</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_rate_2g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">max_pwr_chan</span> <span class="o">-</span> <span class="p">((</span><span class="n">cckpo</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
				<span class="n">cckpo</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">TXP_FIRST_OFDM</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">TXP_LAST_OFDM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_rate_2g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">max_pwr_chan</span> <span class="o">-</span>
					<span class="p">((</span><span class="n">offset_ofdm</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
				<span class="n">offset_ofdm</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">u8</span> <span class="n">opo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

			<span class="n">opo</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">opo</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">TXP_FIRST_CCK</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">TXP_LAST_CCK</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
				<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_rate_2g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">txpwr</span><span class="p">;</span>

			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">TXP_FIRST_OFDM</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">TXP_LAST_OFDM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_rate_2g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">txpwr</span> <span class="o">-</span>
						<span class="p">((</span><span class="n">offset_ofdm</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
				<span class="n">offset_ofdm</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">offset_mcs</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">mcs2gpo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
			<span class="n">offset_mcs</span> <span class="o">|=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">mcs2gpo</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_mcs20_po</span> <span class="o">=</span> <span class="n">offset_mcs</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">TXP_FIRST_SISO_MCS_20</span><span class="p">;</span>
			     <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">TXP_LAST_SISO_MCS_20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">pi</span><span class="o">-&gt;</span><span class="n">tx_srom_max_rate_2g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
					<span class="n">txpwr</span> <span class="o">-</span> <span class="p">((</span><span class="n">offset_mcs</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
				<span class="n">offset_mcs</span> <span class="o">&gt;&gt;=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_rawtempsense</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">rawtempsense</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_measPower</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">measpower</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_slope</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">tempsense_slope</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_hw_iqcal_en</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">hw_iqcal_en</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_iqcal_swp_dis</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">iqcal_swp_dis</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempcorrx</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">tempcorrx</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_option</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">tempsense_option</span><span class="p">;</span>
		<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_freqoffset_corr</span> <span class="o">=</span> <span class="n">sprom</span><span class="o">-&gt;</span><span class="n">freqoffset_corr</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sprom</span><span class="o">-&gt;</span><span class="n">ant_available_bg</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">wlc_phy_ant_rxdiv_set</span><span class="p">((</span><span class="k">struct</span> <span class="n">brcms_phy_pub</span> <span class="o">*</span><span class="p">)</span> <span class="n">pi</span><span class="p">,</span>
				<span class="n">sprom</span><span class="o">-&gt;</span><span class="n">ant_available_bg</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_cck_dig_filt_type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_2064_vco_cal</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">calnrst</span><span class="p">;</span>

	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG057</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">calnrst</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span> <span class="n">read_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG056</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf8</span><span class="p">;</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG056</span><span class="p">,</span> <span class="n">calnrst</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG056</span><span class="p">,</span> <span class="n">calnrst</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">write_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG056</span><span class="p">,</span> <span class="n">calnrst</span> <span class="o">|</span> <span class="mh">0x07</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
	<span class="n">mod_radio_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">RADIO_2064_REG057</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">wlc_phy_tpc_isenabled_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="p">(</span><span class="n">LCNPHY_TX_PWR_CTRL_HW</span> <span class="o">==</span>
			<span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">((</span><span class="n">pi</span><span class="p">)));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_phy_txpower_recalc_target_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">pwr_ctrl</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tempsense_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_calib_modes</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_PERICAL_TEMPBASED_TXPWRCTRL</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">wlc_lcnphy_tssi_based_pwr_ctrl_enabled</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pwr_ctrl</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">LCNPHY_TX_PWR_CTRL_OFF</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_txpower_recalc_target</span><span class="p">(</span><span class="n">pi</span><span class="p">);</span>
		<span class="n">wlc_lcnphy_set_tx_pwr_ctrl</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">pwr_ctrl</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wlc_phy_detach_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">bool</span> <span class="nf">wlc_phy_attach_lcnphy</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span><span class="p">;</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span><span class="p">),</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_NOPA</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl_capable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">xtalfreq</span> <span class="o">=</span> <span class="n">si_pmu_alp_clock</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">sih</span><span class="p">);</span>
	<span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_papd_rxGnCtrl_init</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">wlc_phy_init_lcnphy</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">calinit</span> <span class="o">=</span> <span class="n">wlc_phy_cal_init_lcnphy</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">chanset</span> <span class="o">=</span> <span class="n">wlc_phy_chanspec_set_lcnphy</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">txpwrrecalc</span> <span class="o">=</span> <span class="n">wlc_phy_txpower_recalc_target_lcnphy</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">txiqccget</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_iqcc</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">txiqccset</span> <span class="o">=</span> <span class="n">wlc_lcnphy_set_tx_iqcc</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">txloccget</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_tx_locc</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">radioloftget</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_radio_loft</span><span class="p">;</span>
	<span class="n">pi</span><span class="o">-&gt;</span><span class="n">pi_fptr</span><span class="p">.</span><span class="n">detach</span> <span class="o">=</span> <span class="n">wlc_phy_detach_lcnphy</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wlc_phy_txpwr_srom_read_lcnphy</span><span class="p">(</span><span class="n">pi</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">sh</span><span class="o">-&gt;</span><span class="n">boardflags</span> <span class="o">&amp;</span> <span class="n">BFL_FEM</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">LCNREV_IS</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">pubpi</span><span class="p">.</span><span class="n">phy_rev</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_tempsense_option</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl_capable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">temppwrctrl_capable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">hwpwrctrl_capable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="n">pi</span><span class="o">-&gt;</span><span class="n">temppwrctrl_capable</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wlc_lcnphy_set_rx_gain</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">u32</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">trsw</span><span class="p">,</span> <span class="n">ext_lna</span><span class="p">,</span> <span class="n">lna1</span><span class="p">,</span> <span class="n">lna2</span><span class="p">,</span> <span class="n">tia</span><span class="p">,</span> <span class="n">biq0</span><span class="p">,</span> <span class="n">biq1</span><span class="p">,</span> <span class="n">gain0_15</span><span class="p">,</span> <span class="n">gain16_19</span><span class="p">;</span>

	<span class="n">trsw</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&amp;</span> <span class="p">((</span><span class="n">u32</span><span class="p">)</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">))</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ext_lna</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">29</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="n">lna1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">lna2</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="n">tia</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">biq0</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="n">biq1</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">;</span>

	<span class="n">gain0_15</span> <span class="o">=</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">((</span><span class="n">lna1</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">lna1</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
			  <span class="p">((</span><span class="n">lna2</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">lna2</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span>
			  <span class="p">((</span><span class="n">tia</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">biq0</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">));</span>
	<span class="n">gain16_19</span> <span class="o">=</span> <span class="n">biq1</span><span class="p">;</span>

	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x44d</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">trsw</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">),</span> <span class="n">ext_lna</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ext_lna</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xffff</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gain0_15</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b7</span><span class="p">,</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gain16_19</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CHSPEC_IS2G</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4b1</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">),</span> <span class="n">lna1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
		<span class="n">mod_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x4e6</span><span class="p">,</span> <span class="p">(</span><span class="mh">0x3</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">),</span> <span class="n">lna1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">wlc_lcnphy_rx_gain_override_enable</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">wlc_lcnphy_get_receive_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">gain_index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">received_power</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">max_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gain_code</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">max_index</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">gain_index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">gain_code</span> <span class="o">=</span> <span class="n">lcnphy_23bitgaincode_table</span><span class="p">[</span><span class="o">*</span><span class="n">gain_index</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">==</span> <span class="o">*</span><span class="n">gain_index</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">gain_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">((</span><span class="o">*</span><span class="n">gain_index</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">s32</span><span class="p">)</span> <span class="n">max_index</span><span class="p">)</span>
		       <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">received_power</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">wlc_lcnphy_set_rx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
					       <span class="n">lcnphy_23bitgaincode_table</span>
					       <span class="p">[</span><span class="o">*</span><span class="n">gain_index</span><span class="p">]);</span>
			<span class="n">received_power</span> <span class="o">=</span>
				<span class="n">wlc_lcnphy_measure_digital_power</span><span class="p">(</span>
					<span class="n">pi</span><span class="p">,</span>
					<span class="n">pi_lcn</span><span class="o">-&gt;</span>
					<span class="n">lcnphy_noise_samples</span><span class="p">);</span>
			<span class="p">(</span><span class="o">*</span><span class="n">gain_index</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="p">(</span><span class="o">*</span><span class="n">gain_index</span><span class="p">)</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">wlc_lcnphy_set_rx_gain</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">gain_code</span><span class="p">);</span>
		<span class="n">received_power</span> <span class="o">=</span>
			<span class="n">wlc_lcnphy_measure_digital_power</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span>
							 <span class="n">pi_lcn</span><span class="o">-&gt;</span>
							 <span class="n">lcnphy_noise_samples</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">received_power</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">s32</span> <span class="nf">wlc_lcnphy_rx_signal_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">brcms_phy</span> <span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="n">s32</span> <span class="n">gain_index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s32</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">nominal_power_db</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">log_val</span><span class="p">,</span> <span class="n">gain_mismatch</span><span class="p">,</span> <span class="n">desired_gain</span><span class="p">,</span> <span class="n">input_power_offset_db</span><span class="p">,</span>
	    <span class="n">input_power_db</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">received_power</span><span class="p">,</span> <span class="n">temperature</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">power</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msb1</span><span class="p">,</span> <span class="n">msb2</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">diff1</span><span class="p">,</span> <span class="n">diff2</span><span class="p">;</span>
	<span class="n">uint</span> <span class="n">freq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">brcms_phy_lcnphy</span> <span class="o">*</span><span class="n">pi_lcn</span> <span class="o">=</span> <span class="n">pi</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">pi_lcnphy</span><span class="p">;</span>

	<span class="n">received_power</span> <span class="o">=</span> <span class="n">wlc_lcnphy_get_receive_power</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gain_index</span><span class="p">);</span>

	<span class="n">gain</span> <span class="o">=</span> <span class="n">lcnphy_gain_table</span><span class="p">[</span><span class="n">gain_index</span><span class="p">];</span>

	<span class="n">nominal_power_db</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x425</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>

	<span class="n">power</span> <span class="o">=</span> <span class="p">(</span><span class="n">received_power</span> <span class="o">*</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">msb1</span> <span class="o">=</span> <span class="n">ffs</span><span class="p">(</span><span class="n">power</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">msb2</span> <span class="o">=</span> <span class="n">msb1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">val1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">msb1</span><span class="p">;</span>
	<span class="n">val2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">msb2</span><span class="p">;</span>
	<span class="n">diff1</span> <span class="o">=</span> <span class="p">(</span><span class="n">power</span> <span class="o">-</span> <span class="n">val1</span><span class="p">);</span>
	<span class="n">diff2</span> <span class="o">=</span> <span class="p">(</span><span class="n">val2</span> <span class="o">-</span> <span class="n">power</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">diff1</span> <span class="o">&lt;</span> <span class="n">diff2</span><span class="p">)</span>
		<span class="n">log_val</span> <span class="o">=</span> <span class="n">msb1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">log_val</span> <span class="o">=</span> <span class="n">msb2</span><span class="p">;</span>

	<span class="n">log_val</span> <span class="o">=</span> <span class="n">log_val</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">gain_mismatch</span> <span class="o">=</span> <span class="p">(</span><span class="n">nominal_power_db</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">log_val</span><span class="p">);</span>

	<span class="n">desired_gain</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">+</span> <span class="n">gain_mismatch</span><span class="p">;</span>

	<span class="n">input_power_offset_db</span> <span class="o">=</span> <span class="n">read_phy_reg</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mh">0x434</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">input_power_offset_db</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
		<span class="n">input_power_offset_db</span> <span class="o">-=</span> <span class="mi">256</span><span class="p">;</span>

	<span class="n">input_power_db</span> <span class="o">=</span> <span class="n">input_power_offset_db</span> <span class="o">-</span> <span class="n">desired_gain</span><span class="p">;</span>

	<span class="n">input_power_db</span> <span class="o">=</span>
		<span class="n">input_power_db</span> <span class="o">+</span> <span class="n">lcnphy_gain_index_offset_for_rssi</span><span class="p">[</span><span class="n">gain_index</span><span class="p">];</span>

	<span class="n">freq</span> <span class="o">=</span> <span class="n">wlc_phy_channel2freq</span><span class="p">(</span><span class="n">CHSPEC_CHANNEL</span><span class="p">(</span><span class="n">pi</span><span class="o">-&gt;</span><span class="n">radio_chanspec</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">freq</span> <span class="o">&gt;</span> <span class="mi">2427</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;=</span> <span class="mi">2467</span><span class="p">))</span>
		<span class="n">input_power_db</span> <span class="o">=</span> <span class="n">input_power_db</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">temperature</span> <span class="o">=</span> <span class="n">pi_lcn</span><span class="o">-&gt;</span><span class="n">lcnphy_lastsensed_temperature</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
		<span class="n">input_power_db</span> <span class="o">=</span>
			<span class="n">input_power_db</span> <span class="o">+</span>
			<span class="p">(((</span><span class="n">temperature</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">286</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">-</span>
			<span class="mi">7</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">temperature</span> <span class="o">-</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">input_power_db</span> <span class="o">=</span>
			<span class="n">input_power_db</span> <span class="o">+</span>
			<span class="p">(((</span><span class="n">temperature</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">286</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">-</span>
			<span class="mi">3</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">input_power_db</span> <span class="o">=</span> <span class="n">input_power_db</span> <span class="o">+</span>
					<span class="p">(((</span><span class="n">temperature</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">-</span> <span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mi">286</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>

	<span class="n">wlc_lcnphy_rx_gain_override_enable</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">input_power_db</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
