f | iwl-modparams.h | s | 4.5K | 120 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1336528424 |  | iwlwifi: remove the iwl_shared reference  Change-Id: I10e42e0cc7dd91047f093ea2c5a55d65c004ada6 Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Reviewed-on: http://git-mwg.jer.intel.com/gerrit/1939 Tested-by: Jenkins Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com>
f | iwl-drv.h | s | 5.1K | 118 | Johannes Berg | johannes.berg@intel.com | 1335216542 |  | iwlwifi: move driver defines to iwl-drv.h  These defines will have to be shared between modules, but they seem better placed in iwl-drv.h than iwl-shared.h.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-calib.c | s | 36K | 948 | Johannes Berg | johannes.berg@intel.com | 1335216476 |  | iwlwifi: remove TX/RX frame statistics  Keeping statistics per frame type really isn't very useful, and needs a huge amount of code so remove it. Since that is the only thing in iwl-core.{c,h} now, those files can be killed.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-debug.c | s | 4.2K | 121 | Johannes Berg | johannes.berg@intel.com | 1335216098 |  | iwlwifi: clean up iwl-shared.h includes  That file is now holding just a few defines and the module parameters, so it shouldn't include anything. Make sure the right users include the right files instead.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-scan.c | s | 31K | 985 | David Spinadel | david.spinadel@intel.com | 1337188099 |  | iwlwifi: invert the order of ssid list in scan cmd  The firmware inverts the order of ssid list of scan command, we should invert the order before sending the command, in order to get probe requests sent in wanted order.  Signed-off-by: David Spinadel <david.spinadel@intel.com> Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-notif-wait.h | s | 5.2K | 125 | Johannes Berg | johannes.berg@intel.com | 1334003835 |  | iwlwifi: extend notification wait  Sometimes, for example when we ask the uCode for calibration, we wait for the "complete" response while we also need the results that are sent in other, interim, notifications.  Currently we handle this by installing an RX handler globally, but that isn't needed as this is the only time we want to use these notifications.  So in order to be able to simplify at least future code that does the same, extend the notification wait framework to allow you to wait for multiple commands and decide based on the command whether the wait finished.  While at it, also fix a race that can then become relevant -- if the wait function has returned true once it shouldn't be called again, today this can happen due to races between the triggering and the wakeup.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-eeprom.h | s | 10K | 242 | Johannes Berg | johannes.berg@intel.com | 1335216601 |  | iwlwifi: move OTP defines  Since the PCI core shouldn't include the iwl-eeprom.h header file, move the OTP definitions into iwl-agn-hw.h which can be included.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | Makefile | g | 909B |  | Johannes Berg | johannes.berg@intel.com | 1337958761 |  | iwlwifi: remove ucode16 option  The ucode16 option is still very much work in progress, so there's no need to ask any users about it. Remove the option and code for now, we'll put it back when it's actually working.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-led.c | s | 6.1K | 196 | Johannes Berg | johannes.berg@intel.com | 1335216651 |  | iwlwifi: clean up module parameters  For now at least, all module parameters should be with the core functionality, so move them there, while at it rename to iwlwifi_mod_params. Also rename iwl-shared.h to iwl-modparams.h to reflect the real contents.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-testmode.c | s | 33K | 1000 | John W. Linville | linville@tuxdriver.com | 1335467028 |  | Merge branch 'master' of git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-next into for-davem  Conflicts: 	drivers/net/wireless/iwlwifi/iwl-testmode.c
f | iwl-debug.h | s | 6.9K | 168 | Johannes Berg | johannes.berg@intel.com | 1335216651 |  | iwlwifi: clean up module parameters  For now at least, all module parameters should be with the core functionality, so move them there, while at it rename to iwlwifi_mod_params. Also rename iwl-shared.h to iwl-modparams.h to reflect the real contents.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-fh.h | s | 21K | 481 | Johannes Berg | johannes.berg@intel.com | 1335291295 |  | iwlwifi: fix hardware queue programming  Newer devices have 20 (5000 series) or 30 (6000 series) hardware queues, rather than the 16 that 4965 had. This was added to the driver a long time ago, but improperly: the queue registers for the higher queues aren't just continuations of the registers for the first 16 queues, they are in other places. Therefore, the hardware would lock up when trying to activate queue 16 or above and the device would have to be restarted.  Thanks goes to Emmanuel who identified this and told me how the queue programming should be done.  Note that we don't use queues 20 and higher today and doing so needs more work than this.  Cc: stable@vger.kernel.org Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-fw-file.h | s | 5.4K | 147 | Johannes Berg | johannes.berg@intel.com | 1334612084 |  | iwlwifi: remove uCode alternatives mechanism  We've never released firmware using the alternatives mechanism and our build process makes that difficult anyway. This means that in every file we have ever built (except maybe by hand for testing) the listed alternative was 0. Make the alternative field in the TLVs part of the TLV number (thus expanding that to 32 bits); this gives us more TLV numbers (not really needed) and more importantly protects against rogue firmware files that actually do use the alternatives mechanism -- those will now be rejected since they don't contain any valid TLVs.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-rx.c | s | 36K | 1014 | Eric Dumazet | edumazet@google.com | 1337362285 |  | iwlwifi: dont pull too much payload in skb head  As iwlwifi use fat skbs, it should not pull too much data in skb->head, and particularly no tcp data payload, or splice() is slower, and TCP coalescing is disabled. Copying payload to userland also involves at least two copies (part from header, part from fragment)  Each layer will pull its header from the fragment as needed.  (on 64bit arches, skb_tailroom(skb) at this point is 192 bytes)  With this patch applied, I have a major reduction of collapsed/pruned TCP packets, a nice increase of TCPRcvCoalesce counter, and overall better Internet User experience.  Small packets are still using a fragless skb, so that page can be reused by the driver.  Signed-off-by: Eric Dumazet <edumazet@google.com> Cc: Johannes Berg <johannes.berg@intel.com> Cc: Wey-Yi Guy <wey-yi.w.guy@intel.com> Reviewed-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | iwl-trans-pcie-rx.c | s | 31K | 905 | David S. Miller | davem@davemloft.net | 1336448140 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net  Conflicts: 	drivers/net/ethernet/intel/e1000e/param.c 	drivers/net/wireless/iwlwifi/iwl-agn-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans-pcie-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans.h  Resolved the iwlwifi conflict with mainline using 3-way diff posted by John Linville and Stephen Rothwell.  In 'net' we added a bug fix to make iwlwifi report a more accurate skb->truesize but this conflicted with RX path changes that happened meanwhile in net-next.  In e1000e a conflict arose in the validation code for settings of adapter->itr.  'net-next' had more sophisticated logic so that logic was used.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | iwl-led.h | s | 1.5K | 36 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1327432116 |  | iwlwifi: update Copyright  Update Copyright to 2012  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-mac80211.c | s | 41K | 1369 | Johannes Berg | johannes.berg@intel.com | 1340651653 |  | iwlwifi: fix activating inactive stations  When authentication/association timed out, the driver would complain bitterly, printing the message ACTIVATE a non DRIVER active station id ... addr ...  The cause turns out to be that when the AP station is added but we don't associate, the IWL_STA_UCODE_INPROGRESS is set but never cleared. This then causes iwl_restore_stations() to attempt to resend it because it uses the flag internally and uploads even if it didn't set it itself.  To fix this issue and not upload the station again when it has already been removed by mac80211, clear the flag after adding it in case we add it only for association.  Cc: stable@vger.kernel.org Reviewed-by: Meenakshi Venkataraman <meenakshi.venkataraman@intel.com> Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-dev.h | s | 27K | 892 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1336524968 |  | iwlwifi: add checking for the condition to reduce tx power  When bluetooth coex is active and certain condition matched, driver need to decide should the tx power been reduce or not. Adding the logic to manage it.  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-trans.h | s | 18K | 535 | David S. Miller | davem@davemloft.net | 1336448140 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net  Conflicts: 	drivers/net/ethernet/intel/e1000e/param.c 	drivers/net/wireless/iwlwifi/iwl-agn-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans-pcie-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans.h  Resolved the iwlwifi conflict with mainline using 3-way diff posted by John Linville and Stephen Rothwell.  In 'net' we added a bug fix to make iwlwifi report a more accurate skb->truesize but this conflicted with RX path changes that happened meanwhile in net-next.  In e1000e a conflict arose in the validation code for settings of adapter->itr.  'net-next' had more sophisticated logic so that logic was used.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | iwl-eeprom.c | s | 33K | 1005 | Johannes Berg | johannes.berg@intel.com | 1338837882 |  | iwlwifi: fix TX power antenna access  Since my commit   iwlwifi: use valid TX/RX antenna from hw_params the config values are pure overrides, not the real values for all hardware. Therefore, the EEPROM TX power reading code checks the wrong values, it should check the hw_params values.  Cc: stable@kernel.org [3.4] Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-1000.c | s | 4.2K | 109 | David S. Miller | davem@davemloft.net | 1336448140 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net  Conflicts: 	drivers/net/ethernet/intel/e1000e/param.c 	drivers/net/wireless/iwlwifi/iwl-agn-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans-pcie-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans.h  Resolved the iwlwifi conflict with mainline using 3-way diff posted by John Linville and Stephen Rothwell.  In 'net' we added a bug fix to make iwlwifi report a more accurate skb->truesize but this conflicted with RX path changes that happened meanwhile in net-next.  In e1000e a conflict arose in the validation code for settings of adapter->itr.  'net-next' had more sophisticated logic so that logic was used.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | iwl-agn-rs.c | s | 99K | 2917 | Meenakshi Venkataraman | meenakshi.venkataraman@intel.com | 1337958760 |  | iwlwifi: update BT traffic load states correctly  When BT traffic load changes from its previous state, a new LQ command needs to be sent down to the firmware. This needs to be done only once per change. The state variable that keeps track of this change is last_bt_traffic_load. However, it was not being updated when the change had been handled. Not updating this variable was causing a flood of advanced BT config commands to be sent to the firmware. Fix this.  Cc: stable@vger.kernel.org #2.6.38+ Signed-off-by: Meenakshi Venkataraman <meenakshi.venkataraman@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-io.h | s | 3.2K | 77 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1334759493 |  | iwlwifi: remove unneeded includes  Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-calib.h | s | 3.2K | 70 | Johannes Berg | johannes.berg@intel.com | 1335216476 |  | iwlwifi: remove TX/RX frame statistics  Keeping statistics per frame type really isn't very useful, and needs a huge amount of code so remove it. Since that is the only thing in iwl-core.{c,h} now, those files can be killed.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-trans-pcie.c | s | 60K | 1819 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1339177627 |  | iwlwifi: disable the buggy chain extension feature in HW  This feature has been reported to be buggy and enabled by default. We therefore need to disable it manually.  Cc: stable@vger.kernel.org Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-power.c | s | 12K | 335 | Amit Beka | amit.beka@intel.com | 1337117273 |  | iwlwifi: fix power index handling  The power index that the user gives as module parameter in in range 1-5, but we need to decrease it in order to create an array index out of it (0-4) for the power table command.  Signed-off-by: Amit Beka <amit.beka@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-ucode.c | s | 14K | 442 | Johannes Berg | johannes.berg@intel.com | 1335216476 |  | iwlwifi: remove TX/RX frame statistics  Keeping statistics per frame type really isn't very useful, and needs a huge amount of code so remove it. Since that is the only thing in iwl-core.{c,h} now, those files can be killed.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-op-mode.h | s | 7.9K | 207 | David Spinadel | david.spinadel@intel.com | 1334759517 |  | iwlwifi: Added foreward declaration for iwl_cfg in op_mode  Please merge this with "iwlwifi: op_mode holds its pointer to the config"  Signed-off-by: David Spinadel <david.spinadel@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-6000.c | s | 12K | 337 | Meenakshi Venkataraman | meenakshi.venkataraman@intel.com | 1339177626 |  | iwlwifi: use correct supported firmware for 6035 and 6000g2  My patch     iwlwifi: use correct released ucode version  did not correctly report supported firmware for the 6035 device. This patch fixes it. The minimum supported firmware version for 6035 is v6.  Also correct the minimum supported firmware version for the 6000g2 series of devices.  Cc: stable@kernel.org Signed-off-by: Meenakshi Venkataraman <meenakshi.venkataraman@intel.com> Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn-sta.c | s | 40K | 1246 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1339177627 |  | iwlwifi: don't mess up the SCD when removing a key  When we remove a key, we put a key index which was supposed to tell the fw that we are actually removing the key. But instead the fw took that index as a valid index and messed up the SRAM of the device.  This memory corruption on the device mangled the data of the SCD. The impact on the user is that SCD queue 2 got stuck after having removed keys. The message is the log that was printed is:  Queue 2 stuck for 10000ms  This doesn't seem to fix the higher queues that get stuck from time to time.  Cc: stable@vger.kernel.org [2.6.27+] Reviewed-by: Meenakshi Venkataraman <meenakshi.venkataraman@intel.com> Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn-tx.c | s | 38K | 1179 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1337117274 |  | iwlwifi: don't disable AGG queues that are not enabled  If the BA session is torn down before we had a chance to start it we shouldn't disable the AGG tx queues that weren't enabled. This can happen in two cases:  1) We get a delBA before we drained our Tx queues in agg start flow 2) We didn't get the (successfull) addBA response on time  Reported-by: Daniel Chyan <dchyan@princeton.edu> Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-cfg.h | s | 4.8K | 109 | Johannes Berg | johannes.berg@intel.com | 1331064971 |  | iwlwifi: make config const  Writing to the global config structures is always wrong. To protect against such mistakes in the future, mark them const.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-pci.c | s | 14K | 325 | Johannes Berg | johannes.berg@intel.com | 1335216651 |  | iwlwifi: clean up module parameters  For now at least, all module parameters should be with the core functionality, so move them there, while at it rename to iwlwifi_mod_params. Also rename iwl-shared.h to iwl-modparams.h to reflect the real contents.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-5000.c | s | 5.4K | 144 | David S. Miller | davem@davemloft.net | 1336448140 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net  Conflicts: 	drivers/net/ethernet/intel/e1000e/param.c 	drivers/net/wireless/iwlwifi/iwl-agn-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans-pcie-rx.c 	drivers/net/wireless/iwlwifi/iwl-trans.h  Resolved the iwlwifi conflict with mainline using 3-way diff posted by John Linville and Stephen Rothwell.  In 'net' we added a bug fix to make iwlwifi report a more accurate skb->truesize but this conflicted with RX path changes that happened meanwhile in net-next.  In e1000e a conflict arose in the validation code for settings of adapter->itr.  'net-next' had more sophisticated logic so that logic was used.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | iwl-trans-pcie-tx.c | s | 27K | 811 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1337958760 |  | iwlwifi: fix the Transmit Frame Descriptor rings  The logic that allows to have a short TFD queue was completely wrong. We do maintain 256 Transmit Frame Descriptors, but they point to recycled buffers. We used to attach and de-attach different TFDs for the same buffer and it worked since they pointed to the same buffer.  Also zero the number of BDs after unmapping a TFD. This seems not necessary since we don't reclaim the same TFD twice, but I like housekeeping.  This patch solves this warning:  [ 6427.079855] WARNING: at lib/dma-debug.c:866 check_unmap+0x727/0x7a0() [ 6427.079859] Hardware name: Latitude E6410 [ 6427.079865] iwlwifi 0000:02:00.0: DMA-API: device driver tries to free DMA memory it has not allocated [device address=0x00000000296d393c] [size=8 bytes] [ 6427.079870] Modules linked in: ... [ 6427.079950] Pid: 6613, comm: ifconfig Tainted: G           O 3.3.3 #5 [ 6427.079954] Call Trace: [ 6427.079963]  [<c10337a2>] warn_slowpath_common+0x72/0xa0 [ 6427.079982]  [<c1033873>] warn_slowpath_fmt+0x33/0x40 [ 6427.079988]  [<c12dcb77>] check_unmap+0x727/0x7a0 [ 6427.079995]  [<c12dcdaa>] debug_dma_unmap_page+0x5a/0x80 [ 6427.080024]  [<fe2312ac>] iwlagn_unmap_tfd+0x12c/0x180 [iwlwifi] [ 6427.080048]  [<fe231349>] iwlagn_txq_free_tfd+0x49/0xb0 [iwlwifi] [ 6427.080071]  [<fe228e37>] iwl_tx_queue_unmap+0x67/0x90 [iwlwifi] [ 6427.080095]  [<fe22d221>] iwl_trans_pcie_stop_device+0x341/0x7b0 [iwlwifi] [ 6427.080113]  [<fe204b0e>] iwl_down+0x17e/0x260 [iwlwifi] [ 6427.080132]  [<fe20efec>] iwlagn_mac_stop+0x6c/0xf0 [iwlwifi] [ 6427.080168]  [<fd8480ce>] ieee80211_stop_device+0x5e/0x190 [mac80211] [ 6427.080198]  [<fd833208>] ieee80211_do_stop+0x288/0x620 [mac80211] [ 6427.080243]  [<fd8335b7>] ieee80211_stop+0x17/0x20 [mac80211] [ 6427.080250]  [<c148dac1>] __dev_close_many+0x81/0xd0 [ 6427.080270]  [<c148db3d>] __dev_close+0x2d/0x50 [ 6427.080276]  [<c148d152>] __dev_change_flags+0x82/0x150 [ 6427.080282]  [<c148e3e3>] dev_change_flags+0x23/0x60 [ 6427.080289]  [<c14f6320>] devinet_ioctl+0x6a0/0x770 [ 6427.080296]  [<c14f8705>] inet_ioctl+0x95/0xb0 [ 6427.080304]  [<c147a0f0>] sock_ioctl+0x70/0x270  Cc: stable@vger.kernel.org Reported-by: Antonio Quartulli <ordex@autistici.org> Tested-by: Antonio Quartulli <ordex@autistici.org> Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Reviewed-by: Wey-Yi W Guy <wey-yi.w.guy@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-devtrace.h | s | 10K | 360 | Johannes Berg | johannes.berg@intel.com | 1331146312 |  | iwlwifi: make tracing use device as identifier  Tracing used the priv pointer as an identifier, which has the problem that we don't have it in all code, and also some people say no pointers should be "leaked" to userspace.  Use the device name instead, it is more useful anyway.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn-rxon.c | s | 45K | 1350 | John W. Linville | linville@tuxdriver.com | 1337714286 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-next
f | iwl-agn-lib.c | s | 36K | 1120 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1337117273 |  | iwlwifi: make sure reduced tx power bit is valid  Once driver decide to change reduced tx power behavior, make sure the reduce tx power valid bit is set  Change-Id: I3afae96319292d8cb347a812a948085c5db7ad91 Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Reviewed-on: http://git-mwg.jer.intel.com/gerrit/1948 Tested-by: Jenkins Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-prph.h | s | 10K | 234 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1339177627 |  | iwlwifi: disable the buggy chain extension feature in HW  This feature has been reported to be buggy and enabled by default. We therefore need to disable it manually.  Cc: stable@vger.kernel.org Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-trans-pcie-int.h | s | 13K | 395 | Emmanuel Grumbach | emmanuel.grumbach@intel.com | 1337958760 |  | iwlwifi: fix the Transmit Frame Descriptor rings  The logic that allows to have a short TFD queue was completely wrong. We do maintain 256 Transmit Frame Descriptors, but they point to recycled buffers. We used to attach and de-attach different TFDs for the same buffer and it worked since they pointed to the same buffer.  Also zero the number of BDs after unmapping a TFD. This seems not necessary since we don't reclaim the same TFD twice, but I like housekeeping.  This patch solves this warning:  [ 6427.079855] WARNING: at lib/dma-debug.c:866 check_unmap+0x727/0x7a0() [ 6427.079859] Hardware name: Latitude E6410 [ 6427.079865] iwlwifi 0000:02:00.0: DMA-API: device driver tries to free DMA memory it has not allocated [device address=0x00000000296d393c] [size=8 bytes] [ 6427.079870] Modules linked in: ... [ 6427.079950] Pid: 6613, comm: ifconfig Tainted: G           O 3.3.3 #5 [ 6427.079954] Call Trace: [ 6427.079963]  [<c10337a2>] warn_slowpath_common+0x72/0xa0 [ 6427.079982]  [<c1033873>] warn_slowpath_fmt+0x33/0x40 [ 6427.079988]  [<c12dcb77>] check_unmap+0x727/0x7a0 [ 6427.079995]  [<c12dcdaa>] debug_dma_unmap_page+0x5a/0x80 [ 6427.080024]  [<fe2312ac>] iwlagn_unmap_tfd+0x12c/0x180 [iwlwifi] [ 6427.080048]  [<fe231349>] iwlagn_txq_free_tfd+0x49/0xb0 [iwlwifi] [ 6427.080071]  [<fe228e37>] iwl_tx_queue_unmap+0x67/0x90 [iwlwifi] [ 6427.080095]  [<fe22d221>] iwl_trans_pcie_stop_device+0x341/0x7b0 [iwlwifi] [ 6427.080113]  [<fe204b0e>] iwl_down+0x17e/0x260 [iwlwifi] [ 6427.080132]  [<fe20efec>] iwlagn_mac_stop+0x6c/0xf0 [iwlwifi] [ 6427.080168]  [<fd8480ce>] ieee80211_stop_device+0x5e/0x190 [mac80211] [ 6427.080198]  [<fd833208>] ieee80211_do_stop+0x288/0x620 [mac80211] [ 6427.080243]  [<fd8335b7>] ieee80211_stop+0x17/0x20 [mac80211] [ 6427.080250]  [<c148dac1>] __dev_close_many+0x81/0xd0 [ 6427.080270]  [<c148db3d>] __dev_close+0x2d/0x50 [ 6427.080276]  [<c148d152>] __dev_change_flags+0x82/0x150 [ 6427.080282]  [<c148e3e3>] dev_change_flags+0x23/0x60 [ 6427.080289]  [<c14f6320>] devinet_ioctl+0x6a0/0x770 [ 6427.080296]  [<c14f8705>] inet_ioctl+0x95/0xb0 [ 6427.080304]  [<c147a0f0>] sock_ioctl+0x70/0x270  Cc: stable@vger.kernel.org Reported-by: Antonio Quartulli <ordex@autistici.org> Tested-by: Antonio Quartulli <ordex@autistici.org> Signed-off-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Reviewed-by: Wey-Yi W Guy <wey-yi.w.guy@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn.c | s | 64K | 1973 | Johannes Berg | johannes.berg@intel.com | 1337188101 |  | iwlwifi: support explicit monitor interface  Support explicit monitor interface to keep injection working after the HW queue changes. This also finally enables sniffer mode.  Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn.h | s | 21K | 540 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1336528423 |  | iwlwifi: modify #ifdef to avoid sparse complain  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-tt.c | s | 21K | 628 | Johannes Berg | johannes.berg@intel.com | 1335216651 |  | iwlwifi: clean up module parameters  For now at least, all module parameters should be with the core functionality, so move them there, while at it rename to iwlwifi_mod_params. Also rename iwl-shared.h to iwl-modparams.h to reflect the real contents.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-devtrace.c | s | 1.7K | 41 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1327432116 |  | iwlwifi: update Copyright  Update Copyright to 2012  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-drv.c | s | 30K | 898 | Johannes Berg | johannes.berg@intel.com | 1338920849 |  | iwlwifi: fix double free/complete in firmware loading  Linus reported that due to mac80211 failing to register the device (due to WoWLAN) his machine crashed etc. as we double-freed the vmalloc() firmware area. His patch to fix it was very similar to this one but I noticed that there's another bug in the area: we complete the completion before starting, so since we're running in a work struct context stop() could be called while in the middle of start() which will almost certainly lead to issues.  Make a modification similar to his to avoid the double- free but also move the completion to another spot so it is only done after start() either finished or failed so that stop() can have a consistent state.  Reported-by: Linus Torvalds <torvalds@linux-foundation.org> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-notif-wait.c | s | 5.9K | 161 | Johannes Berg | johannes.berg@intel.com | 1334003835 |  | iwlwifi: extend notification wait  Sometimes, for example when we ask the uCode for calibration, we wait for the "complete" response while we also need the results that are sent in other, interim, notifications.  Currently we handle this by installing an RX handler globally, but that isn't needed as this is the only time we want to use these notifications.  So in order to be able to simplify at least future code that does the same, extend the notification wait framework to allow you to wait for multiple commands and decide based on the command whether the wait finished.  While at it, also fix a race that can then become relevant -- if the wait function has returned true once it shouldn't be called again, today this can happen due to races between the triggering and the wakeup.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-debugfs.c | s | 78K | 2190 | Johannes Berg | johannes.berg@intel.com | 1340215825 |  | iwlwifi: remove log_event debugfs file debugging is disabled  When debugging is disabled, the event log functions aren't functional in the way that the debugfs file expects. This leads to the debugfs access crashing. Since the event log functions aren't functional then, remove the debugfs file when CONFIG_IWLWIFI_DEBUG is not set.  Cc: stable@kernel.org Reported-by: Lekensteyn <lekensteyn@gmail.com> Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | Kconfig | g | 4.6K |  | Johannes Berg | johannes.berg@intel.com | 1337958761 |  | iwlwifi: remove ucode16 option  The ucode16 option is still very much work in progress, so there's no need to ask any users about it. Remove the option and code for now, we'll put it back when it's actually working.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-commands.h | s | 129K | 3550 | David Spinadel | david.spinadel@intel.com | 1337188097 |  | iwlwifi: fix scan_cmd_size allocation  Allocate scan command with dynamic size based on uCode capability and num of channels. This isn't an important fix as the previous allocation was always too large as it added the scan command size but later subtracted it (which meant it was supposed to be part of the max scan size.)  Signed-off-by: David Spinadel <david.spinadel@intel.com> Reviewed-by: Emmanuel Grumbach <emmanuel.grumbach@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-testmode.h | s | 11K | 301 | Amit Beka | amit.beka@intel.com | 1331233192 |  | iwlwifi: add testmode command for rx forwarding  Added a testmode command which tells iwl_rx_dispatch to send the RX both as a notification to nl80211 and with the registered RX handlers.  This is used for monitoring RX from userspace while preserving the regular flows in the driver.  Signed-off-by: Amit Beka <amit.beka@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-io.c | s | 8.7K | 269 | Stanislaw Gruszka | sgruszka@redhat.com | 1331233190 |  | iwlwifi: cleanup/fix memory barriers  wmb(), rmb() are not needed when writel(), readl() are used as accessors for MMIO. We use them indirectly via iowrite32(), ioread32().  What is needed mmiowb(), for synchronizing writes coming from different CPUs on PCIe bridge (see in patch comments). This fortunately is not needed on x86, where mmiowb() is just defined as compiler barrier. As iwlwifi devices are most likely not used on anything other than x86, this is not so important fix.  Signed-off-by: Stanislaw Gruszka <sgruszka@redhat.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn-hw.h | s | 4.8K | 107 | Johannes Berg | johannes.berg@intel.com | 1335216601 |  | iwlwifi: move OTP defines  Since the PCI core shouldn't include the iwl-eeprom.h header file, move the OTP definitions into iwl-agn-hw.h which can be included.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-config.h | s | 9.1K | 242 | Johannes Berg | johannes.berg@intel.com | 1335216590 |  | iwlwifi: move antenna definitions to config  Since they're used in the config, they should be declared in iwl-config.h.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-fw.h | s | 6.1K | 161 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1335216113 |  | iwlwifi: include net/mac80211.h to avoid compiler error  without the include, kernel compiling will fail, but not compat. this patch need to be merge with iwlwifi-clean-up-iwl-shared.h-includes.patch  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-csr.h | s | 19K | 414 | Amit Beka | amit.beka@intel.com | 1334612132 |  | iwlwifi: added HBUS_TARG_TEST_REG  This register is used to enable some debug mechanisms.  Signed-off-by: Amit Beka <amit.beka@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-power.h | s | 1.8K | 42 | Johannes Berg | johannes.berg@intel.com | 1335216651 |  | iwlwifi: clean up module parameters  For now at least, all module parameters should be with the core functionality, so move them there, while at it rename to iwlwifi_mod_params. Also rename iwl-shared.h to iwl-modparams.h to reflect the real contents.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-2000.c | s | 7.5K | 199 | Meenakshi Venkataraman | meenakshi.venkataraman@intel.com | 1337958760 |  | iwlwifi: do not use shadow registers by default  Shadow registers in the device are meant to allow the driver to update certain device registers without needing to wake up all components of the device. However, using this feature in the device causes communication between the driver and the device to become unreliable, resulting in host command timeouts.  Disable this feature by default till a fix is available for the bug.  Cc: stable@vger.kernel.org #2.6.38+ Signed-off-by: Meenakshi Venkataraman <meenakshi.venkataraman@intel.com> Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | iwl-agn-rs.h | s | 13K | 381 | Johannes Berg | johannes.berg@intel.com | 1335216590 |  | iwlwifi: move antenna definitions to config  Since they're used in the config, they should be declared in iwl-config.h.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-devices.c | s | 20K | 664 | Johannes Berg | johannes.berg@intel.com | 1335216476 |  | iwlwifi: remove TX/RX frame statistics  Keeping statistics per frame type really isn't very useful, and needs a huge amount of code so remove it. Since that is the only thing in iwl-core.{c,h} now, those files can be killed.  Signed-off-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com>
f | iwl-agn-tt.h | s | 4.5K | 119 | Wey-Yi Guy | wey-yi.w.guy@intel.com | 1327432116 |  | iwlwifi: update Copyright  Update Copyright to 2012  Signed-off-by: Wey-Yi Guy <wey-yi.w.guy@intel.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
