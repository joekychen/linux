<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › iwlwifi › iwl-debugfs.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>iwl-debugfs.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * GPL LICENSE SUMMARY</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2008 - 2012 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of version 2 of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110,</span>
<span class="cm"> * USA</span>
<span class="cm"> *</span>
<span class="cm"> * The full GNU General Public License is included in this distribution</span>
<span class="cm"> * in the file called LICENSE.GPL.</span>
<span class="cm"> *</span>
<span class="cm"> * Contact Information:</span>
<span class="cm"> *  Intel Linux Wireless &lt;ilw@linux.intel.com&gt;</span>
<span class="cm"> * Intel Corporation, 5200 N.E. Elam Young Parkway, Hillsboro, OR 97124-6497</span>
<span class="cm"> *****************************************************************************/</span>

<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/debugfs.h&gt;</span>

<span class="cp">#include &lt;linux/ieee80211.h&gt;</span>
<span class="cp">#include &lt;net/mac80211.h&gt;</span>


<span class="cp">#include &quot;iwl-dev.h&quot;</span>
<span class="cp">#include &quot;iwl-debug.h&quot;</span>
<span class="cp">#include &quot;iwl-io.h&quot;</span>
<span class="cp">#include &quot;iwl-agn.h&quot;</span>
<span class="cp">#include &quot;iwl-modparams.h&quot;</span>

<span class="cm">/* create and remove of files */</span>
<span class="cp">#define DEBUGFS_ADD_FILE(name, parent, mode) do {			\</span>
<span class="cp">	if (!debugfs_create_file(#name, mode, parent, priv,		\</span>
<span class="cp">				 &amp;iwl_dbgfs_##name##_ops))		\</span>
<span class="cp">		goto err;						\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define DEBUGFS_ADD_BOOL(name, parent, ptr) do {			\</span>
<span class="cp">	struct dentry *__tmp;						\</span>
<span class="cp">	__tmp = debugfs_create_bool(#name, S_IWUSR | S_IRUSR,		\</span>
<span class="cp">				    parent, ptr);			\</span>
<span class="cp">	if (IS_ERR(__tmp) || !__tmp)					\</span>
<span class="cp">		goto err;						\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define DEBUGFS_ADD_X32(name, parent, ptr) do {				\</span>
<span class="cp">	struct dentry *__tmp;						\</span>
<span class="cp">	__tmp = debugfs_create_x32(#name, S_IWUSR | S_IRUSR,		\</span>
<span class="cp">				   parent, ptr);			\</span>
<span class="cp">	if (IS_ERR(__tmp) || !__tmp)					\</span>
<span class="cp">		goto err;						\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define DEBUGFS_ADD_U32(name, parent, ptr, mode) do {			\</span>
<span class="cp">	struct dentry *__tmp;						\</span>
<span class="cp">	__tmp = debugfs_create_u32(#name, mode,				\</span>
<span class="cp">				   parent, ptr);			\</span>
<span class="cp">	if (IS_ERR(__tmp) || !__tmp)					\</span>
<span class="cp">		goto err;						\</span>
<span class="cp">} while (0)</span>

<span class="cm">/* file operation */</span>
<span class="cp">#define DEBUGFS_READ_FUNC(name)                                         \</span>
<span class="cp">static ssize_t iwl_dbgfs_##name##_read(struct file *file,               \</span>
<span class="cp">					char __user *user_buf,          \</span>
<span class="cp">					size_t count, loff_t *ppos);</span>

<span class="cp">#define DEBUGFS_WRITE_FUNC(name)                                        \</span>
<span class="cp">static ssize_t iwl_dbgfs_##name##_write(struct file *file,              \</span>
<span class="cp">					const char __user *user_buf,    \</span>
<span class="cp">					size_t count, loff_t *ppos);</span>


<span class="cp">#define DEBUGFS_READ_FILE_OPS(name)                                     \</span>
<span class="cp">	DEBUGFS_READ_FUNC(name);                                        \</span>
<span class="cp">static const struct file_operations iwl_dbgfs_##name##_ops = {          \</span>
<span class="cp">	.read = iwl_dbgfs_##name##_read,                       		\</span>
<span class="cp">	.open = simple_open,						\</span>
<span class="cp">	.llseek = generic_file_llseek,					\</span>
<span class="cp">};</span>

<span class="cp">#define DEBUGFS_WRITE_FILE_OPS(name)                                    \</span>
<span class="cp">	DEBUGFS_WRITE_FUNC(name);                                       \</span>
<span class="cp">static const struct file_operations iwl_dbgfs_##name##_ops = {          \</span>
<span class="cp">	.write = iwl_dbgfs_##name##_write,                              \</span>
<span class="cp">	.open = simple_open,						\</span>
<span class="cp">	.llseek = generic_file_llseek,					\</span>
<span class="cp">};</span>


<span class="cp">#define DEBUGFS_READ_WRITE_FILE_OPS(name)                               \</span>
<span class="cp">	DEBUGFS_READ_FUNC(name);                                        \</span>
<span class="cp">	DEBUGFS_WRITE_FUNC(name);                                       \</span>
<span class="cp">static const struct file_operations iwl_dbgfs_##name##_ops = {          \</span>
<span class="cp">	.write = iwl_dbgfs_##name##_write,                              \</span>
<span class="cp">	.read = iwl_dbgfs_##name##_read,                                \</span>
<span class="cp">	.open = simple_open,						\</span>
<span class="cp">	.llseek = generic_file_llseek,					\</span>
<span class="cp">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_sram_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">device_format</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sram</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">fw_img</span> <span class="o">*</span><span class="n">img</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">bufsz</span><span class="p">;</span>

	<span class="cm">/* default is to dump the entire data segment */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">=</span> <span class="mh">0x800000</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ucode_loaded</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="n">img</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">img</span><span class="p">[</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cur_ucode</span><span class="p">];</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span> <span class="o">=</span> <span class="n">img</span><span class="o">-&gt;</span><span class="n">sec</span><span class="p">[</span><span class="n">IWL_UCODE_SECTION_DATA</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="o">-</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">device_format</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">bufsz</span> <span class="o">=</span>  <span class="mi">50</span> <span class="o">+</span> <span class="n">len</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;sram_len: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">len</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;sram_offset: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span><span class="p">);</span>

	<span class="cm">/* adjust sram address since reads are only on even u32 boundaries */</span>
	<span class="n">offset</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">;</span>
	<span class="n">sram</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x3</span><span class="p">;</span>

	<span class="cm">/* read the first u32 from sram */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">iwl_read_targ_mem</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">,</span> <span class="n">sram</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(;</span> <span class="n">len</span><span class="p">;</span> <span class="n">len</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* put the address at the start of every line */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;%08X: &quot;</span><span class="p">,</span> <span class="n">sram</span> <span class="o">+</span> <span class="n">offset</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">device_format</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;%02x&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;%02x &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">offset</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>

		<span class="cm">/* if all bytes processed, read the next u32 from sram */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">offset</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sram</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">iwl_read_targ_mem</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">,</span> <span class="n">sram</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/* put in extra spaces and split lines for human readability */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">i</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;   &quot;</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">i</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_sram_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%x,%x&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%x&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">offset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dbgfs_sram_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_wowlan_sram_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					  <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					  <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">fw_img</span> <span class="o">*</span><span class="n">img</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">img</span><span class="p">[</span><span class="n">IWL_UCODE_WOWLAN</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">wowlan_sram</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODATA</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span>
				       <span class="n">priv</span><span class="o">-&gt;</span><span class="n">wowlan_sram</span><span class="p">,</span>
				       <span class="n">img</span><span class="o">-&gt;</span><span class="n">sec</span><span class="p">[</span><span class="n">IWL_UCODE_SECTION_DATA</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_stations_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_station_entry</span> <span class="o">*</span><span class="n">station</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_tid_data</span> <span class="o">*</span><span class="n">tid_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="cm">/* Add 30 for initial string */</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="mi">500</span> <span class="o">*</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">num_stations</span><span class="p">);</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;num of stations: %d</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">num_stations</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IWLAGN_STATION_COUNT</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">station</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">stations</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">station</span><span class="o">-&gt;</span><span class="n">used</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				 <span class="s">&quot;station %d - addr: %pM, flags: %#x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">i</span><span class="p">,</span> <span class="n">station</span><span class="o">-&gt;</span><span class="n">sta</span><span class="p">.</span><span class="n">sta</span><span class="p">.</span><span class="n">addr</span><span class="p">,</span>
				 <span class="n">station</span><span class="o">-&gt;</span><span class="n">sta</span><span class="p">.</span><span class="n">station_flags_msk</span><span class="p">);</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;TID seqno  next_rclmd &quot;</span>
				<span class="s">&quot;rate_n_flags state txq</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">IWL_MAX_TID_COUNT</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tid_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tid_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;%d:  0x%.4x 0x%.4x     0x%.8x   &quot;</span>
				<span class="s">&quot;%d     %.2d&quot;</span><span class="p">,</span>
				<span class="n">j</span><span class="p">,</span> <span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">seq_number</span><span class="p">,</span>
				<span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">next_reclaimed</span><span class="p">,</span>
				<span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">rate_n_flags</span><span class="p">,</span>
				<span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">state</span><span class="p">,</span>
				<span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">txq_id</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">tid_data</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">wait_for_ba</span><span class="p">)</span>
				<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
						 <span class="s">&quot; - waitforba&quot;</span><span class="p">);</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_nvm_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				       <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span>
				       <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ofs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">buf_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">eeprom_ver</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">eeprom_len</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">base_params</span><span class="o">-&gt;</span><span class="n">eeprom_size</span><span class="p">;</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">eeprom_len</span> <span class="o">+</span> <span class="mi">256</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom_len</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODATA</span><span class="p">;</span>

	<span class="n">ptr</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptr</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/* 4 characters for byte 0xYY */</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">buf_size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">eeprom_ver</span> <span class="o">=</span> <span class="n">iwl_eeprom_query16</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">EEPROM_VERSION</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">buf_size</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;NVM Type: %s, &quot;</span>
			<span class="s">&quot;version: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">nvm_device_type</span> <span class="o">==</span> <span class="n">NVM_DEVICE_TYPE_OTP</span><span class="p">)</span>
			 <span class="o">?</span> <span class="s">&quot;OTP&quot;</span> <span class="o">:</span> <span class="s">&quot;EEPROM&quot;</span><span class="p">,</span> <span class="n">eeprom_ver</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">ofs</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">ofs</span> <span class="o">&lt;</span> <span class="n">eeprom_len</span> <span class="p">;</span> <span class="n">ofs</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">buf_size</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;0x%.4x &quot;</span><span class="p">,</span> <span class="n">ofs</span><span class="p">);</span>
		<span class="n">hex_dump_to_buffer</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">ofs</span><span class="p">,</span> <span class="mi">16</span> <span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span>
				   <span class="n">buf_size</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">buf_size</span> <span class="o">-</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">buf</span><span class="p">[</span><span class="n">pos</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_channels_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_channel</span> <span class="o">*</span><span class="n">channels</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ieee80211_supported_band</span> <span class="o">*</span><span class="n">supp_band</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="n">PAGE_SIZE</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_GEO_CONFIGURED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">supp_band</span> <span class="o">=</span> <span class="n">iwl_get_hw_mode</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">IEEE80211_BAND_2GHZ</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">supp_band</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">channels</span> <span class="o">=</span> <span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">;</span>

		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;Displaying %d channels in 2.4GHz band 802.11bg):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">n_channels</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">n_channels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
					<span class="s">&quot;%d: %ddBm: BSS%s%s, %s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">hw_value</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">max_power</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_CHAN_RADAR</span> <span class="o">?</span>
					<span class="s">&quot; (IEEE 802.11h required)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
					<span class="p">((</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_CHAN_NO_IBSS</span><span class="p">)</span>
					<span class="o">||</span> <span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span>
					<span class="n">IEEE80211_CHAN_RADAR</span><span class="p">))</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span>
					<span class="s">&quot;, IBSS&quot;</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span>
					<span class="n">IEEE80211_CHAN_PASSIVE_SCAN</span> <span class="o">?</span>
					<span class="s">&quot;passive only&quot;</span> <span class="o">:</span> <span class="s">&quot;active/passive&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">supp_band</span> <span class="o">=</span> <span class="n">iwl_get_hw_mode</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">IEEE80211_BAND_5GHZ</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">supp_band</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">channels</span> <span class="o">=</span> <span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">;</span>

		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;Displaying %d channels in 5.2GHz band (802.11a)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">n_channels</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">supp_band</span><span class="o">-&gt;</span><span class="n">n_channels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
					<span class="s">&quot;%d: %ddBm: BSS%s%s, %s.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">hw_value</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">max_power</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_CHAN_RADAR</span> <span class="o">?</span>
					<span class="s">&quot; (IEEE 802.11h required)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
					<span class="p">((</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">IEEE80211_CHAN_NO_IBSS</span><span class="p">)</span>
					<span class="o">||</span> <span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span>
					<span class="n">IEEE80211_CHAN_RADAR</span><span class="p">))</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span>
					<span class="s">&quot;, IBSS&quot;</span><span class="p">,</span>
					<span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">&amp;</span>
					<span class="n">IEEE80211_CHAN_PASSIVE_SCAN</span> <span class="o">?</span>
					<span class="s">&quot;passive only&quot;</span> <span class="o">:</span> <span class="s">&quot;active/passive&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_status_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_RF_KILL_HW:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_RF_KILL_HW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_CT_KILL:</span><span class="se">\t\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_CT_KILL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_ALIVE:</span><span class="se">\t\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_ALIVE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_READY:</span><span class="se">\t\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_READY</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_GEO_CONFIGURED:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_GEO_CONFIGURED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_EXIT_PENDING:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_EXIT_PENDING</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_STATISTICS:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_STATISTICS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_SCANNING:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_SCANNING</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_SCAN_ABORTING:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_SCAN_ABORTING</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_SCAN_HW:</span><span class="se">\t\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_SCAN_HW</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_POWER_PMI:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_POWER_PMI</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;STATUS_FW_ERROR:</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">test_bit</span><span class="p">(</span><span class="n">STATUS_FW_ERROR</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rx_handlers_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">64</span><span class="p">;</span> <span class="cm">/* 24 items * 64 char per item */</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">REPLY_MAX</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rx_handlers_stats</span><span class="p">[</span><span class="n">cnt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">Rx handler[%36s]:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">iwl_dvm_get_cmd_string</span><span class="p">(</span><span class="n">cnt</span><span class="p">),</span>
				<span class="n">priv</span><span class="o">-&gt;</span><span class="n">rx_handlers_stats</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rx_handlers_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reset_flag</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%x&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset_flag</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reset_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rx_handlers_stats</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rx_handlers_stats</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_qos_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_rxon_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">256</span> <span class="o">*</span> <span class="n">NUM_IWL_RXON_CTX</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">for_each_context</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;context %d:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">ctxid</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AC_NUM</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;</span><span class="se">\t</span><span class="s">cw_min</span><span class="se">\t</span><span class="s">cw_max</span><span class="se">\t</span><span class="s">aifsn</span><span class="se">\t</span><span class="s">txop</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;AC[%d]</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				<span class="n">ctx</span><span class="o">-&gt;</span><span class="n">qos_data</span><span class="p">.</span><span class="n">def_qos_parm</span><span class="p">.</span><span class="n">ac</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cw_min</span><span class="p">,</span>
				<span class="n">ctx</span><span class="o">-&gt;</span><span class="n">qos_data</span><span class="p">.</span><span class="n">def_qos_parm</span><span class="p">.</span><span class="n">ac</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">cw_max</span><span class="p">,</span>
				<span class="n">ctx</span><span class="o">-&gt;</span><span class="n">qos_data</span><span class="p">.</span><span class="n">def_qos_parm</span><span class="p">.</span><span class="n">ac</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">aifsn</span><span class="p">,</span>
				<span class="n">ctx</span><span class="o">-&gt;</span><span class="n">qos_data</span><span class="p">.</span><span class="n">def_qos_parm</span><span class="p">.</span><span class="n">ac</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">edca_txop</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_thermal_throttling_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_tt_mgmt</span> <span class="o">*</span><span class="n">tt</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">thermal_throttle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_tt_restriction</span> <span class="o">*</span><span class="n">restriction</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;Thermal Throttling Mode: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">tt</span><span class="o">-&gt;</span><span class="n">advanced_tt</span> <span class="o">?</span> <span class="s">&quot;Advance&quot;</span> <span class="o">:</span> <span class="s">&quot;Legacy&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;Thermal Throttling State: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">tt</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tt</span><span class="o">-&gt;</span><span class="n">advanced_tt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">restriction</span> <span class="o">=</span> <span class="n">tt</span><span class="o">-&gt;</span><span class="n">restriction</span> <span class="o">+</span> <span class="n">tt</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">;</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;Tx mode: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">restriction</span><span class="o">-&gt;</span><span class="n">tx_stream</span><span class="p">);</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;Rx mode: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">restriction</span><span class="o">-&gt;</span><span class="n">rx_stream</span><span class="p">);</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				<span class="s">&quot;HT mode: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">restriction</span><span class="o">-&gt;</span><span class="n">is_ht</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_disable_ht40_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ht40</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ht40</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_any_associated</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">disable_ht40</span> <span class="o">=</span> <span class="n">ht40</span> <span class="o">?</span> <span class="nb">true</span> <span class="o">:</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_disable_ht40_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;11n 40MHz Mode: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">disable_ht40</span> <span class="o">?</span> <span class="s">&quot;Disabled&quot;</span> <span class="o">:</span> <span class="s">&quot;Enabled&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_temperature_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_sleep_level_override_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						    <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Our users expect 0 to be &quot;CAM&quot;, but 0 isn&#39;t actually</span>
<span class="cm">	 * valid here. However, let&#39;s not confuse them and present</span>
<span class="cm">	 * IWL_POWER_INDEX_1 as &quot;1&quot;, not &quot;0&quot;.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="n">IWL_POWER_NUM</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_ready_rf</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">power_data</span><span class="p">.</span><span class="n">debug_sleep_level_override</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="n">iwl_power_update_mode</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_sleep_level_override_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						   <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="cm">/* see the write function */</span>
	<span class="n">value</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">power_data</span><span class="p">.</span><span class="n">debug_sleep_level_override</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">bufsz</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_current_sleep_command_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						    <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">iwl_powertable_cmd</span> <span class="o">*</span><span class="n">cmd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">power_data</span><span class="p">.</span><span class="n">sleep_cmd</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;flags: %#.2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;RX/TX timeout: %d/%d usec</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">rx_data_timeout</span><span class="p">),</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">tx_data_timeout</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IWL_POWER_VEC_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
				 <span class="s">&quot;sleep_interval[%d]: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">sleep_interval</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">sram</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">wowlan_sram</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">nvm</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">stations</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">channels</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">rx_handlers</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">qos</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">thermal_throttling</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">disable_ht40</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">temperature</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">sleep_level_override</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">current_sleep_command</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt_value</span> <span class="o">=</span> <span class="s">&quot;  %-30s %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt_hex</span>   <span class="o">=</span> <span class="s">&quot;  %-30s       0x%02X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt_table</span> <span class="o">=</span> <span class="s">&quot;  %-30s %10u  %10u  %10u  %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt_header</span> <span class="o">=</span>
	<span class="s">&quot;%-32s    current  cumulative       delta         max</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">iwl_statistics_flag</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bufsz</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flag</span><span class="p">;</span>

	<span class="n">lockdep_assert_held</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">flag</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">flag</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="s">&quot;Statistics Flag(0x%X):</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">UCODE_STATISTICS_CLEAR_MSK</span><span class="p">)</span>
		<span class="n">p</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span>
		<span class="s">&quot;</span><span class="se">\t</span><span class="s">Statistics have been cleared</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">Operational Frequency: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">UCODE_STATISTICS_FREQUENCY_MSK</span><span class="p">)</span>
		<span class="o">?</span> <span class="s">&quot;2.4 GHz&quot;</span> <span class="o">:</span> <span class="s">&quot;5.2 GHz&quot;</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">p</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">p</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">TGj Narrow Band: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">flag</span> <span class="o">&amp;</span> <span class="n">UCODE_STATISTICS_NARROW_BAND_MSK</span><span class="p">)</span>
		 <span class="o">?</span> <span class="s">&quot;enabled&quot;</span> <span class="o">:</span> <span class="s">&quot;disabled&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_rx_stats_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_rx_phy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_rx_non_phy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span>
		    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_rx_ht_phy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">+</span> <span class="mi">400</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_rx_phy</span> <span class="o">*</span><span class="n">ofdm</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_ofdm</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_ofdm</span><span class="p">,</span> <span class="o">*</span><span class="n">max_ofdm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_rx_phy</span> <span class="o">*</span><span class="n">cck</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_cck</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_cck</span><span class="p">,</span> <span class="o">*</span><span class="n">max_cck</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_rx_non_phy</span> <span class="o">*</span><span class="n">general</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_general</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_rx_non_phy</span> <span class="o">*</span><span class="n">delta_general</span><span class="p">,</span> <span class="o">*</span><span class="n">max_general</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_rx_ht_phy</span> <span class="o">*</span><span class="n">ht</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_ht</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_ht</span><span class="p">,</span> <span class="o">*</span><span class="n">max_ht</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * the statistic information display here is based on</span>
<span class="cm">	 * the last statistics notification from uCode</span>
<span class="cm">	 * might not reflect the current uCode activity</span>
<span class="cm">	 */</span>
	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>
	<span class="n">ofdm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">rx_ofdm</span><span class="p">;</span>
	<span class="n">cck</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">rx_cck</span><span class="p">;</span>
	<span class="n">general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">rx_non_phy</span><span class="p">;</span>
	<span class="n">ht</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">rx_ofdm_ht</span><span class="p">;</span>
	<span class="n">accum_ofdm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">rx_ofdm</span><span class="p">;</span>
	<span class="n">accum_cck</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">rx_cck</span><span class="p">;</span>
	<span class="n">accum_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">rx_non_phy</span><span class="p">;</span>
	<span class="n">accum_ht</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">rx_ofdm_ht</span><span class="p">;</span>
	<span class="n">delta_ofdm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">rx_ofdm</span><span class="p">;</span>
	<span class="n">delta_cck</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">rx_cck</span><span class="p">;</span>
	<span class="n">delta_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">rx_non_phy</span><span class="p">;</span>
	<span class="n">delta_ht</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">rx_ofdm_ht</span><span class="p">;</span>
	<span class="n">max_ofdm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">rx_ofdm</span><span class="p">;</span>
	<span class="n">max_cck</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">rx_cck</span><span class="p">;</span>
	<span class="n">max_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">rx_non_phy</span><span class="p">;</span>
	<span class="n">max_ht</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">rx_ofdm_ht</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">iwl_statistics_flag</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsz</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_Rx - OFDM:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;ina_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">,</span> <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">),</span> <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">,</span> <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;plcp_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">),</span> <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span> <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">),</span> <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span> <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;early_overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_good:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;false_alarm_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_sync_err_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sfd_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;unresponded_rts:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;rxe_frame_lmt_ovrun:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_ack_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_cts_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">,</span> <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_ba_rsp_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;dsp_self_kill:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;mh_format_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;re_acq_main_rssi_sum:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ofdm</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">),</span>
			 <span class="n">accum_ofdm</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">,</span>
			 <span class="n">delta_ofdm</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">,</span>
			 <span class="n">max_ofdm</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_Rx - CCK:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;ina_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">),</span> <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">ina_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">),</span> <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">fina_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;plcp_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">),</span> <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">),</span> <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;early_overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_good:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">),</span> <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;false_alarm_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">,</span> <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">false_alarm_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_sync_err_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">fina_sync_err_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sfd_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">sfd_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;fina_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">fina_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;unresponded_rts:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">unresponded_rts</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;rxe_frame_lmt_ovrun:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">rxe_frame_limit_overrun</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_ack_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">sent_ack_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_cts_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">sent_cts_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sent_ba_rsp_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">sent_ba_rsp_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;dsp_self_kill:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">dsp_self_kill</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;mh_format_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span> <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;re_acq_main_rssi_sum:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">cck</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">),</span>
			 <span class="n">accum_cck</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">,</span>
			 <span class="n">delta_cck</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">,</span>
			 <span class="n">max_cck</span><span class="o">-&gt;</span><span class="n">re_acq_main_rssi_sum</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_Rx - GENERAL:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;bogus_cts:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">bogus_cts</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">bogus_cts</span><span class="p">,</span> <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">bogus_cts</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">bogus_cts</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;bogus_ack:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">bogus_ack</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">bogus_ack</span><span class="p">,</span> <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">bogus_ack</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">bogus_ack</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;non_bssid_frames:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">non_bssid_frames</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">non_bssid_frames</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">non_bssid_frames</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">non_bssid_frames</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;filtered_frames:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">filtered_frames</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">filtered_frames</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">filtered_frames</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">filtered_frames</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;non_channel_beacons:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">non_channel_beacons</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">non_channel_beacons</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">non_channel_beacons</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">non_channel_beacons</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;channel_beacons:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">channel_beacons</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">channel_beacons</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">channel_beacons</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">channel_beacons</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;num_missed_bcon:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">num_missed_bcon</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">num_missed_bcon</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">num_missed_bcon</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">num_missed_bcon</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;adc_rx_saturation_time:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">adc_rx_saturation_time</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">adc_rx_saturation_time</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">adc_rx_saturation_time</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">adc_rx_saturation_time</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;ina_detect_search_tm:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">ina_detection_search_time</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">ina_detection_search_time</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">ina_detection_search_time</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">ina_detection_search_time</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_silence_rssi_a:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_a</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_a</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_a</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_silence_rssi_b:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_b</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_b</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_b</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_silence_rssi_c:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_c</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_c</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_c</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_silence_rssi_c</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;interference_data_flag:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">interference_data_flag</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">interference_data_flag</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">interference_data_flag</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">interference_data_flag</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;channel_load:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">channel_load</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">channel_load</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">channel_load</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">channel_load</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;dsp_false_alarms:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">dsp_false_alarms</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">dsp_false_alarms</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">dsp_false_alarms</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">dsp_false_alarms</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_rssi_a:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_a</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_a</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_a</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_rssi_b:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_b</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_b</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_b</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_rssi_c:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_c</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_c</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_c</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_rssi_c</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_energy_a:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_energy_a</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_a</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_a</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_energy_b:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_energy_b</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_b</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_b</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;beacon_energy_c:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">beacon_energy_c</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_c</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_c</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">beacon_energy_c</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_Rx - OFDM_HT:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;plcp_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">),</span> <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">plcp_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">),</span> <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;early_overrun_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">),</span>
			 <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">,</span>
			 <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">early_overrun_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_good:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">),</span> <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">crc32_good</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;crc32_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">),</span> <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">crc32_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;mh_format_err:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">),</span>
			 <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">mh_format_err</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg_crc32_good:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">agg_crc32_good</span><span class="p">),</span>
			 <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">agg_crc32_good</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">agg_crc32_good</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">agg_crc32_good</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg_mpdu_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">agg_mpdu_cnt</span><span class="p">),</span>
			 <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">agg_mpdu_cnt</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">agg_mpdu_cnt</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">agg_mpdu_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">agg_cnt</span><span class="p">),</span> <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">agg_cnt</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">agg_cnt</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">agg_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;unsupport_mcs:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">unsupport_mcs</span><span class="p">),</span>
			 <span class="n">accum_ht</span><span class="o">-&gt;</span><span class="n">unsupport_mcs</span><span class="p">,</span>
			 <span class="n">delta_ht</span><span class="o">-&gt;</span><span class="n">unsupport_mcs</span><span class="p">,</span> <span class="n">max_ht</span><span class="o">-&gt;</span><span class="n">unsupport_mcs</span><span class="p">);</span>

	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_tx_stats_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_tx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">48</span><span class="p">)</span> <span class="o">+</span> <span class="mi">250</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_tx</span> <span class="o">*</span><span class="n">tx</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_tx</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_tx</span><span class="p">,</span> <span class="o">*</span><span class="n">max_tx</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/* the statistic information display here is based on</span>
<span class="cm">	 * the last statistics notification from uCode</span>
<span class="cm">	 * might not reflect the current uCode activity</span>
<span class="cm">	 */</span>
	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">tx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">tx</span><span class="p">;</span>
	<span class="n">accum_tx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">tx</span><span class="p">;</span>
	<span class="n">delta_tx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">tx</span><span class="p">;</span>
	<span class="n">max_tx</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">tx</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">iwl_statistics_flag</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsz</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_Tx:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;preamble:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">preamble_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">preamble_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">preamble_cnt</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">preamble_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;rx_detected_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">rx_detected_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">rx_detected_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">rx_detected_cnt</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">rx_detected_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;bt_prio_defer_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">bt_prio_defer_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_defer_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_defer_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_defer_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;bt_prio_kill_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">bt_prio_kill_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_kill_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_kill_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">bt_prio_kill_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;few_bytes_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">few_bytes_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">few_bytes_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">few_bytes_cnt</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">few_bytes_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;cts_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">cts_timeout</span><span class="p">),</span> <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;ack_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">ack_timeout</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">ack_timeout</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">ack_timeout</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">ack_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;expected_ack_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">expected_ack_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">expected_ack_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">expected_ack_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">expected_ack_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;actual_ack_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">actual_ack_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">actual_ack_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">actual_ack_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">actual_ack_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;dump_msdu_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">dump_msdu_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">dump_msdu_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">dump_msdu_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">dump_msdu_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;abort_nxt_frame_mismatch:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">burst_abort_next_frame_mismatch_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_next_frame_mismatch_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_next_frame_mismatch_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_next_frame_mismatch_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;abort_missing_nxt_frame:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">burst_abort_missing_next_frame_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_missing_next_frame_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_missing_next_frame_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">burst_abort_missing_next_frame_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;cts_timeout_collision:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">cts_timeout_collision</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout_collision</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout_collision</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">cts_timeout_collision</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;ack_ba_timeout_collision:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">ack_or_ba_timeout_collision</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">ack_or_ba_timeout_collision</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">ack_or_ba_timeout_collision</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">ack_or_ba_timeout_collision</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg ba_timeout:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_timeout</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_timeout</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_timeout</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_timeout</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg ba_resched_frames:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_reschedule_frames</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_reschedule_frames</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_reschedule_frames</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">ba_reschedule_frames</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg scd_query_agg_frame:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg_frame_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg_frame_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg_frame_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg_frame_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg scd_query_no_agg:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_no_agg</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_no_agg</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_no_agg</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_no_agg</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg scd_query_agg:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_agg</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg scd_query_mismatch:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_mismatch</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_mismatch</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_mismatch</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">scd_query_mismatch</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg frame_not_ready:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">frame_not_ready</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">frame_not_ready</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">frame_not_ready</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">frame_not_ready</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg underrun:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">underrun</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">underrun</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">underrun</span><span class="p">,</span> <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">underrun</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg bt_prio_kill:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">bt_prio_kill</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">bt_prio_kill</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">bt_prio_kill</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">bt_prio_kill</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;agg rx_ba_rsp_cnt:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">rx_ba_rsp_cnt</span><span class="p">),</span>
			 <span class="n">accum_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">rx_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">delta_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">rx_ba_rsp_cnt</span><span class="p">,</span>
			 <span class="n">max_tx</span><span class="o">-&gt;</span><span class="n">agg</span><span class="p">.</span><span class="n">rx_ba_rsp_cnt</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_a</span> <span class="o">||</span> <span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_b</span> <span class="o">||</span> <span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_c</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;tx power: (1/2 dB step)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">valid_tx_ant</span> <span class="o">&amp;</span> <span class="n">ANT_A</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_a</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
					<span class="n">fmt_hex</span><span class="p">,</span> <span class="s">&quot;antenna A:&quot;</span><span class="p">,</span>
					<span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_a</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">valid_tx_ant</span> <span class="o">&amp;</span> <span class="n">ANT_B</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_b</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
					<span class="n">fmt_hex</span><span class="p">,</span> <span class="s">&quot;antenna B:&quot;</span><span class="p">,</span>
					<span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_b</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">valid_tx_ant</span> <span class="o">&amp;</span> <span class="n">ANT_C</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_c</span><span class="p">)</span>
			<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
					<span class="n">fmt_hex</span><span class="p">,</span> <span class="s">&quot;antenna C:&quot;</span><span class="p">,</span>
					<span class="n">tx</span><span class="o">-&gt;</span><span class="n">tx_power</span><span class="p">.</span><span class="n">ant_c</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_general_stats_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_general</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">300</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_general_common</span> <span class="o">*</span><span class="n">general</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_general</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_general_common</span> <span class="o">*</span><span class="n">delta_general</span><span class="p">,</span> <span class="o">*</span><span class="n">max_general</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_dbg</span> <span class="o">*</span><span class="n">dbg</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_dbg</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_dbg</span><span class="p">,</span> <span class="o">*</span><span class="n">max_dbg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_div</span> <span class="o">*</span><span class="n">div</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_div</span><span class="p">,</span> <span class="o">*</span><span class="n">delta_div</span><span class="p">,</span> <span class="o">*</span><span class="n">max_div</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/* the statistic information display here is based on</span>
<span class="cm">	 * the last statistics notification from uCode</span>
<span class="cm">	 * might not reflect the current uCode activity</span>
<span class="cm">	 */</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">common</span><span class="p">;</span>
	<span class="n">dbg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">dbg</span><span class="p">;</span>
	<span class="n">div</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">div</span><span class="p">;</span>
	<span class="n">accum_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">common</span><span class="p">;</span>
	<span class="n">accum_dbg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">dbg</span><span class="p">;</span>
	<span class="n">accum_div</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">div</span><span class="p">;</span>
	<span class="n">delta_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">;</span>
	<span class="n">max_general</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">;</span>
	<span class="n">delta_dbg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">dbg</span><span class="p">;</span>
	<span class="n">max_dbg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">dbg</span><span class="p">;</span>
	<span class="n">delta_div</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">div</span><span class="p">;</span>
	<span class="n">max_div</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">max_delta_stats</span><span class="p">.</span><span class="n">common</span><span class="p">.</span><span class="n">div</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">iwl_statistics_flag</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsz</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_header</span><span class="p">,</span> <span class="s">&quot;Statistics_General:&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_value</span><span class="p">,</span> <span class="s">&quot;temperature:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">temperature</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_value</span><span class="p">,</span> <span class="s">&quot;temperature_m:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">temperature_m</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_value</span><span class="p">,</span> <span class="s">&quot;ttl_timestamp:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">ttl_timestamp</span><span class="p">));</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;burst_check:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">dbg</span><span class="o">-&gt;</span><span class="n">burst_check</span><span class="p">),</span>
			 <span class="n">accum_dbg</span><span class="o">-&gt;</span><span class="n">burst_check</span><span class="p">,</span>
			 <span class="n">delta_dbg</span><span class="o">-&gt;</span><span class="n">burst_check</span><span class="p">,</span> <span class="n">max_dbg</span><span class="o">-&gt;</span><span class="n">burst_check</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;burst_count:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">dbg</span><span class="o">-&gt;</span><span class="n">burst_count</span><span class="p">),</span>
			 <span class="n">accum_dbg</span><span class="o">-&gt;</span><span class="n">burst_count</span><span class="p">,</span>
			 <span class="n">delta_dbg</span><span class="o">-&gt;</span><span class="n">burst_count</span><span class="p">,</span> <span class="n">max_dbg</span><span class="o">-&gt;</span><span class="n">burst_count</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;wait_for_silence_timeout_count:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">dbg</span><span class="o">-&gt;</span><span class="n">wait_for_silence_timeout_cnt</span><span class="p">),</span>
			 <span class="n">accum_dbg</span><span class="o">-&gt;</span><span class="n">wait_for_silence_timeout_cnt</span><span class="p">,</span>
			 <span class="n">delta_dbg</span><span class="o">-&gt;</span><span class="n">wait_for_silence_timeout_cnt</span><span class="p">,</span>
			 <span class="n">max_dbg</span><span class="o">-&gt;</span><span class="n">wait_for_silence_timeout_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;sleep_time:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">sleep_time</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">sleep_time</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">sleep_time</span><span class="p">,</span> <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">sleep_time</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;slots_out:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">slots_out</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">slots_out</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">slots_out</span><span class="p">,</span> <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">slots_out</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;slots_idle:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">slots_idle</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">slots_idle</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">slots_idle</span><span class="p">,</span> <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">slots_idle</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;tx_on_a:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">div</span><span class="o">-&gt;</span><span class="n">tx_on_a</span><span class="p">),</span> <span class="n">accum_div</span><span class="o">-&gt;</span><span class="n">tx_on_a</span><span class="p">,</span>
			 <span class="n">delta_div</span><span class="o">-&gt;</span><span class="n">tx_on_a</span><span class="p">,</span> <span class="n">max_div</span><span class="o">-&gt;</span><span class="n">tx_on_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;tx_on_b:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">div</span><span class="o">-&gt;</span><span class="n">tx_on_b</span><span class="p">),</span> <span class="n">accum_div</span><span class="o">-&gt;</span><span class="n">tx_on_b</span><span class="p">,</span>
			 <span class="n">delta_div</span><span class="o">-&gt;</span><span class="n">tx_on_b</span><span class="p">,</span> <span class="n">max_div</span><span class="o">-&gt;</span><span class="n">tx_on_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;exec_time:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">div</span><span class="o">-&gt;</span><span class="n">exec_time</span><span class="p">),</span> <span class="n">accum_div</span><span class="o">-&gt;</span><span class="n">exec_time</span><span class="p">,</span>
			 <span class="n">delta_div</span><span class="o">-&gt;</span><span class="n">exec_time</span><span class="p">,</span> <span class="n">max_div</span><span class="o">-&gt;</span><span class="n">exec_time</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;probe_time:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">div</span><span class="o">-&gt;</span><span class="n">probe_time</span><span class="p">),</span> <span class="n">accum_div</span><span class="o">-&gt;</span><span class="n">probe_time</span><span class="p">,</span>
			 <span class="n">delta_div</span><span class="o">-&gt;</span><span class="n">probe_time</span><span class="p">,</span> <span class="n">max_div</span><span class="o">-&gt;</span><span class="n">probe_time</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;rx_enable_counter:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">rx_enable_counter</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">rx_enable_counter</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">rx_enable_counter</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">rx_enable_counter</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="n">fmt_table</span><span class="p">,</span> <span class="s">&quot;num_of_sos_states:&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">general</span><span class="o">-&gt;</span><span class="n">num_of_sos_states</span><span class="p">),</span>
			 <span class="n">accum_general</span><span class="o">-&gt;</span><span class="n">num_of_sos_states</span><span class="p">,</span>
			 <span class="n">delta_general</span><span class="o">-&gt;</span><span class="n">num_of_sos_states</span><span class="p">,</span>
			 <span class="n">max_general</span><span class="o">-&gt;</span><span class="n">num_of_sos_states</span><span class="p">);</span>

	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_bt_stats_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">statistics_bt_activity</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="mi">200</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">statistics_bt_activity</span> <span class="o">*</span><span class="n">bt</span><span class="p">,</span> <span class="o">*</span><span class="n">accum_bt</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_enable_flag</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="cm">/* make request to uCode to retrieve statistics information */</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">iwl_send_statistics_request</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">CMD_SYNC</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * the statistic information display here is based on</span>
<span class="cm">	 * the last statistics notification from uCode</span>
<span class="cm">	 * might not reflect the current uCode activity</span>
<span class="cm">	 */</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">bt</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">bt_activity</span><span class="p">;</span>
	<span class="n">accum_bt</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">accum_stats</span><span class="p">.</span><span class="n">bt_activity</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">iwl_statistics_flag</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">bufsz</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;Statistics_BT:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\t\t\t</span><span class="s">current</span><span class="se">\t\t\t</span><span class="s">accumulative</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;hi_priority_tx_req_cnt:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">hi_priority_tx_req_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">hi_priority_tx_req_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;hi_priority_tx_denied_cnt:</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">hi_priority_tx_denied_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">hi_priority_tx_denied_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;lo_priority_tx_req_cnt:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">lo_priority_tx_req_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">lo_priority_tx_req_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;lo_priority_tx_denied_cnt:</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">lo_priority_tx_denied_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">lo_priority_tx_denied_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;hi_priority_rx_req_cnt:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">hi_priority_rx_req_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">hi_priority_rx_req_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;hi_priority_rx_denied_cnt:</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">hi_priority_rx_denied_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">hi_priority_rx_denied_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;lo_priority_rx_req_cnt:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">lo_priority_rx_req_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">lo_priority_rx_req_cnt</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;lo_priority_rx_denied_cnt:</span><span class="se">\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">bt</span><span class="o">-&gt;</span><span class="n">lo_priority_rx_denied_cnt</span><span class="p">),</span>
			 <span class="n">accum_bt</span><span class="o">-&gt;</span><span class="n">lo_priority_rx_denied_cnt</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;(rx)num_bt_kills:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">num_bt_kills</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">accum_num_bt_kills</span><span class="p">);</span>

	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">statistics</span><span class="p">.</span><span class="n">lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_reply_tx_error_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">reply_tx_error_statistics</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span>
		<span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">reply_agg_tx_error_statistics</span><span class="p">)</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="mi">200</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;Statistics_TX_Error:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_POSTPONE_DELAY</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_delay</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_POSTPONE_FEW_BYTES</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_few_bytes</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_POSTPONE_BT_PRIO</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_bt_prio</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_POSTPONE_QUIET_PERIOD</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_quiet_period</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_POSTPONE_CALC_TTAK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_calc_ttak</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span>
				<span class="n">TX_STATUS_FAIL_INTERNAL_CROSSED_RETRY</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">int_crossed_retry</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_SHORT_LIMIT</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">short_limit</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_LONG_LIMIT</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">long_limit</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_FIFO_UNDERRUN</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">fifo_underrun</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_DRAIN_FLOW</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">drain_flow</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_RFKILL_FLUSH</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">rfkill_flush</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_LIFE_EXPIRE</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">life_expire</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_DEST_PS</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">dest_ps</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_HOST_ABORTED</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">host_abort</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_BT_RETRY</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">pp_delay</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_STA_INVALID</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">sta_invalid</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_FRAG_DROPPED</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">frag_drop</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_TID_DISABLE</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">tid_disable</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_FIFO_FLUSHED</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">fifo_flush</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span>
				<span class="n">TX_STATUS_FAIL_INSUFFICIENT_CF_POLL</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">insuff_cf_poll</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span><span class="n">TX_STATUS_FAIL_PASSIVE_NO_RX</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">fail_hw_drop</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_tx_fail_reason</span><span class="p">(</span>
				<span class="n">TX_STATUS_FAIL_NO_BEACON_ON_RADAR</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">sta_color_mismatch</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;UNKNOWN:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_tx_stats</span><span class="p">.</span><span class="n">unknown</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;</span><span class="se">\n</span><span class="s">Statistics_Agg_TX_Error:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_UNDERRUN_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">underrun</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_BT_PRIO_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">bt_prio</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_FEW_BYTES_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">few_bytes</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_ABORT_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">abort</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span>
				<span class="n">AGG_TX_STATE_LAST_SENT_TTL_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">last_sent_ttl</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span>
				<span class="n">AGG_TX_STATE_LAST_SENT_TRY_CNT_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">last_sent_try</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span>
				<span class="n">AGG_TX_STATE_LAST_SENT_BT_KILL_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">last_sent_bt_kill</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_SCD_QUERY_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">scd_query</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span>
				<span class="n">AGG_TX_STATE_TEST_BAD_CRC32_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">bad_crc32</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_RESPONSE_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">response</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_DUMP_TX_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">dump_tx</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">iwl_get_agg_tx_fail_reason</span><span class="p">(</span><span class="n">AGG_TX_STATE_DELAY_TX_MSK</span><span class="p">),</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">delay_tx</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;UNKNOWN:</span><span class="se">\t\t\t</span><span class="s">%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">priv</span><span class="o">-&gt;</span><span class="n">reply_agg_tx_stats</span><span class="p">.</span><span class="n">unknown</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_sensitivity_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_sensitivity_data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_sensitivity_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">sensitivity_data</span><span class="p">;</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;auto_corr_ofdm:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_ofdm</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;auto_corr_ofdm_mrc:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_ofdm_mrc</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;auto_corr_ofdm_x1:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_ofdm_x1</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;auto_corr_ofdm_mrc_x1:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_ofdm_mrc_x1</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;auto_corr_cck:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_cck</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;auto_corr_cck_mrc:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">auto_corr_cck_mrc</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;last_bad_plcp_cnt_ofdm:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">last_bad_plcp_cnt_ofdm</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;last_fa_cnt_ofdm:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">last_fa_cnt_ofdm</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;last_bad_plcp_cnt_cck:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">last_bad_plcp_cnt_cck</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;last_fa_cnt_cck:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">last_fa_cnt_cck</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_curr_state:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_curr_state</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_prev_state:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_prev_state</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_value:</span><span class="se">\t\t\t</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; %u&quot;</span><span class="p">,</span>
				<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_value</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_silence_rssi:</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">NRG_NUM_PREV_STAT_L</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; %u&quot;</span><span class="p">,</span>
				<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_silence_rssi</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_silence_ref:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_silence_ref</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_energy_idx:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_energy_idx</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_silence_idx:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_silence_idx</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_th_cck:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_th_cck</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;nrg_auto_corr_silence_diff:</span><span class="se">\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_auto_corr_silence_diff</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;num_in_cck_no_fa:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">num_in_cck_no_fa</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;nrg_th_ofdm:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">nrg_th_ofdm</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_chain_noise_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_chain_noise_data</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">100</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_chain_noise_data</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">chain_noise_data</span><span class="p">;</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">bufsz</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;active_chains:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">active_chains</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_noise_a:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_noise_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_noise_b:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_noise_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_noise_c:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_noise_c</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_signal_a:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_signal_a</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_signal_b:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_signal_b</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;chain_signal_c:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">chain_signal_c</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;beacon_count:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">beacon_count</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;disconn_array:</span><span class="se">\t\t\t</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">NUM_RX_CHAINS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; %u&quot;</span><span class="p">,</span>
				<span class="n">data</span><span class="o">-&gt;</span><span class="n">disconn_array</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;delta_gain_code:</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">cnt</span> <span class="o">&lt;</span> <span class="n">NUM_RX_CHAINS</span><span class="p">;</span> <span class="n">cnt</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot; %u&quot;</span><span class="p">,</span>
				<span class="n">data</span><span class="o">-&gt;</span><span class="n">delta_gain_code</span><span class="p">[</span><span class="n">cnt</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;radio_write:</span><span class="se">\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">radio_write</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;state:</span><span class="se">\t\t\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">data</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_power_save_status_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						    <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">60</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">pwrsave_status</span><span class="p">;</span>

	<span class="n">pwrsave_status</span> <span class="o">=</span> <span class="n">iwl_read32</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">,</span> <span class="n">CSR_GP_CNTRL</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="n">CSR_GP_REG_POWER_SAVE_STATUS_MSK</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;Power Save Status: &quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">pwrsave_status</span> <span class="o">==</span> <span class="n">CSR_GP_REG_NO_POWER_SAVE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;none&quot;</span> <span class="o">:</span>
		<span class="p">(</span><span class="n">pwrsave_status</span> <span class="o">==</span> <span class="n">CSR_GP_REG_MAC_POWER_SAVE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;MAC&quot;</span> <span class="o">:</span>
		<span class="p">(</span><span class="n">pwrsave_status</span> <span class="o">==</span> <span class="n">CSR_GP_REG_PHY_POWER_SAVE</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;PHY&quot;</span> <span class="o">:</span>
		<span class="s">&quot;error&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_clear_ucode_statistics_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clear</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clear</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="cm">/* make request to uCode to retrieve statistics information */</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="n">iwl_send_statistics_request</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">CMD_SYNC</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_tracing_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;ucode trace timer is %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">ucode_trace</span> <span class="o">?</span> <span class="s">&quot;On&quot;</span> <span class="o">:</span> <span class="s">&quot;Off&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;non_wraps_count:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">non_wraps_count</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;wraps_once_count:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">wraps_once_count</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;wraps_more_count:</span><span class="se">\t\t</span><span class="s"> %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">wraps_more_count</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_ucode_tracing_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">trace</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">trace</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">ucode_trace</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">iwl_is_alive</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span> <span class="p">{</span>
			<span class="cm">/* start collecting data now */</span>
			<span class="n">mod_timer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ucode_trace</span><span class="p">,</span> <span class="n">jiffies</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">event_log</span><span class="p">.</span><span class="n">ucode_trace</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
		<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ucode_trace</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rxon_flags_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">contexts</span><span class="p">[</span><span class="n">IWL_RXON_CTX_BSS</span><span class="p">].</span><span class="n">active</span><span class="p">.</span><span class="n">flags</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rxon_filter_flags_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
						<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
						<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%04X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">contexts</span><span class="p">[</span><span class="n">IWL_RXON_CTX_BSS</span><span class="p">].</span><span class="n">active</span><span class="p">.</span><span class="n">filter_flags</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_missed_beacon_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">missed_beacon_threshold</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_missed_beacon_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">missed</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">missed</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">missed</span> <span class="o">&lt;</span> <span class="n">IWL_MISSED_BEACON_THRESHOLD_MIN</span> <span class="o">||</span>
	    <span class="n">missed</span> <span class="o">&gt;</span> <span class="n">IWL_MISSED_BEACON_THRESHOLD_MAX</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">missed_beacon_threshold</span> <span class="o">=</span>
			<span class="n">IWL_MISSED_BEACON_THRESHOLD_DEF</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">missed_beacon_threshold</span> <span class="o">=</span> <span class="n">missed</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_plcp_delta_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">plcp_delta_threshold</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_plcp_delta_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">plcp</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">plcp</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">plcp</span> <span class="o">&lt;</span> <span class="n">IWL_MAX_PLCP_ERR_THRESHOLD_MIN</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">plcp</span> <span class="o">&gt;</span> <span class="n">IWL_MAX_PLCP_ERR_THRESHOLD_MAX</span><span class="p">))</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">plcp_delta_threshold</span> <span class="o">=</span>
			<span class="n">IWL_MAX_PLCP_ERR_THRESHOLD_DISABLE</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">plcp_delta_threshold</span> <span class="o">=</span> <span class="n">plcp</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rf_reset_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				       <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">300</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">iwl_rf_reset</span> <span class="o">*</span><span class="n">rf_reset</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">rf_reset</span><span class="p">;</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;RF reset statistics</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\t</span><span class="s">number of reset request: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rf_reset</span><span class="o">-&gt;</span><span class="n">reset_request_count</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\t</span><span class="s">number of reset request success: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rf_reset</span><span class="o">-&gt;</span><span class="n">reset_success_count</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\t</span><span class="s">number of reset request reject: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rf_reset</span><span class="o">-&gt;</span><span class="n">reset_reject_count</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_rf_reset_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">iwl_force_rf_reset</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span> <span class="o">?</span> <span class="n">ret</span> <span class="o">:</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_txfifo_flush_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">flush</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">flush</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iwl_is_rfkill</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">iwlagn_dev_txfifo_flush</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">IWL_DROP_ALL</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_bt_traffic_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">200</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_enable_flag</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;BT coex disabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;BT enable flag: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_enable_flag</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;BT in %s mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_full_concurrent</span> <span class="o">?</span> <span class="s">&quot;full concurrency&quot;</span> <span class="o">:</span> <span class="s">&quot;3-wire&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;BT status: %s, &quot;</span>
			 <span class="s">&quot;last traffic notif: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_status</span> <span class="o">?</span> <span class="s">&quot;On&quot;</span> <span class="o">:</span> <span class="s">&quot;Off&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">last_bt_traffic_load</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;ch_announcement: %d, &quot;</span>
			 <span class="s">&quot;kill_ack_mask: %x, kill_cts_mask: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_ch_announce</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">kill_ack_mask</span><span class="p">,</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">kill_cts_mask</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;bluetooth traffic load: &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">bt_traffic_load</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS</span>:
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;Continuous</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IWL_BT_COEX_TRAFFIC_LOAD_HIGH</span>:
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;High</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IWL_BT_COEX_TRAFFIC_LOAD_LOW</span>:
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;Low</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">IWL_BT_COEX_TRAFFIC_LOAD_NONE</span>:
	<span class="nl">default:</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;None</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_protection_mode_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="p">)</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ht_params</span><span class="p">)</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;use %s for aggregation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">use_rts_for_aggregation</span><span class="p">)</span> <span class="o">?</span>
				<span class="s">&quot;rts/cts&quot;</span> <span class="o">:</span> <span class="s">&quot;cts-to-self&quot;</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span> <span class="s">&quot;N/A&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_protection_mode_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rts</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ht_params</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rts</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">use_rts_for_aggregation</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw_params</span><span class="p">.</span><span class="n">use_rts_for_aggregation</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">iwl_cmd_echo_test</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iwl_host_cmd</span> <span class="n">cmd</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">REPLY_ECHO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">},</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">CMD_SYNC</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">iwl_dvm_send_cmd</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cmd</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">IWL_ERR</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="s">&quot;echo testing fail: 0X%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">IWL_DEBUG_INFO</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="s">&quot;echo testing pass</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_echo_test_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">iwl_cmd_echo_test</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_IWLWIFI_DEBUG</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_log_event_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">iwl_dump_nic_event_log</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_log_event_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">event_log_flag</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span>  <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">event_log_flag</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">event_log_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">iwl_dump_nic_event_log</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_calib_disabled_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					 <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					 <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">120</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">size_t</span> <span class="n">bufsz</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;Sensitivity calibrations %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">calib_disabled</span> <span class="o">&amp;</span>
					<span class="n">IWL_SENSITIVITY_CALIB_DISABLED</span><span class="p">)</span> <span class="o">?</span>
			 <span class="s">&quot;DISABLED&quot;</span> <span class="o">:</span> <span class="s">&quot;ENABLED&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;Chain noise calibrations %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">calib_disabled</span> <span class="o">&amp;</span>
					<span class="n">IWL_CHAIN_NOISE_CALIB_DISABLED</span><span class="p">)</span> <span class="o">?</span>
			 <span class="s">&quot;DISABLED&quot;</span> <span class="o">:</span> <span class="s">&quot;ENABLED&quot;</span><span class="p">);</span>
	<span class="n">pos</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">pos</span><span class="p">,</span> <span class="n">bufsz</span> <span class="o">-</span> <span class="n">pos</span><span class="p">,</span>
			 <span class="s">&quot;Tx power calibrations %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">calib_disabled</span> <span class="o">&amp;</span>
					<span class="n">IWL_TX_POWER_CALIB_DISABLED</span><span class="p">)</span> <span class="o">?</span>
			 <span class="s">&quot;DISABLED&quot;</span> <span class="o">:</span> <span class="s">&quot;ENABLED&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">iwl_dbgfs_calib_disabled_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
					      <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
					      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">calib_disabled</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">buf_size</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf_size</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">buf_size</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%x&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">calib_disabled</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">calib_disabled</span> <span class="o">=</span> <span class="n">calib_disabled</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">ucode_rx_stats</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">ucode_tx_stats</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">ucode_general_stats</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">chain_noise</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">power_save_status</span><span class="p">);</span>
<span class="n">DEBUGFS_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">clear_ucode_statistics</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">ucode_tracing</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">missed_beacon</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">plcp_delta</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">rf_reset</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">rxon_flags</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">rxon_filter_flags</span><span class="p">);</span>
<span class="n">DEBUGFS_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">txfifo_flush</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">ucode_bt_stats</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">bt_traffic</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">protection_mode</span><span class="p">);</span>
<span class="n">DEBUGFS_READ_FILE_OPS</span><span class="p">(</span><span class="n">reply_tx_error</span><span class="p">);</span>
<span class="n">DEBUGFS_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">echo_test</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_IWLWIFI_DEBUG</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">log_event</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="n">DEBUGFS_READ_WRITE_FILE_OPS</span><span class="p">(</span><span class="n">calib_disabled</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Create the debugfs files and directories</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">iwl_dbgfs_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">phyd</span> <span class="o">=</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">wiphy</span><span class="o">-&gt;</span><span class="n">debugfsdir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dir_drv</span><span class="p">,</span> <span class="o">*</span><span class="n">dir_data</span><span class="p">,</span> <span class="o">*</span><span class="n">dir_rf</span><span class="p">,</span> <span class="o">*</span><span class="n">dir_debug</span><span class="p">;</span>

	<span class="n">dir_drv</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">phyd</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_drv</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debugfs_dir</span> <span class="o">=</span> <span class="n">dir_drv</span><span class="p">;</span>

	<span class="n">dir_data</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="n">dir_drv</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_data</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">dir_rf</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;rf&quot;</span><span class="p">,</span> <span class="n">dir_drv</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_rf</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">dir_debug</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="n">dir_drv</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_debug</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">nvm</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">sram</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">wowlan_sram</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">rx_handlers</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">qos</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">sleep_level_override</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">current_sleep_command</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">thermal_throttling</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">disable_ht40</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>

	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">power_save_status</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">clear_ucode_statistics</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">missed_beacon</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">plcp_delta</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">rf_reset</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">ucode_rx_stats</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">ucode_tx_stats</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">ucode_general_stats</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">txfifo_flush</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">protection_mode</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">chain_noise</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">ucode_tracing</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">ucode_bt_stats</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">reply_tx_error</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">rxon_flags</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">rxon_filter_flags</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">echo_test</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_IWLWIFI_DEBUG</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">log_event</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iwl_advanced_bt_coexist</span><span class="p">(</span><span class="n">priv</span><span class="p">))</span>
		<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">bt_traffic</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">);</span>

	<span class="cm">/* Calibrations disabled/enabled status*/</span>
	<span class="n">DEBUGFS_ADD_FILE</span><span class="p">(</span><span class="n">calib_disabled</span><span class="p">,</span> <span class="n">dir_rf</span><span class="p">,</span> <span class="n">S_IWUSR</span> <span class="o">|</span> <span class="n">S_IRUSR</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iwl_trans_dbgfs_register</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">trans</span><span class="p">,</span> <span class="n">dir_debug</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err:</span>
	<span class="n">IWL_ERR</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="s">&quot;Can&#39;t create the debugfs directory</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">iwl_dbgfs_unregister</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * Remove the debugfs files and directories</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">iwl_dbgfs_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">iwl_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">debugfs_dir</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">debugfs_remove_recursive</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">debugfs_dir</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debugfs_dir</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
